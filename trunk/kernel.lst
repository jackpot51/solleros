     1                                  [BITS 16]
     2                                      %include 'source/menu.asm'
     3                              <1>     ; MENU.ASM
     4                              <1> %include 'source/signature.asm'
     5                              <2> signature:	;used by bootloader to find SollerOS
     6 00000000 02000000            <2> dd 2
     7 00000004 534F4C4C45524F53    <2> db "SOLLEROS"
     8                              <2> signatureend:
     9                              <1> menustart:	
    10 0000000C 8CC8                <1> 	mov ax, cs
    11 0000000E 8ED8                <1> 	mov ds, ax
    12 00000010 8EC0                <1> 	mov es, ax
    13 00000012 8ED0                <1> 	mov ss, ax
    14 00000014 880E[2D00]          <1> 	mov [DriveNumber], cl
    15 00000018 668916[2E00]        <1> 	mov [lbaad], edx
    16 0000001D B800A0              <1> 	mov ax, 0xA000
    17 00000020 8EE8                <1> 	mov gs, ax
    18 00000022 B81200              <1> 	mov ax, 12h
    19 00000025 BB0000              <1> 	mov bx, 0
    20 00000028 CD10                <1> 	int 10h
    21 0000002A E90900              <1> 	jmp guiload
    22                              <1> 
    23 0000002D 00                  <1> DriveNumber db 0
    24 0000002E 00000000            <1> lbaad dd 0
    25                              <1> 	
    26 00000032 0000                <1> vesamode dw 0
    27 00000034 0000                <1> videomodecache dw 0
    28                              <1> 
    29                              <1> guiload:
    30 00000036 BE[6602]            <1> 	mov si, bootmsg
    31 00000039 E83301              <1> 	call printrm
    32 0000003C B80000              <1> 	mov ax, 0
    33 0000003F CD16                <1> 	int 16h
    34 00000041 3C79                <1> 	cmp al, "y"
    35 00000043 0F85F400            <1> 	jne near guiload2
    36                              <1> guiloadagain:
    37 00000047 B8004F              <1> 	mov ax, 04F00h
    38 0000004A BF[5751]            <1> 	mov di, VBEMODEBLOCK
    39 0000004D CD10                <1> 	int 10h
    40 0000004F BE[7951]            <1> 	mov si, reserved
    41 00000052 81EE0200            <1> 	sub si, 2
    42                              <1> findvideomodes:
    43 00000056 81C60200            <1> 	add si, 2
    44 0000005A 8B0C                <1> 	mov cx, [si]
    45 0000005C 81F9FFFF            <1> 	cmp cx, 0xFFFF
    46 00000060 0F840A00            <1> 	je near nextvmode
    47 00000064 81FE[5752]          <1> 	cmp si, oemdata
    48 00000068 0F83CF00            <1> 	jae near guiload2	;;kill if no valid list is found
    49 0000006C EBE8                <1> 	jmp findvideomodes 	
    50                              <1> ;;debug,shows vmodes available
    51                              <1> nextvmode:
    52 0000006E 81EE0200            <1> 	sub si, 2
    53 00000072 81FE[7951]          <1> 	cmp si, reserved
    54 00000076 0F82CDFF            <1> 	jb near guiloadagain
    55 0000007A 8B0C                <1> 	mov cx, [si]
    56 0000007C 81F9FFFF            <1> 	cmp cx, 0xFFFF
    57 00000080 0F84EAFF            <1> 	je near nextvmode
    58 00000084 81C10040            <1> 	add cx, 0x4000 		;;Linear Frame Buffer
    59 00000088 B8014F              <1> 	mov ax, 04F01h
    60 0000008B BF[5753]            <1> 	mov di, VBEMODEINFOBLOCK
    61 0000008E 890E[3200]          <1> 	mov [vesamode], cx
    62 00000092 CD10                <1> 	int 10h
    63 00000094 A0[7053]            <1> 	mov al, [bitsperpixel]
    64 00000097 3C10                <1> 	cmp al, 16
    65 00000099 75D3                <1> 	jne nextvmode
    66 0000009B 8936[3400]          <1> 	mov [videomodecache], si
    67 0000009F 80FC00              <1> 	cmp ah, 0
    68 000000A2 0F842200            <1> 	je near setvesamode
    69 000000A6 EBC6                <1> 	jmp nextvmode
    70 000000A8 0A0D49732074686973- <1> isthisvideook db 10,13,"Is this video mode OK?(y/n)",13,10,0
    71 000000B1 20766964656F206D6F- <1>
    72 000000BA 6465204F4B3F28792F- <1>
    73 000000C3 6E290D0A00          <1>
    74                              <1> setvesamode:
    75 000000C8 8B0E[6953]          <1> 	mov cx, [xresolution]
    76 000000CC E8B800              <1> 	call decshow
    77 000000CF B078                <1> 	mov al, "x"
    78 000000D1 E82001              <1> 	call char
    79 000000D4 8B0E[6B53]          <1> 	mov cx, [yresolution]
    80 000000D8 E8AC00              <1> 	call decshow
    81 000000DB B040                <1> 	mov al, "@"
    82 000000DD E81401              <1> 	call char
    83 000000E0 8A0E[7053]          <1> 	mov cl, [bitsperpixel]
    84 000000E4 E8A000              <1> 	call decshow
    85 000000E7 BE[A800]            <1> 	mov si, isthisvideook
    86 000000EA E88200              <1> 	call printrm
    87 000000ED B80000              <1> 	mov ax, 0
    88 000000F0 CD16                <1> 	int 16h
    89 000000F2 8B36[3400]          <1> 	mov si, [videomodecache]
    90 000000F6 3C79                <1> 	cmp al, "y"
    91 000000F8 0F8572FF            <1> 	jne near nextvmode
    92 000000FC 8B16[6953]          <1> 	mov dx, [xresolution]
    93 00000100 8B0E[6B53]          <1> 	mov cx, [yresolution]
    94 00000104 8916[993B]          <1> 	mov [resolutionx], dx
    95 00000108 890E[973B]          <1> 	mov [resolutiony], cx
    96 0000010C 01D2                <1> 	add dx, dx
    97 0000010E 8916[9B3B]          <1> 	mov [resolutionx2], dx
    98 00000112 BA0000              <1> 	mov dx, 0
    99 00000115 B90000              <1> 	mov cx, 0
   100 00000118 B8024F              <1> 	mov ax, 04F02h
   101 0000011B 8B1E[3200]          <1> 	mov bx, [vesamode]
   102 0000011F CD10                <1> 	int 10h		;;enter VESA mode
   103 00000121 C606[6E01]00        <1> 	mov byte [guinodo], 0
   104 00000126 6631C0              <1> 	xor eax, eax
   105 00000129 6631DB              <1> 	xor ebx, ebx
   106 0000012C 6631C9              <1> 	xor ecx, ecx
   107 0000012F 6631D2              <1> 	xor edx, edx
   108 00000132 6631F6              <1> 	xor esi, esi
   109 00000135 6631FF              <1> 	xor edi, edi	;;reset registers
   110 00000138 E94501              <1> 	jmp pmode
   111                              <1> guiload2:
   112 0000013B B9E001              <1> 	mov cx, 480
   113 0000013E BA8002              <1> 	mov dx, 640
   114 00000141 8916[993B]          <1> 	mov [resolutionx], dx
   115 00000145 01D2                <1> 	add dx, dx
   116 00000147 8916[9B3B]          <1> 	mov [resolutionx2], dx
   117 0000014B 890E[973B]          <1> 	mov [resolutiony], cx
   118 0000014F B81200              <1> 	mov ax, 12h
   119 00000152 BB0000              <1> 	mov bx, 0
   120 00000155 CD10                <1> 	int 10h
   121 00000157 C606[6E01]01        <1> 	mov byte [guinodo], 1
   122 0000015C 6631DB              <1> 	xor ebx, ebx
   123 0000015F 6631C9              <1> 	xor ecx, ecx
   124 00000162 6631D2              <1> 	xor edx, edx
   125 00000165 6631F6              <1> 	xor esi, esi
   126 00000168 6631FF              <1> 	xor edi, edi
   127 0000016B E91201              <1> 	jmp pmode
   128                              <1> ;;	jmp gui ;;test vesa
   129                              <1> 
   130 0000016E 00                  <1> guinodo db 0
   131                              <1> 
   132                              <1>     printrm:			; 'si' comes in with string address
   133 0000016F BB0700              <1> 	    mov bx,07		; write to display
   134 00000172 B40E                <1> 	    mov ah,0Eh		; screen function
   135 00000174 8A04                <1>     prs2:    mov al,[si]         ; get next character
   136 00000176 3C00                <1> 	    cmp al,0		; look for terminator 
   137 00000178 7405                <1>             je finpr2		; zero byte at end of string
   138 0000017A CD10                <1> 	    int 10h		; write character to screen.    
   139 0000017C 46                  <1>      	    inc si	     	; move to next character
   140 0000017D EBF5                <1> 	    jmp prs2		; loop
   141 0000017F C3                  <1>     finpr2: ret
   142                              <1> 
   143 00000180 0000000000          <1> dcnm db 0,0,0,0,0
   144 00000185 0000                <1> dcnmend db 0,0
   145                              <1> 
   146                              <1> 
   147                              <1> decshow:
   148 00000187 BE[8001]            <1> 	mov si, dcnm
   149                              <1> decclear:
   150 0000018A B030                <1> 	mov al, "0"
   151 0000018C 8804                <1> 	mov [si], al
   152 0000018E 46                  <1> 	inc si
   153 0000018F 81FE[8501]          <1> 	cmp si, dcnmend
   154 00000193 76F5                <1> 	jbe decclear
   155 00000195 4E                  <1> 	dec si
   156 00000196 E81500              <1> 	call convertrm
   157 00000199 BE[8001]            <1> 	mov si, dcnm
   158                              <1> dectst:
   159 0000019C 8A04                <1> 	mov al, [si]
   160 0000019E 46                  <1> 	inc si
   161 0000019F 81FE[8501]          <1> 	cmp si, dcnmend
   162 000001A3 7704                <1> 	ja dectstend
   163 000001A5 3C30                <1> 	cmp al, "0"
   164 000001A7 76F3                <1> 	jbe dectst
   165                              <1> dectstend:
   166 000001A9 4E                  <1> 	dec si
   167 000001AA E8C2FF              <1> 	call printrm
   168 000001AD C3                  <1> 	ret
   169                              <1> 	
   170                              <1> 	
   171                              <1> convertrm:
   172 000001AE 4E                  <1> 	dec si
   173 000001AF 89F3                <1> 	mov bx, si		;place to convert into must be in si, number to convert must be in cx
   174                              <1> cnvrtrm:
   175 000001B1 89DE                <1> 	mov si, bx
   176 000001B3 81EE0300            <1> 	sub si, 3
   177 000001B7 46                  <1> ten3rm:	inc si
   178 000001B8 81F9E803            <1> 	cmp cx, 1000
   179 000001BC 7208                <1> 	jb ten2rm
   180 000001BE 81E9E803            <1> 	sub cx, 1000
   181 000001C2 FE04                <1> 	inc byte [si]
   182 000001C4 EBEB                <1> 	jmp cnvrtrm
   183 000001C6 46                  <1> ten2rm:	inc si
   184 000001C7 81F96400            <1> 	cmp cx, 100
   185 000001CB 7208                <1> 	jb ten1rm
   186 000001CD 81E96400            <1> 	sub cx, 100
   187 000001D1 FE04                <1> 	inc byte [si]
   188 000001D3 EBDC                <1> 	jmp cnvrtrm
   189 000001D5 46                  <1> ten1rm:	inc si
   190 000001D6 81F90A00            <1> 	cmp cx, 10
   191 000001DA 7208                <1> 	jb ten0rm
   192 000001DC 81E90A00            <1> 	sub cx, 10
   193 000001E0 FE04                <1> 	inc byte [si]
   194 000001E2 EBCD                <1> 	jmp cnvrtrm
   195 000001E4 46                  <1> ten0rm:	inc si
   196 000001E5 81F90100            <1> 	cmp cx, 1
   197 000001E9 7208                <1> 	jb tendnrm
   198 000001EB 81E90100            <1> 	sub cx, 1
   199 000001EF FE04                <1> 	inc byte [si]
   200 000001F1 EBBE                <1> 	jmp cnvrtrm
   201                              <1> tendnrm:
   202 000001F3 C3                  <1> 	ret
   203                              <1> 
   204                              <1> 
   205                              <1> 
   206                              <1> 
   207                              <1>     char: 		    ;char must be in al
   208 000001F4 BB0700              <1>            mov bx, 07
   209 000001F7 B40E                <1> 	   mov ah, 0Eh
   210 000001F9 CD10                <1> 	   int 10h
   211 000001FB C3                  <1> 	    ret
   212                              <1> 
   213                              <1> 		shutdown:
   214 000001FC 0F20C0              <1> 			   mov eax, cr0
   215 000001FF 24FE                <1> 			   and al,0xFE     ; back to realmode
   216 00000201 0F22C0              <1> 			   mov  cr0, eax   ; by toggling bit again
   217 00000204 FB                  <1> 			   sti
   218 00000205 B80053              <1> 			MOV AX, 5300h	; Shuts down APM-Machines.
   219 00000208 31DB                <1> 			XOR BX, BX	; Newer machines automatically
   220 0000020A CD15                <1> 			INT 15h		; shut down
   221 0000020C B80453              <1> 			MOV AX, 5304h
   222 0000020F 31DB                <1> 			XOR BX, BX
   223 00000211 CD15                <1> 			INT 15h		; Interrupt 15h originally was
   224 00000213 B80153              <1> 			MOV AX, 5301h	; used for Cartridges (cassettes)
   225 00000216 31DB                <1> 			XOR BX, BX	; but is still in use for
   226 00000218 CD15                <1> 			INT 15h		; diverse things
   227 0000021A B80753              <1> 			MOV AX, 5307h
   228 0000021D BB0100              <1> 			MOV BX, 1
   229 00000220 B90300              <1> 			MOV CX, 3
   230 00000223 CD15                <1> 			INT 15h
   231 00000225 CF                  <1> 			IRET
   232                              <1> 
   233                              <1> 	coldboot:
   234 00000226 0F20C0              <1> 			   mov eax, cr0
   235 00000229 24FE                <1> 			   and al,0xFE     ; back to realmode
   236 0000022B 0F22C0              <1> 			   mov  cr0, eax   ; by toggling bit again
   237 0000022E FB                  <1> 			   sti
   238 0000022F B84000              <1> 			MOV AX, 0040h
   239 00000232 8EC0                <1> 			MOV ES, AX
   240 00000234 26C70672000000      <1> 			MOV WORD [ES:00072h], 0h
   241 0000023B EA0000FFFF          <1> 			JMP 0FFFFh:0000h
   242 00000240 CF                  <1> 			IRET
   243                              <1> 
   244                              <1> 		warmboot:
   245 00000241 E81200              <1> 			call realmode
   246 00000244 B84000              <1> 			MOV AX, 0040h
   247 00000247 8EC0                <1> 			MOV ES, AX
   248 00000249 26C70672003412      <1> 			MOV WORD [ES:00072h], 01234h
   249 00000250 EA0000FFFF          <1> 			JMP 0FFFFh:0000h
   250 00000255 CF                  <1> 			IRET
   251                              <1> 
   252                              <1> 
   253                              <1> realmode:
   254 00000256 0F20C0              <1>    mov eax, cr0
   255 00000259 24FE                <1>    and al,0xFE     ; back to realmode
   256 0000025B 0F22C0              <1>    mov  cr0, eax   ; by toggling bit again
   257 0000025E FB                  <1>    sti
   258 0000025F 66B800000000        <1>    mov eax, 0
   259 00000265 C3                  <1>    ret
   260                              <1>    
   261 00000266 426F6F7420696E746F- <1> bootmsg:	db "Boot into the GUI?(y/n)",10,13,0
   262 0000026F 20746865204755493F- <1>
   263 00000278 28792F6E290A0D00    <1>
   264                                      %include 'source/pmode.asm'
   265                              <1> [BITS 16]
   266                              <1> ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
   267                              <1> ;	16-bit real mode
   268                              <1> ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
   269                              <1> 
   270                              <1> pmode:
   271 00000280 BA9200              <1> 	mov dx, 0x92
   272 00000283 EC                  <1> 	in al, dx	;;A20
   273 00000284 0C02                <1> 	or al, 2
   274 00000286 EE                  <1> 	out dx, al
   275 00000287 6631DB              <1> 	xor ebx,ebx
   276 0000028A 8CCB                <1> 	mov bx,cs		; EBX=segment
   277 0000028C 66C1E304            <1> 	shl ebx,4		;	<< 4
   278 00000290 67668D03            <1> 	lea eax,[ebx]		; EAX=linear address of segment base
   279 00000294 A3[5507]            <1> 	mov [gdt2 + 2],ax
   280 00000297 A3[5D07]            <1> 	mov [gdt3 + 2],ax
   281 0000029A 66C1E810            <1> 	shr eax,16
   282 0000029E A2[5707]            <1> 	mov [gdt2 + 4],al
   283 000002A1 A2[5F07]            <1> 	mov [gdt3 + 4],al
   284 000002A4 8826[5A07]          <1> 	mov [gdt2 + 7],ah
   285 000002A8 8826[6207]          <1> 	mov [gdt3 + 7],ah
   286 000002AC 66B8[00000000]      <1> 	mov eax, stack
   287 000002B2 A3[6507]            <1> 	mov [gdts + 2],ax
   288 000002B5 66C1E810            <1> 	shr eax,16
   289 000002B9 A2[6707]            <1> 	mov [gdts + 4],al
   290 000002BC 8826[6A07]          <1> 	mov [gdts + 7],ah
   291                              <1> ; fix up gdt and idt
   292 000002C0 67668D83[43070000]  <1> 	lea eax,[ebx + gdt]	; EAX=linear address of gdt
   293 000002C8 66A3[3907]          <1> 	mov [gdtr + 2],eax
   294 000002CC 67668D83[70070000]  <1> 	lea eax,[ebx + idt]	; EAX=linear address of idt
   295 000002D4 66A3[3F07]          <1> 	mov [idtr + 2],eax
   296 000002D8 FA                  <1> 	cli
   297 000002D9 0F0116[3707]        <1> 	lgdt [gdtr]
   298 000002DE 0F011E[3D07]        <1> 	lidt [idtr]
   299 000002E3 66BB00000000        <1> 	mov ebx, 0
   300 000002E9 8CDB                <1> 	mov bx, ds
   301 000002EB 66891E[6A03]        <1> 	mov [basecache], ebx
   302 000002F0 0F20C0              <1> 	mov eax,cr0
   303 000002F3 0C01                <1> 	or al,1
   304 000002F5 0F22C0              <1> 	mov cr0,eax
   305 000002F8 EA[FD02]1000        <1> 	jmp SYS_CODE_SEL:do_pm
   306                              <1> [BITS 32]
   307                              <1> do_pm:
   308 000002FD 66B81800            <1> 	mov ax, SYS_DATA_SEL
   309 00000301 8ED8                <1> 	mov ds,ax
   310 00000303 66B82000            <1> 	mov ax, STACK_SEL
   311 00000307 8ED0                <1> 	mov ss, ax
   312 00000309 BC00100000          <1> 	mov esp, 4096
   313 0000030E 90                  <1> 	nop
   314 0000030F 90                  <1> 	nop
   315 00000310 66B81800            <1> 	mov ax, SYS_DATA_SEL
   316 00000314 8EC0                <1> 	mov es,ax
   317 00000316 8EE0                <1> 	mov fs,ax
   318 00000318 8EE8                <1> 	mov gs,ax
   319 0000031A B800000000          <1> 	mov eax, 0
   320 0000031F BE[00000000]        <1> 	mov esi, bssstart
   321                              <1> clearkernelbuffers:
   322 00000324 8906                <1> 	mov [esi], eax
   323 00000326 81C604000000        <1> 	add esi, 4
   324 0000032C 81FE[33540000]      <1> 	cmp esi, bssend
   325 00000332 72F0                <1> 	jb clearkernelbuffers
   326                              <1> user1:
   327 00000334 8B3D[7F530000]      <1> 	mov edi, [physbaseptr]
   328 0000033A A1[6A030000]        <1> 	mov eax, [basecache]
   329 0000033F C1E004              <1> 	shl eax, 4
   330 00000342 29C7                <1> 	sub edi, eax
   331 00000344 893D[7F530000]      <1> 	mov [physbaseptr], edi
   332 0000034A E8AC130000          <1> 	call indexfiles
   333 0000034F 803D[6E010000]00    <1> 	cmp byte [guinodo], 0
   334 00000356 0F8405000000        <1> 	je near guido
   335 0000035C E9660C0000          <1> 	jmp os
   336                              <1> 	
   337                              <1> guido:
   338 00000361 E975280000          <1> 	jmp gui
   339                              <1> 	
   340 00000366 00000000            <1> user2codepoint dw 0,0
   341 0000036A 00000000            <1> basecache dd 0
   342                              <1> 
   343                              <1> unhand:	
   344                              <1> 	%assign i 0
   345                              <1> 	%rep 40
   346                              <1> 	cli
   347                              <1> 	mov byte [intprob], i
   348                              <1> 	jmp unhand2
   349                              <1> 	%assign i i+1
   350                              <1> 	%endrep
   351 0000036E FA                  <2>  cli
   352 0000036F C605[73060000]00    <2>  mov byte [intprob], i
   353 00000376 E9FB010000          <2>  jmp unhand2
   354                              <2>  %assign i i+1
   355 0000037B FA                  <2>  cli
   356 0000037C C605[73060000]01    <2>  mov byte [intprob], i
   357 00000383 E9EE010000          <2>  jmp unhand2
   358                              <2>  %assign i i+1
   359 00000388 FA                  <2>  cli
   360 00000389 C605[73060000]02    <2>  mov byte [intprob], i
   361 00000390 E9E1010000          <2>  jmp unhand2
   362                              <2>  %assign i i+1
   363 00000395 FA                  <2>  cli
   364 00000396 C605[73060000]03    <2>  mov byte [intprob], i
   365 0000039D E9D4010000          <2>  jmp unhand2
   366                              <2>  %assign i i+1
   367 000003A2 FA                  <2>  cli
   368 000003A3 C605[73060000]04    <2>  mov byte [intprob], i
   369 000003AA E9C7010000          <2>  jmp unhand2
   370                              <2>  %assign i i+1
   371 000003AF FA                  <2>  cli
   372 000003B0 C605[73060000]05    <2>  mov byte [intprob], i
   373 000003B7 E9BA010000          <2>  jmp unhand2
   374                              <2>  %assign i i+1
   375 000003BC FA                  <2>  cli
   376 000003BD C605[73060000]06    <2>  mov byte [intprob], i
   377 000003C4 E9AD010000          <2>  jmp unhand2
   378                              <2>  %assign i i+1
   379 000003C9 FA                  <2>  cli
   380 000003CA C605[73060000]07    <2>  mov byte [intprob], i
   381 000003D1 E9A0010000          <2>  jmp unhand2
   382                              <2>  %assign i i+1
   383 000003D6 FA                  <2>  cli
   384 000003D7 C605[73060000]08    <2>  mov byte [intprob], i
   385 000003DE E993010000          <2>  jmp unhand2
   386                              <2>  %assign i i+1
   387 000003E3 FA                  <2>  cli
   388 000003E4 C605[73060000]09    <2>  mov byte [intprob], i
   389 000003EB E986010000          <2>  jmp unhand2
   390                              <2>  %assign i i+1
   391 000003F0 FA                  <2>  cli
   392 000003F1 C605[73060000]0A    <2>  mov byte [intprob], i
   393 000003F8 E979010000          <2>  jmp unhand2
   394                              <2>  %assign i i+1
   395 000003FD FA                  <2>  cli
   396 000003FE C605[73060000]0B    <2>  mov byte [intprob], i
   397 00000405 E96C010000          <2>  jmp unhand2
   398                              <2>  %assign i i+1
   399 0000040A FA                  <2>  cli
   400 0000040B C605[73060000]0C    <2>  mov byte [intprob], i
   401 00000412 E95F010000          <2>  jmp unhand2
   402                              <2>  %assign i i+1
   403 00000417 FA                  <2>  cli
   404 00000418 C605[73060000]0D    <2>  mov byte [intprob], i
   405 0000041F E952010000          <2>  jmp unhand2
   406                              <2>  %assign i i+1
   407 00000424 FA                  <2>  cli
   408 00000425 C605[73060000]0E    <2>  mov byte [intprob], i
   409 0000042C E945010000          <2>  jmp unhand2
   410                              <2>  %assign i i+1
   411 00000431 FA                  <2>  cli
   412 00000432 C605[73060000]0F    <2>  mov byte [intprob], i
   413 00000439 E938010000          <2>  jmp unhand2
   414                              <2>  %assign i i+1
   415 0000043E FA                  <2>  cli
   416 0000043F C605[73060000]10    <2>  mov byte [intprob], i
   417 00000446 E92B010000          <2>  jmp unhand2
   418                              <2>  %assign i i+1
   419 0000044B FA                  <2>  cli
   420 0000044C C605[73060000]11    <2>  mov byte [intprob], i
   421 00000453 E91E010000          <2>  jmp unhand2
   422                              <2>  %assign i i+1
   423 00000458 FA                  <2>  cli
   424 00000459 C605[73060000]12    <2>  mov byte [intprob], i
   425 00000460 E911010000          <2>  jmp unhand2
   426                              <2>  %assign i i+1
   427 00000465 FA                  <2>  cli
   428 00000466 C605[73060000]13    <2>  mov byte [intprob], i
   429 0000046D E904010000          <2>  jmp unhand2
   430                              <2>  %assign i i+1
   431 00000472 FA                  <2>  cli
   432 00000473 C605[73060000]14    <2>  mov byte [intprob], i
   433 0000047A E9F7000000          <2>  jmp unhand2
   434                              <2>  %assign i i+1
   435 0000047F FA                  <2>  cli
   436 00000480 C605[73060000]15    <2>  mov byte [intprob], i
   437 00000487 E9EA000000          <2>  jmp unhand2
   438                              <2>  %assign i i+1
   439 0000048C FA                  <2>  cli
   440 0000048D C605[73060000]16    <2>  mov byte [intprob], i
   441 00000494 E9DD000000          <2>  jmp unhand2
   442                              <2>  %assign i i+1
   443 00000499 FA                  <2>  cli
   444 0000049A C605[73060000]17    <2>  mov byte [intprob], i
   445 000004A1 E9D0000000          <2>  jmp unhand2
   446                              <2>  %assign i i+1
   447 000004A6 FA                  <2>  cli
   448 000004A7 C605[73060000]18    <2>  mov byte [intprob], i
   449 000004AE E9C3000000          <2>  jmp unhand2
   450                              <2>  %assign i i+1
   451 000004B3 FA                  <2>  cli
   452 000004B4 C605[73060000]19    <2>  mov byte [intprob], i
   453 000004BB E9B6000000          <2>  jmp unhand2
   454                              <2>  %assign i i+1
   455 000004C0 FA                  <2>  cli
   456 000004C1 C605[73060000]1A    <2>  mov byte [intprob], i
   457 000004C8 E9A9000000          <2>  jmp unhand2
   458                              <2>  %assign i i+1
   459 000004CD FA                  <2>  cli
   460 000004CE C605[73060000]1B    <2>  mov byte [intprob], i
   461 000004D5 E99C000000          <2>  jmp unhand2
   462                              <2>  %assign i i+1
   463 000004DA FA                  <2>  cli
   464 000004DB C605[73060000]1C    <2>  mov byte [intprob], i
   465 000004E2 E98F000000          <2>  jmp unhand2
   466                              <2>  %assign i i+1
   467 000004E7 FA                  <2>  cli
   468 000004E8 C605[73060000]1D    <2>  mov byte [intprob], i
   469 000004EF E982000000          <2>  jmp unhand2
   470                              <2>  %assign i i+1
   471 000004F4 FA                  <2>  cli
   472 000004F5 C605[73060000]1E    <2>  mov byte [intprob], i
   473 000004FC E975000000          <2>  jmp unhand2
   474                              <2>  %assign i i+1
   475 00000501 FA                  <2>  cli
   476 00000502 C605[73060000]1F    <2>  mov byte [intprob], i
   477 00000509 E968000000          <2>  jmp unhand2
   478                              <2>  %assign i i+1
   479 0000050E FA                  <2>  cli
   480 0000050F C605[73060000]20    <2>  mov byte [intprob], i
   481 00000516 E95B000000          <2>  jmp unhand2
   482                              <2>  %assign i i+1
   483 0000051B FA                  <2>  cli
   484 0000051C C605[73060000]21    <2>  mov byte [intprob], i
   485 00000523 E94E000000          <2>  jmp unhand2
   486                              <2>  %assign i i+1
   487 00000528 FA                  <2>  cli
   488 00000529 C605[73060000]22    <2>  mov byte [intprob], i
   489 00000530 E941000000          <2>  jmp unhand2
   490                              <2>  %assign i i+1
   491 00000535 FA                  <2>  cli
   492 00000536 C605[73060000]23    <2>  mov byte [intprob], i
   493 0000053D E934000000          <2>  jmp unhand2
   494                              <2>  %assign i i+1
   495 00000542 FA                  <2>  cli
   496 00000543 C605[73060000]24    <2>  mov byte [intprob], i
   497 0000054A E927000000          <2>  jmp unhand2
   498                              <2>  %assign i i+1
   499 0000054F FA                  <2>  cli
   500 00000550 C605[73060000]25    <2>  mov byte [intprob], i
   501 00000557 E91A000000          <2>  jmp unhand2
   502                              <2>  %assign i i+1
   503 0000055C FA                  <2>  cli
   504 0000055D C605[73060000]26    <2>  mov byte [intprob], i
   505 00000564 E90D000000          <2>  jmp unhand2
   506                              <2>  %assign i i+1
   507 00000569 FA                  <2>  cli
   508 0000056A C605[73060000]27    <2>  mov byte [intprob], i
   509 00000571 E900000000          <2>  jmp unhand2
   510                              <2>  %assign i i+1
   511                              <1> unhand2:
   512 00000576 60                  <1> 	pushad
   513 00000577 C705[66030000]0000- <1> 	mov dword [user2codepoint], 0
   514 0000057F 0000                <1>
   515 00000581 89E6                <1> 	mov esi, esp
   516 00000583 81C628000000        <1> 	add esi, ((unhndrgend - unhndrg)/13)*4
   517 00000589 8935[69060000]      <1> 	mov [esploc], esi
   518 0000058F BE[74060000]        <1> 	mov esi, unhandmsg
   519 00000594 8935[6D060000]      <1> 	mov [esiloc], esi
   520 0000059A B900000000          <1> 	mov ecx, 0
   521 0000059F 8A0D[73060000]      <1> 	mov cl, [intprob]
   522 000005A5 E85A000000          <1> 	call expdump
   523                              <1> dumpstack:
   524 000005AA 8B35[69060000]      <1> 	mov esi, [esploc]
   525 000005B0 39E6                <1> 	cmp esi, esp
   526 000005B2 7216                <1> 	jb donedump
   527 000005B4 368B0E              <1> 	mov ecx, [ss:esi]
   528 000005B7 81EE04000000        <1> 	sub esi, 4
   529 000005BD 8935[69060000]      <1> 	mov [esploc], esi
   530 000005C3 E83C000000          <1> 	call expdump
   531 000005C8 EBE0                <1> 	jmp dumpstack
   532                              <1> donedump:
   533 000005CA 8B35[69060000]      <1> 	mov esi, [esploc]
   534 000005D0 368B7C2420          <1> 	mov edi, [ss:esp + 32]
   535 000005D5 8B4FFC              <1> 	mov ecx, [edi - 4]
   536 000005D8 E827000000          <1> 	call expdump
   537 000005DD 8B35[69060000]      <1> 	mov esi, [esploc]
   538 000005E3 368B7C2420          <1> 	mov edi, [ss:esp + 32]
   539 000005E8 8B0F                <1> 	mov ecx, [edi]
   540 000005EA E815000000          <1> 	call expdump
   541 000005EF 8B35[69060000]      <1> 	mov esi, [esploc]
   542 000005F5 368B7C2420          <1> 	mov edi, [ss:esp + 32]
   543 000005FA 8B4F04              <1> 	mov ecx, [edi + 4]
   544 000005FD E802000000          <1> 	call expdump
   545 00000602 EBFE                <1> 	jmp $
   546                              <1> expdump:
   547 00000604 8B35[6D060000]      <1> 	mov esi, [esiloc]
   548 0000060A 89F7                <1> 	mov edi, esi
   549 0000060C 81C70D000000        <1> 	add edi, 13
   550 00000612 81C604000000        <1> 	add esi, 4
   551 00000618 893D[6D060000]      <1> 	mov [esiloc], edi
   552 0000061E 4F                  <1> 	dec edi
   553 0000061F E8630E0000          <1> 	call converthex
   554 00000624 81EE04000000        <1> 	sub esi, 4
   555 0000062A 803D[352D0000]00    <1> 	cmp byte [guion], 0
   556 00000631 0F8422000000        <1> 	je near expdumptext
   557 00000637 668B0D[71060000]    <1> 	mov cx, [locunhand]
   558 0000063E 668105[71060000]10- <1> 	add word [locunhand], 16
   559 00000646 00                  <1>
   560 00000647 66BA0200            <1> 	mov dx, 2
   561 0000064B 66B80100            <1> 	mov ax, 1
   562 0000064F 66BB0000            <1> 	mov bx, 0
   563 00000653 E8AA300000          <1> 	call showstring
   564 00000658 C3                  <1> 	ret
   565                              <1> expdumptext:
   566 00000659 E826050000          <1> 	call print
   567 0000065E BE[11490000]        <1> 	mov esi, line
   568 00000663 E81C050000          <1> 	call print
   569 00000668 C3                  <1> 	ret
   570 00000669 00000000            <1> esploc dd 0
   571 0000066D 00000000            <1> esiloc dd 0
   572 00000671 0100                <1> locunhand dw 1
   573 00000673 00                  <1> intprob db 0
   574                              <1> 	unhandmsg:	
   575 00000674 494E543D3030303030- <1> 			db "INT=00000000",0
   576 0000067D 30303000            <1>
   577                              <1> unhndrg:
   578 00000681 45464C3D3030303030- <1> 			db "EFL=00000000",0
   579 0000068A 30303000            <1>
   580 0000068E 43533A3D3030303030- <1> 			db "CS:=00000000",0
   581 00000697 30303000            <1>
   582 0000069B 4549503D3030303030- <1> 			db "EIP=00000000",0
   583 000006A4 30303000            <1>
   584 000006A8 4541583D3030303030- <1> 			db "EAX=00000000",0
   585 000006B1 30303000            <1>
   586 000006B5 4543583D3030303030- <1> 			db "ECX=00000000",0
   587 000006BE 30303000            <1>
   588 000006C2 4544583D3030303030- <1> 			db "EDX=00000000",0
   589 000006CB 30303000            <1>
   590 000006CF 4542583D3030303030- <1> 			db "EBX=00000000",0
   591 000006D8 30303000            <1>
   592 000006DC 4553503D3030303030- <1> 			db "ESP=00000000",0
   593 000006E5 30303000            <1>
   594 000006E9 4542503D3030303030- <1> 			db "EBP=00000000",0
   595 000006F2 30303000            <1>
   596 000006F6 4553493D3030303030- <1> 			db "ESI=00000000",0
   597 000006FF 30303000            <1>
   598 00000703 4544493D3030303030- <1> unhndrgend:	db "EDI=00000000",0
   599 0000070C 30303000            <1>
   600 00000710 434D443D3030303030- <1> 			db "CMD=00000000",0
   601 00000719 30303000            <1>
   602 0000071D 434D443D3030303030- <1> 			db "CMD=00000000",0
   603 00000726 30303000            <1>
   604 0000072A 434D443D3030303030- <1> 			db "CMD=00000000",0
   605 00000733 30303000            <1>
   606                              <1> unhandmsgend:
   607                              <1> 
   608                              <1> [BITS 16]
   609                              <1> 
   610                              <1> ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
   611                              <1> ;	16-bit limit/32-bit linear base address of GDT and IDT
   612                              <1> ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
   613 00000737 2700                <1> gdtr:	dw gdt_end - gdt - 1	; GDT limit
   614 00000739 [43070000]          <1> 	dd gdt			; linear, physical address of GDT
   615                              <1> 
   616 0000073D 8701                <1> idtr:	dw idt_end - idt - 1	; IDT limit
   617 0000073F [70070000]          <1> 	dd idt			; linear, physical address of IDT
   618                              <1> 
   619                              <1> 
   620 00000743 0000                <1> gdt:	dw 0			; limit 15:0
   621 00000745 0000                <1> 	dw 0			; base 15:0
   622 00000747 00                  <1> 	db 0			; base 23:16
   623 00000748 00                  <1> 	db 0			; type
   624 00000749 00                  <1> 	db 0			; limit 19:16, flags
   625 0000074A 00                  <1> 	db 0			; base 31:24
   626                              <1> ; linear data segment descriptor
   627                              <1> LINEAR_SEL	equ	$-gdt
   628 0000074B FFFF                <1> 	dw 0xFFFF		; limit 0xFFFFF
   629 0000074D 0000                <1> 	dw 0			; base for this one is always 0
   630 0000074F 00                  <1> 	db 0
   631 00000750 92                  <1> 	db 0x92			; present, ring 0, data, expand-up, writable
   632 00000751 CF                  <1> 	db 0xCF			; page-granular, 32-bit
   633 00000752 00                  <1> 	db 0
   634                              <1> ; code segment descriptor
   635                              <1> SYS_CODE_SEL	equ	$-gdt
   636 00000753 FFFF                <1> gdt2:	dw 0xFFFF
   637 00000755 0000                <1> 	dw 0			; (base gets set above)
   638 00000757 00                  <1> 	db 0
   639 00000758 9A                  <1> 	db 0x9A			; present, ring 0, code, non-conforming, readable
   640 00000759 CF                  <1> 	db 0xCF
   641 0000075A 00                  <1> 	db 0
   642                              <1> ; data segment descriptor
   643                              <1> SYS_DATA_SEL	equ	$-gdt
   644 0000075B FFFF                <1> gdt3:	dw 0xFFFF
   645 0000075D 0000                <1> 	dw 0			; (base gets set above)
   646 0000075F 00                  <1> 	db 0
   647 00000760 92                  <1> 	db 0x92			; present, ring 0, data, expand-up, writable
   648 00000761 CF                  <1> 	db 0xCF
   649 00000762 00                  <1> 	db 0
   650                              <1> STACK_SEL	equ	$-gdt
   651 00000763 0100                <1> gdts:	dw 1
   652 00000765 0000                <1> 	dw 0			; (base gets set above)
   653 00000767 00                  <1> 	db 0
   654 00000768 92                  <1> 	db 0x92			; present, ring 0, data, expand-up, writable
   655 00000769 C0                  <1> 	db 0xC0
   656 0000076A 00                  <1> 	db 0
   657                              <1> gdt_end:
   658                              <1> ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
   659                              <1> ;	interrupt descriptor table (IDT)
   660                              <1> ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
   661                              <1> ; 32 reserved interrupts:
   662 0000076B 494454              <1> db "IDT"
   663 0000076E [6E03]              <1> dw unhand
   664                              <1> idt:	
   665                              <1> %assign i 0
   666                              <1> %rep    48
   667                              <1>         dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   668                              <1> %assign i i+1 
   669                              <1> %endrep
   670 00000770 [6E03]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   671                              <2> %assign i i+1
   672 00000778 [7B03]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   673                              <2> %assign i i+1
   674 00000780 [8803]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   675                              <2> %assign i i+1
   676 00000788 [9503]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   677                              <2> %assign i i+1
   678 00000790 [A203]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   679                              <2> %assign i i+1
   680 00000798 [AF03]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   681                              <2> %assign i i+1
   682 000007A0 [BC03]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   683                              <2> %assign i i+1
   684 000007A8 [C903]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   685                              <2> %assign i i+1
   686 000007B0 [D603]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   687                              <2> %assign i i+1
   688 000007B8 [E303]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   689                              <2> %assign i i+1
   690 000007C0 [F003]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   691                              <2> %assign i i+1
   692 000007C8 [FD03]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   693                              <2> %assign i i+1
   694 000007D0 [0A04]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   695                              <2> %assign i i+1
   696 000007D8 [1704]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   697                              <2> %assign i i+1
   698 000007E0 [2404]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   699                              <2> %assign i i+1
   700 000007E8 [3104]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   701                              <2> %assign i i+1
   702 000007F0 [3E04]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   703                              <2> %assign i i+1
   704 000007F8 [4B04]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   705                              <2> %assign i i+1
   706 00000800 [5804]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   707                              <2> %assign i i+1
   708 00000808 [6504]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   709                              <2> %assign i i+1
   710 00000810 [7204]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   711                              <2> %assign i i+1
   712 00000818 [7F04]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   713                              <2> %assign i i+1
   714 00000820 [8C04]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   715                              <2> %assign i i+1
   716 00000828 [9904]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   717                              <2> %assign i i+1
   718 00000830 [A604]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   719                              <2> %assign i i+1
   720 00000838 [B304]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   721                              <2> %assign i i+1
   722 00000840 [C004]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   723                              <2> %assign i i+1
   724 00000848 [CD04]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   725                              <2> %assign i i+1
   726 00000850 [DA04]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   727                              <2> %assign i i+1
   728 00000858 [E704]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   729                              <2> %assign i i+1
   730 00000860 [F404]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   731                              <2> %assign i i+1
   732 00000868 [0105]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   733                              <2> %assign i i+1
   734 00000870 [0E05]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   735                              <2> %assign i i+1
   736 00000878 [1B05]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   737                              <2> %assign i i+1
   738 00000880 [2805]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   739                              <2> %assign i i+1
   740 00000888 [3505]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   741                              <2> %assign i i+1
   742 00000890 [4205]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   743                              <2> %assign i i+1
   744 00000898 [4F05]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   745                              <2> %assign i i+1
   746 000008A0 [5C05]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   747                              <2> %assign i i+1
   748 000008A8 [6905]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   749                              <2> %assign i i+1
   750 000008B0 [7605]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   751                              <2> %assign i i+1
   752 000008B8 [8305]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   753                              <2> %assign i i+1
   754 000008C0 [9005]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   755                              <2> %assign i i+1
   756 000008C8 [9D05]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   757                              <2> %assign i i+1
   758 000008D0 [AA05]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   759                              <2> %assign i i+1
   760 000008D8 [B705]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   761                              <2> %assign i i+1
   762 000008E0 [C405]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   763                              <2> %assign i i+1
   764 000008E8 [D105]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   765                              <2> %assign i i+1
   766                              <1> ;;INT 30h for os use and 3rd party use:
   767 000008F0 [F808]1000008E0000  <1> 	dw newints,SYS_CODE_SEL,0x8E00,0
   768                              <1> idt_end:
   769                              <1> [BITS 32]
   770                                  [BITS 32]
   771                                      %include 'source/ints.asm'
   772                              <1> newints:	;;for great justice
   773 000008F8 80FC00              <1> 	cmp ah, 0		;;originally 0
   774 000008FB 0F8452000000        <1> 	je near intx0   ;;0=kills app
   775 00000901 80FC01              <1> 	cmp ah, 1		;;originally 1
   776 00000904 0F844E000000        <1> 	je near intx1   ;;3=print string
   777 0000090A 80FC02              <1> 	cmp ah, 2		;;originally 2
   778 0000090D 0F844B000000        <1> 	je near intx2	;;4=read string
   779 00000913 80FC03              <1> 	cmp ah, 3		;;originally 3
   780 00000916 0F8448000000        <1> 	je near intx3	;;6=clear screen
   781 0000091C 80FC04              <1> 	cmp ah, 4		;;originally 4
   782 0000091F 0F8445000000        <1> 	je near intx4	;;5=read and print string
   783 00000925 80FC05              <1> 	cmp ah, 5		;;originally 5		
   784 00000928 0F8442000000        <1> 	je near intx5	;;2=get char
   785 0000092E 80FC06              <1> 	cmp ah, 6		;;originally 6
   786 00000931 0F843F000000        <1> 	je near intx6	;;1=print char
   787 00000937 80FC07              <1> 	cmp ah, 7
   788 0000093A 0F843C000000        <1> 	je near intx7	;;read file
   789 00000940 80FC09              <1> 	cmp ah, 9
   790 00000943 0F8439000000        <1> 	je near intx9	;;convert number
   791 00000949 80FC0A              <1> 	cmp ah, 10
   792 0000094C 0F8440000000        <1> 	je near intx10	;;create thread
   793 00000952 C3                  <1> 	ret
   794                              <1> 	
   795                              <1> intx0:
   796 00000953 E989070000          <1> 	jmp nwcmd
   797                              <1> intx1:
   798 00000958 E82F020000          <1> 	call int303
   799 0000095D C3                  <1> 	ret
   800                              <1> intx2:
   801 0000095E E84C020000          <1> 	call int304
   802 00000963 C3                  <1> 	ret
   803                              <1> intx3:
   804 00000964 E80B050000          <1> 	call int306
   805 00000969 C3                  <1> 	ret
   806                              <1> intx4:
   807 0000096A E86D020000          <1> 	call int305
   808 0000096F C3                  <1> 	ret
   809                              <1> intx5:
   810 00000970 E8CE010000          <1> 	call int302
   811 00000975 C3                  <1> 	ret
   812                              <1> intx6:
   813 00000976 E822000000          <1> 	call int301
   814 0000097B C3                  <1> 	ret
   815                              <1> intx7:
   816 0000097C E8253D0000          <1> 	call loadfile
   817 00000981 C3                  <1> 	ret
   818                              <1> intx9:
   819 00000982 3C00                <1> 	cmp al, 0
   820 00000984 7506                <1> 	jne intx9B
   821 00000986 E84B0C0000          <1> 	call showdec
   822 0000098B C3                  <1> 	ret
   823                              <1> intx9B:
   824 0000098C E8A00B0000          <1> 	call showhex
   825 00000991 C3                  <1> 	ret
   826                              <1> intx10:
   827                              <1> ;	call thread
   828 00000992 C3                  <1> 	ret
   829                              <1> 	
   830 00000993 0000                <1> linebeginpos dw 0
   831 00000995 0000                <1> videobufpos: dw 0
   832 00000997 0000                <1> charpos db 0,0
   833 00000999 A01E                <1> charxy db 160,30
   834 0000099B 0000                <1> charbuf dw 0
   835                              <1> 
   836                              <1> int301:	;;print char, char in al, modifier in bl, will run videobuf2copy if called as is
   837 0000099D E807000000          <1> 	call int301prnt
   838 000009A2 E91C050000          <1> 	jmp termcopy
   839 000009A7 00                  <1> termguion db 0
   840 000009A8 00                  <1> termcopyon db 0
   841                              <1> int301prnt:
   842 000009A9 88DC                <1> 	mov ah, bl
   843 000009AB 66A3[9B090000]      <1> 	mov [charbuf], ax
   844 000009B1 BB00000000          <1> 	mov ebx, 0
   845 000009B6 668B1D[95090000]    <1> 	mov bx, [videobufpos]
   846 000009BD BF[8F1C0000]        <1> 	mov edi, videobuf2
   847 000009C2 01DF                <1> 	add edi, ebx
   848 000009C4 66A1[C10E0000]      <1> 	mov ax, [removedvideo]
   849 000009CA 668907              <1> 	mov [edi], ax
   850 000009CD 66A1[9B090000]      <1> 	mov ax, [charbuf]
   851 000009D3 BA00000000          <1> 	mov edx, 0
   852 000009D8 668B15[97090000]    <1> 	mov dx, [charpos]
   853 000009DF B900000000          <1> 	mov ecx, 0
   854 000009E4 668B0D[99090000]    <1> 	mov cx, [charxy]
   855 000009EB 3C0D                <1> 	cmp al, 13
   856 000009ED 0F8454000000        <1> 	je near int301cr
   857 000009F3 3C0A                <1> 	cmp al, 10
   858 000009F5 0F8482000000        <1> 	je near int301nl
   859 000009FB 3C08                <1> 	cmp al, 8
   860 000009FD 0F845B000000        <1> 	je near int301bs
   861 00000A03 668907              <1> 	mov [edi], ax
   862 00000A06 81C702000000        <1> 	add edi, 2
   863 00000A0C 80C202              <1> 	add dl, 2
   864                              <1> donecrnl:
   865 00000A0F 38CA                <1> 	cmp dl, cl
   866 00000A11 0F8397000000        <1> 	jae near int301eol
   867                              <1> doneeol:
   868 00000A17 38EE                <1> 	cmp dh, ch
   869 00000A19 0F83AD000000        <1> 	jae near int301scr	
   870                              <1> donescr:
   871 00000A1F 89FB                <1> 	mov ebx, edi
   872 00000A21 668B07              <1> 	mov ax, [edi]
   873 00000A24 66A3[C10E0000]      <1> 	mov [removedvideo], ax
   874 00000A2A 81EB[8F1C0000]      <1> 	sub ebx, videobuf2
   875 00000A30 66891D[95090000]    <1> 	mov [videobufpos], bx
   876 00000A37 668915[97090000]    <1> 	mov [charpos], dx
   877 00000A3E 66A1[9B090000]      <1> 	mov ax, [charbuf]
   878 00000A44 88E3                <1> 	mov bl, ah
   879 00000A46 C3                  <1> 	ret
   880                              <1> 	
   881                              <1> 	int301cr:
   882 00000A47 B200                <1> 		mov dl, 0
   883 00000A49 BB00000000          <1> 		mov ebx, 0
   884 00000A4E BF[8F1C0000]        <1> 		mov edi, videobuf2
   885 00000A53 668B1D[93090000]    <1> 		mov bx, [linebeginpos]
   886 00000A5A 01DF                <1> 		add edi, ebx
   887 00000A5C EBB1                <1> 		jmp donecrnl
   888                              <1> 			
   889                              <1> 	int301bs:
   890 00000A5E 80FA00              <1> 		cmp dl, 0
   891 00000A61 740F                <1> 		je int301backline
   892                              <1> 	int301nobmr:
   893 00000A63 80EA02              <1> 		sub dl, 2
   894 00000A66 66B80000            <1> 		mov ax, 0
   895 00000A6A 81EF02000000        <1> 		sub edi, 2
   896 00000A70 EB9D                <1> 		jmp donecrnl
   897                              <1> 	int301backline:
   898 00000A72 88CA                <1> 		mov dl, cl
   899 00000A74 80FE00              <1> 		cmp dh, 0
   900 00000A77 74EA                <1> 		je int301nobmr
   901 00000A79 FECE                <1> 		dec dh
   902 00000A7B EBE6                <1> 		jmp int301nobmr
   903                              <1> 		
   904                              <1> 	int301nl:
   905 00000A7D FEC6                <1> 		inc dh
   906 00000A7F BB00000000          <1> 		mov ebx, 0
   907 00000A84 88CB                <1> 		mov bl, cl
   908 00000A86 BF[8F1C0000]        <1> 		mov edi, videobuf2
   909 00000A8B 66031D[95090000]    <1> 		add bx, [videobufpos]
   910 00000A92 01DF                <1> 		add edi, ebx
   911 00000A94 BB00000000          <1> 		mov ebx, 0
   912 00000A99 88CB                <1> 		mov bl, cl
   913 00000A9B 66031D[93090000]    <1> 		add bx, [linebeginpos]
   914 00000AA2 66891D[93090000]    <1> 		mov [linebeginpos], bx
   915 00000AA9 E961FFFFFF          <1> 		jmp donecrnl
   916                              <1> 		
   917                              <1> 	int301eol:
   918 00000AAE B200                <1> 		mov dl, 0
   919 00000AB0 FEC6                <1> 		inc dh
   920 00000AB2 BB00000000          <1> 		mov ebx, 0
   921 00000AB7 88CB                <1> 		mov bl, cl
   922 00000AB9 66031D[93090000]    <1> 		add bx, [linebeginpos]
   923 00000AC0 66891D[93090000]    <1> 		mov [linebeginpos], bx
   924 00000AC7 E94BFFFFFF          <1> 		jmp doneeol
   925                              <1> 	int301scr:
   926 00000ACC FECE                <1> 		dec dh
   927 00000ACE BF[8F1C0000]        <1> 		mov edi, videobuf2
   928 00000AD3 BB00000000          <1> 		mov ebx, 0
   929 00000AD8 88CB                <1> 		mov bl, cl
   930 00000ADA 01FB                <1> 		add ebx, edi
   931                              <1> 	intscrollloop:
   932 00000ADC 668B03              <1> 		mov ax, [ebx]
   933 00000ADF 668907              <1> 		mov [edi], ax
   934 00000AE2 81C702000000        <1> 		add edi, 2
   935 00000AE8 81C302000000        <1> 		add ebx, 2
   936 00000AEE 80E902              <1> 		sub cl, 2
   937 00000AF1 80F900              <1> 		cmp cl, 0
   938 00000AF4 75E6                <1> 		jne intscrollloop
   939 00000AF6 8A0D[99090000]      <1> 		mov cl, [charxy]
   940 00000AFC FECD                <1> 		dec ch
   941 00000AFE 80FD01              <1> 		cmp ch, 1
   942 00000B01 77D9                <1> 		ja intscrollloop
   943 00000B03 66B80000            <1> 		mov ax, 0
   944 00000B07 81EF[8F1C0000]      <1> 		sub edi, videobuf2
   945 00000B0D 66893D[93090000]    <1> 		mov [linebeginpos], di
   946 00000B14 81C7[8F1C0000]      <1> 		add edi, videobuf2
   947 00000B1A 89FB                <1> 		mov ebx, edi
   948                              <1> 	intloopclear:
   949 00000B1C 668903              <1> 		mov [ebx], ax
   950 00000B1F 81C302000000        <1> 		add ebx, 2
   951 00000B25 80E902              <1> 		sub cl, 2
   952 00000B28 80F900              <1> 		cmp cl, 0
   953 00000B2B 75EF                <1> 		jne intloopclear
   954 00000B2D FECD                <1> 		dec ch
   955 00000B2F 80FD00              <1> 		cmp ch, 0
   956 00000B32 75E8                <1> 		jne intloopclear
   957 00000B34 668B0D[99090000]    <1> 		mov cx, [charxy]
   958 00000B3B E9DFFEFFFF          <1> 		jmp donescr
   959                              <1> 		
   960                              <1> 		
   961 00000B40 0000                <1> lastkey db 0,0
   962 00000B42 00                  <1> trans db 0
   963                              <1> 
   964                              <1> 	int302:		;;get char, if al is 0, wait for key
   965 00000B43 A2[420B0000]        <1> 		mov [trans], al
   966                              <1> 	transcheck:
   967 00000B48 E86D1C0000          <1> 		call guistartin
   968 00000B4D 8A3D[420B0000]      <1> 		mov bh, [trans]
   969 00000B53 66A1[400B0000]      <1> 		mov ax, [lastkey]
   970 00000B59 80FC1C              <1> 		cmp ah, 1Ch
   971 00000B5C 7414                <1> 		je int302enter
   972 00000B5E 3CE0                <1> 		cmp al, 0xE0
   973 00000B60 7504                <1> 		jne nospecialtrans
   974 00000B62 88C3                <1> 		mov bl, al
   975 00000B64 B000                <1> 		mov al, 0
   976                              <1> 	nospecialtrans:
   977 00000B66 08C7                <1> 		or bh, al
   978 00000B68 80FF00              <1> 		cmp bh, 0
   979 00000B6B 74DB                <1> 		je transcheck
   980 00000B6D E902000000          <1> 		jmp int302end
   981                              <1> 	int302enter:
   982 00000B72 B00D                <1> 		mov al, 13
   983                              <1> 	int302end:
   984 00000B74 C3                  <1> 		ret
   985                              <1> 	
   986 00000B75 00                  <1> endkey303 db 0
   987                              <1> 	printquiet:
   988 00000B76 66B80000            <1> 		mov ax, 0
   989 00000B7A 66BB0700            <1> 		mov bx, 7
   990 00000B7E E818000000          <1> 		call int303b
   991 00000B83 C3                  <1> 		ret
   992                              <1>     print:
   993 00000B84 66B80000            <1> 		mov ax, 0
   994 00000B88 66BB0700            <1> 		mov bx, 7
   995                              <1> 	int303:	;;print line, al=last key,bl=modifier, esi=buffer
   996 00000B8C A2[750B0000]        <1> 		mov [endkey303], al
   997 00000B91 E805000000          <1> 		call int303b
   998 00000B96 E928030000          <1> 		jmp termcopy
   999                              <1> 	int303b:
  1000 00000B9B 8A06                <1> 		mov al, [esi]
  1001 00000B9D 3A05[750B0000]      <1> 		cmp al, [endkey303]
  1002 00000BA3 7408                <1> 		je doneint303
  1003 00000BA5 E8FFFDFFFF          <1> 		call int301prnt
  1004 00000BAA 46                  <1> 		inc esi
  1005 00000BAB EBEE                <1> 		jmp int303b
  1006                              <1> 	doneint303:
  1007 00000BAD C3                  <1> 		ret
  1008                              <1> 		
  1009 00000BAE 00                  <1> endkey304 db 0
  1010                              <1> 	int304:	;;get line, al=last key, esi = buffer
  1011 00000BAF A2[AE0B0000]        <1> 		mov [endkey304], al
  1012                              <1> 	int304b:
  1013 00000BB4 56                  <1> 		push esi
  1014 00000BB5 B000                <1> 		mov al, 0
  1015 00000BB7 E887FFFFFF          <1> 		call int302
  1016 00000BBC 5E                  <1> 		pop esi
  1017 00000BBD 8806                <1> 		mov [esi], al
  1018 00000BBF 46                  <1> 		inc esi
  1019 00000BC0 3A05[AE0B0000]      <1> 		cmp al, [endkey304]
  1020 00000BC6 75EC                <1> 		jne int304b
  1021 00000BC8 4E                  <1> 		dec esi
  1022 00000BC9 C60600              <1> 		mov byte [esi], 0
  1023 00000BCC C3                  <1> 	ret
  1024                              <1> 	
  1025 00000BCD 00                  <1> endkey305 db 0
  1026 00000BCE 00                  <1> modkey305 db 0
  1027 00000BCF 00000000            <1> firstesi305 dd 0
  1028 00000BD3 00                  <1> commandedit db 0
  1029 00000BD4 00                  <1> txtmask db 0
  1030 00000BD5 00000000            <1> buftxtloc dd 0
  1031 00000BD9 082000              <1> backcursor db 8," ",0
  1032                              <1> 	int305:	;;print and get line, al=last key, bl=modifier, esi=buffer
  1033 00000BDC 8935[D50B0000]      <1> 		mov [buftxtloc], esi
  1034 00000BE2 A2[CD0B0000]        <1> 		mov [endkey305], al
  1035 00000BE7 881D[CE0B0000]      <1> 		mov [modkey305], bl
  1036 00000BED 8935[CF0B0000]      <1> 		mov [firstesi305], esi
  1037                              <1> 	int305b:
  1038 00000BF3 56                  <1> 		push esi
  1039 00000BF4 B001                <1> 		mov al, 1
  1040 00000BF6 E848FFFFFF          <1> 		call int302
  1041 00000BFB 5E                  <1> 		pop esi
  1042 00000BFC 80FC48              <1> 		cmp ah, 0x48
  1043 00000BFF 0F845E010000        <1> 		je near int305up
  1044 00000C05 80FC50              <1> 		cmp ah, 0x50
  1045 00000C08 0F8438010000        <1> 		je near int305down
  1046 00000C0E 80FC4D              <1> 		cmp ah, 0x4D
  1047 00000C11 0F84ED000000        <1> 		je near int305right
  1048 00000C17 80FC4B              <1> 		cmp ah, 0x4B
  1049 00000C1A 0F84AB000000        <1> 		je near int305left
  1050 00000C20 3C08                <1> 		cmp al, 8
  1051 00000C22 0F842E020000        <1> 		je near int305bscheck
  1052 00000C28 3C00                <1> 		cmp al, 0
  1053 00000C2A 74C7                <1> 		je int305b
  1054 00000C2C 8806                <1> 		mov [esi], al
  1055 00000C2E 46                  <1> 		inc esi
  1056                              <1> 	bscheckequal:
  1057 00000C2F 8A1D[CE0B0000]      <1> 		mov bl, [modkey305]
  1058 00000C35 8A3D[D40B0000]      <1> 		mov bh, [txtmask]
  1059 00000C3B 80FF00              <1> 		cmp bh, 0
  1060 00000C3E 7402                <1> 		je nomasktxt
  1061 00000C40 88F8                <1> 		mov al, bh
  1062                              <1> 	nomasktxt:
  1063 00000C42 E856FDFFFF          <1> 		call int301
  1064 00000C47 56                  <1> 		push esi
  1065 00000C48 66A3[C90C0000]      <1> 		mov [int305axcache], ax
  1066 00000C4E 8A25[CD0B0000]      <1> 		mov ah, [endkey305]
  1067 00000C54 38E0                <1> 		cmp al, ah
  1068 00000C56 7429                <1> 		je nobackprintbuftxt2
  1069 00000C58 BE[701A0000]        <1> 		mov esi, buftxt2
  1070 00000C5D E814FFFFFF          <1> 		call printquiet
  1071 00000C62 B020                <1> 		mov al, " "
  1072 00000C64 E840FDFFFF          <1> 		call int301prnt
  1073 00000C69 B008                <1> 		mov al, 8
  1074 00000C6B 81FE[701A0000]      <1> 		cmp esi, buftxt2
  1075 00000C71 740E                <1> 		je nobackprintbuftxt2
  1076                              <1> 	backprintbuftxt2:
  1077 00000C73 E831FDFFFF          <1> 		call int301prnt
  1078 00000C78 4E                  <1> 		dec esi
  1079 00000C79 81FE[701A0000]      <1> 		cmp esi, buftxt2
  1080 00000C7F 77F2                <1> 		ja backprintbuftxt2
  1081                              <1> 	nobackprintbuftxt2:
  1082 00000C81 E817FDFFFF          <1> 		call int301
  1083 00000C86 5E                  <1> 		pop esi
  1084 00000C87 66A1[C90C0000]      <1> 		mov ax, [int305axcache]
  1085 00000C8D 8A25[CD0B0000]      <1> 		mov ah, [endkey305]
  1086 00000C93 38E0                <1> 		cmp al, ah
  1087 00000C95 0F8558FFFFFF        <1> 		jne int305b
  1088 00000C9B 4E                  <1> 		dec esi
  1089 00000C9C BF[701A0000]        <1> 		mov edi, buftxt2
  1090                              <1> 	copylaterstuff:
  1091 00000CA1 8A07                <1> 		mov al, [edi]
  1092 00000CA3 3C00                <1> 		cmp al, 0
  1093 00000CA5 7406                <1> 		je nocopylaterstuff
  1094 00000CA7 8806                <1> 		mov [esi], al
  1095 00000CA9 47                  <1> 		inc edi
  1096 00000CAA 46                  <1> 		inc esi
  1097 00000CAB EBF4                <1> 		jmp copylaterstuff
  1098                              <1> 	nocopylaterstuff:
  1099 00000CAD C60600              <1> 		mov byte [esi], 0
  1100 00000CB0 E801000000          <1> 		call clearbuftxt2
  1101 00000CB5 C3                  <1> 		ret
  1102                              <1> 	
  1103                              <1> 	clearbuftxt2:
  1104 00000CB6 B000                <1> 		mov al, 0
  1105 00000CB8 BF[701A0000]        <1> 		mov edi, buftxt2
  1106                              <1> 	clearbuftxt2lp:
  1107 00000CBD 8807                <1> 		mov [edi], al
  1108 00000CBF 47                  <1> 		inc edi
  1109 00000CC0 81FF[7A1B0000]      <1> 		cmp edi, buftxt
  1110 00000CC6 75F5                <1> 		jne clearbuftxt2lp
  1111 00000CC8 C3                  <1> 		ret
  1112                              <1> 		
  1113 00000CC9 0000                <1> 	int305axcache dw 0
  1114                              <1> 		
  1115                              <1> 	int305left:
  1116 00000CCB 3B35[D50B0000]      <1> 		cmp esi, [buftxtloc]
  1117 00000CD1 0F841CFFFFFF        <1> 		je near int305b
  1118 00000CD7 BF[701A0000]        <1> 		mov edi, buftxt2
  1119 00000CDC 8A07                <1> 		mov al, [edi]
  1120                              <1> 	shiftbuftxt2:
  1121 00000CDE 3C00                <1> 		cmp al, 0
  1122 00000CE0 7409                <1> 		je noshiftbuftxt2
  1123 00000CE2 47                  <1> 		inc edi
  1124 00000CE3 8A27                <1> 		mov ah, [edi]
  1125 00000CE5 8807                <1> 		mov [edi], al
  1126 00000CE7 88E0                <1> 		mov al, ah
  1127 00000CE9 EBF3                <1> 		jmp shiftbuftxt2
  1128                              <1> 	noshiftbuftxt2:
  1129 00000CEB BF[701A0000]        <1> 		mov edi, buftxt2
  1130 00000CF0 4E                  <1> 		dec esi
  1131 00000CF1 8A06                <1> 		mov al, [esi]
  1132 00000CF3 8807                <1> 		mov [edi], al
  1133 00000CF5 C60600              <1> 		mov byte [esi], 0
  1134 00000CF8 B008                <1> 		mov al, 8
  1135 00000CFA E89EFCFFFF          <1> 		call int301
  1136 00000CFF E9EFFEFFFF          <1> 		jmp int305b
  1137                              <1> 		
  1138                              <1> 	int305right:
  1139 00000D04 BF[701A0000]        <1> 		mov edi, buftxt2
  1140 00000D09 8A07                <1> 		mov al, [edi]
  1141 00000D0B 3C00                <1> 		cmp al, 0
  1142 00000D0D 0F84E0FEFFFF        <1> 		je near int305b
  1143 00000D13 8806                <1> 		mov [esi], al
  1144                              <1> 	shiftbuftxt2lft:
  1145 00000D15 3C00                <1> 		cmp al, 0
  1146 00000D17 7408                <1> 		je noshiftbuftxt2lft
  1147 00000D19 47                  <1> 		inc edi
  1148 00000D1A 8A07                <1> 		mov al, [edi]
  1149 00000D1C 8847FF              <1> 		mov [edi - 1], al
  1150 00000D1F EBF4                <1> 		jmp shiftbuftxt2lft
  1151                              <1> 	noshiftbuftxt2lft:
  1152 00000D21 8A06                <1> 		mov al, [esi]
  1153 00000D23 46                  <1> 		inc esi
  1154 00000D24 8A1D[CE0B0000]      <1> 		mov bl, [modkey305]
  1155 00000D2A E86EFCFFFF          <1> 		call int301
  1156 00000D2F E9BFFEFFFF          <1> 		jmp int305b
  1157                              <1> 		
  1158                              <1> 	int305downbck:
  1159 00000D34 FECC                <1> 		dec ah
  1160 00000D36 8825[D30B0000]      <1> 		mov [commandedit], ah
  1161 00000D3C E83A000000          <1> 		call int305bckspc
  1162 00000D41 E9ADFEFFFF          <1> 		jmp int305b
  1163                              <1> 	
  1164                              <1> 	int305down:
  1165 00000D46 8A25[D30B0000]      <1> 		mov ah, [commandedit]
  1166 00000D4C 80FC01              <1> 		cmp ah, 1
  1167 00000D4F 0F869EFEFFFF        <1> 		jbe near int305b
  1168 00000D55 80FC02              <1> 		cmp ah, 2
  1169 00000D58 74DA                <1> 		je int305downbck
  1170 00000D5A 80EC02              <1> 		sub ah, 2
  1171 00000D5D 8825[D30B0000]      <1> 		mov [commandedit], ah
  1172                              <1> 		
  1173                              <1> 	int305up:
  1174                              <1> 		;cmp bl, 0xE0
  1175                              <1> 		;jne int305b
  1176 00000D63 B000                <1> 		mov al, 0
  1177 00000D65 3805[D30B0000]      <1> 		cmp [commandedit], al
  1178 00000D6B 0F8482FEFFFF        <1> 		je near int305b
  1179 00000D71 E805000000          <1> 		call int305bckspc
  1180 00000D76 E93C000000          <1> 		jmp getcurrentcommandstr
  1181                              <1> 	int305bckspc:
  1182 00000D7B 3B35[D50B0000]      <1> 		cmp esi, [buftxtloc]
  1183 00000D81 7426                <1> 		je noint305upbck
  1184                              <1> 	int305upbckspclp:
  1185 00000D83 B008                <1> 		mov al, 8
  1186 00000D85 8A1D[CE0B0000]      <1> 		mov bl, [modkey305]
  1187 00000D8B E819FCFFFF          <1> 		call int301prnt
  1188 00000D90 B020                <1> 		mov al, " "
  1189 00000D92 E812FCFFFF          <1> 		call int301prnt
  1190 00000D97 B008                <1> 		mov al, 8
  1191 00000D99 E8FFFBFFFF          <1> 		call int301
  1192 00000D9E 4E                  <1> 		dec esi
  1193 00000D9F 3B35[D50B0000]      <1> 		cmp esi, [buftxtloc]
  1194 00000DA5 7402                <1> 		je noint305upbck
  1195 00000DA7 EBDA                <1> 		jmp int305upbckspclp
  1196                              <1> 	noint305upbck:
  1197 00000DA9 8B3D[1B300000]      <1> 		mov edi, [currentcommandpos]
  1198 00000DAF 81C7[1F300000]      <1> 		add edi, commandbuf
  1199 00000DB5 4F                  <1> 		dec edi
  1200 00000DB6 C3                  <1> 		ret
  1201                              <1> 	getcurrentcommandstr:
  1202 00000DB7 8A25[D30B0000]      <1> 		mov ah, [commandedit]
  1203 00000DBD FE05[D30B0000]      <1> 		inc byte [commandedit]
  1204                              <1> 	getccmdlp:
  1205 00000DC3 4F                  <1> 		dec edi
  1206 00000DC4 8A07                <1> 		mov al, [edi]
  1207 00000DC6 81FF[1F300000]      <1> 		cmp edi, commandbuf
  1208 00000DCC 7231                <1> 		jb getcmdresetcommandbuf
  1209 00000DCE 81EF[1F300000]      <1> 		sub edi, commandbuf
  1210 00000DD4 3B3D[1B300000]      <1> 		cmp edi, [currentcommandpos]
  1211 00000DDA 0F8413FEFFFF        <1> 		je near int305b
  1212 00000DE0 81C7[1F300000]      <1> 		add edi, commandbuf
  1213 00000DE6 3C00                <1> 		cmp al, 0
  1214 00000DE8 75D9                <1> 		jne getccmdlp
  1215 00000DEA FECC                <1> 		dec ah
  1216 00000DEC 80FC00              <1> 		cmp ah, 0
  1217 00000DEF 77D2                <1> 		ja getccmdlp
  1218 00000DF1 47                  <1> 		inc edi
  1219 00000DF2 81FF[1F340000]      <1> 		cmp edi, commandbufend
  1220 00000DF8 770D                <1> 		ja fixcmdbufb4moreint305
  1221 00000DFA E915000000          <1> 		jmp moreint305up
  1222                              <1> 	getcmdresetcommandbuf:
  1223 00000DFF BF[1F340000]        <1> 		mov edi, commandbufend
  1224 00000E04 47                  <1> 		inc edi
  1225 00000E05 EBBC                <1> 		jmp getccmdlp
  1226                              <1> 	fixcmdbufb4moreint305:
  1227 00000E07 4F                  <1> 		dec edi
  1228 00000E08 81EF[1F340000]      <1> 		sub edi, commandbufend
  1229 00000E0E 81C7[1F300000]      <1> 		add edi, commandbuf
  1230                              <1> 	moreint305up:
  1231 00000E14 8A07                <1> 		mov al, [edi]
  1232 00000E16 47                  <1> 		inc edi
  1233 00000E17 81EF[1F300000]      <1> 		sub edi, commandbuf
  1234 00000E1D 3C00                <1> 		cmp al, 0
  1235 00000E1F 0F84CEFDFFFF        <1> 		je near int305b
  1236 00000E25 3B3D[1B300000]      <1> 		cmp edi, [currentcommandpos]
  1237 00000E2B 0F83C2FDFFFF        <1> 		jae near int305b
  1238 00000E31 81C7[1F300000]      <1> 		add edi, commandbuf
  1239 00000E37 8806                <1> 		mov [esi], al
  1240 00000E39 46                  <1> 		inc esi
  1241 00000E3A 57                  <1> 		push edi
  1242 00000E3B 8A1D[CE0B0000]      <1> 		mov bl, [modkey305]
  1243 00000E41 E857FBFFFF          <1> 		call int301
  1244 00000E46 5F                  <1> 		pop edi
  1245 00000E47 81FF[1F340000]      <1> 		cmp edi, commandbufend
  1246 00000E4D 76C5                <1> 		jbe moreint305up
  1247 00000E4F BF[1F300000]        <1> 		mov edi, commandbuf
  1248 00000E54 EBBE                <1> 		jmp moreint305up
  1249                              <1> 	int305bscheck:
  1250 00000E56 3B35[CF0B0000]      <1> 		cmp esi, [firstesi305]
  1251 00000E5C 7705                <1> 		ja goodbscheck
  1252 00000E5E E990FDFFFF          <1> 		jmp int305b
  1253                              <1> 	goodbscheck:
  1254 00000E63 4E                  <1> 		dec esi
  1255 00000E64 C60600              <1> 		mov byte [esi], 0
  1256 00000E67 8A1D[CE0B0000]      <1> 		mov bl, [modkey305]
  1257 00000E6D B008                <1> 		mov al, 8
  1258 00000E6F E9BBFDFFFF          <1> 		jmp bscheckequal
  1259                              <1> 	
  1260                              <1> 		
  1261                              <1> 	clear:		
  1262                              <1> 	
  1263                              <1> 	int306:	;;clear screen
  1264 00000E74 668B0D[99090000]    <1> 		mov cx, [charxy]
  1265 00000E7B BF[8F1C0000]        <1> 		mov edi, videobuf2
  1266 00000E80 66B80000            <1> 		mov ax, 0
  1267 00000E84 66A3[93090000]      <1> 		mov [linebeginpos], ax
  1268 00000E8A 66A3[95090000]      <1> 		mov [videobufpos], ax
  1269 00000E90 66BA0000            <1> 		mov dx, 0
  1270 00000E94 66A3[97090000]      <1> 		mov [charpos], ax
  1271                              <1> 	int306b:
  1272 00000E9A 668907              <1> 		mov [edi], ax
  1273 00000E9D 81C702000000        <1> 		add edi, 2
  1274 00000EA3 80E902              <1> 		sub cl, 2
  1275 00000EA6 80F900              <1> 		cmp cl, 0
  1276 00000EA9 75EF                <1> 		jne int306b
  1277 00000EAB 8A0D[99090000]      <1> 		mov cl, [charxy]
  1278 00000EB1 FECD                <1> 		dec ch
  1279 00000EB3 80FD00              <1> 		cmp ch, 0
  1280 00000EB6 75E2                <1> 		jne int306b
  1281 00000EB8 E906000000          <1> 		jmp termcopy
  1282                              <1> 		
  1283 00000EBD 00000000            <1> 	termcursorpos dd 0
  1284 00000EC1 0000                <1> 	removedvideo dw 0
  1285                              <1> termcopy:	
  1286 00000EC3 60                  <1> 	pusha
  1287 00000EC4 BF[8F1C0000]        <1> 	mov edi, videobuf2
  1288 00000EC9 BB00000000          <1> 	mov ebx, 0
  1289 00000ECE 668B1D[95090000]    <1> 	mov bx, [videobufpos]
  1290 00000ED5 01DF                <1> 	add edi, ebx
  1291 00000ED7 893D[BD0E0000]      <1> 	mov [termcursorpos], edi
  1292 00000EDD E8C0000000          <1> 	call switchtermcursor
  1293 00000EE2 C605[342D0000]00    <1> 	mov byte [mouseselecton], 0
  1294 00000EE9 C605[A8090000]01    <1> 	mov byte [termcopyon], 1
  1295 00000EF0 803D[352D0000]00    <1> 	cmp byte [guion], 0
  1296 00000EF7 0F8412000000        <1> 	je near nowincopy
  1297 00000EFD 803D[A7090000]01    <1> 	cmp byte [termguion], 1
  1298 00000F04 0F840C2A0000        <1> 	je near windowvideocopy
  1299 00000F0A E98C000000          <1> 	jmp nocopytermatall
  1300                              <1> nowincopy:
  1301 00000F0F BE00000A00          <1> 	mov esi, 0xA0000
  1302 00000F14 A1[6A030000]        <1> 	mov eax, [basecache]
  1303 00000F19 C1E004              <1> 	shl eax, 4
  1304 00000F1C 29C6                <1> 	sub esi, eax
  1305 00000F1E BF[8F1C0000]        <1> 	mov edi, videobuf2
  1306 00000F23 B900000000          <1> 	mov ecx, 0
  1307 00000F28 668B0D[99090000]    <1> 	mov cx, [charxy]
  1308                              <1> nowincopy2:
  1309 00000F2F BB[37490000]        <1> 	mov ebx, fonts
  1310 00000F34 B800000000          <1> 	mov eax, 0
  1311 00000F39 8A07                <1> 	mov al, [edi]
  1312 00000F3B C1E004              <1> 	shl eax, 4
  1313 00000F3E 01C3                <1> 	add ebx, eax
  1314 00000F40 47                  <1> 	inc edi
  1315 00000F41 8A27                <1> 	mov ah, [edi]
  1316 00000F43 BA00000000          <1> 	mov edx, 0
  1317 00000F48 8A15[99090000]      <1> 	mov dl, [charxy]
  1318 00000F4E D1EA                <1> 	shr edx, 1
  1319 00000F50 C1C110              <1> 	rol ecx, 16
  1320 00000F53 B110                <1> 	mov cl, 16
  1321                              <1> nowinfont:
  1322 00000F55 8A03                <1> 	mov al, [ebx]
  1323 00000F57 D0C8                <1> 	ror al, 1
  1324 00000F59 80FC07              <1> 	cmp ah, 7
  1325 00000F5C 7602                <1> 	jbe notnotfont
  1326 00000F5E F6D0                <1> 	not al
  1327                              <1> notnotfont:
  1328 00000F60 8806                <1> 	mov [esi], al
  1329 00000F62 01D6                <1> 	add esi, edx
  1330 00000F64 43                  <1> 	inc ebx
  1331 00000F65 FEC9                <1> 	dec cl
  1332 00000F67 80F900              <1> 	cmp cl, 0
  1333 00000F6A 75E9                <1> 	jne nowinfont
  1334 00000F6C C1E204              <1> 	shl edx, 4
  1335 00000F6F 29D6                <1> 	sub esi, edx
  1336 00000F71 C1C110              <1> 	rol ecx, 16
  1337                              <1> nopresentwinfont:
  1338 00000F74 47                  <1> 	inc edi
  1339 00000F75 46                  <1> 	inc esi
  1340 00000F76 80E902              <1> 	sub cl, 2
  1341 00000F79 80F900              <1> 	cmp cl, 0
  1342 00000F7C 75B1                <1> 	jne nowincopy2
  1343 00000F7E 8A0D[99090000]      <1> 	mov cl, [charxy]
  1344 00000F84 BA00000000          <1> 	mov edx, 0
  1345 00000F89 88CA                <1> 	mov dl, cl
  1346 00000F8B D1EA                <1> 	shr edx, 1
  1347 00000F8D 29D6                <1> 	sub esi, edx
  1348 00000F8F C1E204              <1> 	shl edx, 4
  1349 00000F92 01D6                <1> 	add esi, edx
  1350 00000F94 FECD                <1> 	dec ch
  1351 00000F96 80FD00              <1> 	cmp ch, 0
  1352 00000F99 7594                <1> 	jne nowincopy2
  1353                              <1> nocopytermatall:
  1354 00000F9B E802000000          <1> 	call switchtermcursor
  1355 00000FA0 61                  <1> 	popa
  1356 00000FA1 C3                  <1> 	ret
  1357                              <1> 	
  1358                              <1> switchtermcursor:
  1359 00000FA2 8B3D[BD0E0000]      <1> 	mov edi, [termcursorpos]
  1360 00000FA8 8A4701              <1> 	mov al, [edi + 1]
  1361 00000FAB 8A27                <1> 	mov ah, [edi]
  1362 00000FAD 3C07                <1> 	cmp al, 7
  1363 00000FAF 7607                <1> 	jbe movlargecursorterm
  1364 00000FB1 B007                <1> 	mov al, 7
  1365 00000FB3 E902000000          <1> 	jmp movedcursorterm
  1366                              <1> movlargecursorterm:
  1367 00000FB8 B0F0                <1> 	mov al, 0xF0
  1368                              <1> movedcursorterm:
  1369 00000FBA 884701              <1> 	mov [edi + 1], al
  1370 00000FBD 80FC00              <1> 	cmp ah, 0
  1371 00000FC0 7504                <1> 	jne fixednocursorterm
  1372 00000FC2 B420                <1> 	mov ah, " "
  1373 00000FC4 8827                <1> 	mov [edi], ah
  1374                              <1> fixednocursorterm:
  1375 00000FC6 C3                  <1> 	ret
  1376                              <1> 	
  1377                                      %include 'source/solleros.asm'
  1378                              <1> 	;SOLLEROS.ASM
  1379                              <1> os:
  1380 00000FC7 E8A8FEFFFF          <1> 	call clear
  1381 00000FCC BE[F1480000]        <1> 	mov esi, userask
  1382 00000FD1 E8AEFBFFFF          <1> 	call print
  1383                              <1> usercheck:
  1384 00000FD6 BE[7A1B0000]        <1> 	mov esi, buftxt
  1385 00000FDB B00D                <1> 	mov al, 13
  1386 00000FDD B404                <1> 	mov ah, 4
  1387 00000FDF CD30                <1> 	int 30h
  1388 00000FE1 56                  <1> 	push esi
  1389 00000FE2 BE[11490000]        <1> 	mov esi, line
  1390 00000FE7 E898FBFFFF          <1> 	call print
  1391 00000FEC BE[FB480000]        <1> 	mov esi, pwdask
  1392 00000FF1 E88EFBFFFF          <1> 	call print
  1393 00000FF6 5E                  <1> 	pop esi
  1394 00000FF7 46                  <1> 	inc esi
  1395 00000FF8 8935[B6100000]      <1> 	mov [esipass], esi
  1396                              <1> passcheck:
  1397 00000FFE B000                <1> 	mov al, 0
  1398 00001000 B405                <1> 	mov ah, 5
  1399 00001002 CD30                <1> 	int 30h
  1400 00001004 3C0D                <1> 	cmp al, 13
  1401 00001006 0F8435000000        <1> 	je near gotpass
  1402 0000100C 3C08                <1> 	cmp al, 8
  1403 0000100E 0F840F000000        <1> 	je near backpass
  1404 00001014 8806                <1> 	mov [esi], al
  1405 00001016 46                  <1> 	inc esi
  1406 00001017 B02A                <1> 	mov al, '*'
  1407 00001019 B406                <1> 	mov ah, 6
  1408 0000101B CD30                <1> 	int 30h
  1409 0000101D EBDF                <1> 	jmp passcheck
  1410 0000101F 08200800            <1> backcursor2 db 8," ",8,0
  1411                              <1> backpass:
  1412 00001023 3B35[B6100000]      <1> 	cmp esi, [esipass]
  1413 00001029 0F84CFFFFFFF        <1> 	je near passcheck
  1414 0000102F 4E                  <1> 	dec esi
  1415 00001030 C60600              <1> 	mov byte [esi], 0
  1416 00001033 56                  <1> 	push esi
  1417 00001034 BE[1F100000]        <1> 	mov esi, backcursor2
  1418 00001039 E846FBFFFF          <1> 	call print
  1419 0000103E 5E                  <1> 	pop esi
  1420 0000103F EBBD                <1> 	jmp passcheck
  1421                              <1> gotpass:
  1422 00001041 B000                <1> 	mov al,0
  1423 00001043 8806                <1> 	mov [esi], al
  1424 00001045 BE[11490000]        <1> 	mov esi, line
  1425 0000104A E835FBFFFF          <1> 	call print
  1426 0000104F BB[14490000]        <1> 	mov ebx, userlst
  1427                              <1> userfind:
  1428 00001054 BE[7A1B0000]        <1> 	mov esi, buftxt
  1429 00001059 8A06                <1> 	mov al, [esi]
  1430 0000105B 3C00                <1> 	cmp al, 0
  1431 0000105D 0F8464FFFFFF        <1> 	je near os
  1432 00001063 891D[BA100000]      <1> 	mov [usercache], ebx
  1433 00001069 E8BF010000          <1> 	call tester
  1434 0000106E 3C01                <1> 	cmp al, 1
  1435 00001070 7415                <1> 	je pwdtest
  1436                              <1> nxtuser:
  1437 00001072 43                  <1> 	inc ebx
  1438 00001073 8A03                <1> 	mov al, [ebx]
  1439 00001075 3C00                <1> 	cmp al, 0
  1440 00001077 74DB                <1> 	je userfind
  1441 00001079 81FB[37490000]      <1> 	cmp ebx, userlstend
  1442 0000107F 0F8342FFFFFF        <1> 	jae near os
  1443 00001085 EBCD                <1> 	jmp userfind
  1444                              <1> pwdtest:
  1445 00001087 46                  <1> 	inc esi
  1446 00001088 43                  <1> 	inc ebx
  1447 00001089 E89F010000          <1> 	call tester
  1448 0000108E 3C01                <1> 	cmp al, 1
  1449 00001090 7402                <1> 	je pwdrgt
  1450 00001092 EBDE                <1> 	jmp nxtuser
  1451 00001094 E8DBFDFFFF          <1> pwdrgt:	call clear
  1452 00001099 66B90002            <1> 	mov cx, 200h
  1453 0000109D BE[7A1B0000]        <1> 	mov esi, buftxt
  1454 000010A2 B000                <1> 	mov al, 0
  1455 000010A4 8806                <1> bufclr:	mov [esi], al
  1456 000010A6 46                  <1> 	inc esi
  1457 000010A7 E2FB                <1> 	loop bufclr
  1458                              <1> ;;;;;;;;;;;;;;;;
  1459 000010A9 C605[B5100000]01    <1> 	mov byte [nwcmdon], 1
  1460 000010B0 E92C000000          <1> 	jmp nwcmd
  1461                              <1> 
  1462 000010B5 00                  <1> nwcmdon db 0
  1463 000010B6 00000000            <1> esipass dd 0
  1464 000010BA [14490000]          <1> usercache dd userlst
  1465                              <1> 	
  1466                              <1> buftxtclear:
  1467 000010BE B000                <1> 	mov al, 0
  1468 000010C0 BE[7A1B0000]        <1> 	mov esi, buftxt
  1469 000010C5 81FE[7A1C0000]      <1> clearbuftxt: cmp esi, buf2
  1470 000010CB 730E                <1> 	jae retbufclr
  1471 000010CD 8806                <1> 	mov [esi], al
  1472 000010CF 46                  <1> 	inc esi
  1473 000010D0 EBF3                <1> 	jmp clearbuftxt
  1474                              <1> 
  1475 000010D2 39DE                <1> clearitbuf: cmp esi, ebx
  1476 000010D4 7305                <1> 	jae retbufclr
  1477 000010D6 8806                <1> 	mov [esi], al
  1478 000010D8 46                  <1> 	inc esi
  1479 000010D9 EBF7                <1> 	jmp clearitbuf
  1480 000010DB C3                  <1> retbufclr: ret
  1481                              <1> 
  1482 000010DC E900000000          <1> full:	jmp nwcmd
  1483                              <1> 
  1484                              <1> 
  1485 000010E1 B001                <1> nwcmd:	mov al, 1
  1486 000010E3 3805[69130000]      <1> 	cmp [BATCHISON], al
  1487 000010E9 0F83A5000000        <1> 	jae near batchran
  1488 000010EF 3805[B5100000]      <1> 	cmp [nwcmdon], al
  1489 000010F5 7401                <1> 	je cancel
  1490 000010F7 C3                  <1> 	ret	;;return from terminal
  1491 000010F8 B000                <1> cancel:	mov al, 0
  1492 000010FA A2[00130000]        <1> 	mov [IFON], al
  1493 000010FF A2[69130000]        <1> 	mov [BATCHISON], al
  1494 00001104 B05B                <1> 	mov al, '['
  1495 00001106 B406                <1> 	mov ah, 6
  1496 00001108 66BB0700            <1> 	mov bx, 7
  1497 0000110C E898F8FFFF          <1> 	call int301prnt
  1498 00001111 8B35[BA100000]      <1> 	mov esi, [usercache]
  1499 00001117 E868FAFFFF          <1> 	call print
  1500 0000111C BE[05490000]        <1> 	mov esi, location
  1501 00001121 E85EFAFFFF          <1> 	call print
  1502                              <1> 	;call time
  1503                              <1> 	;mov esi, timeshow
  1504                              <1> 	;call print
  1505                              <1> 	;mov esi, cmd
  1506                              <1> 	;call print
  1507 00001126 E893FFFFFF          <1> 	call buftxtclear
  1508 0000112B BE[7A1B0000]        <1> 	mov esi, buftxt
  1509 00001130 C605[D30B0000]01    <1> 	mov byte [commandedit], 1
  1510 00001137 B00D                <1> 	mov al, 13
  1511 00001139 B307                <1> 	mov bl, 7
  1512 0000113B B404                <1> 	mov ah, 4
  1513 0000113D CD30                <1> 	int 30h
  1514 0000113F C605[D30B0000]00    <1> 	mov byte [commandedit], 0
  1515 00001146 8B35[1B300000]      <1> gotcmd:	mov esi, [currentcommandpos]
  1516 0000114C 8935[17300000]      <1> 	mov [lastcommandpos], esi
  1517 00001152 BF[7A1B0000]        <1> 	mov edi, buftxt
  1518 00001157 81C6[1F300000]      <1> 	add esi, commandbuf
  1519 0000115D 81FE[1F340000]      <1> 	cmp esi, commandbufend
  1520 00001163 7605                <1> 	jbe copycommand
  1521 00001165 BE[1F300000]        <1> 	mov esi, commandbuf
  1522                              <1> copycommand:
  1523 0000116A 8A07                <1> 	mov al, [edi]
  1524 0000116C 8806                <1> 	mov [esi], al
  1525 0000116E 47                  <1> 	inc edi
  1526 0000116F 46                  <1> 	inc esi
  1527 00001170 3C00                <1> 	cmp al, 0
  1528 00001172 740F                <1> 	je donecopy
  1529 00001174 81FE[1F340000]      <1> 	cmp esi, commandbufend
  1530 0000117A 76EE                <1> 	jbe copycommand
  1531 0000117C BE[1F300000]        <1> 	mov esi, commandbuf
  1532 00001181 EBE7                <1> 	jmp copycommand
  1533                              <1> donecopy:
  1534 00001183 81EE[1F300000]      <1> 	sub esi, commandbuf
  1535 00001189 8935[1B300000]      <1> 	mov [currentcommandpos], esi
  1536 0000118F E914000000          <1> 	jmp run
  1537                              <1> 	
  1538                              <1> batchran:
  1539 00001194 C3                  <1> 	ret
  1540                              <1> 
  1541 00001195 E824FFFFFF          <1> input:	call buftxtclear
  1542 0000119A BE[7A1B0000]        <1> 	mov esi, buftxt		;puts input into buftxt AND onto screen
  1543 0000119F B00D                <1> stdin:	mov al, 13
  1544 000011A1 B307                <1> 	mov bl, 7
  1545 000011A3 B404                <1> 	mov ah, 4
  1546 000011A5 CD30                <1> 	int 30h
  1547 000011A7 C3                  <1> 	ret
  1548                              <1> 
  1549 000011A8 BE[11490000]        <1> run:	mov esi, line
  1550 000011AD E8D2F9FFFF          <1> 	call print
  1551                              <1> progtest:
  1552 000011B2 BE[7A1B0000]        <1> 	mov esi, buftxt
  1553 000011B7 BB[6F130000]        <1> 	mov ebx, fileindex
  1554 000011BC 668B03              <1> prgnxt:	mov ax, [ebx]
  1555 000011BF B105                <1> 	mov cl, 5
  1556 000011C1 B504                <1> 	mov ch, 4
  1557 000011C3 6639C8              <1> 	cmp ax, cx
  1558 000011C6 740B                <1> 	je fndprg
  1559 000011C8 43                  <1> 	inc ebx
  1560 000011C9 81FB[6F150000]      <1> 	cmp ebx, fileindexend
  1561 000011CF 7330                <1> 	jae prgnf
  1562 000011D1 EBE9                <1> 	jmp prgnxt
  1563 000011D3 81C302000000        <1> fndprg: add ebx, 2
  1564 000011D9 BE[7A1B0000]        <1> 	mov esi, buftxt
  1565 000011DE 66B90000            <1> 	mov cx, 0
  1566 000011E2 E880000000          <1> 	call cndtest
  1567 000011E7 3C01                <1> 	cmp al, 1
  1568 000011E9 7302                <1> 	jae prggood
  1569 000011EB EBCF                <1> 	jmp prgnxt
  1570 000011ED 81FB[6F150000]      <1> prggood: cmp ebx, fileindexend
  1571 000011F3 7333                <1> 	jae prgdn
  1572 000011F5 81C303000000        <1> 	add ebx, 3
  1573 000011FB 8B3B                <1> 	mov edi, [ebx]
  1574 000011FD 90                  <1> 	nop
  1575 000011FE 90                  <1> 	nop
  1576 000011FF FFE7                <1> 	jmp edi
  1577                              <1> prgnf:	
  1578 00001201 A0[7A1B0000]        <1> 	mov al, [buftxt]
  1579 00001206 3C00                <1> 	cmp al, 0
  1580 00001208 741E                <1> 	je prgdn
  1581 0000120A BE[D8480000]        <1> 	mov esi, notfound1
  1582 0000120F E870F9FFFF          <1> 	call print
  1583 00001214 BE[7A1B0000]        <1> 	mov esi, buftxt
  1584 00001219 E866F9FFFF          <1> 	call print
  1585 0000121E BE[E2480000]        <1> 	mov esi, notfound2
  1586 00001223 E85CF9FFFF          <1> 	call print
  1587 00001228 E9B4FEFFFF          <1> prgdn:	jmp nwcmd
  1588                              <1> 
  1589                              <1> 
  1590                              <1> tester:			;si=user bx=prog returns 1 in al if true
  1591 0000122D B000                <1> 	mov al, 0
  1592 0000122F 8A06                <1> retest:	mov al, [esi]
  1593 00001231 8A23                <1> 	mov ah, [ebx]
  1594 00001233 3C00                <1> 	cmp al, 0
  1595 00001235 7408                <1> 	je testtrue
  1596 00001237 38E0                <1> 	cmp al, ah
  1597 00001239 750C                <1> 	jne testfalse
  1598 0000123B 43                  <1> 	inc ebx
  1599 0000123C 46                  <1> 	inc esi
  1600 0000123D EBF0                <1> 	jmp retest
  1601                              <1> testtrue:
  1602 0000123F 80FC00              <1> 	cmp ah, 0
  1603 00001242 7503                <1> 	jne testfalse
  1604 00001244 B001                <1> 	mov al, 1
  1605 00001246 C3                  <1> 	ret
  1606                              <1> testfalse:
  1607 00001247 B000                <1> 	mov al, 0
  1608 00001249 C3                  <1> 	ret
  1609                              <1> 
  1610                              <1> optest:			;si=user bx=prog returns 1 in al if true
  1611 0000124A B000                <1> 	mov al, 0
  1612                              <1> opretest:
  1613 0000124C 8A06                <1> 	mov al, [esi]
  1614 0000124E 8A23                <1> 	mov ah, [ebx]
  1615 00001250 38E0                <1> 	cmp al, ah
  1616 00001252 7510                <1> 	jne optestfalse
  1617 00001254 80FC00              <1> 	cmp ah, 0
  1618 00001257 7404                <1> 	je optesttrue
  1619 00001259 43                  <1> 	inc ebx
  1620 0000125A 46                  <1> 	inc esi
  1621 0000125B EBEF                <1> 	jmp opretest
  1622                              <1> optesttrue:
  1623 0000125D 3C00                <1> 	cmp al, 0
  1624 0000125F 7503                <1> 	jne optestfalse
  1625 00001261 B001                <1> 	mov al, 1
  1626 00001263 C3                  <1> 	ret
  1627                              <1> optestfalse:
  1628 00001264 B000                <1> 	mov al, 0
  1629 00001266 C3                  <1> 	ret
  1630                              <1> 
  1631                              <1> cndtest:			;si=user bx=prog cl=endchar returns 1 in al if true
  1632 00001267 B000                <1> 	mov al, 0
  1633 00001269 8A06                <1> cndretest:	mov al, [esi]
  1634 0000126B 8A23                <1> 	mov ah, [ebx]
  1635 0000126D 38CC                <1> 	cmp ah, cl
  1636 0000126F 7408                <1> 	je cndtesttrue
  1637 00001271 38E0                <1> 	cmp al, ah
  1638 00001273 750B                <1> 	jne cndtestfalse
  1639 00001275 43                  <1> 	inc ebx
  1640 00001276 46                  <1> 	inc esi
  1641 00001277 EBF0                <1> 	jmp cndretest
  1642                              <1> cndtesttrue:
  1643 00001279 38C8                <1> 	cmp al, cl
  1644 0000127B 7506                <1> 	jne cndtestalmost
  1645 0000127D B001                <1> 	mov al, 1
  1646 0000127F C3                  <1> 	ret
  1647                              <1> cndtestfalse:
  1648 00001280 B000                <1> 	mov al, 0
  1649 00001282 C3                  <1> 	ret
  1650                              <1> cndtestalmost:
  1651 00001283 B002                <1> 	mov al, 2
  1652 00001285 C3                  <1> 	ret
  1653 00001286 00                  <1> currentdir db 0
  1654 00001287 BE[6F130000]        <1> dir:	mov esi, fileindex
  1655 0000128C 8A06                <1> 	dirnxt:	mov al, [esi]
  1656 0000128E B400                <1> 		mov ah, 0
  1657 00001290 3C05                <1> 		cmp al, 5
  1658 00001292 744A                <1> 		je dirfnd
  1659 00001294 3C07                <1> 		cmp al, 7
  1660 00001296 743C                <1> 		je dirfnd3
  1661 00001298 3C06                <1> 		cmp al, 6
  1662 0000129A 7438                <1> 		je dirfnd3
  1663 0000129C 46                  <1> 		inc esi
  1664 0000129D 81FE[6F150000]      <1> 		cmp esi,  fileindexend
  1665 000012A3 737B                <1> 		jae dirdn
  1666 000012A5 EBE5                <1> 		jmp dirnxt
  1667 000012A7 060400626174636800- <1> 	typetable db 6,4,0,"batch",0,7,4,0,"document",0,10,4,0,"folder",0,5,4,0,"executable",0
  1668 000012B0 070400646F63756D65- <1>
  1669 000012B9 6E74000A0400666F6C- <1>
  1670 000012C2 646572000504006578- <1>
  1671 000012CB 6563757461626C6500  <1>
  1672                              <1> 	dirfnd3:
  1673 000012D4 46                  <1> 		inc esi
  1674 000012D5 81FE[6F150000]      <1> 		cmp esi, fileindexend
  1675 000012DB 76AF                <1> 		jbe dirnxt
  1676 000012DD 4E                  <1> 		dec esi
  1677 000012DE 46                  <1> 	dirfnd:	inc esi
  1678 000012DF 8A06                <1> 		mov al, [esi]
  1679 000012E1 B400                <1> 		mov ah, 0
  1680 000012E3 3C04                <1> 		cmp al, 4
  1681 000012E5 740B                <1> 		je dirfnd2
  1682 000012E7 46                  <1> 		inc esi
  1683 000012E8 81FE[6F150000]      <1> 		cmp esi,  fileindexend
  1684 000012EE 7330                <1> 		jae dirdn
  1685 000012F0 EB9A                <1> 		jmp dirnxt
  1686 000012F2 81C601000000        <1> 	dirfnd2: add esi, 1
  1687 000012F8 E887F8FFFF          <1> 		call print
  1688 000012FD 8935[25130000]      <1> 		mov [esidir], esi
  1689 00001303 BE[11490000]        <1> 		mov esi, line
  1690 00001308 E877F8FFFF          <1> 		call print
  1691 0000130D 8B35[25130000]      <1> 		mov esi, [esidir]
  1692 00001313 81FE[6F150000]      <1> 		cmp esi,  fileindexend
  1693 00001319 7305                <1> 		jae dirdn
  1694 0000131B E96CFFFFFF          <1> 		jmp dirnxt
  1695 00001320 E9BCFDFFFF          <1> 	dirdn:	jmp nwcmd
  1696 00001325 00000000            <1> esidir dd 0
  1697                              <1> 
  1698                              <1> array:				;arraystart in si, arrayend in bx, arrayseperator in cx
  1699                              <1> 		                ;ends if array seperator is found backwards after 0
  1700                              <1> 	arnxt:	      
  1701 00001329 88E8                <1> 		mov al, ch
  1702 0000132B 88CC                <1> 		mov ah, cl        
  1703 0000132D 663906              <1> 		cmp [esi], ax
  1704 00001330 744D                <1> 		je ardn
  1705 00001332 66390E              <1> 		cmp [esi], cx
  1706 00001335 7407                <1> 		je arfnd
  1707 00001337 46                  <1> 		inc esi
  1708 00001338 39DE                <1> 		cmp esi, ebx
  1709 0000133A 7343                <1> 		jae ardn
  1710 0000133C EBEB                <1> 		jmp arnxt
  1711 0000133E 81C602000000        <1> 	arfnd: add esi, 2
  1712 00001344 891D[80130000]      <1> 		mov [arbx], ebx
  1713 0000134A 890D[84130000]      <1> 		mov [arcx], ecx
  1714 00001350 E82FF8FFFF          <1> 		call print
  1715 00001355 8935[86130000]      <1> 		mov [arsi], esi
  1716 0000135B BE[11490000]        <1> 		mov esi, line
  1717 00001360 E81FF8FFFF          <1> 		call print
  1718 00001365 8B1D[80130000]      <1> 		mov ebx, [arbx]
  1719 0000136B 668B0D[84130000]    <1> 		mov cx, [arcx]
  1720 00001372 8B35[86130000]      <1> 		mov esi, [arsi]
  1721 00001378 46                  <1> 		inc esi
  1722 00001379 39DE                <1> 		cmp esi, ebx
  1723 0000137B 7302                <1> 		jae ardn
  1724 0000137D EBAA                <1> 		jmp arnxt
  1725 0000137F C3                  <1> 	ardn:	ret
  1726 00001380 00000000            <1> arbx:	dw 0,0
  1727 00001384 0000                <1> arcx:	db 0,0
  1728 00001386 00000000            <1> arsi:	dw 0,0
  1729                              <1> 
  1730                              <1> clearbuffer:
  1731 0000138A BE[7A1C0000]        <1> 	mov esi, buf2
  1732 0000138F B030                <1> 	mov al, '0'
  1733 00001391 81FE[8E1C0000]      <1> clearbuf: cmp esi, numbuf
  1734 00001397 7305                <1> 	jae doneclearbuff
  1735 00001399 8806                <1> 	mov [esi], al
  1736 0000139B 46                  <1> 	inc esi
  1737 0000139C EBF3                <1> 	jmp clearbuf
  1738                              <1> doneclearbuff: 
  1739 0000139E C3                  <1> 		ret
  1740                              <1> 
  1741                              <1> convert:
  1742 0000139F 4E                  <1> 	dec esi
  1743 000013A0 89F3                <1> 	mov ebx, esi		;place to convert into must be in si, number to convert must be in cx
  1744                              <1> cnvrt:
  1745 000013A2 89DE                <1> 	mov esi, ebx
  1746 000013A4 81EE09000000        <1> 	sub esi, 9
  1747 000013AA 81F900CA9A3B        <1> 	cmp ecx, 1000000000
  1748 000013B0 720A                <1> 	jb ten8
  1749 000013B2 81E900CA9A3B        <1> 	sub ecx, 1000000000
  1750 000013B8 FE06                <1> 	inc byte [esi]
  1751 000013BA EBE6                <1> 	jmp cnvrt
  1752 000013BC 46                  <1> ten8:	inc esi
  1753 000013BD 81F900E1F505        <1> 	cmp ecx, 100000000
  1754 000013C3 720A                <1> 	jb ten7
  1755 000013C5 81E900E1F505        <1> 	sub ecx, 100000000
  1756 000013CB FE06                <1> 	inc byte [esi]
  1757 000013CD EBD3                <1> 	jmp cnvrt
  1758 000013CF 46                  <1> ten7:	inc esi
  1759 000013D0 81F980969800        <1> 	cmp ecx, 10000000
  1760 000013D6 720A                <1> 	jb ten6
  1761 000013D8 81E980969800        <1> 	sub ecx, 10000000
  1762 000013DE FE06                <1> 	inc byte [esi]
  1763 000013E0 EBC0                <1> 	jmp cnvrt
  1764 000013E2 46                  <1> ten6:	inc esi
  1765 000013E3 81F940420F00        <1> 	cmp ecx, 1000000
  1766 000013E9 720A                <1> 	jb ten5
  1767 000013EB 81E940420F00        <1> 	sub ecx, 1000000
  1768 000013F1 FE06                <1> 	inc byte [esi]
  1769 000013F3 EBAD                <1> 	jmp cnvrt
  1770 000013F5 46                  <1> ten5:	inc esi
  1771 000013F6 81F9A0860100        <1> 	cmp ecx, 100000
  1772 000013FC 720A                <1> 	jb ten4
  1773 000013FE 81E9A0860100        <1> 	sub ecx, 100000
  1774 00001404 FE06                <1> 	inc byte [esi]
  1775 00001406 EB9A                <1> 	jmp cnvrt
  1776 00001408 46                  <1> ten4:	inc esi
  1777 00001409 81F910270000        <1> 	cmp ecx, 10000
  1778 0000140F 720A                <1> 	jb ten3
  1779 00001411 81E910270000        <1> 	sub ecx, 10000
  1780 00001417 FE06                <1> 	inc byte [esi]
  1781 00001419 EB87                <1> 	jmp cnvrt
  1782 0000141B 46                  <1> ten3:	inc esi
  1783 0000141C 81F9E8030000        <1> 	cmp ecx, 1000
  1784 00001422 720D                <1> 	jb ten2
  1785 00001424 81E9E8030000        <1> 	sub ecx, 1000
  1786 0000142A FE06                <1> 	inc byte [esi]
  1787 0000142C E971FFFFFF          <1> 	jmp cnvrt
  1788 00001431 46                  <1> ten2:	inc esi
  1789 00001432 81F964000000        <1> 	cmp ecx, 100
  1790 00001438 720D                <1> 	jb ten1
  1791 0000143A 81E964000000        <1> 	sub ecx, 100
  1792 00001440 FE06                <1> 	inc byte [esi]
  1793 00001442 E95BFFFFFF          <1> 	jmp cnvrt
  1794 00001447 46                  <1> ten1:	inc esi
  1795 00001448 81F90A000000        <1> 	cmp ecx, 10
  1796 0000144E 720D                <1> 	jb ten0
  1797 00001450 81E90A000000        <1> 	sub ecx, 10
  1798 00001456 FE06                <1> 	inc byte [esi]
  1799 00001458 E945FFFFFF          <1> 	jmp cnvrt
  1800 0000145D 46                  <1> ten0:	inc esi
  1801 0000145E 81F901000000        <1> 	cmp ecx, 1
  1802 00001464 720D                <1> 	jb tendn
  1803 00001466 81E901000000        <1> 	sub ecx, 1
  1804 0000146C FE06                <1> 	inc byte [esi]
  1805 0000146E E92FFFFFFF          <1> 	jmp cnvrt
  1806                              <1> tendn:
  1807 00001473 C3                  <1> 	ret
  1808                              <1> 
  1809                              <1> 	
  1810                              <1> 
  1811 00001474 00<rept>            <1> hexnumber times 8 db 0
  1812 0000147C 202000              <1> hexnumberend db "  ",0
  1813                              <1> 
  1814                              <1> 
  1815 0000147F 00000000            <1> sibuf dw 0,0
  1816 00001483 00000000            <1> dibuf dw 0,0
  1817                              <1> 
  1818                              <1> converthex:
  1819                              <1> clearbufferhex:
  1820 00001487 B030                <1> 	mov al, '0'
  1821 00001489 8935[7F140000]      <1> 	mov [sibuf], esi
  1822 0000148F 893D[83140000]      <1> 	mov [dibuf], edi
  1823 00001495 39FE                <1> clearbufhex: cmp esi, edi
  1824 00001497 7305                <1> 	jae doneclearbuffhex
  1825 00001499 8806                <1> 	mov [esi], al
  1826 0000149B 46                  <1> 	inc esi
  1827 0000149C EBF7                <1> 	jmp clearbufhex
  1828                              <1> doneclearbuffhex:
  1829 0000149E 8B35[83140000]      <1> 	mov esi, [dibuf]
  1830 000014A4 89CA                <1> 	mov edx, ecx
  1831 000014A6 81FA00000000        <1> 	cmp edx, 0
  1832 000014AC 741F                <1> 	je donenxtephx
  1833                              <1> nxtexphx:	;0x10^x
  1834 000014AE 4E                  <1> 	dec esi
  1835 000014AF 89F7                <1> 	mov edi, esi		;;location of 0x10^x
  1836 000014B1 89D1                <1> 	mov ecx, edx
  1837 000014B3 81E10F000000        <1> 	and ecx, 0xF		;;just this digit
  1838 000014B9 E81C000000          <1> 	call cnvrtexphx		;;get this digit
  1839 000014BE 89FE                <1> 	mov esi, edi
  1840 000014C0 C1EA04              <1> 	shr edx, 4		;;next digit
  1841 000014C3 81FA00000000        <1> 	cmp edx, 0
  1842 000014C9 7402                <1> 	je donenxtephx
  1843 000014CB EBE1                <1> 	jmp nxtexphx
  1844                              <1> donenxtephx:
  1845 000014CD 8B35[7F140000]      <1> 	mov esi, [sibuf]
  1846 000014D3 8B3D[83140000]      <1> 	mov edi, [dibuf]
  1847 000014D9 C3                  <1> 	ret
  1848                              <1> cnvrtexphx:			;;convert this number
  1849 000014DA 89F3                <1> 	mov ebx, esi		;place to convert to must be in si, number to convert must be in cx
  1850 000014DC 81F900000000        <1> 	cmp ecx, 0
  1851 000014E2 7429                <1> 	je zerohx
  1852 000014E4 8A06                <1> cnvrthx:  mov al, [esi]
  1853 000014E6 3C39                <1> 	cmp al, '9'
  1854 000014E8 741B                <1> 	je lettershx
  1855 000014EA 3C46                <1> lttrhxdn: cmp al, 'F'
  1856 000014EC 741F                <1> 	je zerohx
  1857 000014EE 8A06                <1> 	mov al, [esi]
  1858 000014F0 FEC0                <1> 	inc al
  1859 000014F2 8806                <1> 	mov [esi], al
  1860 000014F4 89DE                <1> 	mov esi, ebx
  1861 000014F6 81E901000000        <1> cnvrtlphx: sub ecx, 1
  1862 000014FC 81F900000000        <1> 	cmp ecx, 0
  1863 00001502 75E0                <1> 	jne cnvrthx
  1864 00001504 C3                  <1> 	ret
  1865                              <1> lettershx:
  1866 00001505 B041                <1> 	mov al, 'A'
  1867 00001507 2C01                <1> 	sub al, 1
  1868 00001509 8806                <1> 	mov [esi], al
  1869 0000150B EBDD                <1> 	jmp lttrhxdn
  1870 0000150D B030                <1> zerohx:	mov al, '0'
  1871 0000150F 8806                <1> 	mov [esi], al
  1872 00001511 4E                  <1> 	dec esi
  1873 00001512 8A06                <1> 	mov al, [esi]
  1874 00001514 3C46                <1> 	cmp al, 'F'
  1875 00001516 74F5                <1> 	je zerohx
  1876 00001518 41                  <1> 	inc ecx
  1877 00001519 EBDB                <1> 	jmp cnvrtlphx
  1878 0000151B 00                  <1> smallhex db 0
  1879 0000151C 01                  <1> firsthexshown db 1
  1880                              <1> showhexsmall:
  1881 0000151D C605[1B150000]01    <1> 	mov byte [smallhex], 1
  1882 00001524 E808000000          <1> 	call showhex
  1883 00001529 C605[1B150000]00    <1> 	mov byte [smallhex], 0
  1884 00001530 C3                  <1> 	ret
  1885                              <1> showhex:
  1886 00001531 60                  <1> 	pusha
  1887 00001532 BE[74140000]        <1> 	mov esi, hexnumber
  1888 00001537 BF[7C140000]        <1> 	mov edi, hexnumberend
  1889 0000153C E846FFFFFF          <1> 	call converthex
  1890 00001541 803D[1C150000]01    <1> 	cmp byte [firsthexshown], 1
  1891 00001548 7504                <1> 	jne showthathex
  1892 0000154A 66BA0000            <1> 	mov dx, 0
  1893                              <1> showthathex:
  1894 0000154E 803D[1C150000]03    <1> 	cmp byte [firsthexshown], 3
  1895 00001555 750A                <1> 	jne nonewhexline
  1896 00001557 BE[11490000]        <1> 	mov esi, line
  1897 0000155C E823F6FFFF          <1> 	call print
  1898                              <1> nonewhexline:
  1899 00001561 803D[1C150000]04    <1> 	cmp byte [firsthexshown], 4
  1900 00001568 7527                <1> 	jne notabfixhex
  1901 0000156A B1A0                <1> 	mov cl, 160
  1902 0000156C 28D1                <1> 	sub cl, dl
  1903 0000156E C0E905              <1> 	shr cl, 5
  1904 00001571 C0E105              <1> 	shl cl, 5
  1905 00001574 80F900              <1> 	cmp cl, 0
  1906 00001577 750F                <1> 	jne nonewlinetabfixhex
  1907 00001579 BE[11490000]        <1> 	mov esi, line
  1908 0000157E E801F6FFFF          <1> 	call print
  1909 00001583 E909000000          <1> 	jmp notabfixhex
  1910                              <1> nonewlinetabfixhex:
  1911 00001588 80C20F              <1> 	add dl, 15
  1912 0000158B C0EA04              <1> 	shr dl, 4
  1913 0000158E C0E204              <1> 	shl dl, 4
  1914                              <1> notabfixhex:
  1915 00001591 BE[74140000]        <1> 	mov esi, hexnumber
  1916 00001596 803D[1B150000]01    <1> 	cmp byte [smallhex],1
  1917 0000159D 7506                <1> 	jne printnosmallhex
  1918 0000159F 81C606000000        <1> 	add esi, 6
  1919                              <1> printnosmallhex:
  1920 000015A5 E8DAF5FFFF          <1> 	call print
  1921 000015AA 803D[1C150000]02    <1> 	cmp byte [firsthexshown], 2
  1922 000015B1 750A                <1> 	jne hexshown
  1923 000015B3 BE[11490000]        <1> 	mov esi, line
  1924 000015B8 E8C7F5FFFF          <1> 	call print
  1925                              <1> hexshown:
  1926 000015BD C605[1C150000]00    <1> 	mov byte [firsthexshown], 0
  1927 000015C4 61                  <1> 	popa
  1928 000015C5 C3                  <1> 	ret
  1929                              <1> 
  1930                              <1> 
  1931 000015C6 303030303030303030- <1> decnumber db "00000000000000"
  1932 000015CF 3030303030          <1>
  1933 000015D4 2000                <1> decnumberend: db " ",0
  1934                              <1> 
  1935                              <1> showdec: ;;same as showhex, just uses decimal conversion
  1936 000015D6 60                  <1> 	pusha
  1937 000015D7 BF[C6150000]        <1> 	mov edi, decnumber
  1938 000015DC BE[D4150000]        <1> 	mov esi, decnumberend
  1939                              <1> cleardecbuf:
  1940 000015E1 C60730              <1> 	mov byte [edi], '0'
  1941 000015E4 47                  <1> 	inc edi
  1942 000015E5 39F7                <1> 	cmp edi, esi
  1943 000015E7 72F8                <1> 	jb cleardecbuf
  1944 000015E9 BF[C6150000]        <1> 	mov edi, decnumber
  1945 000015EE E8ACFDFFFF          <1> 	call convert
  1946 000015F3 803D[1C150000]01    <1> 	cmp byte [firsthexshown], 1
  1947 000015FA 7504                <1> 	jne showthatdec
  1948 000015FC 66BA0000            <1> 	mov dx, 0
  1949                              <1> showthatdec:
  1950 00001600 803D[1C150000]03    <1> 	cmp byte [firsthexshown], 3
  1951 00001607 750A                <1> 	jne nonewdecline
  1952 00001609 BE[11490000]        <1> 	mov esi, line
  1953 0000160E E871F5FFFF          <1> 	call print
  1954                              <1> nonewdecline:
  1955 00001613 803D[1C150000]04    <1> 	cmp byte [firsthexshown], 4
  1956 0000161A 7527                <1> 	jne notabfixdec
  1957 0000161C B1A0                <1> 	mov cl, 160
  1958 0000161E 28D1                <1> 	sub cl, dl
  1959 00001620 C0E905              <1> 	shr cl, 5
  1960 00001623 C0E105              <1> 	shl cl, 5
  1961 00001626 80F900              <1> 	cmp cl, 0
  1962 00001629 750F                <1> 	jne nonewlinetabfixdec
  1963 0000162B BE[11490000]        <1> 	mov esi, line
  1964 00001630 E84FF5FFFF          <1> 	call print
  1965 00001635 E909000000          <1> 	jmp notabfixdec
  1966                              <1> nonewlinetabfixdec:
  1967 0000163A 80C20F              <1> 	add dl, 15
  1968 0000163D C0EA04              <1> 	shr dl, 4
  1969 00001640 C0E204              <1> 	shl dl, 4
  1970                              <1> notabfixdec:
  1971 00001643 BE[C6150000]        <1> 	mov esi, decnumber
  1972 00001648 4E                  <1> 	dec esi
  1973                              <1> sifind:
  1974 00001649 46                  <1> 	inc esi
  1975 0000164A 803E30              <1> 	cmp byte [esi], '0'
  1976 0000164D 74FA                <1> 	je sifind
  1977 0000164F E830F5FFFF          <1> 	call print
  1978 00001654 803D[1C150000]02    <1> 	cmp byte [firsthexshown], 2
  1979 0000165B 750A                <1> 	jne decshown
  1980 0000165D BE[11490000]        <1> 	mov esi, line
  1981 00001662 E81DF5FFFF          <1> 	call print
  1982                              <1> decshown:
  1983 00001667 C605[1C150000]00    <1> 	mov byte [firsthexshown], 0
  1984 0000166E 61                  <1> 	popa
  1985 0000166F C3                  <1> 	ret
  1986                              <1> 	
  1987                              <1> cnvrttxt: 
  1988 00001670 B900000000          <1> 	mov ecx, 0
  1989 00001675 B800000000          <1> 	mov eax, 0
  1990 0000167A BA00000000          <1> 	mov edx, 0
  1991 0000167F BB00000000          <1> 	mov ebx, 0
  1992 00001684 4E                  <1> 	dec esi
  1993                              <1> cnvrtlptxt:
  1994 00001685 46                  <1> 	inc esi
  1995 00001686 8A06                <1> 	mov al, [esi]
  1996 00001688 3C00                <1> 	cmp al, 0
  1997 0000168A 75F9                <1> 	jne cnvrtlptxt
  1998 0000168C 4E                  <1> 	dec esi
  1999 0000168D 8A06                <1> 	mov al, [esi]
  2000 0000168F 3C30                <1> 	cmp al, '0'
  2001 00001691 7504                <1> 	jne txtlp
  2002 00001693 39FE                <1> zerotest: cmp esi, edi
  2003 00001695 745B                <1> 	je donecnvrt
  2004                              <1> txtlp:	
  2005 00001697 B800000000          <1> 	mov eax, 0
  2006 0000169C 8A06                <1> 	mov al, [esi]
  2007 0000169E 3C3D                <1> 	cmp al, '='
  2008 000016A0 7450                <1> 	je donecnvrt
  2009 000016A2 3C30                <1> 	cmp al, 48
  2010 000016A4 724C                <1> 	jb donecnvrt
  2011 000016A6 3C23                <1> 	cmp al, '#'
  2012 000016A8 7448                <1> 	je donecnvrt
  2013 000016AA 39FE                <1> 	cmp esi, edi
  2014 000016AC 7244                <1> 	jb donecnvrt
  2015 000016AE 81F900000000        <1> 	cmp ecx, 0
  2016 000016B4 7708                <1> 	ja exp
  2017 000016B6 2C30                <1> noexp:	sub al, 48
  2018 000016B8 01C2                <1> 	add edx, eax
  2019 000016BA 4E                  <1> 	dec esi
  2020 000016BB 41                  <1> 	inc ecx
  2021 000016BC EBD9                <1> 	jmp txtlp
  2022 000016BE 81F900000000        <1> exp:	cmp ecx, 0
  2023 000016C4 74F0                <1> 	je noexp
  2024 000016C6 2C30                <1> 	sub al, 48
  2025 000016C8 51                  <1> 	push ecx
  2026 000016C9 89C3                <1> expmul:	mov ebx, eax
  2027 000016CB 01D8                <1> 	add eax, ebx
  2028 000016CD 01D8                <1> 	add eax, ebx
  2029 000016CF 01D8                <1> 	add eax, ebx
  2030 000016D1 01D8                <1> 	add eax, ebx
  2031 000016D3 01D8                <1> 	add eax, ebx
  2032 000016D5 01D8                <1> 	add eax, ebx
  2033 000016D7 01D8                <1> 	add eax, ebx
  2034 000016D9 01D8                <1> 	add eax, ebx
  2035 000016DB 01D8                <1> 	add eax, ebx
  2036 000016DD 81E901000000        <1> 	sub ecx, 1
  2037 000016E3 81F900000000        <1> 	cmp ecx, 0
  2038 000016E9 77DE                <1> 	ja expmul
  2039 000016EB 01C2                <1> 	add edx, eax
  2040 000016ED 59                  <1> 	pop ecx
  2041 000016EE 4E                  <1> 	dec esi
  2042 000016EF 41                  <1> 	inc ecx
  2043 000016F0 EBA5                <1> 	jmp txtlp
  2044 000016F2 89D1                <1> donecnvrt: mov ecx, edx
  2045 000016F4 C3                  <1> 	ret
  2046                                      %include 'source/builtinprogs.asm'
  2047 000016F5 050406040704        <1> filetypes db 5,4,6,4,7,4
  2048                              <1> progstart:		;programs start here
  2049                              <1> ;db 5,4,"index",0
  2050                              <1> ;	call indexfiles
  2051                              <1> ;	jmp nwcmd
  2052                              <1> indexfiles:
  2053 000016FB BE[FB160000]        <1> 	mov esi, progstart
  2054 00001700 BB[6F130000]        <1> 	mov ebx, fileindex
  2055 00001705 BF[FB160000]        <1> 	mov edi, progstart
  2056 0000170A 81EF02000000        <1> 	sub edi, 2
  2057                              <1> indexloop:
  2058 00001710 668B0E              <1> 	mov cx, [esi]
  2059                              <1> 	indexloop2:
  2060 00001713 663B0F              <1> 		cmp cx, [edi]
  2061 00001716 7424                <1> 		je indexloop2done
  2062 00001718 81EF02000000        <1> 		sub edi, 2
  2063 0000171E 81FF[F5160000]      <1> 		cmp edi, filetypes
  2064 00001724 73ED                <1> 		jae indexloop2
  2065 00001726 BF[FB160000]        <1> 	mov edi, progstart
  2066 0000172B 81EF02000000        <1> 	sub edi, 2
  2067 00001731 46                  <1> 	inc esi
  2068 00001732 81FE[3C270000]      <1> 	cmp esi, batchprogend
  2069 00001738 734E                <1> 	jae indexloopdone
  2070 0000173A EBD4                <1> 	jmp indexloop
  2071                              <1> indexloop2done:
  2072 0000173C 66890B              <1> 	mov [ebx], cx
  2073 0000173F 81C302000000        <1> 	add ebx, 2
  2074 00001745 81C602000000        <1> 	add esi, 2
  2075                              <1> 	nameindex:
  2076 0000174B 8A0E                <1> 		mov cl, [esi]
  2077 0000174D 80F900              <1> 		cmp cl, 0
  2078 00001750 7406                <1> 		je nameindexdone
  2079 00001752 880B                <1> 		mov [ebx], cl
  2080 00001754 46                  <1> 		inc esi
  2081 00001755 43                  <1> 		inc ebx
  2082 00001756 EBF3                <1> 		jmp nameindex
  2083                              <1> 	nameindexdone:
  2084 00001758 43                  <1> 		inc ebx
  2085 00001759 66C7030000          <1> 		mov word [ebx], 0
  2086 0000175E 81C302000000        <1> 		add ebx, 2
  2087 00001764 46                  <1> 		inc esi
  2088 00001765 8933                <1> 		mov [ebx], esi
  2089 00001767 81C304000000        <1> 		add ebx, 4
  2090 0000176D 66C7030000          <1> 		mov word [ebx], 0
  2091 00001772 81C302000000        <1> 		add ebx, 2
  2092 00001778 81FB[6F150000]      <1> 		cmp ebx, fileindexend
  2093 0000177E 7308                <1> 		jae indexloopdone
  2094 00001780 81C601000000        <1> 		add esi, 1
  2095 00001786 EB88                <1> 		jmp indexloop
  2096 00001788 C3                  <1> indexloopdone: 	ret
  2097                              <1> 
  2098                              <1> 
  2099                              <1> ;db 5,4,"showindex",0
  2100                              <1> ;	mov esi, fileindex
  2101                              <1> ;	mov ebx, fileindexend
  2102                              <1> ;	mov cl, 5
  2103                              <1> ;	mov ch, 4
  2104                              <1> ;	call array
  2105                              <1> ;	mov esi, fileindex
  2106                              <1> ;	mov ebx, fileindexend
  2107                              <1> ;	mov cl, 6
  2108                              <1> ;	mov ch, 4
  2109                              <1> ;	call array
  2110                              <1> ;	mov esi, fileindex
  2111                              <1> ;	mov ebx, fileindexend
  2112                              <1> ;	mov cl, 7
  2113                              <1> ;	mov ch, 4
  2114                              <1> ;	call array
  2115                              <1> ;	jmp nwcmd
  2116                              <1> 
  2117 00001789 05046C7300          <1> db 5,4,"ls",0
  2118 0000178E BE[FB160000]        <1> 	lscmd:	mov esi, progstart
  2119 00001793 BB[3C270000]        <1> 		mov ebx, progend
  2120 00001798 E9EAFAFFFF          <1> 		jmp dir
  2121                              <1> 		
  2122 0000179D 05046469736B00      <1> db 5,4,"disk",0
  2123 000017A4 B900000000          <1> 		mov ecx, 0
  2124 000017A9 8A0D[2D000000]      <1> 		mov cl, [DriveNumber]
  2125 000017AF C605[1C150000]00    <1> 		mov byte [firsthexshown], 0
  2126 000017B6 E876FDFFFF          <1> 		call showhex
  2127 000017BB BE[11490000]        <1> 		mov esi, line
  2128 000017C0 E8BFF3FFFF          <1> 		call print
  2129 000017C5 BE[5C480000]        <1> 		mov esi, diskfileindex
  2130                              <1> 	diskindexdir:
  2131 000017CA E8B5F3FFFF          <1> 		call print
  2132 000017CF 8B4E05              <1> 		mov ecx, [esi + 5]
  2133 000017D2 C605[1C150000]03    <1> 		mov byte [firsthexshown], 3
  2134 000017D9 E8F8FDFFFF          <1> 		call showdec
  2135 000017DE 56                  <1> 		push esi
  2136 000017DF BE[11490000]        <1> 		mov esi, line
  2137 000017E4 E89BF3FFFF          <1> 		call print
  2138 000017E9 5E                  <1> 		pop esi
  2139 000017EA 81C609000000        <1> 		add esi, 9
  2140 000017F0 81FE[D3480000]      <1> 		cmp esi, enddiskfileindex
  2141 000017F6 72D2                <1> 		jb diskindexdir
  2142 000017F8 E9E4F8FFFF          <1> 		jmp nwcmd
  2143                              <1> 
  2144 000017FD 0504636C65617200    <1> db 5,4,"clear",0
  2145 00001805 E86AF6FFFF          <1> 	cls:	call clear
  2146 0000180A E9D2F8FFFF          <1> 		jmp nwcmd
  2147                              <1> 		
  2148 0000180F 05047761697400      <1> db 5,4,"wait",0
  2149 00001816 B000                <1> 		mov al, 0
  2150 00001818 E826F3FFFF          <1> 		call int302
  2151 0000181D E9BFF8FFFF          <1> 		jmp nwcmd
  2152                              <1> 
  2153 00001822 05046563686F00      <1> db 5,4,"echo",0
  2154 00001829 BE[7A1B0000]        <1> 	echo:	mov esi, buftxt
  2155 0000182E 81C605000000        <1> 		add esi, 5
  2156 00001834 8A06                <1> 		mov al, [esi]
  2157 00001836 3C24                <1> 		cmp al, '$'
  2158 00001838 7414                <1> 		je echovr
  2159 0000183A E845F3FFFF          <1> 		call print
  2160 0000183F BE[11490000]        <1> 		mov esi, line
  2161 00001844 E83BF3FFFF          <1> 		call print
  2162 00001849 E993F8FFFF          <1> 		jmp nwcmd
  2163 0000184E BB[6F150000]        <1> 	echovr:	mov ebx, variables
  2164 00001853 BF06000000          <1> 		mov edi, 6
  2165 00001858 E83A000000          <1> 		call nxtvrech
  2166 0000185D E957000000          <1> 		jmp prntvr2
  2167 00001862 B13D                <1> 	echvar:	mov cl, '='
  2168 00001864 43                  <1> 		inc ebx
  2169 00001865 8A03                <1> 		mov al, [ebx]
  2170 00001867 3C00                <1> 		cmp al, 0
  2171 00001869 742C                <1> 		je nxtvrech
  2172 0000186B 3C3D                <1> 		cmp al, '='
  2173 0000186D 7420                <1> 		je nxtvrechb1
  2174 0000186F BE[7A1B0000]        <1> 		mov esi, buftxt
  2175 00001874 01FE                <1> 		add esi, edi
  2176 00001876 E8ECF9FFFF          <1> 		call cndtest
  2177 0000187B 3C02                <1> 		cmp al, 2
  2178 0000187D 7436                <1> 		je prntvr
  2179 0000187F 3C01                <1> 		cmp al, 1
  2180 00001881 7432                <1> 		je prntvr
  2181 00001883 BE[7A1B0000]        <1> 		mov esi, buftxt
  2182 00001888 01FE                <1> 		add esi, edi
  2183 0000188A E908000000          <1> 		jmp nxtvrech
  2184                              <1> 	nxtvrechb1:
  2185 0000188F 81EB02000000        <1> 		sub ebx, 2
  2186 00001895 EBCB                <1> 		jmp echvar
  2187 00001897 8A03                <1> 	nxtvrech: mov al, [ebx]
  2188 00001899 3C05                <1> 		cmp al, 5
  2189 0000189B 740F                <1> 		je nxtvrec2
  2190 0000189D 43                  <1> 		inc ebx
  2191 0000189E 81FB[6F1A0000]      <1> 		cmp ebx, varend
  2192 000018A4 0F8337F8FFFF        <1> 		jae nwcmd
  2193 000018AA EBEB                <1> 		jmp nxtvrech
  2194 000018AC 43                  <1> 	nxtvrec2: inc ebx
  2195 000018AD 8A03                <1> 		mov al, [ebx]
  2196 000018AF 3C04                <1> 		cmp al, 4
  2197 000018B1 74AF                <1> 		je echvar
  2198 000018B3 EBE2                <1> 		jmp nxtvrech
  2199 000018B5 43                  <1> 	prntvr: inc ebx
  2200 000018B6 89DE                <1> 		mov esi, ebx
  2201 000018B8 C3                  <1> 		ret
  2202 000018B9 E8C6F2FFFF          <1> 	prntvr2: call print
  2203 000018BE BE[11490000]        <1> 		mov esi, line
  2204 000018C3 E8BCF2FFFF          <1> 		call print
  2205 000018C8 E914F8FFFF          <1> 		jmp nwcmd
  2206                              <1> 		
  2207                              <1> 
  2208 000018CD 05042300            <1> db 5,4,"#",0
  2209                              <1> 	num:	
  2210 000018D1 E8B4FAFFFF          <1> 		call clearbuffer
  2211 000018D6 C605[8D1B0000]00    <1> 		mov byte [decimal], 0
  2212 000018DD C605[8E1B0000]00    <1> 		mov byte [decimal2], 0
  2213 000018E4 BE[7A1B0000]        <1> 		mov esi, buftxt
  2214 000018E9 B800000000          <1> 		mov eax, 0
  2215 000018EE B900000000          <1> 		mov ecx, 0
  2216 000018F3 BB00000000          <1> 		mov ebx, 0
  2217 000018F8 8A06                <1> 	num2:	mov al, [esi]
  2218 000018FA 3C2B                <1> 		cmp al, '+'
  2219 000018FC 741B                <1> 		je operatorfound
  2220 000018FE 3C2D                <1> 		cmp al, '-'
  2221 00001900 7417                <1> 		je operatorfound
  2222 00001902 3C2A                <1> 		cmp al, '*'
  2223 00001904 7413                <1> 		je operatorfound
  2224 00001906 3C2F                <1> 		cmp al, '/'
  2225 00001908 740F                <1> 		je operatorfound
  2226 0000190A 3C5E                <1> 		cmp al, '^'
  2227 0000190C 740B                <1> 		je operatorfound
  2228 0000190E 46                  <1> 		inc esi
  2229 0000190F 3C00                <1> 		cmp al, 0
  2230 00001911 0F84CAF7FFFF        <1> 		je near nwcmd
  2231 00001917 EBDF                <1> 		jmp num2
  2232 00001919 50                  <1> 	operatorfound: push eax
  2233 0000191A B400                <1> 		mov ah, 0
  2234 0000191C 8826                <1> 		mov [esi], ah
  2235 0000191E 89F7                <1> 		mov edi, esi
  2236 00001920 46                  <1> 		inc esi
  2237 00001921 8A06                <1> 		mov al, [esi]
  2238 00001923 3C24                <1> 		cmp al, '$'
  2239 00001925 0F8481000000        <1> 		je near varnum1
  2240 0000192B 3C25                <1> 		cmp al, '%'
  2241 0000192D 0F8469000000        <1> 		je near resultnum1
  2242                              <1> 	varnum2: 
  2243 00001933 57                  <1> 		push edi
  2244 00001934 E8C9000000          <1> 		call checkdecimal
  2245 00001939 5F                  <1> 		pop edi
  2246 0000193A E831FDFFFF          <1> 		call cnvrttxt
  2247                              <1> 	vrnm2:
  2248 0000193F 89CB                <1> 		mov ebx, ecx
  2249 00001941 53                  <1> 		push ebx
  2250 00001942 E843FAFFFF          <1> 		call clearbuffer
  2251 00001947 BE[7A1B0000]        <1> 		mov esi, buftxt
  2252 0000194C 89F7                <1> 		mov edi, esi
  2253 0000194E 46                  <1> 		inc esi
  2254 0000194F 8A06                <1> 		mov al, [esi]
  2255 00001951 3C24                <1> 		cmp al, '$'
  2256 00001953 0F8474000000        <1> 		je near varnum3
  2257 00001959 3C25                <1> 		cmp al, '%'
  2258 0000195B 0F8443000000        <1> 		je near resultnum2
  2259                              <1> 	varnum4: 
  2260 00001961 57                  <1> 		push edi
  2261 00001962 E887000000          <1> 		call checkdecimal2
  2262 00001967 5F                  <1> 		pop edi
  2263 00001968 E803FDFFFF          <1> 		call cnvrttxt
  2264                              <1> 	vrnm4:
  2265 0000196D 5B                  <1> 		pop ebx
  2266 0000196E 58                  <1> 		pop eax
  2267 0000196F 3C2B                <1> 		cmp al, '+'
  2268 00001971 0F84B9000000        <1> 		je near plusnum
  2269 00001977 3C2D                <1> 		cmp al, '-'
  2270 00001979 0F84BD000000        <1> 		je near subnum
  2271 0000197F 3C2A                <1> 		cmp al, '*'
  2272 00001981 0F84C1000000        <1> 		je near mulnum
  2273 00001987 3C2F                <1> 		cmp al, '/'
  2274 00001989 0F84CF000000        <1> 		je near divnum
  2275 0000198F 3C5E                <1> 		cmp al, '^'
  2276 00001991 0F84ED000000        <1> 		je near expnum
  2277 00001997 E945F7FFFF          <1> 		jmp nwcmd
  2278                              <1> 	resultnum1:
  2279 0000199C 8B0D[8F1B0000]      <1> 		mov ecx, [result]
  2280 000019A2 EB9B                <1> 		jmp vrnm2
  2281                              <1> 	resultnum2:
  2282 000019A4 8B0D[8F1B0000]      <1> 		mov ecx, [result]
  2283 000019AA EBC1                <1> 		jmp vrnm4
  2284 000019AC 81EE[7A1B0000]      <1> 	varnum1: sub esi, buftxt
  2285 000019B2 89F7                <1> 		mov edi, esi
  2286 000019B4 81C6[7A1B0000]      <1> 		add esi, buftxt
  2287 000019BA 47                  <1> 		inc edi
  2288 000019BB BB[6F150000]        <1> 		mov ebx, variables
  2289 000019C0 E8D2FEFFFF          <1> 		call nxtvrech
  2290 000019C5 89F7                <1> 		mov edi, esi
  2291 000019C7 4F                  <1> 		dec edi
  2292 000019C8 E966FFFFFF          <1> 		jmp varnum2
  2293 000019CD 81EE[7A1B0000]      <1> 	varnum3: sub esi, buftxt
  2294 000019D3 89F7                <1> 		mov edi, esi
  2295 000019D5 81C6[7A1B0000]      <1> 		add esi, buftxt
  2296 000019DB 47                  <1> 		inc edi
  2297 000019DC BB[6F150000]        <1> 		mov ebx, variables
  2298 000019E1 E8B1FEFFFF          <1> 		call nxtvrech
  2299 000019E6 89F7                <1> 		mov edi, esi
  2300 000019E8 4F                  <1> 		dec edi
  2301 000019E9 E973FFFFFF          <1> 		jmp varnum4
  2302                              <1> 	checkdecimal2:
  2303 000019EE 8A25[8D1B0000]      <1> 		mov ah, [decimal]
  2304 000019F4 8825[8E1B0000]      <1> 		mov [decimal2], ah
  2305 000019FA B400                <1> 		mov ah, 0
  2306 000019FC 8825[8D1B0000]      <1> 		mov [decimal], ah
  2307                              <1> 	checkdecimal:
  2308 00001A02 89F7                <1> 		mov edi, esi
  2309                              <1> 	chkdec1:
  2310 00001A04 8A07                <1> 		mov al, [edi]
  2311 00001A06 3C2E                <1> 		cmp al, '.'
  2312 00001A08 0F840B000000        <1> 		je near fnddec
  2313 00001A0E 3C00                <1> 		cmp al, 0
  2314 00001A10 0F8419000000        <1> 		je near nodecimal
  2315 00001A16 47                  <1> 		inc edi
  2316 00001A17 EBEB                <1> 		jmp chkdec1
  2317                              <1> 	fnddec:
  2318 00001A19 8A4701              <1> 		mov al, [edi + 1]
  2319 00001A1C 8807                <1> 		mov [edi], al
  2320 00001A1E 3C00                <1> 		cmp al, 0
  2321 00001A20 0F8409000000        <1> 		je near nodecimal
  2322 00001A26 FE05[8D1B0000]      <1> 		inc byte [decimal]
  2323 00001A2C 47                  <1> 		inc edi
  2324 00001A2D EBEA                <1> 		jmp fnddec
  2325                              <1> 	nodecimal:
  2326 00001A2F C3                  <1> 		ret
  2327                              <1> 	plusnum:
  2328 00001A30 E816010000          <1> 		call decaddfix
  2329 00001A35 01D9                <1> 		add ecx, ebx
  2330 00001A37 E991000000          <1> 		jmp retnum
  2331                              <1> 	subnum:
  2332 00001A3C E80A010000          <1> 		call decaddfix
  2333 00001A41 29D9                <1> 		sub ecx, ebx
  2334 00001A43 E985000000          <1> 		jmp retnum
  2335                              <1> 	mulnum:
  2336 00001A48 A0[8E1B0000]        <1> 		mov al, [decimal2]
  2337 00001A4D 0005[8D1B0000]      <1> 		add [decimal], al
  2338 00001A53 89C8                <1> 		mov eax, ecx
  2339 00001A55 F7E3                <1> 		mul ebx
  2340 00001A57 89C1                <1> 		mov ecx, eax
  2341 00001A59 E96F000000          <1> 		jmp retnum
  2342                              <1> 	divnum:
  2343 00001A5E E8E8000000          <1> 		call decaddfix
  2344 00001A63 B000                <1> 		mov al, 0
  2345 00001A65 A2[8D1B0000]        <1> 		mov [decimal], al
  2346 00001A6A 6689C8              <1> 		mov ax, cx
  2347 00001A6D 80FB00              <1> 		cmp bl, 0
  2348 00001A70 0F8457000000        <1> 		je near retnum
  2349 00001A76 F6F3                <1> 		div bl
  2350 00001A78 B900000000          <1> 		mov ecx, 0
  2351 00001A7D 88C1                <1> 		mov cl, al
  2352 00001A7F E949000000          <1> 		jmp retnum
  2353                              <1> 	expnum:
  2354 00001A84 8A15[8D1B0000]      <1> 		mov dl, [decimal]
  2355 00001A8A 8815[8E1B0000]      <1> 		mov [decimal2], dl
  2356 00001A90 BA00000000          <1> 		mov edx, 0
  2357 00001A95 89C8                <1> 		mov eax, ecx
  2358 00001A97 89D9                <1> 		mov ecx, ebx
  2359 00001A99 89C3                <1> 		mov ebx, eax
  2360 00001A9B 81F900000000        <1> 		cmp ecx, 0
  2361 00001AA1 7425                <1> 		je noexpnum
  2362 00001AA3 49                  <1> 		dec ecx
  2363 00001AA4 81F900000000        <1> 		cmp ecx, 0
  2364 00001AAA 7415                <1> 		je noexpnumlp
  2365 00001AAC F7E3                <1> 	expnumlp: mul ebx
  2366 00001AAE 8A15[8E1B0000]      <1> 		mov dl, [decimal2]
  2367 00001AB4 0015[8D1B0000]      <1> 		add [decimal], dl
  2368 00001ABA BA00000000          <1> 		mov edx, 0
  2369 00001ABF E2EB                <1> 		loop expnumlp
  2370                              <1> 	noexpnumlp:
  2371 00001AC1 89C1                <1> 		mov ecx, eax
  2372 00001AC3 E905000000          <1> 		jmp retnum
  2373                              <1> 	noexpnum:
  2374 00001AC8 B901000000          <1> 		mov ecx, 1
  2375                              <1> 	retnum: 
  2376 00001ACD BE[8E1C0000]        <1> 		mov esi, numbuf
  2377 00001AD2 890D[8F1B0000]      <1> 		mov [result], ecx
  2378 00001AD8 E8C2F8FFFF          <1> 		call convert
  2379 00001ADD BE[8E1C0000]        <1> 		mov esi, numbuf
  2380 00001AE2 8A25[8D1B0000]      <1> 		mov ah, [decimal]
  2381 00001AE8 80FC00              <1> 		cmp ah, 0
  2382 00001AEB 0F8425000000        <1> 		je near noputdecimal
  2383                              <1> 	putdecimal:
  2384 00001AF1 4E                  <1> 		dec esi
  2385 00001AF2 FECC                <1> 		dec ah
  2386 00001AF4 80FC00              <1> 		cmp ah, 0
  2387 00001AF7 0F87F4FFFFFF        <1> 		ja near putdecimal
  2388 00001AFD 4E                  <1> 		dec esi
  2389 00001AFE 8A06                <1> 		mov al, [esi]
  2390 00001B00 C6062E              <1> 		mov byte [esi], '.'
  2391                              <1> 	decputloop:
  2392 00001B03 4E                  <1> 		dec esi
  2393 00001B04 8A26                <1> 		mov ah, [esi]
  2394 00001B06 8806                <1> 		mov [esi], al
  2395 00001B08 88E0                <1> 		mov al, ah
  2396 00001B0A 81FE[7A1C0000]      <1> 		cmp esi, buf2
  2397 00001B10 0F87EDFFFFFF        <1> 		ja near decputloop
  2398                              <1> 	noputdecimal:
  2399 00001B16 BE[7A1C0000]        <1> 		mov esi, buf2
  2400 00001B1B E809000000          <1> 		call chkadd
  2401 00001B20 E9BCF5FFFF          <1> 		jmp nwcmd
  2402 00001B25 00000000            <1> edxnumbuf dw 0,0
  2403 00001B29 8A06                <1> 	chkadd: mov al, [esi]
  2404 00001B2B 3C30                <1> 		cmp al, '0'
  2405 00001B2D 750C                <1> 		jne dnadd
  2406 00001B2F 46                  <1> 		inc esi
  2407 00001B30 81FE[8E1C0000]      <1> 		cmp esi, numbuf
  2408 00001B36 7402                <1> 		je dnaddm1
  2409 00001B38 EBEF                <1> 		jmp chkadd
  2410 00001B3A 4E                  <1> 	dnaddm1: dec esi
  2411 00001B3B E844F0FFFF          <1> 	dnadd:	call print
  2412 00001B40 BE[11490000]        <1> 		mov esi, line
  2413 00001B45 E83AF0FFFF          <1> 		call print
  2414 00001B4A C3                  <1> 		ret
  2415                              <1> 		
  2416                              <1> 	decaddfix:
  2417 00001B4B A0[8E1B0000]        <1> 		mov al, [decimal2]
  2418 00001B50 8A25[8D1B0000]      <1> 		mov ah, [decimal]
  2419 00001B56 38E0                <1> 		cmp al, ah
  2420 00001B58 7432                <1> 		je gooddecadd
  2421 00001B5A 38E0                <1> 		cmp al, ah
  2422 00001B5C 721A                <1> 		jb lowdecadd
  2423                              <1> 	highdecadd:
  2424 00001B5E FEC4                <1> 		inc ah
  2425 00001B60 89CA                <1> 		mov edx, ecx
  2426 00001B62 C1E103              <1> 		shl ecx, 3
  2427 00001B65 01D1                <1> 		add ecx, edx
  2428 00001B67 01D1                <1> 		add ecx, edx
  2429 00001B69 38E0                <1> 		cmp al, ah
  2430 00001B6B 77F1                <1> 		ja highdecadd
  2431 00001B6D 8825[8D1B0000]      <1> 		mov [decimal], ah
  2432 00001B73 E914000000          <1> 		jmp gooddecadd
  2433                              <1> 	lowdecadd:
  2434 00001B78 FEC0                <1> 		inc al
  2435 00001B7A 89DA                <1> 		mov edx, ebx
  2436 00001B7C C1E303              <1> 		shl ebx, 3
  2437 00001B7F 01D3                <1> 		add ebx, edx
  2438 00001B81 01D3                <1> 		add ebx, edx
  2439 00001B83 38E0                <1> 		cmp al, ah
  2440 00001B85 72F1                <1> 		jb lowdecadd
  2441 00001B87 A2[8D1B0000]        <1> 		mov [decimal], al
  2442                              <1> 	gooddecadd:
  2443 00001B8C C3                  <1> 		ret
  2444                              <1> 		
  2445 00001B8D 00                  <1> decimal db 0
  2446 00001B8E 00                  <1> decimal2 db 0
  2447 00001B8F 00000000            <1> result db 0,0,0,0
  2448                              <1> 	
  2449 00001B93 05042500            <1> db 5,4,"%",0
  2450 00001B97 E8EEF7FFFF          <1> 	ans:	call clearbuffer
  2451 00001B9C 8B0D[8F1B0000]      <1> 		mov ecx, [result]
  2452 00001BA2 BE[7A1C0000]        <1> 		mov esi, buf2
  2453 00001BA7 E8F3F7FFFF          <1> 		call convert
  2454 00001BAC BE[7A1C0000]        <1> 		mov esi, buf2
  2455 00001BB1 E873FFFFFF          <1> 		call chkadd
  2456 00001BB6 E926F5FFFF          <1> 		jmp nwcmd
  2457                              <1> 
  2458 00001BBB 05042400            <1> db 5,4,"$",0
  2459 00001BBF BE[7A1B0000]        <1> var: mov esi, buftxt
  2460 00001BC4 BB[6F150000]        <1> 	mov ebx, variables
  2461 00001BC9 8A06                <1> lkeq:	mov al, [esi]
  2462 00001BCB 3C3D                <1> 	cmp al, '='
  2463 00001BCD 741F                <1> 	je eqfnd	;is there an '=' sign?
  2464 00001BCF 3C00                <1> 	cmp al, 0
  2465 00001BD1 7403                <1> 	je echovars
  2466 00001BD3 46                  <1> 	inc esi
  2467 00001BD4 EBF3                <1> 	jmp lkeq
  2468 00001BD6 BE[6F150000]        <1> echovars: mov esi, variables
  2469 00001BDB BB[6F1A0000]        <1> 	mov ebx, varend
  2470 00001BE0 B105                <1> 	mov cl, 5
  2471 00001BE2 B504                <1> 	mov ch, 4
  2472 00001BE4 E840F7FFFF          <1> 	call array
  2473 00001BE9 E9F3F4FFFF          <1> 	jmp nwcmd
  2474 00001BEE 46                  <1> eqfnd:	inc esi
  2475 00001BEF 8A06                <1> 	mov al, [esi]
  2476 00001BF1 3C00                <1> 	cmp al, 0
  2477 00001BF3 740F                <1> 	je readvar
  2478 00001BF5 BE[7A1B0000]        <1> 	mov esi, buftxt
  2479 00001BFA BB[6F150000]        <1> 	mov ebx, variables
  2480 00001BFF E91E000000          <1> 	jmp seek
  2481                              <1> readvar:
  2482 00001C04 B00D                <1> 	mov al, 13
  2483 00001C06 66BB0700            <1> 	mov bx, 7
  2484 00001C0A C605[D30B0000]00    <1> 	mov byte [commandedit], 0
  2485 00001C11 E8C6EFFFFF          <1> 	call int305
  2486 00001C16 BE[11490000]        <1> 	mov esi, line
  2487 00001C1B E864EFFFFF          <1> 	call print
  2488 00001C20 EB9D                <1> 	jmp var
  2489 00001C22 668B03              <1> seek:	mov ax, [ebx]
  2490 00001C25 B105                <1> 	mov cl, 5
  2491 00001C27 B504                <1> 	mov ch, 4
  2492 00001C29 663D0000            <1> 	cmp ax, 0
  2493 00001C2D 0F8459000000        <1> 	je near save
  2494 00001C33 6639C8              <1> 	cmp ax, cx
  2495 00001C36 7403                <1> 	je skfnd
  2496 00001C38 43                  <1> 	inc ebx
  2497 00001C39 EBE7                <1> 	jmp seek
  2498 00001C3B BE[7A1B0000]        <1> skfnd:	mov esi, buftxt
  2499 00001C40 46                  <1> 	inc esi
  2500 00001C41 81C302000000        <1> 	add ebx, 2
  2501 00001C47 89DF                <1> 	mov edi, ebx
  2502 00001C49 B13D                <1> 	mov cl, '='
  2503 00001C4B E817F6FFFF          <1> 	call cndtest
  2504 00001C50 3C01                <1> 	cmp al, 1	
  2505 00001C52 7417                <1> 	je varfnd
  2506 00001C54 89FB                <1> 	mov ebx, edi
  2507 00001C56 BE[7A1B0000]        <1> 	mov esi, buftxt
  2508 00001C5B 668B03              <1> 	mov ax, [ebx]
  2509 00001C5E 663D0000            <1> 	cmp ax, 0
  2510 00001C62 0F8424000000        <1> 	je near save
  2511 00001C68 43                  <1> 	inc ebx
  2512 00001C69 EBB7                <1> 	jmp seek
  2513 00001C6B 8A03                <1> varfnd:	mov al, [ebx]
  2514 00001C6D 3C04                <1> 	cmp al, 4
  2515 00001C6F 7404                <1> 	je save2
  2516 00001C71 4B                  <1> 	dec ebx
  2517 00001C72 4E                  <1> 	dec esi
  2518 00001C73 EBF6                <1> 	jmp varfnd
  2519 00001C75 4B                  <1> save2:	dec ebx
  2520 00001C76 4E                  <1> 	dec esi
  2521 00001C77 8A03                <1> 	mov al, [ebx]
  2522 00001C79 3C05                <1> 	cmp al, 5
  2523 00001C7B 7402                <1> 	je remove
  2524 00001C7D EBEC                <1> 	jmp varfnd
  2525 00001C7F 8A03                <1> remove: mov al, [ebx]
  2526 00001C81 3C00                <1> 	cmp al, 0
  2527 00001C83 749D                <1> 	je seek
  2528 00001C85 B000                <1> 	mov al, 0
  2529 00001C87 8803                <1> 	mov [ebx], al
  2530 00001C89 43                  <1> 	inc ebx
  2531 00001C8A EBF3                <1> 	jmp remove	;do not need for now-need defragmentation
  2532 00001C8C BE[7A1B0000]        <1> save:	mov esi, buftxt
  2533 00001C91 43                  <1> 	inc ebx
  2534 00001C92 B005                <1> 	mov al, 5
  2535 00001C94 B404                <1> 	mov ah, 4
  2536 00001C96 668903              <1> 	mov [ebx], ax
  2537 00001C99 43                  <1> 	inc ebx
  2538 00001C9A 43                  <1> svhere:	inc ebx
  2539 00001C9B 46                  <1> 	inc esi
  2540 00001C9C 8A06                <1> 	mov al, [esi]
  2541 00001C9E 3C00                <1> 	cmp al, 0
  2542 00001CA0 0F8442000000        <1> 	je near svdone
  2543 00001CA6 3C25                <1> 	cmp al, '%'
  2544 00001CA8 7404                <1> 	je ans2
  2545 00001CAA 8803                <1> 	mov [ebx], al	
  2546 00001CAC EBEC                <1> 	jmp svhere
  2547 00001CAE 56                  <1> ans2:	push esi
  2548 00001CAF BE[7A1C0000]        <1> 	mov esi, buf2
  2549 00001CB4 E823000000          <1> 	call ansfnd
  2550 00001CB9 E803000000          <1> 	call anscp
  2551 00001CBE 5E                  <1> 	pop esi
  2552 00001CBF EBD9                <1> 	jmp svhere
  2553 00001CC1 8A06                <1> anscp:	mov al, [esi]
  2554 00001CC3 8803                <1> 	mov [ebx], al
  2555 00001CC5 81FE[8E1C0000]      <1> 	cmp esi, numbuf
  2556 00001CCB 74CD                <1> 	je svhere
  2557 00001CCD 3C00                <1> 	cmp al, 0
  2558 00001CCF 74C9                <1> 	je svhere
  2559 00001CD1 43                  <1> 	inc ebx
  2560 00001CD2 46                  <1> 	inc esi
  2561 00001CD3 EBEC                <1> 	jmp anscp
  2562 00001CD5 5E                  <1> ansnf:	pop esi
  2563 00001CD6 8A06                <1> 	mov al, [esi]
  2564 00001CD8 8803                <1> 	mov [ebx], al
  2565 00001CDA EBBE                <1> 	jmp svhere
  2566 00001CDC 46                  <1> ansfnd:	inc esi
  2567 00001CDD 8A06                <1> 	mov al, [esi]
  2568 00001CDF 3C00                <1> 	cmp al, 0
  2569 00001CE1 74F2                <1> 	je ansnf
  2570 00001CE3 3C30                <1> 	cmp al, '0'
  2571 00001CE5 74F5                <1> 	je ansfnd
  2572 00001CE7 C3                  <1> 	ret
  2573 00001CE8 B000                <1> svdone:	mov al, 0
  2574 00001CEA 8803                <1> 	mov [ebx], al
  2575 00001CEC E9F0F3FFFF          <1> 	jmp nwcmd
  2576                              <1> 	
  2577 00001CF1 05046C6F676F757400  <1> 	db 5,4,"logout",0
  2578                              <1> logout:
  2579 00001CFA E9C8F2FFFF          <1> 	jmp os
  2580                              <1> 	
  2581 00001CFF 05047265626F6F7400  <1> 	db 5,4,"reboot",0
  2582                              <1> rebootcomp:
  2583 00001D08 E919E5FFFF          <1> 	jmp coldboot
  2584                              <1> 
  2585 00001D0D 050473687574646F77- <1> 	db 5,4,"shutdown",0
  2586 00001D16 6E00                <1>
  2587                              <1> shutdowncomp:
  2588 00001D18 E9DFE4FFFF          <1> 	jmp shutdown
  2589                              <1> 	
  2590                              <1> 	
  2591 00001D1D 05042E2F00          <1> 	db 5,4,"./",0
  2592                              <1> rundiskprog:
  2593 00001D22 BF[7A1B0000]        <1> 	mov edi, buftxt
  2594 00001D27 81C702000000        <1> 	add edi, 2
  2595 00001D2D BE00001000          <1> 	mov esi, 0x100000
  2596 00001D32 E86F290000          <1> 	call loadfile
  2597 00001D37 81FA94010000        <1> 	cmp edx, 404
  2598 00001D3D 7414                <1> 	je noprogfound
  2599 00001D3F BB00001000          <1> 	mov ebx, 0x100000
  2600 00001D44 66813B4558          <1> 	cmp word [ebx], "EX"
  2601 00001D49 7531                <1> 	jne progbatchfound
  2602 00001D4B 81C302000000        <1> 	add ebx, 2
  2603 00001D51 FFE3                <1> 	jmp ebx
  2604                              <1> noprogfound:
  2605 00001D53 BE[D8480000]        <1> 	mov esi, notfound1
  2606 00001D58 E827EEFFFF          <1> 	call print
  2607 00001D5D BE[7A1B0000]        <1> 	mov esi, buftxt
  2608 00001D62 81C602000000        <1> 	add esi, 2
  2609 00001D68 E817EEFFFF          <1> 	call print
  2610 00001D6D BE[E2480000]        <1> 	mov esi, notfound2
  2611 00001D72 E80DEEFFFF          <1> 	call print
  2612 00001D77 E965F3FFFF          <1> 	jmp nwcmd
  2613                              <1> progbatchfound:
  2614 00001D7C BF00001000          <1> 		mov edi, 0x100000
  2615 00001D81 C605[69130000]01    <1> 		mov byte [BATCHISON], 1
  2616                              <1> 	batchrunloop:
  2617 00001D88 E831F3FFFF          <1> 		call buftxtclear
  2618 00001D8D BE[7A1B0000]        <1> 		mov esi, buftxt
  2619                              <1> 	batchrunloop2:
  2620 00001D92 B10D                <1> 		mov cl, 13
  2621 00001D94 B50A                <1> 		mov ch, 10
  2622 00001D96 66390F              <1> 		cmp [edi], cx
  2623 00001D99 0F841E000000        <1> 		je near nxtbatchrunline
  2624 00001D9F 66C1C108            <1> 		rol cx, 8
  2625 00001DA3 66390F              <1> 		cmp [edi], cx
  2626 00001DA6 0F8411000000        <1> 		je near nxtbatchrunline
  2627 00001DAC 803F00              <1> 		cmp byte [edi], 0
  2628 00001DAF 0F8408000000        <1> 		je near nxtbatchrunline
  2629 00001DB5 8A07                <1> 		mov al, [edi]
  2630 00001DB7 8806                <1> 		mov [esi], al
  2631 00001DB9 46                  <1> 		inc esi
  2632 00001DBA 47                  <1> 		inc edi
  2633 00001DBB EBD5                <1> 		jmp batchrunloop2
  2634                              <1> 	nxtbatchrunline:
  2635 00001DBD 81C702000000        <1> 		add edi, 2
  2636 00001DC3 893D[221E0000]      <1> 		mov [batchedi], edi
  2637 00001DC9 C60600              <1> 		mov byte [esi], 0
  2638 00001DCC BE[7A1B0000]        <1> 		mov esi, buftxt
  2639 00001DD1 803E00              <1> 		cmp byte [esi], 0
  2640 00001DD4 0F843C000000        <1> 		je near nobatchfoundrun
  2641 00001DDA BB00000000          <1> 		mov ebx, 0
  2642 00001DDF 8A1D[00130000]      <1> 		mov bl, [IFON]
  2643 00001DE5 80FB01              <1> 		cmp bl, 1
  2644 00001DE8 0F8338000000        <1> 		jae near iftestbatch
  2645                              <1> 	doneiftest:
  2646 00001DEE 803D[E91E0000]00    <1> 		cmp byte [runnextline], 0
  2647 00001DF5 0F8405000000        <1> 		je near noruniftest
  2648 00001DFB E8B2F3FFFF          <1> 		call progtest
  2649                              <1> 	noruniftest:
  2650 00001E00 C605[E91E0000]01    <1> 		mov byte [runnextline], 1
  2651 00001E07 8B3D[221E0000]      <1> 		mov edi, [batchedi]
  2652 00001E0D 803F00              <1> 		cmp byte [edi], 0
  2653 00001E10 0F8572FFFFFF        <1> 		jne near batchrunloop
  2654                              <1> 	nobatchfoundrun:
  2655 00001E16 C605[69130000]00    <1> 		mov byte [BATCHISON], 0
  2656 00001E1D E9BFF2FFFF          <1> 		jmp nwcmd
  2657                              <1> 	
  2658 00001E22 00000000            <1> batchedi dd 0	
  2659                              <1> 	
  2660                              <1> 	iftestbatch:
  2661 00001E26 BE[01130000]        <1> 		mov esi, IFTRUE
  2662 00001E2B 01DE                <1> 		add esi, ebx
  2663 00001E2D 803E00              <1> 		cmp byte [esi], 0
  2664 00001E30 0F85B8FFFFFF        <1> 		jne near doneiftest
  2665 00001E36 881D[EA1E0000]      <1> 		mov [iffalsebuf], bl
  2666 00001E3C 803D[6A130000]01    <1> 		cmp byte [LOOPON], 1
  2667 00001E43 750B                <1> 		jne fifindbatch
  2668 00001E45 8B3D[6B130000]      <1> 		mov edi, [LOOPPOS]
  2669 00001E4B E938FFFFFF          <1> 		jmp batchrunloop
  2670                              <1> 	fifindbatch:
  2671 00001E50 66B96966            <1> 		mov cx, "if"
  2672 00001E54 66B86669            <1> 		mov ax, "fi"
  2673 00001E58 663907              <1> 		cmp [edi], ax
  2674 00001E5B 0F841A000000        <1> 		je near fifoundbatch
  2675 00001E61 66390F              <1> 		cmp [edi], cx
  2676 00001E64 0F8462000000        <1> 		je near iffoundbatch
  2677 00001E6A 803F00              <1> 		cmp byte [edi], 0
  2678 00001E6D 0F8408000000        <1> 		je near fifoundbatch
  2679 00001E73 81C702000000        <1> 		add edi, 2
  2680 00001E79 EBD5                <1> 		jmp fifindbatch
  2681                              <1> 	fifoundbatch:
  2682 00001E7B 81C702000000        <1> 		add edi, 2
  2683 00001E81 B00D                <1> 		mov al, 13
  2684 00001E83 B40A                <1> 		mov ah, 10
  2685 00001E85 663907              <1> 		cmp [edi], ax
  2686 00001E88 7414                <1> 		je goodfibatch
  2687 00001E8A 66C1C008            <1> 		rol ax, 8
  2688 00001E8E 663907              <1> 		cmp [edi], ax
  2689 00001E91 740B                <1> 		je goodfibatch
  2690 00001E93 803F00              <1> 		cmp byte [edi], 0
  2691 00001E96 0F847AFFFFFF        <1> 		je near nobatchfoundrun
  2692 00001E9C EBB2                <1> 		jmp fifindbatch
  2693                              <1> 	goodfibatch:
  2694 00001E9E B001                <1> 		mov al, 1
  2695 00001EA0 2805[00130000]      <1> 		sub [IFON], al 
  2696 00001EA6 A0[00130000]        <1> 		mov al, [IFON]
  2697 00001EAB 8A1D[EA1E0000]      <1> 		mov bl, [iffalsebuf]
  2698 00001EB1 38D8                <1> 		cmp al, bl
  2699 00001EB3 779B                <1> 		ja fifindbatch
  2700 00001EB5 BE[7A1B0000]        <1> 		mov esi, buftxt
  2701 00001EBA 81EF02000000        <1> 		sub edi, 2
  2702 00001EC0 C605[E91E0000]00    <1> 		mov byte [runnextline], 0
  2703 00001EC7 E9BCFEFFFF          <1> 		jmp batchrunloop
  2704                              <1> 	iffoundbatch:
  2705 00001ECC B020                <1> 		mov al, ' '
  2706 00001ECE 81C702000000        <1> 		add edi, 2
  2707 00001ED4 3807                <1> 		cmp [edi], al
  2708 00001ED6 0F8574FFFFFF        <1> 		jne near fifindbatch
  2709 00001EDC B001                <1> 		mov al, 1
  2710 00001EDE 0005[00130000]      <1> 		add [IFON], al
  2711 00001EE4 E967FFFFFF          <1> 		jmp fifindbatch
  2712                              <1> 		
  2713                              <1> 		
  2714 00001EE9 01                  <1> runnextline db 1
  2715 00001EEA 00                  <1> iffalsebuf db 0
  2716                              <1> 
  2717 00001EEB E9F1F1FFFF          <1> notbatch: jmp nwcmd
  2718                              <1> 
  2719 00001EF0 05047768696C6500    <1> 	db 5,4,"while",0
  2720 00001EF8 B000                <1> whilecmd:  mov al, 0
  2721 00001EFA 3805[69130000]      <1> 	cmp [BATCHISON], al
  2722 00001F00 0F84E5FFFFFF        <1> 	je near notbatch
  2723 00001F06 8B35[65130000]      <1> 	MOV esi, [BATCHPOS]
  2724 00001F0C 4E                  <1> whilefnd: dec esi
  2725 00001F0D 8A06                <1> 	mov al, [esi]
  2726 00001F0F 3C0A                <1> 	cmp al, 10
  2727 00001F11 0F8412000000        <1> 	je near whilefnd2
  2728 00001F17 3C0D                <1> 	cmp al, 13
  2729 00001F19 0F840A000000        <1> 	je near whilefnd2
  2730 00001F1F 3C00                <1> 	cmp al, 0
  2731 00001F21 0F8402000000        <1> 	je near whilefnd2
  2732 00001F27 EBE3                <1> 	jmp whilefnd
  2733                              <1> whilefnd2:
  2734 00001F29 8935[6B130000]      <1> 	mov [LOOPPOS], esi
  2735 00001F2F C605[6A130000]01    <1> 	mov BYTE [LOOPON], 1
  2736 00001F36 0005[00130000]      <1> 	add [IFON], al
  2737 00001F3C BE[7A1B0000]        <1> 	mov esi, buftxt
  2738 00001F41 BB[7A1B0000]        <1> 	mov ebx, buftxt
  2739 00001F46 81C306000000        <1> 	add ebx, 6
  2740 00001F4C E923000000          <1> 	jmp chkeqsn
  2741                              <1> 
  2742                              <1> 
  2743 00001F51 0504696600          <1> 	db 5,4,"if",0
  2744 00001F56 B000                <1> ifcmd:	mov al, 0
  2745 00001F58 3805[69130000]      <1> 	cmp [BATCHISON], al
  2746 00001F5E 0F8487FFFFFF        <1> 	je near notbatch
  2747 00001F64 BE[7A1B0000]        <1> 	mov esi, buftxt
  2748 00001F69 BB[7A1B0000]        <1> 	mov ebx, buftxt
  2749 00001F6E 81C303000000        <1> 	add ebx, 3
  2750 00001F74 8A06                <1> chkeqsn: mov al, [esi]
  2751 00001F76 3C00                <1> 	cmp al, 0
  2752 00001F78 0F846DFFFFFF        <1> 	je near notbatch
  2753 00001F7E 3C3D                <1> 	cmp al, '='
  2754 00001F80 0F8403000000        <1> 	je near chkeqdn
  2755 00001F86 46                  <1> 	inc esi
  2756 00001F87 EBEB                <1> 	jmp chkeqsn
  2757 00001F89 B000                <1> chkeqdn: mov al, 0 
  2758 00001F8B 8806                <1> 	mov [esi], al
  2759 00001F8D 46                  <1> 	inc esi
  2760 00001F8E 8A06                <1> 	mov al, [esi]
  2761 00001F90 3C24                <1> 	cmp al, '$'
  2762 00001F92 0F8462000000        <1> 	je near ifvar1
  2763 00001F98 8A03                <1> ifvar2: mov al, [ebx]
  2764 00001F9A 3C24                <1> 	cmp al, '$'
  2765 00001F9C 0F847B000000        <1> 	je near ifvar3
  2766 00001FA2 E886F2FFFF          <1> ifvar4:	call tester
  2767 00001FA7 3C01                <1> 	cmp al, 1
  2768 00001FA9 0F8405000000        <1> 	je near trueif
  2769 00001FAF E923000000          <1> 	jmp falseif
  2770 00001FB4 B800000000          <1> trueif:	mov eax, 0
  2771 00001FB9 A0[00130000]        <1> 	mov al, [IFON]
  2772 00001FBE FEC0                <1> 	inc al
  2773 00001FC0 A2[00130000]        <1> 	mov [IFON], al
  2774 00001FC5 B400                <1> 	mov ah, 0
  2775 00001FC7 BE[01130000]        <1> 	mov esi, IFTRUE
  2776 00001FCC 01C6                <1> 	add esi, eax
  2777 00001FCE B401                <1> 	mov ah, 1
  2778 00001FD0 8826                <1> 	mov [esi], ah
  2779 00001FD2 E90AF1FFFF          <1> 	jmp nwcmd
  2780 00001FD7 B800000000          <1> falseif: mov eax, 0
  2781 00001FDC A0[00130000]        <1> 	mov al, [IFON]
  2782 00001FE1 FEC0                <1> 	inc al
  2783 00001FE3 A2[00130000]        <1> 	mov [IFON], al
  2784 00001FE8 B400                <1> 	mov ah, 0
  2785 00001FEA BE[01130000]        <1> 	mov esi, IFTRUE
  2786 00001FEF 01C6                <1> 	add esi, eax
  2787 00001FF1 B400                <1> 	mov ah, 0
  2788 00001FF3 8826                <1> 	mov [esi], ah
  2789 00001FF5 E9E7F0FFFF          <1> 	jmp nwcmd
  2790 00001FFA 89F7                <1> ifvar1: mov edi, esi
  2791 00001FFC 81EF[7A1B0000]      <1> 	sub edi, buftxt
  2792 00002002 47                  <1> 	inc edi
  2793 00002003 BB[6F150000]        <1> 	mov ebx, variables
  2794 00002008 E88AF8FFFF          <1> 	call nxtvrech
  2795 0000200D BB[7A1B0000]        <1> 	mov ebx, buftxt
  2796 00002012 81C303000000        <1> 	add ebx, 3
  2797 00002018 E97BFFFFFF          <1> 	jmp ifvar2
  2798 0000201D 8935[3D200000]      <1> ifvar3: mov [esiif], esi
  2799 00002023 BF04000000          <1> 	mov edi, 4
  2800 00002028 BB[6F150000]        <1> 	mov ebx, variables
  2801 0000202D E865F8FFFF          <1> 	call nxtvrech
  2802 00002032 8B35[3D200000]      <1> 	mov esi, [esiif]
  2803 00002038 E965FFFFFF          <1> 	jmp ifvar4
  2804                              <1> 
  2805 0000203D 00000000            <1> esiif dd 0
  2806                              <1> 	
  2807 00002041 0504656C736500      <1> 	db 5,4,"else",0
  2808 00002048 B800000000          <1> elsecmd:	mov eax, 0
  2809 0000204D A0[00130000]        <1> 	mov al, [IFON]
  2810 00002052 BE[01130000]        <1> 	mov esi, IFTRUE
  2811 00002057 01C6                <1> 	add esi, eax
  2812 00002059 8A06                <1> 	mov al, [esi]
  2813 0000205B 3C00                <1> 	cmp al, 0		
  2814 0000205D 7409                <1> 	je else1
  2815 0000205F 3C01                <1> 	cmp al, 1
  2816 00002061 740E                <1> 	je else2
  2817 00002063 E979F0FFFF          <1> 	jmp nwcmd
  2818 00002068 B001                <1> else1:  mov al, 1
  2819 0000206A 8806                <1> 	mov [esi], al
  2820 0000206C E970F0FFFF          <1> 	jmp nwcmd
  2821 00002071 B000                <1> else2:	mov al, 0
  2822 00002073 8806                <1> 	mov [esi], al
  2823 00002075 E967F0FFFF          <1> 	jmp nwcmd
  2824                              <1> 
  2825 0000207A 05046C6F6F7000      <1> 	db 5,4,"loop",0
  2826 00002081 3805[6A130000]      <1> 	cmp [LOOPON], al
  2827 00002087 0F8405000000        <1> 	je near filoop
  2828 0000208D E94FF0FFFF          <1> 	jmp nwcmd
  2829 00002092 8B35[6B130000]      <1> filoop: mov esi, [LOOPPOS]
  2830 00002098 8935[65130000]      <1> 	mov [BATCHPOS], esi
  2831 0000209E E93EF0FFFF          <1> 	jmp nwcmd
  2832                              <1> 	
  2833                              <1> 
  2834 000020A3 0504666900          <1> 	db 5,4,"fi",0
  2835 000020A8 B000                <1> 	mov al, 0
  2836 000020AA 3805[69130000]      <1> 	cmp [BATCHISON], al
  2837 000020B0 0F8435FEFFFF        <1> 	je near notbatch
  2838 000020B6 B001                <1> fi:	mov al, 1
  2839 000020B8 2805[00130000]      <1> 	sub [IFON],al
  2840 000020BE E91EF0FFFF          <1> 	jmp nwcmd
  2841                              <1> 
  2842 000020C3 050473746F7000      <1> 	db 5,4,"stop",0
  2843 000020CA B000                <1> stop:	mov al, 0
  2844 000020CC A2[69130000]        <1> 	mov [BATCHISON], al
  2845 000020D1 A2[00130000]        <1> 	mov [IFON], al
  2846 000020D6 A2[01130000]        <1> 	mov [IFTRUE], al
  2847 000020DB A2[6A130000]        <1> 	mov [LOOPON], al
  2848 000020E0 E9FCEFFFFF          <1> 	jmp nwcmd
  2849                                      %include 'source/programs.asm'
  2850                              <1> ;db 5,4,"internet",0
  2851                              <1> 	internettest: 			;;initialize network card, lets hope this is right
  2852                              <1> 							;;^^used to^^, now tests int 30h functions		
  2853 000020E5 B403                <1> 		mov ah, 3
  2854 000020E7 CD30                <1> 		int 30h
  2855 000020E9 B401                <1> 		mov ah, 1
  2856                              <1> 		;mov esi, datmsg
  2857 000020EB 66BB0700            <1> 		mov bx, 7
  2858 000020EF B000                <1> 		mov al, 0
  2859 000020F1 CD30                <1> 		int 30h
  2860                              <1> 	    ;jmp packettest
  2861 000020F3 E9E9EFFFFF          <1> 		jmp nwcmd
  2862                              <1> ;datmsg: db "Internet has not been implemented yet.",10,13,0
  2863 000020F8 0504636861726D6170- <1> db 5,4,"charmap",0
  2864 00002101 00                  <1>
  2865 00002102 B000                <1> 	mov al, 0
  2866 00002104 66BB0700            <1> 	mov bx, 7
  2867                              <1> charmapcopy:
  2868 00002108 FEC0                <1> 	inc al
  2869 0000210A 3C08                <1> 	cmp al, 8
  2870 0000210C 74FA                <1> 	je charmapcopy
  2871 0000210E 3C0A                <1> 	cmp al, 10
  2872 00002110 74F6                <1> 	je charmapcopy
  2873 00002112 3C0D                <1> 	cmp al, 13
  2874 00002114 74F2                <1> 	je charmapcopy
  2875 00002116 3C81                <1> 	cmp al, 129
  2876 00002118 7307                <1> 	jae nomorecharmap
  2877 0000211A E88AE8FFFF          <1> 	call int301prnt
  2878 0000211F EBE7                <1> 	jmp charmapcopy
  2879                              <1> nomorecharmap:
  2880 00002121 BE[11490000]        <1> 	mov esi, line
  2881 00002126 E859EAFFFF          <1> 	call print
  2882 0000212B E9B1EFFFFF          <1> 	jmp nwcmd
  2883                              <1> 	
  2884 00002130 05046B6579636F6465- <1> db 5,4,"keycode",0
  2885 00002139 00                  <1>
  2886                              <1> keycode:
  2887 0000213A E87B060000          <1> 	call guistartin
  2888 0000213F B800000000          <1> 	mov eax, 0
  2889 00002144 66A1[400B0000]      <1> 	mov ax, [lastkey]
  2890 0000214A 80FC01              <1> 	cmp ah, 1
  2891 0000214D 0F840E000000        <1> 	je near killkeycode
  2892 00002153 B900000000          <1> 	mov ecx, 0
  2893 00002158 88E1                <1> 	mov cl, ah
  2894 0000215A E8BEF3FFFF          <1> 	call showhexsmall
  2895 0000215F EBD9                <1> 	jmp keycode
  2896                              <1> killkeycode:
  2897 00002161 BE[11490000]        <1> 	mov esi, line
  2898 00002166 E819EAFFFF          <1> 	call print
  2899 0000216B E971EFFFFF          <1> 	jmp nwcmd
  2900                              <1> 
  2901 00002170 050470636900        <1> db 5,4,"pci",0
  2902                              <1> 	pcishow:
  2903 00002176 E871230000          <1> 	call pcidump
  2904 0000217B E961EFFFFF          <1> 	jmp nwcmd
  2905                              <1> 	
  2906 00002180 050461727000        <1> db 5,4,"arp",0
  2907 00002186 E85C220000          <1> 	call arptest
  2908 0000218B E951EFFFFF          <1> 	jmp nwcmd
  2909                              <1> 
  2910 00002190 0504626174636800    <1> db 5,4,"batch",0
  2911                              <1> 	batchst: 
  2912 00002198 BF[7A1B0000]        <1> 		mov edi, buftxt
  2913 0000219D 81C706000000        <1> 		add edi, 6
  2914 000021A3 803F00              <1> 		cmp byte [edi], 0
  2915 000021A6 0F8473000000        <1> 		je near nonamefound
  2916 000021AC BE00001000          <1> 		mov esi, 0x100000
  2917 000021B1 E8F0240000          <1> 		call loadfile
  2918 000021B6 89D0                <1> 		mov eax, edx
  2919 000021B8 3D94010000          <1> 		cmp eax, 404
  2920 000021BD 746F                <1> 		je goodbatchname
  2921 000021BF BE[CE210000]        <1> 		mov esi, badbatchname
  2922 000021C4 E8BBE9FFFF          <1> 		call print
  2923 000021C9 E913EFFFFF          <1> 		jmp nwcmd
  2924 000021CE 546869732066696C65- <1> 		badbatchname db "This file already exists!",10,13,0
  2925 000021D7 20616C726561647920- <1>
  2926 000021E0 657869737473210A0D- <1>
  2927 000021E9 00                  <1>
  2928 000021EA 596F75206861766520- <1> 		namenotfoundbatch db "You have to type a name after the command.",10,13,0
  2929 000021F3 746F20747970652061- <1>
  2930 000021FC 206E616D6520616674- <1>
  2931 00002205 65722074686520636F- <1>
  2932 0000220E 6D6D616E642E0A0D00  <1>
  2933 00002217 00000000            <1> 		esicache3 dd 0
  2934 0000221B 00000000            <1> 		esicache2 dd 0
  2935                              <1> 	nonamefound:
  2936 0000221F BE[EA210000]        <1> 		mov esi, namenotfoundbatch
  2937 00002224 E85BE9FFFF          <1> 		call print
  2938 00002229 E9B3EEFFFF          <1> 		jmp nwcmd
  2939                              <1> 	goodbatchname:
  2940 0000222E BE00001000          <1> 		mov esi, 0x100000
  2941                              <1> 	batchcreate:
  2942 00002233 8935[17220000]      <1> 		mov [esicache3], esi
  2943 00002239 B00D                <1> 		mov al, 13
  2944 0000223B B307                <1> 		mov bl, 7
  2945 0000223D B404                <1> 		mov ah, 4
  2946 0000223F CD30                <1> 		int 30h
  2947 00002241 8935[1B220000]      <1> 		mov [esicache2], esi
  2948 00002247 8A0E                <1> 		mov cl, [esi]
  2949 00002249 8B35[17220000]      <1> 		mov esi, [esicache3]
  2950 0000224F BB[A6220000]        <1> 		mov ebx, exitword
  2951 00002254 E80EF0FFFF          <1> 		call cndtest
  2952 00002259 3C01                <1> 		cmp al, 1
  2953 0000225B 7423                <1> 		je endbatchcreate
  2954 0000225D 3C02                <1> 		cmp al, 2
  2955 0000225F 741F                <1> 		je endbatchcreate
  2956 00002261 BE[11490000]        <1> 		mov esi, line
  2957 00002266 E819E9FFFF          <1> 		call print
  2958 0000226B 8B35[1B220000]      <1> 		mov esi, [esicache2]
  2959 00002271 B00D                <1> 		mov al, 13
  2960 00002273 B40A                <1> 		mov ah, 10
  2961 00002275 668906              <1> 		mov [esi], ax
  2962 00002278 81C602000000        <1> 		add esi, 2
  2963 0000227E EBB3                <1> 		jmp batchcreate
  2964                              <1> 	endbatchcreate:
  2965 00002280 8B35[17220000]      <1> 		mov esi, [esicache3]
  2966 00002286 B800000000          <1> 		mov eax, 0
  2967 0000228B 8806                <1> 		mov [esi], al
  2968 0000228D BE[11490000]        <1> 		mov esi, line
  2969 00002292 E8EDE8FFFF          <1> 		call print
  2970 00002297 BE00001000          <1> 		mov esi, 0x100000
  2971 0000229C E8E3E8FFFF          <1> 		call print
  2972 000022A1 E93BEEFFFF          <1> 		jmp nwcmd
  2973                              <1> 	
  2974 000022A6 5C7800              <1> 	exitword db "\x",0
  2975 000022A9 54797065205C782074- <1> 	wordmsg db "Type \x to exit.",10,13,0
  2976 000022B2 6F20657869742E0A0D- <1>
  2977 000022BB 00                  <1>
  2978                              <1> 		
  2979 000022BC 050473686F7700      <1> db 5,4,"show",0
  2980 000022C3 BF[7A1B0000]        <1> 		mov edi, buftxt
  2981 000022C8 81C705000000        <1> 		add edi, 5
  2982 000022CE BE00001000          <1> 		mov esi, 0x100000
  2983 000022D3 E8CE230000          <1> 		call loadfile
  2984 000022D8 BE00001000          <1> 		mov esi, 0x100000
  2985 000022DD 66813E424D          <1> 		cmp word [esi], "BM"
  2986 000022E2 7414                <1> 		je bmpfound
  2987 000022E4 E89BE8FFFF          <1> 		call print
  2988 000022E9 BE[11490000]        <1> 		mov esi, line
  2989 000022EE E891E8FFFF          <1> 		call print
  2990 000022F3 E9E9EDFFFF          <1> 		jmp nwcmd
  2991                              <1> bmpfound:
  2992 000022F8 803D[352D0000]00    <1> 		cmp byte [guion], 0
  2993 000022FF 0F844D000000        <1> 		je near noguibmp
  2994 00002305 BE00001000          <1> 		mov esi, 0x100000
  2995 0000230A B900000000          <1> 		mov ecx, 0
  2996 0000230F BA00000000          <1> 		mov edx, 0
  2997 00002314 B800000000          <1> 		mov eax, 0
  2998 00002319 BB00000000          <1> 		mov ebx, 0
  2999 0000231E E8271A0000          <1> 		call showbmp
  3000 00002323 B000                <1> 		mov al, 0
  3001 00002325 B405                <1> 		mov ah, 5
  3002 00002327 CD30                <1> 		int 30h
  3003 00002329 E86E080000          <1> 		call guiclear
  3004 0000232E E888100000          <1> 		call reloadallgraphics
  3005 00002333 BE[7A1B0000]        <1> 		mov esi, buftxt
  3006 00002338 81C605000000        <1> 		add esi, 5
  3007 0000233E E841E8FFFF          <1> 		call print
  3008 00002343 BE[D5230000]        <1> 		mov esi, loadedbmpmsg
  3009 00002348 E837E8FFFF          <1> 		call print
  3010 0000234D E98FEDFFFF          <1> 		jmp nwcmd
  3011                              <1> noguibmp:
  3012 00002352 BE[61230000]        <1> 		mov esi, warnguibmp
  3013 00002357 E828E8FFFF          <1> 		call print
  3014 0000235C E980EDFFFF          <1> 		jmp nwcmd
  3015 00002361 546869732063616E20- <1> warnguibmp db "This can not be done without the gui.",10,13,0
  3016 0000236A 6E6F7420626520646F- <1>
  3017 00002373 6E6520776974686F75- <1>
  3018 0000237C 742074686520677569- <1>
  3019 00002385 2E0A0D00            <1>
  3020                              <1> 
  3021                              <1> 		
  3022                              <1> filenotfound:
  3023 00002389 BE[B2230000]        <1> 		mov esi, filenf
  3024 0000238E E8F1E7FFFF          <1> 		call print
  3025 00002393 BE[7A1B0000]        <1> 		mov esi, buftxt
  3026 00002398 81C608000000        <1> 		add esi, 8
  3027 0000239E E8E1E7FFFF          <1> 		call print
  3028 000023A3 BE[BD230000]        <1> 		mov esi, filenf2
  3029 000023A8 E8D7E7FFFF          <1> 		call print
  3030 000023AD E92FEDFFFF          <1> 		jmp nwcmd
  3031 000023B2 5468652066696C6520- <1> filenf db "The file ",34,0
  3032 000023BB 2200                <1>
  3033 000023BD 2220636F756C64206E- <1> filenf2 db 34," could not be found.",13,10,0
  3034 000023C6 6F7420626520666F75- <1>
  3035 000023CF 6E642E0D0A00        <1>
  3036                              <1> 		
  3037 000023D5 206C6F616465642E0D- <1> loadedbmpmsg db " loaded.",13,10,0
  3038 000023DE 0A00                <1>
  3039                              <1> 
  3040 000023E0 050464756D7000      <1> 	db 5,4,"dump",0
  3041 000023E7 BE[7A1B0000]        <1> 	mov esi, buftxt
  3042 000023EC 81C605000000        <1> 	add esi, 5
  3043 000023F2 B900000000          <1> 	mov ecx, 0
  3044 000023F7 E874F2FFFF          <1> 	call cnvrttxt
  3045 000023FC 89CF                <1> 	mov edi, ecx
  3046 000023FE 89FE                <1> 	mov esi, edi
  3047 00002400 81C680030000        <1> 	add esi, 896
  3048 00002406 C605[1C150000]00    <1> 	mov byte [firsthexshown],0
  3049                              <1> dumphexloop:
  3050 0000240D 8B0F                <1> 	mov ecx, [edi]
  3051 0000240F E81DF1FFFF          <1> 	call showhex
  3052 00002414 81C704000000        <1> 	add edi, 4
  3053 0000241A 39F7                <1> 	cmp edi, esi
  3054 0000241C 72EF                <1> 	jb dumphexloop
  3055 0000241E E9BEECFFFF          <1> 	jmp nwcmd
  3056                              <1> 
  3057 00002423 050474696D6500      <1> db 5,4,"time",0
  3058 0000242A E823000000          <1> 	call time
  3059 0000242F BE[3C260000]        <1> 	mov esi, timeshow
  3060 00002434 E84BE7FFFF          <1> 	call print
  3061 00002439 BE[11490000]        <1> 	mov esi, line
  3062 0000243E E841E7FFFF          <1> 	call print
  3063 00002443 BE[46260000]        <1> 	mov esi, dateshow
  3064 00002448 E837E7FFFF          <1> 	call print
  3065 0000244D E98FECFFFF          <1> 	jmp nwcmd
  3066                              <1> 	time:
  3067 00002452 E86D010000          <1> 	call tstackput1
  3068 00002457 B00A                <1> 	mov al,10			;Get RTC register A
  3069 00002459 E897010000          <1> 	call tget1
  3070 0000245E A880                <1> 	test al,0x80			;Is update in progress?
  3071 00002460 75F0                <1> 	jne time				; yes, wait
  3072                              <1> 
  3073 00002462 B000                <1> 	mov al,0			;Get seconds (00 to 59)
  3074 00002464 E88C010000          <1> 	call tget1
  3075 00002469 A2[33260000]        <1> 	mov [RTCtimeSecond],al
  3076                              <1> 
  3077 0000246E B002                <1> 	mov al,0x02			;Get minutes (00 to 59)
  3078 00002470 E880010000          <1> 	call tget1
  3079 00002475 A2[34260000]        <1> 	mov [RTCtimeMinute],al
  3080                              <1> 
  3081 0000247A B004                <1> 	mov al,0x04			;Get hours (see notes)
  3082 0000247C E874010000          <1> 	call tget1
  3083 00002481 A2[35260000]        <1> 	mov [RTCtimeHour],al
  3084                              <1> 
  3085 00002486 B007                <1> 	mov al,0x07			;Get day of month (01 to 31)
  3086 00002488 E868010000          <1> 	call tget1
  3087                              <1> ;	mov ah, 0			;;fix day
  3088                              <1> ;	mov ah, al
  3089                              <1> ;	shr ah, 4
  3090                              <1> ;	shl al, 4
  3091                              <1> ;	shr al, 4
  3092                              <1> ;	cmp al, 0
  3093                              <1> ;	jne nodecahday
  3094                              <1> ;	mov al, 10
  3095                              <1> ;	dec ah
  3096                              <1> ;nodecahday:
  3097                              <1> ;	dec al
  3098                              <1> ;	shl ah, 4
  3099                              <1> ;	or al, ah
  3100 0000248D A2[36260000]        <1> 	mov [RTCtimeDay],al
  3101                              <1> 
  3102 00002492 B008                <1> 	mov al,0x08			;Get month (01 to 12)
  3103 00002494 E85C010000          <1> 	call tget1
  3104 00002499 A2[37260000]        <1> 	mov [RTCtimeMonth],al
  3105                              <1> 
  3106 0000249E B009                <1> 	mov al,0x09			;Get year (00 to 99)
  3107 000024A0 E850010000          <1> 	call tget1
  3108 000024A5 A2[38260000]        <1> 	mov [RTCtimeYear],al
  3109                              <1> 	
  3110 000024AA BE[3C260000]        <1> 	mov esi, timeshow
  3111 000024AF 8A2D[35260000]      <1> 	mov ch, [RTCtimeHour]
  3112 000024B5 E846010000          <1> 	call tput1
  3113 000024BA 8A2D[34260000]      <1> 	mov ch, [RTCtimeMinute]
  3114 000024C0 E83B010000          <1> 	call tput1
  3115 000024C5 8A2D[33260000]      <1> 	mov ch, [RTCtimeSecond]
  3116 000024CB E830010000          <1> 	call tput1
  3117 000024D0 BE[46260000]        <1> 	mov esi, dateshow
  3118 000024D5 8A2D[37260000]      <1> 	mov ch, [RTCtimeMonth]
  3119 000024DB E820010000          <1> 	call tput1
  3120 000024E0 8A2D[36260000]      <1> 	mov ch, [RTCtimeDay]
  3121 000024E6 E815010000          <1> 	call tput1
  3122 000024EB B520                <1> 	mov ch, 0x20
  3123 000024ED E80E010000          <1> 	call tput1
  3124 000024F2 4E                  <1> 	dec esi
  3125 000024F3 8A2D[38260000]      <1> 	mov ch, [RTCtimeYear]
  3126 000024F9 E802010000          <1> 	call tput1
  3127 000024FE E8DB000000          <1> 	call tstackget1
  3128 00002503 BE[3C260000]        <1> 	mov esi, timeshow
  3129 00002508 66BB0700            <1> 	mov bx, 7
  3130 0000250C B401                <1> 	mov ah, 1
  3131 0000250E B000                <1> 	mov al, 0
  3132 00002510 CD30                <1> 	int 30h
  3133                              <1> ;;get day of week
  3134                              <1> ;;add these:
  3135                              <1> ;;century value
  3136                              <1> ;;last 2 digits of year
  3137                              <1> ;;last 2 digits of year right shifted twice
  3138                              <1> ;;month table value
  3139                              <1> ;;day of the month
  3140                              <1> ;;divide these by 7
  3141                              <1> ;;the remainder is the day
  3142 00002512 B800000000          <1> 	mov eax, 0
  3143                              <1> ;;first convert the values from BCD to hex
  3144 00002517 A0[36260000]        <1> 	mov al, [RTCtimeDay]
  3145 0000251C E88A000000          <1> 	call converttohex
  3146 00002521 8825[39260000]      <1> 	mov [dayhex], ah
  3147 00002527 A0[37260000]        <1> 	mov al, [RTCtimeMonth]
  3148 0000252C E87A000000          <1> 	call converttohex
  3149 00002531 8825[3A260000]      <1> 	mov [monthhex], ah
  3150 00002537 A0[38260000]        <1> 	mov al, [RTCtimeYear]
  3151 0000253C E86A000000          <1> 	call converttohex
  3152 00002541 8825[3B260000]      <1> 	mov [yearhex], ah
  3153 00002547 B800000000          <1> 	mov eax, 0
  3154 0000254C A0[3B260000]        <1> 	mov al, [yearhex]
  3155 00002551 C0E802              <1> 	shr al, 2
  3156 00002554 0205[3B260000]      <1> 	add al, [yearhex]
  3157 0000255A 0506000000          <1> 	add eax, 6
  3158 0000255F BB00000000          <1> 	mov ebx, 0
  3159 00002564 8A1D[3A260000]      <1> 	mov bl, [monthhex]
  3160 0000256A FECB                <1> 	dec bl
  3161 0000256C 81C3[5C260000]      <1> 	add ebx, month
  3162 00002572 B900000000          <1> 	mov ecx, 0
  3163 00002577 8A0B                <1> 	mov cl, [ebx]
  3164 00002579 01C8                <1> 	add eax, ecx
  3165 0000257B 8A0D[39260000]      <1> 	mov cl, [dayhex]
  3166 00002581 01C8                <1> 	add eax, ecx
  3167 00002583 66BB0700            <1> 	mov bx, 7
  3168 00002587 BA00000000          <1> 	mov edx, 0
  3169 0000258C 66F7F3              <1> 	div bx
  3170 0000258F C1E202              <1> 	shl edx, 2
  3171 00002592 81C2[68260000]      <1> 	add edx, day
  3172 00002598 8B32                <1> 	mov esi, [edx]
  3173 0000259A 66BB0700            <1> 	mov bx, 7
  3174 0000259E B401                <1> 	mov ah, 1
  3175 000025A0 B000                <1> 	mov al, 0
  3176 000025A2 CD30                <1> 	int 30h
  3177 000025A4 66B80000            <1> 	mov ax, 0
  3178 000025A8 CD30                <1> 	int 30h
  3179 000025AA F4                  <1> 	hlt
  3180                              <1> 	
  3181                              <1> converttohex:
  3182 000025AB 88C4                <1> 	mov ah, al
  3183 000025AD C0E804              <1> 	shr al, 4
  3184 000025B0 C0E404              <1> 	shl ah, 4
  3185 000025B3 C0EC04              <1> 	shr ah, 4
  3186 000025B6 3C00                <1> 	cmp al, 0
  3187 000025B8 7409                <1> 	je noconverttohex
  3188                              <1> converttohexlp:
  3189 000025BA 80C40A              <1> 	add ah, 10
  3190 000025BD FEC8                <1> 	dec al
  3191 000025BF 3C00                <1> 	cmp al, 0
  3192 000025C1 75F7                <1> 	jne converttohexlp
  3193                              <1> noconverttohex:
  3194 000025C3 C3                  <1> 	ret
  3195                              <1> 	
  3196                              <1> tstackput1:
  3197 000025C4 8935[2F260000]      <1> 	mov [tstack + 20], esi
  3198 000025CA BE[1B260000]        <1> 	mov esi, tstack
  3199 000025CF 8906                <1> 	mov [esi], eax
  3200 000025D1 895E04              <1> 	mov [esi + 4], ebx
  3201 000025D4 894E08              <1> 	mov [esi + 8], ecx
  3202 000025D7 89560C              <1> 	mov [esi + 12], edx
  3203 000025DA 897E10              <1> 	mov [esi + 16], edi
  3204 000025DD C3                  <1> 	ret
  3205                              <1> 	
  3206                              <1> tstackget1:
  3207 000025DE BE[1B260000]        <1> 	mov esi, tstack
  3208 000025E3 8B06                <1> 	mov eax, [esi]
  3209 000025E5 8B5E04              <1> 	mov ebx, [esi + 4]
  3210 000025E8 8B4E08              <1> 	mov ecx, [esi + 8]
  3211 000025EB 8B560C              <1> 	mov edx, [esi + 12]
  3212 000025EE 8B7E10              <1> 	mov edi, [esi + 16]
  3213 000025F1 8B7614              <1> 	mov esi, [esi + 20]
  3214 000025F4 C3                  <1> 	ret
  3215                              <1> 	
  3216                              <1> tget1:
  3217 000025F5 66BA7000            <1> 	mov dx, 0x70
  3218 000025F9 EE                  <1> 	out dx, al
  3219 000025FA 6642                <1> 	inc dx
  3220 000025FC EC                  <1> 	in al, dx
  3221 000025FD 664A                <1> 	dec dx
  3222 000025FF C3                  <1> 	ret
  3223                              <1> 	
  3224                              <1> tput1:
  3225 00002600 66C1E904            <1> 	shr cx, 4
  3226 00002604 B030                <1> 	mov al, 48
  3227 00002606 00E8                <1> 	add al, ch
  3228 00002608 8806                <1> 	mov [esi], al
  3229 0000260A 46                  <1> 	inc esi
  3230 0000260B B030                <1> 	mov al, 48
  3231 0000260D C0E904              <1> 	shr cl, 4
  3232 00002610 00C8                <1> 	add al, cl
  3233 00002612 8806                <1> 	mov [esi], al
  3234 00002614 81C602000000        <1> 	add esi, 2
  3235 0000261A C3                  <1> 	ret
  3236                              <1> 		
  3237 0000261B 000000000000000000- <1> 	tstack dd 0,0,0,0,0,0
  3238 00002624 000000000000000000- <1>
  3239 0000262D 000000000000        <1>
  3240 00002633 00                  <1> 	RTCtimeSecond db 0
  3241 00002634 00                  <1> 	RTCtimeMinute db 0
  3242 00002635 00                  <1> 	RTCtimeHour db 0
  3243 00002636 00                  <1> 	RTCtimeDay db 0
  3244 00002637 00                  <1> 	RTCtimeMonth db 0
  3245 00002638 00                  <1> 	RTCtimeYear db 0
  3246 00002639 00                  <1> 	dayhex db 0
  3247 0000263A 00                  <1> 	monthhex db 0
  3248 0000263B 00                  <1> 	yearhex db 0
  3249 0000263C 30303A30303A30300D- <1> 	timeshow db "00:00:00",13,10
  3250 00002645 0A                  <1>
  3251 00002646 30302D30302D303030- <1> 	dateshow db "00-00-0000",13,10,0
  3252 0000264F 300D0A00            <1>
  3253                              <1> 	oldcentury:	;;from 1700 to 1900
  3254 00002653 040200              <1> 	db 4,2,0
  3255                              <1> 	century:	;;from 2000 to 2500
  3256 00002656 060402000604        <1> 	db 6,4,2,0,6,4
  3257                              <1> 	month:
  3258 0000265C 000303060104060205- <1> 	db 0,3,3,6,1,4,6,2,5,0,3,5
  3259 00002665 000305              <1>
  3260                              <1> 	day:
  3261 00002668 [84260000]          <1> 	dd sunday
  3262 0000266C [8D260000]          <1> 	dd monday
  3263 00002670 [96260000]          <1> 	dd tuesday
  3264 00002674 [A0260000]          <1> 	dd wednesday
  3265 00002678 [AC260000]          <1> 	dd thursday
  3266 0000267C [B7260000]          <1> 	dd friday
  3267 00002680 [C0260000]          <1> 	dd saturday
  3268                              <1> sunday:
  3269 00002684 53756E6461790D0A00  <1> 	db "Sunday",13,10,0
  3270                              <1> monday:
  3271 0000268D 4D6F6E6461790D0A00  <1> 	db "Monday",13,10,0
  3272                              <1> tuesday:
  3273 00002696 547565736461790D0A- <1> 	db "Tuesday",13,10,0
  3274 0000269F 00                  <1>
  3275                              <1> wednesday:
  3276 000026A0 5765646E6573646179- <1> 	db "Wednesday",13,10,0
  3277 000026A9 0D0A00              <1>
  3278                              <1> thursday:
  3279 000026AC 54687572736461790D- <1> 	db "Thursday",13,10,0
  3280 000026B5 0A00                <1>
  3281                              <1> friday:
  3282 000026B7 4672696461790D0A00  <1> 	db "Friday",13,10,0
  3283                              <1> saturday:
  3284 000026C0 53617475726461790D- <1> 	db "Saturday",13,10,0
  3285 000026C9 0A00                <1>
  3286                              <1> 
  3287 000026CB 0504637075696400    <1> db 5,4,"cpuid",0
  3288 000026D3 B800000000          <1> 	mov eax, 0
  3289 000026D8 0FA2                <1> 	cpuid
  3290 000026DA 891D[2F270000]      <1> 	mov [cpuidbuf], ebx
  3291 000026E0 8915[33270000]      <1> 	mov [cpuidbuf + 4], edx
  3292 000026E6 890D[37270000]      <1> 	mov [cpuidbuf + 8], ecx
  3293 000026EC BE[2F270000]        <1> 	mov esi, cpuidbuf
  3294 000026F1 E88EE4FFFF          <1> 	call print
  3295 000026F6 BE[11490000]        <1> 	mov esi, line
  3296 000026FB E884E4FFFF          <1> 	call print
  3297 00002700 B801000000          <1> 	mov eax, 1
  3298 00002705 0FA2                <1> 	cpuid
  3299 00002707 89C1                <1> 	mov ecx, eax
  3300 00002709 C605[1C150000]02    <1> 	mov byte [firsthexshown], 2
  3301 00002710 E81CEEFFFF          <1> 	call showhex
  3302 00002715 B808000080          <1> 	mov eax, 0x80000008
  3303 0000271A 0FA2                <1> 	cpuid
  3304 0000271C 89C1                <1> 	mov ecx, eax
  3305 0000271E C605[1C150000]02    <1> 	mov byte [firsthexshown], 2
  3306 00002725 E807EEFFFF          <1> 	call showhex
  3307 0000272A E9B2E9FFFF          <1> 	jmp nwcmd
  3308                              <1> 	
  3309 0000272F 00<rept>            <1> cpuidbuf times 13 db 0
  3310                              <1> cpuidvendorend:
  3311                              <1> progend:		;programs end here	
  3312                              <1> batchprogend:
  3313                                      %include 'source/input.asm'
  3314                              <1> PS2SET:
  3315 0000273C B0A8                <1>   mov  al, 0xa8		; enable mouse port
  3316 0000273E E664                <1>   out  0x64, al		; write to keyboardcontroller
  3317 00002740 E801000000          <1>   call CHKPRT		; check if command is progressed (demand!)
  3318 00002745 C3                  <1> ret
  3319                              <1> 
  3320                              <1> CHKPRT:
  3321 00002746 66B96400            <1>   mov  cx, 100
  3322                              <1>  .again:
  3323 0000274A E464                <1>   in   al, 0x64		; read from keyboardcontroller
  3324 0000274C A802                <1>   test al, 2		; Check if input buffer is empty
  3325 0000274E 7402                <1>   je .go
  3326 00002750 E2F8                <1>   loop .again
  3327                              <1>  .go:
  3328 00002752 C3                  <1> ret
  3329                              <1> 
  3330                              <1> WMOUS:
  3331 00002753 B0D4                <1>   mov  al, 0xd4		; write to mouse device instead of to keyboard
  3332 00002755 E664                <1>   out  0x64, al		; write to keyboardcontroller
  3333 00002757 E8EAFFFFFF          <1>   call CHKPRT		; check if command is progressed (demand!)
  3334 0000275C C3                  <1> ret
  3335                              <1> 
  3336                              <1> MBUFFUL:
  3337 0000275D 66B96400            <1>   mov cx, 100
  3338                              <1>  .mn:
  3339 00002761 E464                <1>   in   al, 0x64		; read from keyboardcontroller
  3340 00002763 A820                <1>   test al, 0x20		; check if mouse output buffer is full
  3341 00002765 7402                <1>   jz  .mnn
  3342 00002767 E2F8                <1>   loop .mn
  3343                              <1>  .mnn:
  3344 00002769 C3                  <1> ret
  3345                              <1> 
  3346                              <1> 
  3347                              <1> ACTMOUS:
  3348 0000276A E8E4FFFFFF          <1>   call WMOUS
  3349 0000276F B0F4                <1>   mov  al, 0xf4 	; Command to activate mouse itselve (Stream mode)
  3350 00002771 E660                <1>   out  0x60, al		; write ps/2 controller output port (activate mouse)
  3351 00002773 E8CEFFFFFF          <1>   call CHKPRT		; check if command is progressed (demand!)
  3352 00002778 E801000000          <1>   call CHKMOUS		; check if a byte is available
  3353 0000277D C3                  <1> ret
  3354                              <1> 
  3355                              <1> CHKMOUS:
  3356 0000277E B300                <1>   mov  bl, 0
  3357 00002780 66B96400            <1>   mov cx, 100
  3358                              <1>  .vrd:
  3359 00002784 E464                <1>   in   al, 0x64		; read from keyboardcontroller
  3360 00002786 A801                <1>   test al, 1		; check if controller buffer (60h) has data
  3361 00002788 7504                <1>   jnz .yy
  3362 0000278A E2F8                <1>   loop .vrd
  3363 0000278C B301                <1>   mov  bl, 1
  3364                              <1>  .yy:
  3365 0000278E C3                  <1> ret
  3366                              <1> 
  3367                              <1> GETB:
  3368                              <1>  .cagain:
  3369 0000278F E8EAFFFFFF          <1>   call CHKMOUS		; check if a byte is available
  3370 00002794 08DB                <1>   or bl, bl
  3371 00002796 75F7                <1>   jnz .cagain
  3372 00002798 B0AD                <1>   mov  al, 0xad		; Disable Keyboard
  3373 0000279A E664                <1>   out  0x64, al		; write to keyboardcontroller
  3374 0000279C E8A5FFFFFF          <1>   call CHKPRT		; check if command is progressed (demand!)
  3375 000027A1 6631C0              <1>   xor  ax, ax
  3376 000027A4 E460                <1>   in   al, 0x60		; read ps/2 controller output port (mousebyte)
  3377 000027A6 88C2                <1>   mov  dl, al
  3378 000027A8 B0AE                <1>   mov  al, 0xae		; Enable Keyboard
  3379 000027AA E664                <1>   out  0x64, al		; write to keyboardcontroller
  3380 000027AC E895FFFFFF          <1>   call CHKPRT		; check if command is progressed (demand!)
  3381 000027B1 88D0                <1>   mov  al, dl
  3382 000027B3 C3                  <1> ret
  3383                              <1> 
  3384 000027B4 00                  <1> LBUTTON db 0x00	;	Left   button status 1=PRESSED 0=RELEASED
  3385 000027B5 00                  <1> RBUTTON db 0x00	;	Right  button status 1=PRESSED 0=RELEASED
  3386 000027B6 00                  <1> MBUTTON db 0x00	;	Middle button status 1=PRESSED 0=RELEASED
  3387 000027B7 00                  <1> XCOORD  db 0x00	;	the moved distance  (horizontal)
  3388 000027B8 00                  <1> YCOORD  db 0x00	;	the moved distance  (vertical)
  3389                              <1> 
  3390 000027B9 00                  <1> specialkey db 0
  3391                              <1> 
  3392                              <1> 	guistartin:
  3393 000027BA B800000000          <1> 		mov eax, 0
  3394 000027BF A2[B9270000]        <1> 		mov [specialkey], al
  3395 000027C4 66A3[400B0000]      <1> 		mov [lastkey], ax
  3396 000027CA E464                <1> 		in al, 64h ; Status
  3397 000027CC A801                <1> 		test al, 1 ; output buffer full?
  3398 000027CE 74EA                <1> 		jz guistartin
  3399 000027D0 A820                <1> 		test al, 20h ; PS2-Mouse?
  3400 000027D2 0F850D010000        <1> 		jnz near maincall2
  3401                              <1> 	guigetkey:
  3402 000027D8 E460                <1> 		in al, 60h
  3403 000027DA 88C4                <1> 		mov ah, al
  3404 000027DC B000                <1> 		mov al, 0
  3405 000027DE 8825[410B0000]      <1> 		mov [lastkey + 1], ah
  3406 000027E4 88E0                <1> 		mov al, ah
  3407 000027E6 BF[282B0000]        <1> 		mov edi, scancode
  3408                              <1> 	guisearchscan: 
  3409 000027EB 3C3A                <1> 		cmp al, 3Ah
  3410 000027ED 7315                <1> 		jae guiscanother
  3411 000027EF B400                <1> 		mov ah, 0
  3412 000027F1 D0E0                <1> 		shl al, 1
  3413 000027F3 01C7                <1> 		add edi, eax
  3414 000027F5 D0E8                <1> 		shr al, 1
  3415 000027F7 8A27                <1> 		mov ah, [edi]
  3416 000027F9 80FC00              <1> 		cmp ah, 0
  3417 000027FC 7406                <1> 		je guiscanother
  3418 000027FE E98A000000          <1> 		jmp guiscanfound
  3419 00002803 00                  <1> guiupper db 0
  3420                              <1> guiscanother:
  3421 00002804 88C4                <1> 		mov ah, al
  3422 00002806 B000                <1> 		mov al, 0
  3423 00002808 66A3[400B0000]      <1> 		mov [lastkey], ax
  3424 0000280E 80FCE0              <1> 		cmp ah, 0E0h
  3425 00002811 0F8448000000        <1> 		je near guigetkeyspecial
  3426 00002817 B0E0                <1> 		mov al, 0xE0
  3427 00002819 3805[B9270000]      <1> 		cmp [specialkey], al
  3428 0000281F 7507                <1> 		jne nospecialkey
  3429 00002821 66A3[400B0000]      <1> 		mov [lastkey], ax
  3430 00002827 C3                  <1> 		ret
  3431                              <1> nospecialkey:
  3432                              <1> 		;cmp ah, 4Dh
  3433                              <1> 		;je near nextimage
  3434 00002828 80FC2A              <1> 		cmp ah, 2Ah
  3435 0000282B 0F8443000000        <1> 		je near guishifton
  3436 00002831 80FC36              <1> 		cmp ah, 36h
  3437 00002834 0F843A000000        <1> 		je near guishifton
  3438 0000283A 80FC1C              <1> 		cmp ah, 1Ch
  3439 0000283D 0F8449000000        <1> 		je near guientdown
  3440 00002843 80FCAA              <1> 		cmp ah, 0AAh
  3441 00002846 0F8434000000        <1> 		je near guishiftoff
  3442 0000284C 80FCB6              <1> 		cmp ah, 0B6h
  3443 0000284F 0F842B000000        <1> 		je near guishiftoff
  3444 00002855 80FC3A              <1> 		cmp ah, 3Ah
  3445 00002858 0F840D000000        <1> 		je near guishift
  3446 0000285E C3                  <1> 		ret
  3447                              <1> 	guigetkeyspecial:
  3448 0000285F B0E0                <1> 		mov al, 0xE0
  3449 00002861 A2[B9270000]        <1> 		mov [specialkey], al
  3450 00002866 E96DFFFFFF          <1> 		jmp guigetkey
  3451                              <1> 	guishift:
  3452 0000286B A0[03280000]        <1> 		mov al, [guiupper]
  3453 00002870 3C01                <1> 		cmp al, 1
  3454 00002872 730C                <1> 		jae guishiftoff
  3455                              <1> 	guishifton:
  3456 00002874 C605[03280000]01    <1> 		mov byte [guiupper], 1
  3457 0000287B E93AFFFFFF          <1> 		jmp guistartin
  3458                              <1> 	guishiftoff:
  3459 00002880 C605[03280000]00    <1> 		mov byte [guiupper], 0
  3460 00002887 E92EFFFFFF          <1> 		jmp guistartin
  3461                              <1> 	guientdown:
  3462 0000288C C3                  <1> 		ret
  3463                              <1> 	guiscanfound:
  3464 0000288D 81C701000000        <1> 		add edi, 1
  3465 00002893 803D[03280000]01    <1> 		cmp byte [guiupper], 1
  3466 0000289A 7306                <1> 		jae uppercasegui
  3467 0000289C 81EF01000000        <1> 		sub edi, 1
  3468                              <1> uppercasegui:
  3469 000028A2 8A07                <1> 		mov al,[edi]
  3470 000028A4 A2[400B0000]        <1> 		mov [lastkey], al
  3471 000028A9 C3                  <1> 		ret
  3472                              <1> 		
  3473                              <1> 		
  3474                              <1> 	cursorgui:
  3475 000028AA 803D[EE3D0000]01    <1> 		cmp byte [mouseon], 1
  3476 000028B1 0F842E000000        <1> 		je near maincall2
  3477 000028B7 803D[352D0000]00    <1> 		cmp byte [guion], 0
  3478 000028BE 74CC                <1> 		je guientdown
  3479                              <1> 	initmouse:
  3480 000028C0 803D[352D0000]00    <1> 		cmp byte [guion], 0
  3481 000028C7 7405                <1> 		je noswmsposinit
  3482 000028C9 E834050000          <1> 		call switchmousepos2
  3483                              <1> 	noswmsposinit:
  3484 000028CE E869FEFFFF          <1> 	  	call PS2SET
  3485 000028D3 E892FEFFFF          <1> 		call ACTMOUS
  3486 000028D8 C605[EE3D0000]01    <1> 		mov byte [mouseon],1
  3487 000028DF E8ABFEFFFF          <1> 		call GETB 	;;Get the responce byte of the mouse (like: Hey i am active)
  3488                              <1> 				;;If the bytes are mixed up,
  3489                              <1> 				;;remove this line or add another of this line.
  3490                              <1> 		;call GETB
  3491 000028E4 C3                  <1> 		ret
  3492                              <1> 	maincall2:
  3493 000028E5 803D[EE3D0000]01    <1> 		  cmp byte [mouseon], 1
  3494 000028EC 75D2                <1> 		  jne initmouse
  3495 000028EE E89CFEFFFF          <1> 		  call GETB
  3496 000028F3 88C3                <1> 		  mov  bl, al
  3497 000028F5 80E301              <1> 		  and  bl, 1
  3498 000028F8 881D[B4270000]      <1> 		  mov  BYTE [LBUTTON], bl
  3499 000028FE 88C3                <1> 		  mov  bl, al
  3500 00002900 80E302              <1> 		  and  bl, 2
  3501 00002903 D0EB                <1> 		  shr  bl, 1
  3502 00002905 881D[B5270000]      <1> 		  mov  BYTE [RBUTTON], bl
  3503 0000290B 88C3                <1> 		  mov  bl, al
  3504 0000290D 80E304              <1> 		  and  bl, 4
  3505 00002910 C0EB02              <1> 		  shr  bl, 2
  3506 00002913 881D[B6270000]      <1> 		  mov  BYTE [MBUTTON], bl
  3507 00002919 E871FEFFFF          <1> 		  call GETB
  3508 0000291E A2[B7270000]        <1> 		  mov  BYTE [XCOORD], al
  3509 00002923 E867FEFFFF          <1> 		  call GETB
  3510 00002928 A2[B8270000]        <1> 		  mov  BYTE [YCOORD], al
  3511                              <1> 
  3512                              <1> 	showpixelcursor:
  3513 0000292D 668B15[872A0000]    <1> 		mov dx, [mousecursorposition]
  3514 00002934 668B0D[892A0000]    <1> 		mov cx, [mousecursorposition + 2]
  3515 0000293B 668915[832A0000]    <1> 		mov [lastmouseposition], dx
  3516 00002942 66890D[852A0000]    <1> 		mov [lastmouseposition + 2], cx
  3517 00002949 A0[B7270000]        <1> 		mov al, [XCOORD]
  3518 0000294E 3C80                <1> 		cmp al, 128
  3519 00002950 730C                <1> 		jae subxcoord
  3520 00002952 00C0                <1> 		add al, al
  3521 00002954 B400                <1> 		mov ah, 0
  3522 00002956 6601C2              <1> 		add dx, ax
  3523 00002959 E90B000000          <1> 		jmp subxcoorddn
  3524                              <1> 	subxcoord:
  3525 0000295E 00C0                <1> 		add al, al
  3526 00002960 B300                <1> 		mov bl, 0
  3527 00002962 28C3                <1> 		sub bl, al
  3528 00002964 B700                <1> 		mov bh, 0
  3529 00002966 6629DA              <1> 		sub dx, bx
  3530                              <1> 	subxcoorddn:
  3531 00002969 8A1D[B8270000]      <1> 		mov bl, [YCOORD]
  3532 0000296F B000                <1> 		mov al, 0
  3533 00002971 28D8                <1> 		sub al, bl
  3534 00002973 3C80                <1> 		cmp al, 128
  3535 00002975 730A                <1> 		jae subycoord
  3536 00002977 B400                <1> 		mov ah, 0
  3537 00002979 6601C1              <1> 		add cx, ax
  3538 0000297C E909000000          <1> 		jmp subycoorddn
  3539                              <1> 	subycoord:
  3540 00002981 B300                <1> 		mov bl, 0
  3541 00002983 28C3                <1> 		sub bl, al
  3542 00002985 B700                <1> 		mov bh, 0
  3543 00002987 6629D9              <1> 		sub cx, bx
  3544                              <1> 	subycoorddn:
  3545 0000298A 6681FA204E          <1> 		cmp dx, 20000
  3546 0000298F 7604                <1> 		jbe nooriginx2
  3547 00002991 66BA0000            <1> 		mov dx, 0
  3548                              <1> 	nooriginx2:
  3549 00002995 6681F9204E          <1> 		cmp cx, 20000
  3550 0000299A 7604                <1> 		jbe nooriginy2
  3551 0000299C 66B90000            <1> 		mov cx, 0
  3552                              <1> 	nooriginy2:
  3553 000029A0 6681FA0000          <1> 		cmp dx, 0
  3554 000029A5 7415                <1> 		je nofixxcolumn2
  3555 000029A7 663B15[9B3B0000]    <1> 		cmp dx, [resolutionx2]
  3556 000029AE 720C                <1> 		jb nofixxcolumn2
  3557 000029B0 668B15[9B3B0000]    <1> 		mov dx, [resolutionx2]
  3558 000029B7 6681EA0200          <1> 		sub dx, 2
  3559                              <1> 	nofixxcolumn2:
  3560 000029BC 6681F90000          <1> 		cmp cx, 0
  3561 000029C1 7415                <1> 		je nofixyrow2
  3562 000029C3 663B0D[973B0000]    <1> 		cmp cx, [resolutiony]
  3563 000029CA 720C                <1> 		jb nofixyrow2
  3564 000029CC 668B0D[973B0000]    <1> 		mov cx, [resolutiony]
  3565 000029D3 6681E90100          <1> 		sub cx, 1
  3566                              <1> 	nofixyrow2:
  3567 000029D8 668915[872A0000]    <1> 		mov [mousecursorposition], dx
  3568 000029DF 66890D[892A0000]    <1> 		mov [mousecursorposition + 2], cx
  3569 000029E6 803D[352D0000]00    <1> 		cmp byte [guion], 0
  3570 000029ED 0F8498000000        <1> 		je near termmouse
  3571 000029F3 E8A1030000          <1> 		call switchmousepos ;;use dragging code to ensure proper icon drag
  3572 000029F8 803D[B4270000]01    <1> 		cmp byte [LBUTTON], 1
  3573 000029FF 0F847A040000        <1> 		je near clickicon
  3574 00002A05 803D[B5270000]01    <1> 		cmp byte [RBUTTON], 1
  3575 00002A0C 0F846D040000        <1> 		je near clickicon
  3576 00002A12 A0[6C2E0000]        <1> 		mov al, [pbutton]
  3577 00002A17 C705[6F2E0000]0000- <1> 		mov dword [dragging], 0
  3578 00002A1F 0000                <1>
  3579 00002A21 3C00                <1> 		cmp al, 0
  3580 00002A23 740F                <1> 		je nopreviousbutton
  3581 00002A25 E80C030000          <1> 		call clearmousecursor
  3582 00002A2A E88C090000          <1> 		call reloadallgraphics
  3583 00002A2F E8CE030000          <1> 		call switchmousepos2
  3584                              <1> 	nopreviousbutton:
  3585 00002A34 B000                <1> 		mov al, 0
  3586 00002A36 A2[6C2E0000]        <1> 		mov [pbutton], al
  3587 00002A3B A0[B4270000]        <1> 		mov al, [LBUTTON]
  3588 00002A40 A2[6D2E0000]        <1> 		mov [pLBUTTON], al
  3589 00002A45 A0[B5270000]        <1> 		mov al, [RBUTTON]
  3590 00002A4A A2[6E2E0000]        <1> 		mov [pRBUTTON], al
  3591 00002A4F B900000000          <1> 		mov ecx, 0
  3592 00002A54 BA00000000          <1> 		mov edx, 0
  3593 00002A59 668B15[872A0000]    <1> 		mov dx, [mousecursorposition]
  3594 00002A60 668B0D[892A0000]    <1> 		mov cx, [mousecursorposition + 2]
  3595 00002A67 66BB9CE7            <1> 		mov bx, 1110011110011100b
  3596 00002A6B B400                <1> 		mov ah, 0
  3597 00002A6D B080                <1> 		mov al, 128
  3598 00002A6F C605[322D0000]01    <1> 		mov byte [showcursorfonton], 1
  3599 00002A76 E830110000          <1> 		call showfontvesa
  3600 00002A7B C605[322D0000]00    <1> 		mov byte [showcursorfonton], 0
  3601 00002A82 C3                  <1> 		ret
  3602                              <1> 
  3603 00002A83 84008400            <1> lastmouseposition dw 132,132
  3604 00002A87 84008400            <1> mousecursorposition dw 132,132	
  3605                              <1> 
  3606                              <1> termmouse:
  3607 00002A8B BE[8F1C0000]        <1> 		mov esi, videobuf2
  3608 00002A90 BA00000000          <1> 		mov edx, 0
  3609 00002A95 668B15[832A0000]    <1> 		mov dx, [lastmouseposition]
  3610 00002A9C 668B0D[852A0000]    <1> 		mov cx, [lastmouseposition + 2]
  3611 00002AA3 66A1[262B0000]      <1> 		mov ax, [cursorcache]
  3612 00002AA9 663D0000            <1> 		cmp ax, 0
  3613 00002AAD 7426                <1> 		je nocopycursorcache
  3614 00002AAF 66C1E104            <1> 		shl cx, 4
  3615 00002AB3 66C1E203            <1> 		shl dx, 3
  3616 00002AB7 01D6                <1> 		add esi, edx
  3617 00002AB9 66BA0000            <1> 		mov dx, 0
  3618 00002ABD 8A15[99090000]      <1> 		mov dl, [charxy]
  3619 00002AC3 6641                <1> 		inc cx
  3620                              <1> termmousecplp1:
  3621 00002AC5 01D6                <1> 		add esi, edx
  3622 00002AC7 6649                <1> 		dec cx
  3623 00002AC9 6681F90000          <1> 		cmp cx, 0
  3624 00002ACE 75F5                <1> 		jne termmousecplp1
  3625 00002AD0 29D6                <1> 		sub esi, edx
  3626 00002AD2 668906              <1> 		mov [esi], ax
  3627                              <1> nocopycursorcache:
  3628 00002AD5 BE[8F1C0000]        <1> 		mov esi, videobuf2
  3629 00002ADA BA00000000          <1> 		mov edx, 0
  3630 00002ADF 668B15[872A0000]    <1> 		mov dx, [mousecursorposition]
  3631 00002AE6 668B0D[892A0000]    <1> 		mov cx, [mousecursorposition + 2]
  3632 00002AED 66C1E104            <1> 		shl cx, 4
  3633 00002AF1 66C1E203            <1> 		shl dx, 3
  3634 00002AF5 01D6                <1> 		add esi, edx
  3635 00002AF7 66BA0000            <1> 		mov dx, 0
  3636 00002AFB 8A15[99090000]      <1> 		mov dl, [charxy]
  3637 00002B01 6641                <1> 		inc cx
  3638                              <1> termmousecplp2:
  3639 00002B03 01D6                <1> 		add esi, edx
  3640 00002B05 6649                <1> 		dec cx
  3641 00002B07 6681F90000          <1> 		cmp cx, 0
  3642 00002B0C 75F5                <1> 		jne termmousecplp2
  3643 00002B0E 29D6                <1> 		sub esi, edx
  3644 00002B10 668B06              <1> 		mov ax, [esi]
  3645 00002B13 66A3[262B0000]      <1> 		mov [cursorcache], ax
  3646 00002B19 B080                <1> 		mov al, 128
  3647 00002B1B B407                <1> 		mov ah, 7
  3648 00002B1D 668906              <1> 		mov [esi], ax
  3649 00002B20 E89EE3FFFF          <1> 		call termcopy
  3650 00002B25 C3                  <1> 		ret
  3651 00002B26 0000                <1> cursorcache db 0,0
  3652                              <1> 	
  3653                              <1> scancode:
  3654 00002B28 0000                <1> 	db 0,0		;,0h
  3655 00002B2A 0000                <1> 	db 0,0		;,1h
  3656 00002B2C 3121                <1> 	db '1','!'	;,2h
  3657 00002B2E 3240                <1> 	db '2','@'	;,3h
  3658 00002B30 3323                <1> 	db '3','#'	;,4h
  3659 00002B32 3424                <1> 	db '4','$'	;,5h
  3660 00002B34 3525                <1> 	db '5','%'	;,6h
  3661 00002B36 365E                <1> 	db '6','^'	;,7h
  3662 00002B38 3726                <1> 	db '7','&'	;,8h
  3663 00002B3A 382A                <1> 	db '8','*'	;,9h
  3664 00002B3C 3928                <1> 	db '9','('	;,0Ah
  3665 00002B3E 3029                <1> 	db '0',')'	;,0Bh
  3666 00002B40 2D5F                <1> 	db '-','_'	;,0Ch
  3667 00002B42 3D2B                <1> 	db '=','+'	;,0Dh
  3668 00002B44 0808                <1> 	db 8,8		;,0Eh
  3669 00002B46 0000                <1> 	db 0,0		;,0Fh
  3670 00002B48 7151                <1> 	db 'q','Q'	;,10h
  3671 00002B4A 7757                <1> 	db 'w','W'	;,11h
  3672 00002B4C 6545                <1> 	db 'e','E'	;,12h
  3673 00002B4E 7252                <1> 	db 'r','R'	;,13h
  3674 00002B50 7454                <1> 	db 't','T'	;,14h
  3675 00002B52 7959                <1> 	db 'y','Y'	;,15h
  3676 00002B54 7555                <1> 	db 'u','U'	;,16h
  3677 00002B56 6949                <1> 	db 'i','I'	;,17h
  3678 00002B58 6F4F                <1> 	db 'o','O'	;,18h
  3679 00002B5A 7050                <1> 	db 'p','P'	;,19h
  3680 00002B5C 5B7B                <1> 	db '[','{'	;,1Ah
  3681 00002B5E 5D7D                <1> 	db ']','}'	;,1Bh
  3682 00002B60 0000                <1> 	db 0,0		;,1Ch
  3683 00002B62 0000                <1> 	db 0,0		;,1Dh
  3684 00002B64 6141                <1> 	db 'a','A'	;,1Eh
  3685 00002B66 7353                <1> 	db 's','S'	;,1Fh
  3686 00002B68 6444                <1> 	db 'd','D'	;,20h
  3687 00002B6A 6646                <1> 	db 'f','F'	;,21h
  3688 00002B6C 6747                <1> 	db 'g','G'	;,22h
  3689 00002B6E 6848                <1> 	db 'h','H'	;,23h
  3690 00002B70 6A4A                <1> 	db 'j','J'	;,24h
  3691 00002B72 6B4B                <1> 	db 'k','K'	;,25h
  3692 00002B74 6C4C                <1> 	db 'l','L'	;,26h
  3693 00002B76 3B3A                <1> 	db ';',':'	;,27h
  3694 00002B78 2722                <1> 	db 27h,22h	;,28h
  3695 00002B7A 607E                <1> 	db '`','~'	;,29h
  3696 00002B7C 0000                <1> 	db 0,0		;,2Ah
  3697 00002B7E 5C7C                <1> 	db '\','|'	;,2Bh
  3698 00002B80 7A5A                <1> 	db 'z','Z'	;,2Ch
  3699 00002B82 7858                <1> 	db 'x','X'	;,2Dh
  3700 00002B84 6343                <1> 	db 'c','C'	;,2Eh
  3701 00002B86 7656                <1> 	db 'v','V'	;,2Fh
  3702 00002B88 6242                <1> 	db 'b','B'	;,30h
  3703 00002B8A 6E4E                <1> 	db 'n','N'	;,31h
  3704 00002B8C 6D4D                <1> 	db 'm','M'	;,32h
  3705 00002B8E 2C3C                <1> 	db ',','<'	;,33h
  3706 00002B90 2E3E                <1> 	db '.','>'	;,34h
  3707 00002B92 2F3F                <1> 	db '/','?'	;,35h
  3708 00002B94 0000                <1> 	db 0,0		;,36h
  3709 00002B96 0000                <1> 	db 0,0		;,37h
  3710 00002B98 0000                <1> 	db 0,0		;,38h
  3711 00002B9A 2020                <1> 	db ' ',' '	;,39h
  3712                              <1> noscan:
  3713                                      %include 'source/gui.asm'
  3714                              <1> guiclear:
  3715 00002B9C 8B3D[7F530000]      <1> 	mov edi, [physbaseptr]
  3716 00002BA2 668B15[993B0000]    <1> 	mov dx, [resolutionx]
  3717 00002BA9 668B0D[973B0000]    <1> 	mov cx, [resolutiony]
  3718 00002BB0 66A1[D92B0000]      <1> 	mov ax, [background]
  3719                              <1> guiclearloop:
  3720 00002BB6 668907              <1> 	mov [edi], ax
  3721 00002BB9 81C702000000        <1> 	add edi, 2
  3722 00002BBF 664A                <1> 	dec dx
  3723 00002BC1 6681FA0000          <1> 	cmp dx, 0
  3724 00002BC6 77EE                <1> 	ja guiclearloop
  3725 00002BC8 6649                <1> 	dec cx
  3726 00002BCA 668B15[993B0000]    <1> 	mov dx, [resolutionx]
  3727 00002BD1 6681F90000          <1> 	cmp cx, 0
  3728 00002BD6 77DE                <1> 	ja guiclearloop
  3729 00002BD8 C3                  <1> 	ret
  3730                              <1> 
  3731 00002BD9 CF7B                <1> background dw 0111101111001111b
  3732                              <1> 
  3733                              <1> gui:	;Let's see what I can do, I am going to try to make this as freestanding as possible
  3734 00002BDB B800000000          <1> 	mov eax, 0
  3735 00002BE0 BB00000000          <1> 	mov ebx, 0
  3736 00002BE5 B900000000          <1> 	mov ecx, 0
  3737 00002BEA BA00000000          <1> 	mov edx, 0
  3738 00002BEF 8B3D[7F530000]      <1> 	mov edi, [physbaseptr]
  3739 00002BF5 668B15[993B0000]    <1> 	mov dx, [resolutionx]
  3740 00002BFC 668B0D[973B0000]    <1> 	mov cx, [resolutiony]
  3741 00002C03 668B1D[D92B0000]    <1> 	mov bx, [background]
  3742                              <1> guiclearloop2:
  3743 00002C0A 66891F              <1> 	mov [edi], bx
  3744 00002C0D 81C702000000        <1> 	add edi, 2
  3745 00002C13 664A                <1> 	dec dx
  3746 00002C15 6681FA0000          <1> 	cmp dx, 0
  3747 00002C1A 0F85EAFFFFFF        <1> 	jne near guiclearloop2
  3748 00002C20 6649                <1> 	dec cx
  3749 00002C22 668B15[993B0000]    <1> 	mov dx, [resolutionx]
  3750 00002C29 6681F90000          <1> 	cmp cx, 0
  3751 00002C2E 0F85D6FFFFFF        <1> 	jne near guiclearloop2
  3752 00002C34 C605[352D0000]01    <1> 	mov byte [guion], 1
  3753 00002C3B C605[342D0000]00    <1> 	mov byte [mouseselecton], 0
  3754 00002C42 B800000000          <1> 	mov eax, 0
  3755 00002C47 BB00000000          <1> 	mov ebx, 0
  3756 00002C4C B900000000          <1> 	mov ecx, 0
  3757 00002C51 BA00000000          <1> 	mov edx, 0
  3758                              <1> 	
  3759 00002C56 BE[033E0000]        <1> 	mov esi, pacmsg
  3760 00002C5B 66B80000            <1> 	mov ax, 0
  3761 00002C5F BB00000000          <1> 	mov ebx, 0
  3762 00002C64 66B99000            <1> 	mov cx, 144
  3763 00002C68 66BA0400            <1> 	mov dx, 4
  3764 00002C6C E8910A0000          <1> 	call showstring
  3765                              <1> 	
  3766 00002C71 BE[193F0000]        <1> 	mov esi, interneticon
  3767 00002C76 66B80000            <1> 	mov ax, 0
  3768 00002C7A BB[783E0000]        <1> 	mov ebx, noie
  3769 00002C7F 66B91800            <1> 	mov cx, 24
  3770 00002C83 66BA0400            <1> 	mov dx, 4
  3771 00002C87 E8320E0000          <1> 	call showicon
  3772                              <1> 	
  3773 00002C8C BE[9B3F0000]        <1> 	mov esi, wordicon
  3774 00002C91 66B80000            <1> 	mov ax, 0
  3775 00002C95 BB00000000          <1> 	mov ebx, 0
  3776 00002C9A 66B91800            <1> 	mov cx, 24
  3777 00002C9E 66BA3000            <1> 	mov dx, 48
  3778 00002CA2 E8170E0000          <1> 	call showicon
  3779                              <1> 	
  3780 00002CA7 BE[1D400000]        <1> 	mov esi, pacmanpellet
  3781 00002CAC 66B80000            <1> 	mov ax, 0
  3782 00002CB0 BB00000000          <1> 	mov ebx, 0
  3783 00002CB5 66B94000            <1> 	mov cx, 64
  3784 00002CB9 66BA0400            <1> 	mov dx, 4
  3785 00002CBD E8FC0D0000          <1> 	call showicon
  3786                              <1> 	
  3787 00002CC2 BE[21410000]        <1> 	mov esi, pacman
  3788 00002CC7 66B80000            <1> 	mov ax, 0
  3789 00002CCB BB[5D3E0000]        <1> 	mov ebx, pacmannomnom
  3790 00002CD0 66B94000            <1> 	mov cx, 64
  3791 00002CD4 66BA3000            <1> 	mov dx, 48
  3792 00002CD8 E8E10D0000          <1> 	call showicon
  3793                              <1> 	
  3794 00002CDD BE[9F400000]        <1> 	mov esi, ghostie
  3795 00002CE2 66B80000            <1> 	mov ax, 0
  3796 00002CE6 BB[423E0000]        <1> 	mov ebx, boo
  3797 00002CEB 66B96C00            <1> 	mov cx, 108
  3798 00002CEF 66BA0400            <1> 	mov dx, 4
  3799 00002CF3 E8C60D0000          <1> 	call showicon
  3800                              <1> 
  3801 00002CF8 BE[EF3D0000]        <1> 	mov esi, start
  3802 00002CFD 668B0D[973B0000]    <1> 	mov cx, [resolutiony]
  3803 00002D04 6681E91000          <1> 	sub cx, 16
  3804 00002D09 66BA0200            <1> 	mov dx, 2
  3805 00002D0D B400                <1> 	mov ah, 0
  3806 00002D0F B010                <1> 	mov al, 00010000b
  3807 00002D11 BB[C63E0000]        <1> 	mov ebx, winblows
  3808 00002D16 E8E7090000          <1> 	call showstring
  3809                              <1> 	
  3810 00002D1B E88AFBFFFF          <1> 	call cursorgui
  3811                              <1> guistart:
  3812 00002D20 E895FAFFFF          <1> 	call guistartin
  3813 00002D25 C605[2E2D0000]00    <1> 	mov byte [copygui], 0
  3814 00002D2C EBF2                <1> 	jmp guistart
  3815                              <1> 	
  3816                              <1> ;guicopy:	;;for double buffering
  3817                              <1> ;	mov byte [copygui], 1
  3818                              <1> ;	mov edi, [offscreenmemoffset]
  3819                              <1> ;	mov edx, 0
  3820                              <1> ;	mov ecx, 0
  3821                              <1> ;	mov dx, [mousecursorposition]
  3822                              <1> ;	mov cx, [mousecursorposition + 2]
  3823                              <1> ;	add edi, edx
  3824                              <1> ;	mov dx, [resolutionx2]
  3825                              <1> ;	inc cx
  3826                              <1> ;guicp2:
  3827                              <1> ;	add edi, edx
  3828                              <1> ;	dec cx
  3829                              <1> ;	cmp cx, 0
  3830                              <1> ;	jne guicp2
  3831                              <1> ;	sub edi, edx
  3832                              <1> ;	mov [cursorloc], edi
  3833                              <1> ;	mov ebx, cursorbmp
  3834                              <1> ;	mov cx, [resolutiony]
  3835                              <1> ;	rol ecx, 16
  3836                              <1> ;	mov cx, [resolutionx]
  3837                              <1> ;	mov esi, [physbaseptr]
  3838                              <1> ;	mov edi, [offscreenmemoffset]
  3839                              <1> ;guicp1:
  3840                              <1> ;	mov ax, [esi]
  3841                              <1> ;	mov [edi], ax
  3842                              <1> ;	add esi, 2
  3843                              <1> ;	add edi, 2
  3844                              <1> ;	cmp edi, [cursorloc]
  3845                              <1> ;	je copycursor
  3846                              <1> ;dncopycursor:
  3847                              <1> ;	dec cx
  3848                              <1> ;	cmp cx, 0
  3849                              <1> ;	jne guicp1
  3850                              <1> ;	mov cx, [resolutionx]
  3851                              <1> ;	rol ecx, 16
  3852                              <1> ;	dec cx
  3853                              <1> ;	cmp cx, 0
  3854                              <1> ;	rol ecx, 16
  3855                              <1> ;	jne guicp1
  3856                              <1> ;	mov byte [copygui], 0
  3857                              <1> ;	ret
  3858                              <1> ;copycursor:
  3859                              <1> ;	cmp ebx, cursorbmpend
  3860                              <1> ;	jae dncopycursor
  3861                              <1> ;	mov dx, [resolutionx2]
  3862                              <1> ;	add edi, edx
  3863                              <1> ;	mov [cursorloc], edi
  3864                              <1> ;	sub edi, edx
  3865                              <1> ;	dec ebx
  3866                              <1> ;	sub edi, 2
  3867                              <1> ;	sub esi, 2
  3868                              <1> ;	mov dx, 9
  3869                              <1> ;curscplp:
  3870                              <1> ;	inc ebx
  3871                              <1> ;	add esi, 2
  3872                              <1> ;	add edi, 2
  3873                              <1> ;	mov ax, [esi]
  3874                              <1> ;	mov [edi], ax
  3875                              <1> ;	mov al, [ebx]
  3876                              <1> ;	cmp al, 0
  3877                              <1> ;	je curscplp2
  3878                              <1> ;	mov word [edi], 1110011110011100b
  3879                              <1> ;curscplp2:
  3880                              <1> ;	dec cx
  3881                              <1> ;	cmp cx, 0
  3882                              <1> ;	je dncopycursor
  3883                              <1> ;	dec dx
  3884                              <1> ;	cmp dx, 0
  3885                              <1> ;	jne curscplp
  3886                              <1> ;	jmp dncopycursor
  3887                              <1> 	
  3888                              <1> 	
  3889                              <1> ;cursorloc: dd 0
  3890                              <1> 		
  3891                              <1> ;nextimage:	
  3892                              <1> ;	call guiclear
  3893                              <1> ;	mov esi, [bmpend]
  3894                              <1> ;	mov eax, 0
  3895                              <1> ;	mov ebx, 0
  3896                              <1> ;	mov ecx, 0
  3897                              <1> ;	mov edx, 0
  3898                              <1> ;	call showbmp
  3899                              <1> ;	jmp guistartin
  3900                              <1> 		
  3901 00002D2E 00                  <1> copygui db 0
  3902 00002D2F 00                  <1> graphicsset db 0
  3903 00002D30 0000                <1> graphicspos db 0,0
  3904 00002D32 00                  <1> showcursorfonton db 0
  3905 00002D33 00                  <1> savefonton db 0
  3906 00002D34 00                  <1> mouseselecton db 0
  3907 00002D35 00                  <1> guion db 0
  3908                              <1> 
  3909                              <1> 		
  3910                              <1> clearmousecursor:
  3911 00002D36 BE[D92B0000]        <1> 		mov esi, background
  3912 00002D3B 8B3D[7F530000]      <1> 		mov edi, [physbaseptr]
  3913 00002D41 BA00000000          <1> 		mov edx, 0
  3914 00002D46 B900000000          <1> 		mov ecx, 0
  3915 00002D4B 668B15[832A0000]    <1> 		mov dx, [lastmouseposition]
  3916 00002D52 668B0D[852A0000]    <1> 		mov cx, [lastmouseposition + 2]
  3917 00002D59 01D7                <1> 		add edi, edx
  3918 00002D5B BA00000000          <1> 		mov edx, 0
  3919 00002D60 668B15[9B3B0000]    <1> 		mov dx, [resolutionx2]
  3920 00002D67 6681F90000          <1> 		cmp cx, 0
  3921 00002D6C 740B                <1> 		je noyclr
  3922 00002D6E 01D7                <1> yclr:	add edi, edx
  3923 00002D70 6649                <1> 		dec cx
  3924 00002D72 6681F90000          <1> 		cmp cx, 0
  3925 00002D77 75F5                <1> 		jne yclr
  3926 00002D79 668B06              <1> noyclr:	mov ax, [esi]
  3927 00002D7C C1C010              <1> 		rol eax, 16
  3928 00002D7F 668B06              <1> 		mov ax, [esi]
  3929 00002D82 8907                <1> 		mov [edi], eax
  3930 00002D84 894704              <1> 		mov [edi + 4], eax
  3931 00002D87 894708              <1> 		mov [edi + 8], eax
  3932 00002D8A 89470C              <1> 		mov [edi + 12], eax
  3933 00002D8D 01D7                <1> 		add edi, edx
  3934 00002D8F 6641                <1> 		inc cx
  3935 00002D91 6681F91000          <1> 		cmp cx, 16
  3936 00002D96 72E1                <1> 		jb noyclr
  3937 00002D98 C3                  <1> 		ret
  3938                              <1> 
  3939                              <1> switchmousepos:		;;switch were the mouse is located
  3940 00002D99 BE[00120000]        <1> 		mov esi, mousecolorbuf
  3941 00002D9E 8B3D[7F530000]      <1> 		mov edi, [physbaseptr]
  3942 00002DA4 BA00000000          <1> 		mov edx, 0
  3943 00002DA9 B900000000          <1> 		mov ecx, 0
  3944 00002DAE 668B15[832A0000]    <1> 		mov dx, [lastmouseposition]
  3945 00002DB5 668B0D[852A0000]    <1> 		mov cx, [lastmouseposition + 2]
  3946 00002DBC 01D7                <1> 		add edi, edx
  3947 00002DBE BA00000000          <1> 		mov edx, 0
  3948 00002DC3 668B15[9B3B0000]    <1> 		mov dx, [resolutionx2]
  3949 00002DCA 6681F90000          <1> 		cmp cx, 0
  3950 00002DCF 740B                <1> 		je noswmsy
  3951 00002DD1 01D7                <1> swmsy:		add edi, edx
  3952 00002DD3 6649                <1> 		dec cx
  3953 00002DD5 6681F90000          <1> 		cmp cx, 0
  3954 00002DDA 75F5                <1> 		jne swmsy
  3955 00002DDC 8B06                <1> noswmsy:	mov eax, [esi]
  3956 00002DDE 8B5E04              <1> 		mov ebx, [esi + 4]
  3957 00002DE1 8907                <1> 		mov [edi], eax
  3958 00002DE3 895F04              <1> 		mov [edi + 4], ebx
  3959 00002DE6 8B4608              <1> 		mov eax, [esi + 8]
  3960 00002DE9 8B5E0C              <1> 		mov ebx, [esi + 12]
  3961 00002DEC 894708              <1> 		mov [edi + 8], eax
  3962 00002DEF 895F0C              <1> 		mov [edi + 12], ebx
  3963 00002DF2 01D7                <1> 		add edi, edx
  3964 00002DF4 81C610000000        <1> 		add esi, 16
  3965 00002DFA 81FE[00130000]      <1> 		cmp esi, mcolorend
  3966 00002E00 72DA                <1> 		jb noswmsy
  3967                              <1> 		
  3968                              <1> switchmousepos2:
  3969 00002E02 BE[00120000]        <1> 		mov esi, mousecolorbuf
  3970 00002E07 8B3D[7F530000]      <1> 		mov edi, [physbaseptr]
  3971 00002E0D BA00000000          <1> 		mov edx, 0
  3972 00002E12 B900000000          <1> 		mov ecx, 0
  3973 00002E17 668B15[872A0000]    <1> 		mov dx, [mousecursorposition]
  3974 00002E1E 668B0D[892A0000]    <1> 		mov cx, [mousecursorposition + 2]
  3975 00002E25 01D7                <1> 		add edi, edx
  3976 00002E27 BA00000000          <1> 		mov edx, 0
  3977 00002E2C 668B15[9B3B0000]    <1> 		mov dx, [resolutionx2]
  3978 00002E33 6681F90000          <1> 		cmp cx, 0
  3979 00002E38 740B                <1> 		je noswmsy2
  3980 00002E3A 01D7                <1> swmsy2:		add edi, edx
  3981 00002E3C 6649                <1> 		dec cx
  3982 00002E3E 6681F90000          <1> 		cmp cx, 0
  3983 00002E43 75F5                <1> 		jne swmsy2
  3984 00002E45 8B07                <1> noswmsy2:	mov eax, [edi]
  3985 00002E47 8B5F04              <1> 		mov ebx, [edi + 4]
  3986 00002E4A 8906                <1> 		mov [esi], eax
  3987 00002E4C 895E04              <1> 		mov [esi + 4], ebx
  3988 00002E4F 8B4708              <1> 		mov eax, [edi + 8]
  3989 00002E52 8B5F0C              <1> 		mov ebx, [edi + 12]
  3990 00002E55 894608              <1> 		mov [esi + 8], eax
  3991 00002E58 895E0C              <1> 		mov [esi + 12], ebx
  3992 00002E5B 01D7                <1> 		add edi, edx
  3993 00002E5D 81C610000000        <1> 		add esi, 16
  3994 00002E63 81FE[00130000]      <1> 		cmp esi, mcolorend
  3995 00002E69 72DA                <1> 		jb noswmsy2
  3996 00002E6B C3                  <1> 		ret
  3997                              <1> 
  3998 00002E6C 00                  <1> pbutton db 0
  3999 00002E6D 00                  <1> pLBUTTON db 0
  4000 00002E6E 00                  <1> pRBUTTON db 0
  4001 00002E6F 00000000            <1> dragging dw 0,0
  4002 00002E73 0000000000000000    <1> lastpos dw 0,0,0,0
  4003 00002E7B 00000000            <1> colorbuf dw 0,0
  4004                              <1> 	
  4005                              <1> 	clickicon:
  4006 00002E7F B001                <1> 		mov al, 1
  4007 00002E81 A2[6C2E0000]        <1> 		mov [pbutton], al
  4008 00002E86 A0[6D2E0000]        <1> 		mov al, [pLBUTTON]
  4009 00002E8B 2205[B4270000]      <1> 		and al, [LBUTTON]
  4010 00002E91 8A25[6E2E0000]      <1> 		mov ah, [pRBUTTON]
  4011 00002E97 2225[B5270000]      <1> 		and ah, [RBUTTON]
  4012 00002E9D 08E0                <1> 		or al, ah
  4013 00002E9F 3C00                <1> 		cmp al, 0
  4014 00002EA1 741B                <1> 		je nodragclick
  4015 00002EA3 813D[6F2E0000]0100- <1> 		cmp dword [dragging], 1
  4016 00002EAB 0000                <1>
  4017 00002EAD 732D                <1> 		jae dragclick
  4018 00002EAF C705[6F2E0000]0100- <1> 		mov dword [dragging], 1
  4019 00002EB7 0000                <1>
  4020 00002EB9 E91E000000          <1> 		jmp dragclick
  4021                              <1> 	nodragclick:
  4022 00002EBE C705[6F2E0000]0000- <1> 		mov dword [dragging], 0
  4023 00002EC6 0000                <1>
  4024 00002EC8 A0[B4270000]        <1> 		mov al, [LBUTTON]
  4025 00002ECD A2[6D2E0000]        <1> 		mov [pLBUTTON], al
  4026 00002ED2 A0[B5270000]        <1> 		mov al, [RBUTTON]
  4027 00002ED7 A2[6E2E0000]        <1> 		mov [pRBUTTON], al
  4028                              <1> 	dragclick:
  4029 00002EDC 66B80000            <1> 		mov ax, 0
  4030 00002EE0 BE[00100000]        <1> 		mov esi, graphicstable
  4031 00002EE5 C705[3D3E0000]0000- <1> 		mov dword [codepointer], 0
  4032 00002EED 0000                <1>
  4033                              <1> 	clicon2:
  4034 00002EEF BA00000000          <1> 		mov edx, 0
  4035 00002EF4 B900000000          <1> 		mov ecx, 0
  4036 00002EF9 66813E0100          <1> 		cmp word [esi], 1
  4037 00002EFE 0F841B000000        <1> 		je near iconselect
  4038 00002F04 66813E0200          <1> 		cmp word [esi], 2
  4039 00002F09 0F8472010000        <1> 		je near textselected
  4040 00002F0F 66813E0300          <1> 		cmp word [esi], 3
  4041 00002F14 0F84C7020000        <1> 		je near windowselect
  4042 00002F1A E908040000          <1> 		jmp nexticonsel
  4043                              <1> 	iconselect:
  4044 00002F1F 668B5606            <1> 		mov dx, [esi + 6]
  4045 00002F23 6689D0              <1> 		mov ax, dx
  4046 00002F26 668B4E08            <1> 		mov cx, [esi + 8]
  4047 00002F2A 6689CB              <1> 		mov bx, cx
  4048 00002F2D 6681C32000          <1> 		add bx, 32
  4049 00002F32 6601D0              <1> 		add ax, dx
  4050 00002F35 813D[6F2E0000]0100- <1> 		cmp dword [dragging], 1
  4051 00002F3D 0000                <1>
  4052 00002F3F 746F                <1> 		je dragicon
  4053 00002F41 813D[6F2E0000]0000- <1> 		cmp dword [dragging], 0
  4054 00002F49 0000                <1>
  4055 00002F4B 7411                <1> 		je nodragiconcheck
  4056 00002F4D 3935[6F2E0000]      <1> 		cmp dword [dragging], esi
  4057 00002F53 0F85CE030000        <1> 		jne near nexticonsel
  4058 00002F59 E952000000          <1> 		jmp dragicon
  4059                              <1> 	nodragiconcheck:
  4060 00002F5E 663905[872A0000]    <1> 		cmp [mousecursorposition], ax
  4061 00002F65 0F82BC030000        <1> 		jb near nexticonsel
  4062 00002F6B 66054000            <1> 		add ax, 64
  4063 00002F6F 663905[872A0000]    <1> 		cmp [mousecursorposition], ax
  4064 00002F76 0F87AB030000        <1> 		ja near nexticonsel
  4065 00002F7C 6629D0              <1> 		sub ax, dx
  4066 00002F7F 66390D[892A0000]    <1> 		cmp [mousecursorposition + 2], cx
  4067 00002F86 0F829B030000        <1> 		jb near nexticonsel
  4068 00002F8C 66391D[892A0000]    <1> 		cmp [mousecursorposition + 2], bx
  4069 00002F93 0F878E030000        <1> 		ja near nexticonsel
  4070 00002F99 668B460A            <1> 		mov ax, [esi + 10]
  4071 00002F9D 66250100            <1> 		and ax, 1
  4072 00002FA1 663D0100            <1> 		cmp ax, 1
  4073 00002FA5 0F84B6000000        <1> 		je near unselecticon
  4074 00002FAB E98D000000          <1> 		jmp nodragicon
  4075                              <1> 	dragicon:
  4076 00002FB0 663905[832A0000]    <1> 		cmp [lastmouseposition], ax
  4077 00002FB7 0F826A030000        <1> 		jb near nexticonsel
  4078 00002FBD 66054000            <1> 		add ax, 64
  4079 00002FC1 663905[832A0000]    <1> 		cmp [lastmouseposition], ax
  4080 00002FC8 0F8759030000        <1> 		ja near nexticonsel
  4081 00002FCE 6629D0              <1> 		sub ax, dx
  4082 00002FD1 66390D[852A0000]    <1> 		cmp [lastmouseposition + 2], cx
  4083 00002FD8 0F8249030000        <1> 		jb near nexticonsel
  4084 00002FDE 66391D[852A0000]    <1> 		cmp [lastmouseposition + 2], bx
  4085 00002FE5 0F873C030000        <1> 		ja near nexticonsel
  4086 00002FEB 668B460A            <1> 		mov ax, [esi + 10]
  4087 00002FEF 2410                <1> 		and al, 00010000b
  4088 00002FF1 3C10                <1> 		cmp al, 00010000b
  4089 00002FF3 7448                <1> 		je nodragicon
  4090 00002FF5 8935[6F2E0000]      <1> 		mov [dragging], esi
  4091 00002FFB 66D1E2              <1> 		shl dx, 1
  4092 00002FFE 662B15[832A0000]    <1> 		sub dx, [lastmouseposition]
  4093 00003005 660315[872A0000]    <1> 		add dx, [mousecursorposition]
  4094 0000300C 66D1EA              <1> 		shr dx, 1
  4095 0000300F 66030D[892A0000]    <1> 		add cx, [mousecursorposition + 2]
  4096 00003016 662B0D[852A0000]    <1> 		sub cx, [lastmouseposition + 2]
  4097 0000301D 663B15[9B3B0000]    <1> 		cmp dx, [resolutionx2]
  4098 00003024 7607                <1> 		jbe chkyresdrgicn
  4099 00003026 668B15[872A0000]    <1> 		mov dx, [mousecursorposition]
  4100                              <1> 	chkyresdrgicn:
  4101 0000302D 663B0D[973B0000]    <1> 		cmp cx, [resolutiony]
  4102 00003034 7607                <1> 		jbe nodragicon
  4103 00003036 668B0D[892A0000]    <1> 		mov cx, [mousecursorposition + 2]
  4104                              <1> 	nodragicon:
  4105 0000303D 66814E0A0100        <1> 		or word [esi + 10], 1
  4106 00003043 8B5E0C              <1> 		mov ebx, [esi + 12]
  4107 00003046 668B460A            <1> 		mov ax, [esi + 10]
  4108 0000304A 8B7602              <1> 		mov esi, [esi + 2]
  4109 0000304D C705[3D3E0000]0000- <1> 		mov dword [codepointer], 0
  4110 00003055 0000                <1>
  4111 00003057 E8620A0000          <1> 		call showicon
  4112 0000305C E9DF020000          <1> 		jmp doneiconsel
  4113                              <1> 	unselecticon:
  4114 00003061 6681660AFEFF        <1> 		and word [esi + 10], 0xFFFE
  4115 00003067 8B5E0C              <1> 		mov ebx, [esi + 12]
  4116 0000306A 668B460A            <1> 		mov ax, [esi + 10]
  4117 0000306E 8B7602              <1> 		mov esi, [esi + 2]
  4118 00003071 891D[3D3E0000]      <1> 		mov [codepointer], ebx
  4119 00003077 E8420A0000          <1> 		call showicon
  4120 0000307C E9BF020000          <1> 		jmp doneiconsel
  4121                              <1> 	textselected:
  4122 00003081 8B5E02              <1> 		mov ebx, [esi + 2]
  4123 00003084 668B5606            <1> 		mov dx, [esi + 6]
  4124 00003088 6689D0              <1> 		mov ax, dx
  4125 0000308B 668B4E08            <1> 		mov cx, [esi + 8]
  4126                              <1> 	lengthtesttext:
  4127 0000308F 803B00              <1> 		cmp byte [ebx], 0
  4128 00003092 7407                <1> 		je donetesttextlength
  4129 00003094 43                  <1> 		inc ebx
  4130 00003095 66051000            <1> 		add ax, 16
  4131 00003099 EBF4                <1> 		jmp lengthtesttext
  4132                              <1> 	donetesttextlength:
  4133 0000309B 6689CB              <1> 		mov bx, cx
  4134 0000309E 6681C30F00          <1> 		add bx, 15
  4135 000030A3 813D[6F2E0000]0100- <1> 		cmp dword [dragging], 1
  4136 000030AB 0000                <1>
  4137 000030AD 7468                <1> 		je dragtext
  4138 000030AF 813D[6F2E0000]0000- <1> 		cmp dword [dragging], 0
  4139 000030B7 0000                <1>
  4140 000030B9 7411                <1> 		je nodragtextcheck
  4141 000030BB 3935[6F2E0000]      <1> 		cmp dword [dragging], esi
  4142 000030C1 0F8560020000        <1> 		jne near nexticonsel
  4143 000030C7 E94B000000          <1> 		jmp dragtext
  4144                              <1> 	nodragtextcheck:
  4145 000030CC 663915[872A0000]    <1> 		cmp [mousecursorposition], dx
  4146 000030D3 0F824E020000        <1> 		jb near nexticonsel
  4147 000030D9 663905[872A0000]    <1> 		cmp [mousecursorposition], ax
  4148 000030E0 0F8741020000        <1> 		ja near nexticonsel
  4149 000030E6 66390D[892A0000]    <1> 		cmp [mousecursorposition + 2], cx
  4150 000030ED 0F8234020000        <1> 		jb near nexticonsel
  4151 000030F3 66391D[892A0000]    <1> 		cmp [mousecursorposition + 2], bx
  4152 000030FA 0F8727020000        <1> 		ja near nexticonsel
  4153 00003100 668B460A            <1> 		mov ax, [esi + 10]
  4154 00003104 66250100            <1> 		and ax, 1
  4155 00003108 663D0100            <1> 		cmp ax, 1
  4156 0000310C 0F84AB000000        <1> 		je near unselecttext
  4157 00003112 E986000000          <1> 		jmp nodragtext
  4158                              <1> 	dragtext:
  4159 00003117 663915[832A0000]    <1> 		cmp [lastmouseposition], dx
  4160 0000311E 0F8203020000        <1> 		jb near nexticonsel
  4161 00003124 663905[832A0000]    <1> 		cmp [lastmouseposition], ax
  4162 0000312B 0F87F6010000        <1> 		ja near nexticonsel
  4163 00003131 66390D[852A0000]    <1> 		cmp [lastmouseposition + 2], cx
  4164 00003138 0F82E9010000        <1> 		jb near nexticonsel
  4165 0000313E 66391D[852A0000]    <1> 		cmp [lastmouseposition + 2], bx
  4166 00003145 0F87DC010000        <1> 		ja near nexticonsel
  4167 0000314B 668B460A            <1> 		mov ax, [esi + 10]
  4168 0000314F 2410                <1> 		and al, 00010000b
  4169 00003151 663D1000            <1> 		cmp ax, 00010000b
  4170 00003155 0F8442000000        <1> 		je near nodragtext
  4171 0000315B 8935[6F2E0000]      <1> 		mov [dragging], esi
  4172 00003161 662B15[832A0000]    <1> 		sub dx, [lastmouseposition]
  4173 00003168 660315[872A0000]    <1> 		add dx, [mousecursorposition]
  4174 0000316F 66030D[892A0000]    <1> 		add cx, [mousecursorposition + 2]
  4175 00003176 662B0D[852A0000]    <1> 		sub cx, [lastmouseposition + 2]
  4176 0000317D 663B15[9B3B0000]    <1> 		cmp dx, [resolutionx2]
  4177 00003184 7607                <1> 		jbe chkyresdrgtxt
  4178 00003186 668B15[872A0000]    <1> 		mov dx, [mousecursorposition]
  4179                              <1> 	chkyresdrgtxt:
  4180 0000318D 663B0D[973B0000]    <1> 		cmp cx, [resolutiony]
  4181 00003194 7607                <1> 		jbe nodragtext
  4182 00003196 668B0D[892A0000]    <1> 		mov cx, [mousecursorposition + 2]
  4183                              <1> 	nodragtext:
  4184 0000319D 66814E0A0100        <1> 		or word [esi + 10], 1
  4185 000031A3 8B5E0C              <1> 		mov ebx, [esi + 12]
  4186 000031A6 891D[3D3E0000]      <1> 		mov [codepointer], ebx
  4187 000031AC 668B460A            <1> 		mov ax, [esi + 10]
  4188 000031B0 8B7602              <1> 		mov esi, [esi + 2]
  4189 000031B3 E84A050000          <1> 		call showstring
  4190 000031B8 E983010000          <1> 		jmp doneiconsel
  4191                              <1> 	unselecttext:
  4192 000031BD 6681660AFEFF        <1> 		and word [esi + 10], 0xFFFE
  4193 000031C3 8B5E0C              <1> 		mov ebx, [esi + 12]
  4194 000031C6 668B460A            <1> 		mov ax, [esi + 10]
  4195 000031CA 8B7602              <1> 		mov esi, [esi + 2]
  4196 000031CD C705[3D3E0000]0000- <1> 		mov dword [codepointer], 0
  4197 000031D5 0000                <1>
  4198 000031D7 E826050000          <1> 		call showstring
  4199 000031DC E95F010000          <1> 		jmp doneiconsel
  4200                              <1> windowselect:
  4201 000031E1 8B7E02              <1> 		mov edi, [esi + 2]
  4202 000031E4 668B5606            <1> 		mov dx, [esi + 6]
  4203 000031E8 6689D0              <1> 		mov ax, dx
  4204 000031EB 668B4E08            <1> 		mov cx, [esi + 8]
  4205 000031EF 6689CB              <1> 		mov bx, cx
  4206 000031F2 6681C31000          <1> 		add bx, 16
  4207 000031F7 813D[6F2E0000]0100- <1> 		cmp dword [dragging], 1
  4208 000031FF 0000                <1>
  4209 00003201 746D                <1> 		je dragwin
  4210 00003203 813D[6F2E0000]0000- <1> 		cmp dword [dragging], 0
  4211 0000320B 0000                <1>
  4212 0000320D 7411                <1> 		je nodragwincheck
  4213 0000320F 3935[6F2E0000]      <1> 		cmp dword [dragging], esi
  4214 00003215 0F850C010000        <1> 		jne near nexticonsel
  4215 0000321B E950000000          <1> 		jmp dragwin
  4216                              <1> 	nodragwincheck:
  4217 00003220 663905[872A0000]    <1> 		cmp [mousecursorposition], ax
  4218 00003227 0F82FA000000        <1> 		jb near nexticonsel
  4219 0000322D 660307              <1> 		add ax, [edi]
  4220 00003230 660307              <1> 		add ax, [edi]
  4221 00003233 663905[872A0000]    <1> 		cmp [mousecursorposition], ax
  4222 0000323A 0F87E7000000        <1> 		ja near nexticonsel
  4223 00003240 66390D[892A0000]    <1> 		cmp [mousecursorposition + 2], cx
  4224 00003247 0F82DA000000        <1> 		jb near nexticonsel
  4225 0000324D 66391D[892A0000]    <1> 		cmp [mousecursorposition + 2], bx
  4226 00003254 0F87CD000000        <1> 		ja near nexticonsel
  4227 0000325A 662D1400            <1> 		sub ax, 20
  4228 0000325E 663905[872A0000]    <1> 		cmp [mousecursorposition], ax
  4229 00003265 0F8795000000        <1> 		ja near killwin
  4230 0000326B E97C000000          <1> 		jmp nodragwin
  4231                              <1> 	dragwin:
  4232 00003270 663905[832A0000]    <1> 		cmp [lastmouseposition], ax
  4233 00003277 0F82AA000000        <1> 		jb near nexticonsel
  4234 0000327D 660307              <1> 		add ax, [edi]
  4235 00003280 660307              <1> 		add ax, [edi]
  4236 00003283 663905[832A0000]    <1> 		cmp [lastmouseposition], ax
  4237 0000328A 0F8797000000        <1> 		ja near nexticonsel
  4238 00003290 66390D[852A0000]    <1> 		cmp [lastmouseposition + 2], cx
  4239 00003297 0F828A000000        <1> 		jb near nexticonsel
  4240 0000329D 66391D[852A0000]    <1> 		cmp [lastmouseposition + 2], bx
  4241 000032A4 0F877D000000        <1> 		ja near nexticonsel
  4242 000032AA 8935[6F2E0000]      <1> 		mov [dragging], esi
  4243 000032B0 662B15[832A0000]    <1> 		sub dx, [lastmouseposition]
  4244 000032B7 660315[872A0000]    <1> 		add dx, [mousecursorposition]
  4245 000032BE 66030D[892A0000]    <1> 		add cx, [mousecursorposition + 2]
  4246 000032C5 662B0D[852A0000]    <1> 		sub cx, [lastmouseposition + 2]
  4247 000032CC 663B15[9B3B0000]    <1> 		cmp dx, [resolutionx2]
  4248 000032D3 7607                <1> 		jbe chkyresdrgwin
  4249 000032D5 668B15[872A0000]    <1> 		mov dx, [mousecursorposition]
  4250                              <1> 	chkyresdrgwin:
  4251 000032DC 663B0D[973B0000]    <1> 		cmp cx, [resolutiony]
  4252 000032E3 7607                <1> 		jbe nodragwin
  4253 000032E5 668B0D[892A0000]    <1> 		mov cx, [mousecursorposition + 2]
  4254                              <1> 	nodragwin:
  4255 000032EC 8B5E0C              <1> 		mov ebx, [esi + 12]
  4256 000032EF 668B460A            <1> 		mov ax, [esi + 10]
  4257 000032F3 8B7602              <1> 		mov esi, [esi + 2]
  4258 000032F6 E85D040000          <1> 		call showwindow
  4259 000032FB E940000000          <1> 		jmp doneiconsel
  4260                              <1> 	killwin:
  4261 00003300 66C7060000          <1> 		mov word [esi], 0
  4262 00003305 C705[66030000]0000- <1> 		mov dword [user2codepoint], 0
  4263 0000330D 0000                <1>
  4264 0000330F C605[A7090000]00    <1> 		mov byte [termguion], 0
  4265 00003316 C605[B5100000]00    <1> 		mov byte [nwcmdon], 0
  4266 0000331D E87AF8FFFF          <1> 		call guiclear
  4267 00003322 E93A000000          <1> 		jmp doneiconsel2
  4268                              <1> 	nexticonsel:
  4269 00003327 6681660AFEFF        <1> 		and word [esi + 10], 0xFFFE
  4270 0000332D 81C610000000        <1> 		add esi, 16
  4271 00003333 81FE[00120000]      <1> 		cmp esi, graphicstableend
  4272 00003339 7305                <1> 		jae doneiconsel
  4273 0000333B E9AFFBFFFF          <1> 		jmp clicon2
  4274                              <1> 	doneiconsel:
  4275 00003340 813D[6F2E0000]0100- <1> 		cmp dword [dragging], 1
  4276 00003348 0000                <1>
  4277 0000334A 7315                <1> 		jae doneiconsel2
  4278 0000334C 813D[3D3E0000]0000- <1> 		cmp dword [codepointer], 0
  4279 00003354 0000                <1>
  4280 00003356 7409                <1> 		je doneiconsel2
  4281 00003358 8B1D[3D3E0000]      <1> 		mov ebx, [codepointer]
  4282 0000335E FFD3                <1> 		call ebx 
  4283 00003360 C3                  <1> 		ret
  4284                              <1> 	doneiconsel2:
  4285 00003361 A0[B4270000]        <1> 		mov al, [LBUTTON]
  4286 00003366 A2[6D2E0000]        <1> 		mov [pLBUTTON], al
  4287 0000336B A0[B5270000]        <1> 		mov al, [RBUTTON]
  4288 00003370 A2[6E2E0000]        <1> 		mov [pRBUTTON], al
  4289 00003375 E8BCF9FFFF          <1> call clearmousecursor
  4290 0000337A E83C000000          <1> call reloadallgraphics
  4291 0000337F B900000000          <1> 		mov ecx, 0
  4292 00003384 BA00000000          <1> 		mov edx, 0
  4293 00003389 B400                <1> 		mov ah, 0
  4294 0000338B B080                <1> 		mov al, 128
  4295 0000338D 668B15[872A0000]    <1> 		mov dx, [mousecursorposition]
  4296 00003394 668B0D[892A0000]    <1> 		mov cx, [mousecursorposition + 2]
  4297 0000339B 66BBE738            <1> 		mov bx, 0011100011100111b
  4298 0000339F C605[322D0000]01    <1> 		mov byte [showcursorfonton], 1
  4299 000033A6 E800080000          <1> 		call showfontvesa
  4300 000033AB C605[322D0000]00    <1> 		mov byte [showcursorfonton], 0
  4301 000033B2 C3                  <1> 		ret
  4302 000033B3 00000000            <1> lastdrag dw 0,0
  4303 000033B7 00000000            <1> grpctblpos dw 0,0
  4304                              <1> 
  4305                              <1> reloadallgraphics:
  4306 000033BB BF[00100000]        <1> 		mov edi, graphicstable
  4307                              <1> reloadgraphicsloop:
  4308 000033C0 8B7702              <1> 		mov esi, [edi + 2]
  4309 000033C3 668B5706            <1> 		mov dx, [edi + 6]
  4310 000033C7 668B4F08            <1> 		mov cx, [edi + 8]
  4311 000033CB 668B07              <1> 		mov ax, [edi]
  4312 000033CE 668B5F0A            <1> 		mov bx, [edi + 10]
  4313 000033D2 893D[B7330000]      <1> 		mov [grpctblpos], edi
  4314 000033D8 3B3D[6F2E0000]      <1> 		cmp edi, [dragging]
  4315 000033DE 741E                <1> 		je loadedgraphic
  4316 000033E0 663D0100            <1> 		cmp ax, 1
  4317 000033E4 0F8431000000        <1> 		je near icongraphic
  4318 000033EA 663D0200            <1> 		cmp ax, 2
  4319 000033EE 0F8437000000        <1> 		je near stringgraphic
  4320 000033F4 663D0300            <1> 		cmp ax, 3
  4321 000033F8 0F8416000000        <1> 		je near windowgraphic
  4322 000033FE 8B3D[B7330000]      <1> loadedgraphic:  mov edi, [grpctblpos]
  4323 00003404 81C710000000        <1> 		add edi, 16
  4324 0000340A 81FF[00120000]      <1> 		cmp edi, graphicstableend
  4325 00003410 7329                <1> 		jae donereloadgraphics
  4326 00003412 EBAC                <1> 		jmp reloadgraphicsloop
  4327 00003414 E892030000          <1> windowgraphic:	call showwindow2
  4328 00003419 EBE3                <1> 		jmp loadedgraphic
  4329 0000341B 80E301              <1> icongraphic:	and bl, 1
  4330 0000341E 881D[413E0000]      <1> 		mov [iconselected], bl
  4331 00003424 E8A8060000          <1> 		call showicon2
  4332 00003429 EBD3                <1> 		jmp loadedgraphic
  4333 0000342B 80E301              <1> stringgraphic:  and bl, 1
  4334 0000342E 881D[342D0000]      <1> 		mov [mouseselecton], bl
  4335 00003434 E8DC020000          <1> 		call showstring2
  4336 00003439 EBC3                <1> 		jmp loadedgraphic
  4337                              <1> donereloadgraphics:
  4338 0000343B 8B3D[6F2E0000]      <1> 		mov edi, [dragging]
  4339 00003441 81FF[00100000]      <1> 		cmp edi, graphicstable
  4340 00003447 7226                <1> 		jb notcorrectdrag
  4341 00003449 668B07              <1> 		mov ax, [edi]
  4342 0000344C 8B7702              <1> 		mov esi, [edi + 2]
  4343 0000344F 668B5706            <1> 		mov dx, [edi + 6]
  4344 00003453 668B4F08            <1> 		mov cx, [edi + 8]
  4345 00003457 668B5F0A            <1> 		mov bx, [edi + 10]
  4346 0000345B 663D0100            <1> 		cmp ax, 1
  4347 0000345F 750F                <1> 		jne noticondragging
  4348 00003461 80E301              <1> 		and bl, 1
  4349 00003464 881D[413E0000]      <1> 		mov [iconselected], bl
  4350 0000346A E862060000          <1> 		call showicon2
  4351                              <1> notcorrectdrag:
  4352 0000346F C3                  <1> 		ret
  4353                              <1> 
  4354                              <1> 	noticondragging:
  4355 00003470 663D0200            <1> 		cmp ax, 2
  4356 00003474 75F9                <1> 		jne notcorrectdrag
  4357 00003476 80E301              <1> 		and bl, 1
  4358 00003479 881D[342D0000]      <1> 		mov [mouseselecton], bl
  4359 0000347F E891020000          <1> 		call showstring2
  4360 00003484 EBE9                <1> 		jmp notcorrectdrag
  4361                              <1> 
  4362 00003486 00<rept>            <1> grphbuf times 16 db 0
  4363                              <1> 	graphicsadd:
  4364 00003496 BF[00100000]        <1> 		mov edi, graphicstable
  4365                              <1> 	shwgrph1:
  4366 0000349B 397702              <1> 		cmp dword [edi + 2], esi
  4367 0000349E 7414                <1> 		je showgraphicsreplace2
  4368 000034A0 81C710000000        <1> 		add edi, 16
  4369 000034A6 81FF[00120000]      <1> 		cmp edi, graphicstableend
  4370 000034AC 0F8335020000        <1> 		jae near showgraphicsnew
  4371 000034B2 EBE7                <1> 		jmp shwgrph1
  4372                              <1> 	showgraphicsreplace2:
  4373 000034B4 8935[88340000]      <1> 		mov [grphbuf + 2], esi
  4374 000034BA 668915[8C340000]    <1> 		mov [grphbuf + 6], dx
  4375 000034C1 66890D[8E340000]    <1> 		mov [grphbuf + 8], cx
  4376 000034C8 891D[92340000]      <1> 		mov [grphbuf + 12], ebx
  4377 000034CE B700                <1> 		mov bh, 0
  4378 000034D0 88E3                <1> 		mov bl, ah
  4379 000034D2 B400                <1> 		mov ah, 0
  4380 000034D4 66A3[90340000]      <1> 		mov [grphbuf + 10], ax	
  4381 000034DA 66891D[86340000]    <1> 		mov [grphbuf], bx
  4382 000034E1 66A1[86340000]      <1> 		mov ax, [grphbuf]
  4383 000034E7 663D0100            <1> 		cmp ax, 1
  4384 000034EB 0F8419000000        <1> 		je near replaceicon
  4385 000034F1 663D0200            <1> 		cmp ax, 2
  4386 000034F5 0F8493000000        <1> 		je near replacestring
  4387 000034FB 663D0300            <1> 		cmp ax, 3
  4388 000034FF 0F840F010000        <1> 		je near replacewindow
  4389 00003505 E9BA010000          <1> 		jmp showgraphicsreplace
  4390                              <1> 	replaceicon:
  4391 0000350A 893D[732E0000]      <1> 		mov [lastpos], edi
  4392 00003510 8935[772E0000]      <1> 		mov [lastpos + 4], esi
  4393 00003516 8B7702              <1> 		mov esi, [edi + 2]
  4394 00003519 668B5F0C            <1> 		mov bx, [edi + 12]
  4395 0000351D 668B5706            <1> 		mov dx, [edi + 6]
  4396 00003521 668B4F08            <1> 		mov cx, [edi + 8]
  4397 00003525 668B06              <1> 		mov ax, [esi]
  4398 00003528 66A3[7B2E0000]      <1> 		mov [colorbuf], ax
  4399 0000352E 66A1[D92B0000]      <1> 		mov ax, [background]
  4400 00003534 668906              <1> 		mov [esi], ax
  4401 00003537 8B5F0C              <1> 		mov ebx, [edi + 12]
  4402 0000353A 668B470A            <1> 		mov ax, [edi + 10]
  4403 0000353E 2401                <1> 		and al, 1
  4404 00003540 A2[413E0000]        <1> 		mov [iconselected], al
  4405 00003545 668B470A            <1> 		mov ax, [edi + 10]
  4406 00003549 E883050000          <1> 		call showicon2
  4407 0000354E 8B3D[732E0000]      <1> 		mov edi, [lastpos]
  4408 00003554 8B7702              <1> 		mov esi, [edi + 2]
  4409 00003557 66A1[7B2E0000]      <1> 		mov ax, [colorbuf]
  4410 0000355D 668906              <1> 		mov [esi], ax
  4411 00003560 8B35[772E0000]      <1> 		mov esi, [lastpos + 4]
  4412 00003566 668B15[8C340000]    <1> 		mov dx, [grphbuf + 6]
  4413 0000356D 668B0D[8E340000]    <1> 		mov cx, [grphbuf + 8]
  4414 00003574 668B1D[86340000]    <1> 		mov bx, [grphbuf]
  4415 0000357B 66A1[90340000]      <1> 		mov ax, [grphbuf + 10]
  4416 00003581 88DC                <1> 		mov ah, bl
  4417 00003583 8B1D[92340000]      <1> 		mov ebx, [grphbuf + 12]
  4418 00003589 E936010000          <1> 		jmp showgraphicsreplace
  4419                              <1> 	replacestring:
  4420 0000358E 893D[732E0000]      <1> 		mov [lastpos], edi
  4421 00003594 8935[772E0000]      <1> 		mov [lastpos + 4], esi
  4422 0000359A 8B5F0C              <1> 		mov ebx, [edi + 12]
  4423 0000359D 8B7702              <1> 		mov esi, [edi + 2]
  4424 000035A0 668B5706            <1> 		mov dx, [edi + 6]
  4425 000035A4 668B4F08            <1> 		mov cx, [edi + 8]
  4426 000035A8 66A1[45370000]      <1> 		mov ax, [colorfont2]
  4427 000035AE 66A3[7B2E0000]      <1> 		mov [colorbuf], ax
  4428 000035B4 66A1[D92B0000]      <1> 		mov ax, [background]
  4429 000035BA 66A3[45370000]      <1> 		mov [colorfont2], ax		
  4430 000035C0 8B5F0C              <1> 		mov ebx, [edi + 12]
  4431 000035C3 668B470A            <1> 		mov ax, [edi + 10]
  4432 000035C7 2401                <1> 		and al, 1
  4433 000035C9 A2[342D0000]        <1> 		mov [mouseselecton], al
  4434 000035CE 668B470A            <1> 		mov ax, [edi + 10]
  4435 000035D2 E83E010000          <1> 		call showstring2
  4436 000035D7 66A1[7B2E0000]      <1> 		mov ax, [colorbuf]
  4437 000035DD 66A3[45370000]      <1> 		mov [colorfont2], ax
  4438 000035E3 8B3D[732E0000]      <1> 		mov edi, [lastpos]
  4439 000035E9 8B7702              <1> 		mov esi, [edi + 2]
  4440 000035EC 668B15[8C340000]    <1> 		mov dx, [grphbuf + 6]
  4441 000035F3 668B0D[8E340000]    <1> 		mov cx, [grphbuf + 8]
  4442 000035FA 668B1D[86340000]    <1> 		mov bx, [grphbuf]
  4443 00003601 66A1[90340000]      <1> 		mov ax, [grphbuf + 10]
  4444 00003607 88DC                <1> 		mov ah, bl
  4445 00003609 8B1D[92340000]      <1> 		mov ebx, [grphbuf + 12]
  4446 0000360F E9B0000000          <1> 		jmp showgraphicsreplace
  4447                              <1> 	replacewindow:
  4448 00003614 893D[732E0000]      <1> 		mov [lastpos], edi
  4449 0000361A 8935[772E0000]      <1> 		mov [lastpos + 4], esi
  4450 00003620 8B7702              <1> 		mov esi, [edi + 2]
  4451 00003623 8B3D[54370000]      <1> 		mov edi, [windowbufloc]
  4452 00003629 BA00000000          <1> 		mov edx, 0
  4453 0000362E 668B15[9B3B0000]    <1> 		mov dx, [resolutionx2]
  4454 00003635 C1E204              <1> 		shl edx, 4
  4455 00003638 29D7                <1> 		sub edi, edx
  4456 0000363A BA00000000          <1> 		mov edx, 0
  4457 0000363F 668B16              <1> 		mov dx, [esi]
  4458 00003642 660316              <1> 		add dx, [esi]
  4459 00003645 668B4E02            <1> 		mov cx, [esi + 2]
  4460 00003649 6681C11000          <1> 		add cx, 16
  4461 0000364E 66A1[D92B0000]      <1> 		mov ax, [background]
  4462                              <1> 	clearwindow:
  4463 00003654 668907              <1> 		mov [edi], ax
  4464 00003657 81C702000000        <1> 		add edi, 2
  4465 0000365D 81EA02000000        <1> 		sub edx, 2
  4466 00003663 81FA00000000        <1> 		cmp edx, 0
  4467 00003669 75E9                <1> 		jne clearwindow
  4468 0000366B 6649                <1> 		dec cx
  4469 0000366D 668B15[9B3B0000]    <1> 		mov dx, [resolutionx2]
  4470 00003674 662B16              <1> 		sub dx, [esi]
  4471 00003677 662B16              <1> 		sub dx, [esi]
  4472 0000367A 01D7                <1> 		add edi, edx
  4473 0000367C 668B16              <1> 		mov dx, [esi]
  4474 0000367F 660316              <1> 		add dx, [esi]
  4475 00003682 6681F90000          <1> 		cmp cx, 0
  4476 00003687 75CB                <1> 		jne clearwindow
  4477 00003689 C605[A8090000]00    <1> 		mov byte [termcopyon], 0
  4478 00003690 8B3D[732E0000]      <1> 		mov edi, [lastpos]
  4479 00003696 8B35[88340000]      <1> 		mov esi, [grphbuf + 2]
  4480 0000369C 668B15[8C340000]    <1> 		mov dx, [grphbuf + 6]
  4481 000036A3 668B0D[8E340000]    <1> 		mov cx, [grphbuf + 8]
  4482 000036AA 668B1D[86340000]    <1> 		mov bx, [grphbuf]
  4483 000036B1 66A1[90340000]      <1> 		mov ax, [grphbuf + 10]
  4484 000036B7 88DC                <1> 		mov ah, bl
  4485 000036B9 8B1D[92340000]      <1> 		mov ebx, [grphbuf + 12]
  4486 000036BF E900000000          <1> 		jmp showgraphicsreplace
  4487                              <1> 	showgraphicsreplace:
  4488 000036C4 897702              <1> 		mov [edi + 2], esi
  4489 000036C7 66895706            <1> 		mov [edi + 6], dx
  4490 000036CB 66894F08            <1> 		mov [edi + 8], cx
  4491 000036CF 895F0C              <1> 		mov [edi + 12], ebx
  4492 000036D2 B700                <1> 		mov bh, 0
  4493 000036D4 88E3                <1> 		mov bl, ah
  4494 000036D6 B400                <1> 		mov ah, 0
  4495 000036D8 6689470A            <1> 		mov [edi + 10], ax
  4496 000036DC 66891F              <1> 		mov [edi], bx
  4497 000036DF 8B5F0C              <1> 		mov ebx, [edi + 12]
  4498 000036E2 668B470A            <1> 		mov ax, [edi + 10]
  4499 000036E6 C3                  <1> 		ret
  4500                              <1> 	showgraphicsnew:
  4501 000036E7 BF[00100000]        <1> 		mov edi, graphicstable
  4502                              <1> 	shwgrph2:
  4503 000036EC 66813F0000          <1> 		cmp word [edi], 0
  4504 000036F1 74D1                <1> 		je showgraphicsreplace
  4505 000036F3 81C710000000        <1> 		add edi, 16
  4506 000036F9 81FF[00120000]      <1> 		cmp edi, graphicstableend
  4507 000036FF 72EB                <1> 		jb shwgrph2
  4508                              <1> 	showgraphicsdone:
  4509 00003701 C3                  <1> 		ret
  4510                              <1> 
  4511                              <1> 	showstring:
  4512 00003702 A2[342D0000]        <1> 		mov [mouseselecton], al
  4513 00003707 8025[342D0000]01    <1> 		and byte [mouseselecton], 1
  4514 0000370E B402                <1> 		mov ah, 2
  4515 00003710 E881FDFFFF          <1> 		call graphicsadd
  4516                              <1> 	showstring2:
  4517 00003715 B400                <1> 		mov ah, 0
  4518 00003717 8A06                <1> 		mov al, [esi]
  4519 00003719 3C00                <1> 		cmp al, 0
  4520 0000371B 7420                <1> 		je doneshowstring
  4521 0000371D 46                  <1> 		inc esi
  4522 0000371E 8935[EA3D0000]      <1> 		mov [showstringesi], esi
  4523 00003724 668B1D[45370000]    <1> 		mov bx, [colorfont2]
  4524 0000372B E87B040000          <1> 		call showfontvesa
  4525 00003730 6681C20800          <1> 		add dx, 8
  4526 00003735 8B35[EA3D0000]      <1> 		mov esi, [showstringesi]
  4527 0000373B EBD8                <1> 		jmp showstring2
  4528                              <1> 	doneshowstring:
  4529 0000373D C605[342D0000]00    <1> 		mov byte [mouseselecton], 0
  4530 00003744 C3                  <1> 		ret
  4531                              <1> 
  4532 00003745 FFFF                <1> colorfont2 dw 0xFFFF
  4533 00003747 00                  <1> colorcache db 0
  4534 00003748 0000                <1> winvcopystx dw 0
  4535 0000374A 0000                <1> winvcopysty dw 0
  4536 0000374C 0000                <1> winvcopydx dw 0
  4537 0000374E 0000                <1> winvcopycx dw 0
  4538 00003750 FFFF0000            <1> windowcolor dw 0xFFFF,0x0
  4539 00003754 00000000            <1> windowbufloc: dw 0,0
  4540                              <1> 
  4541                              <1> 	showwindow:	;;windowstuff in si, position in (dx, cx), nothing in ax, code in bx
  4542 00003758 C605[A7090000]01    <1> 		mov byte [termguion], 1
  4543 0000375F 6681C11000          <1> 		add cx, 16
  4544 00003764 668915[48370000]    <1> 		mov [winvcopystx], dx
  4545 0000376B 66890D[4A370000]    <1> 		mov [winvcopysty], cx
  4546 00003772 668B16              <1> 		mov dx, [esi]
  4547 00003775 668B4E02            <1> 		mov cx, [esi + 2]
  4548 00003779 6601D2              <1> 		add dx, dx
  4549 0000377C 668915[4C370000]    <1> 		mov [winvcopydx], dx
  4550 00003783 66890D[4E370000]    <1> 		mov [winvcopycx], cx
  4551 0000378A 668B0D[4A370000]    <1> 		mov cx, [winvcopysty]
  4552 00003791 6681E91000          <1> 		sub cx, 16
  4553 00003796 668B15[48370000]    <1> 		mov dx, [winvcopystx]
  4554 0000379D C605[A8090000]00    <1> 		mov byte [termcopyon], 0
  4555 000037A4 B403                <1> 		mov ah, 3
  4556 000037A6 E8EBFCFFFF          <1> 		call graphicsadd
  4557                              <1> 	showwindow2:
  4558 000037AB 6681C11000          <1> 		add cx, 16
  4559 000037B0 668915[48370000]    <1> 		mov [winvcopystx], dx
  4560 000037B7 66890D[4A370000]    <1> 		mov [winvcopysty], cx
  4561 000037BE 668B16              <1> 		mov dx, [esi]
  4562 000037C1 668B4E02            <1> 		mov cx, [esi + 2]
  4563 000037C5 6601D2              <1> 		add dx, dx
  4564 000037C8 668915[4C370000]    <1> 		mov [winvcopydx], dx
  4565 000037CF 66890D[4E370000]    <1> 		mov [winvcopycx], cx
  4566 000037D6 8B3D[54370000]      <1> 		mov edi, [windowbufloc]
  4567 000037DC BA00000000          <1> 		mov edx, 0
  4568 000037E1 668B15[9B3B0000]    <1> 		mov dx, [resolutionx2]
  4569 000037E8 C1E204              <1> 		shl edx, 4
  4570 000037EB 29D7                <1> 		sub edi, edx
  4571 000037ED 803D[A8090000]00    <1> 		cmp byte [termcopyon], 0
  4572 000037F4 753E                <1> 		jne nocleartitlebarpos
  4573 000037F6 8B3D[7F530000]      <1> 		mov edi, [physbaseptr]
  4574 000037FC BA00000000          <1> 		mov edx, 0
  4575 00003801 668B15[48370000]    <1> 		mov dx, [winvcopystx]
  4576 00003808 01D7                <1> 		add edi, edx
  4577 0000380A 668B0D[4A370000]    <1> 		mov cx, [winvcopysty]
  4578 00003811 6681E91000          <1> 		sub cx, 16
  4579 00003816 6681F90000          <1> 		cmp cx, 0
  4580 0000381B 7417                <1> 		je nocleartitlebarpos
  4581                              <1> 	cleartitlebarpos:
  4582 0000381D BA00000000          <1> 		mov edx, 0
  4583 00003822 668B15[9B3B0000]    <1> 		mov dx, [resolutionx2]
  4584 00003829 01D7                <1> 		add edi, edx
  4585 0000382B 6649                <1> 		dec cx
  4586 0000382D 6681F90000          <1> 		cmp cx, 0
  4587 00003832 75E9                <1> 		jne cleartitlebarpos
  4588                              <1> 	nocleartitlebarpos:
  4589 00003834 66B91000            <1> 		mov cx, 16
  4590 00003838 668B15[4C370000]    <1> 		mov dx, [winvcopydx]
  4591 0000383F 6681F90000          <1> 		cmp cx, 0
  4592 00003844 0F844B000000        <1> 		je near canceltitlebarput
  4593 0000384A 6681FA0000          <1> 		cmp dx, 0
  4594 0000384F 0F8440000000        <1> 		je near canceltitlebarput
  4595                              <1> 	titlebarput:
  4596 00003855 66A1[50370000]      <1> 		mov ax, [windowcolor]
  4597 0000385B 668907              <1> 		mov [edi], ax
  4598 0000385E 6681EA0200          <1> 		sub dx, 2
  4599 00003863 81C702000000        <1> 		add edi, 2
  4600 00003869 6681FA0000          <1> 		cmp dx, 0
  4601 0000386E 75E5                <1> 		jne titlebarput
  4602 00003870 BA00000000          <1> 		mov edx, 0
  4603 00003875 668B15[9B3B0000]    <1> 		mov dx, [resolutionx2]
  4604 0000387C 6649                <1> 		dec cx
  4605 0000387E 662B15[4C370000]    <1> 		sub dx, [winvcopydx]
  4606 00003885 01D7                <1> 		add edi, edx
  4607 00003887 668B15[4C370000]    <1> 		mov dx, [winvcopydx]
  4608 0000388E 6681F90000          <1> 		cmp cx, 0
  4609 00003893 75C0                <1> 		jne titlebarput
  4610                              <1> 	canceltitlebarput:
  4611 00003895 893D[54370000]      <1> 		mov [windowbufloc], edi
  4612 0000389B 803D[A8090000]02    <1> 		cmp byte [termcopyon], 2
  4613 000038A2 0F8463000000        <1> 		je near winvcpst
  4614 000038A8 66B80000            <1> 		mov ax, 0
  4615 000038AC 81C604000000        <1> 		add esi, 4
  4616 000038B2 668B15[48370000]    <1> 		mov dx, [winvcopystx]
  4617 000038B9 668B0D[4A370000]    <1> 		mov cx, [winvcopysty]
  4618 000038C0 6681E91000          <1> 		sub cx, 16
  4619 000038C5 66BB0000            <1> 		mov bx, 0
  4620 000038C9 C605[342D0000]01    <1> 		mov byte [mouseselecton], 1
  4621 000038D0 E840FEFFFF          <1> 		call showstring2
  4622 000038D5 B058                <1> 		mov al, "X"
  4623 000038D7 B400                <1> 		mov ah, 0
  4624 000038D9 668B1D[45370000]    <1> 		mov bx, [colorfont2]
  4625 000038E0 668B15[48370000]    <1> 		mov dx, [winvcopystx]
  4626 000038E7 668B0D[4A370000]    <1> 		mov cx, [winvcopysty]
  4627 000038EE 6681E91000          <1> 		sub cx, 16
  4628 000038F3 6681EA1400          <1> 		sub dx, 20
  4629 000038F8 660315[4C370000]    <1> 		add dx, [winvcopydx]
  4630 000038FF C605[342D0000]01    <1> 		mov byte [mouseselecton], 1
  4631 00003906 E8A0020000          <1> 		call showfontvesa
  4632                              <1> 	winvcpst:
  4633 0000390B 8B3D[54370000]      <1> 		mov edi, [windowbufloc]
  4634 00003911 E957000000          <1> 		jmp windowvideocopyset
  4635                              <1> 
  4636                              <1> 	windowvideocopy:
  4637 00003916 8B3D[54370000]      <1> 		mov edi, [windowbufloc]
  4638 0000391C 3B3D[7F530000]      <1> 		cmp edi, [physbaseptr]
  4639 00003922 0F8345000000        <1> 		jae near windowvideocopyset
  4640 00003928 B900000000          <1> 		mov ecx, 0
  4641 0000392D BA00000000          <1> 		mov edx, 0
  4642 00003932 668B15[48370000]    <1> 		mov dx, [winvcopystx]
  4643 00003939 668B0D[4A370000]    <1> 		mov cx, [winvcopysty]
  4644 00003940 8B3D[7F530000]      <1> 		mov edi, [physbaseptr]
  4645 00003946 01D7                <1> 		add edi, edx
  4646 00003948 81F900000000        <1> 		cmp ecx, 0
  4647 0000394E 741D                <1> 		je windowvideocopyset
  4648                              <1> 	yrescopylp:
  4649 00003950 BA00000000          <1> 		mov edx, 0
  4650 00003955 668B15[9B3B0000]    <1> 		mov dx, [resolutionx2]
  4651 0000395C 01D7                <1> 		add edi, edx
  4652 0000395E 6649                <1> 		dec cx
  4653 00003960 6681F90000          <1> 		cmp cx, 0
  4654 00003965 75E9                <1> 		jne yrescopylp
  4655 00003967 893D[54370000]      <1> 		mov [windowbufloc], edi
  4656                              <1> 	windowvideocopyset:
  4657 0000396D 66B90000            <1> 		mov cx, 0
  4658 00003971 66890D[B63A0000]    <1> 		mov [charposline], cx
  4659 00003978 BE[8F1C0000]        <1> 		mov esi, videobuf2
  4660 0000397D 8935[B83A0000]      <1> 		mov [charposvbuf], esi
  4661 00003983 8A5E01              <1> 		mov bl, [esi + 1]
  4662 00003986 881D[47370000]      <1> 		mov [colorcache], bl
  4663 0000398C 8A1E                <1> 		mov bl, [esi]
  4664 0000398E B700                <1> 		mov bh, 0
  4665 00003990 66C1E304            <1> 		shl bx, 4
  4666 00003994 678AB7[3749]        <1> 		mov dh, [fonts + bx]
  4667 00003999 D0CE                <1> 		ror dh, 1
  4668 0000399B 89FE                <1> 		mov esi, edi
  4669                              <1> 	copywindow:
  4670 0000399D B201                <1> 		mov dl, 1
  4671 0000399F D0C6                <1> 		rol dh, 1
  4672 000039A1 20F2                <1> 		and dl, dh
  4673 000039A3 803D[47370000]10    <1> 		cmp byte [colorcache], 0x10
  4674 000039AA 731C                <1> 		jae switchwincolors
  4675 000039AC 66A1[52370000]      <1> 		mov ax, [windowcolor + 2]
  4676 000039B2 668907              <1> 		mov [edi], ax
  4677 000039B5 80FA00              <1> 		cmp dl, 0
  4678 000039B8 7425                <1> 		je nowritewin
  4679 000039BA 66A1[50370000]      <1> 		mov ax, [windowcolor]
  4680 000039C0 668907              <1> 		mov [edi], ax
  4681 000039C3 E917000000          <1> 		jmp nowritewin
  4682                              <1> 	switchwincolors:
  4683 000039C8 66A1[50370000]      <1> 		mov ax, [windowcolor]
  4684 000039CE 668907              <1> 		mov [edi], ax
  4685 000039D1 80FA00              <1> 		cmp dl, 0
  4686 000039D4 7409                <1> 		je nowritewin
  4687 000039D6 66A1[52370000]      <1> 		mov ax, [windowcolor + 2]
  4688 000039DC 668907              <1> 		mov [edi], ax
  4689                              <1> 	nowritewin:
  4690 000039DF 81C702000000        <1> 		add edi, 2
  4691 000039E5 FEC1                <1> 		inc cl
  4692 000039E7 80F908              <1> 		cmp cl, 8
  4693 000039EA 75B1                <1> 		jne copywindow
  4694 000039EC 6643                <1> 		inc bx
  4695 000039EE B100                <1> 		mov cl, 0
  4696 000039F0 BA00000000          <1> 		mov edx, 0
  4697 000039F5 668B15[9B3B0000]    <1> 		mov dx, [resolutionx2]
  4698 000039FC 01D6                <1> 		add esi, edx
  4699 000039FE 89F7                <1> 		mov edi, esi
  4700 00003A00 678AB7[3749]        <1> 		mov dh, [fonts + bx]
  4701 00003A05 D0CE                <1> 		ror dh, 1
  4702 00003A07 FEC5                <1> 		inc ch
  4703 00003A09 80FD10              <1> 		cmp ch, 16
  4704 00003A0C 758F                <1> 		jne copywindow
  4705 00003A0E 66B90000            <1> 		mov cx, 0
  4706 00003A12 8B3D[B83A0000]      <1> 		mov edi, [charposvbuf]
  4707 00003A18 81C702000000        <1> 		add edi, 2
  4708 00003A1E 81FF[4F2F0000]      <1> 		cmp edi, videobufend
  4709 00003A24 7379                <1> 		jae donewincopynow
  4710 00003A26 8A5F01              <1> 		mov bl, [edi + 1]
  4711 00003A29 881D[47370000]      <1> 		mov [colorcache], bl
  4712 00003A2F 8A1F                <1> 		mov bl, [edi]
  4713 00003A31 B700                <1> 		mov bh, 0
  4714 00003A33 66C1E304            <1> 		shl bx, 4
  4715 00003A37 893D[B83A0000]      <1> 		mov [charposvbuf], edi
  4716 00003A3D BA00000000          <1> 		mov edx, 0
  4717 00003A42 668B15[9B3B0000]    <1> 		mov dx, [resolutionx2]
  4718 00003A49 C1E204              <1> 		shl edx, 4
  4719 00003A4C 29D6                <1> 		sub esi, edx
  4720 00003A4E 81C610000000        <1> 		add esi, 16
  4721 00003A54 89F7                <1> 		mov edi, esi
  4722 00003A56 668B0D[B63A0000]    <1> 		mov cx, [charposline]
  4723 00003A5D 6641                <1> 		inc cx
  4724 00003A5F 6681F95000          <1> 		cmp cx, 80
  4725 00003A64 7317                <1> 		jae fixwindowcopy
  4726 00003A66 66890D[B63A0000]    <1> 		mov [charposline], cx
  4727 00003A6D 66B90000            <1> 		mov cx, 0
  4728 00003A71 678AB7[3749]        <1> 		mov dh, [fonts + bx]
  4729 00003A76 D0CE                <1> 		ror dh, 1
  4730 00003A78 E920FFFFFF          <1> 		jmp copywindow
  4731                              <1> fixwindowcopy:
  4732 00003A7D 66B90000            <1> 		mov cx, 0
  4733 00003A81 66890D[B63A0000]    <1> 		mov [charposline], cx
  4734 00003A88 662B15[4C370000]    <1> 		sub dx, [winvcopydx]
  4735 00003A8F 01D6                <1> 		add esi, edx
  4736 00003A91 89F7                <1> 		mov edi, esi
  4737 00003A93 678AB7[3749]        <1> 		mov dh, [fonts + bx]
  4738 00003A98 D0CE                <1> 		ror dh, 1
  4739 00003A9A E9FEFEFFFF          <1> 		jmp copywindow
  4740                              <1> donewincopynow:
  4741 00003A9F E8FED4FFFF          <1> 		call switchtermcursor
  4742 00003AA4 803D[A8090000]01    <1> 		cmp byte [termcopyon], 1
  4743 00003AAB 7501                <1> 		jne forgetresetstuff
  4744 00003AAD 61                  <1> 		popa
  4745                              <1> forgetresetstuff:
  4746 00003AAE C605[A8090000]00    <1> 		mov byte [termcopyon], 0
  4747 00003AB5 C3                  <1> 		ret
  4748                              <1> 
  4749 00003AB6 0000                <1> charposline dw 0
  4750 00003AB8 00000000            <1> charposvbuf dw 0,0
  4751 00003ABC 0000                <1> iconcolor dw 0
  4752                              <1> 	showicon:	;;icon in si, position in (dx,cx), selected in ax, code in bx
  4753 00003ABE A2[413E0000]        <1> 		mov [iconselected], al
  4754 00003AC3 8025[413E0000]01    <1> 		and byte [iconselected], 1
  4755 00003ACA B401                <1> 		mov ah, 1
  4756 00003ACC E8C5F9FFFF          <1> 		call graphicsadd
  4757                              <1> 	showicon2:
  4758 00003AD1 8B3D[7F530000]      <1> 		mov edi, [physbaseptr]
  4759 00003AD7 6601D2              <1> 		add dx, dx
  4760 00003ADA 663B15[9B3B0000]    <1> 		cmp dx, [resolutionx2]
  4761 00003AE1 720C                <1> 		jb screenxgood
  4762 00003AE3 668B15[9B3B0000]    <1> 		mov dx, [resolutionx2]
  4763 00003AEA 6681EA4000          <1> 		sub dx, 64
  4764                              <1> 	screenxgood:
  4765 00003AEF 6681F90000          <1> 		cmp cx, 0
  4766 00003AF4 7425                <1> 		je noscreenygoodchk
  4767 00003AF6 663B0D[973B0000]    <1> 		cmp cx, [resolutiony]
  4768 00003AFD 720C                <1> 		jb screenygood
  4769 00003AFF 668B0D[973B0000]    <1> 		mov cx, [resolutiony]
  4770 00003B06 6681E92000          <1> 		sub cx, 32
  4771                              <1> 	screenygood:
  4772 00003B0B BB00000000          <1> 		mov ebx, 0
  4773 00003B10 668B1D[9B3B0000]    <1> 		mov bx, [resolutionx2]
  4774 00003B17 01DF                <1> 		add edi, ebx
  4775 00003B19 E2F0                <1> 		loop screenygood
  4776                              <1> 	noscreenygoodchk:
  4777 00003B1B BB00000000          <1> 		mov ebx, 0
  4778 00003B20 6689D3              <1> 		mov bx, dx
  4779 00003B23 01DF                <1> 		add edi, ebx
  4780 00003B25 66B90000            <1> 		mov cx, 0
  4781 00003B29 668B06              <1> 		mov ax, [esi]
  4782 00003B2C 81C602000000        <1> 		add esi, 2
  4783 00003B32 66A3[BC3A0000]      <1> 		mov [iconcolor], ax
  4784                              <1> 	writeicon:
  4785 00003B38 8B06                <1> 		mov eax, [esi]
  4786 00003B3A D1C0                <1> 		rol eax, 1
  4787 00003B3C B100                <1> 		mov cl, 0
  4788                              <1> 	writeiconline:
  4789 00003B3E B201                <1> 		mov dl, 1
  4790 00003B40 20C2                <1> 		and dl, al
  4791 00003B42 3215[413E0000]      <1> 		xor dl, [iconselected]
  4792 00003B48 668B1D[D92B0000]    <1> 		mov bx, [background]
  4793 00003B4F 66891F              <1> 		mov [edi], bx
  4794 00003B52 80FA00              <1> 		cmp dl, 0
  4795 00003B55 740A                <1> 		je noiconline
  4796 00003B57 668B15[BC3A0000]    <1> 		mov dx, [iconcolor]
  4797 00003B5E 668917              <1> 		mov [edi], dx
  4798                              <1> 	noiconline:
  4799 00003B61 81C702000000        <1> 		add edi, 2
  4800 00003B67 D1C0                <1> 		rol eax, 1
  4801 00003B69 FEC1                <1> 		inc cl
  4802 00003B6B 80F920              <1> 		cmp cl, 32
  4803 00003B6E 72CE                <1> 		jb writeiconline
  4804 00003B70 81C604000000        <1> 		add esi, 4
  4805 00003B76 FEC5                <1> 		inc ch
  4806 00003B78 BA00000000          <1> 		mov edx, 0
  4807 00003B7D 668B15[9B3B0000]    <1> 		mov dx, [resolutionx2]
  4808 00003B84 01D7                <1> 		add edi, edx
  4809 00003B86 81EF40000000        <1> 		sub edi, 64
  4810 00003B8C 80FD20              <1> 		cmp ch, 32
  4811 00003B8F 72A7                <1> 		jb writeicon
  4812 00003B91 B800000000          <1> 		mov eax, 0
  4813 00003B96 C3                  <1> 		ret
  4814                              <1> 
  4815 00003B97 0000                <1> resolutiony dw 0
  4816 00003B99 0000                <1> resolutionx dw 0
  4817 00003B9B 0000                <1> resolutionx2 dw 0
  4818 00003B9D 02                  <1> resolutionbytes db 2
  4819 00003B9E 0000                <1> posxvesa dw 0
  4820 00003BA0 0000                <1> posyvesa dw 0
  4821 00003BA2 FFFF                <1> colorfont dw 0xFFFF
  4822                              <1> savefontvesa:		;;same rules as showfontvesa
  4823 00003BA4 C605[332D0000]01    <1> 	mov byte [savefonton], 1
  4824                              <1> showfontvesa:		;;position in (dx,cx), color in bx, char in al
  4825 00003BAB 66890D[A03B0000]    <1> 	mov [posyvesa], cx
  4826 00003BB2 668915[9E3B0000]    <1> 	mov [posxvesa], dx
  4827 00003BB9 8B3D[7F530000]      <1> 	mov edi, [physbaseptr]
  4828 00003BBF 66891D[A23B0000]    <1> 	mov [colorfont], bx
  4829 00003BC6 BB00000000          <1> 	mov ebx, 0
  4830 00003BCB 88C3                <1> 	mov bl, al
  4831 00003BCD B800000000          <1> 	mov eax, 0
  4832 00003BD2 88D8                <1> 	mov al, bl
  4833 00003BD4 6689D3              <1> 	mov bx, dx
  4834 00003BD7 89DA                <1> 	mov edx, ebx
  4835 00003BD9 BB00000000          <1> 	mov ebx, 0
  4836 00003BDE 6681F90000          <1> 	cmp cx, 0
  4837 00003BE3 7415                <1> 	je vesaposloopdn
  4838 00003BE5 668B1D[9B3B0000]    <1> 	mov bx, [resolutionx2]
  4839                              <1> vesaposloop:
  4840 00003BEC 01DA                <1> 	add edx, ebx
  4841 00003BEE 6681E90100          <1> 	sub cx, 1
  4842 00003BF3 6681F90000          <1> 	cmp cx, 0
  4843 00003BF8 75F2                <1> 	jne vesaposloop
  4844                              <1> vesaposloopdn:
  4845 00003BFA 01D7                <1> 	add edi, edx
  4846 00003BFC BE[37490000]        <1> 	mov esi, fonts
  4847                              <1> findfontvesa:
  4848 00003C01 B400                <1> 	mov ah, 0
  4849 00003C03 C1E004              <1> 	shl eax, 4
  4850 00003C06 01C6                <1> 	add esi, eax
  4851 00003C08 C1E804              <1> 	shr eax, 4
  4852 00003C0B 81FE[57510000]      <1> 	cmp esi, fontend
  4853 00003C11 0F83BF000000        <1> 	jae near donefontvesa
  4854 00003C17 4E                  <1> 	dec esi
  4855                              <1> foundfontvesa:
  4856 00003C18 46                  <1> 	inc esi
  4857 00003C19 803D[332D0000]01    <1> 	cmp byte [savefonton], 1
  4858 00003C20 0F84E1000000        <1> 	je near vesafontsaver
  4859 00003C26 B100                <1> 	mov cl, 0
  4860 00003C28 8A06                <1> 	mov al, [esi]
  4861 00003C2A 668B15[9B3B0000]    <1> 	mov dx, [resolutionx2]
  4862 00003C31 662B15[9E3B0000]    <1> 	sub dx, [posxvesa]
  4863 00003C38 6681FA1000          <1> 	cmp dx, 16
  4864 00003C3D 7708                <1> 	ja paintfontvesa
  4865 00003C3F D0EA                <1> 	shr dl, 1
  4866 00003C41 8815[063D0000]      <1> 	mov [charwidth], dl
  4867                              <1> paintfontvesa:
  4868 00003C47 B201                <1> 	mov dl, 1
  4869 00003C49 20C2                <1> 	and dl, al
  4870 00003C4B 803D[322D0000]01    <1> 	cmp byte [showcursorfonton], 1
  4871 00003C52 0F8435000000        <1> 	je near nodelpaintedfont
  4872 00003C58 803D[322D0000]02    <1> 	cmp byte [showcursorfonton], 2
  4873 00003C5F 0F8518000000        <1> 	jne near noswitchcursorfonton
  4874 00003C65 80FA00              <1> 	cmp dl, 0
  4875 00003C68 0F842E000000        <1> 	je near nopixelset
  4876 00003C6E 668B1D[A23B0000]    <1> 	mov bx, [colorfont]
  4877 00003C75 66891F              <1> 	mov [edi], bx
  4878 00003C78 E91F000000          <1> 	jmp nopixelset
  4879                              <1> noswitchcursorfonton:
  4880 00003C7D 3215[342D0000]      <1> 	xor dl, [mouseselecton]
  4881 00003C83 668B1D[D92B0000]    <1> 	mov bx, [background]
  4882 00003C8A 66891F              <1> 	mov [edi], bx
  4883                              <1> nodelpaintedfont:
  4884 00003C8D 80FA00              <1> 	cmp dl, 0
  4885 00003C90 740A                <1> 	je nopixelset
  4886 00003C92 668B15[A23B0000]    <1> 	mov dx, [colorfont]
  4887 00003C99 668917              <1> 	mov [edi], dx
  4888                              <1> nopixelset:
  4889 00003C9C 81C702000000        <1> 	add edi, 2
  4890 00003CA2 D0C0                <1> 	rol al, 1
  4891 00003CA4 FEC1                <1> 	inc cl
  4892 00003CA6 3A0D[063D0000]      <1> 	cmp cl, [charwidth]
  4893 00003CAC 7299                <1> 	jb paintfontvesa
  4894 00003CAE FEC5                <1> 	inc ch
  4895 00003CB0 BA00000000          <1> 	mov edx, 0
  4896 00003CB5 668B15[9B3B0000]    <1> 	mov dx, [resolutionx2]
  4897 00003CBC 01D7                <1> 	add edi, edx
  4898 00003CBE BA00000000          <1> 	mov edx, 0
  4899 00003CC3 8A15[063D0000]      <1> 	mov dl, [charwidth]
  4900 00003CC9 00D2                <1> 	add dl, dl
  4901 00003CCB 29D7                <1> 	sub edi, edx
  4902 00003CCD 80FD10              <1> 	cmp ch, 16
  4903 00003CD0 0F8242FFFFFF        <1> 	jb foundfontvesa
  4904                              <1> donefontvesa:
  4905 00003CD6 B208                <1> 	mov dl, 8
  4906 00003CD8 8815[063D0000]      <1> 	mov [charwidth], dl
  4907 00003CDE 668B15[9E3B0000]    <1> 	mov dx, [posxvesa]
  4908 00003CE5 8A1D[063D0000]      <1> 	mov bl, [charwidth]
  4909 00003CEB B700                <1> 	mov bh, 0
  4910 00003CED 6601DA              <1> 	add dx, bx
  4911 00003CF0 668B1D[A23B0000]    <1> 	mov bx, [colorfont]
  4912 00003CF7 668B0D[A03B0000]    <1> 	mov cx, [posyvesa]
  4913 00003CFE C605[332D0000]00    <1> 	mov byte [savefonton], 0
  4914 00003D05 C3                  <1> 	ret
  4915 00003D06 08                  <1> charwidth db 8
  4916                              <1> vesafontsaver:
  4917 00003D07 B000                <1> 	mov al, 0
  4918 00003D09 B100                <1> 	mov cl, 0
  4919                              <1> vesafontsaver2:
  4920 00003D0B 668B17              <1> 	mov dx, [edi]
  4921 00003D0E 663B15[A23B0000]    <1> 	cmp dx, [colorfont]
  4922 00003D15 742F                <1> 	je colorfontmatch
  4923                              <1> donecolormatch:
  4924 00003D17 81C702000000        <1> 	add edi, 2
  4925 00003D1D D0C0                <1> 	rol al, 1
  4926 00003D1F FEC1                <1> 	inc cl
  4927 00003D21 80F908              <1> 	cmp cl, 8
  4928 00003D24 72E5                <1> 	jb vesafontsaver2
  4929 00003D26 8806                <1> 	mov [esi], al
  4930 00003D28 46                  <1> 	inc esi
  4931 00003D29 FEC5                <1> 	inc ch
  4932 00003D2B BA00000000          <1> 	mov edx, 0
  4933 00003D30 668B15[9B3B0000]    <1> 	mov dx, [resolutionx2]
  4934 00003D37 01D7                <1> 	add edi, edx
  4935 00003D39 81EF10000000        <1> 	sub edi, 16
  4936 00003D3F 80FD10              <1> 	cmp ch, 16
  4937 00003D42 72C3                <1> 	jb vesafontsaver
  4938 00003D44 EB90                <1> 	jmp donefontvesa
  4939                              <1> colorfontmatch:
  4940 00003D46 0401                <1> 	add al, 1
  4941 00003D48 EBCD                <1> 	jmp donecolormatch
  4942                              <1> 	
  4943                              <1> showbmp:
  4944 00003D4A 668B06              <1> 	mov ax, [esi]
  4945 00003D4D 663D424D            <1> 	cmp ax, "BM"
  4946 00003D51 0F858E000000        <1> 	jne near endedbmp
  4947 00003D57 8B3D[7F530000]      <1> 	mov edi, [physbaseptr]
  4948 00003D5D 6689D0              <1> 	mov ax, dx
  4949 00003D60 6689CB              <1> 	mov bx, cx
  4950 00003D63 B900000000          <1> 	mov ecx, 0
  4951 00003D68 BA00000000          <1> 	mov edx, 0
  4952 00003D6D 6689D9              <1> 	mov cx, bx
  4953 00003D70 6689C2              <1> 	mov dx, ax
  4954 00003D73 01D7                <1> 	add edi, edx
  4955 00003D75 01D7                <1> 	add edi, edx
  4956 00003D77 BA00000000          <1> 	mov edx, 0
  4957 00003D7C 668B15[9B3B0000]    <1> 	mov dx, [resolutionx2]
  4958 00003D83 41                  <1> 	inc ecx
  4959 00003D84 034E16              <1> 	add ecx, [esi + 22]
  4960                              <1> bmplocloop:
  4961 00003D87 01D7                <1> 	add edi, edx
  4962 00003D89 E2FC                <1> 	loop bmplocloop
  4963 00003D8B 29D7                <1> 	sub edi, edx
  4964 00003D8D 8B5612              <1> 	mov edx, [esi + 18]
  4965 00003D90 8B4E16              <1> 	mov ecx, [esi + 22]
  4966 00003D93 8B460A              <1> 	mov eax, [esi + 10]
  4967 00003D96 8B5E02              <1> 	mov ebx, [esi + 2]
  4968 00003D99 01F3                <1> 	add ebx, esi
  4969 00003D9B 891D[E63D0000]      <1> 	mov [bmpend], ebx
  4970 00003DA1 89D3                <1> 	mov ebx, edx
  4971 00003DA3 01C6                <1> 	add esi, eax
  4972                              <1> ldxbmp:
  4973 00003DA5 668B06              <1> 	mov ax, [esi]
  4974 00003DA8 668907              <1> 	mov [edi], ax
  4975 00003DAB 81C702000000        <1> 	add edi, 2
  4976 00003DB1 81C602000000        <1> 	add esi, 2
  4977 00003DB7 3B35[E63D0000]      <1> 	cmp esi, [bmpend]
  4978 00003DBD 7726                <1> 	ja endedbmp
  4979 00003DBF 4A                  <1> 	dec edx
  4980 00003DC0 81FA00000000        <1> 	cmp edx, 0
  4981 00003DC6 77DD                <1> 	ja ldxbmp
  4982 00003DC8 BA00000000          <1> 	mov edx, 0
  4983 00003DCD 668B15[9B3B0000]    <1> 	mov dx, [resolutionx2]
  4984 00003DD4 29DF                <1> 	sub edi, ebx
  4985 00003DD6 29DF                <1> 	sub edi, ebx
  4986 00003DD8 29D7                <1> 	sub edi, edx
  4987 00003DDA 49                  <1> 	dec ecx
  4988 00003DDB 89DA                <1> 	mov edx, ebx
  4989 00003DDD 81F900000000        <1> 	cmp ecx, 0
  4990 00003DE3 77C0                <1> 	ja ldxbmp
  4991                              <1> endedbmp:
  4992 00003DE5 C3                  <1> 	ret
  4993                              <1> 	
  4994 00003DE6 00000000            <1> 	bmpend dd 0
  4995                              <1> 
  4996                              <1> ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;Here are some vars;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
  4997 00003DEA 00000000            <1> 	showstringesi dw 0,0
  4998 00003DEE 00                  <1> 	mouseon db 0
  4999 00003DEF 737461727400        <1> 	start	db "start",0
  5000 00003DF5 536F6C6C65724F5300  <1> 	gotomenu db "SollerOS",0
  5001 00003DFE 426F6F2100          <1> 	boomsg db "Boo!",0
  5002 00003E03 5061636D616E207761- <1> 	pacmsg	db "Pacman was easy to draw.",0
  5003 00003E0C 73206561737920746F- <1>
  5004 00003E15 20647261772E00      <1>
  5005 00003E1C 4F6D206E6F6D206E6F- <1> 	pacnom  db "Om nom nom nom",0
  5006 00003E25 6D206E6F6D00        <1>
  5007 00003E2B 77696E646F77732073- <1> 	winmsg	db "windows sucks",0
  5008 00003E34 75636B7300          <1>
  5009 00003E39 5800                <1> 	xmsg db "X",0
  5010 00003E3B 0000                <1> 	icon dw 0	;pointer to icon
  5011 00003E3D 00000000            <1> 	codepointer dw 0,0 ;pointer to code
  5012 00003E41 00                  <1> 	iconselected db 0
  5013                              <1> 	
  5014                              <1> 	boo:
  5015 00003E42 BE[FE3D0000]        <1> 		mov esi, boomsg
  5016 00003E47 66BA6400            <1> 		mov dx, 100
  5017 00003E4B 66B94001            <1> 		mov cx, 320
  5018 00003E4F BB00000000          <1> 		mov ebx, 0
  5019 00003E54 66B80000            <1> 		mov ax, 0
  5020 00003E58 E9A5F8FFFF          <1> 		jmp showstring
  5021                              <1> 
  5022                              <1> 	pacmannomnom:
  5023 00003E5D BE[1C3E0000]        <1> 		mov esi, pacnom
  5024 00003E62 66BA8200            <1> 		mov dx, 130
  5025 00003E66 66B93C00            <1> 		mov cx, 60
  5026 00003E6A BB00000000          <1> 		mov ebx, 0
  5027 00003E6F 66B80000            <1> 		mov ax, 0
  5028 00003E73 E98AF8FFFF          <1> 		jmp showstring	
  5029                              <1> 	
  5030                              <1> 	noie:
  5031 00003E78 BE[0C3F0000]        <1> 		mov esi, termwindow
  5032 00003E7D 66BA0000            <1> 		mov dx, 0
  5033 00003E81 66B90000            <1> 		mov cx, 0
  5034 00003E85 BB[C70F0000]        <1> 		mov ebx, os
  5035                              <1> ;;		mov ebx, internettest
  5036 00003E8A 891D[66030000]      <1> 		mov [user2codepoint], ebx
  5037 00003E90 66B80000            <1> 		mov ax, 0
  5038 00003E94 E8BFF8FFFF          <1> 		call showwindow
  5039                              <1> ;;		jmp internettest
  5040 00003E99 E929D1FFFF          <1> 		jmp os
  5041 00003E9E C3                  <1> 		ret
  5042                              <1> 
  5043                              <1> 	gotomenuboot:
  5044 00003E9F BE[0C3F0000]        <1> 		mov esi, termwindow
  5045 00003EA4 66BA0000            <1> 		mov dx, 0
  5046 00003EA8 66B90000            <1> 		mov cx, 0
  5047 00003EAC BB[C70F0000]        <1> 		mov ebx, os
  5048 00003EB1 891D[66030000]      <1> 		mov [user2codepoint], ebx
  5049 00003EB7 66B80000            <1> 		mov ax, 0
  5050 00003EBB E898F8FFFF          <1> 		call showwindow
  5051 00003EC0 E902D1FFFF          <1> 		jmp os
  5052 00003EC5 C3                  <1> 		ret
  5053                              <1> 
  5054                              <1> 	winblows:
  5055 00003EC6 BE[2B3E0000]        <1> 		mov esi, winmsg
  5056 00003ECB 66BA0000            <1> 		mov dx, 0
  5057 00003ECF 668B0D[973B0000]    <1> 		mov cx, [resolutiony]
  5058 00003ED6 6681E92000          <1> 		sub cx, 32
  5059 00003EDB BB00000000          <1> 		mov ebx, 0
  5060 00003EE0 B400                <1> 		mov ah, 0
  5061 00003EE2 B011                <1> 		mov al, 00010001b
  5062 00003EE4 E819F8FFFF          <1> 		call showstring
  5063 00003EE9 BE[F53D0000]        <1> 		mov esi, gotomenu
  5064 00003EEE 668B0D[973B0000]    <1> 		mov cx, [resolutiony]
  5065 00003EF5 6681E93000          <1> 		sub cx, 48
  5066 00003EFA 66BA0000            <1> 		mov dx, 0
  5067 00003EFE B400                <1> 		mov ah, 0
  5068 00003F00 B010                <1> 		mov al, 00010000b
  5069 00003F02 BB[9F3E0000]        <1> 		mov ebx, gotomenuboot
  5070 00003F07 E9F6F7FFFF          <1> 		jmp showstring
  5071                              <1> 
  5072 00003F0C 8002E001            <1> 	termwindow:	dw 640,480	;;window size
  5073 00003F10 5445524D494E414C00  <1> 	termmsg:	db "TERMINAL",0	;;window title
  5074                              <1> 	
  5075 00003F10 <incbin>            <1> interneticon: 	incbin 'source/precompiled/interneticon.pak'
  5076 00003F10 <incbin>            <1> wordicon: 	incbin 'source/precompiled/wordicon.pak'
  5077 00003F10 <incbin>            <1> pacmanpellet: incbin 'source/precompiled/pacmanpellet.pak'
  5078 00003F10 <incbin>            <1> ghostie	incbin 'source/precompiled/ghostie.pak'
  5079 00003F10 <incbin>            <1> pacman	incbin 'source/precompiled/pacman.pak'
  5080                                      ;%include 'source/network.asm'
  5081                                  	%include 'source/rtl8139.asm'
  5082                              <1> ;;rtl8139.asm
  5083                              <1> initcard:	;;should find card, get mac, and initialize card
  5084 000041A3 B800000000          <1> 	mov eax, 0
  5085 000041A8 A2[DD440000]        <1> 	mov [pcifunction], al
  5086 000041AD A2[DB440000]        <1> 	mov [pcibus], al
  5087 000041B2 A2[DC440000]        <1> 	mov [pcidevice], al
  5088 000041B7 B002                <1> 	mov al, 0x02 ;;type code
  5089 000041B9 A2[60450000]        <1> 	mov [pcitype], al
  5090 000041BE E81D030000          <1> 	call getpciport
  5091                              <1> initnic:		;;;;Here i tried the rtl8139 interface, fuck it
  5092 000041C3 8915[B2430000]      <1> 	mov [basenicaddr], edx
  5093 000041C9 89D1                <1> 	mov ecx, edx
  5094 000041CB C605[1C150000]03    <1> 	mov byte [firsthexshown], 3
  5095 000041D2 E85AD3FFFF          <1> 	call showhex	;;for debugging, please remove
  5096 000041D7 BE[1F340000]        <1> 	mov esi, rbuffstart
  5097 000041DC B900200000          <1> 	mov ecx, 8192
  5098 000041E1 B800000000          <1> 	mov eax, 0
  5099                              <1> clearrbuff:		;;clear receive buffer which starts at rbuffstart
  5100 000041E6 8806                <1> 	mov [esi], al
  5101 000041E8 46                  <1> 	inc esi
  5102 000041E9 6649                <1> 	dec cx
  5103 000041EB 6681F90000          <1> 	cmp cx, 0
  5104 000041F0 75F4                <1> 	jne clearrbuff
  5105                              <1> findmac:
  5106 000041F2 8B15[B2430000]      <1> 	mov edx, [basenicaddr]
  5107 000041F8 BF[BA430000]        <1> 	mov edi, sysmac
  5108 000041FD B906000000          <1> 	mov ecx, 6
  5109                              <1> macputloop:
  5110 00004202 EC                  <1> 	in al, dx
  5111 00004203 8807                <1> 	mov [edi], al
  5112 00004205 47                  <1> 	inc edi
  5113 00004206 42                  <1> 	inc edx
  5114 00004207 49                  <1> 	dec ecx
  5115 00004208 75F8                <1> 	jnz macputloop
  5116 0000420A B9[BA430000]        <1> 	mov ecx, sysmac
  5117 0000420F E837010000          <1> 	call showmac
  5118                              <1> resetnic:
  5119 00004214 8B15[B2430000]      <1> 	mov edx, [basenicaddr]
  5120 0000421A 81C252000000        <1> 	add edx, 0x52
  5121 00004220 B000                <1> 	mov al, 0
  5122 00004222 EE                  <1> 	out dx, al	;;WAKE UP!!!!
  5123 00004223 8B15[B2430000]      <1> 	mov edx, [basenicaddr]
  5124 00004229 81C237000000        <1> 	add edx, 0x37
  5125 0000422F B010                <1> 	mov al, 0x10
  5126 00004231 EE                  <1> 	out dx, al	;;Reset
  5127                              <1> resetnicwait:
  5128 00004232 8B15[B2430000]      <1> 	mov edx, [basenicaddr]
  5129 00004238 81C237000000        <1> 	add edx, 0x37
  5130 0000423E EC                  <1> 	in al, dx
  5131 0000423F 2410                <1> 	and al, 0x10
  5132 00004241 3C10                <1> 	cmp al, 0x10
  5133 00004243 0F84E9FFFFFF        <1> 	je near resetnicwait
  5134 00004249 8B15[B2430000]      <1> 	mov edx, [basenicaddr]
  5135 0000424F 81C230000000        <1> 	add edx, 0x30
  5136 00004255 B8[1F340000]        <1> 	mov eax, rbuffstart
  5137 0000425A EF                  <1> 	out dx, eax	;;give nic receive buffer location
  5138 0000425B 8B15[B2430000]      <1> 	mov edx, [basenicaddr]
  5139 00004261 81C23C000000        <1> 	add edx, 0x3C
  5140 00004267 66B80500            <1> 	mov ax, 0x0005
  5141 0000426B 66EF                <1> 	out dx, ax	;;set TOK and ROK
  5142 0000426D 8B15[B2430000]      <1> 	mov edx, [basenicaddr]
  5143 00004273 81C244000000        <1> 	add edx, 0x44
  5144 00004279 B80F000000          <1> 	mov eax, 0xf
  5145 0000427E EF                  <1> 	out dx, eax	;;recieve packets from all matches
  5146 0000427F 8B15[B2430000]      <1> 	mov edx, [basenicaddr]
  5147 00004285 81C237000000        <1> 	add edx, 0x37
  5148 0000428B B00C                <1> 	mov al, 0x0C
  5149 0000428D EE                  <1> 	out dx, al	;;use transmit and receive
  5150 0000428E C605[9B430000]01    <1> 	mov byte [nicconfig], 1
  5151 00004295 C3                  <1> 	ret
  5152                              <1> 	
  5153                              <1> sendframe:	;;padded frame with beginning in edi and end in esi
  5154 00004296 56                  <1> 	push esi
  5155 00004297 57                  <1> 	push edi
  5156                              <1> nic2:		;;here come the low level drivers :(
  5157                              <1> 			;;frame begins at esi, ends at edi 			;;0x0200 is the class code for ethernet cards
  5158 00004298 803D[9B430000]01    <1> 	cmp byte [nicconfig], 1
  5159 0000429F 7405                <1> 	je sendcachedata
  5160 000042A1 E8FDFEFFFF          <1> 	call initcard
  5161                              <1> sendcachedata:
  5162 000042A6 8B15[B2430000]      <1> 	mov edx, [basenicaddr]
  5163 000042AC 81C210000000        <1> 	add edx, 0x10
  5164 000042B2 ED                  <1> 	in eax, dx
  5165 000042B3 89C1                <1> 	mov ecx, eax
  5166 000042B5 E877D2FFFF          <1> 	call showhex
  5167 000042BA 8B15[B2430000]      <1> 	mov edx, [basenicaddr]
  5168 000042C0 81C213000000        <1> 	add edx, 0x13
  5169 000042C6 ED                  <1> 	in eax, dx
  5170 000042C7 89C1                <1> 	mov ecx, eax
  5171 000042C9 E863D2FFFF          <1> 	call showhex
  5172 000042CE 8B15[B2430000]      <1> 	mov edx, [basenicaddr]
  5173 000042D4 81C223000000        <1> 	add edx, 0x23	;;23 or 20?
  5174 000042DA 5F                  <1> 	pop edi
  5175 000042DB 89F8                <1> 	mov eax, edi
  5176 000042DD EF                  <1> 	out dx, eax	;;here's Johnny!
  5177 000042DE 5E                  <1> 	pop esi
  5178 000042DF 29FE                <1> 	sub esi, edi
  5179 000042E1 89F0                <1> 	mov eax, esi
  5180 000042E3 8B15[B2430000]      <1> 	mov edx, [basenicaddr]
  5181 000042E9 81C213000000        <1> 	add edx, 0x13	;;13 or 10?
  5182 000042EF EF                  <1> 	out dx, eax
  5183                              <1> checknicstatus1:
  5184 000042F0 8B15[B2430000]      <1> 	mov edx, [basenicaddr]
  5185 000042F6 81C213000000        <1> 	add edx, 0x13	;;13 or 10?
  5186 000042FC ED                  <1> 	in eax, dx
  5187 000042FD 2500200000          <1> 	and eax, 0x2000
  5188 00004302 3D00200000          <1> 	cmp eax, 0x2000
  5189 00004307 75E7                <1> 	jne checknicstatus1
  5190                              <1> checknicstatus:
  5191 00004309 8B15[B2430000]      <1> 	mov edx, [basenicaddr]
  5192 0000430F 81C213000000        <1> 	add edx, 0x13	;;13 or 10?
  5193 00004315 ED                  <1> 	in eax, dx
  5194 00004316 2500800000          <1> 	and eax, 0x8000
  5195 0000431B 3D00800000          <1> 	cmp eax, 0x8000
  5196 00004320 75E7                <1> 	jne checknicstatus
  5197 00004322 8B15[B2430000]      <1> 	mov edx, [basenicaddr]
  5198 00004328 81C210000000        <1> 	add edx, 0x10
  5199 0000432E ED                  <1> 	in eax, dx
  5200 0000432F 89C1                <1> 	mov ecx, eax
  5201 00004331 E8FBD1FFFF          <1> 	call showhex
  5202 00004336 8B15[B2430000]      <1> 	mov edx, [basenicaddr]
  5203 0000433C 81C213000000        <1> 	add edx, 0x13
  5204 00004342 ED                  <1> 	in eax, dx
  5205 00004343 89C1                <1> 	mov ecx, eax
  5206 00004345 E8E7D1FFFF          <1> 	call showhex
  5207 0000434A C3                  <1> 	ret
  5208                              <1> 	
  5209                              <1> showmac:	;;mac begins in [ecx]
  5210 0000434B BE[83430000]        <1> 	mov esi, macprint
  5211 00004350 89CF                <1> 	mov edi, ecx
  5212 00004352 81C106000000        <1> 	add ecx, 6
  5213                              <1> showmacloop:
  5214 00004358 8A07                <1> 	mov al, [edi]
  5215 0000435A 8A27                <1> 	mov ah, [edi]
  5216 0000435C C0E804              <1> 	shr al, 4
  5217 0000435F C0E404              <1> 	shl ah, 4
  5218 00004362 C0EC04              <1> 	shr ah, 4
  5219 00004365 0430                <1> 	add al, 48
  5220 00004367 80C430              <1> 	add ah, 48
  5221 0000436A 668906              <1> 	mov [esi], ax
  5222 0000436D 81C603000000        <1> 	add esi, 3
  5223 00004373 47                  <1> 	inc edi
  5224 00004374 39CF                <1> 	cmp edi, ecx
  5225 00004376 72E0                <1> 	jb showmacloop
  5226 00004378 BE[83430000]        <1> 	mov esi, macprint
  5227 0000437D E802C8FFFF          <1> 	call print
  5228 00004382 C3                  <1> 	ret
  5229                              <1> 	
  5230 00004383 30302D30302D30302D- <1> macprint db "00-00-00-00-00-00  ",0
  5231 0000438C 30302D30302D303020- <1>
  5232 00004395 2000                <1>
  5233 00004397 00000000            <1> ethernetend dw 0,0
  5234 0000439B 00                  <1> nicconfig db 0
  5235 0000439C 4E4F204E494300      <1> nonicfoundmsg db "NO NIC",0
  5236 000043A3 496E6974696174696E- <1> initnicmsg	db "Initiating NIC",0
  5237 000043AC 67204E494300        <1>
  5238 000043B2 00000000            <1> basenicaddr	db 0,0,0,0
  5239 000043B6 C0A80005            <1> sysip db 192,168,0,5
  5240 000043BA 000000000000        <1> sysmac	db 0,0,0,0,0,0		;;my mac address
  5241                                  	%include 'source/arp.asm'
  5242                              <1> ;;let's try something else
  5243                              <1> ;;arp.asm
  5244                              <1> arpinit:
  5245 000043C0 BE[77440000]        <1> 	mov esi, arptable
  5246 000043C5 BF[BA430000]        <1> 	mov edi, sysmac
  5247 000043CA BB[B6430000]        <1> 	mov ebx, sysip
  5248 000043CF 8B0F                <1> 	mov ecx, [edi]
  5249 000043D1 890E                <1> 	mov [esi], ecx
  5250 000043D3 668B4F04            <1> 	mov cx, [edi + 4]
  5251 000043D7 894E04              <1> 	mov [esi + 4], ecx
  5252 000043DA 8B0B                <1> 	mov ecx, [ebx]
  5253 000043DC 894E06              <1> 	mov [esi + 6], ecx
  5254 000043DF C605[76440000]01    <1> 	mov byte [arpconfig], 1
  5255 000043E6 C3                  <1> 	ret
  5256                              <1> arptest:
  5257 000043E7 803D[76440000]01    <1> 	cmp byte [arpconfig], 1
  5258 000043EE 7405                <1> 	je arptest2
  5259 000043F0 E8CBFFFFFF          <1> 	call arpinit
  5260                              <1> arptest2:	;;try to reach 192.168.0.1
  5261 000043F5 8B0D[BA430000]      <1> 	mov ecx, [sysmac]
  5262 000043FB 668B1D[BE430000]    <1> 	mov bx, [sysmac + 4]
  5263 00004402 890D[3C440000]      <1> 	mov [sourcemac], ecx
  5264 00004408 66891D[40440000]    <1> 	mov [sourcemac + 4],bx
  5265 0000440F 890D[4C440000]      <1> 	mov [arpsenderinfo], ecx
  5266 00004415 66891D[50440000]    <1> 	mov [arpsenderinfo + 4], bx
  5267 0000441C BF[36440000]        <1> 	mov edi, frame
  5268 00004421 BE[76440000]        <1> 	mov esi, framend
  5269 00004426 E86BFEFFFF          <1> 	call sendframe
  5270 0000442B BE[11490000]        <1> 	mov esi, line
  5271 00004430 E84FC7FFFF          <1> 	call print
  5272 00004435 C3                  <1> 	ret
  5273                              <1> 	
  5274                              <1> ;;example frame
  5275                              <1> frame:
  5276 00004436 FFFFFFFFFFFF        <1> destinationmac:	db 0xFF,0xFF,0xFF,0xFF,0xFF,0xFF
  5277 0000443C 000000000000        <1> sourcemac:		db 0,0,0,0,0,0
  5278 00004442 0608                <1> ethertype:		dw 0x0806			;;arp
  5279                              <1> 	;;example packet
  5280 00004444 0100                <1> 	arppacket: 		dw 1				;;ethernet is 1
  5281 00004446 0008                <1> 	arpprotocol: 	dw 0x0800			;;ip is 0x800
  5282 00004448 0604                <1> 					db 6,4				;;length of mac, length of ip
  5283 0000444A 0100                <1> 	arpoperation: 	dw 1				;;one for arp request
  5284 0000444C 000000000000        <1> 	arpsenderinfo:	db 0x00,0x00,0x00,0x00,0x00,0x00	;;mac
  5285 00004452 C0A80005            <1> 					db 192,168,0,5			;;ip
  5286 00004456 000000000000        <1> 	arptargetinfo:	db 0x00,0x00,0x00,0x00,0x00,0x00	;;ignored in requests
  5287 0000445C C0A80001            <1> 					db 192,168,0,1			;;ip
  5288 00004460 00<rept>            <1> padding:		times (64-($-frame)) db 0
  5289                              <1> framend:
  5290                              <1> 
  5291 00004476 00                  <1> arpconfig db 0
  5292                              <1> arptable:	;;mac,ip
  5293 00004477 000000000000000000- <1> 	times 10 db 0,0,0,0,0,0,0,0,0,0
  5294 00004480 00<rept>            <1>
  5295                              <1> arptableend:
  5296                                  	%include 'source/pci.asm'
  5297 000044DB 00                  <1> pcibus		db 0
  5298 000044DC 00                  <1> pcidevice	db 0
  5299 000044DD 00                  <1> pcifunction	db 0
  5300 000044DE 00                  <1> pciregister	db 0
  5301 000044DF 00                  <1> pcireqtype db 0
  5302                              <1> 
  5303                              <1> getpciport:
  5304 000044E0 B001                <1> 	mov al, 1
  5305 000044E2 A2[DF440000]        <1> 	mov [pcireqtype], al
  5306 000044E7 E91E000000          <1> 	jmp searchpci
  5307                              <1> pcidump:
  5308 000044EC B800000000          <1> 	mov eax, 0
  5309 000044F1 A2[DD440000]        <1> 	mov [pcifunction], al
  5310 000044F6 A2[DB440000]        <1> 	mov [pcibus], al
  5311 000044FB A2[DC440000]        <1> 	mov [pcidevice], al
  5312 00004500 A2[DF440000]        <1> 	mov [pcireqtype], al
  5313 00004505 E900000000          <1> 	jmp searchpci
  5314                              <1> searchpci:		;;return in ebx, start X in pciX
  5315 0000450A B000                <1> 	mov al, 0
  5316 0000450C A2[DE440000]        <1> 	mov [pciregister], al
  5317 00004511 E84F010000          <1> 	call getpciaddr
  5318 00004516 BAF80C0000          <1> 	mov edx, 0xCF8
  5319 0000451B EF                  <1> 	out dx, eax	;;request pci config
  5320 0000451C BAFC0C0000          <1> 	mov edx, 0xCFC
  5321 00004521 ED                  <1> 	in eax, dx 	;;read in pci config
  5322 00004522 3D0000FFFF          <1> 	cmp eax, 0xFFFF0000
  5323 00004527 0F8237000000        <1> 	jb near checkpcidevice
  5324                              <1> searchpciret:
  5325                              <1> nextpcidevice:
  5326 0000452D B000                <1> 	mov al, 0
  5327 0000452F A2[DD440000]        <1> 	mov [pcifunction], al
  5328 00004534 A0[DC440000]        <1> 	mov al, [pcidevice]
  5329 00004539 3C1F                <1> 	cmp al, 11111b
  5330 0000453B 0F83B8000000        <1> 	jae near nextpcibus
  5331 00004541 FEC0                <1> 	inc al
  5332 00004543 A2[DC440000]        <1> 	mov [pcidevice], al
  5333 00004548 EBC0                <1> 	jmp searchpci
  5334 0000454A A0[DD440000]        <1> 	mov al, [pcifunction]
  5335 0000454F 3C07                <1> 	cmp al, 111b
  5336 00004551 0F83D6FFFFFF        <1> 	jae near nextpcidevice
  5337 00004557 FEC0                <1> 	inc al
  5338 00004559 A2[DD440000]        <1> 	mov [pcifunction], al
  5339 0000455E EBAA                <1> 	jmp searchpci
  5340 00004560 00000000            <1> pcitype: db 0,0,0,0
  5341                              <1> checkpcidevice:
  5342 00004564 B000                <1> 	mov al, 0
  5343 00004566 3805[DF440000]      <1> 	cmp [pcireqtype], al
  5344 0000456C 0F842B000000        <1> 	je near dumppcidevice
  5345 00004572 B008                <1> 	mov al, 0x08
  5346 00004574 A2[DE440000]        <1> 	mov [pciregister], al	;;class code, subclass, revision id
  5347 00004579 E8E7000000          <1> 	call getpciaddr
  5348 0000457E BAF80C0000          <1> 	mov edx, 0xCF8
  5349 00004583 EF                  <1> 	out dx, eax
  5350 00004584 BAFC0C0000          <1> 	mov edx, 0xCFC
  5351 00004589 ED                  <1> 	in eax, dx
  5352 0000458A C1C008              <1> 	rol eax, 8
  5353 0000458D 8A1D[60450000]      <1> 	mov bl, [pcitype]
  5354 00004593 38D8                <1> 	cmp al, bl
  5355 00004595 0F8480000000        <1> 	je near foundpciaddr
  5356 0000459B EB90                <1> 	jmp searchpciret
  5357                              <1> dumppcidevice:
  5358 0000459D B000                <1> 	mov al, 0
  5359 0000459F A2[DE440000]        <1> 	mov [pciregister], al
  5360 000045A4 E8BC000000          <1> 	call getpciaddr
  5361 000045A9 89C1                <1> 	mov ecx, eax
  5362 000045AB C605[1C150000]00    <1> 	mov byte [firsthexshown],0
  5363 000045B2 E87ACFFFFF          <1> 	call showhex
  5364                              <1> dumppcidevicelp:
  5365 000045B7 A2[DE440000]        <1> 	mov [pciregister], al
  5366 000045BC E8A4000000          <1> 	call getpciaddr
  5367 000045C1 BAF80C0000          <1> 	mov edx, 0xCF8
  5368 000045C6 EF                  <1> 	out dx, eax
  5369 000045C7 BAFC0C0000          <1> 	mov edx, 0xCFC
  5370 000045CC ED                  <1> 	in eax, dx
  5371 000045CD 89C1                <1> 	mov ecx, eax
  5372 000045CF A0[DE440000]        <1> 	mov al, [pciregister]
  5373 000045D4 0404                <1> 	add al, 4
  5374 000045D6 3C1A                <1> 	cmp al, 0x1A
  5375 000045D8 730E                <1> 	jae dumppcidn
  5376 000045DA C605[1C150000]00    <1> 	mov byte [firsthexshown],0
  5377 000045E1 E84BCFFFFF          <1> 	call showhex
  5378 000045E6 EBCF                <1> 	jmp dumppcidevicelp
  5379                              <1> dumppcidn:
  5380 000045E8 C605[1C150000]00    <1> 	mov byte [firsthexshown],0
  5381 000045EF E83DCFFFFF          <1> 	call showhex
  5382 000045F4 E934FFFFFF          <1> 	jmp searchpciret
  5383                              <1> nextpcibus:
  5384 000045F9 B000                <1> 	mov al, 0
  5385 000045FB A2[DC440000]        <1> 	mov [pcidevice], al
  5386 00004600 A0[DB440000]        <1> 	mov al, [pcibus]
  5387 00004605 3C7F                <1> 	cmp al, 1111111b
  5388 00004607 730C                <1> 	jae donesearchpci
  5389 00004609 FEC0                <1> 	inc al
  5390 0000460B A2[DB440000]        <1> 	mov [pcibus], al
  5391 00004610 E9F5FEFFFF          <1> 	jmp searchpci
  5392                              <1> donesearchpci:
  5393 00004615 BA00000000          <1> 	mov edx, 0
  5394 0000461A C3                  <1> 	ret
  5395                              <1> foundpciaddr:
  5396 0000461B B010                <1> 	mov al, 0x10
  5397 0000461D A2[DE440000]        <1> 	mov [pciregister], al
  5398                              <1> findpciioaddr:
  5399 00004622 E83E000000          <1> 	call getpciaddr
  5400 00004627 BAF80C0000          <1> 	mov edx, 0xCF8
  5401 0000462C EF                  <1> 	out dx, eax
  5402 0000462D BAFC0C0000          <1> 	mov edx, 0xCFC
  5403 00004632 ED                  <1> 	in eax, dx
  5404 00004633 89C3                <1> 	mov ebx, eax
  5405 00004635 81E301000000        <1> 	and ebx, 1
  5406 0000463B 81FB00000000        <1> 	cmp ebx, 0
  5407 00004641 0F8408000000        <1> 	je near notpciioaddr
  5408 00004647 2D01000000          <1> 	sub eax, 1
  5409 0000464C 89C2                <1> 	mov edx, eax
  5410 0000464E C3                  <1> 	ret
  5411                              <1> notpciioaddr:
  5412 0000464F A0[DE440000]        <1> 	mov al, [pciregister]
  5413 00004654 0404                <1> 	add al, 4
  5414 00004656 3C28                <1> 	cmp al, 0x28
  5415 00004658 0F87CFFEFFFF        <1> 	ja near searchpciret
  5416 0000465E A2[DE440000]        <1> 	mov [pciregister], al
  5417 00004663 EBBD                <1> 	jmp findpciioaddr
  5418                              <1> getpciaddr:		;;puts it in eax and ebx
  5419 00004665 B800000000          <1> 			mov eax, 0
  5420 0000466A BB00000080          <1> 			mov ebx, 0x80000000
  5421 0000466F A0[DB440000]        <1> 			mov al, [pcibus]
  5422 00004674 C1E010              <1> 			shl eax, 16
  5423 00004677 01C3                <1> 			add ebx, eax
  5424 00004679 B800000000          <1> 			mov eax, 0
  5425 0000467E A0[DC440000]        <1> 			mov al, [pcidevice]
  5426 00004683 C1E00B              <1> 			shl eax, 11
  5427 00004686 01C3                <1> 			add ebx, eax
  5428 00004688 B800000000          <1> 			mov eax, 0
  5429 0000468D A0[DD440000]        <1> 			mov al, [pcifunction]
  5430 00004692 C1E008              <1> 			shl eax, 8
  5431 00004695 01C3                <1> 			add ebx, eax
  5432 00004697 B800000000          <1> 			mov eax, 0
  5433 0000469C A0[DE440000]        <1> 			mov al, [pciregister]
  5434 000046A1 01C3                <1> 			add ebx, eax
  5435 000046A3 89D8                <1> 			mov eax, ebx
  5436 000046A5 C3                  <1> 			ret
  5437                              <1> 			
  5438                                  	;%include 'source/process.asm'
  5439                                      %include 'source/disk.asm'
  5440                              <1> ;;disk.asm - new - using lba
  5441                              <1> loadfile:	;;loads a file with the name buffer's location in edi into location in esi
  5442 000046A6 803F00              <1> 	cmp byte [edi], 0
  5443 000046A9 0F8444000000        <1> 	je near nofileload
  5444 000046AF 89FA                <1> 	mov edx, edi
  5445 000046B1 BB[5C480000]        <1> 	mov ebx, diskfileindex
  5446                              <1> nextnamechar:
  5447 000046B6 8A07                <1> 	mov al, [edi]
  5448 000046B8 8A23                <1> 	mov ah, [ebx]
  5449 000046BA 47                  <1> 	inc edi
  5450 000046BB 43                  <1> 	inc ebx
  5451 000046BC 88C1                <1> 	mov cl, al
  5452 000046BE 08E1                <1> 	or cl, ah
  5453 000046C0 80F900              <1> 	cmp cl, 0
  5454 000046C3 744E                <1> 	je equalfilenames
  5455 000046C5 80F920              <1> 	cmp cl, ' '
  5456 000046C8 7449                <1> 	je equalfilenames
  5457 000046CA 3C2A                <1> 	cmp al, '*'
  5458 000046CC 742B                <1> 	je equalfilenames2
  5459 000046CE 80FC00              <1> 	cmp ah, 0
  5460 000046D1 7410                <1> 	je nextfilename
  5461 000046D3 3C00                <1> 	cmp al, 0
  5462 000046D5 740C                <1> 	je nextfilename
  5463 000046D7 38E0                <1> 	cmp al, ah
  5464 000046D9 74DB                <1> 	je nextnamechar
  5465                              <1> getebxzero:
  5466 000046DB 8A23                <1> 	mov ah, [ebx]
  5467 000046DD 43                  <1> 	inc ebx
  5468 000046DE 80FC00              <1> 	cmp ah, 0
  5469 000046E1 75F8                <1> 	jne getebxzero
  5470                              <1> nextfilename:
  5471 000046E3 81C308000000        <1> 	add ebx, 8		;;next descriptor
  5472 000046E9 89D7                <1> 	mov edi, edx
  5473 000046EB 81FB[D3480000]      <1> 	cmp ebx, enddiskfileindex
  5474 000046F1 72C3                <1> 	jb nextnamechar
  5475                              <1> nofileload:
  5476 000046F3 BA94010000          <1> 	mov edx, 404	;;indicate not found error
  5477 000046F8 C3                  <1> 	ret
  5478                              <1> equalfilenames2:
  5479 000046F9 81EB02000000        <1> 	sub ebx, 2
  5480                              <1> eqfilefind:
  5481 000046FF 43                  <1> 	inc ebx
  5482 00004700 81FB[D3480000]      <1> 	cmp ebx, enddiskfileindex
  5483 00004706 0F83E7FFFFFF        <1> 	jae near nofileload
  5484 0000470C 8A03                <1> 	mov al, [ebx]
  5485 0000470E 3C00                <1> 	cmp al, 0
  5486 00004710 75ED                <1> 	jne eqfilefind
  5487 00004712 43                  <1> 	inc ebx
  5488                              <1> equalfilenames:
  5489 00004713 8B4304              <1> 	mov eax, [ebx + 4] 	;;put file size in eax
  5490 00004716 8B1B                <1> 	mov ebx, [ebx]		;;put file beginning in ebx
  5491 00004718 031D[2E000000]      <1> 	add ebx, [lbaad]	;;add offset to solleros
  5492 0000471E B900000000          <1> 	mov ecx, 0
  5493 00004723 88C1                <1> 	mov cl, al			;;get excess number of sectors
  5494 00004725 D0E1                <1> 	shl cl, 1
  5495 00004727 D0E9                <1> 	shr cl, 1			;;cut off at 128
  5496 00004729 29C8                <1> 	sub eax, ecx		;;get rid of excess sectors
  5497 0000472B B500                <1> 	mov ch, 0			;;drive 0
  5498 0000472D C1E807              <1> 	shr eax, 7			;;get number of 128 sector tracks
  5499                              <1> loaddiskfile:		;;tracks in eax, excess sectors in cl, drive in ch, buffer in esi, address in ebx
  5500 00004730 A3[6E470000]        <1> 	mov [filetracks], eax
  5501 00004735 89F7                <1> 	mov edi, esi		;;just in case cl is 0
  5502 00004737 89DA                <1> 	mov edx, ebx
  5503 00004739 80F900              <1> 	cmp cl, 0
  5504 0000473C 7405                <1> 	je copytracksforfile
  5505 0000473E E831000000          <1> 	call diskr		;;take care of excess sectors
  5506                              <1> copytracksforfile:
  5507 00004743 A1[6E470000]        <1> 	mov eax, [filetracks]
  5508 00004748 3D00000000          <1> 	cmp eax, 0
  5509 0000474D 7419                <1> 	je donecopyfile
  5510 0000474F 48                  <1> 	dec eax
  5511 00004750 A3[6E470000]        <1> 	mov [filetracks], eax
  5512 00004755 89D3                <1> 	mov ebx, edx	;;get end lba
  5513 00004757 B180                <1> 	mov cl, 0x80
  5514 00004759 8A2D[2D000000]      <1> 	mov ch, [DriveNumber]
  5515 0000475F 89FE                <1> 	mov esi, edi	;;reset buffer
  5516 00004761 E80E000000          <1> 	call diskr
  5517 00004766 EBDB                <1> 	jmp copytracksforfile
  5518                              <1> donecopyfile:
  5519 00004768 BA00000000          <1> 	mov edx, 0	;;no error
  5520 0000476D C3                  <1> 	ret
  5521                              <1> 	
  5522 0000476E 00000000            <1> filetracks dd 0
  5523                              <1> 	
  5524 00004772 6400                <1> segments dw 100
  5525                              <1> 
  5526                              <1> diskr:		;;sector count in cl, disk number in ch, 48 bit address with first 32 bits in ebx, buffer in esi, puts end buffer in edi and end lba in edx
  5527 00004774 8935[58480000]      <1> 	mov [bufferstartesi], esi
  5528 0000477A 891D[54480000]      <1> 	mov [lbaadstartebx], ebx
  5529 00004780 BA00000000          <1> 	mov edx, 0
  5530 00004785 88CA                <1> 	mov dl, cl
  5531 00004787 01DA                <1> 	add edx, ebx
  5532 00004789 8915[50480000]      <1> 	mov [lbaadend], edx
  5533 0000478F 66B80000            <1> 	mov ax, 0
  5534 00004793 66BAF101            <1> 	mov dx, 0x1F1
  5535 00004797 EE                  <1> 	out dx, al	;;2 null bytes
  5536 00004798 EE                  <1> 	out dx, al
  5537 00004799 B000                <1> 	mov al, 0
  5538 0000479B 66BAF201            <1> 	mov dx, 0x1F2
  5539 0000479F EE                  <1> 	out dx, al	;;16 bit sector count-last byte now 0
  5540 000047A0 88C8                <1> 	mov al, cl
  5541 000047A2 EE                  <1> 	out dx, al
  5542 000047A3 66BAF301            <1> 	mov dx, 0x1F3
  5543 000047A7 89D8                <1> 	mov eax, ebx
  5544 000047A9 C1C818              <1> 	ror eax, 24
  5545 000047AC EE                  <1> 	out dx, al	;;4th byte of address
  5546 000047AD C1C018              <1> 	rol eax, 24
  5547 000047B0 EE                  <1> 	out dx, al	;;1st byte of address
  5548 000047B1 66BAF401            <1> 	mov dx, 0x1F4
  5549 000047B5 B000                <1> 	mov al, 0
  5550 000047B7 EE                  <1> 	out dx, al	;;5th byte of address-always 0 for now
  5551 000047B8 C1C808              <1> 	ror eax, 8
  5552 000047BB EE                  <1> 	out dx, al	;;2nd byte of address
  5553 000047BC 66BAF501            <1> 	mov dx, 0x1F5
  5554 000047C0 C1C008              <1> 	rol eax, 8
  5555 000047C3 B000                <1> 	mov al, 0
  5556 000047C5 EE                  <1> 	out dx, al	;;6th byte
  5557 000047C6 C1C810              <1> 	ror eax, 16
  5558 000047C9 EE                  <1> 	out dx, al	;;3rd byte
  5559 000047CA B840000000          <1> 	mov eax, 0x40
  5560 000047CF 66BAF601            <1> 	mov dx, 0x1F6
  5561 000047D3 EE                  <1> 	out dx, al	;;send magic bits-add drive indicator later
  5562 000047D4 B024                <1> 	mov al, 0x24
  5563 000047D6 66BAF701            <1> 	mov dx, 0x1F7
  5564 000047DA EE                  <1> 	out dx, al	;;READ!!!
  5565                              <1> diskrwait:
  5566 000047DB 66BAF701            <1> 	mov dx, 0x1F7
  5567 000047DF EC                  <1> 	in al, dx
  5568 000047E0 2408                <1> 	and al, 0x08
  5569 000047E2 3C08                <1> 	cmp al, 0x08
  5570 000047E4 75F5                <1> 	jne diskrwait
  5571 000047E6 88CD                <1> 	mov ch, cl	;;move sector data into ch, multiplying it by 256
  5572 000047E8 B100                <1> 	mov cl, 0
  5573                              <1> diskdataread:
  5574 000047EA 66BAF001            <1> 	mov dx, 0x1F0
  5575 000047EE 66ED                <1> 	in ax, dx
  5576 000047F0 668906              <1> 	mov [esi], ax
  5577 000047F3 81C602000000        <1> 	add esi, 2
  5578 000047F9 6649                <1> 	dec cx
  5579 000047FB 6681F90000          <1> 	cmp cx, 0
  5580 00004800 75E8                <1> 	jne diskdataread		;;read all sectors
  5581 00004802 89F7                <1> 	mov edi, esi
  5582 00004804 8B15[50480000]      <1> 	mov edx, [lbaadend]
  5583 0000480A 8B35[58480000]      <1> 	mov esi, [bufferstartesi]
  5584 00004810 8B1D[54480000]      <1> 	mov ebx, [lbaadstartebx]
  5585 00004816 C3                  <1> 	ret
  5586                              <1> 	
  5587                              <1> 	
  5588                              <1> diskold: ;;28 bits
  5589 00004817 66B80000            <1> 	mov ax, 0
  5590 0000481B 66BAF101            <1> 	mov dx, 0x1F1
  5591 0000481F EE                  <1> 	out dx, al	;;send null byte to port
  5592 00004820 6642                <1> 	inc dx	;;0x1F2
  5593 00004822 88C8                <1> 	mov al, cl	;;get sector count
  5594 00004824 EE                  <1> 	out dx, al	;;send sector count
  5595 00004825 6642                <1> 	inc dx	;;0x1F3
  5596 00004827 88D8                <1> 	mov al, bl	;;get first 8 bits of address
  5597 00004829 EE                  <1> 	out dx, al	;;send them
  5598 0000482A 6642                <1> 	inc dx	;;0x1F4
  5599 0000482C C1CB08              <1> 	ror ebx, 8	;;get next 8 bits
  5600 0000482F 88D8                <1> 	mov al, bl
  5601 00004831 EE                  <1> 	out dx, al
  5602 00004832 6642                <1> 	inc dx	;;0x1F5
  5603 00004834 C1CB08              <1> 	ror ebx, 8	;;again
  5604 00004837 88D8                <1> 	mov al, bl
  5605 00004839 EE                  <1> 	out dx, al
  5606 0000483A 6642                <1> 	inc dx	;;0x1F6
  5607 0000483C C1CB08              <1> 	ror ebx, 8
  5608 0000483F 88D8                <1> 	mov al, bl
  5609 00004841 240F                <1> 	and al, 00001111b	;;last 4 bits of address
  5610 00004843 0CE0                <1> 	or al, 0xE0			;;majic number
  5611 00004845 C0E504              <1> 	shl ch, 4
  5612 00004848 08E8                <1> 	or al, ch
  5613 0000484A EE                  <1> 	out dx, al			;;send drive indicator, magic bits, and highest 4 bits of address
  5614 0000484B 6642                <1> 	inc dx	;;0x1F7
  5615 0000484D B020                <1> 	mov al, 0x20
  5616 0000484F EE                  <1> 	out dx, al			;;execute read command
  5617                              <1> 	
  5618 00004850 00000000            <1> lbaadend dd 0
  5619 00004854 00000000            <1> lbaadstartebx dd 0
  5620 00004858 00000000            <1> bufferstartesi dd 0
  5621                                      %include 'fileindex.asm'
  5622                              <1> diskfileindex:
  5623 0000485C 65787000            <1> db "exp",0
  5624 00004860 2B000000            <1> dd (f0-$$)/512
  5625 00004864 01000000            <1> dd (f1-f0)/512
  5626 00004868 736F6C6C65726F732E- <1> db "solleros.bmp",0
  5627 00004871 626D7000            <1>
  5628 00004875 2C000000            <1> dd (f1-$$)/512
  5629 00004879 B0020000            <1> dd (f2-f1)/512
  5630 0000487D 736F6C6C65726F732E- <1> db "solleros.txt",0
  5631 00004886 74787400            <1>
  5632 0000488A DC020000            <1> dd (f2-$$)/512
  5633 0000488E 01000000            <1> dd (f3-f2)/512
  5634 00004892 74656C7900          <1> db "tely",0
  5635 00004897 DD020000            <1> dd (f3-$$)/512
  5636 0000489B 01000000            <1> dd (f4-f3)/512
  5637 0000489F 5468756D62732E6462- <1> db "Thumbs.db",0
  5638 000048A8 00                  <1>
  5639 000048A9 DE020000            <1> dd (f4-$$)/512
  5640 000048AD 1F000000            <1> dd (f5-f4)/512
  5641 000048B1 74696D6500          <1> db "time",0
  5642 000048B6 FD020000            <1> dd (f5-$$)/512
  5643 000048BA 02000000            <1> dd (f6-f5)/512
  5644 000048BE 7475746F7269616C2E- <1> db "tutorial.bat",0
  5645 000048C7 62617400            <1>
  5646 000048CB FF020000            <1> dd (f6-$$)/512
  5647 000048CF 03000000            <1> dd (f7-f6)/512
  5648                              <1> enddiskfileindex:
  5649                              <1> 
  5650                                  	%include 'source/msg.asm'
  5651 000048D3 6578697400          <1> 	exitmsg db	"exit",0
  5652 000048D8 50726F6772616D2022- <1> 	notfound1 db "Program ",34,0
  5653 000048E1 00                  <1>
  5654 000048E2 22206E6F7420666F75- <1> 	notfound2 db  34," not found.",13,10,0
  5655 000048EB 6E642E0D0A00        <1>
  5656 000048F1 757365726E616D653A- <1> 	userask db "username:",0
  5657 000048FA 00                  <1>
  5658 000048FB 70617373776F72643A- <1> 	pwdask	db	"password:",0
  5659 00004904 00                  <1>
  5660 00004905 40536F6C6C65724F53- <1> 	location	db	"@SollerOS]#",0
  5661 0000490E 5D2300              <1>
  5662 00004911 0D0A00              <1> 	line	db	13,10,0
  5663                              <1> 	userlst:
  5664 00004914 7573657200          <1> 			db "user",0
  5665 00004919 70617373776F726400  <1> 			db "password",0
  5666 00004922 726F6F7400          <1> 			db "root",0
  5667 00004927 617765736F6D65706F- <1> 			db "awesomepower",0
  5668 00004930 77657200            <1>
  5669 00004934 6E00                <1> 			db "n",0	;;use for quick entry-a quick double n followed by a double enter will get you in
  5670 00004936 00                  <1> 			db 0
  5671                              <1> 	userlstend:
  5672                              <1> 	
  5673 00004936 <incbin>            <1> fonts:	incbin 'source/precompiled/fonts.pak'
  5674                              <1> fontend2:
  5675                              <1> mcursor:
  5676 00005147 01                  <1> 	db	00000001b
  5677 00005148 81                  <1> 	db	10000001b
  5678 00005149 C1                  <1> 	db	11000001b
  5679 0000514A E1                  <1> 	db	11100001b
  5680 0000514B F1                  <1> 	db	11110001b
  5681 0000514C F9                  <1> 	db	11111001b
  5682 0000514D FD                  <1> 	db	11111101b
  5683 0000514E FF                  <1> 	db	11111111b
  5684 0000514F F9                  <1> 	db	11111001b
  5685 00005150 B9                  <1> 	db	10111001b
  5686 00005151 39                  <1> 	db	00111001b
  5687 00005152 1C                  <1> 	db	00011100b
  5688 00005153 1C                  <1> 	db	00011100b
  5689 00005154 0E                  <1> 	db	00001110b
  5690 00005155 0E                  <1> 	db	00001110b
  5691 00005156 0C                  <1> 	db	00001100b
  5692                              <1> fontend:
  5693                              <1> 
  5694                              <1> ;cursorbmp:
  5695                              <1> ;	db	1,0,0,0,0,0,0,0
  5696                              <1> ;	db	1,1,0,0,0,0,0,0
  5697                              <1> ;	db	1,1,1,0,0,0,0,0
  5698                              <1> ;	db	1,1,1,1,0,0,0,0
  5699                              <1> ;	db	1,1,1,1,1,0,0,0
  5700                              <1> ;	db	1,1,1,1,1,1,0,0
  5701                              <1> ;	db	1,1,1,1,1,1,1,0
  5702                              <1> ;	db	1,1,1,1,1,1,1,1
  5703                              <1> ;	db	1,1,1,1,1,1,0,0
  5704                              <1> ;	db	1,1,0,1,1,1,0,0
  5705                              <1> ;	db	1,0,0,1,1,1,0,0
  5706                              <1> ;	db	0,0,0,0,1,1,1,0
  5707                              <1> ;	db	0,0,0,0,1,1,1,0
  5708                              <1> ;	db	0,0,0,0,0,1,1,1
  5709                              <1> ;	db	0,0,0,0,0,1,1,1
  5710                              <1> ;	db	0,0,0,0,0,1,1,0
  5711                              <1> ;cursorbmpend:
  5712                              <1> 
  5713                              <1> 
  5714                              <1> VBEMODEBLOCK:
  5715 00005157 00<rept>            <1> vbesignature 		times 4 db 0	;VBE Signature
  5716 0000515B 00<rept>            <1> vbeversion  		times 2 db 0	;VBE Version
  5717 0000515D 00<rept>            <1> oemstringptr  		times 4 db 0	;Pointer to OEM String
  5718 00005161 00<rept>            <1> capabilities 		times 4 db 0	;Capabilities of graphics cont.
  5719 00005165 00<rept>            <1> videomodeptr 		times 4 db 0	;Pointer to Video Mode List
  5720 00005169 00<rept>            <1> totalmemory   		times 2 db 0	;number of 64Kb memory blocks
  5721 0000516B 00<rept>            <1> oemsoftwarerev  	times 2 db 0	;VBE implementation Software revision
  5722 0000516D 00<rept>            <1> oemvendornameptr 	times 4 db 0	;Pointer to Vendor Name String
  5723 00005171 00<rept>            <1> oemproductnameptr 	times 4 db 0	;Pointer to Product Name String
  5724 00005175 00<rept>            <1> oemproductrevptr 	times 4 db 0	;Pointer to Product Revision String
  5725 00005179 00<rept>            <1> reserved			times 222 db 0	;Reserved for VBE implementation scratch area
  5726 00005257 00<rept>            <1> oemdata 			times 256 db 0	;Data Area for OEM Strings
  5727                              <1> 
  5728                              <1> 
  5729                              <1> VBEMODEINFOBLOCK:
  5730                              <1> ;Mandatory information for all VBE revision
  5731 00005357 00<rept>            <1> modeattributes   	times 2 db 0	;Mode attributes
  5732 00005359 00                  <1> winaattributes   	times 1 db 0	;Window A attributes
  5733 0000535A 00                  <1> winbattributes   	times 1 db 0	;Window B attributes
  5734 0000535B 00<rept>            <1> wingranularity   	times 2 db 0	;Window granularity
  5735 0000535D 00<rept>            <1> winsize          	times 2 db 0	;Window size
  5736 0000535F 00<rept>            <1> winasegment      	times 2 db 0	;Window A start segment
  5737 00005361 00<rept>            <1> winbsegment      	times 2 db 0	;Window B start segment
  5738 00005363 00<rept>            <1> winfuncptr       	times 4 db 0	;pointer to window function
  5739 00005367 00<rept>            <1> bytesperscanline 	times 2 db 0	;Bytes per scan line
  5740                              <1> 
  5741                              <1> ;Mandatory information for VBE 1.2 and above
  5742 00005369 00<rept>            <1> xresolution     	times 2 db 0	;Horizontal resolution in pixel or chars
  5743 0000536B 00<rept>            <1> yresolution	    	times 2 db 0	;Vertical resolution in pixel or chars
  5744 0000536D 00                  <1> xcharsize       	times 1 db 0	;Character cell width in pixel
  5745 0000536E 00                  <1> ycharsize       	times 1 db 0	;Character cell height in pixel
  5746 0000536F 00                  <1> numberofplanes  	times 1 db 0	;Number of memory planes
  5747 00005370 00                  <1> bitsperpixel    	times 1 db 0	;Bits per pixel
  5748 00005371 00                  <1> numberofbanks   	times 1 db 0	;Number of banks
  5749 00005372 00                  <1> memorymodel     	times 1 db 0	;Memory model type
  5750 00005373 00                  <1> banksize        	times 1 db 0	;Bank size in KB
  5751 00005374 00                  <1> numberofimagepages	times 1 db 0	;Number of images
  5752 00005375 00                  <1> reserved1       	times 1 db 0	;Reserved for page function
  5753                              <1> 
  5754                              <1> ;Direct Color fields (required for direct/6 and YUV/7 memory models)
  5755 00005376 00                  <1> redmasksize			times 1 db 0	;Size of direct color red mask in bits
  5756 00005377 00                  <1> redfieldposition	times 1 db 0	;Bit position of lsb of red bask
  5757 00005378 00                  <1> greenmasksize   	times 1 db 0	;Size of direct color green mask in bits
  5758 00005379 00                  <1> greenfieldposition	times 1 db 0	;Bit position of lsb of green bask
  5759 0000537A 00                  <1> bluemasksize		times 1 db 0	;Size of direct color blue mask in bits
  5760 0000537B 00                  <1> bluefieldposition	times 1 db 0	;Bit position of lsb of blue bask
  5761 0000537C 00                  <1> rsvdmasksize        times 1	db 0	;Size of direct color reserved mask in bits
  5762 0000537D 00                  <1> rsvdfieldposition	times 1	db 0	;Bit position of lsb of reserved bask
  5763 0000537E 00                  <1> directcolormodeinfo	times 1 db 0	;Direct color mode attributes
  5764                              <1> 
  5765                              <1> ;Mandatory information for VBE 2.0 and above
  5766 0000537F 00<rept>            <1> physbaseptr 		times 4 db 0	;Physical address for flat frame buffer
  5767 00005383 00<rept>            <1> offscreenmemoffset 	times 4 db 0	;Pointer to start of off screen memory
  5768 00005387 00<rept>            <1> offscreenmemsize 	times 2 db 0    ;Amount of off screen memory in 1Kb units
  5769 00005389 00<rept>            <1> reserved2 			times 206 db 0  ;Remainder of ModeInfoBlock
  5770                                  	;%include 'source/memory.asm'
  5771                                  	%include 'source/buf.asm'
  5772                              <1> [section .bss]
  5773                              <1> bssstart:
  5774                              <1> stack:
  5775 00000000 <res 00001000>      <1> 	resb 4096
  5776                              <1> stackend:
  5777                              <1> graphicstable: ;w type, dw datalocation, w locationx, w locationy, w selected, dw code
  5778 00001000 <res 00000200>      <1> 	resb 200h 
  5779                              <1> 	graphicstableend:
  5780                              <1> mousecolorbuf: ;where the gui under the mouse is stored
  5781 00001200 <res 00000100>      <1> 	resb 256 
  5782                              <1> mcolorend:
  5783 00001300 <res 00000001>      <1> IFON resb 1 
  5784 00001301 <res 00000064>      <1> IFTRUE resb 100 
  5785 00001365 <res 00000004>      <1> BATCHPOS resb 4 
  5786 00001369 <res 00000001>      <1> BATCHISON resb 1 
  5787 0000136A <res 00000001>      <1> LOOPON resb 1 
  5788 0000136B <res 00000004>      <1> LOOPPOS	resb 4 
  5789 0000136F <res 00000200>      <1> fileindex: resb 200h 
  5790                              <1> fileindexend:
  5791 0000156F <res 00000500>      <1> variables: 	resb 500h 
  5792 00001A6F <res 00000001>      <1> varend: resb 1
  5793 00001A70 <res 00000100>      <1> buftxt2: resb 100h
  5794 00001B70 <res 0000000A>      <1> resb 10
  5795 00001B7A <res 00000100>      <1> buftxt: resb 100h 
  5796 00001C7A <res 00000014>      <1> buf2:	resb 20 
  5797 00001C8E <res 00000001>      <1> numbuf: resb 1 
  5798 00001C8F <res 000012C0>      <1> videobuf2 		resb 0x12C0 
  5799 00002F4F <res 000000C8>      <1> videobufend		resb 200 
  5800                              <1> ;processcache:	;;eip, eax, ebx, ecx, edx, edi, esi, esp, ebp-9*4=36 bytes each
  5801                              <1> ;processcacheend:
  5802                              <1> ;alignb 4096		;;align 4 kbytes
  5803                              <1> ;ospagedir:
  5804                              <1> ;	resb 4096
  5805                              <1> ;ospagedirend:
  5806                              <1> ;pagetables:
  5807                              <1> ;	resb 4096
  5808 00003017 <res 00000004>      <1> lastcommandpos: resb 4
  5809 0000301B <res 00000004>      <1> currentcommandpos: resb 4
  5810                              <1> commandbuf:
  5811 0000301F <res 00000400>      <1> resb 1024
  5812                              <1> commandbufend:
  5813                              <1> rbuffstart: ;for use with networking
  5814 0000341F <res 00002014>      <1> resb 8212
  5815                              <1> bssend:
  5816                              <1> [section .text]
  5817                                      %include 'files.asm'
  5818 00005457 00<rept>            <1> align 512,db 0
  5819                              <1> f0:
  5820 00005457 <incbin>            <1> incbin "included/exp"
  5821 00005622 00<rept>            <1> align 512,db 0
  5822                              <1> f1:
  5823 00005622 <incbin>            <1> incbin "included/solleros.bmp"
  5824 0005B7E6 00<rept>            <1> align 512,db 0
  5825                              <1> f2:
  5826 0005B7E6 <incbin>            <1> incbin "included/solleros.txt"
  5827 0005B976 00<rept>            <1> align 512,db 0
  5828                              <1> f3:
  5829 0005B976 <incbin>            <1> incbin "included/tely"
  5830 0005BBBD 00<rept>            <1> align 512,db 0
  5831                              <1> f4:
  5832 0005BBBD <incbin>            <1> incbin "included/Thumbs.db"
  5833                              <1> align 512,db 0
  5834                              <1> f5:
  5835 0005BBBD <incbin>            <1> incbin "included/time"
  5836 0005FC7B 00<rept>            <1> align 512,db 0
  5837                              <1> f6:
  5838 0005FC7B <incbin>            <1> incbin "included/tutorial.bat"
  5839 000602AA 00<rept>            <1> align 512,db 0
  5840                              <1> f7:
