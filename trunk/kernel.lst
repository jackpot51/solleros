     1                                  [BITS 16]
     2                                      %include 'source/menu.asm'
     3                              <1>     ; MENU.ASM
     4                              <1> %include 'source/signature.asm'
     5                              <2> signature:	;used by bootloader to find SollerOS
     6 00000000 03000000            <2> dd 3
     7 00000004 534F4C4C45524F53    <2> db "SOLLEROS"
     8                              <2> signatureend:
     9                              <1> menustart:	
    10 0000000C 8CC8                <1> 	mov ax, cs
    11 0000000E 8ED8                <1> 	mov ds, ax
    12 00000010 8EC0                <1> 	mov es, ax
    13 00000012 8ED0                <1> 	mov ss, ax
    14 00000014 880E[6201]          <1> 	mov [DriveNumber], cl
    15 00000018 668916[6301]        <1> 	mov [lbaad], edx
    16 0000001D B800A0              <1> 	mov ax, 0xA000
    17 00000020 8EE8                <1> 	mov gs, ax
    18 00000022 B81200              <1> 	mov ax, 12h
    19 00000025 BB0000              <1> 	mov bx, 0
    20 00000028 CD10                <1> 	int 10h
    21                              <1> 	
    22                              <1> guiload:
    23 0000002A BE[6302]            <1> 	mov si, bootmsg
    24 0000002D E83C01              <1> 	call printrm
    25 00000030 B80000              <1> 	mov ax, 0
    26 00000033 CD16                <1> 	int 16h
    27 00000035 3C79                <1> 	cmp al, "y"
    28 00000037 0F85F400            <1> 	jne near guiload2
    29                              <1> guiloadagain:
    30 0000003B B8004F              <1> 	mov ax, 04F00h
    31 0000003E BF[D474]            <1> 	mov di, VBEMODEBLOCK
    32 00000041 CD10                <1> 	int 10h
    33 00000043 BE[F674]            <1> 	mov si, reserved
    34 00000046 81EE0200            <1> 	sub si, 2
    35                              <1> findvideomodes:
    36 0000004A 81C60200            <1> 	add si, 2
    37 0000004E 8B0C                <1> 	mov cx, [si]
    38 00000050 81F9FFFF            <1> 	cmp cx, 0xFFFF
    39 00000054 0F840A00            <1> 	je near nextvmode
    40 00000058 81FE[D475]          <1> 	cmp si, oemdata
    41 0000005C 0F83CF00            <1> 	jae near guiload2	;;kill if no valid list is found
    42 00000060 EBE8                <1> 	jmp findvideomodes 	
    43                              <1> ;;debug,shows vmodes available
    44                              <1> nextvmode:
    45 00000062 81EE0200            <1> 	sub si, 2
    46 00000066 81FE[F674]          <1> 	cmp si, reserved
    47 0000006A 0F82CDFF            <1> 	jb near guiloadagain
    48 0000006E 8B0C                <1> 	mov cx, [si]
    49 00000070 81F9FFFF            <1> 	cmp cx, 0xFFFF
    50 00000074 0F84EAFF            <1> 	je near nextvmode
    51 00000078 81C10040            <1> 	add cx, 0x4000 		;;Linear Frame Buffer
    52 0000007C B8014F              <1> 	mov ax, 04F01h
    53 0000007F BF[D476]            <1> 	mov di, VBEMODEINFOBLOCK
    54 00000082 890E[6701]          <1> 	mov [vesamode], cx
    55 00000086 CD10                <1> 	int 10h
    56 00000088 A0[ED76]            <1> 	mov al, [bitsperpixel]
    57 0000008B 3C10                <1> 	cmp al, 16
    58 0000008D 75D3                <1> 	jne nextvmode
    59 0000008F 8936[6901]          <1> 	mov [videomodecache], si
    60 00000093 80FC00              <1> 	cmp ah, 0
    61 00000096 0F842200            <1> 	je near setvesamode
    62 0000009A EBC6                <1> 	jmp nextvmode
    63 0000009C 0A0D49732074686973- <1> isthisvideook db 10,13,"Is this video mode OK?(y/n)",13,10,0
    64 000000A5 20766964656F206D6F- <1>
    65 000000AE 6465204F4B3F28792F- <1>
    66 000000B7 6E290D0A00          <1>
    67                              <1> setvesamode:
    68 000000BC 8B0E[E676]          <1> 	mov cx, [xresolution]
    69 000000C0 E8C100              <1> 	call decshow
    70 000000C3 B078                <1> 	mov al, "x"
    71 000000C5 E82901              <1> 	call char
    72 000000C8 8B0E[E876]          <1> 	mov cx, [yresolution]
    73 000000CC E8B500              <1> 	call decshow
    74 000000CF B040                <1> 	mov al, "@"
    75 000000D1 E81D01              <1> 	call char
    76 000000D4 8A0E[ED76]          <1> 	mov cl, [bitsperpixel]
    77 000000D8 E8A900              <1> 	call decshow
    78 000000DB BE[9C00]            <1> 	mov si, isthisvideook
    79 000000DE E88B00              <1> 	call printrm
    80 000000E1 B80000              <1> 	mov ax, 0
    81 000000E4 CD16                <1> 	int 16h
    82 000000E6 8B36[6901]          <1> 	mov si, [videomodecache]
    83 000000EA 3C79                <1> 	cmp al, "y"
    84 000000EC 0F8572FF            <1> 	jne near nextvmode
    85 000000F0 8B16[E676]          <1> 	mov dx, [xresolution]
    86 000000F4 8B0E[E876]          <1> 	mov cx, [yresolution]
    87 000000F8 8916[DA3C]          <1> 	mov [resolutionx], dx
    88 000000FC 890E[D83C]          <1> 	mov [resolutiony], cx
    89 00000100 01D2                <1> 	add dx, dx
    90 00000102 8916[DC3C]          <1> 	mov [resolutionx2], dx
    91 00000106 BA0000              <1> 	mov dx, 0
    92 00000109 B90000              <1> 	mov cx, 0
    93 0000010C B8024F              <1> 	mov ax, 04F02h
    94 0000010F 8B1E[6701]          <1> 	mov bx, [vesamode]
    95 00000113 CD10                <1> 	int 10h		;;enter VESA mode
    96 00000115 C606[6B01]00        <1> 	mov byte [guinodo], 0
    97 0000011A 6631C0              <1> 	xor eax, eax
    98 0000011D 6631DB              <1> 	xor ebx, ebx
    99 00000120 6631C9              <1> 	xor ecx, ecx
   100 00000123 6631D2              <1> 	xor edx, edx
   101 00000126 6631F6              <1> 	xor esi, esi
   102 00000129 6631FF              <1> 	xor edi, edi	;;reset registers
   103 0000012C E94E01              <1> 	jmp pmode
   104                              <1> guiload2:
   105 0000012F B9E001              <1> 	mov cx, 480
   106 00000132 BA8002              <1> 	mov dx, 640
   107 00000135 8916[DA3C]          <1> 	mov [resolutionx], dx
   108 00000139 01D2                <1> 	add dx, dx
   109 0000013B 8916[DC3C]          <1> 	mov [resolutionx2], dx
   110 0000013F 890E[D83C]          <1> 	mov [resolutiony], cx
   111 00000143 B81200              <1> 	mov ax, 12h
   112 00000146 BB0000              <1> 	mov bx, 0
   113 00000149 CD10                <1> 	int 10h
   114 0000014B C606[6B01]01        <1> 	mov byte [guinodo], 1
   115 00000150 6631DB              <1> 	xor ebx, ebx
   116 00000153 6631C9              <1> 	xor ecx, ecx
   117 00000156 6631D2              <1> 	xor edx, edx
   118 00000159 6631F6              <1> 	xor esi, esi
   119 0000015C 6631FF              <1> 	xor edi, edi
   120 0000015F E91B01              <1> 	jmp pmode
   121                              <1> 
   122 00000162 00                  <1> DriveNumber db 0
   123 00000163 00000000            <1> lbaad dd 0
   124                              <1> 	
   125 00000167 0000                <1> vesamode dw 0
   126 00000169 0000                <1> videomodecache dw 0
   127                              <1> 
   128 0000016B 00                  <1> guinodo db 0
   129                              <1> 
   130                              <1>     printrm:			; 'si' comes in with string address
   131 0000016C BB0700              <1> 	    mov bx,07		; write to display
   132 0000016F B40E                <1> 	    mov ah,0Eh		; screen function
   133 00000171 8A04                <1>     prs2:    mov al,[si]         ; get next character
   134 00000173 3C00                <1> 	    cmp al,0		; look for terminator 
   135 00000175 7405                <1>             je finpr2		; zero byte at end of string
   136 00000177 CD10                <1> 	    int 10h		; write character to screen.    
   137 00000179 46                  <1>      	    inc si	     	; move to next character
   138 0000017A EBF5                <1> 	    jmp prs2		; loop
   139 0000017C C3                  <1>     finpr2: ret
   140                              <1> 
   141 0000017D 0000000000          <1> dcnm db 0,0,0,0,0
   142 00000182 0000                <1> dcnmend db 0,0
   143                              <1> 
   144                              <1> 
   145                              <1> decshow:
   146 00000184 BE[7D01]            <1> 	mov si, dcnm
   147                              <1> decclear:
   148 00000187 B030                <1> 	mov al, "0"
   149 00000189 8804                <1> 	mov [si], al
   150 0000018B 46                  <1> 	inc si
   151 0000018C 81FE[8201]          <1> 	cmp si, dcnmend
   152 00000190 76F5                <1> 	jbe decclear
   153 00000192 4E                  <1> 	dec si
   154 00000193 E81500              <1> 	call convertrm
   155 00000196 BE[7D01]            <1> 	mov si, dcnm
   156                              <1> dectst:
   157 00000199 8A04                <1> 	mov al, [si]
   158 0000019B 46                  <1> 	inc si
   159 0000019C 81FE[8201]          <1> 	cmp si, dcnmend
   160 000001A0 7704                <1> 	ja dectstend
   161 000001A2 3C30                <1> 	cmp al, "0"
   162 000001A4 76F3                <1> 	jbe dectst
   163                              <1> dectstend:
   164 000001A6 4E                  <1> 	dec si
   165 000001A7 E8C2FF              <1> 	call printrm
   166 000001AA C3                  <1> 	ret
   167                              <1> 	
   168                              <1> 	
   169                              <1> convertrm:
   170 000001AB 4E                  <1> 	dec si
   171 000001AC 89F3                <1> 	mov bx, si		;place to convert into must be in si, number to convert must be in cx
   172                              <1> cnvrtrm:
   173 000001AE 89DE                <1> 	mov si, bx
   174 000001B0 81EE0300            <1> 	sub si, 3
   175 000001B4 46                  <1> ten3rm:	inc si
   176 000001B5 81F9E803            <1> 	cmp cx, 1000
   177 000001B9 7208                <1> 	jb ten2rm
   178 000001BB 81E9E803            <1> 	sub cx, 1000
   179 000001BF FE04                <1> 	inc byte [si]
   180 000001C1 EBEB                <1> 	jmp cnvrtrm
   181 000001C3 46                  <1> ten2rm:	inc si
   182 000001C4 81F96400            <1> 	cmp cx, 100
   183 000001C8 7208                <1> 	jb ten1rm
   184 000001CA 81E96400            <1> 	sub cx, 100
   185 000001CE FE04                <1> 	inc byte [si]
   186 000001D0 EBDC                <1> 	jmp cnvrtrm
   187 000001D2 46                  <1> ten1rm:	inc si
   188 000001D3 81F90A00            <1> 	cmp cx, 10
   189 000001D7 7208                <1> 	jb ten0rm
   190 000001D9 81E90A00            <1> 	sub cx, 10
   191 000001DD FE04                <1> 	inc byte [si]
   192 000001DF EBCD                <1> 	jmp cnvrtrm
   193 000001E1 46                  <1> ten0rm:	inc si
   194 000001E2 81F90100            <1> 	cmp cx, 1
   195 000001E6 7208                <1> 	jb tendnrm
   196 000001E8 81E90100            <1> 	sub cx, 1
   197 000001EC FE04                <1> 	inc byte [si]
   198 000001EE EBBE                <1> 	jmp cnvrtrm
   199                              <1> tendnrm:
   200 000001F0 C3                  <1> 	ret
   201                              <1> 
   202                              <1> 
   203                              <1> 
   204                              <1> 
   205                              <1>     char: 		    ;char must be in al
   206 000001F1 BB0700              <1>        mov bx, 07
   207 000001F4 B40E                <1> 	   mov ah, 0Eh
   208 000001F6 CD10                <1> 	   int 10h
   209 000001F8 C3                  <1> 	   ret
   210                              <1> 
   211                              <1> 		shutdown:
   212 000001F9 0F20C0              <1> 				mov eax, cr0
   213 000001FC 24FE                <1> 				and al,0xFE     ; back to realmode
   214 000001FE 0F22C0              <1> 				mov  cr0, eax   ; by toggling bit again
   215 00000201 FB                  <1> 				sti
   216 00000202 B80053              <1> 			MOV AX, 5300h	; Shuts down APM-Machines.
   217 00000205 31DB                <1> 			XOR BX, BX	; Newer machines automatically
   218 00000207 CD15                <1> 			INT 15h		; shut down
   219 00000209 B80453              <1> 			MOV AX, 5304h
   220 0000020C 31DB                <1> 			XOR BX, BX
   221 0000020E CD15                <1> 			INT 15h		; Interrupt 15h originally was
   222 00000210 B80153              <1> 			MOV AX, 5301h	; used for Cartridges (cassettes)
   223 00000213 31DB                <1> 			XOR BX, BX	; but is still in use for
   224 00000215 CD15                <1> 			INT 15h		; diverse things
   225 00000217 B80753              <1> 			MOV AX, 5307h
   226 0000021A BB0100              <1> 			MOV BX, 1
   227 0000021D B90300              <1> 			MOV CX, 3
   228 00000220 CD15                <1> 			INT 15h
   229 00000222 CF                  <1> 			IRET
   230                              <1> 
   231                              <1> 	coldboot:
   232 00000223 0F20C0              <1> 			   mov eax, cr0
   233 00000226 24FE                <1> 			   and al,0xFE     ; back to realmode
   234 00000228 0F22C0              <1> 			   mov  cr0, eax   ; by toggling bit again
   235 0000022B FB                  <1> 			   sti
   236 0000022C B84000              <1> 			MOV AX, 0040h
   237 0000022F 8EC0                <1> 			MOV ES, AX
   238 00000231 26C70672000000      <1> 			MOV WORD [ES:00072h], 0h
   239 00000238 EA0000FFFF          <1> 			JMP 0FFFFh:0000h
   240 0000023D CF                  <1> 			IRET
   241                              <1> 
   242                              <1> 		warmboot:
   243 0000023E E81200              <1> 			call realmode
   244 00000241 B84000              <1> 			MOV AX, 0040h
   245 00000244 8EC0                <1> 			MOV ES, AX
   246 00000246 26C70672003412      <1> 			MOV WORD [ES:00072h], 01234h
   247 0000024D EA0000FFFF          <1> 			JMP 0FFFFh:0000h
   248 00000252 CF                  <1> 			IRET
   249                              <1> 
   250                              <1> 
   251                              <1> realmode:
   252 00000253 0F20C0              <1>    mov eax, cr0
   253 00000256 24FE                <1>    and al,0xFE     ; back to realmode
   254 00000258 0F22C0              <1>    mov  cr0, eax   ; by toggling bit again
   255 0000025B FB                  <1>    sti
   256 0000025C 66B800000000        <1>    mov eax, 0
   257 00000262 C3                  <1>    ret
   258                              <1>    
   259 00000263 426F6F7420696E746F- <1> bootmsg:	db "Boot into the GUI?(y/n)",10,13,0
   260 0000026C 20746865204755493F- <1>
   261 00000275 28792F6E290A0D00    <1>
   262                                      %include 'source/pmode.asm'
   263                              <1> [BITS 16]
   264                              <1> ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
   265                              <1> ;	16-bit real mode
   266                              <1> ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
   267                              <1> 
   268                              <1> pmode:
   269 0000027D BA9200              <1> 	mov dx, 0x92
   270 00000280 EC                  <1> 	in al, dx	;;A20
   271 00000281 0C02                <1> 	or al, 2
   272 00000283 EE                  <1> 	out dx, al
   273 00000284 6631DB              <1> 	xor ebx,ebx
   274 00000287 8CCB                <1> 	mov bx,cs		; EBX=segment
   275 00000289 66C1E304            <1> 	shl ebx,4		;	<< 4
   276 0000028D 67668D03            <1> 	lea eax,[ebx]		; EAX=linear address of segment base
   277 00000291 A3[1308]            <1> 	mov [gdt2 + 2],ax
   278 00000294 A3[1B08]            <1> 	mov [gdt3 + 2],ax
   279 00000297 66C1E810            <1> 	shr eax,16
   280 0000029B A2[1508]            <1> 	mov [gdt2 + 4],al
   281 0000029E A2[1D08]            <1> 	mov [gdt3 + 4],al
   282 000002A1 8826[1808]          <1> 	mov [gdt2 + 7],ah
   283 000002A5 8826[2008]          <1> 	mov [gdt3 + 7],ah
   284 000002A9 66B8[00000000]      <1> 	mov eax, stack
   285 000002AF A3[2308]            <1> 	mov [gdts + 2],ax
   286 000002B2 66C1E810            <1> 	shr eax,16
   287 000002B6 A2[2508]            <1> 	mov [gdts + 4],al
   288 000002B9 8826[2808]          <1> 	mov [gdts + 7],ah
   289 000002BD 66B800001000        <1> 	mov eax, 0x100000
   290 000002C3 A3[2B08]            <1> 	mov [gdt4 + 2],ax
   291 000002C6 A3[3308]            <1> 	mov [gdt5 + 2],ax
   292 000002C9 66C1E810            <1> 	shr eax,16
   293 000002CD A2[2D08]            <1> 	mov [gdt4 + 4],al
   294 000002D0 A2[3508]            <1> 	mov [gdt5 + 4],al
   295 000002D3 8826[3008]          <1> 	mov [gdt4 + 7],ah
   296 000002D7 8826[3808]          <1> 	mov [gdt5 + 7],ah
   297                              <1> ; fix up gdt and idt
   298 000002DB 67668D83[01080000]  <1> 	lea eax,[ebx + gdt]	; EAX=linear address of gdt
   299 000002E3 66A3[F707]          <1> 	mov [gdtr + 2],eax
   300 000002E7 67668D83[3E080000]  <1> 	lea eax,[ebx + idt]	; EAX=linear address of idt
   301 000002EF 66A3[FD07]          <1> 	mov [idtr + 2],eax
   302 000002F3 FA                  <1> 	cli
   303 000002F4 0F0116[F507]        <1> 	lgdt [gdtr]
   304 000002F9 0F011E[FB07]        <1> 	lidt [idtr]
   305 000002FE 66BB00000000        <1> 	mov ebx, 0
   306 00000304 8CDB                <1> 	mov bx, ds
   307 00000306 66891E[D003]        <1> 	mov [basecache], ebx
   308 0000030B 0F20C0              <1> 	mov eax,cr0
   309 0000030E 0C01                <1> 	or al,1
   310 00000310 0F22C0              <1> 	mov cr0,eax
   311 00000313 EA[1803]1000        <1> 	jmp SYS_CODE_SEL:do_pm
   312                              <1> [BITS 32]
   313                              <1> do_pm:
   314 00000318 66B81800            <1> 	mov ax, SYS_DATA_SEL
   315 0000031C 8ED8                <1> 	mov ds,ax
   316 0000031E 8ED0                <1> 	mov ss, ax	;;can switch back to STACK_SEL later
   317 00000320 BC[00100000]        <1> 	mov esp, stackend	;;can switch back to 4096 later
   318 00000325 90                  <1> 	nop
   319 00000326 90                  <1> 	nop
   320 00000327 66B81800            <1> 	mov ax, SYS_DATA_SEL
   321 0000032B 8EC0                <1> 	mov es,ax
   322 0000032D 8EE0                <1> 	mov fs,ax
   323 0000032F 66B83000            <1> 	mov ax, NEW_DATA_SEL
   324 00000333 8EE8                <1> 	mov gs,ax
   325 00000335 BE00000000          <1> 	mov esi, 0
   326                              <1> copykernel:
   327 0000033A 648B06              <1> 	mov eax, [fs:esi]
   328 0000033D 658906              <1> 	mov [gs:esi], eax
   329 00000340 81C604000000        <1> 	add esi, 4
   330 00000346 81FE[00000000]      <1> 	cmp esi, bssstart
   331 0000034C 72EC                <1> 	jb copykernel
   332                              <1> 	
   333 0000034E BE[00000000]        <1> 	mov esi, bssstart
   334 00000353 B800000000          <1> 	mov eax, 0
   335                              <1> clearkernelbuffers:
   336 00000358 658906              <1> 	mov [gs:esi], eax
   337 0000035B 81C604000000        <1> 	add esi, 4
   338 00000361 81FE[3B842000]      <1> 	cmp esi, bssend
   339 00000367 72EF                <1> 	jb clearkernelbuffers
   340                              <1> 	
   341 00000369 EA[70030000]2800    <1> 	jmp NEW_CODE_SEL:done_copy
   342                              <1> 	
   343                              <1> done_copy:
   344 00000370 66B83000            <1> 	mov ax, NEW_DATA_SEL
   345 00000374 8ED8                <1> 	mov ds, ax
   346 00000376 8ED0                <1> 	mov ss, ax
   347 00000378 BC[00100000]        <1> 	mov esp, stackend
   348 0000037D 90                  <1> 	nop
   349 0000037E 90                  <1> 	nop
   350 0000037F 66B83000            <1> 	mov ax, NEW_DATA_SEL
   351 00000383 8EC0                <1> 	mov es, ax
   352 00000385 8EE0                <1> 	mov fs, ax
   353 00000387 66B81800            <1> 	mov ax, SYS_DATA_SEL
   354 0000038B 8EE8                <1> 	mov gs, ax
   355                              <1> 	
   356 0000038D B800001000          <1> 	mov eax, 0x100000
   357 00000392 C1E804              <1> 	shr eax, 4
   358 00000395 A3[D0030000]        <1> 	mov [basecache], eax
   359                              <1> 	
   360 0000039A 8B3D[FC760000]      <1> 	mov edi, [physbaseptr]
   361 000003A0 A1[D0030000]        <1> 	mov eax, [basecache]
   362 000003A5 C1E004              <1> 	shl eax, 4
   363 000003A8 29C7                <1> 	sub edi, eax
   364 000003AA 893D[FC760000]      <1> 	mov [physbaseptr], edi
   365 000003B0 E804140000          <1> 	call indexfiles	
   366 000003B5 803D[6B010000]00    <1> 	cmp byte [guinodo], 0
   367 000003BC 0F8405000000        <1> 	je near guido
   368 000003C2 E9CE0C0000          <1> 	jmp os
   369                              <1> 	
   370                              <1> guido:
   371 000003C7 E952290000          <1> 	jmp gui
   372                              <1> 	
   373 000003CC 00000000            <1> user2codepoint dw 0,0
   374 000003D0 00000000            <1> basecache dd 0
   375                              <1> 	
   376                              <1> 
   377                              <1> unhand:	
   378                              <1> 	%assign i 0
   379                              <1> 	%rep 40
   380                              <1> 	cli
   381                              <1> 	mov byte [intprob], i
   382                              <1> 	jmp unhand2
   383                              <1> 	%assign i i+1
   384                              <1> 	%endrep
   385 000003D4 FA                  <2>  cli
   386 000003D5 C605[2B070000]00    <2>  mov byte [intprob], i
   387 000003DC E9FB010000          <2>  jmp unhand2
   388                              <2>  %assign i i+1
   389 000003E1 FA                  <2>  cli
   390 000003E2 C605[2B070000]01    <2>  mov byte [intprob], i
   391 000003E9 E9EE010000          <2>  jmp unhand2
   392                              <2>  %assign i i+1
   393 000003EE FA                  <2>  cli
   394 000003EF C605[2B070000]02    <2>  mov byte [intprob], i
   395 000003F6 E9E1010000          <2>  jmp unhand2
   396                              <2>  %assign i i+1
   397 000003FB FA                  <2>  cli
   398 000003FC C605[2B070000]03    <2>  mov byte [intprob], i
   399 00000403 E9D4010000          <2>  jmp unhand2
   400                              <2>  %assign i i+1
   401 00000408 FA                  <2>  cli
   402 00000409 C605[2B070000]04    <2>  mov byte [intprob], i
   403 00000410 E9C7010000          <2>  jmp unhand2
   404                              <2>  %assign i i+1
   405 00000415 FA                  <2>  cli
   406 00000416 C605[2B070000]05    <2>  mov byte [intprob], i
   407 0000041D E9BA010000          <2>  jmp unhand2
   408                              <2>  %assign i i+1
   409 00000422 FA                  <2>  cli
   410 00000423 C605[2B070000]06    <2>  mov byte [intprob], i
   411 0000042A E9AD010000          <2>  jmp unhand2
   412                              <2>  %assign i i+1
   413 0000042F FA                  <2>  cli
   414 00000430 C605[2B070000]07    <2>  mov byte [intprob], i
   415 00000437 E9A0010000          <2>  jmp unhand2
   416                              <2>  %assign i i+1
   417 0000043C FA                  <2>  cli
   418 0000043D C605[2B070000]08    <2>  mov byte [intprob], i
   419 00000444 E993010000          <2>  jmp unhand2
   420                              <2>  %assign i i+1
   421 00000449 FA                  <2>  cli
   422 0000044A C605[2B070000]09    <2>  mov byte [intprob], i
   423 00000451 E986010000          <2>  jmp unhand2
   424                              <2>  %assign i i+1
   425 00000456 FA                  <2>  cli
   426 00000457 C605[2B070000]0A    <2>  mov byte [intprob], i
   427 0000045E E979010000          <2>  jmp unhand2
   428                              <2>  %assign i i+1
   429 00000463 FA                  <2>  cli
   430 00000464 C605[2B070000]0B    <2>  mov byte [intprob], i
   431 0000046B E96C010000          <2>  jmp unhand2
   432                              <2>  %assign i i+1
   433 00000470 FA                  <2>  cli
   434 00000471 C605[2B070000]0C    <2>  mov byte [intprob], i
   435 00000478 E95F010000          <2>  jmp unhand2
   436                              <2>  %assign i i+1
   437 0000047D FA                  <2>  cli
   438 0000047E C605[2B070000]0D    <2>  mov byte [intprob], i
   439 00000485 E952010000          <2>  jmp unhand2
   440                              <2>  %assign i i+1
   441 0000048A FA                  <2>  cli
   442 0000048B C605[2B070000]0E    <2>  mov byte [intprob], i
   443 00000492 E945010000          <2>  jmp unhand2
   444                              <2>  %assign i i+1
   445 00000497 FA                  <2>  cli
   446 00000498 C605[2B070000]0F    <2>  mov byte [intprob], i
   447 0000049F E938010000          <2>  jmp unhand2
   448                              <2>  %assign i i+1
   449 000004A4 FA                  <2>  cli
   450 000004A5 C605[2B070000]10    <2>  mov byte [intprob], i
   451 000004AC E92B010000          <2>  jmp unhand2
   452                              <2>  %assign i i+1
   453 000004B1 FA                  <2>  cli
   454 000004B2 C605[2B070000]11    <2>  mov byte [intprob], i
   455 000004B9 E91E010000          <2>  jmp unhand2
   456                              <2>  %assign i i+1
   457 000004BE FA                  <2>  cli
   458 000004BF C605[2B070000]12    <2>  mov byte [intprob], i
   459 000004C6 E911010000          <2>  jmp unhand2
   460                              <2>  %assign i i+1
   461 000004CB FA                  <2>  cli
   462 000004CC C605[2B070000]13    <2>  mov byte [intprob], i
   463 000004D3 E904010000          <2>  jmp unhand2
   464                              <2>  %assign i i+1
   465 000004D8 FA                  <2>  cli
   466 000004D9 C605[2B070000]14    <2>  mov byte [intprob], i
   467 000004E0 E9F7000000          <2>  jmp unhand2
   468                              <2>  %assign i i+1
   469 000004E5 FA                  <2>  cli
   470 000004E6 C605[2B070000]15    <2>  mov byte [intprob], i
   471 000004ED E9EA000000          <2>  jmp unhand2
   472                              <2>  %assign i i+1
   473 000004F2 FA                  <2>  cli
   474 000004F3 C605[2B070000]16    <2>  mov byte [intprob], i
   475 000004FA E9DD000000          <2>  jmp unhand2
   476                              <2>  %assign i i+1
   477 000004FF FA                  <2>  cli
   478 00000500 C605[2B070000]17    <2>  mov byte [intprob], i
   479 00000507 E9D0000000          <2>  jmp unhand2
   480                              <2>  %assign i i+1
   481 0000050C FA                  <2>  cli
   482 0000050D C605[2B070000]18    <2>  mov byte [intprob], i
   483 00000514 E9C3000000          <2>  jmp unhand2
   484                              <2>  %assign i i+1
   485 00000519 FA                  <2>  cli
   486 0000051A C605[2B070000]19    <2>  mov byte [intprob], i
   487 00000521 E9B6000000          <2>  jmp unhand2
   488                              <2>  %assign i i+1
   489 00000526 FA                  <2>  cli
   490 00000527 C605[2B070000]1A    <2>  mov byte [intprob], i
   491 0000052E E9A9000000          <2>  jmp unhand2
   492                              <2>  %assign i i+1
   493 00000533 FA                  <2>  cli
   494 00000534 C605[2B070000]1B    <2>  mov byte [intprob], i
   495 0000053B E99C000000          <2>  jmp unhand2
   496                              <2>  %assign i i+1
   497 00000540 FA                  <2>  cli
   498 00000541 C605[2B070000]1C    <2>  mov byte [intprob], i
   499 00000548 E98F000000          <2>  jmp unhand2
   500                              <2>  %assign i i+1
   501 0000054D FA                  <2>  cli
   502 0000054E C605[2B070000]1D    <2>  mov byte [intprob], i
   503 00000555 E982000000          <2>  jmp unhand2
   504                              <2>  %assign i i+1
   505 0000055A FA                  <2>  cli
   506 0000055B C605[2B070000]1E    <2>  mov byte [intprob], i
   507 00000562 E975000000          <2>  jmp unhand2
   508                              <2>  %assign i i+1
   509 00000567 FA                  <2>  cli
   510 00000568 C605[2B070000]1F    <2>  mov byte [intprob], i
   511 0000056F E968000000          <2>  jmp unhand2
   512                              <2>  %assign i i+1
   513 00000574 FA                  <2>  cli
   514 00000575 C605[2B070000]20    <2>  mov byte [intprob], i
   515 0000057C E95B000000          <2>  jmp unhand2
   516                              <2>  %assign i i+1
   517 00000581 FA                  <2>  cli
   518 00000582 C605[2B070000]21    <2>  mov byte [intprob], i
   519 00000589 E94E000000          <2>  jmp unhand2
   520                              <2>  %assign i i+1
   521 0000058E FA                  <2>  cli
   522 0000058F C605[2B070000]22    <2>  mov byte [intprob], i
   523 00000596 E941000000          <2>  jmp unhand2
   524                              <2>  %assign i i+1
   525 0000059B FA                  <2>  cli
   526 0000059C C605[2B070000]23    <2>  mov byte [intprob], i
   527 000005A3 E934000000          <2>  jmp unhand2
   528                              <2>  %assign i i+1
   529 000005A8 FA                  <2>  cli
   530 000005A9 C605[2B070000]24    <2>  mov byte [intprob], i
   531 000005B0 E927000000          <2>  jmp unhand2
   532                              <2>  %assign i i+1
   533 000005B5 FA                  <2>  cli
   534 000005B6 C605[2B070000]25    <2>  mov byte [intprob], i
   535 000005BD E91A000000          <2>  jmp unhand2
   536                              <2>  %assign i i+1
   537 000005C2 FA                  <2>  cli
   538 000005C3 C605[2B070000]26    <2>  mov byte [intprob], i
   539 000005CA E90D000000          <2>  jmp unhand2
   540                              <2>  %assign i i+1
   541 000005CF FA                  <2>  cli
   542 000005D0 C605[2B070000]27    <2>  mov byte [intprob], i
   543 000005D7 E900000000          <2>  jmp unhand2
   544                              <2>  %assign i i+1
   545                              <1> unhand2:
   546 000005DC 60                  <1> 	pushad
   547 000005DD C705[CC030000]0000- <1> 	mov dword [user2codepoint], 0
   548 000005E5 0000                <1>
   549 000005E7 89E6                <1> 	mov esi, esp
   550 000005E9 81C628000000        <1> 	add esi, ((unhndrgend - unhndrg)/13)*4
   551 000005EF 8935[21070000]      <1> 	mov [esploc], esi
   552 000005F5 BE[2C070000]        <1> 	mov esi, unhandmsg
   553 000005FA 8935[25070000]      <1> 	mov [esiloc], esi
   554 00000600 B900000000          <1> 	mov ecx, 0
   555 00000605 8A0D[2B070000]      <1> 	mov cl, [intprob]
   556 0000060B E8AC000000          <1> 	call expdump
   557                              <1> dumpstack:
   558 00000610 8B35[21070000]      <1> 	mov esi, [esploc]
   559 00000616 39E6                <1> 	cmp esi, esp
   560 00000618 7216                <1> 	jb donedump
   561 0000061A 368B0E              <1> 	mov ecx, [ss:esi]
   562 0000061D 81EE04000000        <1> 	sub esi, 4
   563 00000623 8935[21070000]      <1> 	mov [esploc], esi
   564 00000629 E88E000000          <1> 	call expdump
   565 0000062E EBE0                <1> 	jmp dumpstack
   566                              <1> donedump:
   567 00000630 8B35[21070000]      <1> 	mov esi, [esploc]
   568 00000636 368B7C2420          <1> 	mov edi, [ss:esp + 32]
   569 0000063B 8B4FFC              <1> 	mov ecx, [edi - 4]
   570 0000063E E879000000          <1> 	call expdump
   571 00000643 8B35[21070000]      <1> 	mov esi, [esploc]
   572 00000649 368B7C2420          <1> 	mov edi, [ss:esp + 32]
   573 0000064E 8B0F                <1> 	mov ecx, [edi]
   574 00000650 E867000000          <1> 	call expdump
   575 00000655 8B35[21070000]      <1> 	mov esi, [esploc]
   576 0000065B 368B7C2420          <1> 	mov edi, [ss:esp + 32]
   577 00000660 8B4F04              <1> 	mov ecx, [edi + 4]
   578 00000663 E854000000          <1> 	call expdump
   579 00000668 BE[96060000]        <1> 	mov esi, backtoosmsg
   580 0000066D E8E0050000          <1> 	call print
   581 00000672 B000                <1> 	mov al, 0
   582 00000674 E898050000          <1> 	call int302
   583 00000679 803D[782E0000]00    <1> 	cmp byte [guion], 0
   584 00000680 7505                <1> 	jne returnunhandgui
   585 00000682 E9200B0000          <1> 	jmp nwcmd
   586                              <1> returnunhandgui:
   587 00000687 E853260000          <1> 	call guiclear
   588 0000068C E86B2E0000          <1> 	call reloadallgraphics
   589 00000691 E9CD270000          <1> 	jmp guistart
   590 00000696 507265737320616E79- <1> backtoosmsg db "Press any key to return to SollerOS",10,13,0
   591 0000069F 206B657920746F2072- <1>
   592 000006A8 657475726E20746F20- <1>
   593 000006B1 536F6C6C65724F530A- <1>
   594 000006BA 0D00                <1>
   595                              <1> expdump:
   596 000006BC 8B35[25070000]      <1> 	mov esi, [esiloc]
   597 000006C2 89F7                <1> 	mov edi, esi
   598 000006C4 81C70D000000        <1> 	add edi, 13
   599 000006CA 81C604000000        <1> 	add esi, 4
   600 000006D0 893D[25070000]      <1> 	mov [esiloc], edi
   601 000006D6 4F                  <1> 	dec edi
   602 000006D7 E8690E0000          <1> 	call converthex
   603 000006DC 81EE04000000        <1> 	sub esi, 4
   604 000006E2 803D[782E0000]00    <1> 	cmp byte [guion], 0
   605 000006E9 0F8422000000        <1> 	je near expdumptext
   606 000006EF 668B0D[29070000]    <1> 	mov cx, [locunhand]
   607 000006F6 668105[29070000]10- <1> 	add word [locunhand], 16
   608 000006FE 00                  <1>
   609 000006FF 66BA0200            <1> 	mov dx, 2
   610 00000703 66B80100            <1> 	mov ax, 1
   611 00000707 66BB0000            <1> 	mov bx, 0
   612 0000070B E846310000          <1> 	call showstring2
   613 00000710 C3                  <1> 	ret
   614                              <1> expdumptext:
   615 00000711 E83C050000          <1> 	call print
   616 00000716 BE[8E6C0000]        <1> 	mov esi, line
   617 0000071B E832050000          <1> 	call print
   618 00000720 C3                  <1> 	ret
   619 00000721 00000000            <1> esploc dd 0
   620 00000725 00000000            <1> esiloc dd 0
   621 00000729 0100                <1> locunhand dw 1
   622 0000072B 00                  <1> intprob db 0
   623                              <1> 	unhandmsg:	
   624 0000072C 494E543D3030303030- <1> 			db "INT=00000000",0
   625 00000735 30303000            <1>
   626                              <1> unhndrg:
   627 00000739 45464C3D3030303030- <1> 			db "EFL=00000000",0
   628 00000742 30303000            <1>
   629 00000746 43533A3D3030303030- <1> 			db "CS:=00000000",0
   630 0000074F 30303000            <1>
   631 00000753 4549503D3030303030- <1> 			db "EIP=00000000",0
   632 0000075C 30303000            <1>
   633 00000760 4541583D3030303030- <1> 			db "EAX=00000000",0
   634 00000769 30303000            <1>
   635 0000076D 4543583D3030303030- <1> 			db "ECX=00000000",0
   636 00000776 30303000            <1>
   637 0000077A 4544583D3030303030- <1> 			db "EDX=00000000",0
   638 00000783 30303000            <1>
   639 00000787 4542583D3030303030- <1> 			db "EBX=00000000",0
   640 00000790 30303000            <1>
   641 00000794 4553503D3030303030- <1> 			db "ESP=00000000",0
   642 0000079D 30303000            <1>
   643 000007A1 4542503D3030303030- <1> 			db "EBP=00000000",0
   644 000007AA 30303000            <1>
   645 000007AE 4553493D3030303030- <1> 			db "ESI=00000000",0
   646 000007B7 30303000            <1>
   647 000007BB 4544493D3030303030- <1> unhndrgend:	db "EDI=00000000",0
   648 000007C4 30303000            <1>
   649 000007C8 434D443D3030303030- <1> 			db "CMD=00000000",0
   650 000007D1 30303000            <1>
   651 000007D5 434D443D3030303030- <1> 			db "CMD=00000000",0
   652 000007DE 30303000            <1>
   653 000007E2 434D443D3030303030- <1> 			db "CMD=00000000",0
   654 000007EB 30303000            <1>
   655                              <1> unhandmsgend:
   656                              <1> 
   657                              <1> timerinterrupt:
   658 000007EF E999630000          <1> 	jmp threadswitch
   659                              <1> 	
   660                              <1> handled:
   661 000007F4 CF                  <1> 	iret
   662                              <1> 
   663                              <1> [BITS 16]
   664                              <1> ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
   665                              <1> ;	16-bit limit/32-bit linear base address of GDT and IDT
   666                              <1> ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
   667 000007F5 3700                <1> gdtr:	dw gdt_end - gdt - 1	; GDT limit
   668 000007F7 [01080000]          <1> 	dd gdt			; linear, physical address of GDT
   669                              <1> 
   670 000007FB 8701                <1> idtr:	dw idt_end - idt - 1	; IDT limit
   671 000007FD [3E080000]          <1> 	dd idt			; linear, physical address of IDT
   672                              <1> 
   673                              <1> 
   674 00000801 0000                <1> gdt:	dw 0			; limit 15:0
   675 00000803 0000                <1> 	dw 0			; base 15:0
   676 00000805 00                  <1> 	db 0			; base 23:16
   677 00000806 00                  <1> 	db 0			; type
   678 00000807 00                  <1> 	db 0			; limit 19:16, flags
   679 00000808 00                  <1> 	db 0			; base 31:24
   680                              <1> ; linear data segment descriptor
   681                              <1> LINEAR_SEL	equ	$-gdt
   682 00000809 FFFF                <1> 	dw 0xFFFF		; limit 0xFFFFF
   683 0000080B 0000                <1> 	dw 0			; base for this one is always 0
   684 0000080D 00                  <1> 	db 0
   685 0000080E 92                  <1> 	db 0x92			; present, ring 0, data, expand-up, writable
   686 0000080F CF                  <1> 	db 0xCF			; page-granular, 32-bit
   687 00000810 00                  <1> 	db 0
   688                              <1> ; code segment descriptor
   689                              <1> SYS_CODE_SEL	equ	$-gdt
   690 00000811 FFFF                <1> gdt2:	dw 0xFFFF
   691 00000813 0000                <1> 	dw 0			; (base gets set above)
   692 00000815 00                  <1> 	db 0
   693 00000816 9A                  <1> 	db 0x9A			; present, ring 0, code, non-conforming, readable
   694 00000817 CF                  <1> 	db 0xCF
   695 00000818 00                  <1> 	db 0
   696                              <1> ; data segment descriptor
   697                              <1> SYS_DATA_SEL	equ	$-gdt
   698 00000819 FFFF                <1> gdt3:	dw 0xFFFF
   699 0000081B 0000                <1> 	dw 0			; (base gets set above)
   700 0000081D 00                  <1> 	db 0
   701 0000081E 92                  <1> 	db 0x92			; present, ring 0, data, expand-up, writable
   702 0000081F CF                  <1> 	db 0xCF
   703 00000820 00                  <1> 	db 0
   704                              <1> STACK_SEL	equ	$-gdt	;;this is no longer used for various reasons
   705 00000821 0100                <1> gdts:	dw 1
   706 00000823 0000                <1> 	dw 0			; (base gets set above)
   707 00000825 00                  <1> 	db 0
   708 00000826 92                  <1> 	db 0x92			; present, ring 0, data, expand-up, writable
   709 00000827 C0                  <1> 	db 0xC0
   710 00000828 00                  <1> 	db 0
   711                              <1> NEW_CODE_SEL	equ	$-gdt
   712 00000829 FFFF                <1> gdt4:	dw 0xFFFF
   713 0000082B 0000                <1> 	dw 0			; (base gets set above)
   714 0000082D 00                  <1> 	db 0
   715 0000082E 9A                  <1> 	db 0x9A			; present, ring 0, code, non-conforming, readable
   716 0000082F CF                  <1> 	db 0xCF
   717 00000830 00                  <1> 	db 0
   718                              <1> ; data segment descriptor
   719                              <1> NEW_DATA_SEL	equ	$-gdt
   720 00000831 FFFF                <1> gdt5:	dw 0xFFFF
   721 00000833 0000                <1> 	dw 0			; (base gets set above)
   722 00000835 00                  <1> 	db 0
   723 00000836 92                  <1> 	db 0x92			; present, ring 0, data, expand-up, writable
   724 00000837 CF                  <1> 	db 0xCF
   725 00000838 00                  <1> 	db 0
   726                              <1> gdt_end:
   727                              <1> ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
   728                              <1> ;	interrupt descriptor table (IDT)
   729                              <1> ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
   730                              <1> ; 32 reserved interrupts:
   731 00000839 494454              <1> db "IDT"
   732 0000083C [D403]              <1> dw unhand
   733                              <1> idt:	
   734                              <1> %assign i 0
   735                              <1> %rep    8
   736                              <1>         dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   737                              <1> %assign i i+1 
   738                              <1> %endrep
   739 0000083E [D403]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   740                              <2> %assign i i+1
   741 00000846 [E103]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   742                              <2> %assign i i+1
   743 0000084E [EE03]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   744                              <2> %assign i i+1
   745 00000856 [FB03]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   746                              <2> %assign i i+1
   747 0000085E [0804]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   748                              <2> %assign i i+1
   749 00000866 [1504]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   750                              <2> %assign i i+1
   751 0000086E [2204]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   752                              <2> %assign i i+1
   753 00000876 [2F04]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   754                              <2> %assign i i+1
   755 0000087E [EF07]1000008E0000  <1> 		dw timerinterrupt,SYS_CODE_SEL,0x8E00,0
   756                              <1> %assign i 9
   757                              <1> %rep    5
   758                              <1>         dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   759                              <1> %assign i i+1 
   760                              <1> %endrep
   761 00000886 [4904]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   762                              <2> %assign i i+1
   763 0000088E [5604]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   764                              <2> %assign i i+1
   765 00000896 [6304]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   766                              <2> %assign i i+1
   767 0000089E [7004]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   768                              <2> %assign i i+1
   769 000008A6 [7D04]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   770                              <2> %assign i i+1
   771 000008AE [F407]1000008E0000  <1> 		dw handled,SYS_CODE_SEL,0x8E00,0		;;irq 7 or int 0xF is random, unusable, and usually reserved
   772                              <1> %assign i 15
   773                              <1> %rep    33
   774                              <1> 		dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   775                              <1> %assign i i+1
   776                              <1> %endrep
   777 000008B6 [9704]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   778                              <2> %assign i i+1
   779 000008BE [A404]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   780                              <2> %assign i i+1
   781 000008C6 [B104]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   782                              <2> %assign i i+1
   783 000008CE [BE04]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   784                              <2> %assign i i+1
   785 000008D6 [CB04]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   786                              <2> %assign i i+1
   787 000008DE [D804]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   788                              <2> %assign i i+1
   789 000008E6 [E504]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   790                              <2> %assign i i+1
   791 000008EE [F204]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   792                              <2> %assign i i+1
   793 000008F6 [FF04]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   794                              <2> %assign i i+1
   795 000008FE [0C05]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   796                              <2> %assign i i+1
   797 00000906 [1905]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   798                              <2> %assign i i+1
   799 0000090E [2605]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   800                              <2> %assign i i+1
   801 00000916 [3305]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   802                              <2> %assign i i+1
   803 0000091E [4005]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   804                              <2> %assign i i+1
   805 00000926 [4D05]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   806                              <2> %assign i i+1
   807 0000092E [5A05]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   808                              <2> %assign i i+1
   809 00000936 [6705]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   810                              <2> %assign i i+1
   811 0000093E [7405]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   812                              <2> %assign i i+1
   813 00000946 [8105]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   814                              <2> %assign i i+1
   815 0000094E [8E05]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   816                              <2> %assign i i+1
   817 00000956 [9B05]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   818                              <2> %assign i i+1
   819 0000095E [A805]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   820                              <2> %assign i i+1
   821 00000966 [B505]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   822                              <2> %assign i i+1
   823 0000096E [C205]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   824                              <2> %assign i i+1
   825 00000976 [CF05]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   826                              <2> %assign i i+1
   827 0000097E [DC05]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   828                              <2> %assign i i+1
   829 00000986 [E905]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   830                              <2> %assign i i+1
   831 0000098E [F605]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   832                              <2> %assign i i+1
   833 00000996 [0306]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   834                              <2> %assign i i+1
   835 0000099E [1006]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   836                              <2> %assign i i+1
   837 000009A6 [1D06]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   838                              <2> %assign i i+1
   839 000009AE [2A06]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   840                              <2> %assign i i+1
   841 000009B6 [3706]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   842                              <2> %assign i i+1
   843                              <1> 		
   844                              <1> ;;INT 30h for os use and 3rd party use:
   845 000009BE [C609]1000008E0000  <1> 	dw newints,SYS_CODE_SEL,0x8E00,0
   846                              <1> idt_end:
   847                              <1> [BITS 32]
   848                                  [BITS 32]
   849                                      %include 'source/ints.asm'
   850                              <1> newints:	;;for great justice
   851 000009C6 80FC00              <1> 	cmp ah, 0		;;originally 0
   852 000009C9 0F8452000000        <1> 	je near intx0   ;;0=kills app
   853 000009CF 80FC01              <1> 	cmp ah, 1		;;originally 1
   854 000009D2 0F844E000000        <1> 	je near intx1   ;;3=print string
   855 000009D8 80FC02              <1> 	cmp ah, 2		;;originally 2
   856 000009DB 0F844B000000        <1> 	je near intx2	;;4=read string
   857 000009E1 80FC03              <1> 	cmp ah, 3		;;originally 3
   858 000009E4 0F8448000000        <1> 	je near intx3	;;6=clear screen
   859 000009EA 80FC04              <1> 	cmp ah, 4		;;originally 4
   860 000009ED 0F8445000000        <1> 	je near intx4	;;5=read and print string
   861 000009F3 80FC05              <1> 	cmp ah, 5		;;originally 5		
   862 000009F6 0F8442000000        <1> 	je near intx5	;;2=get char
   863 000009FC 80FC06              <1> 	cmp ah, 6		;;originally 6
   864 000009FF 0F843F000000        <1> 	je near intx6	;;1=print char
   865 00000A05 80FC07              <1> 	cmp ah, 7
   866 00000A08 0F843C000000        <1> 	je near intx7	;;read file
   867 00000A0E 80FC09              <1> 	cmp ah, 9
   868 00000A11 0F8439000000        <1> 	je near intx9	;;convert number
   869 00000A17 80FC0A              <1> 	cmp ah, 10
   870 00000A1A 0F8440000000        <1> 	je near intx10	;;create thread
   871 00000A20 C3                  <1> 	ret
   872                              <1> 	
   873                              <1> intx0:
   874 00000A21 E981070000          <1> 	jmp nwcmd
   875                              <1> intx1:
   876 00000A26 E82F020000          <1> 	call int303
   877 00000A2B C3                  <1> 	ret
   878                              <1> intx2:
   879 00000A2C E84C020000          <1> 	call int304
   880 00000A31 C3                  <1> 	ret
   881                              <1> intx3:
   882 00000A32 E80B050000          <1> 	call int306
   883 00000A37 C3                  <1> 	ret
   884                              <1> intx4:
   885 00000A38 E86D020000          <1> 	call int305
   886 00000A3D C3                  <1> 	ret
   887                              <1> intx5:
   888 00000A3E E8CE010000          <1> 	call int302
   889 00000A43 C3                  <1> 	ret
   890                              <1> intx6:
   891 00000A44 E822000000          <1> 	call int301
   892 00000A49 C3                  <1> 	ret
   893                              <1> intx7:
   894 00000A4A E89D3D0000          <1> 	call loadfile
   895 00000A4F C3                  <1> 	ret
   896                              <1> intx9:
   897 00000A50 3C00                <1> 	cmp al, 0
   898 00000A52 7506                <1> 	jne intx9B
   899 00000A54 E83B0C0000          <1> 	call showdec
   900 00000A59 C3                  <1> 	ret
   901                              <1> intx9B:
   902 00000A5A E8900B0000          <1> 	call showhex
   903 00000A5F C3                  <1> 	ret
   904                              <1> intx10:
   905                              <1> ;	call thread
   906 00000A60 C3                  <1> 	ret
   907                              <1> 	
   908 00000A61 0000                <1> linebeginpos dw 0
   909 00000A63 0000                <1> videobufpos: dw 0
   910 00000A65 0000                <1> charpos db 0,0
   911 00000A67 A01E                <1> charxy db 160,30
   912 00000A69 0000                <1> charbuf dw 0
   913                              <1> 
   914                              <1> int301:	;;print char, char in al, modifier in bl, will run videobuf2copy if called as is
   915 00000A6B E807000000          <1> 	call int301prnt
   916 00000A70 E91C050000          <1> 	jmp termcopy
   917 00000A75 00                  <1> termguion db 0
   918 00000A76 00                  <1> termcopyon db 0
   919                              <1> int301prnt:
   920 00000A77 88DC                <1> 	mov ah, bl
   921 00000A79 66A3[690A0000]      <1> 	mov [charbuf], ax
   922 00000A7F BB00000000          <1> 	mov ebx, 0
   923 00000A84 668B1D[630A0000]    <1> 	mov bx, [videobufpos]
   924 00000A8B BF[8F1C0000]        <1> 	mov edi, videobuf2
   925 00000A90 01DF                <1> 	add edi, ebx
   926 00000A92 66A1[8F0F0000]      <1> 	mov ax, [removedvideo]
   927 00000A98 668907              <1> 	mov [edi], ax
   928 00000A9B 66A1[690A0000]      <1> 	mov ax, [charbuf]
   929 00000AA1 BA00000000          <1> 	mov edx, 0
   930 00000AA6 668B15[650A0000]    <1> 	mov dx, [charpos]
   931 00000AAD B900000000          <1> 	mov ecx, 0
   932 00000AB2 668B0D[670A0000]    <1> 	mov cx, [charxy]
   933 00000AB9 3C0D                <1> 	cmp al, 13
   934 00000ABB 0F8454000000        <1> 	je near int301cr
   935 00000AC1 3C0A                <1> 	cmp al, 10
   936 00000AC3 0F8482000000        <1> 	je near int301nl
   937 00000AC9 3C08                <1> 	cmp al, 8
   938 00000ACB 0F845B000000        <1> 	je near int301bs
   939 00000AD1 668907              <1> 	mov [edi], ax
   940 00000AD4 81C702000000        <1> 	add edi, 2
   941 00000ADA 80C202              <1> 	add dl, 2
   942                              <1> donecrnl:
   943 00000ADD 38CA                <1> 	cmp dl, cl
   944 00000ADF 0F8397000000        <1> 	jae near int301eol
   945                              <1> doneeol:
   946 00000AE5 38EE                <1> 	cmp dh, ch
   947 00000AE7 0F83AD000000        <1> 	jae near int301scr	
   948                              <1> donescr:
   949 00000AED 89FB                <1> 	mov ebx, edi
   950 00000AEF 668B07              <1> 	mov ax, [edi]
   951 00000AF2 66A3[8F0F0000]      <1> 	mov [removedvideo], ax
   952 00000AF8 81EB[8F1C0000]      <1> 	sub ebx, videobuf2
   953 00000AFE 66891D[630A0000]    <1> 	mov [videobufpos], bx
   954 00000B05 668915[650A0000]    <1> 	mov [charpos], dx
   955 00000B0C 66A1[690A0000]      <1> 	mov ax, [charbuf]
   956 00000B12 88E3                <1> 	mov bl, ah
   957 00000B14 C3                  <1> 	ret
   958                              <1> 	
   959                              <1> 	int301cr:
   960 00000B15 B200                <1> 		mov dl, 0
   961 00000B17 BB00000000          <1> 		mov ebx, 0
   962 00000B1C BF[8F1C0000]        <1> 		mov edi, videobuf2
   963 00000B21 668B1D[610A0000]    <1> 		mov bx, [linebeginpos]
   964 00000B28 01DF                <1> 		add edi, ebx
   965 00000B2A EBB1                <1> 		jmp donecrnl
   966                              <1> 			
   967                              <1> 	int301bs:
   968 00000B2C 80FA00              <1> 		cmp dl, 0
   969 00000B2F 740F                <1> 		je int301backline
   970                              <1> 	int301nobmr:
   971 00000B31 80EA02              <1> 		sub dl, 2
   972 00000B34 66B80000            <1> 		mov ax, 0
   973 00000B38 81EF02000000        <1> 		sub edi, 2
   974 00000B3E EB9D                <1> 		jmp donecrnl
   975                              <1> 	int301backline:
   976 00000B40 88CA                <1> 		mov dl, cl
   977 00000B42 80FE00              <1> 		cmp dh, 0
   978 00000B45 74EA                <1> 		je int301nobmr
   979 00000B47 FECE                <1> 		dec dh
   980 00000B49 EBE6                <1> 		jmp int301nobmr
   981                              <1> 		
   982                              <1> 	int301nl:
   983 00000B4B FEC6                <1> 		inc dh
   984 00000B4D BB00000000          <1> 		mov ebx, 0
   985 00000B52 88CB                <1> 		mov bl, cl
   986 00000B54 BF[8F1C0000]        <1> 		mov edi, videobuf2
   987 00000B59 66031D[630A0000]    <1> 		add bx, [videobufpos]
   988 00000B60 01DF                <1> 		add edi, ebx
   989 00000B62 BB00000000          <1> 		mov ebx, 0
   990 00000B67 88CB                <1> 		mov bl, cl
   991 00000B69 66031D[610A0000]    <1> 		add bx, [linebeginpos]
   992 00000B70 66891D[610A0000]    <1> 		mov [linebeginpos], bx
   993 00000B77 E961FFFFFF          <1> 		jmp donecrnl
   994                              <1> 		
   995                              <1> 	int301eol:
   996 00000B7C B200                <1> 		mov dl, 0
   997 00000B7E FEC6                <1> 		inc dh
   998 00000B80 BB00000000          <1> 		mov ebx, 0
   999 00000B85 88CB                <1> 		mov bl, cl
  1000 00000B87 66031D[610A0000]    <1> 		add bx, [linebeginpos]
  1001 00000B8E 66891D[610A0000]    <1> 		mov [linebeginpos], bx
  1002 00000B95 E94BFFFFFF          <1> 		jmp doneeol
  1003                              <1> 	int301scr:
  1004 00000B9A FECE                <1> 		dec dh
  1005 00000B9C BF[8F1C0000]        <1> 		mov edi, videobuf2
  1006 00000BA1 BB00000000          <1> 		mov ebx, 0
  1007 00000BA6 88CB                <1> 		mov bl, cl
  1008 00000BA8 01FB                <1> 		add ebx, edi
  1009                              <1> 	intscrollloop:
  1010 00000BAA 668B03              <1> 		mov ax, [ebx]
  1011 00000BAD 668907              <1> 		mov [edi], ax
  1012 00000BB0 81C702000000        <1> 		add edi, 2
  1013 00000BB6 81C302000000        <1> 		add ebx, 2
  1014 00000BBC 80E902              <1> 		sub cl, 2
  1015 00000BBF 80F900              <1> 		cmp cl, 0
  1016 00000BC2 75E6                <1> 		jne intscrollloop
  1017 00000BC4 8A0D[670A0000]      <1> 		mov cl, [charxy]
  1018 00000BCA FECD                <1> 		dec ch
  1019 00000BCC 80FD01              <1> 		cmp ch, 1
  1020 00000BCF 77D9                <1> 		ja intscrollloop
  1021 00000BD1 66B80000            <1> 		mov ax, 0
  1022 00000BD5 81EF[8F1C0000]      <1> 		sub edi, videobuf2
  1023 00000BDB 66893D[610A0000]    <1> 		mov [linebeginpos], di
  1024 00000BE2 81C7[8F1C0000]      <1> 		add edi, videobuf2
  1025 00000BE8 89FB                <1> 		mov ebx, edi
  1026                              <1> 	intloopclear:
  1027 00000BEA 668903              <1> 		mov [ebx], ax
  1028 00000BED 81C302000000        <1> 		add ebx, 2
  1029 00000BF3 80E902              <1> 		sub cl, 2
  1030 00000BF6 80F900              <1> 		cmp cl, 0
  1031 00000BF9 75EF                <1> 		jne intloopclear
  1032 00000BFB FECD                <1> 		dec ch
  1033 00000BFD 80FD00              <1> 		cmp ch, 0
  1034 00000C00 75E8                <1> 		jne intloopclear
  1035 00000C02 668B0D[670A0000]    <1> 		mov cx, [charxy]
  1036 00000C09 E9DFFEFFFF          <1> 		jmp donescr
  1037                              <1> 		
  1038                              <1> 		
  1039 00000C0E 0000                <1> lastkey db 0,0
  1040 00000C10 00                  <1> trans db 0
  1041                              <1> 
  1042                              <1> 	int302:		;;get char, if al is 0, wait for key
  1043 00000C11 A2[100C0000]        <1> 		mov [trans], al
  1044                              <1> 	transcheck:
  1045 00000C16 E8781C0000          <1> 		call guistartin
  1046 00000C1B 8A3D[100C0000]      <1> 		mov bh, [trans]
  1047 00000C21 66A1[0E0C0000]      <1> 		mov ax, [lastkey]
  1048 00000C27 80FC1C              <1> 		cmp ah, 1Ch
  1049 00000C2A 7414                <1> 		je int302enter
  1050 00000C2C 3CE0                <1> 		cmp al, 0xE0
  1051 00000C2E 7504                <1> 		jne nospecialtrans
  1052 00000C30 88C3                <1> 		mov bl, al
  1053 00000C32 B000                <1> 		mov al, 0
  1054                              <1> 	nospecialtrans:
  1055 00000C34 08C7                <1> 		or bh, al
  1056 00000C36 80FF00              <1> 		cmp bh, 0
  1057 00000C39 74DB                <1> 		je transcheck
  1058 00000C3B E902000000          <1> 		jmp int302end
  1059                              <1> 	int302enter:
  1060 00000C40 B00D                <1> 		mov al, 13
  1061                              <1> 	int302end:
  1062 00000C42 C3                  <1> 		ret
  1063                              <1> 	
  1064 00000C43 00                  <1> endkey303 db 0
  1065                              <1> 	printquiet:
  1066 00000C44 66B80000            <1> 		mov ax, 0
  1067 00000C48 66BB0700            <1> 		mov bx, 7
  1068 00000C4C E818000000          <1> 		call int303b
  1069 00000C51 C3                  <1> 		ret
  1070                              <1>     print:
  1071 00000C52 66B80000            <1> 		mov ax, 0
  1072 00000C56 66BB0700            <1> 		mov bx, 7
  1073                              <1> 	int303:	;;print line, al=last key,bl=modifier, esi=buffer
  1074 00000C5A A2[430C0000]        <1> 		mov [endkey303], al
  1075 00000C5F E805000000          <1> 		call int303b
  1076 00000C64 E928030000          <1> 		jmp termcopy
  1077                              <1> 	int303b:
  1078 00000C69 8A06                <1> 		mov al, [esi]
  1079 00000C6B 3A05[430C0000]      <1> 		cmp al, [endkey303]
  1080 00000C71 7408                <1> 		je doneint303
  1081 00000C73 E8FFFDFFFF          <1> 		call int301prnt
  1082 00000C78 46                  <1> 		inc esi
  1083 00000C79 EBEE                <1> 		jmp int303b
  1084                              <1> 	doneint303:
  1085 00000C7B C3                  <1> 		ret
  1086                              <1> 		
  1087 00000C7C 00                  <1> endkey304 db 0
  1088                              <1> 	int304:	;;get line, al=last key, esi = buffer
  1089 00000C7D A2[7C0C0000]        <1> 		mov [endkey304], al
  1090                              <1> 	int304b:
  1091 00000C82 56                  <1> 		push esi
  1092 00000C83 B000                <1> 		mov al, 0
  1093 00000C85 E887FFFFFF          <1> 		call int302
  1094 00000C8A 5E                  <1> 		pop esi
  1095 00000C8B 8806                <1> 		mov [esi], al
  1096 00000C8D 46                  <1> 		inc esi
  1097 00000C8E 3A05[7C0C0000]      <1> 		cmp al, [endkey304]
  1098 00000C94 75EC                <1> 		jne int304b
  1099 00000C96 4E                  <1> 		dec esi
  1100 00000C97 C60600              <1> 		mov byte [esi], 0
  1101 00000C9A C3                  <1> 	ret
  1102                              <1> 	
  1103 00000C9B 00                  <1> endkey305 db 0
  1104 00000C9C 00                  <1> modkey305 db 0
  1105 00000C9D 00000000            <1> firstesi305 dd 0
  1106 00000CA1 00                  <1> commandedit db 0
  1107 00000CA2 00                  <1> txtmask db 0
  1108 00000CA3 00000000            <1> buftxtloc dd 0
  1109 00000CA7 082000              <1> backcursor db 8," ",0
  1110                              <1> 	int305:	;;print and get line, al=last key, bl=modifier, esi=buffer
  1111 00000CAA 8935[A30C0000]      <1> 		mov [buftxtloc], esi
  1112 00000CB0 A2[9B0C0000]        <1> 		mov [endkey305], al
  1113 00000CB5 881D[9C0C0000]      <1> 		mov [modkey305], bl
  1114 00000CBB 8935[9D0C0000]      <1> 		mov [firstesi305], esi
  1115                              <1> 	int305b:
  1116 00000CC1 56                  <1> 		push esi
  1117 00000CC2 B001                <1> 		mov al, 1
  1118 00000CC4 E848FFFFFF          <1> 		call int302
  1119 00000CC9 5E                  <1> 		pop esi
  1120 00000CCA 80FC48              <1> 		cmp ah, 0x48
  1121 00000CCD 0F845E010000        <1> 		je near int305up
  1122 00000CD3 80FC50              <1> 		cmp ah, 0x50
  1123 00000CD6 0F8438010000        <1> 		je near int305down
  1124 00000CDC 80FC4D              <1> 		cmp ah, 0x4D
  1125 00000CDF 0F84ED000000        <1> 		je near int305right
  1126 00000CE5 80FC4B              <1> 		cmp ah, 0x4B
  1127 00000CE8 0F84AB000000        <1> 		je near int305left
  1128 00000CEE 3C08                <1> 		cmp al, 8
  1129 00000CF0 0F842E020000        <1> 		je near int305bscheck
  1130 00000CF6 3C00                <1> 		cmp al, 0
  1131 00000CF8 74C7                <1> 		je int305b
  1132 00000CFA 8806                <1> 		mov [esi], al
  1133 00000CFC 46                  <1> 		inc esi
  1134                              <1> 	bscheckequal:
  1135 00000CFD 8A1D[9C0C0000]      <1> 		mov bl, [modkey305]
  1136 00000D03 8A3D[A20C0000]      <1> 		mov bh, [txtmask]
  1137 00000D09 80FF00              <1> 		cmp bh, 0
  1138 00000D0C 7402                <1> 		je nomasktxt
  1139 00000D0E 88F8                <1> 		mov al, bh
  1140                              <1> 	nomasktxt:
  1141 00000D10 E856FDFFFF          <1> 		call int301
  1142 00000D15 56                  <1> 		push esi
  1143 00000D16 66A3[970D0000]      <1> 		mov [int305axcache], ax
  1144 00000D1C 8A25[9B0C0000]      <1> 		mov ah, [endkey305]
  1145 00000D22 38E0                <1> 		cmp al, ah
  1146 00000D24 7429                <1> 		je nobackprintbuftxt2
  1147 00000D26 BE[701A0000]        <1> 		mov esi, buftxt2
  1148 00000D2B E814FFFFFF          <1> 		call printquiet
  1149 00000D30 B020                <1> 		mov al, " "
  1150 00000D32 E840FDFFFF          <1> 		call int301prnt
  1151 00000D37 B008                <1> 		mov al, 8
  1152 00000D39 81FE[701A0000]      <1> 		cmp esi, buftxt2
  1153 00000D3F 740E                <1> 		je nobackprintbuftxt2
  1154                              <1> 	backprintbuftxt2:
  1155 00000D41 E831FDFFFF          <1> 		call int301prnt
  1156 00000D46 4E                  <1> 		dec esi
  1157 00000D47 81FE[701A0000]      <1> 		cmp esi, buftxt2
  1158 00000D4D 77F2                <1> 		ja backprintbuftxt2
  1159                              <1> 	nobackprintbuftxt2:
  1160 00000D4F E817FDFFFF          <1> 		call int301
  1161 00000D54 5E                  <1> 		pop esi
  1162 00000D55 66A1[970D0000]      <1> 		mov ax, [int305axcache]
  1163 00000D5B 8A25[9B0C0000]      <1> 		mov ah, [endkey305]
  1164 00000D61 38E0                <1> 		cmp al, ah
  1165 00000D63 0F8558FFFFFF        <1> 		jne int305b
  1166 00000D69 4E                  <1> 		dec esi
  1167 00000D6A BF[701A0000]        <1> 		mov edi, buftxt2
  1168                              <1> 	copylaterstuff:
  1169 00000D6F 8A07                <1> 		mov al, [edi]
  1170 00000D71 3C00                <1> 		cmp al, 0
  1171 00000D73 7406                <1> 		je nocopylaterstuff
  1172 00000D75 8806                <1> 		mov [esi], al
  1173 00000D77 47                  <1> 		inc edi
  1174 00000D78 46                  <1> 		inc esi
  1175 00000D79 EBF4                <1> 		jmp copylaterstuff
  1176                              <1> 	nocopylaterstuff:
  1177 00000D7B C60600              <1> 		mov byte [esi], 0
  1178 00000D7E E801000000          <1> 		call clearbuftxt2
  1179 00000D83 C3                  <1> 		ret
  1180                              <1> 	
  1181                              <1> 	clearbuftxt2:
  1182 00000D84 B000                <1> 		mov al, 0
  1183 00000D86 BF[701A0000]        <1> 		mov edi, buftxt2
  1184                              <1> 	clearbuftxt2lp:
  1185 00000D8B 8807                <1> 		mov [edi], al
  1186 00000D8D 47                  <1> 		inc edi
  1187 00000D8E 81FF[7A1B0000]      <1> 		cmp edi, buftxt
  1188 00000D94 75F5                <1> 		jne clearbuftxt2lp
  1189 00000D96 C3                  <1> 		ret
  1190                              <1> 		
  1191 00000D97 0000                <1> 	int305axcache dw 0
  1192                              <1> 		
  1193                              <1> 	int305left:
  1194 00000D99 3B35[A30C0000]      <1> 		cmp esi, [buftxtloc]
  1195 00000D9F 0F841CFFFFFF        <1> 		je near int305b
  1196 00000DA5 BF[701A0000]        <1> 		mov edi, buftxt2
  1197 00000DAA 8A07                <1> 		mov al, [edi]
  1198                              <1> 	shiftbuftxt2:
  1199 00000DAC 3C00                <1> 		cmp al, 0
  1200 00000DAE 7409                <1> 		je noshiftbuftxt2
  1201 00000DB0 47                  <1> 		inc edi
  1202 00000DB1 8A27                <1> 		mov ah, [edi]
  1203 00000DB3 8807                <1> 		mov [edi], al
  1204 00000DB5 88E0                <1> 		mov al, ah
  1205 00000DB7 EBF3                <1> 		jmp shiftbuftxt2
  1206                              <1> 	noshiftbuftxt2:
  1207 00000DB9 BF[701A0000]        <1> 		mov edi, buftxt2
  1208 00000DBE 4E                  <1> 		dec esi
  1209 00000DBF 8A06                <1> 		mov al, [esi]
  1210 00000DC1 8807                <1> 		mov [edi], al
  1211 00000DC3 C60600              <1> 		mov byte [esi], 0
  1212 00000DC6 B008                <1> 		mov al, 8
  1213 00000DC8 E89EFCFFFF          <1> 		call int301
  1214 00000DCD E9EFFEFFFF          <1> 		jmp int305b
  1215                              <1> 		
  1216                              <1> 	int305right:
  1217 00000DD2 BF[701A0000]        <1> 		mov edi, buftxt2
  1218 00000DD7 8A07                <1> 		mov al, [edi]
  1219 00000DD9 3C00                <1> 		cmp al, 0
  1220 00000DDB 0F84E0FEFFFF        <1> 		je near int305b
  1221 00000DE1 8806                <1> 		mov [esi], al
  1222                              <1> 	shiftbuftxt2lft:
  1223 00000DE3 3C00                <1> 		cmp al, 0
  1224 00000DE5 7408                <1> 		je noshiftbuftxt2lft
  1225 00000DE7 47                  <1> 		inc edi
  1226 00000DE8 8A07                <1> 		mov al, [edi]
  1227 00000DEA 8847FF              <1> 		mov [edi - 1], al
  1228 00000DED EBF4                <1> 		jmp shiftbuftxt2lft
  1229                              <1> 	noshiftbuftxt2lft:
  1230 00000DEF 8A06                <1> 		mov al, [esi]
  1231 00000DF1 46                  <1> 		inc esi
  1232 00000DF2 8A1D[9C0C0000]      <1> 		mov bl, [modkey305]
  1233 00000DF8 E86EFCFFFF          <1> 		call int301
  1234 00000DFD E9BFFEFFFF          <1> 		jmp int305b
  1235                              <1> 		
  1236                              <1> 	int305downbck:
  1237 00000E02 FECC                <1> 		dec ah
  1238 00000E04 8825[A10C0000]      <1> 		mov [commandedit], ah
  1239 00000E0A E83A000000          <1> 		call int305bckspc
  1240 00000E0F E9ADFEFFFF          <1> 		jmp int305b
  1241                              <1> 	
  1242                              <1> 	int305down:
  1243 00000E14 8A25[A10C0000]      <1> 		mov ah, [commandedit]
  1244 00000E1A 80FC01              <1> 		cmp ah, 1
  1245 00000E1D 0F869EFEFFFF        <1> 		jbe near int305b
  1246 00000E23 80FC02              <1> 		cmp ah, 2
  1247 00000E26 74DA                <1> 		je int305downbck
  1248 00000E28 80EC02              <1> 		sub ah, 2
  1249 00000E2B 8825[A10C0000]      <1> 		mov [commandedit], ah
  1250                              <1> 		
  1251                              <1> 	int305up:
  1252                              <1> 		;cmp bl, 0xE0
  1253                              <1> 		;jne int305b
  1254 00000E31 B000                <1> 		mov al, 0
  1255 00000E33 3805[A10C0000]      <1> 		cmp [commandedit], al
  1256 00000E39 0F8482FEFFFF        <1> 		je near int305b
  1257 00000E3F E805000000          <1> 		call int305bckspc
  1258 00000E44 E93C000000          <1> 		jmp getcurrentcommandstr
  1259                              <1> 	int305bckspc:
  1260 00000E49 3B35[A30C0000]      <1> 		cmp esi, [buftxtloc]
  1261 00000E4F 7426                <1> 		je noint305upbck
  1262                              <1> 	int305upbckspclp:
  1263 00000E51 B008                <1> 		mov al, 8
  1264 00000E53 8A1D[9C0C0000]      <1> 		mov bl, [modkey305]
  1265 00000E59 E819FCFFFF          <1> 		call int301prnt
  1266 00000E5E B020                <1> 		mov al, " "
  1267 00000E60 E812FCFFFF          <1> 		call int301prnt
  1268 00000E65 B008                <1> 		mov al, 8
  1269 00000E67 E8FFFBFFFF          <1> 		call int301
  1270 00000E6C 4E                  <1> 		dec esi
  1271 00000E6D 3B35[A30C0000]      <1> 		cmp esi, [buftxtloc]
  1272 00000E73 7402                <1> 		je noint305upbck
  1273 00000E75 EBDA                <1> 		jmp int305upbckspclp
  1274                              <1> 	noint305upbck:
  1275 00000E77 8B3D[1B300000]      <1> 		mov edi, [currentcommandpos]
  1276 00000E7D 81C7[1F300000]      <1> 		add edi, commandbuf
  1277 00000E83 4F                  <1> 		dec edi
  1278 00000E84 C3                  <1> 		ret
  1279                              <1> 	getcurrentcommandstr:
  1280 00000E85 8A25[A10C0000]      <1> 		mov ah, [commandedit]
  1281 00000E8B FE05[A10C0000]      <1> 		inc byte [commandedit]
  1282                              <1> 	getccmdlp:
  1283 00000E91 4F                  <1> 		dec edi
  1284 00000E92 8A07                <1> 		mov al, [edi]
  1285 00000E94 81FF[1F300000]      <1> 		cmp edi, commandbuf
  1286 00000E9A 7231                <1> 		jb getcmdresetcommandbuf
  1287 00000E9C 81EF[1F300000]      <1> 		sub edi, commandbuf
  1288 00000EA2 3B3D[1B300000]      <1> 		cmp edi, [currentcommandpos]
  1289 00000EA8 0F8413FEFFFF        <1> 		je near int305b
  1290 00000EAE 81C7[1F300000]      <1> 		add edi, commandbuf
  1291 00000EB4 3C00                <1> 		cmp al, 0
  1292 00000EB6 75D9                <1> 		jne getccmdlp
  1293 00000EB8 FECC                <1> 		dec ah
  1294 00000EBA 80FC00              <1> 		cmp ah, 0
  1295 00000EBD 77D2                <1> 		ja getccmdlp
  1296 00000EBF 47                  <1> 		inc edi
  1297 00000EC0 81FF[1F340000]      <1> 		cmp edi, commandbufend
  1298 00000EC6 770D                <1> 		ja fixcmdbufb4moreint305
  1299 00000EC8 E915000000          <1> 		jmp moreint305up
  1300                              <1> 	getcmdresetcommandbuf:
  1301 00000ECD BF[1F340000]        <1> 		mov edi, commandbufend
  1302 00000ED2 47                  <1> 		inc edi
  1303 00000ED3 EBBC                <1> 		jmp getccmdlp
  1304                              <1> 	fixcmdbufb4moreint305:
  1305 00000ED5 4F                  <1> 		dec edi
  1306 00000ED6 81EF[1F340000]      <1> 		sub edi, commandbufend
  1307 00000EDC 81C7[1F300000]      <1> 		add edi, commandbuf
  1308                              <1> 	moreint305up:
  1309 00000EE2 8A07                <1> 		mov al, [edi]
  1310 00000EE4 47                  <1> 		inc edi
  1311 00000EE5 81EF[1F300000]      <1> 		sub edi, commandbuf
  1312 00000EEB 3C00                <1> 		cmp al, 0
  1313 00000EED 0F84CEFDFFFF        <1> 		je near int305b
  1314 00000EF3 3B3D[1B300000]      <1> 		cmp edi, [currentcommandpos]
  1315 00000EF9 0F83C2FDFFFF        <1> 		jae near int305b
  1316 00000EFF 81C7[1F300000]      <1> 		add edi, commandbuf
  1317 00000F05 8806                <1> 		mov [esi], al
  1318 00000F07 46                  <1> 		inc esi
  1319 00000F08 57                  <1> 		push edi
  1320 00000F09 8A1D[9C0C0000]      <1> 		mov bl, [modkey305]
  1321 00000F0F E857FBFFFF          <1> 		call int301
  1322 00000F14 5F                  <1> 		pop edi
  1323 00000F15 81FF[1F340000]      <1> 		cmp edi, commandbufend
  1324 00000F1B 76C5                <1> 		jbe moreint305up
  1325 00000F1D BF[1F300000]        <1> 		mov edi, commandbuf
  1326 00000F22 EBBE                <1> 		jmp moreint305up
  1327                              <1> 	int305bscheck:
  1328 00000F24 3B35[9D0C0000]      <1> 		cmp esi, [firstesi305]
  1329 00000F2A 7705                <1> 		ja goodbscheck
  1330 00000F2C E990FDFFFF          <1> 		jmp int305b
  1331                              <1> 	goodbscheck:
  1332 00000F31 4E                  <1> 		dec esi
  1333 00000F32 C60600              <1> 		mov byte [esi], 0
  1334 00000F35 8A1D[9C0C0000]      <1> 		mov bl, [modkey305]
  1335 00000F3B B008                <1> 		mov al, 8
  1336 00000F3D E9BBFDFFFF          <1> 		jmp bscheckequal
  1337                              <1> 	
  1338                              <1> 		
  1339                              <1> 	clear:		
  1340                              <1> 	
  1341                              <1> 	int306:	;;clear screen
  1342 00000F42 668B0D[670A0000]    <1> 		mov cx, [charxy]
  1343 00000F49 BF[8F1C0000]        <1> 		mov edi, videobuf2
  1344 00000F4E 66B80000            <1> 		mov ax, 0
  1345 00000F52 66A3[610A0000]      <1> 		mov [linebeginpos], ax
  1346 00000F58 66A3[630A0000]      <1> 		mov [videobufpos], ax
  1347 00000F5E 66BA0000            <1> 		mov dx, 0
  1348 00000F62 66A3[650A0000]      <1> 		mov [charpos], ax
  1349                              <1> 	int306b:
  1350 00000F68 668907              <1> 		mov [edi], ax
  1351 00000F6B 81C702000000        <1> 		add edi, 2
  1352 00000F71 80E902              <1> 		sub cl, 2
  1353 00000F74 80F900              <1> 		cmp cl, 0
  1354 00000F77 75EF                <1> 		jne int306b
  1355 00000F79 8A0D[670A0000]      <1> 		mov cl, [charxy]
  1356 00000F7F FECD                <1> 		dec ch
  1357 00000F81 80FD00              <1> 		cmp ch, 0
  1358 00000F84 75E2                <1> 		jne int306b
  1359 00000F86 E906000000          <1> 		jmp termcopy
  1360                              <1> 		
  1361 00000F8B 00000000            <1> 	termcursorpos dd 0
  1362 00000F8F 0000                <1> 	removedvideo dw 0
  1363                              <1> termcopy:	
  1364 00000F91 60                  <1> 	pusha
  1365 00000F92 BF[8F1C0000]        <1> 	mov edi, videobuf2
  1366 00000F97 BB00000000          <1> 	mov ebx, 0
  1367 00000F9C 668B1D[630A0000]    <1> 	mov bx, [videobufpos]
  1368 00000FA3 01DF                <1> 	add edi, ebx
  1369 00000FA5 893D[8B0F0000]      <1> 	mov [termcursorpos], edi
  1370 00000FAB E8C0000000          <1> 	call switchtermcursor
  1371 00000FB0 C605[772E0000]00    <1> 	mov byte [mouseselecton], 0
  1372 00000FB7 C605[760A0000]01    <1> 	mov byte [termcopyon], 1
  1373 00000FBE 803D[782E0000]00    <1> 	cmp byte [guion], 0
  1374 00000FC5 0F8412000000        <1> 	je near nowincopy
  1375 00000FCB 803D[750A0000]01    <1> 	cmp byte [termguion], 1
  1376 00000FD2 0F847F2A0000        <1> 	je near windowvideocopy
  1377 00000FD8 E98C000000          <1> 	jmp nocopytermatall
  1378                              <1> nowincopy:
  1379 00000FDD BE00000A00          <1> 	mov esi, 0xA0000
  1380 00000FE2 A1[D0030000]        <1> 	mov eax, [basecache]
  1381 00000FE7 C1E004              <1> 	shl eax, 4
  1382 00000FEA 29C6                <1> 	sub esi, eax
  1383 00000FEC BF[8F1C0000]        <1> 	mov edi, videobuf2
  1384 00000FF1 B900000000          <1> 	mov ecx, 0
  1385 00000FF6 668B0D[670A0000]    <1> 	mov cx, [charxy]
  1386                              <1> nowincopy2:
  1387 00000FFD BB[B46C0000]        <1> 	mov ebx, fonts
  1388 00001002 B800000000          <1> 	mov eax, 0
  1389 00001007 8A07                <1> 	mov al, [edi]
  1390 00001009 C1E004              <1> 	shl eax, 4
  1391 0000100C 01C3                <1> 	add ebx, eax
  1392 0000100E 47                  <1> 	inc edi
  1393 0000100F 8A27                <1> 	mov ah, [edi]
  1394 00001011 BA00000000          <1> 	mov edx, 0
  1395 00001016 8A15[670A0000]      <1> 	mov dl, [charxy]
  1396 0000101C D1EA                <1> 	shr edx, 1
  1397 0000101E C1C110              <1> 	rol ecx, 16
  1398 00001021 B110                <1> 	mov cl, 16
  1399                              <1> nowinfont:
  1400 00001023 8A03                <1> 	mov al, [ebx]
  1401 00001025 D0C8                <1> 	ror al, 1
  1402 00001027 80FC07              <1> 	cmp ah, 7
  1403 0000102A 7602                <1> 	jbe notnotfont
  1404 0000102C F6D0                <1> 	not al
  1405                              <1> notnotfont:
  1406 0000102E 8806                <1> 	mov [esi], al
  1407 00001030 01D6                <1> 	add esi, edx
  1408 00001032 43                  <1> 	inc ebx
  1409 00001033 FEC9                <1> 	dec cl
  1410 00001035 80F900              <1> 	cmp cl, 0
  1411 00001038 75E9                <1> 	jne nowinfont
  1412 0000103A C1E204              <1> 	shl edx, 4
  1413 0000103D 29D6                <1> 	sub esi, edx
  1414 0000103F C1C110              <1> 	rol ecx, 16
  1415                              <1> nopresentwinfont:
  1416 00001042 47                  <1> 	inc edi
  1417 00001043 46                  <1> 	inc esi
  1418 00001044 80E902              <1> 	sub cl, 2
  1419 00001047 80F900              <1> 	cmp cl, 0
  1420 0000104A 75B1                <1> 	jne nowincopy2
  1421 0000104C 8A0D[670A0000]      <1> 	mov cl, [charxy]
  1422 00001052 BA00000000          <1> 	mov edx, 0
  1423 00001057 88CA                <1> 	mov dl, cl
  1424 00001059 D1EA                <1> 	shr edx, 1
  1425 0000105B 29D6                <1> 	sub esi, edx
  1426 0000105D C1E204              <1> 	shl edx, 4
  1427 00001060 01D6                <1> 	add esi, edx
  1428 00001062 FECD                <1> 	dec ch
  1429 00001064 80FD00              <1> 	cmp ch, 0
  1430 00001067 7594                <1> 	jne nowincopy2
  1431                              <1> nocopytermatall:
  1432 00001069 E802000000          <1> 	call switchtermcursor
  1433 0000106E 61                  <1> 	popa
  1434 0000106F C3                  <1> 	ret
  1435                              <1> 	
  1436                              <1> switchtermcursor:
  1437 00001070 8B3D[8B0F0000]      <1> 	mov edi, [termcursorpos]
  1438 00001076 8A4701              <1> 	mov al, [edi + 1]
  1439 00001079 8A27                <1> 	mov ah, [edi]
  1440 0000107B 3C07                <1> 	cmp al, 7
  1441 0000107D 7607                <1> 	jbe movlargecursorterm
  1442 0000107F B007                <1> 	mov al, 7
  1443 00001081 E902000000          <1> 	jmp movedcursorterm
  1444                              <1> movlargecursorterm:
  1445 00001086 B0F0                <1> 	mov al, 0xF0
  1446                              <1> movedcursorterm:
  1447 00001088 884701              <1> 	mov [edi + 1], al
  1448 0000108B 80FC00              <1> 	cmp ah, 0
  1449 0000108E 7504                <1> 	jne fixednocursorterm
  1450 00001090 B420                <1> 	mov ah, " "
  1451 00001092 8827                <1> 	mov [edi], ah
  1452                              <1> fixednocursorterm:
  1453 00001094 C3                  <1> 	ret
  1454                              <1> 	
  1455                                      %include 'source/solleros.asm'
  1456                              <1> 	;SOLLEROS.ASM
  1457                              <1> os:
  1458 00001095 E8A8FEFFFF          <1> 	call clear
  1459 0000109A BE[6E6C0000]        <1> 	mov esi, userask
  1460 0000109F E8AEFBFFFF          <1> 	call print
  1461                              <1> usercheck:
  1462 000010A4 BE[7A1B0000]        <1> 	mov esi, buftxt
  1463 000010A9 B00D                <1> 	mov al, 13
  1464 000010AB B404                <1> 	mov ah, 4
  1465 000010AD CD30                <1> 	int 30h
  1466 000010AF 56                  <1> 	push esi
  1467 000010B0 BE[8E6C0000]        <1> 	mov esi, line
  1468 000010B5 E898FBFFFF          <1> 	call print
  1469 000010BA BE[786C0000]        <1> 	mov esi, pwdask
  1470 000010BF E88EFBFFFF          <1> 	call print
  1471 000010C4 5E                  <1> 	pop esi
  1472 000010C5 46                  <1> 	inc esi
  1473 000010C6 8935[7C110000]      <1> 	mov [esipass], esi
  1474                              <1> passcheck:
  1475 000010CC B000                <1> 	mov al, 0
  1476 000010CE B405                <1> 	mov ah, 5
  1477 000010D0 CD30                <1> 	int 30h
  1478 000010D2 3C0D                <1> 	cmp al, 13
  1479 000010D4 0F8435000000        <1> 	je near gotpass
  1480 000010DA 3C08                <1> 	cmp al, 8
  1481 000010DC 0F840F000000        <1> 	je near backpass
  1482 000010E2 8806                <1> 	mov [esi], al
  1483 000010E4 46                  <1> 	inc esi
  1484 000010E5 B02A                <1> 	mov al, '*'
  1485 000010E7 B406                <1> 	mov ah, 6
  1486 000010E9 CD30                <1> 	int 30h
  1487 000010EB EBDF                <1> 	jmp passcheck
  1488 000010ED 08200800            <1> backcursor2 db 8," ",8,0
  1489                              <1> backpass:
  1490 000010F1 3B35[7C110000]      <1> 	cmp esi, [esipass]
  1491 000010F7 0F84CFFFFFFF        <1> 	je near passcheck
  1492 000010FD 4E                  <1> 	dec esi
  1493 000010FE C60600              <1> 	mov byte [esi], 0
  1494 00001101 56                  <1> 	push esi
  1495 00001102 BE[ED100000]        <1> 	mov esi, backcursor2
  1496 00001107 E846FBFFFF          <1> 	call print
  1497 0000110C 5E                  <1> 	pop esi
  1498 0000110D EBBD                <1> 	jmp passcheck
  1499                              <1> gotpass:
  1500 0000110F B000                <1> 	mov al,0
  1501 00001111 8806                <1> 	mov [esi], al
  1502 00001113 BE[8E6C0000]        <1> 	mov esi, line
  1503 00001118 E835FBFFFF          <1> 	call print
  1504 0000111D BB[916C0000]        <1> 	mov ebx, userlst
  1505                              <1> userfind:
  1506 00001122 BE[7A1B0000]        <1> 	mov esi, buftxt
  1507 00001127 8A06                <1> 	mov al, [esi]
  1508 00001129 3C00                <1> 	cmp al, 0
  1509 0000112B 0F8464FFFFFF        <1> 	je near os
  1510 00001131 891D[80110000]      <1> 	mov [usercache], ebx
  1511 00001137 E8AF010000          <1> 	call tester
  1512 0000113C 3C01                <1> 	cmp al, 1
  1513 0000113E 7415                <1> 	je pwdtest
  1514                              <1> nxtuser:
  1515 00001140 43                  <1> 	inc ebx
  1516 00001141 8A03                <1> 	mov al, [ebx]
  1517 00001143 3C00                <1> 	cmp al, 0
  1518 00001145 74DB                <1> 	je userfind
  1519 00001147 81FB[B46C0000]      <1> 	cmp ebx, userlstend
  1520 0000114D 0F8342FFFFFF        <1> 	jae near os
  1521 00001153 EBCD                <1> 	jmp userfind
  1522                              <1> pwdtest:
  1523 00001155 46                  <1> 	inc esi
  1524 00001156 43                  <1> 	inc ebx
  1525 00001157 E88F010000          <1> 	call tester
  1526 0000115C 3C01                <1> 	cmp al, 1
  1527 0000115E 7402                <1> 	je pwdrgt
  1528 00001160 EBDE                <1> 	jmp nxtuser
  1529 00001162 E8DBFDFFFF          <1> pwdrgt:	call clear
  1530 00001167 66B90002            <1> 	mov cx, 200h
  1531 0000116B BE[7A1B0000]        <1> 	mov esi, buftxt
  1532 00001170 B000                <1> 	mov al, 0
  1533 00001172 8806                <1> bufclr:	mov [esi], al
  1534 00001174 46                  <1> 	inc esi
  1535 00001175 E2FB                <1> 	loop bufclr
  1536                              <1> ;;;;;;;;;;;;;;;;
  1537 00001177 E92B000000          <1> 	jmp nwcmd
  1538                              <1> 
  1539 0000117C 00000000            <1> esipass dd 0
  1540 00001180 [916C0000]          <1> usercache dd userlst
  1541                              <1> 	
  1542                              <1> buftxtclear:
  1543 00001184 B000                <1> 	mov al, 0
  1544 00001186 BE[7A1B0000]        <1> 	mov esi, buftxt
  1545 0000118B 81FE[7A1C0000]      <1> clearbuftxt: cmp esi, buf2
  1546 00001191 730E                <1> 	jae retbufclr
  1547 00001193 8806                <1> 	mov [esi], al
  1548 00001195 46                  <1> 	inc esi
  1549 00001196 EBF3                <1> 	jmp clearbuftxt
  1550                              <1> 
  1551 00001198 39DE                <1> clearitbuf: cmp esi, ebx
  1552 0000119A 7305                <1> 	jae retbufclr
  1553 0000119C 8806                <1> 	mov [esi], al
  1554 0000119E 46                  <1> 	inc esi
  1555 0000119F EBF7                <1> 	jmp clearitbuf
  1556 000011A1 C3                  <1> retbufclr: ret
  1557                              <1> 
  1558 000011A2 E900000000          <1> full:	jmp nwcmd
  1559                              <1> 
  1560                              <1> 
  1561 000011A7 B001                <1> nwcmd:	mov al, 1
  1562 000011A9 3805[69130000]      <1> 	cmp [BATCHISON], al
  1563 000011AF 0F839F000000        <1> 	jae near batchran
  1564 000011B5 B000                <1> cancel:	mov al, 0
  1565 000011B7 A2[00130000]        <1> 	mov [IFON], al
  1566 000011BC A2[69130000]        <1> 	mov [BATCHISON], al
  1567 000011C1 B05B                <1> 	mov al, '['
  1568 000011C3 B406                <1> 	mov ah, 6
  1569 000011C5 66BB0700            <1> 	mov bx, 7
  1570 000011C9 E8A9F8FFFF          <1> 	call int301prnt
  1571 000011CE 8B35[80110000]      <1> 	mov esi, [usercache]
  1572 000011D4 E879FAFFFF          <1> 	call print
  1573 000011D9 BE[826C0000]        <1> 	mov esi, location
  1574 000011DE E86FFAFFFF          <1> 	call print
  1575                              <1> 	;call time
  1576                              <1> 	;mov esi, timeshow
  1577                              <1> 	;call print
  1578                              <1> 	;mov esi, cmd
  1579                              <1> 	;call print
  1580 000011E3 E89CFFFFFF          <1> 	call buftxtclear
  1581 000011E8 BE[7A1B0000]        <1> 	mov esi, buftxt
  1582 000011ED C605[A10C0000]01    <1> 	mov byte [commandedit], 1
  1583 000011F4 B00D                <1> 	mov al, 13
  1584 000011F6 66BB0700            <1> 	mov bx, 7
  1585 000011FA E8ABFAFFFF          <1> 	call int305
  1586 000011FF C605[A10C0000]00    <1> 	mov byte [commandedit], 0
  1587 00001206 8B35[1B300000]      <1> gotcmd:	mov esi, [currentcommandpos]
  1588 0000120C 8935[17300000]      <1> 	mov [lastcommandpos], esi
  1589 00001212 BF[7A1B0000]        <1> 	mov edi, buftxt
  1590 00001217 81C6[1F300000]      <1> 	add esi, commandbuf
  1591 0000121D 81FE[1F340000]      <1> 	cmp esi, commandbufend
  1592 00001223 7605                <1> 	jbe copycommand
  1593 00001225 BE[1F300000]        <1> 	mov esi, commandbuf
  1594                              <1> copycommand:
  1595 0000122A 8A07                <1> 	mov al, [edi]
  1596 0000122C 8806                <1> 	mov [esi], al
  1597 0000122E 47                  <1> 	inc edi
  1598 0000122F 46                  <1> 	inc esi
  1599 00001230 3C00                <1> 	cmp al, 0
  1600 00001232 740F                <1> 	je donecopy
  1601 00001234 81FE[1F340000]      <1> 	cmp esi, commandbufend
  1602 0000123A 76EE                <1> 	jbe copycommand
  1603 0000123C BE[1F300000]        <1> 	mov esi, commandbuf
  1604 00001241 EBE7                <1> 	jmp copycommand
  1605                              <1> donecopy:
  1606 00001243 81EE[1F300000]      <1> 	sub esi, commandbuf
  1607 00001249 8935[1B300000]      <1> 	mov [currentcommandpos], esi
  1608 0000124F E914000000          <1> 	jmp run
  1609                              <1> 	
  1610                              <1> batchran:
  1611 00001254 C3                  <1> 	ret
  1612                              <1> 
  1613 00001255 E82AFFFFFF          <1> input:	call buftxtclear
  1614 0000125A BE[7A1B0000]        <1> 	mov esi, buftxt		;puts input into buftxt AND onto screen
  1615 0000125F B00D                <1> stdin:	mov al, 13
  1616 00001261 B307                <1> 	mov bl, 7
  1617 00001263 B404                <1> 	mov ah, 4
  1618 00001265 CD30                <1> 	int 30h
  1619 00001267 C3                  <1> 	ret
  1620                              <1> 
  1621 00001268 BE[8E6C0000]        <1> run:	mov esi, line
  1622 0000126D E8E0F9FFFF          <1> 	call print
  1623                              <1> progtest:
  1624 00001272 BE[7A1B0000]        <1> 	mov esi, buftxt
  1625 00001277 BB[6F130000]        <1> 	mov ebx, fileindex
  1626 0000127C 668B03              <1> prgnxt:	mov ax, [ebx]
  1627 0000127F B105                <1> 	mov cl, 5
  1628 00001281 B504                <1> 	mov ch, 4
  1629 00001283 6639C8              <1> 	cmp ax, cx
  1630 00001286 740B                <1> 	je fndprg
  1631 00001288 43                  <1> 	inc ebx
  1632 00001289 81FB[6F150000]      <1> 	cmp ebx, fileindexend
  1633 0000128F 732E                <1> 	jae prgnf
  1634 00001291 EBE9                <1> 	jmp prgnxt
  1635 00001293 81C302000000        <1> fndprg: add ebx, 2
  1636 00001299 BE[7A1B0000]        <1> 	mov esi, buftxt
  1637 0000129E 66B90000            <1> 	mov cx, 0
  1638 000012A2 E87E000000          <1> 	call cndtest
  1639 000012A7 3C01                <1> 	cmp al, 1
  1640 000012A9 7302                <1> 	jae prggood
  1641 000012AB EBCF                <1> 	jmp prgnxt
  1642 000012AD 81FB[6F150000]      <1> prggood: cmp ebx, fileindexend
  1643 000012B3 7331                <1> 	jae prgdn
  1644 000012B5 81C303000000        <1> 	add ebx, 3
  1645 000012BB 8B3B                <1> 	mov edi, [ebx]
  1646 000012BD FFE7                <1> 	jmp edi
  1647                              <1> prgnf:	
  1648 000012BF A0[7A1B0000]        <1> 	mov al, [buftxt]
  1649 000012C4 3C00                <1> 	cmp al, 0
  1650 000012C6 741E                <1> 	je prgdn
  1651 000012C8 BE[556C0000]        <1> 	mov esi, notfound1
  1652 000012CD E880F9FFFF          <1> 	call print
  1653 000012D2 BE[7A1B0000]        <1> 	mov esi, buftxt
  1654 000012D7 E876F9FFFF          <1> 	call print
  1655 000012DC BE[5F6C0000]        <1> 	mov esi, notfound2
  1656 000012E1 E86CF9FFFF          <1> 	call print
  1657 000012E6 E9BCFEFFFF          <1> prgdn:	jmp nwcmd
  1658                              <1> 
  1659                              <1> 
  1660                              <1> tester:			;si=user bx=prog returns 1 in al if true
  1661 000012EB B000                <1> 	mov al, 0
  1662 000012ED 8A06                <1> retest:	mov al, [esi]
  1663 000012EF 8A23                <1> 	mov ah, [ebx]
  1664 000012F1 3C00                <1> 	cmp al, 0
  1665 000012F3 7408                <1> 	je testtrue
  1666 000012F5 38E0                <1> 	cmp al, ah
  1667 000012F7 750C                <1> 	jne testfalse
  1668 000012F9 43                  <1> 	inc ebx
  1669 000012FA 46                  <1> 	inc esi
  1670 000012FB EBF0                <1> 	jmp retest
  1671                              <1> testtrue:
  1672 000012FD 80FC00              <1> 	cmp ah, 0
  1673 00001300 7503                <1> 	jne testfalse
  1674 00001302 B001                <1> 	mov al, 1
  1675 00001304 C3                  <1> 	ret
  1676                              <1> testfalse:
  1677 00001305 B000                <1> 	mov al, 0
  1678 00001307 C3                  <1> 	ret
  1679                              <1> 
  1680                              <1> optest:			;si=user bx=prog returns 1 in al if true
  1681 00001308 B000                <1> 	mov al, 0
  1682                              <1> opretest:
  1683 0000130A 8A06                <1> 	mov al, [esi]
  1684 0000130C 8A23                <1> 	mov ah, [ebx]
  1685 0000130E 38E0                <1> 	cmp al, ah
  1686 00001310 7510                <1> 	jne optestfalse
  1687 00001312 80FC00              <1> 	cmp ah, 0
  1688 00001315 7404                <1> 	je optesttrue
  1689 00001317 43                  <1> 	inc ebx
  1690 00001318 46                  <1> 	inc esi
  1691 00001319 EBEF                <1> 	jmp opretest
  1692                              <1> optesttrue:
  1693 0000131B 3C00                <1> 	cmp al, 0
  1694 0000131D 7503                <1> 	jne optestfalse
  1695 0000131F B001                <1> 	mov al, 1
  1696 00001321 C3                  <1> 	ret
  1697                              <1> optestfalse:
  1698 00001322 B000                <1> 	mov al, 0
  1699 00001324 C3                  <1> 	ret
  1700                              <1> 
  1701                              <1> cndtest:			;si=user bx=prog cl=endchar returns 1 in al if true
  1702 00001325 B000                <1> 	mov al, 0
  1703 00001327 8A06                <1> cndretest:	mov al, [esi]
  1704 00001329 8A23                <1> 	mov ah, [ebx]
  1705 0000132B 38CC                <1> 	cmp ah, cl
  1706 0000132D 7408                <1> 	je cndtesttrue
  1707 0000132F 38E0                <1> 	cmp al, ah
  1708 00001331 750B                <1> 	jne cndtestfalse
  1709 00001333 43                  <1> 	inc ebx
  1710 00001334 46                  <1> 	inc esi
  1711 00001335 EBF0                <1> 	jmp cndretest
  1712                              <1> cndtesttrue:
  1713 00001337 38C8                <1> 	cmp al, cl
  1714 00001339 7506                <1> 	jne cndtestalmost
  1715 0000133B B001                <1> 	mov al, 1
  1716 0000133D C3                  <1> 	ret
  1717                              <1> cndtestfalse:
  1718 0000133E B000                <1> 	mov al, 0
  1719 00001340 C3                  <1> 	ret
  1720                              <1> cndtestalmost:
  1721 00001341 B002                <1> 	mov al, 2
  1722 00001343 C3                  <1> 	ret
  1723 00001344 00                  <1> currentdir db 0
  1724 00001345 BE[6F130000]        <1> dir:	mov esi, fileindex
  1725 0000134A 8A06                <1> 	dirnxt:	mov al, [esi]
  1726 0000134C B400                <1> 		mov ah, 0
  1727 0000134E 3C05                <1> 		cmp al, 5
  1728 00001350 744A                <1> 		je dirfnd
  1729 00001352 3C07                <1> 		cmp al, 7
  1730 00001354 743C                <1> 		je dirfnd3
  1731 00001356 3C06                <1> 		cmp al, 6
  1732 00001358 7438                <1> 		je dirfnd3
  1733 0000135A 46                  <1> 		inc esi
  1734 0000135B 81FE[6F150000]      <1> 		cmp esi,  fileindexend
  1735 00001361 737B                <1> 		jae dirdn
  1736 00001363 EBE5                <1> 		jmp dirnxt
  1737 00001365 060400626174636800- <1> 	typetable db 6,4,0,"batch",0,7,4,0,"document",0,10,4,0,"folder",0,5,4,0,"executable",0
  1738 0000136E 070400646F63756D65- <1>
  1739 00001377 6E74000A0400666F6C- <1>
  1740 00001380 646572000504006578- <1>
  1741 00001389 6563757461626C6500  <1>
  1742                              <1> 	dirfnd3:
  1743 00001392 46                  <1> 		inc esi
  1744 00001393 81FE[6F150000]      <1> 		cmp esi, fileindexend
  1745 00001399 76AF                <1> 		jbe dirnxt
  1746 0000139B 4E                  <1> 		dec esi
  1747 0000139C 46                  <1> 	dirfnd:	inc esi
  1748 0000139D 8A06                <1> 		mov al, [esi]
  1749 0000139F B400                <1> 		mov ah, 0
  1750 000013A1 3C04                <1> 		cmp al, 4
  1751 000013A3 740B                <1> 		je dirfnd2
  1752 000013A5 46                  <1> 		inc esi
  1753 000013A6 81FE[6F150000]      <1> 		cmp esi,  fileindexend
  1754 000013AC 7330                <1> 		jae dirdn
  1755 000013AE EB9A                <1> 		jmp dirnxt
  1756 000013B0 81C601000000        <1> 	dirfnd2: add esi, 1
  1757 000013B6 E897F8FFFF          <1> 		call print
  1758 000013BB 8935[E3130000]      <1> 		mov [esidir], esi
  1759 000013C1 BE[8E6C0000]        <1> 		mov esi, line
  1760 000013C6 E887F8FFFF          <1> 		call print
  1761 000013CB 8B35[E3130000]      <1> 		mov esi, [esidir]
  1762 000013D1 81FE[6F150000]      <1> 		cmp esi,  fileindexend
  1763 000013D7 7305                <1> 		jae dirdn
  1764 000013D9 E96CFFFFFF          <1> 		jmp dirnxt
  1765 000013DE E9C4FDFFFF          <1> 	dirdn:	jmp nwcmd
  1766 000013E3 00000000            <1> esidir dd 0
  1767                              <1> 
  1768                              <1> array:				;arraystart in si, arrayend in bx, arrayseperator in cx
  1769                              <1> 		                ;ends if array seperator is found backwards after 0
  1770                              <1> 	arnxt:	      
  1771 000013E7 88E8                <1> 		mov al, ch
  1772 000013E9 88CC                <1> 		mov ah, cl        
  1773 000013EB 663906              <1> 		cmp [esi], ax
  1774 000013EE 744D                <1> 		je ardn
  1775 000013F0 66390E              <1> 		cmp [esi], cx
  1776 000013F3 7407                <1> 		je arfnd
  1777 000013F5 46                  <1> 		inc esi
  1778 000013F6 39DE                <1> 		cmp esi, ebx
  1779 000013F8 7343                <1> 		jae ardn
  1780 000013FA EBEB                <1> 		jmp arnxt
  1781 000013FC 81C602000000        <1> 	arfnd: add esi, 2
  1782 00001402 891D[3E140000]      <1> 		mov [arbx], ebx
  1783 00001408 890D[42140000]      <1> 		mov [arcx], ecx
  1784 0000140E E83FF8FFFF          <1> 		call print
  1785 00001413 8935[44140000]      <1> 		mov [arsi], esi
  1786 00001419 BE[8E6C0000]        <1> 		mov esi, line
  1787 0000141E E82FF8FFFF          <1> 		call print
  1788 00001423 8B1D[3E140000]      <1> 		mov ebx, [arbx]
  1789 00001429 668B0D[42140000]    <1> 		mov cx, [arcx]
  1790 00001430 8B35[44140000]      <1> 		mov esi, [arsi]
  1791 00001436 46                  <1> 		inc esi
  1792 00001437 39DE                <1> 		cmp esi, ebx
  1793 00001439 7302                <1> 		jae ardn
  1794 0000143B EBAA                <1> 		jmp arnxt
  1795 0000143D C3                  <1> 	ardn:	ret
  1796 0000143E 00000000            <1> arbx:	dw 0,0
  1797 00001442 0000                <1> arcx:	db 0,0
  1798 00001444 00000000            <1> arsi:	dw 0,0
  1799                              <1> 
  1800                              <1> clearbuffer:
  1801 00001448 BE[7A1C0000]        <1> 	mov esi, buf2
  1802 0000144D B030                <1> 	mov al, '0'
  1803 0000144F 81FE[8E1C0000]      <1> clearbuf: cmp esi, numbuf
  1804 00001455 7305                <1> 	jae doneclearbuff
  1805 00001457 8806                <1> 	mov [esi], al
  1806 00001459 46                  <1> 	inc esi
  1807 0000145A EBF3                <1> 	jmp clearbuf
  1808                              <1> doneclearbuff: 
  1809 0000145C C3                  <1> 		ret
  1810                              <1> 
  1811                              <1> convert:
  1812 0000145D 4E                  <1> 	dec esi
  1813 0000145E 89F3                <1> 	mov ebx, esi		;place to convert into must be in si, number to convert must be in cx
  1814                              <1> cnvrt:
  1815 00001460 89DE                <1> 	mov esi, ebx
  1816 00001462 81EE09000000        <1> 	sub esi, 9
  1817 00001468 81F900CA9A3B        <1> 	cmp ecx, 1000000000
  1818 0000146E 720A                <1> 	jb ten8
  1819 00001470 81E900CA9A3B        <1> 	sub ecx, 1000000000
  1820 00001476 FE06                <1> 	inc byte [esi]
  1821 00001478 EBE6                <1> 	jmp cnvrt
  1822 0000147A 46                  <1> ten8:	inc esi
  1823 0000147B 81F900E1F505        <1> 	cmp ecx, 100000000
  1824 00001481 720A                <1> 	jb ten7
  1825 00001483 81E900E1F505        <1> 	sub ecx, 100000000
  1826 00001489 FE06                <1> 	inc byte [esi]
  1827 0000148B EBD3                <1> 	jmp cnvrt
  1828 0000148D 46                  <1> ten7:	inc esi
  1829 0000148E 81F980969800        <1> 	cmp ecx, 10000000
  1830 00001494 720A                <1> 	jb ten6
  1831 00001496 81E980969800        <1> 	sub ecx, 10000000
  1832 0000149C FE06                <1> 	inc byte [esi]
  1833 0000149E EBC0                <1> 	jmp cnvrt
  1834 000014A0 46                  <1> ten6:	inc esi
  1835 000014A1 81F940420F00        <1> 	cmp ecx, 1000000
  1836 000014A7 720A                <1> 	jb ten5
  1837 000014A9 81E940420F00        <1> 	sub ecx, 1000000
  1838 000014AF FE06                <1> 	inc byte [esi]
  1839 000014B1 EBAD                <1> 	jmp cnvrt
  1840 000014B3 46                  <1> ten5:	inc esi
  1841 000014B4 81F9A0860100        <1> 	cmp ecx, 100000
  1842 000014BA 720A                <1> 	jb ten4
  1843 000014BC 81E9A0860100        <1> 	sub ecx, 100000
  1844 000014C2 FE06                <1> 	inc byte [esi]
  1845 000014C4 EB9A                <1> 	jmp cnvrt
  1846 000014C6 46                  <1> ten4:	inc esi
  1847 000014C7 81F910270000        <1> 	cmp ecx, 10000
  1848 000014CD 720A                <1> 	jb ten3
  1849 000014CF 81E910270000        <1> 	sub ecx, 10000
  1850 000014D5 FE06                <1> 	inc byte [esi]
  1851 000014D7 EB87                <1> 	jmp cnvrt
  1852 000014D9 46                  <1> ten3:	inc esi
  1853 000014DA 81F9E8030000        <1> 	cmp ecx, 1000
  1854 000014E0 720D                <1> 	jb ten2
  1855 000014E2 81E9E8030000        <1> 	sub ecx, 1000
  1856 000014E8 FE06                <1> 	inc byte [esi]
  1857 000014EA E971FFFFFF          <1> 	jmp cnvrt
  1858 000014EF 46                  <1> ten2:	inc esi
  1859 000014F0 81F964000000        <1> 	cmp ecx, 100
  1860 000014F6 720D                <1> 	jb ten1
  1861 000014F8 81E964000000        <1> 	sub ecx, 100
  1862 000014FE FE06                <1> 	inc byte [esi]
  1863 00001500 E95BFFFFFF          <1> 	jmp cnvrt
  1864 00001505 46                  <1> ten1:	inc esi
  1865 00001506 81F90A000000        <1> 	cmp ecx, 10
  1866 0000150C 720D                <1> 	jb ten0
  1867 0000150E 81E90A000000        <1> 	sub ecx, 10
  1868 00001514 FE06                <1> 	inc byte [esi]
  1869 00001516 E945FFFFFF          <1> 	jmp cnvrt
  1870 0000151B 46                  <1> ten0:	inc esi
  1871 0000151C 81F901000000        <1> 	cmp ecx, 1
  1872 00001522 720D                <1> 	jb tendn
  1873 00001524 81E901000000        <1> 	sub ecx, 1
  1874 0000152A FE06                <1> 	inc byte [esi]
  1875 0000152C E92FFFFFFF          <1> 	jmp cnvrt
  1876                              <1> tendn:
  1877 00001531 C3                  <1> 	ret
  1878                              <1> 
  1879                              <1> 	
  1880                              <1> 
  1881 00001532 00<rept>            <1> hexnumber times 8 db 0
  1882 0000153A 202000              <1> hexnumberend db "  ",0
  1883                              <1> 
  1884                              <1> 
  1885 0000153D 00000000            <1> sibuf dw 0,0
  1886 00001541 00000000            <1> dibuf dw 0,0
  1887                              <1> 
  1888                              <1> converthex:
  1889                              <1> clearbufferhex:
  1890 00001545 B030                <1> 	mov al, '0'
  1891 00001547 8935[3D150000]      <1> 	mov [sibuf], esi
  1892 0000154D 893D[41150000]      <1> 	mov [dibuf], edi
  1893 00001553 39FE                <1> clearbufhex: cmp esi, edi
  1894 00001555 7305                <1> 	jae doneclearbuffhex
  1895 00001557 8806                <1> 	mov [esi], al
  1896 00001559 46                  <1> 	inc esi
  1897 0000155A EBF7                <1> 	jmp clearbufhex
  1898                              <1> doneclearbuffhex:
  1899 0000155C 8B35[41150000]      <1> 	mov esi, [dibuf]
  1900 00001562 89CA                <1> 	mov edx, ecx
  1901 00001564 81FA00000000        <1> 	cmp edx, 0
  1902 0000156A 741F                <1> 	je donenxtephx
  1903                              <1> nxtexphx:	;0x10^x
  1904 0000156C 4E                  <1> 	dec esi
  1905 0000156D 89F7                <1> 	mov edi, esi		;;location of 0x10^x
  1906 0000156F 89D1                <1> 	mov ecx, edx
  1907 00001571 81E10F000000        <1> 	and ecx, 0xF		;;just this digit
  1908 00001577 E81C000000          <1> 	call cnvrtexphx		;;get this digit
  1909 0000157C 89FE                <1> 	mov esi, edi
  1910 0000157E C1EA04              <1> 	shr edx, 4		;;next digit
  1911 00001581 81FA00000000        <1> 	cmp edx, 0
  1912 00001587 7402                <1> 	je donenxtephx
  1913 00001589 EBE1                <1> 	jmp nxtexphx
  1914                              <1> donenxtephx:
  1915 0000158B 8B35[3D150000]      <1> 	mov esi, [sibuf]
  1916 00001591 8B3D[41150000]      <1> 	mov edi, [dibuf]
  1917 00001597 C3                  <1> 	ret
  1918                              <1> cnvrtexphx:			;;convert this number
  1919 00001598 89F3                <1> 	mov ebx, esi		;place to convert to must be in si, number to convert must be in cx
  1920 0000159A 81F900000000        <1> 	cmp ecx, 0
  1921 000015A0 7429                <1> 	je zerohx
  1922 000015A2 8A06                <1> cnvrthx:  mov al, [esi]
  1923 000015A4 3C39                <1> 	cmp al, '9'
  1924 000015A6 741B                <1> 	je lettershx
  1925 000015A8 3C46                <1> lttrhxdn: cmp al, 'F'
  1926 000015AA 741F                <1> 	je zerohx
  1927 000015AC 8A06                <1> 	mov al, [esi]
  1928 000015AE FEC0                <1> 	inc al
  1929 000015B0 8806                <1> 	mov [esi], al
  1930 000015B2 89DE                <1> 	mov esi, ebx
  1931 000015B4 81E901000000        <1> cnvrtlphx: sub ecx, 1
  1932 000015BA 81F900000000        <1> 	cmp ecx, 0
  1933 000015C0 75E0                <1> 	jne cnvrthx
  1934 000015C2 C3                  <1> 	ret
  1935                              <1> lettershx:
  1936 000015C3 B041                <1> 	mov al, 'A'
  1937 000015C5 2C01                <1> 	sub al, 1
  1938 000015C7 8806                <1> 	mov [esi], al
  1939 000015C9 EBDD                <1> 	jmp lttrhxdn
  1940 000015CB B030                <1> zerohx:	mov al, '0'
  1941 000015CD 8806                <1> 	mov [esi], al
  1942 000015CF 4E                  <1> 	dec esi
  1943 000015D0 8A06                <1> 	mov al, [esi]
  1944 000015D2 3C46                <1> 	cmp al, 'F'
  1945 000015D4 74F5                <1> 	je zerohx
  1946 000015D6 41                  <1> 	inc ecx
  1947 000015D7 EBDB                <1> 	jmp cnvrtlphx
  1948 000015D9 00                  <1> smallhex db 0
  1949 000015DA 01                  <1> firsthexshown db 1
  1950                              <1> showhexsmall:
  1951 000015DB C605[D9150000]01    <1> 	mov byte [smallhex], 1
  1952 000015E2 E808000000          <1> 	call showhex
  1953 000015E7 C605[D9150000]00    <1> 	mov byte [smallhex], 0
  1954 000015EE C3                  <1> 	ret
  1955                              <1> showhex:
  1956 000015EF 60                  <1> 	pusha
  1957 000015F0 BE[32150000]        <1> 	mov esi, hexnumber
  1958 000015F5 BF[3A150000]        <1> 	mov edi, hexnumberend
  1959 000015FA E846FFFFFF          <1> 	call converthex
  1960 000015FF 803D[DA150000]01    <1> 	cmp byte [firsthexshown], 1
  1961 00001606 7504                <1> 	jne showthathex
  1962 00001608 66BA0000            <1> 	mov dx, 0
  1963                              <1> showthathex:
  1964 0000160C 803D[DA150000]03    <1> 	cmp byte [firsthexshown], 3
  1965 00001613 750A                <1> 	jne nonewhexline
  1966 00001615 BE[8E6C0000]        <1> 	mov esi, line
  1967 0000161A E833F6FFFF          <1> 	call print
  1968                              <1> nonewhexline:
  1969 0000161F 803D[DA150000]04    <1> 	cmp byte [firsthexshown], 4
  1970 00001626 7527                <1> 	jne notabfixhex
  1971 00001628 B1A0                <1> 	mov cl, 160
  1972 0000162A 28D1                <1> 	sub cl, dl
  1973 0000162C C0E905              <1> 	shr cl, 5
  1974 0000162F C0E105              <1> 	shl cl, 5
  1975 00001632 80F900              <1> 	cmp cl, 0
  1976 00001635 750F                <1> 	jne nonewlinetabfixhex
  1977 00001637 BE[8E6C0000]        <1> 	mov esi, line
  1978 0000163C E811F6FFFF          <1> 	call print
  1979 00001641 E909000000          <1> 	jmp notabfixhex
  1980                              <1> nonewlinetabfixhex:
  1981 00001646 80C20F              <1> 	add dl, 15
  1982 00001649 C0EA04              <1> 	shr dl, 4
  1983 0000164C C0E204              <1> 	shl dl, 4
  1984                              <1> notabfixhex:
  1985 0000164F BE[32150000]        <1> 	mov esi, hexnumber
  1986 00001654 803D[D9150000]01    <1> 	cmp byte [smallhex],1
  1987 0000165B 7506                <1> 	jne printnosmallhex
  1988 0000165D 81C606000000        <1> 	add esi, 6
  1989                              <1> printnosmallhex:
  1990 00001663 E8EAF5FFFF          <1> 	call print
  1991 00001668 803D[DA150000]02    <1> 	cmp byte [firsthexshown], 2
  1992 0000166F 750A                <1> 	jne hexshown
  1993 00001671 BE[8E6C0000]        <1> 	mov esi, line
  1994 00001676 E8D7F5FFFF          <1> 	call print
  1995                              <1> hexshown:
  1996 0000167B C605[DA150000]00    <1> 	mov byte [firsthexshown], 0
  1997 00001682 61                  <1> 	popa
  1998 00001683 C3                  <1> 	ret
  1999                              <1> 
  2000                              <1> 
  2001 00001684 303030303030303030- <1> decnumber db "00000000000000"
  2002 0000168D 3030303030          <1>
  2003 00001692 2000                <1> decnumberend: db " ",0
  2004                              <1> 
  2005                              <1> showdec: ;;same as showhex, just uses decimal conversion
  2006 00001694 60                  <1> 	pusha
  2007 00001695 BF[84160000]        <1> 	mov edi, decnumber
  2008 0000169A BE[92160000]        <1> 	mov esi, decnumberend
  2009                              <1> cleardecbuf:
  2010 0000169F C60730              <1> 	mov byte [edi], '0'
  2011 000016A2 47                  <1> 	inc edi
  2012 000016A3 39F7                <1> 	cmp edi, esi
  2013 000016A5 72F8                <1> 	jb cleardecbuf
  2014 000016A7 BF[84160000]        <1> 	mov edi, decnumber
  2015 000016AC E8ACFDFFFF          <1> 	call convert
  2016 000016B1 803D[DA150000]01    <1> 	cmp byte [firsthexshown], 1
  2017 000016B8 7504                <1> 	jne showthatdec
  2018 000016BA 66BA0000            <1> 	mov dx, 0
  2019                              <1> showthatdec:
  2020 000016BE 803D[DA150000]03    <1> 	cmp byte [firsthexshown], 3
  2021 000016C5 750A                <1> 	jne nonewdecline
  2022 000016C7 BE[8E6C0000]        <1> 	mov esi, line
  2023 000016CC E881F5FFFF          <1> 	call print
  2024                              <1> nonewdecline:
  2025 000016D1 803D[DA150000]04    <1> 	cmp byte [firsthexshown], 4
  2026 000016D8 7527                <1> 	jne notabfixdec
  2027 000016DA B1A0                <1> 	mov cl, 160
  2028 000016DC 28D1                <1> 	sub cl, dl
  2029 000016DE C0E905              <1> 	shr cl, 5
  2030 000016E1 C0E105              <1> 	shl cl, 5
  2031 000016E4 80F900              <1> 	cmp cl, 0
  2032 000016E7 750F                <1> 	jne nonewlinetabfixdec
  2033 000016E9 BE[8E6C0000]        <1> 	mov esi, line
  2034 000016EE E85FF5FFFF          <1> 	call print
  2035 000016F3 E909000000          <1> 	jmp notabfixdec
  2036                              <1> nonewlinetabfixdec:
  2037 000016F8 80C20F              <1> 	add dl, 15
  2038 000016FB C0EA04              <1> 	shr dl, 4
  2039 000016FE C0E204              <1> 	shl dl, 4
  2040                              <1> notabfixdec:
  2041 00001701 BE[84160000]        <1> 	mov esi, decnumber
  2042 00001706 4E                  <1> 	dec esi
  2043                              <1> sifind:
  2044 00001707 46                  <1> 	inc esi
  2045 00001708 803E30              <1> 	cmp byte [esi], '0'
  2046 0000170B 74FA                <1> 	je sifind
  2047 0000170D E840F5FFFF          <1> 	call print
  2048 00001712 803D[DA150000]02    <1> 	cmp byte [firsthexshown], 2
  2049 00001719 750A                <1> 	jne decshown
  2050 0000171B BE[8E6C0000]        <1> 	mov esi, line
  2051 00001720 E82DF5FFFF          <1> 	call print
  2052                              <1> decshown:
  2053 00001725 C605[DA150000]00    <1> 	mov byte [firsthexshown], 0
  2054 0000172C 61                  <1> 	popa
  2055 0000172D C3                  <1> 	ret
  2056                              <1> 	
  2057                              <1> cnvrttxt: 
  2058 0000172E B900000000          <1> 	mov ecx, 0
  2059 00001733 B800000000          <1> 	mov eax, 0
  2060 00001738 BA00000000          <1> 	mov edx, 0
  2061 0000173D BB00000000          <1> 	mov ebx, 0
  2062 00001742 4E                  <1> 	dec esi
  2063                              <1> cnvrtlptxt:
  2064 00001743 46                  <1> 	inc esi
  2065 00001744 8A06                <1> 	mov al, [esi]
  2066 00001746 3C00                <1> 	cmp al, 0
  2067 00001748 75F9                <1> 	jne cnvrtlptxt
  2068 0000174A 4E                  <1> 	dec esi
  2069 0000174B 8A06                <1> 	mov al, [esi]
  2070 0000174D 3C30                <1> 	cmp al, '0'
  2071 0000174F 7504                <1> 	jne txtlp
  2072 00001751 39FE                <1> zerotest: cmp esi, edi
  2073 00001753 745B                <1> 	je donecnvrt
  2074                              <1> txtlp:	
  2075 00001755 B800000000          <1> 	mov eax, 0
  2076 0000175A 8A06                <1> 	mov al, [esi]
  2077 0000175C 3C3D                <1> 	cmp al, '='
  2078 0000175E 7450                <1> 	je donecnvrt
  2079 00001760 3C30                <1> 	cmp al, 48
  2080 00001762 724C                <1> 	jb donecnvrt
  2081 00001764 3C23                <1> 	cmp al, '#'
  2082 00001766 7448                <1> 	je donecnvrt
  2083 00001768 39FE                <1> 	cmp esi, edi
  2084 0000176A 7244                <1> 	jb donecnvrt
  2085 0000176C 81F900000000        <1> 	cmp ecx, 0
  2086 00001772 7708                <1> 	ja exp
  2087 00001774 2C30                <1> noexp:	sub al, 48
  2088 00001776 01C2                <1> 	add edx, eax
  2089 00001778 4E                  <1> 	dec esi
  2090 00001779 41                  <1> 	inc ecx
  2091 0000177A EBD9                <1> 	jmp txtlp
  2092 0000177C 81F900000000        <1> exp:	cmp ecx, 0
  2093 00001782 74F0                <1> 	je noexp
  2094 00001784 2C30                <1> 	sub al, 48
  2095 00001786 51                  <1> 	push ecx
  2096 00001787 89C3                <1> expmul:	mov ebx, eax
  2097 00001789 01D8                <1> 	add eax, ebx
  2098 0000178B 01D8                <1> 	add eax, ebx
  2099 0000178D 01D8                <1> 	add eax, ebx
  2100 0000178F 01D8                <1> 	add eax, ebx
  2101 00001791 01D8                <1> 	add eax, ebx
  2102 00001793 01D8                <1> 	add eax, ebx
  2103 00001795 01D8                <1> 	add eax, ebx
  2104 00001797 01D8                <1> 	add eax, ebx
  2105 00001799 01D8                <1> 	add eax, ebx
  2106 0000179B 81E901000000        <1> 	sub ecx, 1
  2107 000017A1 81F900000000        <1> 	cmp ecx, 0
  2108 000017A7 77DE                <1> 	ja expmul
  2109 000017A9 01C2                <1> 	add edx, eax
  2110 000017AB 59                  <1> 	pop ecx
  2111 000017AC 4E                  <1> 	dec esi
  2112 000017AD 41                  <1> 	inc ecx
  2113 000017AE EBA5                <1> 	jmp txtlp
  2114 000017B0 89D1                <1> donecnvrt: mov ecx, edx
  2115 000017B2 C3                  <1> 	ret
  2116                                      %include 'source/builtinprogs.asm'
  2117 000017B3 050406040704        <1> filetypes db 5,4,6,4,7,4
  2118                              <1> progstart:		;programs start here
  2119                              <1> ;db 5,4,"index",0
  2120                              <1> ;	call indexfiles
  2121                              <1> ;	jmp nwcmd
  2122                              <1> indexfiles:
  2123 000017B9 BE[B9170000]        <1> 	mov esi, progstart
  2124 000017BE BB[6F130000]        <1> 	mov ebx, fileindex
  2125 000017C3 BF[B9170000]        <1> 	mov edi, progstart
  2126 000017C8 81EF02000000        <1> 	sub edi, 2
  2127                              <1> indexloop:
  2128 000017CE 668B0E              <1> 	mov cx, [esi]
  2129                              <1> 	indexloop2:
  2130 000017D1 663B0F              <1> 		cmp cx, [edi]
  2131 000017D4 7424                <1> 		je indexloop2done
  2132 000017D6 81EF02000000        <1> 		sub edi, 2
  2133 000017DC 81FF[B3170000]      <1> 		cmp edi, filetypes
  2134 000017E2 73ED                <1> 		jae indexloop2
  2135 000017E4 BF[B9170000]        <1> 	mov edi, progstart
  2136 000017E9 81EF02000000        <1> 	sub edi, 2
  2137 000017EF 46                  <1> 	inc esi
  2138 000017F0 81FE[15280000]      <1> 	cmp esi, batchprogend
  2139 000017F6 734E                <1> 	jae indexloopdone
  2140 000017F8 EBD4                <1> 	jmp indexloop
  2141                              <1> indexloop2done:
  2142 000017FA 66890B              <1> 	mov [ebx], cx
  2143 000017FD 81C302000000        <1> 	add ebx, 2
  2144 00001803 81C602000000        <1> 	add esi, 2
  2145                              <1> 	nameindex:
  2146 00001809 8A0E                <1> 		mov cl, [esi]
  2147 0000180B 80F900              <1> 		cmp cl, 0
  2148 0000180E 7406                <1> 		je nameindexdone
  2149 00001810 880B                <1> 		mov [ebx], cl
  2150 00001812 46                  <1> 		inc esi
  2151 00001813 43                  <1> 		inc ebx
  2152 00001814 EBF3                <1> 		jmp nameindex
  2153                              <1> 	nameindexdone:
  2154 00001816 43                  <1> 		inc ebx
  2155 00001817 66C7030000          <1> 		mov word [ebx], 0
  2156 0000181C 81C302000000        <1> 		add ebx, 2
  2157 00001822 46                  <1> 		inc esi
  2158 00001823 8933                <1> 		mov [ebx], esi
  2159 00001825 81C304000000        <1> 		add ebx, 4
  2160 0000182B 66C7030000          <1> 		mov word [ebx], 0
  2161 00001830 81C302000000        <1> 		add ebx, 2
  2162 00001836 81FB[6F150000]      <1> 		cmp ebx, fileindexend
  2163 0000183C 7308                <1> 		jae indexloopdone
  2164 0000183E 81C601000000        <1> 		add esi, 1
  2165 00001844 EB88                <1> 		jmp indexloop
  2166 00001846 C3                  <1> indexloopdone: 	ret
  2167                              <1> 
  2168                              <1> 
  2169                              <1> ;db 5,4,"showindex",0
  2170                              <1> ;	mov esi, fileindex
  2171                              <1> ;	mov ebx, fileindexend
  2172                              <1> ;	mov cl, 5
  2173                              <1> ;	mov ch, 4
  2174                              <1> ;	call array
  2175                              <1> ;	mov esi, fileindex
  2176                              <1> ;	mov ebx, fileindexend
  2177                              <1> ;	mov cl, 6
  2178                              <1> ;	mov ch, 4
  2179                              <1> ;	call array
  2180                              <1> ;	mov esi, fileindex
  2181                              <1> ;	mov ebx, fileindexend
  2182                              <1> ;	mov cl, 7
  2183                              <1> ;	mov ch, 4
  2184                              <1> ;	call array
  2185                              <1> ;	jmp nwcmd
  2186                              <1> 
  2187 00001847 05046C7300          <1> db 5,4,"ls",0
  2188 0000184C BE[B9170000]        <1> 	lscmd:	mov esi, progstart
  2189 00001851 BB[15280000]        <1> 		mov ebx, progend
  2190 00001856 E9EAFAFFFF          <1> 		jmp dir
  2191                              <1> 		
  2192 0000185B 05046469736B00      <1> db 5,4,"disk",0
  2193 00001862 B900000000          <1> 		mov ecx, 0
  2194 00001867 8A0D[62010000]      <1> 		mov cl, [DriveNumber]
  2195 0000186D C605[DA150000]00    <1> 		mov byte [firsthexshown], 0
  2196 00001874 E876FDFFFF          <1> 		call showhex
  2197 00001879 BE[8E6C0000]        <1> 		mov esi, line
  2198 0000187E E8CFF3FFFF          <1> 		call print
  2199 00001883 BE[EB6B0000]        <1> 		mov esi, diskfileindex
  2200                              <1> 	diskindexdir:
  2201 00001888 E8C5F3FFFF          <1> 		call print
  2202 0000188D 8B4E05              <1> 		mov ecx, [esi + 5]
  2203 00001890 C605[DA150000]03    <1> 		mov byte [firsthexshown], 3
  2204 00001897 E8F8FDFFFF          <1> 		call showdec
  2205 0000189C 56                  <1> 		push esi
  2206 0000189D BE[8E6C0000]        <1> 		mov esi, line
  2207 000018A2 E8ABF3FFFF          <1> 		call print
  2208 000018A7 5E                  <1> 		pop esi
  2209 000018A8 81C609000000        <1> 		add esi, 9
  2210 000018AE 81FE[506C0000]      <1> 		cmp esi, enddiskfileindex
  2211 000018B4 72D2                <1> 		jb diskindexdir
  2212 000018B6 E9ECF8FFFF          <1> 		jmp nwcmd
  2213                              <1> 
  2214 000018BB 0504636C65617200    <1> db 5,4,"clear",0
  2215 000018C3 E87AF6FFFF          <1> 	cls:	call clear
  2216 000018C8 E9DAF8FFFF          <1> 		jmp nwcmd
  2217                              <1> 		
  2218 000018CD 05047761697400      <1> db 5,4,"wait",0
  2219 000018D4 B000                <1> 		mov al, 0
  2220 000018D6 E836F3FFFF          <1> 		call int302
  2221 000018DB E9C7F8FFFF          <1> 		jmp nwcmd
  2222                              <1> 
  2223 000018E0 05046563686F00      <1> db 5,4,"echo",0
  2224 000018E7 BE[7A1B0000]        <1> 	echo:	mov esi, buftxt
  2225 000018EC 81C605000000        <1> 		add esi, 5
  2226 000018F2 8A06                <1> 		mov al, [esi]
  2227 000018F4 3C24                <1> 		cmp al, '$'
  2228 000018F6 7414                <1> 		je echovr
  2229 000018F8 E855F3FFFF          <1> 		call print
  2230 000018FD BE[8E6C0000]        <1> 		mov esi, line
  2231 00001902 E84BF3FFFF          <1> 		call print
  2232 00001907 E99BF8FFFF          <1> 		jmp nwcmd
  2233 0000190C BB[6F150000]        <1> 	echovr:	mov ebx, variables
  2234 00001911 BF06000000          <1> 		mov edi, 6
  2235 00001916 E83A000000          <1> 		call nxtvrech
  2236 0000191B E957000000          <1> 		jmp prntvr2
  2237 00001920 B13D                <1> 	echvar:	mov cl, '='
  2238 00001922 43                  <1> 		inc ebx
  2239 00001923 8A03                <1> 		mov al, [ebx]
  2240 00001925 3C00                <1> 		cmp al, 0
  2241 00001927 742C                <1> 		je nxtvrech
  2242 00001929 3C3D                <1> 		cmp al, '='
  2243 0000192B 7420                <1> 		je nxtvrechb1
  2244 0000192D BE[7A1B0000]        <1> 		mov esi, buftxt
  2245 00001932 01FE                <1> 		add esi, edi
  2246 00001934 E8ECF9FFFF          <1> 		call cndtest
  2247 00001939 3C02                <1> 		cmp al, 2
  2248 0000193B 7436                <1> 		je prntvr
  2249 0000193D 3C01                <1> 		cmp al, 1
  2250 0000193F 7432                <1> 		je prntvr
  2251 00001941 BE[7A1B0000]        <1> 		mov esi, buftxt
  2252 00001946 01FE                <1> 		add esi, edi
  2253 00001948 E908000000          <1> 		jmp nxtvrech
  2254                              <1> 	nxtvrechb1:
  2255 0000194D 81EB02000000        <1> 		sub ebx, 2
  2256 00001953 EBCB                <1> 		jmp echvar
  2257 00001955 8A03                <1> 	nxtvrech: mov al, [ebx]
  2258 00001957 3C05                <1> 		cmp al, 5
  2259 00001959 740F                <1> 		je nxtvrec2
  2260 0000195B 43                  <1> 		inc ebx
  2261 0000195C 81FB[6F1A0000]      <1> 		cmp ebx, varend
  2262 00001962 0F833FF8FFFF        <1> 		jae nwcmd
  2263 00001968 EBEB                <1> 		jmp nxtvrech
  2264 0000196A 43                  <1> 	nxtvrec2: inc ebx
  2265 0000196B 8A03                <1> 		mov al, [ebx]
  2266 0000196D 3C04                <1> 		cmp al, 4
  2267 0000196F 74AF                <1> 		je echvar
  2268 00001971 EBE2                <1> 		jmp nxtvrech
  2269 00001973 43                  <1> 	prntvr: inc ebx
  2270 00001974 89DE                <1> 		mov esi, ebx
  2271 00001976 C3                  <1> 		ret
  2272 00001977 E8D6F2FFFF          <1> 	prntvr2: call print
  2273 0000197C BE[8E6C0000]        <1> 		mov esi, line
  2274 00001981 E8CCF2FFFF          <1> 		call print
  2275 00001986 E91CF8FFFF          <1> 		jmp nwcmd
  2276                              <1> 		
  2277                              <1> 
  2278 0000198B 05042300            <1> db 5,4,"#",0
  2279                              <1> 	num:	
  2280 0000198F E8B4FAFFFF          <1> 		call clearbuffer
  2281 00001994 C605[4B1C0000]00    <1> 		mov byte [decimal], 0
  2282 0000199B C605[4C1C0000]00    <1> 		mov byte [decimal2], 0
  2283 000019A2 BE[7A1B0000]        <1> 		mov esi, buftxt
  2284 000019A7 B800000000          <1> 		mov eax, 0
  2285 000019AC B900000000          <1> 		mov ecx, 0
  2286 000019B1 BB00000000          <1> 		mov ebx, 0
  2287 000019B6 8A06                <1> 	num2:	mov al, [esi]
  2288 000019B8 3C2B                <1> 		cmp al, '+'
  2289 000019BA 741B                <1> 		je operatorfound
  2290 000019BC 3C2D                <1> 		cmp al, '-'
  2291 000019BE 7417                <1> 		je operatorfound
  2292 000019C0 3C2A                <1> 		cmp al, '*'
  2293 000019C2 7413                <1> 		je operatorfound
  2294 000019C4 3C2F                <1> 		cmp al, '/'
  2295 000019C6 740F                <1> 		je operatorfound
  2296 000019C8 3C5E                <1> 		cmp al, '^'
  2297 000019CA 740B                <1> 		je operatorfound
  2298 000019CC 46                  <1> 		inc esi
  2299 000019CD 3C00                <1> 		cmp al, 0
  2300 000019CF 0F84D2F7FFFF        <1> 		je near nwcmd
  2301 000019D5 EBDF                <1> 		jmp num2
  2302 000019D7 50                  <1> 	operatorfound: push eax
  2303 000019D8 B400                <1> 		mov ah, 0
  2304 000019DA 8826                <1> 		mov [esi], ah
  2305 000019DC 89F7                <1> 		mov edi, esi
  2306 000019DE 46                  <1> 		inc esi
  2307 000019DF 8A06                <1> 		mov al, [esi]
  2308 000019E1 3C24                <1> 		cmp al, '$'
  2309 000019E3 0F8481000000        <1> 		je near varnum1
  2310 000019E9 3C25                <1> 		cmp al, '%'
  2311 000019EB 0F8469000000        <1> 		je near resultnum1
  2312                              <1> 	varnum2: 
  2313 000019F1 57                  <1> 		push edi
  2314 000019F2 E8C9000000          <1> 		call checkdecimal
  2315 000019F7 5F                  <1> 		pop edi
  2316 000019F8 E831FDFFFF          <1> 		call cnvrttxt
  2317                              <1> 	vrnm2:
  2318 000019FD 89CB                <1> 		mov ebx, ecx
  2319 000019FF 53                  <1> 		push ebx
  2320 00001A00 E843FAFFFF          <1> 		call clearbuffer
  2321 00001A05 BE[7A1B0000]        <1> 		mov esi, buftxt
  2322 00001A0A 89F7                <1> 		mov edi, esi
  2323 00001A0C 46                  <1> 		inc esi
  2324 00001A0D 8A06                <1> 		mov al, [esi]
  2325 00001A0F 3C24                <1> 		cmp al, '$'
  2326 00001A11 0F8474000000        <1> 		je near varnum3
  2327 00001A17 3C25                <1> 		cmp al, '%'
  2328 00001A19 0F8443000000        <1> 		je near resultnum2
  2329                              <1> 	varnum4: 
  2330 00001A1F 57                  <1> 		push edi
  2331 00001A20 E887000000          <1> 		call checkdecimal2
  2332 00001A25 5F                  <1> 		pop edi
  2333 00001A26 E803FDFFFF          <1> 		call cnvrttxt
  2334                              <1> 	vrnm4:
  2335 00001A2B 5B                  <1> 		pop ebx
  2336 00001A2C 58                  <1> 		pop eax
  2337 00001A2D 3C2B                <1> 		cmp al, '+'
  2338 00001A2F 0F84B9000000        <1> 		je near plusnum
  2339 00001A35 3C2D                <1> 		cmp al, '-'
  2340 00001A37 0F84BD000000        <1> 		je near subnum
  2341 00001A3D 3C2A                <1> 		cmp al, '*'
  2342 00001A3F 0F84C1000000        <1> 		je near mulnum
  2343 00001A45 3C2F                <1> 		cmp al, '/'
  2344 00001A47 0F84CF000000        <1> 		je near divnum
  2345 00001A4D 3C5E                <1> 		cmp al, '^'
  2346 00001A4F 0F84ED000000        <1> 		je near expnum
  2347 00001A55 E94DF7FFFF          <1> 		jmp nwcmd
  2348                              <1> 	resultnum1:
  2349 00001A5A 8B0D[4D1C0000]      <1> 		mov ecx, [result]
  2350 00001A60 EB9B                <1> 		jmp vrnm2
  2351                              <1> 	resultnum2:
  2352 00001A62 8B0D[4D1C0000]      <1> 		mov ecx, [result]
  2353 00001A68 EBC1                <1> 		jmp vrnm4
  2354 00001A6A 81EE[7A1B0000]      <1> 	varnum1: sub esi, buftxt
  2355 00001A70 89F7                <1> 		mov edi, esi
  2356 00001A72 81C6[7A1B0000]      <1> 		add esi, buftxt
  2357 00001A78 47                  <1> 		inc edi
  2358 00001A79 BB[6F150000]        <1> 		mov ebx, variables
  2359 00001A7E E8D2FEFFFF          <1> 		call nxtvrech
  2360 00001A83 89F7                <1> 		mov edi, esi
  2361 00001A85 4F                  <1> 		dec edi
  2362 00001A86 E966FFFFFF          <1> 		jmp varnum2
  2363 00001A8B 81EE[7A1B0000]      <1> 	varnum3: sub esi, buftxt
  2364 00001A91 89F7                <1> 		mov edi, esi
  2365 00001A93 81C6[7A1B0000]      <1> 		add esi, buftxt
  2366 00001A99 47                  <1> 		inc edi
  2367 00001A9A BB[6F150000]        <1> 		mov ebx, variables
  2368 00001A9F E8B1FEFFFF          <1> 		call nxtvrech
  2369 00001AA4 89F7                <1> 		mov edi, esi
  2370 00001AA6 4F                  <1> 		dec edi
  2371 00001AA7 E973FFFFFF          <1> 		jmp varnum4
  2372                              <1> 	checkdecimal2:
  2373 00001AAC 8A25[4B1C0000]      <1> 		mov ah, [decimal]
  2374 00001AB2 8825[4C1C0000]      <1> 		mov [decimal2], ah
  2375 00001AB8 B400                <1> 		mov ah, 0
  2376 00001ABA 8825[4B1C0000]      <1> 		mov [decimal], ah
  2377                              <1> 	checkdecimal:
  2378 00001AC0 89F7                <1> 		mov edi, esi
  2379                              <1> 	chkdec1:
  2380 00001AC2 8A07                <1> 		mov al, [edi]
  2381 00001AC4 3C2E                <1> 		cmp al, '.'
  2382 00001AC6 0F840B000000        <1> 		je near fnddec
  2383 00001ACC 3C00                <1> 		cmp al, 0
  2384 00001ACE 0F8419000000        <1> 		je near nodecimal
  2385 00001AD4 47                  <1> 		inc edi
  2386 00001AD5 EBEB                <1> 		jmp chkdec1
  2387                              <1> 	fnddec:
  2388 00001AD7 8A4701              <1> 		mov al, [edi + 1]
  2389 00001ADA 8807                <1> 		mov [edi], al
  2390 00001ADC 3C00                <1> 		cmp al, 0
  2391 00001ADE 0F8409000000        <1> 		je near nodecimal
  2392 00001AE4 FE05[4B1C0000]      <1> 		inc byte [decimal]
  2393 00001AEA 47                  <1> 		inc edi
  2394 00001AEB EBEA                <1> 		jmp fnddec
  2395                              <1> 	nodecimal:
  2396 00001AED C3                  <1> 		ret
  2397                              <1> 	plusnum:
  2398 00001AEE E816010000          <1> 		call decaddfix
  2399 00001AF3 01D9                <1> 		add ecx, ebx
  2400 00001AF5 E991000000          <1> 		jmp retnum
  2401                              <1> 	subnum:
  2402 00001AFA E80A010000          <1> 		call decaddfix
  2403 00001AFF 29D9                <1> 		sub ecx, ebx
  2404 00001B01 E985000000          <1> 		jmp retnum
  2405                              <1> 	mulnum:
  2406 00001B06 A0[4C1C0000]        <1> 		mov al, [decimal2]
  2407 00001B0B 0005[4B1C0000]      <1> 		add [decimal], al
  2408 00001B11 89C8                <1> 		mov eax, ecx
  2409 00001B13 F7E3                <1> 		mul ebx
  2410 00001B15 89C1                <1> 		mov ecx, eax
  2411 00001B17 E96F000000          <1> 		jmp retnum
  2412                              <1> 	divnum:
  2413 00001B1C E8E8000000          <1> 		call decaddfix
  2414 00001B21 B000                <1> 		mov al, 0
  2415 00001B23 A2[4B1C0000]        <1> 		mov [decimal], al
  2416 00001B28 6689C8              <1> 		mov ax, cx
  2417 00001B2B 80FB00              <1> 		cmp bl, 0
  2418 00001B2E 0F8457000000        <1> 		je near retnum
  2419 00001B34 F6F3                <1> 		div bl
  2420 00001B36 B900000000          <1> 		mov ecx, 0
  2421 00001B3B 88C1                <1> 		mov cl, al
  2422 00001B3D E949000000          <1> 		jmp retnum
  2423                              <1> 	expnum:
  2424 00001B42 8A15[4B1C0000]      <1> 		mov dl, [decimal]
  2425 00001B48 8815[4C1C0000]      <1> 		mov [decimal2], dl
  2426 00001B4E BA00000000          <1> 		mov edx, 0
  2427 00001B53 89C8                <1> 		mov eax, ecx
  2428 00001B55 89D9                <1> 		mov ecx, ebx
  2429 00001B57 89C3                <1> 		mov ebx, eax
  2430 00001B59 81F900000000        <1> 		cmp ecx, 0
  2431 00001B5F 7425                <1> 		je noexpnum
  2432 00001B61 49                  <1> 		dec ecx
  2433 00001B62 81F900000000        <1> 		cmp ecx, 0
  2434 00001B68 7415                <1> 		je noexpnumlp
  2435 00001B6A F7E3                <1> 	expnumlp: mul ebx
  2436 00001B6C 8A15[4C1C0000]      <1> 		mov dl, [decimal2]
  2437 00001B72 0015[4B1C0000]      <1> 		add [decimal], dl
  2438 00001B78 BA00000000          <1> 		mov edx, 0
  2439 00001B7D E2EB                <1> 		loop expnumlp
  2440                              <1> 	noexpnumlp:
  2441 00001B7F 89C1                <1> 		mov ecx, eax
  2442 00001B81 E905000000          <1> 		jmp retnum
  2443                              <1> 	noexpnum:
  2444 00001B86 B901000000          <1> 		mov ecx, 1
  2445                              <1> 	retnum: 
  2446 00001B8B BE[8E1C0000]        <1> 		mov esi, numbuf
  2447 00001B90 890D[4D1C0000]      <1> 		mov [result], ecx
  2448 00001B96 E8C2F8FFFF          <1> 		call convert
  2449 00001B9B BE[8E1C0000]        <1> 		mov esi, numbuf
  2450 00001BA0 8A25[4B1C0000]      <1> 		mov ah, [decimal]
  2451 00001BA6 80FC00              <1> 		cmp ah, 0
  2452 00001BA9 0F8425000000        <1> 		je near noputdecimal
  2453                              <1> 	putdecimal:
  2454 00001BAF 4E                  <1> 		dec esi
  2455 00001BB0 FECC                <1> 		dec ah
  2456 00001BB2 80FC00              <1> 		cmp ah, 0
  2457 00001BB5 0F87F4FFFFFF        <1> 		ja near putdecimal
  2458 00001BBB 4E                  <1> 		dec esi
  2459 00001BBC 8A06                <1> 		mov al, [esi]
  2460 00001BBE C6062E              <1> 		mov byte [esi], '.'
  2461                              <1> 	decputloop:
  2462 00001BC1 4E                  <1> 		dec esi
  2463 00001BC2 8A26                <1> 		mov ah, [esi]
  2464 00001BC4 8806                <1> 		mov [esi], al
  2465 00001BC6 88E0                <1> 		mov al, ah
  2466 00001BC8 81FE[7A1C0000]      <1> 		cmp esi, buf2
  2467 00001BCE 0F87EDFFFFFF        <1> 		ja near decputloop
  2468                              <1> 	noputdecimal:
  2469 00001BD4 BE[7A1C0000]        <1> 		mov esi, buf2
  2470 00001BD9 E809000000          <1> 		call chkadd
  2471 00001BDE E9C4F5FFFF          <1> 		jmp nwcmd
  2472 00001BE3 00000000            <1> edxnumbuf dw 0,0
  2473 00001BE7 8A06                <1> 	chkadd: mov al, [esi]
  2474 00001BE9 3C30                <1> 		cmp al, '0'
  2475 00001BEB 750C                <1> 		jne dnadd
  2476 00001BED 46                  <1> 		inc esi
  2477 00001BEE 81FE[8E1C0000]      <1> 		cmp esi, numbuf
  2478 00001BF4 7402                <1> 		je dnaddm1
  2479 00001BF6 EBEF                <1> 		jmp chkadd
  2480 00001BF8 4E                  <1> 	dnaddm1: dec esi
  2481 00001BF9 E854F0FFFF          <1> 	dnadd:	call print
  2482 00001BFE BE[8E6C0000]        <1> 		mov esi, line
  2483 00001C03 E84AF0FFFF          <1> 		call print
  2484 00001C08 C3                  <1> 		ret
  2485                              <1> 		
  2486                              <1> 	decaddfix:
  2487 00001C09 A0[4C1C0000]        <1> 		mov al, [decimal2]
  2488 00001C0E 8A25[4B1C0000]      <1> 		mov ah, [decimal]
  2489 00001C14 38E0                <1> 		cmp al, ah
  2490 00001C16 7432                <1> 		je gooddecadd
  2491 00001C18 38E0                <1> 		cmp al, ah
  2492 00001C1A 721A                <1> 		jb lowdecadd
  2493                              <1> 	highdecadd:
  2494 00001C1C FEC4                <1> 		inc ah
  2495 00001C1E 89CA                <1> 		mov edx, ecx
  2496 00001C20 C1E103              <1> 		shl ecx, 3
  2497 00001C23 01D1                <1> 		add ecx, edx
  2498 00001C25 01D1                <1> 		add ecx, edx
  2499 00001C27 38E0                <1> 		cmp al, ah
  2500 00001C29 77F1                <1> 		ja highdecadd
  2501 00001C2B 8825[4B1C0000]      <1> 		mov [decimal], ah
  2502 00001C31 E914000000          <1> 		jmp gooddecadd
  2503                              <1> 	lowdecadd:
  2504 00001C36 FEC0                <1> 		inc al
  2505 00001C38 89DA                <1> 		mov edx, ebx
  2506 00001C3A C1E303              <1> 		shl ebx, 3
  2507 00001C3D 01D3                <1> 		add ebx, edx
  2508 00001C3F 01D3                <1> 		add ebx, edx
  2509 00001C41 38E0                <1> 		cmp al, ah
  2510 00001C43 72F1                <1> 		jb lowdecadd
  2511 00001C45 A2[4B1C0000]        <1> 		mov [decimal], al
  2512                              <1> 	gooddecadd:
  2513 00001C4A C3                  <1> 		ret
  2514                              <1> 		
  2515 00001C4B 00                  <1> decimal db 0
  2516 00001C4C 00                  <1> decimal2 db 0
  2517 00001C4D 00000000            <1> result db 0,0,0,0
  2518                              <1> 	
  2519 00001C51 05042500            <1> db 5,4,"%",0
  2520 00001C55 E8EEF7FFFF          <1> 	ans:	call clearbuffer
  2521 00001C5A 8B0D[4D1C0000]      <1> 		mov ecx, [result]
  2522 00001C60 BE[7A1C0000]        <1> 		mov esi, buf2
  2523 00001C65 E8F3F7FFFF          <1> 		call convert
  2524 00001C6A BE[7A1C0000]        <1> 		mov esi, buf2
  2525 00001C6F E873FFFFFF          <1> 		call chkadd
  2526 00001C74 E92EF5FFFF          <1> 		jmp nwcmd
  2527                              <1> 
  2528 00001C79 05042400            <1> db 5,4,"$",0
  2529 00001C7D BE[7A1B0000]        <1> var: mov esi, buftxt
  2530 00001C82 BB[6F150000]        <1> 	mov ebx, variables
  2531 00001C87 8A06                <1> lkeq:	mov al, [esi]
  2532 00001C89 3C3D                <1> 	cmp al, '='
  2533 00001C8B 741F                <1> 	je eqfnd	;is there an '=' sign?
  2534 00001C8D 3C00                <1> 	cmp al, 0
  2535 00001C8F 7403                <1> 	je echovars
  2536 00001C91 46                  <1> 	inc esi
  2537 00001C92 EBF3                <1> 	jmp lkeq
  2538 00001C94 BE[6F150000]        <1> echovars: mov esi, variables
  2539 00001C99 BB[6F1A0000]        <1> 	mov ebx, varend
  2540 00001C9E B105                <1> 	mov cl, 5
  2541 00001CA0 B504                <1> 	mov ch, 4
  2542 00001CA2 E840F7FFFF          <1> 	call array
  2543 00001CA7 E9FBF4FFFF          <1> 	jmp nwcmd
  2544 00001CAC 46                  <1> eqfnd:	inc esi
  2545 00001CAD 8A06                <1> 	mov al, [esi]
  2546 00001CAF 3C00                <1> 	cmp al, 0
  2547 00001CB1 740F                <1> 	je readvar
  2548 00001CB3 BE[7A1B0000]        <1> 	mov esi, buftxt
  2549 00001CB8 BB[6F150000]        <1> 	mov ebx, variables
  2550 00001CBD E91E000000          <1> 	jmp seek
  2551                              <1> readvar:
  2552 00001CC2 B00D                <1> 	mov al, 13
  2553 00001CC4 66BB0700            <1> 	mov bx, 7
  2554 00001CC8 C605[A10C0000]00    <1> 	mov byte [commandedit], 0
  2555 00001CCF E8D6EFFFFF          <1> 	call int305
  2556 00001CD4 BE[8E6C0000]        <1> 	mov esi, line
  2557 00001CD9 E874EFFFFF          <1> 	call print
  2558 00001CDE EB9D                <1> 	jmp var
  2559 00001CE0 668B03              <1> seek:	mov ax, [ebx]
  2560 00001CE3 B105                <1> 	mov cl, 5
  2561 00001CE5 B504                <1> 	mov ch, 4
  2562 00001CE7 663D0000            <1> 	cmp ax, 0
  2563 00001CEB 0F8459000000        <1> 	je near save
  2564 00001CF1 6639C8              <1> 	cmp ax, cx
  2565 00001CF4 7403                <1> 	je skfnd
  2566 00001CF6 43                  <1> 	inc ebx
  2567 00001CF7 EBE7                <1> 	jmp seek
  2568 00001CF9 BE[7A1B0000]        <1> skfnd:	mov esi, buftxt
  2569 00001CFE 46                  <1> 	inc esi
  2570 00001CFF 81C302000000        <1> 	add ebx, 2
  2571 00001D05 89DF                <1> 	mov edi, ebx
  2572 00001D07 B13D                <1> 	mov cl, '='
  2573 00001D09 E817F6FFFF          <1> 	call cndtest
  2574 00001D0E 3C01                <1> 	cmp al, 1	
  2575 00001D10 7417                <1> 	je varfnd
  2576 00001D12 89FB                <1> 	mov ebx, edi
  2577 00001D14 BE[7A1B0000]        <1> 	mov esi, buftxt
  2578 00001D19 668B03              <1> 	mov ax, [ebx]
  2579 00001D1C 663D0000            <1> 	cmp ax, 0
  2580 00001D20 0F8424000000        <1> 	je near save
  2581 00001D26 43                  <1> 	inc ebx
  2582 00001D27 EBB7                <1> 	jmp seek
  2583 00001D29 8A03                <1> varfnd:	mov al, [ebx]
  2584 00001D2B 3C04                <1> 	cmp al, 4
  2585 00001D2D 7404                <1> 	je save2
  2586 00001D2F 4B                  <1> 	dec ebx
  2587 00001D30 4E                  <1> 	dec esi
  2588 00001D31 EBF6                <1> 	jmp varfnd
  2589 00001D33 4B                  <1> save2:	dec ebx
  2590 00001D34 4E                  <1> 	dec esi
  2591 00001D35 8A03                <1> 	mov al, [ebx]
  2592 00001D37 3C05                <1> 	cmp al, 5
  2593 00001D39 7402                <1> 	je remove
  2594 00001D3B EBEC                <1> 	jmp varfnd
  2595 00001D3D 8A03                <1> remove: mov al, [ebx]
  2596 00001D3F 3C00                <1> 	cmp al, 0
  2597 00001D41 749D                <1> 	je seek
  2598 00001D43 B000                <1> 	mov al, 0
  2599 00001D45 8803                <1> 	mov [ebx], al
  2600 00001D47 43                  <1> 	inc ebx
  2601 00001D48 EBF3                <1> 	jmp remove	;do not need for now-need defragmentation
  2602 00001D4A BE[7A1B0000]        <1> save:	mov esi, buftxt
  2603 00001D4F 43                  <1> 	inc ebx
  2604 00001D50 B005                <1> 	mov al, 5
  2605 00001D52 B404                <1> 	mov ah, 4
  2606 00001D54 668903              <1> 	mov [ebx], ax
  2607 00001D57 43                  <1> 	inc ebx
  2608 00001D58 43                  <1> svhere:	inc ebx
  2609 00001D59 46                  <1> 	inc esi
  2610 00001D5A 8A06                <1> 	mov al, [esi]
  2611 00001D5C 3C00                <1> 	cmp al, 0
  2612 00001D5E 0F8442000000        <1> 	je near svdone
  2613 00001D64 3C25                <1> 	cmp al, '%'
  2614 00001D66 7404                <1> 	je ans2
  2615 00001D68 8803                <1> 	mov [ebx], al	
  2616 00001D6A EBEC                <1> 	jmp svhere
  2617 00001D6C 56                  <1> ans2:	push esi
  2618 00001D6D BE[7A1C0000]        <1> 	mov esi, buf2
  2619 00001D72 E823000000          <1> 	call ansfnd
  2620 00001D77 E803000000          <1> 	call anscp
  2621 00001D7C 5E                  <1> 	pop esi
  2622 00001D7D EBD9                <1> 	jmp svhere
  2623 00001D7F 8A06                <1> anscp:	mov al, [esi]
  2624 00001D81 8803                <1> 	mov [ebx], al
  2625 00001D83 81FE[8E1C0000]      <1> 	cmp esi, numbuf
  2626 00001D89 74CD                <1> 	je svhere
  2627 00001D8B 3C00                <1> 	cmp al, 0
  2628 00001D8D 74C9                <1> 	je svhere
  2629 00001D8F 43                  <1> 	inc ebx
  2630 00001D90 46                  <1> 	inc esi
  2631 00001D91 EBEC                <1> 	jmp anscp
  2632 00001D93 5E                  <1> ansnf:	pop esi
  2633 00001D94 8A06                <1> 	mov al, [esi]
  2634 00001D96 8803                <1> 	mov [ebx], al
  2635 00001D98 EBBE                <1> 	jmp svhere
  2636 00001D9A 46                  <1> ansfnd:	inc esi
  2637 00001D9B 8A06                <1> 	mov al, [esi]
  2638 00001D9D 3C00                <1> 	cmp al, 0
  2639 00001D9F 74F2                <1> 	je ansnf
  2640 00001DA1 3C30                <1> 	cmp al, '0'
  2641 00001DA3 74F5                <1> 	je ansfnd
  2642 00001DA5 C3                  <1> 	ret
  2643 00001DA6 B000                <1> svdone:	mov al, 0
  2644 00001DA8 8803                <1> 	mov [ebx], al
  2645 00001DAA E9F8F3FFFF          <1> 	jmp nwcmd
  2646                              <1> 	
  2647 00001DAF 05046C6F676F757400  <1> 	db 5,4,"logout",0
  2648                              <1> logout:
  2649 00001DB8 E9D8F2FFFF          <1> 	jmp os
  2650                              <1> 	
  2651 00001DBD 05047265626F6F7400  <1> 	db 5,4,"reboot",0
  2652                              <1> rebootcomp:
  2653 00001DC6 E958E4FFFF          <1> 	jmp coldboot
  2654                              <1> 
  2655 00001DCB 050473687574646F77- <1> 	db 5,4,"shutdown",0
  2656 00001DD4 6E00                <1>
  2657                              <1> shutdowncomp:
  2658 00001DD6 E91EE4FFFF          <1> 	jmp shutdown
  2659                              <1> 	
  2660                              <1> 	
  2661 00001DDB 05042E2F00          <1> 	db 5,4,"./",0
  2662                              <1> rundiskprog:
  2663 00001DE0 BF[7A1B0000]        <1> 	mov edi, buftxt
  2664 00001DE5 81C702000000        <1> 	add edi, 2
  2665 00001DEB BE00004000          <1> 	mov esi, 0x400000
  2666 00001DF0 E8F7290000          <1> 	call loadfile
  2667 00001DF5 81FA94010000        <1> 	cmp edx, 404
  2668 00001DFB 7414                <1> 	je noprogfound
  2669 00001DFD BB00004000          <1> 	mov ebx, 0x400000
  2670 00001E02 66813B4558          <1> 	cmp word [ebx], "EX"
  2671 00001E07 7531                <1> 	jne progbatchfound
  2672 00001E09 81C302000000        <1> 	add ebx, 2
  2673 00001E0F FFE3                <1> 	jmp ebx
  2674                              <1> noprogfound:
  2675 00001E11 BE[556C0000]        <1> 	mov esi, notfound1
  2676 00001E16 E837EEFFFF          <1> 	call print
  2677 00001E1B BE[7A1B0000]        <1> 	mov esi, buftxt
  2678 00001E20 81C602000000        <1> 	add esi, 2
  2679 00001E26 E827EEFFFF          <1> 	call print
  2680 00001E2B BE[5F6C0000]        <1> 	mov esi, notfound2
  2681 00001E30 E81DEEFFFF          <1> 	call print
  2682 00001E35 E96DF3FFFF          <1> 	jmp nwcmd
  2683                              <1> progbatchfound:
  2684 00001E3A BF00004000          <1> 		mov edi, 0x400000
  2685 00001E3F C605[69130000]01    <1> 		mov byte [BATCHISON], 1
  2686                              <1> 	batchrunloop:
  2687 00001E46 E839F3FFFF          <1> 		call buftxtclear
  2688 00001E4B BE[7A1B0000]        <1> 		mov esi, buftxt
  2689                              <1> 	batchrunloop2:
  2690 00001E50 B10D                <1> 		mov cl, 13
  2691 00001E52 B50A                <1> 		mov ch, 10
  2692 00001E54 66390F              <1> 		cmp [edi], cx
  2693 00001E57 0F841E000000        <1> 		je near nxtbatchrunline
  2694 00001E5D 66C1C108            <1> 		rol cx, 8
  2695 00001E61 66390F              <1> 		cmp [edi], cx
  2696 00001E64 0F8411000000        <1> 		je near nxtbatchrunline
  2697 00001E6A 803F00              <1> 		cmp byte [edi], 0
  2698 00001E6D 0F8408000000        <1> 		je near nxtbatchrunline
  2699 00001E73 8A07                <1> 		mov al, [edi]
  2700 00001E75 8806                <1> 		mov [esi], al
  2701 00001E77 46                  <1> 		inc esi
  2702 00001E78 47                  <1> 		inc edi
  2703 00001E79 EBD5                <1> 		jmp batchrunloop2
  2704                              <1> 	nxtbatchrunline:
  2705 00001E7B 81C702000000        <1> 		add edi, 2
  2706 00001E81 893D[E01E0000]      <1> 		mov [batchedi], edi
  2707 00001E87 C60600              <1> 		mov byte [esi], 0
  2708 00001E8A BE[7A1B0000]        <1> 		mov esi, buftxt
  2709 00001E8F 803E00              <1> 		cmp byte [esi], 0
  2710 00001E92 0F843C000000        <1> 		je near nobatchfoundrun
  2711 00001E98 BB00000000          <1> 		mov ebx, 0
  2712 00001E9D 8A1D[00130000]      <1> 		mov bl, [IFON]
  2713 00001EA3 80FB01              <1> 		cmp bl, 1
  2714 00001EA6 0F8338000000        <1> 		jae near iftestbatch
  2715                              <1> 	doneiftest:
  2716 00001EAC 803D[A71F0000]00    <1> 		cmp byte [runnextline], 0
  2717 00001EB3 0F8405000000        <1> 		je near noruniftest
  2718 00001EB9 E8B4F3FFFF          <1> 		call progtest
  2719                              <1> 	noruniftest:
  2720 00001EBE C605[A71F0000]01    <1> 		mov byte [runnextline], 1
  2721 00001EC5 8B3D[E01E0000]      <1> 		mov edi, [batchedi]
  2722 00001ECB 803F00              <1> 		cmp byte [edi], 0
  2723 00001ECE 0F8572FFFFFF        <1> 		jne near batchrunloop
  2724                              <1> 	nobatchfoundrun:
  2725 00001ED4 C605[69130000]00    <1> 		mov byte [BATCHISON], 0
  2726 00001EDB E9C7F2FFFF          <1> 		jmp nwcmd
  2727                              <1> 	
  2728 00001EE0 00000000            <1> batchedi dd 0	
  2729                              <1> 	
  2730                              <1> 	iftestbatch:
  2731 00001EE4 BE[01130000]        <1> 		mov esi, IFTRUE
  2732 00001EE9 01DE                <1> 		add esi, ebx
  2733 00001EEB 803E00              <1> 		cmp byte [esi], 0
  2734 00001EEE 0F85B8FFFFFF        <1> 		jne near doneiftest
  2735 00001EF4 881D[A81F0000]      <1> 		mov [iffalsebuf], bl
  2736 00001EFA 803D[6A130000]01    <1> 		cmp byte [LOOPON], 1
  2737 00001F01 750B                <1> 		jne fifindbatch
  2738 00001F03 8B3D[6B130000]      <1> 		mov edi, [LOOPPOS]
  2739 00001F09 E938FFFFFF          <1> 		jmp batchrunloop
  2740                              <1> 	fifindbatch:
  2741 00001F0E 66B96966            <1> 		mov cx, "if"
  2742 00001F12 66B86669            <1> 		mov ax, "fi"
  2743 00001F16 663907              <1> 		cmp [edi], ax
  2744 00001F19 0F841A000000        <1> 		je near fifoundbatch
  2745 00001F1F 66390F              <1> 		cmp [edi], cx
  2746 00001F22 0F8462000000        <1> 		je near iffoundbatch
  2747 00001F28 803F00              <1> 		cmp byte [edi], 0
  2748 00001F2B 0F8408000000        <1> 		je near fifoundbatch
  2749 00001F31 81C702000000        <1> 		add edi, 2
  2750 00001F37 EBD5                <1> 		jmp fifindbatch
  2751                              <1> 	fifoundbatch:
  2752 00001F39 81C702000000        <1> 		add edi, 2
  2753 00001F3F B00D                <1> 		mov al, 13
  2754 00001F41 B40A                <1> 		mov ah, 10
  2755 00001F43 663907              <1> 		cmp [edi], ax
  2756 00001F46 7414                <1> 		je goodfibatch
  2757 00001F48 66C1C008            <1> 		rol ax, 8
  2758 00001F4C 663907              <1> 		cmp [edi], ax
  2759 00001F4F 740B                <1> 		je goodfibatch
  2760 00001F51 803F00              <1> 		cmp byte [edi], 0
  2761 00001F54 0F847AFFFFFF        <1> 		je near nobatchfoundrun
  2762 00001F5A EBB2                <1> 		jmp fifindbatch
  2763                              <1> 	goodfibatch:
  2764 00001F5C B001                <1> 		mov al, 1
  2765 00001F5E 2805[00130000]      <1> 		sub [IFON], al 
  2766 00001F64 A0[00130000]        <1> 		mov al, [IFON]
  2767 00001F69 8A1D[A81F0000]      <1> 		mov bl, [iffalsebuf]
  2768 00001F6F 38D8                <1> 		cmp al, bl
  2769 00001F71 779B                <1> 		ja fifindbatch
  2770 00001F73 BE[7A1B0000]        <1> 		mov esi, buftxt
  2771 00001F78 81EF02000000        <1> 		sub edi, 2
  2772 00001F7E C605[A71F0000]00    <1> 		mov byte [runnextline], 0
  2773 00001F85 E9BCFEFFFF          <1> 		jmp batchrunloop
  2774                              <1> 	iffoundbatch:
  2775 00001F8A B020                <1> 		mov al, ' '
  2776 00001F8C 81C702000000        <1> 		add edi, 2
  2777 00001F92 3807                <1> 		cmp [edi], al
  2778 00001F94 0F8574FFFFFF        <1> 		jne near fifindbatch
  2779 00001F9A B001                <1> 		mov al, 1
  2780 00001F9C 0005[00130000]      <1> 		add [IFON], al
  2781 00001FA2 E967FFFFFF          <1> 		jmp fifindbatch
  2782                              <1> 		
  2783                              <1> 		
  2784 00001FA7 01                  <1> runnextline db 1
  2785 00001FA8 00                  <1> iffalsebuf db 0
  2786                              <1> 
  2787 00001FA9 E9F9F1FFFF          <1> notbatch: jmp nwcmd
  2788                              <1> 
  2789 00001FAE 05047768696C6500    <1> 	db 5,4,"while",0
  2790 00001FB6 B000                <1> whilecmd:  mov al, 0
  2791 00001FB8 3805[69130000]      <1> 	cmp [BATCHISON], al
  2792 00001FBE 0F84E5FFFFFF        <1> 	je near notbatch
  2793 00001FC4 8B35[65130000]      <1> 	MOV esi, [BATCHPOS]
  2794 00001FCA 4E                  <1> whilefnd: dec esi
  2795 00001FCB 8A06                <1> 	mov al, [esi]
  2796 00001FCD 3C0A                <1> 	cmp al, 10
  2797 00001FCF 0F8412000000        <1> 	je near whilefnd2
  2798 00001FD5 3C0D                <1> 	cmp al, 13
  2799 00001FD7 0F840A000000        <1> 	je near whilefnd2
  2800 00001FDD 3C00                <1> 	cmp al, 0
  2801 00001FDF 0F8402000000        <1> 	je near whilefnd2
  2802 00001FE5 EBE3                <1> 	jmp whilefnd
  2803                              <1> whilefnd2:
  2804 00001FE7 8935[6B130000]      <1> 	mov [LOOPPOS], esi
  2805 00001FED C605[6A130000]01    <1> 	mov BYTE [LOOPON], 1
  2806 00001FF4 0005[00130000]      <1> 	add [IFON], al
  2807 00001FFA BE[7A1B0000]        <1> 	mov esi, buftxt
  2808 00001FFF BB[7A1B0000]        <1> 	mov ebx, buftxt
  2809 00002004 81C306000000        <1> 	add ebx, 6
  2810 0000200A E923000000          <1> 	jmp chkeqsn
  2811                              <1> 
  2812                              <1> 
  2813 0000200F 0504696600          <1> 	db 5,4,"if",0
  2814 00002014 B000                <1> ifcmd:	mov al, 0
  2815 00002016 3805[69130000]      <1> 	cmp [BATCHISON], al
  2816 0000201C 0F8487FFFFFF        <1> 	je near notbatch
  2817 00002022 BE[7A1B0000]        <1> 	mov esi, buftxt
  2818 00002027 BB[7A1B0000]        <1> 	mov ebx, buftxt
  2819 0000202C 81C303000000        <1> 	add ebx, 3
  2820 00002032 8A06                <1> chkeqsn: mov al, [esi]
  2821 00002034 3C00                <1> 	cmp al, 0
  2822 00002036 0F846DFFFFFF        <1> 	je near notbatch
  2823 0000203C 3C3D                <1> 	cmp al, '='
  2824 0000203E 0F8403000000        <1> 	je near chkeqdn
  2825 00002044 46                  <1> 	inc esi
  2826 00002045 EBEB                <1> 	jmp chkeqsn
  2827 00002047 B000                <1> chkeqdn: mov al, 0 
  2828 00002049 8806                <1> 	mov [esi], al
  2829 0000204B 46                  <1> 	inc esi
  2830 0000204C 8A06                <1> 	mov al, [esi]
  2831 0000204E 3C24                <1> 	cmp al, '$'
  2832 00002050 0F8462000000        <1> 	je near ifvar1
  2833 00002056 8A03                <1> ifvar2: mov al, [ebx]
  2834 00002058 3C24                <1> 	cmp al, '$'
  2835 0000205A 0F847B000000        <1> 	je near ifvar3
  2836 00002060 E886F2FFFF          <1> ifvar4:	call tester
  2837 00002065 3C01                <1> 	cmp al, 1
  2838 00002067 0F8405000000        <1> 	je near trueif
  2839 0000206D E923000000          <1> 	jmp falseif
  2840 00002072 B800000000          <1> trueif:	mov eax, 0
  2841 00002077 A0[00130000]        <1> 	mov al, [IFON]
  2842 0000207C FEC0                <1> 	inc al
  2843 0000207E A2[00130000]        <1> 	mov [IFON], al
  2844 00002083 B400                <1> 	mov ah, 0
  2845 00002085 BE[01130000]        <1> 	mov esi, IFTRUE
  2846 0000208A 01C6                <1> 	add esi, eax
  2847 0000208C B401                <1> 	mov ah, 1
  2848 0000208E 8826                <1> 	mov [esi], ah
  2849 00002090 E912F1FFFF          <1> 	jmp nwcmd
  2850 00002095 B800000000          <1> falseif: mov eax, 0
  2851 0000209A A0[00130000]        <1> 	mov al, [IFON]
  2852 0000209F FEC0                <1> 	inc al
  2853 000020A1 A2[00130000]        <1> 	mov [IFON], al
  2854 000020A6 B400                <1> 	mov ah, 0
  2855 000020A8 BE[01130000]        <1> 	mov esi, IFTRUE
  2856 000020AD 01C6                <1> 	add esi, eax
  2857 000020AF B400                <1> 	mov ah, 0
  2858 000020B1 8826                <1> 	mov [esi], ah
  2859 000020B3 E9EFF0FFFF          <1> 	jmp nwcmd
  2860 000020B8 89F7                <1> ifvar1: mov edi, esi
  2861 000020BA 81EF[7A1B0000]      <1> 	sub edi, buftxt
  2862 000020C0 47                  <1> 	inc edi
  2863 000020C1 BB[6F150000]        <1> 	mov ebx, variables
  2864 000020C6 E88AF8FFFF          <1> 	call nxtvrech
  2865 000020CB BB[7A1B0000]        <1> 	mov ebx, buftxt
  2866 000020D0 81C303000000        <1> 	add ebx, 3
  2867 000020D6 E97BFFFFFF          <1> 	jmp ifvar2
  2868 000020DB 8935[FB200000]      <1> ifvar3: mov [esiif], esi
  2869 000020E1 BF04000000          <1> 	mov edi, 4
  2870 000020E6 BB[6F150000]        <1> 	mov ebx, variables
  2871 000020EB E865F8FFFF          <1> 	call nxtvrech
  2872 000020F0 8B35[FB200000]      <1> 	mov esi, [esiif]
  2873 000020F6 E965FFFFFF          <1> 	jmp ifvar4
  2874                              <1> 
  2875 000020FB 00000000            <1> esiif dd 0
  2876                              <1> 	
  2877 000020FF 0504656C736500      <1> 	db 5,4,"else",0
  2878 00002106 B800000000          <1> elsecmd:	mov eax, 0
  2879 0000210B A0[00130000]        <1> 	mov al, [IFON]
  2880 00002110 BE[01130000]        <1> 	mov esi, IFTRUE
  2881 00002115 01C6                <1> 	add esi, eax
  2882 00002117 8A06                <1> 	mov al, [esi]
  2883 00002119 3C00                <1> 	cmp al, 0		
  2884 0000211B 7409                <1> 	je else1
  2885 0000211D 3C01                <1> 	cmp al, 1
  2886 0000211F 740E                <1> 	je else2
  2887 00002121 E981F0FFFF          <1> 	jmp nwcmd
  2888 00002126 B001                <1> else1:  mov al, 1
  2889 00002128 8806                <1> 	mov [esi], al
  2890 0000212A E978F0FFFF          <1> 	jmp nwcmd
  2891 0000212F B000                <1> else2:	mov al, 0
  2892 00002131 8806                <1> 	mov [esi], al
  2893 00002133 E96FF0FFFF          <1> 	jmp nwcmd
  2894                              <1> 
  2895 00002138 05046C6F6F7000      <1> 	db 5,4,"loop",0
  2896 0000213F 3805[6A130000]      <1> 	cmp [LOOPON], al
  2897 00002145 0F8405000000        <1> 	je near filoop
  2898 0000214B E957F0FFFF          <1> 	jmp nwcmd
  2899 00002150 8B35[6B130000]      <1> filoop: mov esi, [LOOPPOS]
  2900 00002156 8935[65130000]      <1> 	mov [BATCHPOS], esi
  2901 0000215C E946F0FFFF          <1> 	jmp nwcmd
  2902                              <1> 	
  2903                              <1> 
  2904 00002161 0504666900          <1> 	db 5,4,"fi",0
  2905 00002166 B000                <1> 	mov al, 0
  2906 00002168 3805[69130000]      <1> 	cmp [BATCHISON], al
  2907 0000216E 0F8435FEFFFF        <1> 	je near notbatch
  2908 00002174 B001                <1> fi:	mov al, 1
  2909 00002176 2805[00130000]      <1> 	sub [IFON],al
  2910 0000217C E926F0FFFF          <1> 	jmp nwcmd
  2911                              <1> 
  2912 00002181 050473746F7000      <1> 	db 5,4,"stop",0
  2913 00002188 B000                <1> stop:	mov al, 0
  2914 0000218A A2[69130000]        <1> 	mov [BATCHISON], al
  2915 0000218F A2[00130000]        <1> 	mov [IFON], al
  2916 00002194 A2[01130000]        <1> 	mov [IFTRUE], al
  2917 00002199 A2[6A130000]        <1> 	mov [LOOPON], al
  2918 0000219E E904F0FFFF          <1> 	jmp nwcmd
  2919                                      %include 'source/programs.asm'
  2920                              <1> ;db 5,4,"internet",0
  2921                              <1> 	internettest: 			;;initialize network card, lets hope this is right
  2922                              <1> 							;;^^used to^^, now tests int 30h functions		
  2923 000021A3 B403                <1> 		mov ah, 3
  2924 000021A5 CD30                <1> 		int 30h
  2925 000021A7 B401                <1> 		mov ah, 1
  2926                              <1> 		;mov esi, datmsg
  2927 000021A9 66BB0700            <1> 		mov bx, 7
  2928 000021AD B000                <1> 		mov al, 0
  2929 000021AF CD30                <1> 		int 30h
  2930                              <1> 	    ;jmp packettest
  2931 000021B1 E9F1EFFFFF          <1> 		jmp nwcmd
  2932                              <1> ;datmsg: db "Internet has not been implemented yet.",10,13,0
  2933                              <1> 	
  2934 000021B6 050474687265616473- <1> db 5,4,"threads",0
  2935 000021BF 00                  <1>
  2936 000021C0 90                  <1> 	nop
  2937 000021C1 90                  <1> 	nop
  2938 000021C2 E9DB270000          <1> 	jmp threadstarttest
  2939 000021C7 E9DBEFFFFF          <1> 	jmp nwcmd
  2940                              <1> 	
  2941 000021CC 0504636861726D6170- <1> db 5,4,"charmap",0
  2942 000021D5 00                  <1>
  2943 000021D6 B000                <1> 	mov al, 0
  2944 000021D8 66BB0700            <1> 	mov bx, 7
  2945                              <1> charmapcopy:
  2946 000021DC FEC0                <1> 	inc al
  2947 000021DE 3C08                <1> 	cmp al, 8
  2948 000021E0 74FA                <1> 	je charmapcopy
  2949 000021E2 3C0A                <1> 	cmp al, 10
  2950 000021E4 74F6                <1> 	je charmapcopy
  2951 000021E6 3C0D                <1> 	cmp al, 13
  2952 000021E8 74F2                <1> 	je charmapcopy
  2953 000021EA 3C81                <1> 	cmp al, 129
  2954 000021EC 7307                <1> 	jae nomorecharmap
  2955 000021EE E884E8FFFF          <1> 	call int301prnt
  2956 000021F3 EBE7                <1> 	jmp charmapcopy
  2957                              <1> nomorecharmap:
  2958 000021F5 BE[8E6C0000]        <1> 	mov esi, line
  2959 000021FA E853EAFFFF          <1> 	call print
  2960 000021FF E9A3EFFFFF          <1> 	jmp nwcmd
  2961                              <1> 	
  2962 00002204 05046B6579636F6465- <1> db 5,4,"keycode",0
  2963 0000220D 00                  <1>
  2964                              <1> keycode:
  2965 0000220E E880060000          <1> 	call guistartin
  2966 00002213 B800000000          <1> 	mov eax, 0
  2967 00002218 66A1[0E0C0000]      <1> 	mov ax, [lastkey]
  2968 0000221E 80FC01              <1> 	cmp ah, 1
  2969 00002221 0F840E000000        <1> 	je near killkeycode
  2970 00002227 B900000000          <1> 	mov ecx, 0
  2971 0000222C 88E1                <1> 	mov cl, ah
  2972 0000222E E8A8F3FFFF          <1> 	call showhexsmall
  2973 00002233 EBD9                <1> 	jmp keycode
  2974                              <1> killkeycode:
  2975 00002235 BE[8E6C0000]        <1> 	mov esi, line
  2976 0000223A E813EAFFFF          <1> 	call print
  2977 0000223F E963EFFFFF          <1> 	jmp nwcmd
  2978                              <1> 
  2979 00002244 050470636900        <1> db 5,4,"pci",0
  2980                              <1> 	pcishow:
  2981 0000224A E8E3230000          <1> 	call pcidump
  2982 0000224F E953EFFFFF          <1> 	jmp nwcmd
  2983                              <1> 	
  2984 00002254 050461727000        <1> db 5,4,"arp",0
  2985 0000225A E8CE220000          <1> 	call arptest
  2986 0000225F E943EFFFFF          <1> 	jmp nwcmd
  2987                              <1> 
  2988 00002264 0504626174636800    <1> db 5,4,"batch",0
  2989                              <1> 	batchst: 
  2990 0000226C BF[7A1B0000]        <1> 		mov edi, buftxt
  2991 00002271 81C706000000        <1> 		add edi, 6
  2992 00002277 803F00              <1> 		cmp byte [edi], 0
  2993 0000227A 0F8473000000        <1> 		je near nonamefound
  2994 00002280 BE00004000          <1> 		mov esi, 0x400000
  2995 00002285 E862250000          <1> 		call loadfile
  2996 0000228A 89D0                <1> 		mov eax, edx
  2997 0000228C 3D94010000          <1> 		cmp eax, 404
  2998 00002291 746F                <1> 		je goodbatchname
  2999 00002293 BE[A2220000]        <1> 		mov esi, badbatchname
  3000 00002298 E8B5E9FFFF          <1> 		call print
  3001 0000229D E905EFFFFF          <1> 		jmp nwcmd
  3002 000022A2 546869732066696C65- <1> 		badbatchname db "This file already exists!",10,13,0
  3003 000022AB 20616C726561647920- <1>
  3004 000022B4 657869737473210A0D- <1>
  3005 000022BD 00                  <1>
  3006 000022BE 596F75206861766520- <1> 		namenotfoundbatch db "You have to type a name after the command.",10,13,0
  3007 000022C7 746F20747970652061- <1>
  3008 000022D0 206E616D6520616674- <1>
  3009 000022D9 65722074686520636F- <1>
  3010 000022E2 6D6D616E642E0A0D00  <1>
  3011 000022EB 00000000            <1> 		esicache3 dd 0
  3012 000022EF 00000000            <1> 		esicache2 dd 0
  3013                              <1> 	nonamefound:
  3014 000022F3 BE[BE220000]        <1> 		mov esi, namenotfoundbatch
  3015 000022F8 E855E9FFFF          <1> 		call print
  3016 000022FD E9A5EEFFFF          <1> 		jmp nwcmd
  3017                              <1> 	goodbatchname:
  3018 00002302 BE00004000          <1> 		mov esi, 0x400000
  3019                              <1> 	batchcreate:
  3020 00002307 8935[EB220000]      <1> 		mov [esicache3], esi
  3021 0000230D B00D                <1> 		mov al, 13
  3022 0000230F B307                <1> 		mov bl, 7
  3023 00002311 B404                <1> 		mov ah, 4
  3024 00002313 CD30                <1> 		int 30h
  3025 00002315 8935[EF220000]      <1> 		mov [esicache2], esi
  3026 0000231B 8A0E                <1> 		mov cl, [esi]
  3027 0000231D 8B35[EB220000]      <1> 		mov esi, [esicache3]
  3028 00002323 BB[7A230000]        <1> 		mov ebx, exitword
  3029 00002328 E8F8EFFFFF          <1> 		call cndtest
  3030 0000232D 3C01                <1> 		cmp al, 1
  3031 0000232F 7423                <1> 		je endbatchcreate
  3032 00002331 3C02                <1> 		cmp al, 2
  3033 00002333 741F                <1> 		je endbatchcreate
  3034 00002335 BE[8E6C0000]        <1> 		mov esi, line
  3035 0000233A E813E9FFFF          <1> 		call print
  3036 0000233F 8B35[EF220000]      <1> 		mov esi, [esicache2]
  3037 00002345 B00D                <1> 		mov al, 13
  3038 00002347 B40A                <1> 		mov ah, 10
  3039 00002349 668906              <1> 		mov [esi], ax
  3040 0000234C 81C602000000        <1> 		add esi, 2
  3041 00002352 EBB3                <1> 		jmp batchcreate
  3042                              <1> 	endbatchcreate:
  3043 00002354 8B35[EB220000]      <1> 		mov esi, [esicache3]
  3044 0000235A B800000000          <1> 		mov eax, 0
  3045 0000235F 8806                <1> 		mov [esi], al
  3046 00002361 BE[8E6C0000]        <1> 		mov esi, line
  3047 00002366 E8E7E8FFFF          <1> 		call print
  3048 0000236B BE00004000          <1> 		mov esi, 0x400000
  3049 00002370 E8DDE8FFFF          <1> 		call print
  3050 00002375 E92DEEFFFF          <1> 		jmp nwcmd
  3051                              <1> 	
  3052 0000237A 5C7800              <1> 	exitword db "\x",0
  3053 0000237D 54797065205C782074- <1> 	wordmsg db "Type \x to exit.",10,13,0
  3054 00002386 6F20657869742E0A0D- <1>
  3055 0000238F 00                  <1>
  3056                              <1> 		
  3057 00002390 050473686F7700      <1> db 5,4,"show",0
  3058 00002397 BF[7A1B0000]        <1> 		mov edi, buftxt
  3059 0000239C 81C705000000        <1> 		add edi, 5
  3060 000023A2 BE00004000          <1> 		mov esi, 0x400000
  3061 000023A7 E840240000          <1> 		call loadfile
  3062 000023AC BE00004000          <1> 		mov esi, 0x400000
  3063 000023B1 66813E424D          <1> 		cmp word [esi], "BM"
  3064 000023B6 7414                <1> 		je bmpfound
  3065 000023B8 E895E8FFFF          <1> 		call print
  3066 000023BD BE[8E6C0000]        <1> 		mov esi, line
  3067 000023C2 E88BE8FFFF          <1> 		call print
  3068 000023C7 E9DBEDFFFF          <1> 		jmp nwcmd
  3069                              <1> bmpfound:
  3070 000023CC 803D[782E0000]00    <1> 		cmp byte [guion], 0
  3071 000023D3 0F8452000000        <1> 		je near noguibmp
  3072 000023D9 BE00004000          <1> 		mov esi, 0x400000
  3073 000023DE B900000000          <1> 		mov ecx, 0
  3074 000023E3 BA00000000          <1> 		mov edx, 0
  3075 000023E8 B800000000          <1> 		mov eax, 0
  3076 000023ED BB00000000          <1> 		mov ebx, 0
  3077 000023F2 E8941A0000          <1> 		call showbmp
  3078 000023F7 B000                <1> 		mov al, 0
  3079 000023F9 B405                <1> 		mov ah, 5
  3080 000023FB CD30                <1> 		int 30h
  3081 000023FD E8DD080000          <1> 		call guiclear
  3082 00002402 E8720A0000          <1> 		call clearmousecursor
  3083 00002407 E8F0100000          <1> 		call reloadallgraphics
  3084 0000240C BE[7A1B0000]        <1> 		mov esi, buftxt
  3085 00002411 81C605000000        <1> 		add esi, 5
  3086 00002417 E836E8FFFF          <1> 		call print
  3087 0000241C BE[AE240000]        <1> 		mov esi, loadedbmpmsg
  3088 00002421 E82CE8FFFF          <1> 		call print
  3089 00002426 E97CEDFFFF          <1> 		jmp nwcmd
  3090                              <1> noguibmp:
  3091 0000242B BE[3A240000]        <1> 		mov esi, warnguibmp
  3092 00002430 E81DE8FFFF          <1> 		call print
  3093 00002435 E96DEDFFFF          <1> 		jmp nwcmd
  3094 0000243A 546869732063616E20- <1> warnguibmp db "This can not be done without the gui.",10,13,0
  3095 00002443 6E6F7420626520646F- <1>
  3096 0000244C 6E6520776974686F75- <1>
  3097 00002455 742074686520677569- <1>
  3098 0000245E 2E0A0D00            <1>
  3099                              <1> 
  3100                              <1> 		
  3101                              <1> filenotfound:
  3102 00002462 BE[8B240000]        <1> 		mov esi, filenf
  3103 00002467 E8E6E7FFFF          <1> 		call print
  3104 0000246C BE[7A1B0000]        <1> 		mov esi, buftxt
  3105 00002471 81C608000000        <1> 		add esi, 8
  3106 00002477 E8D6E7FFFF          <1> 		call print
  3107 0000247C BE[96240000]        <1> 		mov esi, filenf2
  3108 00002481 E8CCE7FFFF          <1> 		call print
  3109 00002486 E91CEDFFFF          <1> 		jmp nwcmd
  3110 0000248B 5468652066696C6520- <1> filenf db "The file ",34,0
  3111 00002494 2200                <1>
  3112 00002496 2220636F756C64206E- <1> filenf2 db 34," could not be found.",13,10,0
  3113 0000249F 6F7420626520666F75- <1>
  3114 000024A8 6E642E0D0A00        <1>
  3115                              <1> 		
  3116 000024AE 206C6F616465642E0D- <1> loadedbmpmsg db " loaded.",13,10,0
  3117 000024B7 0A00                <1>
  3118                              <1> 
  3119 000024B9 050464756D7000      <1> 	db 5,4,"dump",0
  3120 000024C0 BE[7A1B0000]        <1> 	mov esi, buftxt
  3121 000024C5 81C605000000        <1> 	add esi, 5
  3122 000024CB B900000000          <1> 	mov ecx, 0
  3123 000024D0 E859F2FFFF          <1> 	call cnvrttxt
  3124 000024D5 89CF                <1> 	mov edi, ecx
  3125 000024D7 89FE                <1> 	mov esi, edi
  3126 000024D9 81C680030000        <1> 	add esi, 896
  3127 000024DF C605[DA150000]00    <1> 	mov byte [firsthexshown],0
  3128                              <1> dumphexloop:
  3129 000024E6 8B0F                <1> 	mov ecx, [edi]
  3130 000024E8 E802F1FFFF          <1> 	call showhex
  3131 000024ED 81C704000000        <1> 	add edi, 4
  3132 000024F3 39F7                <1> 	cmp edi, esi
  3133 000024F5 72EF                <1> 	jb dumphexloop
  3134 000024F7 E9ABECFFFF          <1> 	jmp nwcmd
  3135                              <1> 
  3136 000024FC 050474696D6500      <1> db 5,4,"time",0
  3137 00002503 E823000000          <1> 	call time
  3138 00002508 BE[15270000]        <1> 	mov esi, timeshow
  3139 0000250D E840E7FFFF          <1> 	call print
  3140 00002512 BE[8E6C0000]        <1> 	mov esi, line
  3141 00002517 E836E7FFFF          <1> 	call print
  3142 0000251C BE[1F270000]        <1> 	mov esi, dateshow
  3143 00002521 E82CE7FFFF          <1> 	call print
  3144 00002526 E97CECFFFF          <1> 	jmp nwcmd
  3145                              <1> 	time:
  3146 0000252B E86D010000          <1> 	call tstackput1
  3147 00002530 B00A                <1> 	mov al,10			;Get RTC register A
  3148 00002532 E897010000          <1> 	call tget1
  3149 00002537 A880                <1> 	test al,0x80			;Is update in progress?
  3150 00002539 75F0                <1> 	jne time				; yes, wait
  3151                              <1> 
  3152 0000253B B000                <1> 	mov al,0			;Get seconds (00 to 59)
  3153 0000253D E88C010000          <1> 	call tget1
  3154 00002542 A2[0C270000]        <1> 	mov [RTCtimeSecond],al
  3155                              <1> 
  3156 00002547 B002                <1> 	mov al,0x02			;Get minutes (00 to 59)
  3157 00002549 E880010000          <1> 	call tget1
  3158 0000254E A2[0D270000]        <1> 	mov [RTCtimeMinute],al
  3159                              <1> 
  3160 00002553 B004                <1> 	mov al,0x04			;Get hours (see notes)
  3161 00002555 E874010000          <1> 	call tget1
  3162 0000255A A2[0E270000]        <1> 	mov [RTCtimeHour],al
  3163                              <1> 
  3164 0000255F B007                <1> 	mov al,0x07			;Get day of month (01 to 31)
  3165 00002561 E868010000          <1> 	call tget1
  3166                              <1> ;	mov ah, 0			;;fix day
  3167                              <1> ;	mov ah, al
  3168                              <1> ;	shr ah, 4
  3169                              <1> ;	shl al, 4
  3170                              <1> ;	shr al, 4
  3171                              <1> ;	cmp al, 0
  3172                              <1> ;	jne nodecahday
  3173                              <1> ;	mov al, 10
  3174                              <1> ;	dec ah
  3175                              <1> ;nodecahday:
  3176                              <1> ;	dec al
  3177                              <1> ;	shl ah, 4
  3178                              <1> ;	or al, ah
  3179 00002566 A2[0F270000]        <1> 	mov [RTCtimeDay],al
  3180                              <1> 
  3181 0000256B B008                <1> 	mov al,0x08			;Get month (01 to 12)
  3182 0000256D E85C010000          <1> 	call tget1
  3183 00002572 A2[10270000]        <1> 	mov [RTCtimeMonth],al
  3184                              <1> 
  3185 00002577 B009                <1> 	mov al,0x09			;Get year (00 to 99)
  3186 00002579 E850010000          <1> 	call tget1
  3187 0000257E A2[11270000]        <1> 	mov [RTCtimeYear],al
  3188                              <1> 	
  3189 00002583 BE[15270000]        <1> 	mov esi, timeshow
  3190 00002588 8A2D[0E270000]      <1> 	mov ch, [RTCtimeHour]
  3191 0000258E E846010000          <1> 	call tput1
  3192 00002593 8A2D[0D270000]      <1> 	mov ch, [RTCtimeMinute]
  3193 00002599 E83B010000          <1> 	call tput1
  3194 0000259E 8A2D[0C270000]      <1> 	mov ch, [RTCtimeSecond]
  3195 000025A4 E830010000          <1> 	call tput1
  3196 000025A9 BE[1F270000]        <1> 	mov esi, dateshow
  3197 000025AE 8A2D[10270000]      <1> 	mov ch, [RTCtimeMonth]
  3198 000025B4 E820010000          <1> 	call tput1
  3199 000025B9 8A2D[0F270000]      <1> 	mov ch, [RTCtimeDay]
  3200 000025BF E815010000          <1> 	call tput1
  3201 000025C4 B520                <1> 	mov ch, 0x20
  3202 000025C6 E80E010000          <1> 	call tput1
  3203 000025CB 4E                  <1> 	dec esi
  3204 000025CC 8A2D[11270000]      <1> 	mov ch, [RTCtimeYear]
  3205 000025D2 E802010000          <1> 	call tput1
  3206 000025D7 E8DB000000          <1> 	call tstackget1
  3207 000025DC BE[15270000]        <1> 	mov esi, timeshow
  3208 000025E1 66BB0700            <1> 	mov bx, 7
  3209 000025E5 B401                <1> 	mov ah, 1
  3210 000025E7 B000                <1> 	mov al, 0
  3211 000025E9 CD30                <1> 	int 30h
  3212                              <1> ;;get day of week
  3213                              <1> ;;add these:
  3214                              <1> ;;century value
  3215                              <1> ;;last 2 digits of year
  3216                              <1> ;;last 2 digits of year right shifted twice
  3217                              <1> ;;month table value
  3218                              <1> ;;day of the month
  3219                              <1> ;;divide these by 7
  3220                              <1> ;;the remainder is the day
  3221 000025EB B800000000          <1> 	mov eax, 0
  3222                              <1> ;;first convert the values from BCD to hex
  3223 000025F0 A0[0F270000]        <1> 	mov al, [RTCtimeDay]
  3224 000025F5 E88A000000          <1> 	call converttohex
  3225 000025FA 8825[12270000]      <1> 	mov [dayhex], ah
  3226 00002600 A0[10270000]        <1> 	mov al, [RTCtimeMonth]
  3227 00002605 E87A000000          <1> 	call converttohex
  3228 0000260A 8825[13270000]      <1> 	mov [monthhex], ah
  3229 00002610 A0[11270000]        <1> 	mov al, [RTCtimeYear]
  3230 00002615 E86A000000          <1> 	call converttohex
  3231 0000261A 8825[14270000]      <1> 	mov [yearhex], ah
  3232 00002620 B800000000          <1> 	mov eax, 0
  3233 00002625 A0[14270000]        <1> 	mov al, [yearhex]
  3234 0000262A C0E802              <1> 	shr al, 2
  3235 0000262D 0205[14270000]      <1> 	add al, [yearhex]
  3236 00002633 0506000000          <1> 	add eax, 6
  3237 00002638 BB00000000          <1> 	mov ebx, 0
  3238 0000263D 8A1D[13270000]      <1> 	mov bl, [monthhex]
  3239 00002643 FECB                <1> 	dec bl
  3240 00002645 81C3[35270000]      <1> 	add ebx, month
  3241 0000264B B900000000          <1> 	mov ecx, 0
  3242 00002650 8A0B                <1> 	mov cl, [ebx]
  3243 00002652 01C8                <1> 	add eax, ecx
  3244 00002654 8A0D[12270000]      <1> 	mov cl, [dayhex]
  3245 0000265A 01C8                <1> 	add eax, ecx
  3246 0000265C 66BB0700            <1> 	mov bx, 7
  3247 00002660 BA00000000          <1> 	mov edx, 0
  3248 00002665 66F7F3              <1> 	div bx
  3249 00002668 C1E202              <1> 	shl edx, 2
  3250 0000266B 81C2[41270000]      <1> 	add edx, day
  3251 00002671 8B32                <1> 	mov esi, [edx]
  3252 00002673 66BB0700            <1> 	mov bx, 7
  3253 00002677 B401                <1> 	mov ah, 1
  3254 00002679 B000                <1> 	mov al, 0
  3255 0000267B CD30                <1> 	int 30h
  3256 0000267D 66B80000            <1> 	mov ax, 0
  3257 00002681 CD30                <1> 	int 30h
  3258 00002683 F4                  <1> 	hlt
  3259                              <1> 	
  3260                              <1> converttohex:
  3261 00002684 88C4                <1> 	mov ah, al
  3262 00002686 C0E804              <1> 	shr al, 4
  3263 00002689 C0E404              <1> 	shl ah, 4
  3264 0000268C C0EC04              <1> 	shr ah, 4
  3265 0000268F 3C00                <1> 	cmp al, 0
  3266 00002691 7409                <1> 	je noconverttohex
  3267                              <1> converttohexlp:
  3268 00002693 80C40A              <1> 	add ah, 10
  3269 00002696 FEC8                <1> 	dec al
  3270 00002698 3C00                <1> 	cmp al, 0
  3271 0000269A 75F7                <1> 	jne converttohexlp
  3272                              <1> noconverttohex:
  3273 0000269C C3                  <1> 	ret
  3274                              <1> 	
  3275                              <1> tstackput1:
  3276 0000269D 8935[08270000]      <1> 	mov [tstack + 20], esi
  3277 000026A3 BE[F4260000]        <1> 	mov esi, tstack
  3278 000026A8 8906                <1> 	mov [esi], eax
  3279 000026AA 895E04              <1> 	mov [esi + 4], ebx
  3280 000026AD 894E08              <1> 	mov [esi + 8], ecx
  3281 000026B0 89560C              <1> 	mov [esi + 12], edx
  3282 000026B3 897E10              <1> 	mov [esi + 16], edi
  3283 000026B6 C3                  <1> 	ret
  3284                              <1> 	
  3285                              <1> tstackget1:
  3286 000026B7 BE[F4260000]        <1> 	mov esi, tstack
  3287 000026BC 8B06                <1> 	mov eax, [esi]
  3288 000026BE 8B5E04              <1> 	mov ebx, [esi + 4]
  3289 000026C1 8B4E08              <1> 	mov ecx, [esi + 8]
  3290 000026C4 8B560C              <1> 	mov edx, [esi + 12]
  3291 000026C7 8B7E10              <1> 	mov edi, [esi + 16]
  3292 000026CA 8B7614              <1> 	mov esi, [esi + 20]
  3293 000026CD C3                  <1> 	ret
  3294                              <1> 	
  3295                              <1> tget1:
  3296 000026CE 66BA7000            <1> 	mov dx, 0x70
  3297 000026D2 EE                  <1> 	out dx, al
  3298 000026D3 6642                <1> 	inc dx
  3299 000026D5 EC                  <1> 	in al, dx
  3300 000026D6 664A                <1> 	dec dx
  3301 000026D8 C3                  <1> 	ret
  3302                              <1> 	
  3303                              <1> tput1:
  3304 000026D9 66C1E904            <1> 	shr cx, 4
  3305 000026DD B030                <1> 	mov al, 48
  3306 000026DF 00E8                <1> 	add al, ch
  3307 000026E1 8806                <1> 	mov [esi], al
  3308 000026E3 46                  <1> 	inc esi
  3309 000026E4 B030                <1> 	mov al, 48
  3310 000026E6 C0E904              <1> 	shr cl, 4
  3311 000026E9 00C8                <1> 	add al, cl
  3312 000026EB 8806                <1> 	mov [esi], al
  3313 000026ED 81C602000000        <1> 	add esi, 2
  3314 000026F3 C3                  <1> 	ret
  3315                              <1> 		
  3316 000026F4 000000000000000000- <1> 	tstack dd 0,0,0,0,0,0
  3317 000026FD 000000000000000000- <1>
  3318 00002706 000000000000        <1>
  3319 0000270C 00                  <1> 	RTCtimeSecond db 0
  3320 0000270D 00                  <1> 	RTCtimeMinute db 0
  3321 0000270E 00                  <1> 	RTCtimeHour db 0
  3322 0000270F 00                  <1> 	RTCtimeDay db 0
  3323 00002710 00                  <1> 	RTCtimeMonth db 0
  3324 00002711 00                  <1> 	RTCtimeYear db 0
  3325 00002712 00                  <1> 	dayhex db 0
  3326 00002713 00                  <1> 	monthhex db 0
  3327 00002714 00                  <1> 	yearhex db 0
  3328 00002715 30303A30303A30300D- <1> 	timeshow db "00:00:00",13,10
  3329 0000271E 0A                  <1>
  3330 0000271F 30302D30302D303030- <1> 	dateshow db "00-00-0000",13,10,0
  3331 00002728 300D0A00            <1>
  3332                              <1> 	oldcentury:	;;from 1700 to 1900
  3333 0000272C 040200              <1> 	db 4,2,0
  3334                              <1> 	century:	;;from 2000 to 2500
  3335 0000272F 060402000604        <1> 	db 6,4,2,0,6,4
  3336                              <1> 	month:
  3337 00002735 000303060104060205- <1> 	db 0,3,3,6,1,4,6,2,5,0,3,5
  3338 0000273E 000305              <1>
  3339                              <1> 	day:
  3340 00002741 [5D270000]          <1> 	dd sunday
  3341 00002745 [66270000]          <1> 	dd monday
  3342 00002749 [6F270000]          <1> 	dd tuesday
  3343 0000274D [79270000]          <1> 	dd wednesday
  3344 00002751 [85270000]          <1> 	dd thursday
  3345 00002755 [90270000]          <1> 	dd friday
  3346 00002759 [99270000]          <1> 	dd saturday
  3347                              <1> sunday:
  3348 0000275D 53756E6461790D0A00  <1> 	db "Sunday",13,10,0
  3349                              <1> monday:
  3350 00002766 4D6F6E6461790D0A00  <1> 	db "Monday",13,10,0
  3351                              <1> tuesday:
  3352 0000276F 547565736461790D0A- <1> 	db "Tuesday",13,10,0
  3353 00002778 00                  <1>
  3354                              <1> wednesday:
  3355 00002779 5765646E6573646179- <1> 	db "Wednesday",13,10,0
  3356 00002782 0D0A00              <1>
  3357                              <1> thursday:
  3358 00002785 54687572736461790D- <1> 	db "Thursday",13,10,0
  3359 0000278E 0A00                <1>
  3360                              <1> friday:
  3361 00002790 4672696461790D0A00  <1> 	db "Friday",13,10,0
  3362                              <1> saturday:
  3363 00002799 53617475726461790D- <1> 	db "Saturday",13,10,0
  3364 000027A2 0A00                <1>
  3365                              <1> 
  3366 000027A4 0504637075696400    <1> db 5,4,"cpuid",0
  3367 000027AC B800000000          <1> 	mov eax, 0
  3368 000027B1 0FA2                <1> 	cpuid
  3369 000027B3 891D[08280000]      <1> 	mov [cpuidbuf], ebx
  3370 000027B9 8915[0C280000]      <1> 	mov [cpuidbuf + 4], edx
  3371 000027BF 890D[10280000]      <1> 	mov [cpuidbuf + 8], ecx
  3372 000027C5 BE[08280000]        <1> 	mov esi, cpuidbuf
  3373 000027CA E883E4FFFF          <1> 	call print
  3374 000027CF BE[8E6C0000]        <1> 	mov esi, line
  3375 000027D4 E879E4FFFF          <1> 	call print
  3376 000027D9 B801000000          <1> 	mov eax, 1
  3377 000027DE 0FA2                <1> 	cpuid
  3378 000027E0 89C1                <1> 	mov ecx, eax
  3379 000027E2 C605[DA150000]02    <1> 	mov byte [firsthexshown], 2
  3380 000027E9 E801EEFFFF          <1> 	call showhex
  3381 000027EE B808000080          <1> 	mov eax, 0x80000008
  3382 000027F3 0FA2                <1> 	cpuid
  3383 000027F5 89C1                <1> 	mov ecx, eax
  3384 000027F7 C605[DA150000]02    <1> 	mov byte [firsthexshown], 2
  3385 000027FE E8ECEDFFFF          <1> 	call showhex
  3386 00002803 E99FE9FFFF          <1> 	jmp nwcmd
  3387                              <1> 	
  3388 00002808 00<rept>            <1> cpuidbuf times 13 db 0
  3389                              <1> cpuidvendorend:
  3390                              <1> progend:		;programs end here	
  3391                              <1> batchprogend:
  3392                                      %include 'source/input.asm'
  3393                              <1> PS2SET:
  3394 00002815 B0A8                <1>   mov  al, 0xa8		; enable mouse port
  3395 00002817 E664                <1>   out  0x64, al		; write to keyboardcontroller
  3396 00002819 E801000000          <1>   call CHKPRT		; check if command is progressed (demand!)
  3397 0000281E C3                  <1> ret
  3398                              <1> 
  3399                              <1> CHKPRT:
  3400 0000281F 66B96400            <1>   mov  cx, 100
  3401                              <1>  .again:
  3402 00002823 E464                <1>   in   al, 0x64		; read from keyboardcontroller
  3403 00002825 A802                <1>   test al, 2		; Check if input buffer is empty
  3404 00002827 7402                <1>   je .go
  3405 00002829 E2F8                <1>   loop .again
  3406                              <1>  .go:
  3407 0000282B C3                  <1> ret
  3408                              <1> 
  3409                              <1> WMOUS:
  3410 0000282C B0D4                <1>   mov  al, 0xd4		; write to mouse device instead of to keyboard
  3411 0000282E E664                <1>   out  0x64, al		; write to keyboardcontroller
  3412 00002830 E8EAFFFFFF          <1>   call CHKPRT		; check if command is progressed (demand!)
  3413 00002835 C3                  <1> ret
  3414                              <1> 
  3415                              <1> MBUFFUL:
  3416 00002836 66B96400            <1>   mov cx, 100
  3417                              <1>  .mn:
  3418 0000283A E464                <1>   in   al, 0x64		; read from keyboardcontroller
  3419 0000283C A820                <1>   test al, 0x20		; check if mouse output buffer is full
  3420 0000283E 7402                <1>   jz  .mnn
  3421 00002840 E2F8                <1>   loop .mn
  3422                              <1>  .mnn:
  3423 00002842 C3                  <1> ret
  3424                              <1> 
  3425                              <1> 
  3426                              <1> ACTMOUS:
  3427 00002843 E8E4FFFFFF          <1>   call WMOUS
  3428 00002848 B0F4                <1>   mov  al, 0xf4 	; Command to activate mouse itselve (Stream mode)
  3429 0000284A E660                <1>   out  0x60, al		; write ps/2 controller output port (activate mouse)
  3430 0000284C E8CEFFFFFF          <1>   call CHKPRT		; check if command is progressed (demand!)
  3431 00002851 E801000000          <1>   call CHKMOUS		; check if a byte is available
  3432 00002856 C3                  <1> ret
  3433                              <1> 
  3434                              <1> CHKMOUS:
  3435 00002857 B300                <1>   mov  bl, 0
  3436 00002859 66B96400            <1>   mov cx, 100
  3437                              <1>  .vrd:
  3438 0000285D E464                <1>   in   al, 0x64		; read from keyboardcontroller
  3439 0000285F A801                <1>   test al, 1		; check if controller buffer (60h) has data
  3440 00002861 7504                <1>   jnz .yy
  3441 00002863 E2F8                <1>   loop .vrd
  3442 00002865 B301                <1>   mov  bl, 1
  3443                              <1>  .yy:
  3444 00002867 C3                  <1> ret
  3445                              <1> 
  3446                              <1> GETB:
  3447                              <1>  .cagain:
  3448 00002868 E8EAFFFFFF          <1>   call CHKMOUS		; check if a byte is available
  3449 0000286D 08DB                <1>   or bl, bl
  3450 0000286F 75F7                <1>   jnz .cagain
  3451 00002871 B0AD                <1>   mov  al, 0xad		; Disable Keyboard
  3452 00002873 E664                <1>   out  0x64, al		; write to keyboardcontroller
  3453 00002875 E8A5FFFFFF          <1>   call CHKPRT		; check if command is progressed (demand!)
  3454 0000287A 6631C0              <1>   xor  ax, ax
  3455 0000287D E460                <1>   in   al, 0x60		; read ps/2 controller output port (mousebyte)
  3456 0000287F 88C2                <1>   mov  dl, al
  3457 00002881 B0AE                <1>   mov  al, 0xae		; Enable Keyboard
  3458 00002883 E664                <1>   out  0x64, al		; write to keyboardcontroller
  3459 00002885 E895FFFFFF          <1>   call CHKPRT		; check if command is progressed (demand!)
  3460 0000288A 88D0                <1>   mov  al, dl
  3461 0000288C C3                  <1> ret
  3462                              <1> 
  3463 0000288D 00                  <1> LBUTTON db 0x00	;	Left   button status 1=PRESSED 0=RELEASED
  3464 0000288E 00                  <1> RBUTTON db 0x00	;	Right  button status 1=PRESSED 0=RELEASED
  3465 0000288F 00                  <1> MBUTTON db 0x00	;	Middle button status 1=PRESSED 0=RELEASED
  3466 00002890 00                  <1> XCOORD  db 0x00	;	the moved distance  (horizontal)
  3467 00002891 00                  <1> YCOORD  db 0x00	;	the moved distance  (vertical)
  3468                              <1> 
  3469 00002892 00                  <1> specialkey db 0
  3470                              <1> 
  3471                              <1> 	guistartin:
  3472 00002893 B800000000          <1> 		mov eax, 0
  3473 00002898 A2[92280000]        <1> 		mov [specialkey], al
  3474 0000289D 66A3[0E0C0000]      <1> 		mov [lastkey], ax
  3475 000028A3 E464                <1> 		in al, 64h ; Status
  3476 000028A5 A801                <1> 		test al, 1 ; output buffer full?
  3477 000028A7 74EA                <1> 		jz guistartin
  3478 000028A9 A820                <1> 		test al, 20h ; PS2-Mouse?
  3479 000028AB 0F8577010000        <1> 		jnz near maincall2
  3480                              <1> 	guigetkey:
  3481 000028B1 E460                <1> 		in al, 60h
  3482 000028B3 88C4                <1> 		mov ah, al
  3483 000028B5 B000                <1> 		mov al, 0
  3484 000028B7 8825[0F0C0000]      <1> 		mov [lastkey + 1], ah
  3485 000028BD 88E0                <1> 		mov al, ah
  3486 000028BF BF[6B2C0000]        <1> 		mov edi, scancode
  3487                              <1> 	guisearchscan: 
  3488 000028C4 3C3A                <1> 		cmp al, 3Ah
  3489 000028C6 7315                <1> 		jae guiscanother
  3490 000028C8 B400                <1> 		mov ah, 0
  3491 000028CA D0E0                <1> 		shl al, 1
  3492 000028CC 01C7                <1> 		add edi, eax
  3493 000028CE D0E8                <1> 		shr al, 1
  3494 000028D0 8A27                <1> 		mov ah, [edi]
  3495 000028D2 80FC00              <1> 		cmp ah, 0
  3496 000028D5 7406                <1> 		je guiscanother
  3497 000028D7 E99C000000          <1> 		jmp guiscanfound
  3498 000028DC 00                  <1> guiupper db 0
  3499                              <1> guiscanother:
  3500 000028DD 88C4                <1> 		mov ah, al
  3501 000028DF B000                <1> 		mov al, 0
  3502 000028E1 66A3[0E0C0000]      <1> 		mov [lastkey], ax
  3503 000028E7 80FCE0              <1> 		cmp ah, 0E0h
  3504 000028EA 0F845A000000        <1> 		je near guigetkeyspecial
  3505 000028F0 B0E0                <1> 		mov al, 0xE0
  3506 000028F2 3805[92280000]      <1> 		cmp [specialkey], al
  3507 000028F8 7507                <1> 		jne nospecialkey
  3508 000028FA 66A3[0E0C0000]      <1> 		mov [lastkey], ax
  3509 00002900 C3                  <1> 		ret
  3510                              <1> nospecialkey:
  3511                              <1> 		;cmp ah, 4Dh
  3512                              <1> 		;je near nextimage
  3513 00002901 80FC2A              <1> 		cmp ah, 2Ah
  3514 00002904 0F8455000000        <1> 		je near guishifton
  3515 0000290A 80FC36              <1> 		cmp ah, 36h
  3516 0000290D 0F844C000000        <1> 		je near guishifton
  3517 00002913 80FC1C              <1> 		cmp ah, 1Ch
  3518 00002916 0F845B000000        <1> 		je near guientdown
  3519 0000291C 80FCAA              <1> 		cmp ah, 0AAh
  3520 0000291F 0F8446000000        <1> 		je near guishiftoff
  3521 00002925 80FCB6              <1> 		cmp ah, 0B6h
  3522 00002928 0F843D000000        <1> 		je near guishiftoff
  3523 0000292E 80FC3A              <1> 		cmp ah, 3Ah
  3524 00002931 0F8461000000        <1> 		je near guicaps
  3525 00002937 80FC45              <1> 		cmp ah, 0x45
  3526 0000293A 0F8466000000        <1> 		je near guinumlock
  3527 00002940 80FC46              <1> 		cmp ah, 0x46
  3528 00002943 0F8475000000        <1> 		je near guiscrolllock
  3529 00002949 C3                  <1> 		ret
  3530                              <1> 	guigetkeyspecial:
  3531 0000294A B0E0                <1> 		mov al, 0xE0
  3532 0000294C A2[92280000]        <1> 		mov [specialkey], al
  3533 00002951 E95BFFFFFF          <1> 		jmp guigetkey
  3534                              <1> 	guishift:
  3535 00002956 A0[DC280000]        <1> 		mov al, [guiupper]
  3536 0000295B 3C01                <1> 		cmp al, 1
  3537 0000295D 730C                <1> 		jae guishiftoff
  3538                              <1> 	guishifton:
  3539 0000295F C605[DC280000]01    <1> 		mov byte [guiupper], 1
  3540 00002966 E928FFFFFF          <1> 		jmp guistartin
  3541                              <1> 	guishiftoff:
  3542 0000296B C605[DC280000]00    <1> 		mov byte [guiupper], 0
  3543 00002972 E91CFFFFFF          <1> 		jmp guistartin
  3544                              <1> 	guientdown:
  3545 00002977 C3                  <1> 		ret
  3546                              <1> 	guiscanfound:
  3547 00002978 81C701000000        <1> 		add edi, 1
  3548 0000297E 803D[DC280000]01    <1> 		cmp byte [guiupper], 1
  3549 00002985 7306                <1> 		jae uppercasegui
  3550 00002987 81EF01000000        <1> 		sub edi, 1
  3551                              <1> uppercasegui:
  3552 0000298D 8A07                <1> 		mov al,[edi]
  3553 0000298F A2[0E0C0000]        <1> 		mov [lastkey], al
  3554 00002994 C3                  <1> 		ret
  3555                              <1> 		
  3556 00002995 00                  <1> keyboardstatus db 0
  3557 00002996 00                  <1> numlockstatus db 0
  3558 00002997 00                  <1> scrolllockstatus db 0
  3559                              <1> 	guicaps:
  3560 00002998 8035[95290000]04    <1> 		xor byte [keyboardstatus], 00000100b
  3561 0000299F E832000000          <1> 		call updatekblights
  3562 000029A4 EBB0                <1> 		jmp guishift
  3563                              <1> 		
  3564                              <1> 	guinumlock:
  3565 000029A6 8035[95290000]02    <1> 		xor byte [keyboardstatus], 00000010b
  3566 000029AD 8035[96290000]01    <1> 		xor byte [numlockstatus], 1
  3567 000029B4 E81D000000          <1> 		call updatekblights
  3568 000029B9 E9D5FEFFFF          <1> 		jmp guistartin
  3569                              <1> 	
  3570                              <1> 	guiscrolllock:
  3571 000029BE 8035[95290000]01    <1> 		xor byte [keyboardstatus], 00000001b
  3572 000029C5 8035[97290000]01    <1> 		xor byte [scrolllockstatus], 1
  3573 000029CC E805000000          <1> 		call updatekblights
  3574 000029D1 E9BDFEFFFF          <1> 		jmp guistartin
  3575                              <1> 		
  3576                              <1> 	updatekblights:
  3577 000029D6 B0ED                <1> 		mov al, 0xED
  3578 000029D8 66BA6000            <1> 		mov dx, 0x60
  3579 000029DC EE                  <1> 		out dx, al
  3580                              <1> 	chkkbdack:
  3581 000029DD EC                  <1> 		in al, dx
  3582 000029DE 3CFA                <1> 		cmp al, 0xFA
  3583 000029E0 75FB                <1> 		jne chkkbdack
  3584 000029E2 A0[95290000]        <1> 		mov al, [keyboardstatus]
  3585 000029E7 EE                  <1> 		out dx, al
  3586 000029E8 C3                  <1> 		ret
  3587                              <1> 	
  3588                              <1> 	cursorgui:
  3589 000029E9 803D[343F0000]01    <1> 		cmp byte [mouseon], 1
  3590 000029F0 0F8432000000        <1> 		je near maincall2
  3591 000029F6 803D[782E0000]00    <1> 		cmp byte [guion], 0
  3592 000029FD 0F8474FFFFFF        <1> 		je guientdown
  3593                              <1> 	initmouse:
  3594 00002A03 803D[782E0000]00    <1> 		cmp byte [guion], 0
  3595 00002A0A 7405                <1> 		je noswmsposinit
  3596 00002A0C E834050000          <1> 		call switchmousepos2
  3597                              <1> 	noswmsposinit:
  3598 00002A11 E8FFFDFFFF          <1> 	  	call PS2SET
  3599 00002A16 E828FEFFFF          <1> 		call ACTMOUS
  3600 00002A1B C605[343F0000]01    <1> 		mov byte [mouseon],1
  3601 00002A22 E841FEFFFF          <1> 		call GETB 	;;Get the responce byte of the mouse (like: Hey i am active)
  3602                              <1> 				;;If the bytes are mixed up,
  3603                              <1> 				;;remove this line or add another of this line.
  3604                              <1> 		;call GETB
  3605 00002A27 C3                  <1> 		ret
  3606                              <1> 	maincall2:
  3607 00002A28 803D[343F0000]01    <1> 		  cmp byte [mouseon], 1
  3608 00002A2F 75D2                <1> 		  jne initmouse
  3609 00002A31 E832FEFFFF          <1> 		  call GETB
  3610 00002A36 88C3                <1> 		  mov  bl, al
  3611 00002A38 80E301              <1> 		  and  bl, 1
  3612 00002A3B 881D[8D280000]      <1> 		  mov  BYTE [LBUTTON], bl
  3613 00002A41 88C3                <1> 		  mov  bl, al
  3614 00002A43 80E302              <1> 		  and  bl, 2
  3615 00002A46 D0EB                <1> 		  shr  bl, 1
  3616 00002A48 881D[8E280000]      <1> 		  mov  BYTE [RBUTTON], bl
  3617 00002A4E 88C3                <1> 		  mov  bl, al
  3618 00002A50 80E304              <1> 		  and  bl, 4
  3619 00002A53 C0EB02              <1> 		  shr  bl, 2
  3620 00002A56 881D[8F280000]      <1> 		  mov  BYTE [MBUTTON], bl
  3621 00002A5C E807FEFFFF          <1> 		  call GETB
  3622 00002A61 A2[90280000]        <1> 		  mov  BYTE [XCOORD], al
  3623 00002A66 E8FDFDFFFF          <1> 		  call GETB
  3624 00002A6B A2[91280000]        <1> 		  mov  BYTE [YCOORD], al
  3625                              <1> 
  3626                              <1> 	showpixelcursor:
  3627 00002A70 668B15[CA2B0000]    <1> 		mov dx, [mousecursorposition]
  3628 00002A77 668B0D[CC2B0000]    <1> 		mov cx, [mousecursorposition + 2]
  3629 00002A7E 668915[C62B0000]    <1> 		mov [lastmouseposition], dx
  3630 00002A85 66890D[C82B0000]    <1> 		mov [lastmouseposition + 2], cx
  3631 00002A8C A0[90280000]        <1> 		mov al, [XCOORD]
  3632 00002A91 3C80                <1> 		cmp al, 128
  3633 00002A93 730C                <1> 		jae subxcoord
  3634 00002A95 00C0                <1> 		add al, al
  3635 00002A97 B400                <1> 		mov ah, 0
  3636 00002A99 6601C2              <1> 		add dx, ax
  3637 00002A9C E90B000000          <1> 		jmp subxcoorddn
  3638                              <1> 	subxcoord:
  3639 00002AA1 00C0                <1> 		add al, al
  3640 00002AA3 B300                <1> 		mov bl, 0
  3641 00002AA5 28C3                <1> 		sub bl, al
  3642 00002AA7 B700                <1> 		mov bh, 0
  3643 00002AA9 6629DA              <1> 		sub dx, bx
  3644                              <1> 	subxcoorddn:
  3645 00002AAC 8A1D[91280000]      <1> 		mov bl, [YCOORD]
  3646 00002AB2 B000                <1> 		mov al, 0
  3647 00002AB4 28D8                <1> 		sub al, bl
  3648 00002AB6 3C80                <1> 		cmp al, 128
  3649 00002AB8 730A                <1> 		jae subycoord
  3650 00002ABA B400                <1> 		mov ah, 0
  3651 00002ABC 6601C1              <1> 		add cx, ax
  3652 00002ABF E909000000          <1> 		jmp subycoorddn
  3653                              <1> 	subycoord:
  3654 00002AC4 B300                <1> 		mov bl, 0
  3655 00002AC6 28C3                <1> 		sub bl, al
  3656 00002AC8 B700                <1> 		mov bh, 0
  3657 00002ACA 6629D9              <1> 		sub cx, bx
  3658                              <1> 	subycoorddn:
  3659 00002ACD 6681FA204E          <1> 		cmp dx, 20000
  3660 00002AD2 7604                <1> 		jbe nooriginx2
  3661 00002AD4 66BA0000            <1> 		mov dx, 0
  3662                              <1> 	nooriginx2:
  3663 00002AD8 6681F9204E          <1> 		cmp cx, 20000
  3664 00002ADD 7604                <1> 		jbe nooriginy2
  3665 00002ADF 66B90000            <1> 		mov cx, 0
  3666                              <1> 	nooriginy2:
  3667 00002AE3 6681FA0000          <1> 		cmp dx, 0
  3668 00002AE8 7415                <1> 		je nofixxcolumn2
  3669 00002AEA 663B15[DC3C0000]    <1> 		cmp dx, [resolutionx2]
  3670 00002AF1 720C                <1> 		jb nofixxcolumn2
  3671 00002AF3 668B15[DC3C0000]    <1> 		mov dx, [resolutionx2]
  3672 00002AFA 6681EA0200          <1> 		sub dx, 2
  3673                              <1> 	nofixxcolumn2:
  3674 00002AFF 6681F90000          <1> 		cmp cx, 0
  3675 00002B04 7415                <1> 		je nofixyrow2
  3676 00002B06 663B0D[D83C0000]    <1> 		cmp cx, [resolutiony]
  3677 00002B0D 720C                <1> 		jb nofixyrow2
  3678 00002B0F 668B0D[D83C0000]    <1> 		mov cx, [resolutiony]
  3679 00002B16 6681E90100          <1> 		sub cx, 1
  3680                              <1> 	nofixyrow2:
  3681 00002B1B 668915[CA2B0000]    <1> 		mov [mousecursorposition], dx
  3682 00002B22 66890D[CC2B0000]    <1> 		mov [mousecursorposition + 2], cx
  3683 00002B29 803D[782E0000]00    <1> 		cmp byte [guion], 0
  3684 00002B30 0F8498000000        <1> 		je near termmouse
  3685 00002B36 E8A1030000          <1> 		call switchmousepos ;;use dragging code to ensure proper icon drag
  3686 00002B3B 803D[8D280000]01    <1> 		cmp byte [LBUTTON], 1
  3687 00002B42 0F847A040000        <1> 		je near clickicon
  3688 00002B48 803D[8E280000]01    <1> 		cmp byte [RBUTTON], 1
  3689 00002B4F 0F846D040000        <1> 		je near clickicon
  3690 00002B55 A0[AF2F0000]        <1> 		mov al, [pbutton]
  3691 00002B5A C705[B22F0000]0000- <1> 		mov dword [dragging], 0
  3692 00002B62 0000                <1>
  3693 00002B64 3C00                <1> 		cmp al, 0
  3694 00002B66 740F                <1> 		je nopreviousbutton
  3695 00002B68 E80C030000          <1> 		call clearmousecursor
  3696 00002B6D E88A090000          <1> 		call reloadallgraphics
  3697                              <1> 	windowtermcopyend:
  3698 00002B72 E8CE030000          <1> 		call switchmousepos2
  3699                              <1> 	nopreviousbutton:
  3700 00002B77 B000                <1> 		mov al, 0
  3701 00002B79 A2[AF2F0000]        <1> 		mov [pbutton], al
  3702 00002B7E A0[8D280000]        <1> 		mov al, [LBUTTON]
  3703 00002B83 A2[B02F0000]        <1> 		mov [pLBUTTON], al
  3704 00002B88 A0[8E280000]        <1> 		mov al, [RBUTTON]
  3705 00002B8D A2[B12F0000]        <1> 		mov [pRBUTTON], al
  3706 00002B92 B900000000          <1> 		mov ecx, 0
  3707 00002B97 BA00000000          <1> 		mov edx, 0
  3708 00002B9C 668B15[CA2B0000]    <1> 		mov dx, [mousecursorposition]
  3709 00002BA3 668B0D[CC2B0000]    <1> 		mov cx, [mousecursorposition + 2]
  3710 00002BAA 66BB18C7            <1> 		mov bx, 1100011100011000b
  3711 00002BAE B400                <1> 		mov ah, 0
  3712 00002BB0 B080                <1> 		mov al, 128
  3713 00002BB2 C605[752E0000]01    <1> 		mov byte [showcursorfonton], 1
  3714 00002BB9 E82E110000          <1> 		call showfontvesa
  3715 00002BBE C605[752E0000]00    <1> 		mov byte [showcursorfonton], 0
  3716 00002BC5 C3                  <1> 		ret
  3717                              <1> 
  3718 00002BC6 84008400            <1> lastmouseposition dw 132,132
  3719 00002BCA 84008400            <1> mousecursorposition dw 132,132	
  3720                              <1> 
  3721                              <1> termmouse:
  3722 00002BCE BE[8F1C0000]        <1> 		mov esi, videobuf2
  3723 00002BD3 BA00000000          <1> 		mov edx, 0
  3724 00002BD8 668B15[C62B0000]    <1> 		mov dx, [lastmouseposition]
  3725 00002BDF 668B0D[C82B0000]    <1> 		mov cx, [lastmouseposition + 2]
  3726 00002BE6 66A1[692C0000]      <1> 		mov ax, [cursorcache]
  3727 00002BEC 663D0000            <1> 		cmp ax, 0
  3728 00002BF0 7426                <1> 		je nocopycursorcache
  3729 00002BF2 66C1E104            <1> 		shl cx, 4
  3730 00002BF6 66C1E203            <1> 		shl dx, 3
  3731 00002BFA 01D6                <1> 		add esi, edx
  3732 00002BFC 66BA0000            <1> 		mov dx, 0
  3733 00002C00 8A15[670A0000]      <1> 		mov dl, [charxy]
  3734 00002C06 6641                <1> 		inc cx
  3735                              <1> termmousecplp1:
  3736 00002C08 01D6                <1> 		add esi, edx
  3737 00002C0A 6649                <1> 		dec cx
  3738 00002C0C 6681F90000          <1> 		cmp cx, 0
  3739 00002C11 75F5                <1> 		jne termmousecplp1
  3740 00002C13 29D6                <1> 		sub esi, edx
  3741 00002C15 668906              <1> 		mov [esi], ax
  3742                              <1> nocopycursorcache:
  3743 00002C18 BE[8F1C0000]        <1> 		mov esi, videobuf2
  3744 00002C1D BA00000000          <1> 		mov edx, 0
  3745 00002C22 668B15[CA2B0000]    <1> 		mov dx, [mousecursorposition]
  3746 00002C29 668B0D[CC2B0000]    <1> 		mov cx, [mousecursorposition + 2]
  3747 00002C30 66C1E104            <1> 		shl cx, 4
  3748 00002C34 66C1E203            <1> 		shl dx, 3
  3749 00002C38 01D6                <1> 		add esi, edx
  3750 00002C3A 66BA0000            <1> 		mov dx, 0
  3751 00002C3E 8A15[670A0000]      <1> 		mov dl, [charxy]
  3752 00002C44 6641                <1> 		inc cx
  3753                              <1> termmousecplp2:
  3754 00002C46 01D6                <1> 		add esi, edx
  3755 00002C48 6649                <1> 		dec cx
  3756 00002C4A 6681F90000          <1> 		cmp cx, 0
  3757 00002C4F 75F5                <1> 		jne termmousecplp2
  3758 00002C51 29D6                <1> 		sub esi, edx
  3759 00002C53 668B06              <1> 		mov ax, [esi]
  3760 00002C56 66A3[692C0000]      <1> 		mov [cursorcache], ax
  3761 00002C5C B080                <1> 		mov al, 128
  3762 00002C5E B407                <1> 		mov ah, 7
  3763 00002C60 668906              <1> 		mov [esi], ax
  3764 00002C63 E829E3FFFF          <1> 		call termcopy
  3765 00002C68 C3                  <1> 		ret
  3766 00002C69 0000                <1> cursorcache db 0,0
  3767                              <1> 	
  3768                              <1> scancode:
  3769 00002C6B 0000                <1> 	db 0,0		;,0h
  3770 00002C6D 0000                <1> 	db 0,0		;,1h
  3771 00002C6F 3121                <1> 	db '1','!'	;,2h
  3772 00002C71 3240                <1> 	db '2','@'	;,3h
  3773 00002C73 3323                <1> 	db '3','#'	;,4h
  3774 00002C75 3424                <1> 	db '4','$'	;,5h
  3775 00002C77 3525                <1> 	db '5','%'	;,6h
  3776 00002C79 365E                <1> 	db '6','^'	;,7h
  3777 00002C7B 3726                <1> 	db '7','&'	;,8h
  3778 00002C7D 382A                <1> 	db '8','*'	;,9h
  3779 00002C7F 3928                <1> 	db '9','('	;,0Ah
  3780 00002C81 3029                <1> 	db '0',')'	;,0Bh
  3781 00002C83 2D5F                <1> 	db '-','_'	;,0Ch
  3782 00002C85 3D2B                <1> 	db '=','+'	;,0Dh
  3783 00002C87 0808                <1> 	db 8,8		;,0Eh
  3784 00002C89 0000                <1> 	db 0,0		;,0Fh
  3785 00002C8B 7151                <1> 	db 'q','Q'	;,10h
  3786 00002C8D 7757                <1> 	db 'w','W'	;,11h
  3787 00002C8F 6545                <1> 	db 'e','E'	;,12h
  3788 00002C91 7252                <1> 	db 'r','R'	;,13h
  3789 00002C93 7454                <1> 	db 't','T'	;,14h
  3790 00002C95 7959                <1> 	db 'y','Y'	;,15h
  3791 00002C97 7555                <1> 	db 'u','U'	;,16h
  3792 00002C99 6949                <1> 	db 'i','I'	;,17h
  3793 00002C9B 6F4F                <1> 	db 'o','O'	;,18h
  3794 00002C9D 7050                <1> 	db 'p','P'	;,19h
  3795 00002C9F 5B7B                <1> 	db '[','{'	;,1Ah
  3796 00002CA1 5D7D                <1> 	db ']','}'	;,1Bh
  3797 00002CA3 0000                <1> 	db 0,0		;,1Ch
  3798 00002CA5 0000                <1> 	db 0,0		;,1Dh
  3799 00002CA7 6141                <1> 	db 'a','A'	;,1Eh
  3800 00002CA9 7353                <1> 	db 's','S'	;,1Fh
  3801 00002CAB 6444                <1> 	db 'd','D'	;,20h
  3802 00002CAD 6646                <1> 	db 'f','F'	;,21h
  3803 00002CAF 6747                <1> 	db 'g','G'	;,22h
  3804 00002CB1 6848                <1> 	db 'h','H'	;,23h
  3805 00002CB3 6A4A                <1> 	db 'j','J'	;,24h
  3806 00002CB5 6B4B                <1> 	db 'k','K'	;,25h
  3807 00002CB7 6C4C                <1> 	db 'l','L'	;,26h
  3808 00002CB9 3B3A                <1> 	db ';',':'	;,27h
  3809 00002CBB 2722                <1> 	db 27h,22h	;,28h
  3810 00002CBD 607E                <1> 	db '`','~'	;,29h
  3811 00002CBF 0000                <1> 	db 0,0		;,2Ah
  3812 00002CC1 5C7C                <1> 	db '\','|'	;,2Bh
  3813 00002CC3 7A5A                <1> 	db 'z','Z'	;,2Ch
  3814 00002CC5 7858                <1> 	db 'x','X'	;,2Dh
  3815 00002CC7 6343                <1> 	db 'c','C'	;,2Eh
  3816 00002CC9 7656                <1> 	db 'v','V'	;,2Fh
  3817 00002CCB 6242                <1> 	db 'b','B'	;,30h
  3818 00002CCD 6E4E                <1> 	db 'n','N'	;,31h
  3819 00002CCF 6D4D                <1> 	db 'm','M'	;,32h
  3820 00002CD1 2C3C                <1> 	db ',','<'	;,33h
  3821 00002CD3 2E3E                <1> 	db '.','>'	;,34h
  3822 00002CD5 2F3F                <1> 	db '/','?'	;,35h
  3823 00002CD7 0000                <1> 	db 0,0		;,36h
  3824 00002CD9 0000                <1> 	db 0,0		;,37h
  3825 00002CDB 0000                <1> 	db 0,0		;,38h
  3826 00002CDD 2020                <1> 	db ' ',' '	;,39h
  3827                              <1> noscan:
  3828                                      %include 'source/gui.asm'
  3829                              <1> guiclear:
  3830 00002CDF 8B3D[FC760000]      <1> 	mov edi, [physbaseptr]
  3831 00002CE5 668B15[DA3C0000]    <1> 	mov dx, [resolutionx]
  3832 00002CEC 668B0D[D83C0000]    <1> 	mov cx, [resolutiony]
  3833 00002CF3 66A1[1C2D0000]      <1> 	mov ax, [background]
  3834                              <1> guiclearloop:
  3835 00002CF9 668907              <1> 	mov [edi], ax
  3836 00002CFC 81C702000000        <1> 	add edi, 2
  3837 00002D02 664A                <1> 	dec dx
  3838 00002D04 6681FA0000          <1> 	cmp dx, 0
  3839 00002D09 77EE                <1> 	ja guiclearloop
  3840 00002D0B 6649                <1> 	dec cx
  3841 00002D0D 668B15[DA3C0000]    <1> 	mov dx, [resolutionx]
  3842 00002D14 6681F90000          <1> 	cmp cx, 0
  3843 00002D19 77DE                <1> 	ja guiclearloop
  3844 00002D1B C3                  <1> 	ret
  3845                              <1> 
  3846 00002D1C CF7B                <1> background dw 0111101111001111b
  3847                              <1> 
  3848                              <1> gui:	;Let's see what I can do, I am going to try to make this as freestanding as possible
  3849 00002D1E B800000000          <1> 	mov eax, 0
  3850 00002D23 BB00000000          <1> 	mov ebx, 0
  3851 00002D28 B900000000          <1> 	mov ecx, 0
  3852 00002D2D BA00000000          <1> 	mov edx, 0
  3853 00002D32 8B3D[FC760000]      <1> 	mov edi, [physbaseptr]
  3854 00002D38 668B15[DA3C0000]    <1> 	mov dx, [resolutionx]
  3855 00002D3F 668B0D[D83C0000]    <1> 	mov cx, [resolutiony]
  3856 00002D46 668B1D[1C2D0000]    <1> 	mov bx, [background]
  3857                              <1> guiclearloop2:
  3858 00002D4D 66891F              <1> 	mov [edi], bx
  3859 00002D50 81C702000000        <1> 	add edi, 2
  3860 00002D56 664A                <1> 	dec dx
  3861 00002D58 6681FA0000          <1> 	cmp dx, 0
  3862 00002D5D 0F85EAFFFFFF        <1> 	jne near guiclearloop2
  3863 00002D63 6649                <1> 	dec cx
  3864 00002D65 668B15[DA3C0000]    <1> 	mov dx, [resolutionx]
  3865 00002D6C 6681F90000          <1> 	cmp cx, 0
  3866 00002D71 0F85D6FFFFFF        <1> 	jne near guiclearloop2
  3867 00002D77 C605[782E0000]01    <1> 	mov byte [guion], 1
  3868 00002D7E C605[772E0000]00    <1> 	mov byte [mouseselecton], 0
  3869 00002D85 B800000000          <1> 	mov eax, 0
  3870 00002D8A BB00000000          <1> 	mov ebx, 0
  3871 00002D8F B900000000          <1> 	mov ecx, 0
  3872 00002D94 BA00000000          <1> 	mov edx, 0
  3873                              <1> 	
  3874 00002D99 BE[493F0000]        <1> 	mov esi, pacmsg
  3875 00002D9E 66B80000            <1> 	mov ax, 0
  3876 00002DA2 BB00000000          <1> 	mov ebx, 0
  3877 00002DA7 66B99000            <1> 	mov cx, 144
  3878 00002DAB 66BA0400            <1> 	mov dx, 4
  3879 00002DAF E88F0A0000          <1> 	call showstring
  3880                              <1> 	
  3881 00002DB4 BE[5F400000]        <1> 	mov esi, interneticon
  3882 00002DB9 66B80000            <1> 	mov ax, 0
  3883 00002DBD BB[BE3F0000]        <1> 	mov ebx, noie
  3884 00002DC2 66B91800            <1> 	mov cx, 24
  3885 00002DC6 66BA0400            <1> 	mov dx, 4
  3886 00002DCA E8300E0000          <1> 	call showicon
  3887                              <1> 	
  3888 00002DCF BE[E1400000]        <1> 	mov esi, wordicon
  3889 00002DD4 66B80000            <1> 	mov ax, 0
  3890 00002DD8 BB00000000          <1> 	mov ebx, 0
  3891 00002DDD 66B91800            <1> 	mov cx, 24
  3892 00002DE1 66BA3000            <1> 	mov dx, 48
  3893 00002DE5 E8150E0000          <1> 	call showicon
  3894                              <1> 	
  3895 00002DEA BE[63410000]        <1> 	mov esi, pacmanpellet
  3896 00002DEF 66B80000            <1> 	mov ax, 0
  3897 00002DF3 BB00000000          <1> 	mov ebx, 0
  3898 00002DF8 66B94000            <1> 	mov cx, 64
  3899 00002DFC 66BA0400            <1> 	mov dx, 4
  3900 00002E00 E8FA0D0000          <1> 	call showicon
  3901                              <1> 	
  3902 00002E05 BE[67420000]        <1> 	mov esi, pacman
  3903 00002E0A 66B80000            <1> 	mov ax, 0
  3904 00002E0E BB[A33F0000]        <1> 	mov ebx, pacmannomnom
  3905 00002E13 66B94000            <1> 	mov cx, 64
  3906 00002E17 66BA3000            <1> 	mov dx, 48
  3907 00002E1B E8DF0D0000          <1> 	call showicon
  3908                              <1> 	
  3909 00002E20 BE[E5410000]        <1> 	mov esi, ghostie
  3910 00002E25 66B80000            <1> 	mov ax, 0
  3911 00002E29 BB[883F0000]        <1> 	mov ebx, boo
  3912 00002E2E 66B96C00            <1> 	mov cx, 108
  3913 00002E32 66BA0400            <1> 	mov dx, 4
  3914 00002E36 E8C40D0000          <1> 	call showicon
  3915                              <1> 
  3916 00002E3B BE[353F0000]        <1> 	mov esi, start
  3917 00002E40 668B0D[D83C0000]    <1> 	mov cx, [resolutiony]
  3918 00002E47 6681E91000          <1> 	sub cx, 16
  3919 00002E4C 66BA0200            <1> 	mov dx, 2
  3920 00002E50 B400                <1> 	mov ah, 0
  3921 00002E52 B010                <1> 	mov al, 00010000b
  3922 00002E54 BB[0C400000]        <1> 	mov ebx, winblows
  3923 00002E59 E8E5090000          <1> 	call showstring
  3924                              <1> 	
  3925 00002E5E E886FBFFFF          <1> 	call cursorgui
  3926                              <1> guistart:
  3927 00002E63 E82BFAFFFF          <1> 	call guistartin
  3928 00002E68 C605[712E0000]00    <1> 	mov byte [copygui], 0
  3929 00002E6F EBF2                <1> 	jmp guistart
  3930                              <1> 	
  3931                              <1> ;guicopy:	;;for double buffering
  3932                              <1> ;	mov byte [copygui], 1
  3933                              <1> ;	mov edi, [offscreenmemoffset]
  3934                              <1> ;	mov edx, 0
  3935                              <1> ;	mov ecx, 0
  3936                              <1> ;	mov dx, [mousecursorposition]
  3937                              <1> ;	mov cx, [mousecursorposition + 2]
  3938                              <1> ;	add edi, edx
  3939                              <1> ;	mov dx, [resolutionx2]
  3940                              <1> ;	inc cx
  3941                              <1> ;guicp2:
  3942                              <1> ;	add edi, edx
  3943                              <1> ;	dec cx
  3944                              <1> ;	cmp cx, 0
  3945                              <1> ;	jne guicp2
  3946                              <1> ;	sub edi, edx
  3947                              <1> ;	mov [cursorloc], edi
  3948                              <1> ;	mov ebx, cursorbmp
  3949                              <1> ;	mov cx, [resolutiony]
  3950                              <1> ;	rol ecx, 16
  3951                              <1> ;	mov cx, [resolutionx]
  3952                              <1> ;	mov esi, [physbaseptr]
  3953                              <1> ;	mov edi, [offscreenmemoffset]
  3954                              <1> ;guicp1:
  3955                              <1> ;	mov ax, [esi]
  3956                              <1> ;	mov [edi], ax
  3957                              <1> ;	add esi, 2
  3958                              <1> ;	add edi, 2
  3959                              <1> ;	cmp edi, [cursorloc]
  3960                              <1> ;	je copycursor
  3961                              <1> ;dncopycursor:
  3962                              <1> ;	dec cx
  3963                              <1> ;	cmp cx, 0
  3964                              <1> ;	jne guicp1
  3965                              <1> ;	mov cx, [resolutionx]
  3966                              <1> ;	rol ecx, 16
  3967                              <1> ;	dec cx
  3968                              <1> ;	cmp cx, 0
  3969                              <1> ;	rol ecx, 16
  3970                              <1> ;	jne guicp1
  3971                              <1> ;	mov byte [copygui], 0
  3972                              <1> ;	ret
  3973                              <1> ;copycursor:
  3974                              <1> ;	cmp ebx, cursorbmpend
  3975                              <1> ;	jae dncopycursor
  3976                              <1> ;	mov dx, [resolutionx2]
  3977                              <1> ;	add edi, edx
  3978                              <1> ;	mov [cursorloc], edi
  3979                              <1> ;	sub edi, edx
  3980                              <1> ;	dec ebx
  3981                              <1> ;	sub edi, 2
  3982                              <1> ;	sub esi, 2
  3983                              <1> ;	mov dx, 9
  3984                              <1> ;curscplp:
  3985                              <1> ;	inc ebx
  3986                              <1> ;	add esi, 2
  3987                              <1> ;	add edi, 2
  3988                              <1> ;	mov ax, [esi]
  3989                              <1> ;	mov [edi], ax
  3990                              <1> ;	mov al, [ebx]
  3991                              <1> ;	cmp al, 0
  3992                              <1> ;	je curscplp2
  3993                              <1> ;	mov word [edi], 1110011110011100b
  3994                              <1> ;curscplp2:
  3995                              <1> ;	dec cx
  3996                              <1> ;	cmp cx, 0
  3997                              <1> ;	je dncopycursor
  3998                              <1> ;	dec dx
  3999                              <1> ;	cmp dx, 0
  4000                              <1> ;	jne curscplp
  4001                              <1> ;	jmp dncopycursor
  4002                              <1> 	
  4003                              <1> 	
  4004                              <1> ;cursorloc: dd 0
  4005                              <1> 		
  4006                              <1> ;nextimage:	
  4007                              <1> ;	call guiclear
  4008                              <1> ;	mov esi, [bmpend]
  4009                              <1> ;	mov eax, 0
  4010                              <1> ;	mov ebx, 0
  4011                              <1> ;	mov ecx, 0
  4012                              <1> ;	mov edx, 0
  4013                              <1> ;	call showbmp
  4014                              <1> ;	jmp guistartin
  4015                              <1> 		
  4016 00002E71 00                  <1> copygui db 0
  4017 00002E72 00                  <1> graphicsset db 0
  4018 00002E73 0000                <1> graphicspos db 0,0
  4019 00002E75 00                  <1> showcursorfonton db 0
  4020 00002E76 00                  <1> savefonton db 0
  4021 00002E77 00                  <1> mouseselecton db 0
  4022 00002E78 00                  <1> guion db 0
  4023                              <1> 
  4024                              <1> 		
  4025                              <1> clearmousecursor:
  4026 00002E79 BE[1C2D0000]        <1> 		mov esi, background
  4027 00002E7E 8B3D[FC760000]      <1> 		mov edi, [physbaseptr]
  4028 00002E84 BA00000000          <1> 		mov edx, 0
  4029 00002E89 B900000000          <1> 		mov ecx, 0
  4030 00002E8E 668B15[C62B0000]    <1> 		mov dx, [lastmouseposition]
  4031 00002E95 668B0D[C82B0000]    <1> 		mov cx, [lastmouseposition + 2]
  4032 00002E9C 01D7                <1> 		add edi, edx
  4033 00002E9E BA00000000          <1> 		mov edx, 0
  4034 00002EA3 668B15[DC3C0000]    <1> 		mov dx, [resolutionx2]
  4035 00002EAA 6681F90000          <1> 		cmp cx, 0
  4036 00002EAF 740B                <1> 		je noyclr
  4037 00002EB1 01D7                <1> yclr:	add edi, edx
  4038 00002EB3 6649                <1> 		dec cx
  4039 00002EB5 6681F90000          <1> 		cmp cx, 0
  4040 00002EBA 75F5                <1> 		jne yclr
  4041 00002EBC 668B06              <1> noyclr:	mov ax, [esi]
  4042 00002EBF C1C010              <1> 		rol eax, 16
  4043 00002EC2 668B06              <1> 		mov ax, [esi]
  4044 00002EC5 8907                <1> 		mov [edi], eax
  4045 00002EC7 894704              <1> 		mov [edi + 4], eax
  4046 00002ECA 894708              <1> 		mov [edi + 8], eax
  4047 00002ECD 89470C              <1> 		mov [edi + 12], eax
  4048 00002ED0 01D7                <1> 		add edi, edx
  4049 00002ED2 6641                <1> 		inc cx
  4050 00002ED4 6681F91000          <1> 		cmp cx, 16
  4051 00002ED9 72E1                <1> 		jb noyclr
  4052 00002EDB C3                  <1> 		ret
  4053                              <1> 
  4054                              <1> switchmousepos:		;;switch were the mouse is located
  4055 00002EDC BE[00120000]        <1> 		mov esi, mousecolorbuf
  4056 00002EE1 8B3D[FC760000]      <1> 		mov edi, [physbaseptr]
  4057 00002EE7 BA00000000          <1> 		mov edx, 0
  4058 00002EEC B900000000          <1> 		mov ecx, 0
  4059 00002EF1 668B15[C62B0000]    <1> 		mov dx, [lastmouseposition]
  4060 00002EF8 668B0D[C82B0000]    <1> 		mov cx, [lastmouseposition + 2]
  4061 00002EFF 01D7                <1> 		add edi, edx
  4062 00002F01 BA00000000          <1> 		mov edx, 0
  4063 00002F06 668B15[DC3C0000]    <1> 		mov dx, [resolutionx2]
  4064 00002F0D 6681F90000          <1> 		cmp cx, 0
  4065 00002F12 740B                <1> 		je noswmsy
  4066 00002F14 01D7                <1> swmsy:		add edi, edx
  4067 00002F16 6649                <1> 		dec cx
  4068 00002F18 6681F90000          <1> 		cmp cx, 0
  4069 00002F1D 75F5                <1> 		jne swmsy
  4070 00002F1F 8B06                <1> noswmsy:	mov eax, [esi]
  4071 00002F21 8B5E04              <1> 		mov ebx, [esi + 4]
  4072 00002F24 8907                <1> 		mov [edi], eax
  4073 00002F26 895F04              <1> 		mov [edi + 4], ebx
  4074 00002F29 8B4608              <1> 		mov eax, [esi + 8]
  4075 00002F2C 8B5E0C              <1> 		mov ebx, [esi + 12]
  4076 00002F2F 894708              <1> 		mov [edi + 8], eax
  4077 00002F32 895F0C              <1> 		mov [edi + 12], ebx
  4078 00002F35 01D7                <1> 		add edi, edx
  4079 00002F37 81C610000000        <1> 		add esi, 16
  4080 00002F3D 81FE[00130000]      <1> 		cmp esi, mcolorend
  4081 00002F43 72DA                <1> 		jb noswmsy
  4082                              <1> 		
  4083                              <1> switchmousepos2:
  4084 00002F45 BE[00120000]        <1> 		mov esi, mousecolorbuf
  4085 00002F4A 8B3D[FC760000]      <1> 		mov edi, [physbaseptr]
  4086 00002F50 BA00000000          <1> 		mov edx, 0
  4087 00002F55 B900000000          <1> 		mov ecx, 0
  4088 00002F5A 668B15[CA2B0000]    <1> 		mov dx, [mousecursorposition]
  4089 00002F61 668B0D[CC2B0000]    <1> 		mov cx, [mousecursorposition + 2]
  4090 00002F68 01D7                <1> 		add edi, edx
  4091 00002F6A BA00000000          <1> 		mov edx, 0
  4092 00002F6F 668B15[DC3C0000]    <1> 		mov dx, [resolutionx2]
  4093 00002F76 6681F90000          <1> 		cmp cx, 0
  4094 00002F7B 740B                <1> 		je noswmsy2
  4095 00002F7D 01D7                <1> swmsy2:		add edi, edx
  4096 00002F7F 6649                <1> 		dec cx
  4097 00002F81 6681F90000          <1> 		cmp cx, 0
  4098 00002F86 75F5                <1> 		jne swmsy2
  4099 00002F88 8B07                <1> noswmsy2:	mov eax, [edi]
  4100 00002F8A 8B5F04              <1> 		mov ebx, [edi + 4]
  4101 00002F8D 8906                <1> 		mov [esi], eax
  4102 00002F8F 895E04              <1> 		mov [esi + 4], ebx
  4103 00002F92 8B4708              <1> 		mov eax, [edi + 8]
  4104 00002F95 8B5F0C              <1> 		mov ebx, [edi + 12]
  4105 00002F98 894608              <1> 		mov [esi + 8], eax
  4106 00002F9B 895E0C              <1> 		mov [esi + 12], ebx
  4107 00002F9E 01D7                <1> 		add edi, edx
  4108 00002FA0 81C610000000        <1> 		add esi, 16
  4109 00002FA6 81FE[00130000]      <1> 		cmp esi, mcolorend
  4110 00002FAC 72DA                <1> 		jb noswmsy2
  4111 00002FAE C3                  <1> 		ret
  4112                              <1> 
  4113 00002FAF 00                  <1> pbutton db 0
  4114 00002FB0 00                  <1> pLBUTTON db 0
  4115 00002FB1 00                  <1> pRBUTTON db 0
  4116 00002FB2 00000000            <1> dragging dw 0,0
  4117 00002FB6 0000000000000000    <1> lastpos dw 0,0,0,0
  4118 00002FBE 00000000            <1> colorbuf dw 0,0
  4119                              <1> 	
  4120                              <1> 	clickicon:
  4121 00002FC2 B001                <1> 		mov al, 1
  4122 00002FC4 A2[AF2F0000]        <1> 		mov [pbutton], al
  4123 00002FC9 A0[B02F0000]        <1> 		mov al, [pLBUTTON]
  4124 00002FCE 2205[8D280000]      <1> 		and al, [LBUTTON]
  4125 00002FD4 8A25[B12F0000]      <1> 		mov ah, [pRBUTTON]
  4126 00002FDA 2225[8E280000]      <1> 		and ah, [RBUTTON]
  4127 00002FE0 08E0                <1> 		or al, ah
  4128 00002FE2 3C00                <1> 		cmp al, 0
  4129 00002FE4 741B                <1> 		je nodragclick
  4130 00002FE6 813D[B22F0000]0100- <1> 		cmp dword [dragging], 1
  4131 00002FEE 0000                <1>
  4132 00002FF0 732D                <1> 		jae dragclick
  4133 00002FF2 C705[B22F0000]0100- <1> 		mov dword [dragging], 1
  4134 00002FFA 0000                <1>
  4135 00002FFC E91E000000          <1> 		jmp dragclick
  4136                              <1> 	nodragclick:
  4137 00003001 C705[B22F0000]0000- <1> 		mov dword [dragging], 0
  4138 00003009 0000                <1>
  4139 0000300B A0[8D280000]        <1> 		mov al, [LBUTTON]
  4140 00003010 A2[B02F0000]        <1> 		mov [pLBUTTON], al
  4141 00003015 A0[8E280000]        <1> 		mov al, [RBUTTON]
  4142 0000301A A2[B12F0000]        <1> 		mov [pRBUTTON], al
  4143                              <1> 	dragclick:
  4144 0000301F 66B80000            <1> 		mov ax, 0
  4145 00003023 BE[00100000]        <1> 		mov esi, graphicstable
  4146 00003028 C705[833F0000]0000- <1> 		mov dword [codepointer], 0
  4147 00003030 0000                <1>
  4148                              <1> 	clicon2:
  4149 00003032 BA00000000          <1> 		mov edx, 0
  4150 00003037 B900000000          <1> 		mov ecx, 0
  4151 0000303C 66813E0100          <1> 		cmp word [esi], 1
  4152 00003041 0F841B000000        <1> 		je near iconselect
  4153 00003047 66813E0200          <1> 		cmp word [esi], 2
  4154 0000304C 0F8472010000        <1> 		je near textselected
  4155 00003052 66813E0300          <1> 		cmp word [esi], 3
  4156 00003057 0F84C7020000        <1> 		je near windowselect
  4157 0000305D E90B040000          <1> 		jmp nexticonsel
  4158                              <1> 	iconselect:
  4159 00003062 668B5606            <1> 		mov dx, [esi + 6]
  4160 00003066 6689D0              <1> 		mov ax, dx
  4161 00003069 668B4E08            <1> 		mov cx, [esi + 8]
  4162 0000306D 6689CB              <1> 		mov bx, cx
  4163 00003070 6681C32000          <1> 		add bx, 32
  4164 00003075 6601D0              <1> 		add ax, dx
  4165 00003078 813D[B22F0000]0100- <1> 		cmp dword [dragging], 1
  4166 00003080 0000                <1>
  4167 00003082 746F                <1> 		je dragicon
  4168 00003084 813D[B22F0000]0000- <1> 		cmp dword [dragging], 0
  4169 0000308C 0000                <1>
  4170 0000308E 7411                <1> 		je nodragiconcheck
  4171 00003090 3935[B22F0000]      <1> 		cmp dword [dragging], esi
  4172 00003096 0F85D1030000        <1> 		jne near nexticonsel
  4173 0000309C E952000000          <1> 		jmp dragicon
  4174                              <1> 	nodragiconcheck:
  4175 000030A1 663905[CA2B0000]    <1> 		cmp [mousecursorposition], ax
  4176 000030A8 0F82BF030000        <1> 		jb near nexticonsel
  4177 000030AE 66054000            <1> 		add ax, 64
  4178 000030B2 663905[CA2B0000]    <1> 		cmp [mousecursorposition], ax
  4179 000030B9 0F87AE030000        <1> 		ja near nexticonsel
  4180 000030BF 6629D0              <1> 		sub ax, dx
  4181 000030C2 66390D[CC2B0000]    <1> 		cmp [mousecursorposition + 2], cx
  4182 000030C9 0F829E030000        <1> 		jb near nexticonsel
  4183 000030CF 66391D[CC2B0000]    <1> 		cmp [mousecursorposition + 2], bx
  4184 000030D6 0F8791030000        <1> 		ja near nexticonsel
  4185 000030DC 668B460A            <1> 		mov ax, [esi + 10]
  4186 000030E0 66250100            <1> 		and ax, 1
  4187 000030E4 663D0100            <1> 		cmp ax, 1
  4188 000030E8 0F84B6000000        <1> 		je near unselecticon
  4189 000030EE E98D000000          <1> 		jmp nodragicon
  4190                              <1> 	dragicon:
  4191 000030F3 663905[C62B0000]    <1> 		cmp [lastmouseposition], ax
  4192 000030FA 0F826D030000        <1> 		jb near nexticonsel
  4193 00003100 66054000            <1> 		add ax, 64
  4194 00003104 663905[C62B0000]    <1> 		cmp [lastmouseposition], ax
  4195 0000310B 0F875C030000        <1> 		ja near nexticonsel
  4196 00003111 6629D0              <1> 		sub ax, dx
  4197 00003114 66390D[C82B0000]    <1> 		cmp [lastmouseposition + 2], cx
  4198 0000311B 0F824C030000        <1> 		jb near nexticonsel
  4199 00003121 66391D[C82B0000]    <1> 		cmp [lastmouseposition + 2], bx
  4200 00003128 0F873F030000        <1> 		ja near nexticonsel
  4201 0000312E 668B460A            <1> 		mov ax, [esi + 10]
  4202 00003132 2410                <1> 		and al, 00010000b
  4203 00003134 3C10                <1> 		cmp al, 00010000b
  4204 00003136 7448                <1> 		je nodragicon
  4205 00003138 8935[B22F0000]      <1> 		mov [dragging], esi
  4206 0000313E 66D1E2              <1> 		shl dx, 1
  4207 00003141 662B15[C62B0000]    <1> 		sub dx, [lastmouseposition]
  4208 00003148 660315[CA2B0000]    <1> 		add dx, [mousecursorposition]
  4209 0000314F 66D1EA              <1> 		shr dx, 1
  4210 00003152 66030D[CC2B0000]    <1> 		add cx, [mousecursorposition + 2]
  4211 00003159 662B0D[C82B0000]    <1> 		sub cx, [lastmouseposition + 2]
  4212 00003160 663B15[DC3C0000]    <1> 		cmp dx, [resolutionx2]
  4213 00003167 7607                <1> 		jbe chkyresdrgicn
  4214 00003169 668B15[CA2B0000]    <1> 		mov dx, [mousecursorposition]
  4215                              <1> 	chkyresdrgicn:
  4216 00003170 663B0D[D83C0000]    <1> 		cmp cx, [resolutiony]
  4217 00003177 7607                <1> 		jbe nodragicon
  4218 00003179 668B0D[CC2B0000]    <1> 		mov cx, [mousecursorposition + 2]
  4219                              <1> 	nodragicon:
  4220 00003180 66814E0A0100        <1> 		or word [esi + 10], 1
  4221 00003186 8B5E0C              <1> 		mov ebx, [esi + 12]
  4222 00003189 668B460A            <1> 		mov ax, [esi + 10]
  4223 0000318D 8B7602              <1> 		mov esi, [esi + 2]
  4224 00003190 C705[833F0000]0000- <1> 		mov dword [codepointer], 0
  4225 00003198 0000                <1>
  4226 0000319A E8600A0000          <1> 		call showicon
  4227 0000319F E9E2020000          <1> 		jmp doneiconsel
  4228                              <1> 	unselecticon:
  4229 000031A4 6681660AFEFF        <1> 		and word [esi + 10], 0xFFFE
  4230 000031AA 8B5E0C              <1> 		mov ebx, [esi + 12]
  4231 000031AD 668B460A            <1> 		mov ax, [esi + 10]
  4232 000031B1 8B7602              <1> 		mov esi, [esi + 2]
  4233 000031B4 891D[833F0000]      <1> 		mov [codepointer], ebx
  4234 000031BA E8400A0000          <1> 		call showicon
  4235 000031BF E9C2020000          <1> 		jmp doneiconsel
  4236                              <1> 	textselected:
  4237 000031C4 8B5E02              <1> 		mov ebx, [esi + 2]
  4238 000031C7 668B5606            <1> 		mov dx, [esi + 6]
  4239 000031CB 6689D0              <1> 		mov ax, dx
  4240 000031CE 668B4E08            <1> 		mov cx, [esi + 8]
  4241                              <1> 	lengthtesttext:
  4242 000031D2 803B00              <1> 		cmp byte [ebx], 0
  4243 000031D5 7407                <1> 		je donetesttextlength
  4244 000031D7 43                  <1> 		inc ebx
  4245 000031D8 66051000            <1> 		add ax, 16
  4246 000031DC EBF4                <1> 		jmp lengthtesttext
  4247                              <1> 	donetesttextlength:
  4248 000031DE 6689CB              <1> 		mov bx, cx
  4249 000031E1 6681C30F00          <1> 		add bx, 15
  4250 000031E6 813D[B22F0000]0100- <1> 		cmp dword [dragging], 1
  4251 000031EE 0000                <1>
  4252 000031F0 7468                <1> 		je dragtext
  4253 000031F2 813D[B22F0000]0000- <1> 		cmp dword [dragging], 0
  4254 000031FA 0000                <1>
  4255 000031FC 7411                <1> 		je nodragtextcheck
  4256 000031FE 3935[B22F0000]      <1> 		cmp dword [dragging], esi
  4257 00003204 0F8563020000        <1> 		jne near nexticonsel
  4258 0000320A E94B000000          <1> 		jmp dragtext
  4259                              <1> 	nodragtextcheck:
  4260 0000320F 663915[CA2B0000]    <1> 		cmp [mousecursorposition], dx
  4261 00003216 0F8251020000        <1> 		jb near nexticonsel
  4262 0000321C 663905[CA2B0000]    <1> 		cmp [mousecursorposition], ax
  4263 00003223 0F8744020000        <1> 		ja near nexticonsel
  4264 00003229 66390D[CC2B0000]    <1> 		cmp [mousecursorposition + 2], cx
  4265 00003230 0F8237020000        <1> 		jb near nexticonsel
  4266 00003236 66391D[CC2B0000]    <1> 		cmp [mousecursorposition + 2], bx
  4267 0000323D 0F872A020000        <1> 		ja near nexticonsel
  4268 00003243 668B460A            <1> 		mov ax, [esi + 10]
  4269 00003247 66250100            <1> 		and ax, 1
  4270 0000324B 663D0100            <1> 		cmp ax, 1
  4271 0000324F 0F84AB000000        <1> 		je near unselecttext
  4272 00003255 E986000000          <1> 		jmp nodragtext
  4273                              <1> 	dragtext:
  4274 0000325A 663915[C62B0000]    <1> 		cmp [lastmouseposition], dx
  4275 00003261 0F8206020000        <1> 		jb near nexticonsel
  4276 00003267 663905[C62B0000]    <1> 		cmp [lastmouseposition], ax
  4277 0000326E 0F87F9010000        <1> 		ja near nexticonsel
  4278 00003274 66390D[C82B0000]    <1> 		cmp [lastmouseposition + 2], cx
  4279 0000327B 0F82EC010000        <1> 		jb near nexticonsel
  4280 00003281 66391D[C82B0000]    <1> 		cmp [lastmouseposition + 2], bx
  4281 00003288 0F87DF010000        <1> 		ja near nexticonsel
  4282 0000328E 668B460A            <1> 		mov ax, [esi + 10]
  4283 00003292 2410                <1> 		and al, 00010000b
  4284 00003294 663D1000            <1> 		cmp ax, 00010000b
  4285 00003298 0F8442000000        <1> 		je near nodragtext
  4286 0000329E 8935[B22F0000]      <1> 		mov [dragging], esi
  4287 000032A4 662B15[C62B0000]    <1> 		sub dx, [lastmouseposition]
  4288 000032AB 660315[CA2B0000]    <1> 		add dx, [mousecursorposition]
  4289 000032B2 66030D[CC2B0000]    <1> 		add cx, [mousecursorposition + 2]
  4290 000032B9 662B0D[C82B0000]    <1> 		sub cx, [lastmouseposition + 2]
  4291 000032C0 663B15[DC3C0000]    <1> 		cmp dx, [resolutionx2]
  4292 000032C7 7607                <1> 		jbe chkyresdrgtxt
  4293 000032C9 668B15[CA2B0000]    <1> 		mov dx, [mousecursorposition]
  4294                              <1> 	chkyresdrgtxt:
  4295 000032D0 663B0D[D83C0000]    <1> 		cmp cx, [resolutiony]
  4296 000032D7 7607                <1> 		jbe nodragtext
  4297 000032D9 668B0D[CC2B0000]    <1> 		mov cx, [mousecursorposition + 2]
  4298                              <1> 	nodragtext:
  4299 000032E0 66814E0A0100        <1> 		or word [esi + 10], 1
  4300 000032E6 8B5E0C              <1> 		mov ebx, [esi + 12]
  4301 000032E9 891D[833F0000]      <1> 		mov [codepointer], ebx
  4302 000032EF 668B460A            <1> 		mov ax, [esi + 10]
  4303 000032F3 8B7602              <1> 		mov esi, [esi + 2]
  4304 000032F6 E848050000          <1> 		call showstring
  4305 000032FB E986010000          <1> 		jmp doneiconsel
  4306                              <1> 	unselecttext:
  4307 00003300 6681660AFEFF        <1> 		and word [esi + 10], 0xFFFE
  4308 00003306 8B5E0C              <1> 		mov ebx, [esi + 12]
  4309 00003309 668B460A            <1> 		mov ax, [esi + 10]
  4310 0000330D 8B7602              <1> 		mov esi, [esi + 2]
  4311 00003310 C705[833F0000]0000- <1> 		mov dword [codepointer], 0
  4312 00003318 0000                <1>
  4313 0000331A E824050000          <1> 		call showstring
  4314 0000331F E962010000          <1> 		jmp doneiconsel
  4315                              <1> windowselect:
  4316 00003324 8B7E02              <1> 		mov edi, [esi + 2]
  4317 00003327 668B5606            <1> 		mov dx, [esi + 6]
  4318 0000332B 6689D0              <1> 		mov ax, dx
  4319 0000332E 668B4E08            <1> 		mov cx, [esi + 8]
  4320 00003332 6689CB              <1> 		mov bx, cx
  4321 00003335 6681C31000          <1> 		add bx, 16
  4322 0000333A 813D[B22F0000]0100- <1> 		cmp dword [dragging], 1
  4323 00003342 0000                <1>
  4324 00003344 746D                <1> 		je dragwin
  4325 00003346 813D[B22F0000]0000- <1> 		cmp dword [dragging], 0
  4326 0000334E 0000                <1>
  4327 00003350 7411                <1> 		je nodragwincheck
  4328 00003352 3935[B22F0000]      <1> 		cmp dword [dragging], esi
  4329 00003358 0F850F010000        <1> 		jne near nexticonsel
  4330 0000335E E950000000          <1> 		jmp dragwin
  4331                              <1> 	nodragwincheck:
  4332 00003363 663905[CA2B0000]    <1> 		cmp [mousecursorposition], ax
  4333 0000336A 0F82FD000000        <1> 		jb near nexticonsel
  4334 00003370 660307              <1> 		add ax, [edi]
  4335 00003373 660307              <1> 		add ax, [edi]
  4336 00003376 663905[CA2B0000]    <1> 		cmp [mousecursorposition], ax
  4337 0000337D 0F87EA000000        <1> 		ja near nexticonsel
  4338 00003383 66390D[CC2B0000]    <1> 		cmp [mousecursorposition + 2], cx
  4339 0000338A 0F82DD000000        <1> 		jb near nexticonsel
  4340 00003390 66391D[CC2B0000]    <1> 		cmp [mousecursorposition + 2], bx
  4341 00003397 0F87D0000000        <1> 		ja near nexticonsel
  4342 0000339D 662D1400            <1> 		sub ax, 20
  4343 000033A1 663905[CA2B0000]    <1> 		cmp [mousecursorposition], ax
  4344 000033A8 0F8795000000        <1> 		ja near killwin
  4345 000033AE E97C000000          <1> 		jmp nodragwin
  4346                              <1> 	dragwin:
  4347 000033B3 663905[C62B0000]    <1> 		cmp [lastmouseposition], ax
  4348 000033BA 0F82AD000000        <1> 		jb near nexticonsel
  4349 000033C0 660307              <1> 		add ax, [edi]
  4350 000033C3 660307              <1> 		add ax, [edi]
  4351 000033C6 663905[C62B0000]    <1> 		cmp [lastmouseposition], ax
  4352 000033CD 0F879A000000        <1> 		ja near nexticonsel
  4353 000033D3 66390D[C82B0000]    <1> 		cmp [lastmouseposition + 2], cx
  4354 000033DA 0F828D000000        <1> 		jb near nexticonsel
  4355 000033E0 66391D[C82B0000]    <1> 		cmp [lastmouseposition + 2], bx
  4356 000033E7 0F8780000000        <1> 		ja near nexticonsel
  4357 000033ED 8935[B22F0000]      <1> 		mov [dragging], esi
  4358 000033F3 662B15[C62B0000]    <1> 		sub dx, [lastmouseposition]
  4359 000033FA 660315[CA2B0000]    <1> 		add dx, [mousecursorposition]
  4360 00003401 66030D[CC2B0000]    <1> 		add cx, [mousecursorposition + 2]
  4361 00003408 662B0D[C82B0000]    <1> 		sub cx, [lastmouseposition + 2]
  4362 0000340F 663B15[DC3C0000]    <1> 		cmp dx, [resolutionx2]
  4363 00003416 7607                <1> 		jbe chkyresdrgwin
  4364 00003418 668B15[CA2B0000]    <1> 		mov dx, [mousecursorposition]
  4365                              <1> 	chkyresdrgwin:
  4366 0000341F 663B0D[D83C0000]    <1> 		cmp cx, [resolutiony]
  4367 00003426 7607                <1> 		jbe nodragwin
  4368 00003428 668B0D[CC2B0000]    <1> 		mov cx, [mousecursorposition + 2]
  4369                              <1> 	nodragwin:
  4370 0000342F 8B5E0C              <1> 		mov ebx, [esi + 12]
  4371 00003432 668B460A            <1> 		mov ax, [esi + 10]
  4372 00003436 8B7602              <1> 		mov esi, [esi + 2]
  4373 00003439 E85B040000          <1> 		call showwindow
  4374 0000343E E943000000          <1> 		jmp doneiconsel
  4375                              <1> 	killwin:
  4376 00003443 66C7060000          <1> 		mov word [esi], 0
  4377 00003448 C705[CC030000]0000- <1> 		mov dword [user2codepoint], 0
  4378 00003450 0000                <1>
  4379 00003452 C605[750A0000]00    <1> 		mov byte [termguion], 0
  4380 00003459 E881F8FFFF          <1> 		call guiclear
  4381 0000345E E899000000          <1> 		call reloadallgraphics
  4382 00003463 E9FBF9FFFF          <1> 		jmp guistart
  4383 00003468 E93A000000          <1> 		jmp doneiconsel2
  4384                              <1> 	nexticonsel:
  4385 0000346D 6681660AFEFF        <1> 		and word [esi + 10], 0xFFFE
  4386 00003473 81C610000000        <1> 		add esi, 16
  4387 00003479 81FE[00120000]      <1> 		cmp esi, graphicstableend
  4388 0000347F 7305                <1> 		jae doneiconsel
  4389 00003481 E9ACFBFFFF          <1> 		jmp clicon2
  4390                              <1> 	doneiconsel:
  4391 00003486 813D[B22F0000]0100- <1> 		cmp dword [dragging], 1
  4392 0000348E 0000                <1>
  4393 00003490 7315                <1> 		jae doneiconsel2
  4394 00003492 813D[833F0000]0000- <1> 		cmp dword [codepointer], 0
  4395 0000349A 0000                <1>
  4396 0000349C 7409                <1> 		je doneiconsel2
  4397 0000349E 8B1D[833F0000]      <1> 		mov ebx, [codepointer]
  4398 000034A4 FFD3                <1> 		call ebx 
  4399 000034A6 C3                  <1> 		ret
  4400                              <1> 	doneiconsel2:
  4401 000034A7 A0[8D280000]        <1> 		mov al, [LBUTTON]
  4402 000034AC A2[B02F0000]        <1> 		mov [pLBUTTON], al
  4403 000034B1 A0[8E280000]        <1> 		mov al, [RBUTTON]
  4404 000034B6 A2[B12F0000]        <1> 		mov [pRBUTTON], al
  4405 000034BB E83C000000          <1> call reloadallgraphics
  4406 000034C0 B900000000          <1> 		mov ecx, 0
  4407 000034C5 BA00000000          <1> 		mov edx, 0
  4408 000034CA B400                <1> 		mov ah, 0
  4409 000034CC B080                <1> 		mov al, 128
  4410 000034CE 668B15[CA2B0000]    <1> 		mov dx, [mousecursorposition]
  4411 000034D5 668B0D[CC2B0000]    <1> 		mov cx, [mousecursorposition + 2]
  4412 000034DC 66BBE738            <1> 		mov bx, 0011100011100111b
  4413 000034E0 C605[752E0000]01    <1> 		mov byte [showcursorfonton], 1
  4414 000034E7 E800080000          <1> 		call showfontvesa
  4415 000034EC C605[752E0000]00    <1> 		mov byte [showcursorfonton], 0
  4416 000034F3 C3                  <1> 		ret
  4417 000034F4 00000000            <1> lastdrag dw 0,0
  4418 000034F8 00000000            <1> grpctblpos dw 0,0
  4419                              <1> 
  4420                              <1> reloadallgraphics:
  4421 000034FC BF[00100000]        <1> 		mov edi, graphicstable
  4422                              <1> reloadgraphicsloop:
  4423 00003501 8B7702              <1> 		mov esi, [edi + 2]
  4424 00003504 668B5706            <1> 		mov dx, [edi + 6]
  4425 00003508 668B4F08            <1> 		mov cx, [edi + 8]
  4426 0000350C 668B07              <1> 		mov ax, [edi]
  4427 0000350F 668B5F0A            <1> 		mov bx, [edi + 10]
  4428 00003513 893D[F8340000]      <1> 		mov [grpctblpos], edi
  4429 00003519 3B3D[B22F0000]      <1> 		cmp edi, [dragging]
  4430 0000351F 741E                <1> 		je loadedgraphic
  4431 00003521 663D0100            <1> 		cmp ax, 1
  4432 00003525 0F8431000000        <1> 		je near icongraphic
  4433 0000352B 663D0200            <1> 		cmp ax, 2
  4434 0000352F 0F8437000000        <1> 		je near stringgraphic
  4435 00003535 663D0300            <1> 		cmp ax, 3
  4436 00003539 0F8416000000        <1> 		je near windowgraphic
  4437 0000353F 8B3D[F8340000]      <1> loadedgraphic:  mov edi, [grpctblpos]
  4438 00003545 81C710000000        <1> 		add edi, 16
  4439 0000354B 81FF[00120000]      <1> 		cmp edi, graphicstableend
  4440 00003551 7329                <1> 		jae donereloadgraphics
  4441 00003553 EBAC                <1> 		jmp reloadgraphicsloop
  4442 00003555 E892030000          <1> windowgraphic:	call showwindow2
  4443 0000355A EBE3                <1> 		jmp loadedgraphic
  4444 0000355C 80E301              <1> icongraphic:	and bl, 1
  4445 0000355F 881D[873F0000]      <1> 		mov [iconselected], bl
  4446 00003565 E8A8060000          <1> 		call showicon2
  4447 0000356A EBD3                <1> 		jmp loadedgraphic
  4448 0000356C 80E301              <1> stringgraphic:  and bl, 1
  4449 0000356F 881D[772E0000]      <1> 		mov [mouseselecton], bl
  4450 00003575 E8DC020000          <1> 		call showstring2
  4451 0000357A EBC3                <1> 		jmp loadedgraphic
  4452                              <1> donereloadgraphics:
  4453 0000357C 8B3D[B22F0000]      <1> 		mov edi, [dragging]
  4454 00003582 81FF[00100000]      <1> 		cmp edi, graphicstable
  4455 00003588 7226                <1> 		jb notcorrectdrag
  4456 0000358A 668B07              <1> 		mov ax, [edi]
  4457 0000358D 8B7702              <1> 		mov esi, [edi + 2]
  4458 00003590 668B5706            <1> 		mov dx, [edi + 6]
  4459 00003594 668B4F08            <1> 		mov cx, [edi + 8]
  4460 00003598 668B5F0A            <1> 		mov bx, [edi + 10]
  4461 0000359C 663D0100            <1> 		cmp ax, 1
  4462 000035A0 750F                <1> 		jne noticondragging
  4463 000035A2 80E301              <1> 		and bl, 1
  4464 000035A5 881D[873F0000]      <1> 		mov [iconselected], bl
  4465 000035AB E862060000          <1> 		call showicon2
  4466                              <1> notcorrectdrag:
  4467 000035B0 C3                  <1> 		ret
  4468                              <1> 
  4469                              <1> 	noticondragging:
  4470 000035B1 663D0200            <1> 		cmp ax, 2
  4471 000035B5 75F9                <1> 		jne notcorrectdrag
  4472 000035B7 80E301              <1> 		and bl, 1
  4473 000035BA 881D[772E0000]      <1> 		mov [mouseselecton], bl
  4474 000035C0 E891020000          <1> 		call showstring2
  4475 000035C5 EBE9                <1> 		jmp notcorrectdrag
  4476                              <1> 
  4477 000035C7 00<rept>            <1> grphbuf times 16 db 0
  4478                              <1> 	graphicsadd:
  4479 000035D7 BF[00100000]        <1> 		mov edi, graphicstable
  4480                              <1> 	shwgrph1:
  4481 000035DC 397702              <1> 		cmp dword [edi + 2], esi
  4482 000035DF 7414                <1> 		je showgraphicsreplace2
  4483 000035E1 81C710000000        <1> 		add edi, 16
  4484 000035E7 81FF[00120000]      <1> 		cmp edi, graphicstableend
  4485 000035ED 0F8335020000        <1> 		jae near showgraphicsnew
  4486 000035F3 EBE7                <1> 		jmp shwgrph1
  4487                              <1> 	showgraphicsreplace2:
  4488 000035F5 8935[C9350000]      <1> 		mov [grphbuf + 2], esi
  4489 000035FB 668915[CD350000]    <1> 		mov [grphbuf + 6], dx
  4490 00003602 66890D[CF350000]    <1> 		mov [grphbuf + 8], cx
  4491 00003609 891D[D3350000]      <1> 		mov [grphbuf + 12], ebx
  4492 0000360F B700                <1> 		mov bh, 0
  4493 00003611 88E3                <1> 		mov bl, ah
  4494 00003613 B400                <1> 		mov ah, 0
  4495 00003615 66A3[D1350000]      <1> 		mov [grphbuf + 10], ax	
  4496 0000361B 66891D[C7350000]    <1> 		mov [grphbuf], bx
  4497 00003622 66A1[C7350000]      <1> 		mov ax, [grphbuf]
  4498 00003628 663D0100            <1> 		cmp ax, 1
  4499 0000362C 0F8419000000        <1> 		je near replaceicon
  4500 00003632 663D0200            <1> 		cmp ax, 2
  4501 00003636 0F8493000000        <1> 		je near replacestring
  4502 0000363C 663D0300            <1> 		cmp ax, 3
  4503 00003640 0F840F010000        <1> 		je near replacewindow
  4504 00003646 E9BA010000          <1> 		jmp showgraphicsreplace
  4505                              <1> 	replaceicon:
  4506 0000364B 893D[B62F0000]      <1> 		mov [lastpos], edi
  4507 00003651 8935[BA2F0000]      <1> 		mov [lastpos + 4], esi
  4508 00003657 8B7702              <1> 		mov esi, [edi + 2]
  4509 0000365A 668B5F0C            <1> 		mov bx, [edi + 12]
  4510 0000365E 668B5706            <1> 		mov dx, [edi + 6]
  4511 00003662 668B4F08            <1> 		mov cx, [edi + 8]
  4512 00003666 668B06              <1> 		mov ax, [esi]
  4513 00003669 66A3[BE2F0000]      <1> 		mov [colorbuf], ax
  4514 0000366F 66A1[1C2D0000]      <1> 		mov ax, [background]
  4515 00003675 668906              <1> 		mov [esi], ax
  4516 00003678 8B5F0C              <1> 		mov ebx, [edi + 12]
  4517 0000367B 668B470A            <1> 		mov ax, [edi + 10]
  4518 0000367F 2401                <1> 		and al, 1
  4519 00003681 A2[873F0000]        <1> 		mov [iconselected], al
  4520 00003686 668B470A            <1> 		mov ax, [edi + 10]
  4521 0000368A E883050000          <1> 		call showicon2
  4522 0000368F 8B3D[B62F0000]      <1> 		mov edi, [lastpos]
  4523 00003695 8B7702              <1> 		mov esi, [edi + 2]
  4524 00003698 66A1[BE2F0000]      <1> 		mov ax, [colorbuf]
  4525 0000369E 668906              <1> 		mov [esi], ax
  4526 000036A1 8B35[BA2F0000]      <1> 		mov esi, [lastpos + 4]
  4527 000036A7 668B15[CD350000]    <1> 		mov dx, [grphbuf + 6]
  4528 000036AE 668B0D[CF350000]    <1> 		mov cx, [grphbuf + 8]
  4529 000036B5 668B1D[C7350000]    <1> 		mov bx, [grphbuf]
  4530 000036BC 66A1[D1350000]      <1> 		mov ax, [grphbuf + 10]
  4531 000036C2 88DC                <1> 		mov ah, bl
  4532 000036C4 8B1D[D3350000]      <1> 		mov ebx, [grphbuf + 12]
  4533 000036CA E936010000          <1> 		jmp showgraphicsreplace
  4534                              <1> 	replacestring:
  4535 000036CF 893D[B62F0000]      <1> 		mov [lastpos], edi
  4536 000036D5 8935[BA2F0000]      <1> 		mov [lastpos + 4], esi
  4537 000036DB 8B5F0C              <1> 		mov ebx, [edi + 12]
  4538 000036DE 8B7702              <1> 		mov esi, [edi + 2]
  4539 000036E1 668B5706            <1> 		mov dx, [edi + 6]
  4540 000036E5 668B4F08            <1> 		mov cx, [edi + 8]
  4541 000036E9 66A1[86380000]      <1> 		mov ax, [colorfont2]
  4542 000036EF 66A3[BE2F0000]      <1> 		mov [colorbuf], ax
  4543 000036F5 66A1[1C2D0000]      <1> 		mov ax, [background]
  4544 000036FB 66A3[86380000]      <1> 		mov [colorfont2], ax		
  4545 00003701 8B5F0C              <1> 		mov ebx, [edi + 12]
  4546 00003704 668B470A            <1> 		mov ax, [edi + 10]
  4547 00003708 2401                <1> 		and al, 1
  4548 0000370A A2[772E0000]        <1> 		mov [mouseselecton], al
  4549 0000370F 668B470A            <1> 		mov ax, [edi + 10]
  4550 00003713 E83E010000          <1> 		call showstring2
  4551 00003718 66A1[BE2F0000]      <1> 		mov ax, [colorbuf]
  4552 0000371E 66A3[86380000]      <1> 		mov [colorfont2], ax
  4553 00003724 8B3D[B62F0000]      <1> 		mov edi, [lastpos]
  4554 0000372A 8B7702              <1> 		mov esi, [edi + 2]
  4555 0000372D 668B15[CD350000]    <1> 		mov dx, [grphbuf + 6]
  4556 00003734 668B0D[CF350000]    <1> 		mov cx, [grphbuf + 8]
  4557 0000373B 668B1D[C7350000]    <1> 		mov bx, [grphbuf]
  4558 00003742 66A1[D1350000]      <1> 		mov ax, [grphbuf + 10]
  4559 00003748 88DC                <1> 		mov ah, bl
  4560 0000374A 8B1D[D3350000]      <1> 		mov ebx, [grphbuf + 12]
  4561 00003750 E9B0000000          <1> 		jmp showgraphicsreplace
  4562                              <1> 	replacewindow:
  4563 00003755 893D[B62F0000]      <1> 		mov [lastpos], edi
  4564 0000375B 8935[BA2F0000]      <1> 		mov [lastpos + 4], esi
  4565 00003761 8B7702              <1> 		mov esi, [edi + 2]
  4566 00003764 8B3D[95380000]      <1> 		mov edi, [windowbufloc]
  4567 0000376A BA00000000          <1> 		mov edx, 0
  4568 0000376F 668B15[DC3C0000]    <1> 		mov dx, [resolutionx2]
  4569 00003776 C1E204              <1> 		shl edx, 4
  4570 00003779 29D7                <1> 		sub edi, edx
  4571 0000377B BA00000000          <1> 		mov edx, 0
  4572 00003780 668B16              <1> 		mov dx, [esi]
  4573 00003783 660316              <1> 		add dx, [esi]
  4574 00003786 668B4E02            <1> 		mov cx, [esi + 2]
  4575 0000378A 6681C11000          <1> 		add cx, 16
  4576 0000378F 66A1[1C2D0000]      <1> 		mov ax, [background]
  4577                              <1> 	clearwindow:
  4578 00003795 668907              <1> 		mov [edi], ax
  4579 00003798 81C702000000        <1> 		add edi, 2
  4580 0000379E 81EA02000000        <1> 		sub edx, 2
  4581 000037A4 81FA00000000        <1> 		cmp edx, 0
  4582 000037AA 75E9                <1> 		jne clearwindow
  4583 000037AC 6649                <1> 		dec cx
  4584 000037AE 668B15[DC3C0000]    <1> 		mov dx, [resolutionx2]
  4585 000037B5 662B16              <1> 		sub dx, [esi]
  4586 000037B8 662B16              <1> 		sub dx, [esi]
  4587 000037BB 01D7                <1> 		add edi, edx
  4588 000037BD 668B16              <1> 		mov dx, [esi]
  4589 000037C0 660316              <1> 		add dx, [esi]
  4590 000037C3 6681F90000          <1> 		cmp cx, 0
  4591 000037C8 75CB                <1> 		jne clearwindow
  4592 000037CA C605[760A0000]00    <1> 		mov byte [termcopyon], 0
  4593 000037D1 8B3D[B62F0000]      <1> 		mov edi, [lastpos]
  4594 000037D7 8B35[C9350000]      <1> 		mov esi, [grphbuf + 2]
  4595 000037DD 668B15[CD350000]    <1> 		mov dx, [grphbuf + 6]
  4596 000037E4 668B0D[CF350000]    <1> 		mov cx, [grphbuf + 8]
  4597 000037EB 668B1D[C7350000]    <1> 		mov bx, [grphbuf]
  4598 000037F2 66A1[D1350000]      <1> 		mov ax, [grphbuf + 10]
  4599 000037F8 88DC                <1> 		mov ah, bl
  4600 000037FA 8B1D[D3350000]      <1> 		mov ebx, [grphbuf + 12]
  4601 00003800 E900000000          <1> 		jmp showgraphicsreplace
  4602                              <1> 	showgraphicsreplace:
  4603 00003805 897702              <1> 		mov [edi + 2], esi
  4604 00003808 66895706            <1> 		mov [edi + 6], dx
  4605 0000380C 66894F08            <1> 		mov [edi + 8], cx
  4606 00003810 895F0C              <1> 		mov [edi + 12], ebx
  4607 00003813 B700                <1> 		mov bh, 0
  4608 00003815 88E3                <1> 		mov bl, ah
  4609 00003817 B400                <1> 		mov ah, 0
  4610 00003819 6689470A            <1> 		mov [edi + 10], ax
  4611 0000381D 66891F              <1> 		mov [edi], bx
  4612 00003820 8B5F0C              <1> 		mov ebx, [edi + 12]
  4613 00003823 668B470A            <1> 		mov ax, [edi + 10]
  4614 00003827 C3                  <1> 		ret
  4615                              <1> 	showgraphicsnew:
  4616 00003828 BF[00100000]        <1> 		mov edi, graphicstable
  4617                              <1> 	shwgrph2:
  4618 0000382D 66813F0000          <1> 		cmp word [edi], 0
  4619 00003832 74D1                <1> 		je showgraphicsreplace
  4620 00003834 81C710000000        <1> 		add edi, 16
  4621 0000383A 81FF[00120000]      <1> 		cmp edi, graphicstableend
  4622 00003840 72EB                <1> 		jb shwgrph2
  4623                              <1> 	showgraphicsdone:
  4624 00003842 C3                  <1> 		ret
  4625                              <1> 
  4626                              <1> 	showstring:
  4627 00003843 A2[772E0000]        <1> 		mov [mouseselecton], al
  4628 00003848 8025[772E0000]01    <1> 		and byte [mouseselecton], 1
  4629 0000384F B402                <1> 		mov ah, 2
  4630 00003851 E881FDFFFF          <1> 		call graphicsadd
  4631                              <1> 	showstring2:
  4632 00003856 B400                <1> 		mov ah, 0
  4633 00003858 8A06                <1> 		mov al, [esi]
  4634 0000385A 3C00                <1> 		cmp al, 0
  4635 0000385C 7420                <1> 		je doneshowstring
  4636 0000385E 46                  <1> 		inc esi
  4637 0000385F 8935[303F0000]      <1> 		mov [showstringesi], esi
  4638 00003865 668B1D[86380000]    <1> 		mov bx, [colorfont2]
  4639 0000386C E87B040000          <1> 		call showfontvesa
  4640 00003871 6681C20800          <1> 		add dx, 8
  4641 00003876 8B35[303F0000]      <1> 		mov esi, [showstringesi]
  4642 0000387C EBD8                <1> 		jmp showstring2
  4643                              <1> 	doneshowstring:
  4644 0000387E C605[772E0000]00    <1> 		mov byte [mouseselecton], 0
  4645 00003885 C3                  <1> 		ret
  4646                              <1> 
  4647 00003886 FFFF                <1> colorfont2 dw 0xFFFF
  4648 00003888 00                  <1> colorcache db 0
  4649 00003889 0000                <1> winvcopystx dw 0
  4650 0000388B 0000                <1> winvcopysty dw 0
  4651 0000388D 0000                <1> winvcopydx dw 0
  4652 0000388F 0000                <1> winvcopycx dw 0
  4653 00003891 FFFF0000            <1> windowcolor dw 0xFFFF,0x0
  4654 00003895 00000000            <1> windowbufloc: dw 0,0
  4655                              <1> 
  4656                              <1> 	showwindow:	;;windowstuff in si, position in (dx, cx), nothing in ax, code in bx
  4657 00003899 C605[750A0000]01    <1> 		mov byte [termguion], 1
  4658 000038A0 6681C11000          <1> 		add cx, 16
  4659 000038A5 668915[89380000]    <1> 		mov [winvcopystx], dx
  4660 000038AC 66890D[8B380000]    <1> 		mov [winvcopysty], cx
  4661 000038B3 668B16              <1> 		mov dx, [esi]
  4662 000038B6 668B4E02            <1> 		mov cx, [esi + 2]
  4663 000038BA 6601D2              <1> 		add dx, dx
  4664 000038BD 668915[8D380000]    <1> 		mov [winvcopydx], dx
  4665 000038C4 66890D[8F380000]    <1> 		mov [winvcopycx], cx
  4666 000038CB 668B0D[8B380000]    <1> 		mov cx, [winvcopysty]
  4667 000038D2 6681E91000          <1> 		sub cx, 16
  4668 000038D7 668B15[89380000]    <1> 		mov dx, [winvcopystx]
  4669 000038DE C605[760A0000]00    <1> 		mov byte [termcopyon], 0
  4670 000038E5 B403                <1> 		mov ah, 3
  4671 000038E7 E8EBFCFFFF          <1> 		call graphicsadd
  4672                              <1> 	showwindow2:
  4673 000038EC 6681C11000          <1> 		add cx, 16
  4674 000038F1 668915[89380000]    <1> 		mov [winvcopystx], dx
  4675 000038F8 66890D[8B380000]    <1> 		mov [winvcopysty], cx
  4676 000038FF 668B16              <1> 		mov dx, [esi]
  4677 00003902 668B4E02            <1> 		mov cx, [esi + 2]
  4678 00003906 6601D2              <1> 		add dx, dx
  4679 00003909 668915[8D380000]    <1> 		mov [winvcopydx], dx
  4680 00003910 66890D[8F380000]    <1> 		mov [winvcopycx], cx
  4681 00003917 8B3D[95380000]      <1> 		mov edi, [windowbufloc]
  4682 0000391D BA00000000          <1> 		mov edx, 0
  4683 00003922 668B15[DC3C0000]    <1> 		mov dx, [resolutionx2]
  4684 00003929 C1E204              <1> 		shl edx, 4
  4685 0000392C 29D7                <1> 		sub edi, edx
  4686 0000392E 803D[760A0000]00    <1> 		cmp byte [termcopyon], 0
  4687 00003935 753E                <1> 		jne nocleartitlebarpos
  4688 00003937 8B3D[FC760000]      <1> 		mov edi, [physbaseptr]
  4689 0000393D BA00000000          <1> 		mov edx, 0
  4690 00003942 668B15[89380000]    <1> 		mov dx, [winvcopystx]
  4691 00003949 01D7                <1> 		add edi, edx
  4692 0000394B 668B0D[8B380000]    <1> 		mov cx, [winvcopysty]
  4693 00003952 6681E91000          <1> 		sub cx, 16
  4694 00003957 6681F90000          <1> 		cmp cx, 0
  4695 0000395C 7417                <1> 		je nocleartitlebarpos
  4696                              <1> 	cleartitlebarpos:
  4697 0000395E BA00000000          <1> 		mov edx, 0
  4698 00003963 668B15[DC3C0000]    <1> 		mov dx, [resolutionx2]
  4699 0000396A 01D7                <1> 		add edi, edx
  4700 0000396C 6649                <1> 		dec cx
  4701 0000396E 6681F90000          <1> 		cmp cx, 0
  4702 00003973 75E9                <1> 		jne cleartitlebarpos
  4703                              <1> 	nocleartitlebarpos:
  4704 00003975 66B91000            <1> 		mov cx, 16
  4705 00003979 668B15[8D380000]    <1> 		mov dx, [winvcopydx]
  4706 00003980 6681F90000          <1> 		cmp cx, 0
  4707 00003985 0F844B000000        <1> 		je near canceltitlebarput
  4708 0000398B 6681FA0000          <1> 		cmp dx, 0
  4709 00003990 0F8440000000        <1> 		je near canceltitlebarput
  4710                              <1> 	titlebarput:
  4711 00003996 66A1[91380000]      <1> 		mov ax, [windowcolor]
  4712 0000399C 668907              <1> 		mov [edi], ax
  4713 0000399F 6681EA0200          <1> 		sub dx, 2
  4714 000039A4 81C702000000        <1> 		add edi, 2
  4715 000039AA 6681FA0000          <1> 		cmp dx, 0
  4716 000039AF 75E5                <1> 		jne titlebarput
  4717 000039B1 BA00000000          <1> 		mov edx, 0
  4718 000039B6 668B15[DC3C0000]    <1> 		mov dx, [resolutionx2]
  4719 000039BD 6649                <1> 		dec cx
  4720 000039BF 662B15[8D380000]    <1> 		sub dx, [winvcopydx]
  4721 000039C6 01D7                <1> 		add edi, edx
  4722 000039C8 668B15[8D380000]    <1> 		mov dx, [winvcopydx]
  4723 000039CF 6681F90000          <1> 		cmp cx, 0
  4724 000039D4 75C0                <1> 		jne titlebarput
  4725                              <1> 	canceltitlebarput:
  4726 000039D6 893D[95380000]      <1> 		mov [windowbufloc], edi
  4727 000039DC 803D[760A0000]02    <1> 		cmp byte [termcopyon], 2
  4728 000039E3 0F8463000000        <1> 		je near winvcpst
  4729 000039E9 66B80000            <1> 		mov ax, 0
  4730 000039ED 81C604000000        <1> 		add esi, 4
  4731 000039F3 668B15[89380000]    <1> 		mov dx, [winvcopystx]
  4732 000039FA 668B0D[8B380000]    <1> 		mov cx, [winvcopysty]
  4733 00003A01 6681E91000          <1> 		sub cx, 16
  4734 00003A06 66BB0000            <1> 		mov bx, 0
  4735 00003A0A C605[772E0000]01    <1> 		mov byte [mouseselecton], 1
  4736 00003A11 E840FEFFFF          <1> 		call showstring2
  4737 00003A16 B058                <1> 		mov al, "X"
  4738 00003A18 B400                <1> 		mov ah, 0
  4739 00003A1A 668B1D[86380000]    <1> 		mov bx, [colorfont2]
  4740 00003A21 668B15[89380000]    <1> 		mov dx, [winvcopystx]
  4741 00003A28 668B0D[8B380000]    <1> 		mov cx, [winvcopysty]
  4742 00003A2F 6681E91000          <1> 		sub cx, 16
  4743 00003A34 6681EA1400          <1> 		sub dx, 20
  4744 00003A39 660315[8D380000]    <1> 		add dx, [winvcopydx]
  4745 00003A40 C605[772E0000]01    <1> 		mov byte [mouseselecton], 1
  4746 00003A47 E8A0020000          <1> 		call showfontvesa
  4747                              <1> 	winvcpst:
  4748 00003A4C 8B3D[95380000]      <1> 		mov edi, [windowbufloc]
  4749 00003A52 E957000000          <1> 		jmp windowvideocopyset
  4750                              <1> 
  4751                              <1> 	windowvideocopy:
  4752 00003A57 8B3D[95380000]      <1> 		mov edi, [windowbufloc]
  4753 00003A5D 3B3D[FC760000]      <1> 		cmp edi, [physbaseptr]
  4754 00003A63 0F8345000000        <1> 		jae near windowvideocopyset
  4755 00003A69 B900000000          <1> 		mov ecx, 0
  4756 00003A6E BA00000000          <1> 		mov edx, 0
  4757 00003A73 668B15[89380000]    <1> 		mov dx, [winvcopystx]
  4758 00003A7A 668B0D[8B380000]    <1> 		mov cx, [winvcopysty]
  4759 00003A81 8B3D[FC760000]      <1> 		mov edi, [physbaseptr]
  4760 00003A87 01D7                <1> 		add edi, edx
  4761 00003A89 81F900000000        <1> 		cmp ecx, 0
  4762 00003A8F 741D                <1> 		je windowvideocopyset
  4763                              <1> 	yrescopylp:
  4764 00003A91 BA00000000          <1> 		mov edx, 0
  4765 00003A96 668B15[DC3C0000]    <1> 		mov dx, [resolutionx2]
  4766 00003A9D 01D7                <1> 		add edi, edx
  4767 00003A9F 6649                <1> 		dec cx
  4768 00003AA1 6681F90000          <1> 		cmp cx, 0
  4769 00003AA6 75E9                <1> 		jne yrescopylp
  4770 00003AA8 893D[95380000]      <1> 		mov [windowbufloc], edi
  4771                              <1> 	windowvideocopyset:
  4772 00003AAE 66B90000            <1> 		mov cx, 0
  4773 00003AB2 66890D[F73B0000]    <1> 		mov [charposline], cx
  4774 00003AB9 BE[8F1C0000]        <1> 		mov esi, videobuf2
  4775 00003ABE 8935[F93B0000]      <1> 		mov [charposvbuf], esi
  4776 00003AC4 8A5E01              <1> 		mov bl, [esi + 1]
  4777 00003AC7 881D[88380000]      <1> 		mov [colorcache], bl
  4778 00003ACD 8A1E                <1> 		mov bl, [esi]
  4779 00003ACF B700                <1> 		mov bh, 0
  4780 00003AD1 66C1E304            <1> 		shl bx, 4
  4781 00003AD5 678AB7[B46C]        <1> 		mov dh, [fonts + bx]
  4782 00003ADA D0CE                <1> 		ror dh, 1
  4783 00003ADC 89FE                <1> 		mov esi, edi
  4784                              <1> 	copywindow:
  4785 00003ADE B201                <1> 		mov dl, 1
  4786 00003AE0 D0C6                <1> 		rol dh, 1
  4787 00003AE2 20F2                <1> 		and dl, dh
  4788 00003AE4 803D[88380000]10    <1> 		cmp byte [colorcache], 0x10
  4789 00003AEB 731C                <1> 		jae switchwincolors
  4790 00003AED 66A1[93380000]      <1> 		mov ax, [windowcolor + 2]
  4791 00003AF3 668907              <1> 		mov [edi], ax
  4792 00003AF6 80FA00              <1> 		cmp dl, 0
  4793 00003AF9 7425                <1> 		je nowritewin
  4794 00003AFB 66A1[91380000]      <1> 		mov ax, [windowcolor]
  4795 00003B01 668907              <1> 		mov [edi], ax
  4796 00003B04 E917000000          <1> 		jmp nowritewin
  4797                              <1> 	switchwincolors:
  4798 00003B09 66A1[91380000]      <1> 		mov ax, [windowcolor]
  4799 00003B0F 668907              <1> 		mov [edi], ax
  4800 00003B12 80FA00              <1> 		cmp dl, 0
  4801 00003B15 7409                <1> 		je nowritewin
  4802 00003B17 66A1[93380000]      <1> 		mov ax, [windowcolor + 2]
  4803 00003B1D 668907              <1> 		mov [edi], ax
  4804                              <1> 	nowritewin:
  4805 00003B20 81C702000000        <1> 		add edi, 2
  4806 00003B26 FEC1                <1> 		inc cl
  4807 00003B28 80F908              <1> 		cmp cl, 8
  4808 00003B2B 75B1                <1> 		jne copywindow
  4809 00003B2D 6643                <1> 		inc bx
  4810 00003B2F B100                <1> 		mov cl, 0
  4811 00003B31 BA00000000          <1> 		mov edx, 0
  4812 00003B36 668B15[DC3C0000]    <1> 		mov dx, [resolutionx2]
  4813 00003B3D 01D6                <1> 		add esi, edx
  4814 00003B3F 89F7                <1> 		mov edi, esi
  4815 00003B41 678AB7[B46C]        <1> 		mov dh, [fonts + bx]
  4816 00003B46 D0CE                <1> 		ror dh, 1
  4817 00003B48 FEC5                <1> 		inc ch
  4818 00003B4A 80FD10              <1> 		cmp ch, 16
  4819 00003B4D 758F                <1> 		jne copywindow
  4820 00003B4F 66B90000            <1> 		mov cx, 0
  4821 00003B53 8B3D[F93B0000]      <1> 		mov edi, [charposvbuf]
  4822 00003B59 81C702000000        <1> 		add edi, 2
  4823 00003B5F 81FF[4F2F0000]      <1> 		cmp edi, videobufend
  4824 00003B65 7379                <1> 		jae donewincopynow
  4825 00003B67 8A5F01              <1> 		mov bl, [edi + 1]
  4826 00003B6A 881D[88380000]      <1> 		mov [colorcache], bl
  4827 00003B70 8A1F                <1> 		mov bl, [edi]
  4828 00003B72 B700                <1> 		mov bh, 0
  4829 00003B74 66C1E304            <1> 		shl bx, 4
  4830 00003B78 893D[F93B0000]      <1> 		mov [charposvbuf], edi
  4831 00003B7E BA00000000          <1> 		mov edx, 0
  4832 00003B83 668B15[DC3C0000]    <1> 		mov dx, [resolutionx2]
  4833 00003B8A C1E204              <1> 		shl edx, 4
  4834 00003B8D 29D6                <1> 		sub esi, edx
  4835 00003B8F 81C610000000        <1> 		add esi, 16
  4836 00003B95 89F7                <1> 		mov edi, esi
  4837 00003B97 668B0D[F73B0000]    <1> 		mov cx, [charposline]
  4838 00003B9E 6641                <1> 		inc cx
  4839 00003BA0 6681F95000          <1> 		cmp cx, 80
  4840 00003BA5 7317                <1> 		jae fixwindowcopy
  4841 00003BA7 66890D[F73B0000]    <1> 		mov [charposline], cx
  4842 00003BAE 66B90000            <1> 		mov cx, 0
  4843 00003BB2 678AB7[B46C]        <1> 		mov dh, [fonts + bx]
  4844 00003BB7 D0CE                <1> 		ror dh, 1
  4845 00003BB9 E920FFFFFF          <1> 		jmp copywindow
  4846                              <1> fixwindowcopy:
  4847 00003BBE 66B90000            <1> 		mov cx, 0
  4848 00003BC2 66890D[F73B0000]    <1> 		mov [charposline], cx
  4849 00003BC9 662B15[8D380000]    <1> 		sub dx, [winvcopydx]
  4850 00003BD0 01D6                <1> 		add esi, edx
  4851 00003BD2 89F7                <1> 		mov edi, esi
  4852 00003BD4 678AB7[B46C]        <1> 		mov dh, [fonts + bx]
  4853 00003BD9 D0CE                <1> 		ror dh, 1
  4854 00003BDB E9FEFEFFFF          <1> 		jmp copywindow
  4855                              <1> donewincopynow:
  4856 00003BE0 E88BD4FFFF          <1> 		call switchtermcursor
  4857 00003BE5 803D[760A0000]01    <1> 		cmp byte [termcopyon], 1
  4858 00003BEC 7501                <1> 		jne forgetresetstuff
  4859 00003BEE 61                  <1> 		popa
  4860                              <1> forgetresetstuff:
  4861 00003BEF C605[760A0000]00    <1> 		mov byte [termcopyon], 0
  4862 00003BF6 C3                  <1> 		ret
  4863                              <1> 
  4864 00003BF7 0000                <1> charposline dw 0
  4865 00003BF9 00000000            <1> charposvbuf dw 0,0
  4866 00003BFD 0000                <1> iconcolor dw 0
  4867                              <1> 	showicon:	;;icon in si, position in (dx,cx), selected in ax, code in bx
  4868 00003BFF A2[873F0000]        <1> 		mov [iconselected], al
  4869 00003C04 8025[873F0000]01    <1> 		and byte [iconselected], 1
  4870 00003C0B B401                <1> 		mov ah, 1
  4871 00003C0D E8C5F9FFFF          <1> 		call graphicsadd
  4872                              <1> 	showicon2:
  4873 00003C12 8B3D[FC760000]      <1> 		mov edi, [physbaseptr]
  4874 00003C18 6601D2              <1> 		add dx, dx
  4875 00003C1B 663B15[DC3C0000]    <1> 		cmp dx, [resolutionx2]
  4876 00003C22 720C                <1> 		jb screenxgood
  4877 00003C24 668B15[DC3C0000]    <1> 		mov dx, [resolutionx2]
  4878 00003C2B 6681EA4000          <1> 		sub dx, 64
  4879                              <1> 	screenxgood:
  4880 00003C30 6681F90000          <1> 		cmp cx, 0
  4881 00003C35 7425                <1> 		je noscreenygoodchk
  4882 00003C37 663B0D[D83C0000]    <1> 		cmp cx, [resolutiony]
  4883 00003C3E 720C                <1> 		jb screenygood
  4884 00003C40 668B0D[D83C0000]    <1> 		mov cx, [resolutiony]
  4885 00003C47 6681E92000          <1> 		sub cx, 32
  4886                              <1> 	screenygood:
  4887 00003C4C BB00000000          <1> 		mov ebx, 0
  4888 00003C51 668B1D[DC3C0000]    <1> 		mov bx, [resolutionx2]
  4889 00003C58 01DF                <1> 		add edi, ebx
  4890 00003C5A E2F0                <1> 		loop screenygood
  4891                              <1> 	noscreenygoodchk:
  4892 00003C5C BB00000000          <1> 		mov ebx, 0
  4893 00003C61 6689D3              <1> 		mov bx, dx
  4894 00003C64 01DF                <1> 		add edi, ebx
  4895 00003C66 66B90000            <1> 		mov cx, 0
  4896 00003C6A 668B06              <1> 		mov ax, [esi]
  4897 00003C6D 81C602000000        <1> 		add esi, 2
  4898 00003C73 66A3[FD3B0000]      <1> 		mov [iconcolor], ax
  4899                              <1> 	writeicon:
  4900 00003C79 8B06                <1> 		mov eax, [esi]
  4901 00003C7B D1C0                <1> 		rol eax, 1
  4902 00003C7D B100                <1> 		mov cl, 0
  4903                              <1> 	writeiconline:
  4904 00003C7F B201                <1> 		mov dl, 1
  4905 00003C81 20C2                <1> 		and dl, al
  4906 00003C83 3215[873F0000]      <1> 		xor dl, [iconselected]
  4907 00003C89 668B1D[1C2D0000]    <1> 		mov bx, [background]
  4908 00003C90 66891F              <1> 		mov [edi], bx
  4909 00003C93 80FA00              <1> 		cmp dl, 0
  4910 00003C96 740A                <1> 		je noiconline
  4911 00003C98 668B15[FD3B0000]    <1> 		mov dx, [iconcolor]
  4912 00003C9F 668917              <1> 		mov [edi], dx
  4913                              <1> 	noiconline:
  4914 00003CA2 81C702000000        <1> 		add edi, 2
  4915 00003CA8 D1C0                <1> 		rol eax, 1
  4916 00003CAA FEC1                <1> 		inc cl
  4917 00003CAC 80F920              <1> 		cmp cl, 32
  4918 00003CAF 72CE                <1> 		jb writeiconline
  4919 00003CB1 81C604000000        <1> 		add esi, 4
  4920 00003CB7 FEC5                <1> 		inc ch
  4921 00003CB9 BA00000000          <1> 		mov edx, 0
  4922 00003CBE 668B15[DC3C0000]    <1> 		mov dx, [resolutionx2]
  4923 00003CC5 01D7                <1> 		add edi, edx
  4924 00003CC7 81EF40000000        <1> 		sub edi, 64
  4925 00003CCD 80FD20              <1> 		cmp ch, 32
  4926 00003CD0 72A7                <1> 		jb writeicon
  4927 00003CD2 B800000000          <1> 		mov eax, 0
  4928 00003CD7 C3                  <1> 		ret
  4929                              <1> 
  4930 00003CD8 0000                <1> resolutiony dw 0
  4931 00003CDA 0000                <1> resolutionx dw 0
  4932 00003CDC 0000                <1> resolutionx2 dw 0
  4933 00003CDE 02                  <1> resolutionbytes db 2
  4934 00003CDF 0000                <1> posxvesa dw 0
  4935 00003CE1 0000                <1> posyvesa dw 0
  4936 00003CE3 FFFF                <1> colorfont dw 0xFFFF
  4937                              <1> savefontvesa:		;;same rules as showfontvesa
  4938 00003CE5 C605[762E0000]01    <1> 	mov byte [savefonton], 1
  4939                              <1> showfontvesa:		;;position in (dx,cx), color in bx, char in al
  4940 00003CEC 66890D[E13C0000]    <1> 	mov [posyvesa], cx
  4941 00003CF3 668915[DF3C0000]    <1> 	mov [posxvesa], dx
  4942 00003CFA 8B3D[FC760000]      <1> 	mov edi, [physbaseptr]
  4943 00003D00 66891D[E33C0000]    <1> 	mov [colorfont], bx
  4944 00003D07 BB00000000          <1> 	mov ebx, 0
  4945 00003D0C 88C3                <1> 	mov bl, al
  4946 00003D0E B800000000          <1> 	mov eax, 0
  4947 00003D13 88D8                <1> 	mov al, bl
  4948 00003D15 6689D3              <1> 	mov bx, dx
  4949 00003D18 89DA                <1> 	mov edx, ebx
  4950 00003D1A BB00000000          <1> 	mov ebx, 0
  4951 00003D1F 6681F90000          <1> 	cmp cx, 0
  4952 00003D24 7415                <1> 	je vesaposloopdn
  4953 00003D26 668B1D[DC3C0000]    <1> 	mov bx, [resolutionx2]
  4954                              <1> vesaposloop:
  4955 00003D2D 01DA                <1> 	add edx, ebx
  4956 00003D2F 6681E90100          <1> 	sub cx, 1
  4957 00003D34 6681F90000          <1> 	cmp cx, 0
  4958 00003D39 75F2                <1> 	jne vesaposloop
  4959                              <1> vesaposloopdn:
  4960 00003D3B 01D7                <1> 	add edi, edx
  4961 00003D3D BE[B46C0000]        <1> 	mov esi, fonts
  4962                              <1> findfontvesa:
  4963 00003D42 B400                <1> 	mov ah, 0
  4964 00003D44 C1E004              <1> 	shl eax, 4
  4965 00003D47 01C6                <1> 	add esi, eax
  4966 00003D49 C1E804              <1> 	shr eax, 4
  4967 00003D4C 81FE[D4740000]      <1> 	cmp esi, fontend
  4968 00003D52 0F83BF000000        <1> 	jae near donefontvesa
  4969 00003D58 4E                  <1> 	dec esi
  4970                              <1> foundfontvesa:
  4971 00003D59 46                  <1> 	inc esi
  4972 00003D5A 803D[762E0000]01    <1> 	cmp byte [savefonton], 1
  4973 00003D61 0F84E1000000        <1> 	je near vesafontsaver
  4974 00003D67 B100                <1> 	mov cl, 0
  4975 00003D69 8A06                <1> 	mov al, [esi]
  4976 00003D6B 668B15[DC3C0000]    <1> 	mov dx, [resolutionx2]
  4977 00003D72 662B15[DF3C0000]    <1> 	sub dx, [posxvesa]
  4978 00003D79 6681FA1000          <1> 	cmp dx, 16
  4979 00003D7E 7708                <1> 	ja paintfontvesa
  4980 00003D80 D0EA                <1> 	shr dl, 1
  4981 00003D82 8815[473E0000]      <1> 	mov [charwidth], dl
  4982                              <1> paintfontvesa:
  4983 00003D88 B201                <1> 	mov dl, 1
  4984 00003D8A 20C2                <1> 	and dl, al
  4985 00003D8C 803D[752E0000]01    <1> 	cmp byte [showcursorfonton], 1
  4986 00003D93 0F8435000000        <1> 	je near nodelpaintedfont
  4987 00003D99 803D[752E0000]02    <1> 	cmp byte [showcursorfonton], 2
  4988 00003DA0 0F8518000000        <1> 	jne near noswitchcursorfonton
  4989 00003DA6 80FA00              <1> 	cmp dl, 0
  4990 00003DA9 0F842E000000        <1> 	je near nopixelset
  4991 00003DAF 668B1D[E33C0000]    <1> 	mov bx, [colorfont]
  4992 00003DB6 66891F              <1> 	mov [edi], bx
  4993 00003DB9 E91F000000          <1> 	jmp nopixelset
  4994                              <1> noswitchcursorfonton:
  4995 00003DBE 3215[772E0000]      <1> 	xor dl, [mouseselecton]
  4996 00003DC4 668B1D[1C2D0000]    <1> 	mov bx, [background]
  4997 00003DCB 66891F              <1> 	mov [edi], bx
  4998                              <1> nodelpaintedfont:
  4999 00003DCE 80FA00              <1> 	cmp dl, 0
  5000 00003DD1 740A                <1> 	je nopixelset
  5001 00003DD3 668B15[E33C0000]    <1> 	mov dx, [colorfont]
  5002 00003DDA 668917              <1> 	mov [edi], dx
  5003                              <1> nopixelset:
  5004 00003DDD 81C702000000        <1> 	add edi, 2
  5005 00003DE3 D0C0                <1> 	rol al, 1
  5006 00003DE5 FEC1                <1> 	inc cl
  5007 00003DE7 3A0D[473E0000]      <1> 	cmp cl, [charwidth]
  5008 00003DED 7299                <1> 	jb paintfontvesa
  5009 00003DEF FEC5                <1> 	inc ch
  5010 00003DF1 BA00000000          <1> 	mov edx, 0
  5011 00003DF6 668B15[DC3C0000]    <1> 	mov dx, [resolutionx2]
  5012 00003DFD 01D7                <1> 	add edi, edx
  5013 00003DFF BA00000000          <1> 	mov edx, 0
  5014 00003E04 8A15[473E0000]      <1> 	mov dl, [charwidth]
  5015 00003E0A 00D2                <1> 	add dl, dl
  5016 00003E0C 29D7                <1> 	sub edi, edx
  5017 00003E0E 80FD10              <1> 	cmp ch, 16
  5018 00003E11 0F8242FFFFFF        <1> 	jb foundfontvesa
  5019                              <1> donefontvesa:
  5020 00003E17 B208                <1> 	mov dl, 8
  5021 00003E19 8815[473E0000]      <1> 	mov [charwidth], dl
  5022 00003E1F 668B15[DF3C0000]    <1> 	mov dx, [posxvesa]
  5023 00003E26 8A1D[473E0000]      <1> 	mov bl, [charwidth]
  5024 00003E2C B700                <1> 	mov bh, 0
  5025 00003E2E 6601DA              <1> 	add dx, bx
  5026 00003E31 668B1D[E33C0000]    <1> 	mov bx, [colorfont]
  5027 00003E38 668B0D[E13C0000]    <1> 	mov cx, [posyvesa]
  5028 00003E3F C605[762E0000]00    <1> 	mov byte [savefonton], 0
  5029 00003E46 C3                  <1> 	ret
  5030 00003E47 08                  <1> charwidth db 8
  5031                              <1> vesafontsaver:
  5032 00003E48 B000                <1> 	mov al, 0
  5033 00003E4A B100                <1> 	mov cl, 0
  5034                              <1> vesafontsaver2:
  5035 00003E4C 668B17              <1> 	mov dx, [edi]
  5036 00003E4F 663B15[E33C0000]    <1> 	cmp dx, [colorfont]
  5037 00003E56 742F                <1> 	je colorfontmatch
  5038                              <1> donecolormatch:
  5039 00003E58 81C702000000        <1> 	add edi, 2
  5040 00003E5E D0C0                <1> 	rol al, 1
  5041 00003E60 FEC1                <1> 	inc cl
  5042 00003E62 80F908              <1> 	cmp cl, 8
  5043 00003E65 72E5                <1> 	jb vesafontsaver2
  5044 00003E67 8806                <1> 	mov [esi], al
  5045 00003E69 46                  <1> 	inc esi
  5046 00003E6A FEC5                <1> 	inc ch
  5047 00003E6C BA00000000          <1> 	mov edx, 0
  5048 00003E71 668B15[DC3C0000]    <1> 	mov dx, [resolutionx2]
  5049 00003E78 01D7                <1> 	add edi, edx
  5050 00003E7A 81EF10000000        <1> 	sub edi, 16
  5051 00003E80 80FD10              <1> 	cmp ch, 16
  5052 00003E83 72C3                <1> 	jb vesafontsaver
  5053 00003E85 EB90                <1> 	jmp donefontvesa
  5054                              <1> colorfontmatch:
  5055 00003E87 0401                <1> 	add al, 1
  5056 00003E89 EBCD                <1> 	jmp donecolormatch
  5057                              <1> 	
  5058                              <1> showbmp:
  5059 00003E8B 668B06              <1> 	mov ax, [esi]
  5060 00003E8E 663D424D            <1> 	cmp ax, "BM"
  5061 00003E92 0F858E000000        <1> 	jne near endedbmp
  5062 00003E98 8B3D[FC760000]      <1> 	mov edi, [physbaseptr]
  5063 00003E9E 6689D0              <1> 	mov ax, dx
  5064 00003EA1 6689CB              <1> 	mov bx, cx
  5065 00003EA4 B900000000          <1> 	mov ecx, 0
  5066 00003EA9 BA00000000          <1> 	mov edx, 0
  5067 00003EAE 6689D9              <1> 	mov cx, bx
  5068 00003EB1 6689C2              <1> 	mov dx, ax
  5069 00003EB4 01D7                <1> 	add edi, edx
  5070 00003EB6 01D7                <1> 	add edi, edx
  5071 00003EB8 BA00000000          <1> 	mov edx, 0
  5072 00003EBD 668B15[DC3C0000]    <1> 	mov dx, [resolutionx2]
  5073 00003EC4 41                  <1> 	inc ecx
  5074 00003EC5 034E16              <1> 	add ecx, [esi + 22]
  5075                              <1> bmplocloop:
  5076 00003EC8 01D7                <1> 	add edi, edx
  5077 00003ECA E2FC                <1> 	loop bmplocloop
  5078 00003ECC 29D7                <1> 	sub edi, edx
  5079 00003ECE 8B5612              <1> 	mov edx, [esi + 18]
  5080 00003ED1 8B4E16              <1> 	mov ecx, [esi + 22]
  5081 00003ED4 8B460A              <1> 	mov eax, [esi + 10]
  5082 00003ED7 8B5E02              <1> 	mov ebx, [esi + 2]
  5083 00003EDA 01F3                <1> 	add ebx, esi
  5084 00003EDC 891D[2C3F0000]      <1> 	mov [bmpend], ebx
  5085 00003EE2 89D3                <1> 	mov ebx, edx
  5086 00003EE4 01C6                <1> 	add esi, eax
  5087                              <1> ldxbmp:
  5088 00003EE6 668B06              <1> 	mov ax, [esi]
  5089 00003EE9 668907              <1> 	mov [edi], ax
  5090 00003EEC 81C702000000        <1> 	add edi, 2
  5091 00003EF2 81C602000000        <1> 	add esi, 2
  5092 00003EF8 3B35[2C3F0000]      <1> 	cmp esi, [bmpend]
  5093 00003EFE 7726                <1> 	ja endedbmp
  5094 00003F00 4A                  <1> 	dec edx
  5095 00003F01 81FA00000000        <1> 	cmp edx, 0
  5096 00003F07 77DD                <1> 	ja ldxbmp
  5097 00003F09 BA00000000          <1> 	mov edx, 0
  5098 00003F0E 668B15[DC3C0000]    <1> 	mov dx, [resolutionx2]
  5099 00003F15 29DF                <1> 	sub edi, ebx
  5100 00003F17 29DF                <1> 	sub edi, ebx
  5101 00003F19 29D7                <1> 	sub edi, edx
  5102 00003F1B 49                  <1> 	dec ecx
  5103 00003F1C 89DA                <1> 	mov edx, ebx
  5104 00003F1E 81F900000000        <1> 	cmp ecx, 0
  5105 00003F24 77C0                <1> 	ja ldxbmp
  5106                              <1> endedbmp:
  5107 00003F26 E81AF0FFFF          <1> 	call switchmousepos2
  5108 00003F2B C3                  <1> 	ret
  5109                              <1> 	
  5110 00003F2C 00000000            <1> 	bmpend dd 0
  5111                              <1> 
  5112                              <1> ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;Here are some vars;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
  5113 00003F30 00000000            <1> 	showstringesi dw 0,0
  5114 00003F34 00                  <1> 	mouseon db 0
  5115 00003F35 737461727400        <1> 	start	db "start",0
  5116 00003F3B 536F6C6C65724F5300  <1> 	gotomenu db "SollerOS",0
  5117 00003F44 426F6F2100          <1> 	boomsg db "Boo!",0
  5118 00003F49 5061636D616E207761- <1> 	pacmsg	db "Pacman was easy to draw.",0
  5119 00003F52 73206561737920746F- <1>
  5120 00003F5B 20647261772E00      <1>
  5121 00003F62 4F6D206E6F6D206E6F- <1> 	pacnom  db "Om nom nom nom",0
  5122 00003F6B 6D206E6F6D00        <1>
  5123 00003F71 77696E646F77732073- <1> 	winmsg	db "windows sucks",0
  5124 00003F7A 75636B7300          <1>
  5125 00003F7F 5800                <1> 	xmsg db "X",0
  5126 00003F81 0000                <1> 	icon dw 0	;pointer to icon
  5127 00003F83 00000000            <1> 	codepointer dw 0,0 ;pointer to code
  5128 00003F87 00                  <1> 	iconselected db 0
  5129                              <1> 	
  5130                              <1> 	boo:
  5131 00003F88 BE[443F0000]        <1> 		mov esi, boomsg
  5132 00003F8D 66BA6400            <1> 		mov dx, 100
  5133 00003F91 66B94001            <1> 		mov cx, 320
  5134 00003F95 BB00000000          <1> 		mov ebx, 0
  5135 00003F9A 66B80000            <1> 		mov ax, 0
  5136 00003F9E E9A0F8FFFF          <1> 		jmp showstring
  5137                              <1> 
  5138                              <1> 	pacmannomnom:
  5139 00003FA3 BE[623F0000]        <1> 		mov esi, pacnom
  5140 00003FA8 66BA8200            <1> 		mov dx, 130
  5141 00003FAC 66B93C00            <1> 		mov cx, 60
  5142 00003FB0 BB00000000          <1> 		mov ebx, 0
  5143 00003FB5 66B80000            <1> 		mov ax, 0
  5144 00003FB9 E985F8FFFF          <1> 		jmp showstring	
  5145                              <1> 	
  5146                              <1> 	noie:
  5147 00003FBE BE[52400000]        <1> 		mov esi, termwindow
  5148 00003FC3 66BA0000            <1> 		mov dx, 0
  5149 00003FC7 66B90000            <1> 		mov cx, 0
  5150 00003FCB BB[95100000]        <1> 		mov ebx, os
  5151                              <1> ;;		mov ebx, internettest
  5152 00003FD0 891D[CC030000]      <1> 		mov [user2codepoint], ebx
  5153 00003FD6 66B80000            <1> 		mov ax, 0
  5154 00003FDA E8BAF8FFFF          <1> 		call showwindow
  5155                              <1> ;;		jmp internettest
  5156 00003FDF E9B1D0FFFF          <1> 		jmp os
  5157 00003FE4 C3                  <1> 		ret
  5158                              <1> 
  5159                              <1> 	gotomenuboot:
  5160 00003FE5 BE[52400000]        <1> 		mov esi, termwindow
  5161 00003FEA 66BA0000            <1> 		mov dx, 0
  5162 00003FEE 66B90000            <1> 		mov cx, 0
  5163 00003FF2 BB[95100000]        <1> 		mov ebx, os
  5164 00003FF7 891D[CC030000]      <1> 		mov [user2codepoint], ebx
  5165 00003FFD 66B80000            <1> 		mov ax, 0
  5166 00004001 E893F8FFFF          <1> 		call showwindow
  5167 00004006 E98AD0FFFF          <1> 		jmp os
  5168 0000400B C3                  <1> 		ret
  5169                              <1> 
  5170                              <1> 	winblows:
  5171 0000400C BE[713F0000]        <1> 		mov esi, winmsg
  5172 00004011 66BA0000            <1> 		mov dx, 0
  5173 00004015 668B0D[D83C0000]    <1> 		mov cx, [resolutiony]
  5174 0000401C 6681E92000          <1> 		sub cx, 32
  5175 00004021 BB00000000          <1> 		mov ebx, 0
  5176 00004026 B400                <1> 		mov ah, 0
  5177 00004028 B011                <1> 		mov al, 00010001b
  5178 0000402A E814F8FFFF          <1> 		call showstring
  5179 0000402F BE[3B3F0000]        <1> 		mov esi, gotomenu
  5180 00004034 668B0D[D83C0000]    <1> 		mov cx, [resolutiony]
  5181 0000403B 6681E93000          <1> 		sub cx, 48
  5182 00004040 66BA0000            <1> 		mov dx, 0
  5183 00004044 B400                <1> 		mov ah, 0
  5184 00004046 B010                <1> 		mov al, 00010000b
  5185 00004048 BB[E53F0000]        <1> 		mov ebx, gotomenuboot
  5186 0000404D E9F1F7FFFF          <1> 		jmp showstring
  5187                              <1> 
  5188 00004052 8002E001            <1> 	termwindow:	dw 640,480	;;window size
  5189 00004056 5465726D696E616C00  <1> 	termmsg:	db "Terminal",0	;;window title
  5190                              <1> 	
  5191 00004056 <incbin>            <1> interneticon: 	incbin 'source/precompiled/interneticon.pak'
  5192 00004056 <incbin>            <1> wordicon: 	incbin 'source/precompiled/wordicon.pak'
  5193 00004056 <incbin>            <1> pacmanpellet: incbin 'source/precompiled/pacmanpellet.pak'
  5194 00004056 <incbin>            <1> ghostie	incbin 'source/precompiled/ghostie.pak'
  5195 00004056 <incbin>            <1> pacman	incbin 'source/precompiled/pacman.pak'
  5196                                      ;%include 'source/network.asm'
  5197                                  	%include 'source/rtl8139.asm'
  5198                              <1> ;;rtl8139.asm
  5199                              <1> initcard:	;;should find card, get mac, and initialize card
  5200 000042E9 B800000000          <1> 	mov eax, 0
  5201 000042EE A2[23460000]        <1> 	mov [pcifunction], al
  5202 000042F3 A2[21460000]        <1> 	mov [pcibus], al
  5203 000042F8 A2[22460000]        <1> 	mov [pcidevice], al
  5204 000042FD B002                <1> 	mov al, 0x02 ;;type code
  5205 000042FF A2[A6460000]        <1> 	mov [pcitype], al
  5206 00004304 E81D030000          <1> 	call getpciport
  5207                              <1> initnic:		;;;;Here i tried the rtl8139 interface, fuck it
  5208 00004309 8915[F8440000]      <1> 	mov [basenicaddr], edx
  5209 0000430F 89D1                <1> 	mov ecx, edx
  5210 00004311 C605[DA150000]03    <1> 	mov byte [firsthexshown], 3
  5211 00004318 E8D2D2FFFF          <1> 	call showhex	;;for debugging, please remove
  5212 0000431D BE[1F340000]        <1> 	mov esi, rbuffstart
  5213 00004322 B900200000          <1> 	mov ecx, 8192
  5214 00004327 B800000000          <1> 	mov eax, 0
  5215                              <1> clearrbuff:		;;clear receive buffer which starts at rbuffstart
  5216 0000432C 8806                <1> 	mov [esi], al
  5217 0000432E 46                  <1> 	inc esi
  5218 0000432F 6649                <1> 	dec cx
  5219 00004331 6681F90000          <1> 	cmp cx, 0
  5220 00004336 75F4                <1> 	jne clearrbuff
  5221                              <1> findmac:
  5222 00004338 8B15[F8440000]      <1> 	mov edx, [basenicaddr]
  5223 0000433E BF[00450000]        <1> 	mov edi, sysmac
  5224 00004343 B906000000          <1> 	mov ecx, 6
  5225                              <1> macputloop:
  5226 00004348 EC                  <1> 	in al, dx
  5227 00004349 8807                <1> 	mov [edi], al
  5228 0000434B 47                  <1> 	inc edi
  5229 0000434C 42                  <1> 	inc edx
  5230 0000434D 49                  <1> 	dec ecx
  5231 0000434E 75F8                <1> 	jnz macputloop
  5232 00004350 B9[00450000]        <1> 	mov ecx, sysmac
  5233 00004355 E837010000          <1> 	call showmac
  5234                              <1> resetnic:
  5235 0000435A 8B15[F8440000]      <1> 	mov edx, [basenicaddr]
  5236 00004360 81C252000000        <1> 	add edx, 0x52
  5237 00004366 B000                <1> 	mov al, 0
  5238 00004368 EE                  <1> 	out dx, al	;;WAKE UP!!!!
  5239 00004369 8B15[F8440000]      <1> 	mov edx, [basenicaddr]
  5240 0000436F 81C237000000        <1> 	add edx, 0x37
  5241 00004375 B010                <1> 	mov al, 0x10
  5242 00004377 EE                  <1> 	out dx, al	;;Reset
  5243                              <1> resetnicwait:
  5244 00004378 8B15[F8440000]      <1> 	mov edx, [basenicaddr]
  5245 0000437E 81C237000000        <1> 	add edx, 0x37
  5246 00004384 EC                  <1> 	in al, dx
  5247 00004385 2410                <1> 	and al, 0x10
  5248 00004387 3C10                <1> 	cmp al, 0x10
  5249 00004389 0F84E9FFFFFF        <1> 	je near resetnicwait
  5250 0000438F 8B15[F8440000]      <1> 	mov edx, [basenicaddr]
  5251 00004395 81C230000000        <1> 	add edx, 0x30
  5252 0000439B B8[1F340000]        <1> 	mov eax, rbuffstart
  5253 000043A0 EF                  <1> 	out dx, eax	;;give nic receive buffer location
  5254 000043A1 8B15[F8440000]      <1> 	mov edx, [basenicaddr]
  5255 000043A7 81C23C000000        <1> 	add edx, 0x3C
  5256 000043AD 66B80500            <1> 	mov ax, 0x0005
  5257 000043B1 66EF                <1> 	out dx, ax	;;set TOK and ROK
  5258 000043B3 8B15[F8440000]      <1> 	mov edx, [basenicaddr]
  5259 000043B9 81C244000000        <1> 	add edx, 0x44
  5260 000043BF B80F000000          <1> 	mov eax, 0xf
  5261 000043C4 EF                  <1> 	out dx, eax	;;recieve packets from all matches
  5262 000043C5 8B15[F8440000]      <1> 	mov edx, [basenicaddr]
  5263 000043CB 81C237000000        <1> 	add edx, 0x37
  5264 000043D1 B00C                <1> 	mov al, 0x0C
  5265 000043D3 EE                  <1> 	out dx, al	;;use transmit and receive
  5266 000043D4 C605[E1440000]01    <1> 	mov byte [nicconfig], 1
  5267 000043DB C3                  <1> 	ret
  5268                              <1> 	
  5269                              <1> sendframe:	;;padded frame with beginning in edi and end in esi
  5270 000043DC 56                  <1> 	push esi
  5271 000043DD 57                  <1> 	push edi
  5272                              <1> nic2:		;;here come the low level drivers :(
  5273                              <1> 			;;frame begins at esi, ends at edi 			;;0x0200 is the class code for ethernet cards
  5274 000043DE 803D[E1440000]01    <1> 	cmp byte [nicconfig], 1
  5275 000043E5 7405                <1> 	je sendcachedata
  5276 000043E7 E8FDFEFFFF          <1> 	call initcard
  5277                              <1> sendcachedata:
  5278 000043EC 8B15[F8440000]      <1> 	mov edx, [basenicaddr]
  5279 000043F2 81C210000000        <1> 	add edx, 0x10
  5280 000043F8 ED                  <1> 	in eax, dx
  5281 000043F9 89C1                <1> 	mov ecx, eax
  5282 000043FB E8EFD1FFFF          <1> 	call showhex
  5283 00004400 8B15[F8440000]      <1> 	mov edx, [basenicaddr]
  5284 00004406 81C213000000        <1> 	add edx, 0x13
  5285 0000440C ED                  <1> 	in eax, dx
  5286 0000440D 89C1                <1> 	mov ecx, eax
  5287 0000440F E8DBD1FFFF          <1> 	call showhex
  5288 00004414 8B15[F8440000]      <1> 	mov edx, [basenicaddr]
  5289 0000441A 81C223000000        <1> 	add edx, 0x23	;;23 or 20?
  5290 00004420 5F                  <1> 	pop edi
  5291 00004421 89F8                <1> 	mov eax, edi
  5292 00004423 EF                  <1> 	out dx, eax	;;here's Johnny!
  5293 00004424 5E                  <1> 	pop esi
  5294 00004425 29FE                <1> 	sub esi, edi
  5295 00004427 89F0                <1> 	mov eax, esi
  5296 00004429 8B15[F8440000]      <1> 	mov edx, [basenicaddr]
  5297 0000442F 81C213000000        <1> 	add edx, 0x13	;;13 or 10?
  5298 00004435 EF                  <1> 	out dx, eax
  5299                              <1> checknicstatus1:
  5300 00004436 8B15[F8440000]      <1> 	mov edx, [basenicaddr]
  5301 0000443C 81C213000000        <1> 	add edx, 0x13	;;13 or 10?
  5302 00004442 ED                  <1> 	in eax, dx
  5303 00004443 2500200000          <1> 	and eax, 0x2000
  5304 00004448 3D00200000          <1> 	cmp eax, 0x2000
  5305 0000444D 75E7                <1> 	jne checknicstatus1
  5306                              <1> checknicstatus:
  5307 0000444F 8B15[F8440000]      <1> 	mov edx, [basenicaddr]
  5308 00004455 81C213000000        <1> 	add edx, 0x13	;;13 or 10?
  5309 0000445B ED                  <1> 	in eax, dx
  5310 0000445C 2500800000          <1> 	and eax, 0x8000
  5311 00004461 3D00800000          <1> 	cmp eax, 0x8000
  5312 00004466 75E7                <1> 	jne checknicstatus
  5313 00004468 8B15[F8440000]      <1> 	mov edx, [basenicaddr]
  5314 0000446E 81C210000000        <1> 	add edx, 0x10
  5315 00004474 ED                  <1> 	in eax, dx
  5316 00004475 89C1                <1> 	mov ecx, eax
  5317 00004477 E873D1FFFF          <1> 	call showhex
  5318 0000447C 8B15[F8440000]      <1> 	mov edx, [basenicaddr]
  5319 00004482 81C213000000        <1> 	add edx, 0x13
  5320 00004488 ED                  <1> 	in eax, dx
  5321 00004489 89C1                <1> 	mov ecx, eax
  5322 0000448B E85FD1FFFF          <1> 	call showhex
  5323 00004490 C3                  <1> 	ret
  5324                              <1> 	
  5325                              <1> showmac:	;;mac begins in [ecx]
  5326 00004491 BE[C9440000]        <1> 	mov esi, macprint
  5327 00004496 89CF                <1> 	mov edi, ecx
  5328 00004498 81C106000000        <1> 	add ecx, 6
  5329                              <1> showmacloop:
  5330 0000449E 8A07                <1> 	mov al, [edi]
  5331 000044A0 8A27                <1> 	mov ah, [edi]
  5332 000044A2 C0E804              <1> 	shr al, 4
  5333 000044A5 C0E404              <1> 	shl ah, 4
  5334 000044A8 C0EC04              <1> 	shr ah, 4
  5335 000044AB 0430                <1> 	add al, 48
  5336 000044AD 80C430              <1> 	add ah, 48
  5337 000044B0 668906              <1> 	mov [esi], ax
  5338 000044B3 81C603000000        <1> 	add esi, 3
  5339 000044B9 47                  <1> 	inc edi
  5340 000044BA 39CF                <1> 	cmp edi, ecx
  5341 000044BC 72E0                <1> 	jb showmacloop
  5342 000044BE BE[C9440000]        <1> 	mov esi, macprint
  5343 000044C3 E88AC7FFFF          <1> 	call print
  5344 000044C8 C3                  <1> 	ret
  5345                              <1> 	
  5346 000044C9 30302D30302D30302D- <1> macprint db "00-00-00-00-00-00  ",0
  5347 000044D2 30302D30302D303020- <1>
  5348 000044DB 2000                <1>
  5349 000044DD 00000000            <1> ethernetend dw 0,0
  5350 000044E1 00                  <1> nicconfig db 0
  5351 000044E2 4E4F204E494300      <1> nonicfoundmsg db "NO NIC",0
  5352 000044E9 496E6974696174696E- <1> initnicmsg	db "Initiating NIC",0
  5353 000044F2 67204E494300        <1>
  5354 000044F8 00000000            <1> basenicaddr	db 0,0,0,0
  5355 000044FC C0A80005            <1> sysip db 192,168,0,5
  5356 00004500 000000000000        <1> sysmac	db 0,0,0,0,0,0		;;my mac address
  5357                                  	%include 'source/arp.asm'
  5358                              <1> ;;let's try something else
  5359                              <1> ;;arp.asm
  5360                              <1> arpinit:
  5361 00004506 BE[BD450000]        <1> 	mov esi, arptable
  5362 0000450B BF[00450000]        <1> 	mov edi, sysmac
  5363 00004510 BB[FC440000]        <1> 	mov ebx, sysip
  5364 00004515 8B0F                <1> 	mov ecx, [edi]
  5365 00004517 890E                <1> 	mov [esi], ecx
  5366 00004519 668B4F04            <1> 	mov cx, [edi + 4]
  5367 0000451D 894E04              <1> 	mov [esi + 4], ecx
  5368 00004520 8B0B                <1> 	mov ecx, [ebx]
  5369 00004522 894E06              <1> 	mov [esi + 6], ecx
  5370 00004525 C605[BC450000]01    <1> 	mov byte [arpconfig], 1
  5371 0000452C C3                  <1> 	ret
  5372                              <1> arptest:
  5373 0000452D 803D[BC450000]01    <1> 	cmp byte [arpconfig], 1
  5374 00004534 7405                <1> 	je arptest2
  5375 00004536 E8CBFFFFFF          <1> 	call arpinit
  5376                              <1> arptest2:	;;try to reach 192.168.0.1
  5377 0000453B 8B0D[00450000]      <1> 	mov ecx, [sysmac]
  5378 00004541 668B1D[04450000]    <1> 	mov bx, [sysmac + 4]
  5379 00004548 890D[82450000]      <1> 	mov [sourcemac], ecx
  5380 0000454E 66891D[86450000]    <1> 	mov [sourcemac + 4],bx
  5381 00004555 890D[92450000]      <1> 	mov [arpsenderinfo], ecx
  5382 0000455B 66891D[96450000]    <1> 	mov [arpsenderinfo + 4], bx
  5383 00004562 BF[7C450000]        <1> 	mov edi, frame
  5384 00004567 BE[BC450000]        <1> 	mov esi, framend
  5385 0000456C E86BFEFFFF          <1> 	call sendframe
  5386 00004571 BE[8E6C0000]        <1> 	mov esi, line
  5387 00004576 E8D7C6FFFF          <1> 	call print
  5388 0000457B C3                  <1> 	ret
  5389                              <1> 	
  5390                              <1> ;;example frame
  5391                              <1> frame:
  5392 0000457C FFFFFFFFFFFF        <1> destinationmac:	db 0xFF,0xFF,0xFF,0xFF,0xFF,0xFF
  5393 00004582 000000000000        <1> sourcemac:		db 0,0,0,0,0,0
  5394 00004588 0608                <1> ethertype:		dw 0x0806			;;arp
  5395                              <1> 	;;example packet
  5396 0000458A 0100                <1> 	arppacket: 		dw 1				;;ethernet is 1
  5397 0000458C 0008                <1> 	arpprotocol: 	dw 0x0800			;;ip is 0x800
  5398 0000458E 0604                <1> 					db 6,4				;;length of mac, length of ip
  5399 00004590 0100                <1> 	arpoperation: 	dw 1				;;one for arp request
  5400 00004592 000000000000        <1> 	arpsenderinfo:	db 0x00,0x00,0x00,0x00,0x00,0x00	;;mac
  5401 00004598 C0A80005            <1> 					db 192,168,0,5			;;ip
  5402 0000459C 000000000000        <1> 	arptargetinfo:	db 0x00,0x00,0x00,0x00,0x00,0x00	;;ignored in requests
  5403 000045A2 C0A80001            <1> 					db 192,168,0,1			;;ip
  5404 000045A6 00<rept>            <1> padding:		times (64-($-frame)) db 0
  5405                              <1> framend:
  5406                              <1> 
  5407 000045BC 00                  <1> arpconfig db 0
  5408                              <1> arptable:	;;mac,ip
  5409 000045BD 000000000000000000- <1> 	times 10 db 0,0,0,0,0,0,0,0,0,0
  5410 000045C6 00<rept>            <1>
  5411                              <1> arptableend:
  5412                                  	%include 'source/pci.asm'
  5413 00004621 00                  <1> pcibus		db 0
  5414 00004622 00                  <1> pcidevice	db 0
  5415 00004623 00                  <1> pcifunction	db 0
  5416 00004624 00                  <1> pciregister	db 0
  5417 00004625 00                  <1> pcireqtype db 0
  5418                              <1> 
  5419                              <1> getpciport:
  5420 00004626 B001                <1> 	mov al, 1
  5421 00004628 A2[25460000]        <1> 	mov [pcireqtype], al
  5422 0000462D E91E000000          <1> 	jmp searchpci
  5423                              <1> pcidump:
  5424 00004632 B800000000          <1> 	mov eax, 0
  5425 00004637 A2[23460000]        <1> 	mov [pcifunction], al
  5426 0000463C A2[21460000]        <1> 	mov [pcibus], al
  5427 00004641 A2[22460000]        <1> 	mov [pcidevice], al
  5428 00004646 A2[25460000]        <1> 	mov [pcireqtype], al
  5429 0000464B E900000000          <1> 	jmp searchpci
  5430                              <1> searchpci:		;;return in ebx, start X in pciX
  5431 00004650 B000                <1> 	mov al, 0
  5432 00004652 A2[24460000]        <1> 	mov [pciregister], al
  5433 00004657 E84F010000          <1> 	call getpciaddr
  5434 0000465C BAF80C0000          <1> 	mov edx, 0xCF8
  5435 00004661 EF                  <1> 	out dx, eax	;;request pci config
  5436 00004662 BAFC0C0000          <1> 	mov edx, 0xCFC
  5437 00004667 ED                  <1> 	in eax, dx 	;;read in pci config
  5438 00004668 3D0000FFFF          <1> 	cmp eax, 0xFFFF0000
  5439 0000466D 0F8237000000        <1> 	jb near checkpcidevice
  5440                              <1> searchpciret:
  5441                              <1> nextpcidevice:
  5442 00004673 B000                <1> 	mov al, 0
  5443 00004675 A2[23460000]        <1> 	mov [pcifunction], al
  5444 0000467A A0[22460000]        <1> 	mov al, [pcidevice]
  5445 0000467F 3C1F                <1> 	cmp al, 11111b
  5446 00004681 0F83B8000000        <1> 	jae near nextpcibus
  5447 00004687 FEC0                <1> 	inc al
  5448 00004689 A2[22460000]        <1> 	mov [pcidevice], al
  5449 0000468E EBC0                <1> 	jmp searchpci
  5450 00004690 A0[23460000]        <1> 	mov al, [pcifunction]
  5451 00004695 3C07                <1> 	cmp al, 111b
  5452 00004697 0F83D6FFFFFF        <1> 	jae near nextpcidevice
  5453 0000469D FEC0                <1> 	inc al
  5454 0000469F A2[23460000]        <1> 	mov [pcifunction], al
  5455 000046A4 EBAA                <1> 	jmp searchpci
  5456 000046A6 00000000            <1> pcitype: db 0,0,0,0
  5457                              <1> checkpcidevice:
  5458 000046AA B000                <1> 	mov al, 0
  5459 000046AC 3805[25460000]      <1> 	cmp [pcireqtype], al
  5460 000046B2 0F842B000000        <1> 	je near dumppcidevice
  5461 000046B8 B008                <1> 	mov al, 0x08
  5462 000046BA A2[24460000]        <1> 	mov [pciregister], al	;;class code, subclass, revision id
  5463 000046BF E8E7000000          <1> 	call getpciaddr
  5464 000046C4 BAF80C0000          <1> 	mov edx, 0xCF8
  5465 000046C9 EF                  <1> 	out dx, eax
  5466 000046CA BAFC0C0000          <1> 	mov edx, 0xCFC
  5467 000046CF ED                  <1> 	in eax, dx
  5468 000046D0 C1C008              <1> 	rol eax, 8
  5469 000046D3 8A1D[A6460000]      <1> 	mov bl, [pcitype]
  5470 000046D9 38D8                <1> 	cmp al, bl
  5471 000046DB 0F8480000000        <1> 	je near foundpciaddr
  5472 000046E1 EB90                <1> 	jmp searchpciret
  5473                              <1> dumppcidevice:
  5474 000046E3 B000                <1> 	mov al, 0
  5475 000046E5 A2[24460000]        <1> 	mov [pciregister], al
  5476 000046EA E8BC000000          <1> 	call getpciaddr
  5477 000046EF 89C1                <1> 	mov ecx, eax
  5478 000046F1 C605[DA150000]00    <1> 	mov byte [firsthexshown],0
  5479 000046F8 E8F2CEFFFF          <1> 	call showhex
  5480                              <1> dumppcidevicelp:
  5481 000046FD A2[24460000]        <1> 	mov [pciregister], al
  5482 00004702 E8A4000000          <1> 	call getpciaddr
  5483 00004707 BAF80C0000          <1> 	mov edx, 0xCF8
  5484 0000470C EF                  <1> 	out dx, eax
  5485 0000470D BAFC0C0000          <1> 	mov edx, 0xCFC
  5486 00004712 ED                  <1> 	in eax, dx
  5487 00004713 89C1                <1> 	mov ecx, eax
  5488 00004715 A0[24460000]        <1> 	mov al, [pciregister]
  5489 0000471A 0404                <1> 	add al, 4
  5490 0000471C 3C1A                <1> 	cmp al, 0x1A
  5491 0000471E 730E                <1> 	jae dumppcidn
  5492 00004720 C605[DA150000]00    <1> 	mov byte [firsthexshown],0
  5493 00004727 E8C3CEFFFF          <1> 	call showhex
  5494 0000472C EBCF                <1> 	jmp dumppcidevicelp
  5495                              <1> dumppcidn:
  5496 0000472E C605[DA150000]00    <1> 	mov byte [firsthexshown],0
  5497 00004735 E8B5CEFFFF          <1> 	call showhex
  5498 0000473A E934FFFFFF          <1> 	jmp searchpciret
  5499                              <1> nextpcibus:
  5500 0000473F B000                <1> 	mov al, 0
  5501 00004741 A2[22460000]        <1> 	mov [pcidevice], al
  5502 00004746 A0[21460000]        <1> 	mov al, [pcibus]
  5503 0000474B 3C7F                <1> 	cmp al, 1111111b
  5504 0000474D 730C                <1> 	jae donesearchpci
  5505 0000474F FEC0                <1> 	inc al
  5506 00004751 A2[21460000]        <1> 	mov [pcibus], al
  5507 00004756 E9F5FEFFFF          <1> 	jmp searchpci
  5508                              <1> donesearchpci:
  5509 0000475B BA00000000          <1> 	mov edx, 0
  5510 00004760 C3                  <1> 	ret
  5511                              <1> foundpciaddr:
  5512 00004761 B010                <1> 	mov al, 0x10
  5513 00004763 A2[24460000]        <1> 	mov [pciregister], al
  5514                              <1> findpciioaddr:
  5515 00004768 E83E000000          <1> 	call getpciaddr
  5516 0000476D BAF80C0000          <1> 	mov edx, 0xCF8
  5517 00004772 EF                  <1> 	out dx, eax
  5518 00004773 BAFC0C0000          <1> 	mov edx, 0xCFC
  5519 00004778 ED                  <1> 	in eax, dx
  5520 00004779 89C3                <1> 	mov ebx, eax
  5521 0000477B 81E301000000        <1> 	and ebx, 1
  5522 00004781 81FB00000000        <1> 	cmp ebx, 0
  5523 00004787 0F8408000000        <1> 	je near notpciioaddr
  5524 0000478D 2D01000000          <1> 	sub eax, 1
  5525 00004792 89C2                <1> 	mov edx, eax
  5526 00004794 C3                  <1> 	ret
  5527                              <1> notpciioaddr:
  5528 00004795 A0[24460000]        <1> 	mov al, [pciregister]
  5529 0000479A 0404                <1> 	add al, 4
  5530 0000479C 3C28                <1> 	cmp al, 0x28
  5531 0000479E 0F87CFFEFFFF        <1> 	ja near searchpciret
  5532 000047A4 A2[24460000]        <1> 	mov [pciregister], al
  5533 000047A9 EBBD                <1> 	jmp findpciioaddr
  5534                              <1> getpciaddr:		;;puts it in eax and ebx
  5535 000047AB B800000000          <1> 			mov eax, 0
  5536 000047B0 BB00000080          <1> 			mov ebx, 0x80000000
  5537 000047B5 A0[21460000]        <1> 			mov al, [pcibus]
  5538 000047BA C1E010              <1> 			shl eax, 16
  5539 000047BD 01C3                <1> 			add ebx, eax
  5540 000047BF B800000000          <1> 			mov eax, 0
  5541 000047C4 A0[22460000]        <1> 			mov al, [pcidevice]
  5542 000047C9 C1E00B              <1> 			shl eax, 11
  5543 000047CC 01C3                <1> 			add ebx, eax
  5544 000047CE B800000000          <1> 			mov eax, 0
  5545 000047D3 A0[23460000]        <1> 			mov al, [pcifunction]
  5546 000047D8 C1E008              <1> 			shl eax, 8
  5547 000047DB 01C3                <1> 			add ebx, eax
  5548 000047DD B800000000          <1> 			mov eax, 0
  5549 000047E2 A0[24460000]        <1> 			mov al, [pciregister]
  5550 000047E7 01C3                <1> 			add ebx, eax
  5551 000047E9 89D8                <1> 			mov eax, ebx
  5552 000047EB C3                  <1> 			ret
  5553                              <1> 			
  5554                                  	;%include 'source/process.asm'
  5555                                      %include 'source/disk.asm'
  5556                              <1> ;;disk.asm - new - using lba
  5557                              <1> loadfile:	;;loads a file with the name buffer's location in edi into location in esi
  5558 000047EC 803F00              <1> 	cmp byte [edi], 0
  5559 000047EF 0F8444000000        <1> 	je near nofileload
  5560 000047F5 89FA                <1> 	mov edx, edi
  5561 000047F7 BB[EB6B0000]        <1> 	mov ebx, diskfileindex
  5562                              <1> nextnamechar:
  5563 000047FC 8A07                <1> 	mov al, [edi]
  5564 000047FE 8A23                <1> 	mov ah, [ebx]
  5565 00004800 47                  <1> 	inc edi
  5566 00004801 43                  <1> 	inc ebx
  5567 00004802 88C1                <1> 	mov cl, al
  5568 00004804 08E1                <1> 	or cl, ah
  5569 00004806 80F900              <1> 	cmp cl, 0
  5570 00004809 744E                <1> 	je equalfilenames
  5571 0000480B 80F920              <1> 	cmp cl, ' '
  5572 0000480E 7449                <1> 	je equalfilenames
  5573 00004810 3C2A                <1> 	cmp al, '*'
  5574 00004812 742B                <1> 	je equalfilenames2
  5575 00004814 80FC00              <1> 	cmp ah, 0
  5576 00004817 7410                <1> 	je nextfilename
  5577 00004819 3C00                <1> 	cmp al, 0
  5578 0000481B 740C                <1> 	je nextfilename
  5579 0000481D 38E0                <1> 	cmp al, ah
  5580 0000481F 74DB                <1> 	je nextnamechar
  5581                              <1> getebxzero:
  5582 00004821 8A23                <1> 	mov ah, [ebx]
  5583 00004823 43                  <1> 	inc ebx
  5584 00004824 80FC00              <1> 	cmp ah, 0
  5585 00004827 75F8                <1> 	jne getebxzero
  5586                              <1> nextfilename:
  5587 00004829 81C308000000        <1> 	add ebx, 8		;;next descriptor
  5588 0000482F 89D7                <1> 	mov edi, edx
  5589 00004831 81FB[506C0000]      <1> 	cmp ebx, enddiskfileindex
  5590 00004837 72C3                <1> 	jb nextnamechar
  5591                              <1> nofileload:
  5592 00004839 BA94010000          <1> 	mov edx, 404	;;indicate not found error
  5593 0000483E C3                  <1> 	ret
  5594                              <1> equalfilenames2:
  5595 0000483F 81EB02000000        <1> 	sub ebx, 2
  5596                              <1> eqfilefind:
  5597 00004845 43                  <1> 	inc ebx
  5598 00004846 81FB[506C0000]      <1> 	cmp ebx, enddiskfileindex
  5599 0000484C 0F83E7FFFFFF        <1> 	jae near nofileload
  5600 00004852 8A03                <1> 	mov al, [ebx]
  5601 00004854 3C00                <1> 	cmp al, 0
  5602 00004856 75ED                <1> 	jne eqfilefind
  5603 00004858 43                  <1> 	inc ebx
  5604                              <1> equalfilenames:
  5605 00004859 8B4304              <1> 	mov eax, [ebx + 4] 	;;put file size in eax
  5606 0000485C 8B1B                <1> 	mov ebx, [ebx]		;;put file beginning in ebx
  5607 0000485E 031D[63010000]      <1> 	add ebx, [lbaad]	;;add offset to solleros
  5608 00004864 B900000000          <1> 	mov ecx, 0
  5609 00004869 88C1                <1> 	mov cl, al			;;get excess number of sectors
  5610 0000486B D0E1                <1> 	shl cl, 1
  5611 0000486D D0E9                <1> 	shr cl, 1			;;cut off at 128
  5612 0000486F 29C8                <1> 	sub eax, ecx		;;get rid of excess sectors
  5613 00004871 B500                <1> 	mov ch, 0			;;drive 0
  5614 00004873 C1E807              <1> 	shr eax, 7			;;get number of 128 sector tracks
  5615                              <1> loaddiskfile:		;;tracks in eax, excess sectors in cl, drive in ch, buffer in esi, address in ebx
  5616 00004876 A3[B4480000]        <1> 	mov [filetracks], eax
  5617 0000487B 89F7                <1> 	mov edi, esi		;;just in case cl is 0
  5618 0000487D 89DA                <1> 	mov edx, ebx
  5619 0000487F 80F900              <1> 	cmp cl, 0
  5620 00004882 7405                <1> 	je copytracksforfile
  5621 00004884 E831000000          <1> 	call diskr		;;take care of excess sectors
  5622                              <1> copytracksforfile:
  5623 00004889 A1[B4480000]        <1> 	mov eax, [filetracks]
  5624 0000488E 3D00000000          <1> 	cmp eax, 0
  5625 00004893 7419                <1> 	je donecopyfile
  5626 00004895 48                  <1> 	dec eax
  5627 00004896 A3[B4480000]        <1> 	mov [filetracks], eax
  5628 0000489B 89D3                <1> 	mov ebx, edx	;;get end lba
  5629 0000489D B180                <1> 	mov cl, 0x80
  5630 0000489F 8A2D[62010000]      <1> 	mov ch, [DriveNumber]
  5631 000048A5 89FE                <1> 	mov esi, edi	;;reset buffer
  5632 000048A7 E80E000000          <1> 	call diskr
  5633 000048AC EBDB                <1> 	jmp copytracksforfile
  5634                              <1> donecopyfile:
  5635 000048AE BA00000000          <1> 	mov edx, 0	;;no error
  5636 000048B3 C3                  <1> 	ret
  5637                              <1> 	
  5638 000048B4 00000000            <1> filetracks dd 0
  5639                              <1> 	
  5640 000048B8 6400                <1> segments dw 100
  5641                              <1> 
  5642                              <1> diskr:		;;sector count in cl, disk number in ch, 48 bit address with first 32 bits in ebx, buffer in esi, puts end buffer in edi and end lba in edx
  5643                              <1> 
  5644 000048BA 8935[9E490000]      <1> 	mov [bufferstartesi], esi
  5645 000048C0 891D[9A490000]      <1> 	mov [lbaadstartebx], ebx
  5646 000048C6 BA00000000          <1> 	mov edx, 0
  5647 000048CB 88CA                <1> 	mov dl, cl
  5648 000048CD 01DA                <1> 	add edx, ebx
  5649 000048CF 8915[96490000]      <1> 	mov [lbaadend], edx
  5650 000048D5 66B80000            <1> 	mov ax, 0
  5651 000048D9 66BAF101            <1> 	mov dx, 0x1F1
  5652 000048DD EE                  <1> 	out dx, al	;;2 null bytes
  5653 000048DE EE                  <1> 	out dx, al
  5654 000048DF B000                <1> 	mov al, 0
  5655 000048E1 66BAF201            <1> 	mov dx, 0x1F2
  5656 000048E5 EE                  <1> 	out dx, al	;;16 bit sector count-last byte now 0
  5657 000048E6 88C8                <1> 	mov al, cl
  5658 000048E8 EE                  <1> 	out dx, al
  5659 000048E9 66BAF301            <1> 	mov dx, 0x1F3
  5660 000048ED 89D8                <1> 	mov eax, ebx
  5661 000048EF C1C818              <1> 	ror eax, 24
  5662 000048F2 EE                  <1> 	out dx, al	;;4th byte of address
  5663 000048F3 C1C018              <1> 	rol eax, 24
  5664 000048F6 EE                  <1> 	out dx, al	;;1st byte of address
  5665 000048F7 66BAF401            <1> 	mov dx, 0x1F4
  5666 000048FB B000                <1> 	mov al, 0
  5667 000048FD EE                  <1> 	out dx, al	;;5th byte of address-always 0 for now
  5668 000048FE C1C808              <1> 	ror eax, 8
  5669 00004901 EE                  <1> 	out dx, al	;;2nd byte of address
  5670 00004902 66BAF501            <1> 	mov dx, 0x1F5
  5671 00004906 C1C008              <1> 	rol eax, 8
  5672 00004909 B000                <1> 	mov al, 0
  5673 0000490B EE                  <1> 	out dx, al	;;6th byte
  5674 0000490C C1C810              <1> 	ror eax, 16
  5675 0000490F EE                  <1> 	out dx, al	;;3rd byte
  5676 00004910 B840000000          <1> 	mov eax, 0x40
  5677 00004915 66BAF601            <1> 	mov dx, 0x1F6
  5678 00004919 EE                  <1> 	out dx, al	;;send magic bits-add drive indicator later
  5679 0000491A B024                <1> 	mov al, 0x24
  5680 0000491C 66BAF701            <1> 	mov dx, 0x1F7
  5681 00004920 EE                  <1> 	out dx, al	;;READ!!!
  5682                              <1> diskrwait:
  5683 00004921 66BAF701            <1> 	mov dx, 0x1F7
  5684 00004925 EC                  <1> 	in al, dx
  5685 00004926 2408                <1> 	and al, 0x08
  5686 00004928 3C08                <1> 	cmp al, 0x08
  5687 0000492A 75F5                <1> 	jne diskrwait
  5688 0000492C 88CD                <1> 	mov ch, cl	;;move sector data into ch, multiplying it by 256
  5689 0000492E B100                <1> 	mov cl, 0
  5690                              <1> diskdataread:
  5691 00004930 66BAF001            <1> 	mov dx, 0x1F0
  5692 00004934 66ED                <1> 	in ax, dx
  5693 00004936 668906              <1> 	mov [esi], ax
  5694 00004939 81C602000000        <1> 	add esi, 2
  5695 0000493F 6649                <1> 	dec cx
  5696 00004941 6681F90000          <1> 	cmp cx, 0
  5697 00004946 75E8                <1> 	jne diskdataread		;;read all sectors
  5698 00004948 89F7                <1> 	mov edi, esi
  5699 0000494A 8B15[96490000]      <1> 	mov edx, [lbaadend]
  5700 00004950 8B35[9E490000]      <1> 	mov esi, [bufferstartesi]
  5701 00004956 8B1D[9A490000]      <1> 	mov ebx, [lbaadstartebx]
  5702 0000495C C3                  <1> 	ret
  5703                              <1> 	
  5704                              <1> 	
  5705                              <1> diskold: ;;28 bits
  5706 0000495D 66B80000            <1> 	mov ax, 0
  5707 00004961 66BAF101            <1> 	mov dx, 0x1F1
  5708 00004965 EE                  <1> 	out dx, al	;;send null byte to port
  5709 00004966 6642                <1> 	inc dx	;;0x1F2
  5710 00004968 88C8                <1> 	mov al, cl	;;get sector count
  5711 0000496A EE                  <1> 	out dx, al	;;send sector count
  5712 0000496B 6642                <1> 	inc dx	;;0x1F3
  5713 0000496D 88D8                <1> 	mov al, bl	;;get first 8 bits of address
  5714 0000496F EE                  <1> 	out dx, al	;;send them
  5715 00004970 6642                <1> 	inc dx	;;0x1F4
  5716 00004972 C1CB08              <1> 	ror ebx, 8	;;get next 8 bits
  5717 00004975 88D8                <1> 	mov al, bl
  5718 00004977 EE                  <1> 	out dx, al
  5719 00004978 6642                <1> 	inc dx	;;0x1F5
  5720 0000497A C1CB08              <1> 	ror ebx, 8	;;again
  5721 0000497D 88D8                <1> 	mov al, bl
  5722 0000497F EE                  <1> 	out dx, al
  5723 00004980 6642                <1> 	inc dx	;;0x1F6
  5724 00004982 C1CB08              <1> 	ror ebx, 8
  5725 00004985 88D8                <1> 	mov al, bl
  5726 00004987 240F                <1> 	and al, 00001111b	;;last 4 bits of address
  5727 00004989 0CE0                <1> 	or al, 0xE0			;;majic number
  5728 0000498B C0E504              <1> 	shl ch, 4
  5729 0000498E 08E8                <1> 	or al, ch
  5730 00004990 EE                  <1> 	out dx, al			;;send drive indicator, magic bits, and highest 4 bits of address
  5731 00004991 6642                <1> 	inc dx	;;0x1F7
  5732 00004993 B020                <1> 	mov al, 0x20
  5733 00004995 EE                  <1> 	out dx, al			;;execute read command
  5734                              <1> 	
  5735 00004996 00000000            <1> lbaadend dd 0
  5736 0000499A 00000000            <1> lbaadstartebx dd 0
  5737 0000499E 00000000            <1> bufferstartesi dd 0
  5738                                  	%include 'source/threads.asm'
  5739                              <1> ;;THIS IS MY FIRST ATTEMPT AT IMPLEMENTING THREADS
  5740                              <1> threadstarttest:
  5741 000049A2 E8E5200000          <1>     call startthreads
  5742 000049A7 EBFE                <1> 	jmp $
  5743                              <1> mainthread:
  5744 000049A9 F4                  <1> 	hlt		;;this does not work properly
  5745 000049AA BE[B6490000]        <1> 	mov esi, thrdmain
  5746 000049AF E89EC2FFFF          <1> 	call print
  5747 000049B4 EBF3                <1> 	jmp mainthread
  5748 000049B6 4D41494E2054485245- <1> thrdmain db "MAIN THREAD ",0
  5749 000049BF 41442000            <1>
  5750                              <1> 
  5751                              <1> thread1:
  5752 000049C3 B85E000000          <1> 	mov eax, 94
  5753                              <1> thrdlp1:
  5754 000049C8 48                  <1> 	dec eax
  5755 000049C9 50                  <1> 	push eax
  5756 000049CA BE[DE490000]        <1> 	mov esi, thrd1
  5757 000049CF E87EC2FFFF          <1> 	call print
  5758 000049D4 58                  <1> 	pop eax
  5759 000049D5 3D00000000          <1> 	cmp eax, 0
  5760 000049DA 74FE                <1> 	je $
  5761 000049DC EBEA                <1> 	jmp thrdlp1
  5762                              <1> 	
  5763 000049DE 544852454144203120- <1> thrd1	db "THREAD 1  ",0
  5764 000049E7 2000                <1>
  5765                              <1> 
  5766                              <1> thread2:
  5767 000049E9 B85F000000          <1> 	mov eax, 95
  5768                              <1> thrdlp2:
  5769 000049EE 48                  <1> 	dec eax
  5770 000049EF 50                  <1> 	push eax
  5771 000049F0 BE[044A0000]        <1> 	mov esi, thrd2
  5772 000049F5 E858C2FFFF          <1> 	call print
  5773 000049FA 58                  <1> 	pop eax
  5774 000049FB 3D00000000          <1> 	cmp eax, 0
  5775 00004A00 74FE                <1> 	je $
  5776 00004A02 EBEA                <1> 	jmp thrdlp2
  5777                              <1> 	
  5778 00004A04 544852454144203220- <1> thrd2 db "THREAD 2  ",0
  5779 00004A0D 2000                <1>
  5780                              <1> 	
  5781                              <1> thread3:
  5782 00004A0F B860000000          <1> 	mov eax, 96
  5783                              <1> thrd3lp:
  5784 00004A14 2D02000000          <1> 	sub eax, 2	;;each cycle will take twice as long
  5785 00004A19 89C1                <1> 	mov ecx, eax
  5786 00004A1B 50                  <1> 	push eax
  5787 00004A1C E8CECBFFFF          <1> 	call showhex
  5788 00004A21 BE[494A0000]        <1> 	mov esi, thrd3
  5789 00004A26 E827C2FFFF          <1> 	call print
  5790 00004A2B 58                  <1> 	pop eax
  5791 00004A2C 3D00000000          <1> 	cmp eax, 0
  5792 00004A31 0F8402000000        <1> 	je near nwcmdst
  5793 00004A37 EBDB                <1> 	jmp thrd3lp
  5794                              <1> 	
  5795                              <1> nwcmdst:
  5796 00004A39 FA                  <1> 	cli			;;no more interrupts!!!
  5797 00004A3A BE[8E6C0000]        <1> 	mov esi, line
  5798 00004A3F E80EC2FFFF          <1> 	call print
  5799 00004A44 E95EC7FFFF          <1> 	jmp nwcmd
  5800                              <1> 	
  5801 00004A49 544852454144203320- <1> thrd3 db "THREAD 3  ",0
  5802 00004A52 2000                <1>
  5803                              <1> 	
  5804                              <1> modelthread:
  5805 00004A54 B900000000          <1> 	mov ecx, 0
  5806 00004A59 668B0D[E96B0000]    <1> 	mov cx, [currentthread]
  5807 00004A60 E88ACBFFFF          <1> 	call showhex
  5808 00004A65 F4                  <1> 	hlt		;;wait for next time around
  5809 00004A66 B90000ADDE          <1> 	mov ecx, 0xDEAD0000
  5810 00004A6B 668B0D[E96B0000]    <1> 	mov cx, [currentthread]
  5811 00004A72 E878CBFFFF          <1> 	call showhex
  5812 00004A77 F4                  <1> 	hlt
  5813 00004A78 B90000DEC0          <1> 	mov ecx, 0xC0DE0000
  5814 00004A7D 668B0D[E96B0000]    <1> 	mov cx, [currentthread]
  5815 00004A84 E866CBFFFF          <1> 	call showhex
  5816 00004A89 F4                  <1> 	hlt
  5817 00004A8A EBAD                <1> 	jmp nwcmdst
  5818                              <1> 	
  5819                              <1> 	
  5820                              <1> thrdtst:
  5821                              <1> 	;dd thread1
  5822                              <1> 	;dd thread2
  5823                              <1> 	;dd thread3
  5824 00004A8C [544A0000]<rept>    <1> times 2048 dd modelthread
  5825                              <1> thrdtstend:
  5826                              <1> 
  5827                              <1> startthreads:
  5828 00006A8C 60                  <1> 	pushad
  5829 00006A8D 66B8FFFF            <1> 	mov ax, 0xFFFF
  5830 00006A91 66C1E802            <1> 	shr ax, 2	;;divide by 4 to make interrupts happen four times faster
  5831 00006A95 E640                <1> 	out 0x40, al
  5832 00006A97 66C1C008            <1> 	rol ax, 8
  5833 00006A9B E640                <1> 	out 0x40, al
  5834                              <1> 	
  5835 00006A9D 8CC8                <1> 	mov eax, cs
  5836 00006A9F 89C2                <1> 	mov edx, eax
  5837 00006AA1 8B4C2428            <1> 	mov ecx, [esp + 40]
  5838 00006AA5 81C900020000        <1> 	or ecx, 0x200
  5839 00006AAB 89E3                <1> 	mov ebx, esp
  5840 00006AAD BC[3B780000]        <1> 	mov esp, stackdummy
  5841 00006AB2 90                  <1> 	nop
  5842 00006AB3 60                  <1> 	pushad
  5843 00006AB4 B8[A9490000]        <1> 	mov eax, mainthread
  5844 00006AB9 89442420            <1> 	mov [esp + 32], eax
  5845 00006ABD 89542424            <1> 	mov [esp + 36], edx
  5846 00006AC1 894C2428            <1> 	mov [esp + 40], ecx
  5847 00006AC5 8925[33540000]      <1> 	mov [threadlist], esp
  5848                              <1> 			;;that above setup the dummy thread which for some reason does not run
  5849                              <1> 			;;this below will setup the threads found in thrdtst
  5850 00006ACB BE[8C4A0000]        <1> 	mov esi, thrdtst
  5851 00006AD0 BC[3B7C0000]        <1> 	mov esp, stack1
  5852 00006AD5 BF[33540000]        <1> 	mov edi, threadlist
  5853 00006ADA 81C704000000        <1> 	add edi, 4
  5854                              <1> nxtthreadld:
  5855 00006AE0 60                  <1> 	pushad
  5856 00006AE1 8B06                <1> 	mov eax, [esi]
  5857 00006AE3 89442420            <1> 	mov [esp + 32], eax
  5858 00006AE7 89542424            <1> 	mov [esp + 36], edx
  5859 00006AEB 894C2428            <1> 	mov [esp + 40], ecx
  5860 00006AEF 8927                <1> 	mov [edi], esp
  5861 00006AF1 81C400040000        <1> 	add esp, 1024
  5862 00006AF7 81C604000000        <1> 	add esi, 4
  5863 00006AFD 81C704000000        <1> 	add edi, 4
  5864 00006B03 81FF[3B740000]      <1> 	cmp edi, threadlistend
  5865 00006B09 0F8322000000        <1> 	jae near nomorethreadspace
  5866 00006B0F 81FC[3B842000]      <1> 	cmp esp, bssend
  5867 00006B15 0F8344000000        <1> 	jae near nomorestackspace
  5868 00006B1B 81FE[8C6A0000]      <1> 	cmp esi, thrdtstend
  5869 00006B21 72BD                <1> 	jb nxtthreadld
  5870 00006B23 89DC                <1> 	mov esp, ebx
  5871 00006B25 B0FE                <1> 	mov al, 0xFE
  5872 00006B27 E621                <1> 	out 0x21, al
  5873 00006B29 B020                <1> 	mov al, 0x20
  5874 00006B2B E620                <1> 	out 0x20, al
  5875 00006B2D 61                  <1> 	popad
  5876 00006B2E FB                  <1> 	sti
  5877 00006B2F EBFE                <1> 	jmp $	;;wait for the irq to hook
  5878                              <1> 	
  5879                              <1> nomorethreadspace:
  5880 00006B31 BE[3D6B0000]        <1> 	mov esi, nmts
  5881 00006B36 E817A1FFFF          <1> 	call print
  5882 00006B3B EBFE                <1> 	jmp $
  5883 00006B3D 74656820636F6C6F6E- <1> nmts	db "teh colonel no can haz moar treds",0
  5884 00006B46 656C206E6F2063616E- <1>
  5885 00006B4F 2068617A206D6F6172- <1>
  5886 00006B58 20747265647300      <1>
  5887                              <1> 
  5888                              <1> nomorestackspace:
  5889 00006B5F BE[6B6B0000]        <1> 	mov esi, nmss
  5890 00006B64 E8E9A0FFFF          <1> 	call print
  5891 00006B69 EBFE                <1> 	jmp $
  5892 00006B6B 74656820636F6C6F6E- <1> nmss	db "teh colonel no can haz moar staqz",0
  5893 00006B74 656C206E6F2063616E- <1>
  5894 00006B7D 2068617A206D6F6172- <1>
  5895 00006B86 20737461717A00      <1>
  5896                              <1> 	
  5897                              <1> threadswitch:
  5898 00006B8D FA                  <1> 	cli
  5899 00006B8E 60                  <1> 	pushad
  5900 00006B8F BF[33540000]        <1> 	mov edi, threadlist
  5901 00006B94 B800000000          <1> 	mov eax, 0
  5902 00006B99 66A1[E96B0000]      <1> 	mov ax, [currentthread]
  5903 00006B9F 6640                <1> 	inc ax
  5904 00006BA1 66A3[E96B0000]      <1> 	mov [currentthread], ax
  5905 00006BA7 6648                <1> 	dec ax
  5906 00006BA9 C1E002              <1> 	shl eax, 2
  5907 00006BAC 01C7                <1> 	add edi, eax
  5908 00006BAE 8927                <1> 	mov [edi], esp
  5909 00006BB0 81C704000000        <1> 	add edi, 4
  5910 00006BB6 81FF[3B740000]      <1> 	cmp edi, threadlistend
  5911 00006BBC 0F830D000000        <1> 	jae near nookespthread
  5912 00006BC2 8B07                <1> 	mov eax, [edi]
  5913 00006BC4 3D00000000          <1> 	cmp eax, 0
  5914 00006BC9 0F8511000000        <1> 	jne near okespthread
  5915                              <1> nookespthread:
  5916 00006BCF BF[33540000]        <1> 	mov edi, threadlist
  5917 00006BD4 66B80000            <1> 	mov ax, 0
  5918 00006BD8 66A3[E96B0000]      <1> 	mov [currentthread], ax
  5919 00006BDE 8B07                <1> 	mov eax, [edi]
  5920                              <1> okespthread:
  5921 00006BE0 89C4                <1> 	mov esp, eax
  5922 00006BE2 B020                <1> 	mov al, 0x20
  5923 00006BE4 E620                <1> 	out 0x20, al
  5924 00006BE6 61                  <1> 	popad
  5925 00006BE7 FB                  <1> 	sti
  5926 00006BE8 CF                  <1> 	iretd
  5927                              <1> 	
  5928 00006BE9 0000                <1> currentthread dw 0
  5929                                      %include 'fileindex.asm'
  5930                              <1> diskfileindex:
  5931 00006BEB 65787000            <1> db "exp",0
  5932 00006BEF 3C000000            <1> dd (f0-$$)/512
  5933 00006BF3 01000000            <1> dd (f1-f0)/512
  5934 00006BF7 736F6C6C65726F732E- <1> db "solleros.bmp",0
  5935 00006C00 626D7000            <1>
  5936 00006C04 3D000000            <1> dd (f1-$$)/512
  5937 00006C08 B0020000            <1> dd (f2-f1)/512
  5938 00006C0C 736F6C6C65726F732E- <1> db "solleros.txt",0
  5939 00006C15 74787400            <1>
  5940 00006C19 ED020000            <1> dd (f2-$$)/512
  5941 00006C1D 01000000            <1> dd (f3-f2)/512
  5942 00006C21 74656C7900          <1> db "tely",0
  5943 00006C26 EE020000            <1> dd (f3-$$)/512
  5944 00006C2A 01000000            <1> dd (f4-f3)/512
  5945 00006C2E 74696D6500          <1> db "time",0
  5946 00006C33 EF020000            <1> dd (f4-$$)/512
  5947 00006C37 02000000            <1> dd (f5-f4)/512
  5948 00006C3B 7475746F7269616C2E- <1> db "tutorial.bat",0
  5949 00006C44 62617400            <1>
  5950 00006C48 F1020000            <1> dd (f5-$$)/512
  5951 00006C4C 03000000            <1> dd (f6-f5)/512
  5952                              <1> enddiskfileindex:
  5953                              <1> 
  5954                                  	%include 'source/msg.asm'
  5955 00006C50 6578697400          <1> 	exitmsg db	"exit",0
  5956 00006C55 50726F6772616D2022- <1> 	notfound1 db "Program ",34,0
  5957 00006C5E 00                  <1>
  5958 00006C5F 22206E6F7420666F75- <1> 	notfound2 db  34," not found.",13,10,0
  5959 00006C68 6E642E0D0A00        <1>
  5960 00006C6E 757365726E616D653A- <1> 	userask db "username:",0
  5961 00006C77 00                  <1>
  5962 00006C78 70617373776F72643A- <1> 	pwdask	db	"password:",0
  5963 00006C81 00                  <1>
  5964 00006C82 40536F6C6C65724F53- <1> 	location	db	"@SollerOS]#",0
  5965 00006C8B 5D2300              <1>
  5966 00006C8E 0D0A00              <1> 	line	db	13,10,0
  5967                              <1> 	userlst:
  5968 00006C91 7573657200          <1> 			db "user",0
  5969 00006C96 70617373776F726400  <1> 			db "password",0
  5970 00006C9F 726F6F7400          <1> 			db "root",0
  5971 00006CA4 617765736F6D65706F- <1> 			db "awesomepower",0
  5972 00006CAD 77657200            <1>
  5973 00006CB1 6E00                <1> 			db "n",0	;;use for quick entry-a quick double n followed by a double enter will get you in
  5974 00006CB3 00                  <1> 			db 0
  5975                              <1> 	userlstend:
  5976                              <1> 	
  5977 00006CB3 <incbin>            <1> fonts:	incbin 'source/precompiled/fonts.pak'
  5978                              <1> fontend2:
  5979                              <1> mcursor:
  5980 000074C4 01                  <1> 	db	00000001b
  5981 000074C5 81                  <1> 	db	10000001b
  5982 000074C6 C1                  <1> 	db	11000001b
  5983 000074C7 E1                  <1> 	db	11100001b
  5984 000074C8 F1                  <1> 	db	11110001b
  5985 000074C9 F9                  <1> 	db	11111001b
  5986 000074CA FD                  <1> 	db	11111101b
  5987 000074CB FF                  <1> 	db	11111111b
  5988 000074CC F9                  <1> 	db	11111001b
  5989 000074CD B9                  <1> 	db	10111001b
  5990 000074CE 39                  <1> 	db	00111001b
  5991 000074CF 1C                  <1> 	db	00011100b
  5992 000074D0 1C                  <1> 	db	00011100b
  5993 000074D1 0E                  <1> 	db	00001110b
  5994 000074D2 0E                  <1> 	db	00001110b
  5995 000074D3 0C                  <1> 	db	00001100b
  5996                              <1> fontend:
  5997                              <1> 
  5998                              <1> ;cursorbmp:
  5999                              <1> ;	db	1,0,0,0,0,0,0,0
  6000                              <1> ;	db	1,1,0,0,0,0,0,0
  6001                              <1> ;	db	1,1,1,0,0,0,0,0
  6002                              <1> ;	db	1,1,1,1,0,0,0,0
  6003                              <1> ;	db	1,1,1,1,1,0,0,0
  6004                              <1> ;	db	1,1,1,1,1,1,0,0
  6005                              <1> ;	db	1,1,1,1,1,1,1,0
  6006                              <1> ;	db	1,1,1,1,1,1,1,1
  6007                              <1> ;	db	1,1,1,1,1,1,0,0
  6008                              <1> ;	db	1,1,0,1,1,1,0,0
  6009                              <1> ;	db	1,0,0,1,1,1,0,0
  6010                              <1> ;	db	0,0,0,0,1,1,1,0
  6011                              <1> ;	db	0,0,0,0,1,1,1,0
  6012                              <1> ;	db	0,0,0,0,0,1,1,1
  6013                              <1> ;	db	0,0,0,0,0,1,1,1
  6014                              <1> ;	db	0,0,0,0,0,1,1,0
  6015                              <1> ;cursorbmpend:
  6016                              <1> 
  6017                              <1> 
  6018                              <1> VBEMODEBLOCK:
  6019 000074D4 00<rept>            <1> vbesignature 		times 4 db 0	;VBE Signature
  6020 000074D8 00<rept>            <1> vbeversion  		times 2 db 0	;VBE Version
  6021 000074DA 00<rept>            <1> oemstringptr  		times 4 db 0	;Pointer to OEM String
  6022 000074DE 00<rept>            <1> capabilities 		times 4 db 0	;Capabilities of graphics cont.
  6023 000074E2 00<rept>            <1> videomodeptr 		times 4 db 0	;Pointer to Video Mode List
  6024 000074E6 00<rept>            <1> totalmemory   		times 2 db 0	;number of 64Kb memory blocks
  6025 000074E8 00<rept>            <1> oemsoftwarerev  	times 2 db 0	;VBE implementation Software revision
  6026 000074EA 00<rept>            <1> oemvendornameptr 	times 4 db 0	;Pointer to Vendor Name String
  6027 000074EE 00<rept>            <1> oemproductnameptr 	times 4 db 0	;Pointer to Product Name String
  6028 000074F2 00<rept>            <1> oemproductrevptr 	times 4 db 0	;Pointer to Product Revision String
  6029 000074F6 00<rept>            <1> reserved			times 222 db 0	;Reserved for VBE implementation scratch area
  6030 000075D4 00<rept>            <1> oemdata 			times 256 db 0	;Data Area for OEM Strings
  6031                              <1> 
  6032                              <1> 
  6033                              <1> VBEMODEINFOBLOCK:
  6034                              <1> ;Mandatory information for all VBE revision
  6035 000076D4 00<rept>            <1> modeattributes   	times 2 db 0	;Mode attributes
  6036 000076D6 00                  <1> winaattributes   	times 1 db 0	;Window A attributes
  6037 000076D7 00                  <1> winbattributes   	times 1 db 0	;Window B attributes
  6038 000076D8 00<rept>            <1> wingranularity   	times 2 db 0	;Window granularity
  6039 000076DA 00<rept>            <1> winsize          	times 2 db 0	;Window size
  6040 000076DC 00<rept>            <1> winasegment      	times 2 db 0	;Window A start segment
  6041 000076DE 00<rept>            <1> winbsegment      	times 2 db 0	;Window B start segment
  6042 000076E0 00<rept>            <1> winfuncptr       	times 4 db 0	;pointer to window function
  6043 000076E4 00<rept>            <1> bytesperscanline 	times 2 db 0	;Bytes per scan line
  6044                              <1> 
  6045                              <1> ;Mandatory information for VBE 1.2 and above
  6046 000076E6 00<rept>            <1> xresolution     	times 2 db 0	;Horizontal resolution in pixel or chars
  6047 000076E8 00<rept>            <1> yresolution	    	times 2 db 0	;Vertical resolution in pixel or chars
  6048 000076EA 00                  <1> xcharsize       	times 1 db 0	;Character cell width in pixel
  6049 000076EB 00                  <1> ycharsize       	times 1 db 0	;Character cell height in pixel
  6050 000076EC 00                  <1> numberofplanes  	times 1 db 0	;Number of memory planes
  6051 000076ED 00                  <1> bitsperpixel    	times 1 db 0	;Bits per pixel
  6052 000076EE 00                  <1> numberofbanks   	times 1 db 0	;Number of banks
  6053 000076EF 00                  <1> memorymodel     	times 1 db 0	;Memory model type
  6054 000076F0 00                  <1> banksize        	times 1 db 0	;Bank size in KB
  6055 000076F1 00                  <1> numberofimagepages	times 1 db 0	;Number of images
  6056 000076F2 00                  <1> reserved1       	times 1 db 0	;Reserved for page function
  6057                              <1> 
  6058                              <1> ;Direct Color fields (required for direct/6 and YUV/7 memory models)
  6059 000076F3 00                  <1> redmasksize			times 1 db 0	;Size of direct color red mask in bits
  6060 000076F4 00                  <1> redfieldposition	times 1 db 0	;Bit position of lsb of red bask
  6061 000076F5 00                  <1> greenmasksize   	times 1 db 0	;Size of direct color green mask in bits
  6062 000076F6 00                  <1> greenfieldposition	times 1 db 0	;Bit position of lsb of green bask
  6063 000076F7 00                  <1> bluemasksize		times 1 db 0	;Size of direct color blue mask in bits
  6064 000076F8 00                  <1> bluefieldposition	times 1 db 0	;Bit position of lsb of blue bask
  6065 000076F9 00                  <1> rsvdmasksize        times 1	db 0	;Size of direct color reserved mask in bits
  6066 000076FA 00                  <1> rsvdfieldposition	times 1	db 0	;Bit position of lsb of reserved bask
  6067 000076FB 00                  <1> directcolormodeinfo	times 1 db 0	;Direct color mode attributes
  6068                              <1> 
  6069                              <1> ;Mandatory information for VBE 2.0 and above
  6070 000076FC 00<rept>            <1> physbaseptr 		times 4 db 0	;Physical address for flat frame buffer
  6071 00007700 00<rept>            <1> offscreenmemoffset 	times 4 db 0	;Pointer to start of off screen memory
  6072 00007704 00<rept>            <1> offscreenmemsize 	times 2 db 0    ;Amount of off screen memory in 1Kb units
  6073 00007706 00<rept>            <1> reserved2 			times 206 db 0  ;Remainder of ModeInfoBlock
  6074                                  	;%include 'source/memory.asm'
  6075                                  	%include 'source/buf.asm'
  6076 000077D4 4255465354415254    <1> db "BUFSTART"
  6077                              <1> [section .bss]
  6078                              <1> bssstart:
  6079                              <1> stack:
  6080 00000000 <res 00001000>      <1> 	resb 4096
  6081                              <1> stackend:
  6082                              <1> graphicstable: ;w type, dw datalocation, w locationx, w locationy, w selected, dw code
  6083 00001000 <res 00000200>      <1> 	resb 200h 
  6084                              <1> 	graphicstableend:
  6085                              <1> mousecolorbuf: ;where the gui under the mouse is stored
  6086 00001200 <res 00000100>      <1> 	resb 256 
  6087                              <1> mcolorend:
  6088 00001300 <res 00000001>      <1> IFON resb 1 
  6089 00001301 <res 00000064>      <1> IFTRUE resb 100 
  6090 00001365 <res 00000004>      <1> BATCHPOS resb 4 
  6091 00001369 <res 00000001>      <1> BATCHISON resb 1 
  6092 0000136A <res 00000001>      <1> LOOPON resb 1 
  6093 0000136B <res 00000004>      <1> LOOPPOS	resb 4 
  6094 0000136F <res 00000200>      <1> fileindex: resb 200h 
  6095                              <1> fileindexend:
  6096 0000156F <res 00000500>      <1> variables: 	resb 500h 
  6097 00001A6F <res 00000001>      <1> varend: resb 1
  6098 00001A70 <res 00000100>      <1> buftxt2: resb 100h
  6099 00001B70 <res 0000000A>      <1> resb 10
  6100 00001B7A <res 00000100>      <1> buftxt: resb 100h 
  6101 00001C7A <res 00000014>      <1> buf2:	resb 20 
  6102 00001C8E <res 00000001>      <1> numbuf: resb 1 
  6103 00001C8F <res 000012C0>      <1> videobuf2 		resb 0x12C0 
  6104 00002F4F <res 000000C8>      <1> videobufend		resb 200
  6105 00003017 <res 00000004>      <1> lastcommandpos: resb 4
  6106 0000301B <res 00000004>      <1> currentcommandpos: resb 4
  6107                              <1> commandbuf:
  6108 0000301F <res 00000400>      <1> resb 1024
  6109                              <1> commandbufend:
  6110                              <1> rbuffstart: ;for use with networking
  6111 0000341F <res 00002014>      <1> resb 8212
  6112                              <1> threadlist:	;;this buffer will hold the stack locations of all of the threads, up to 2048
  6113 00005433 <res 00002008>      <1> 	resb 2050*4
  6114                              <1> threadlistend:
  6115                              <1> stacks:		;;the stacks will go on forever until end of memory
  6116 0000743B <res 00000400>      <1> 	resb 1024
  6117                              <1> stackdummy:
  6118 0000783B <res 00000400>      <1> 	resb 1024
  6119                              <1> stack1:
  6120 00007C3B <res 00200800>      <1> 	resb 1024*2050	;;woah, thats a lot of space for stacks
  6121                              <1> bssend:		;;from here on, it is not kernel space so apps can be loaded here.
  6122                              <1> [section .text]
  6123                                      %include 'files.asm'
  6124 000077DC 00<rept>            <1> align 512,db 0
  6125                              <1> f0:
  6126 000077DC <incbin>            <1> incbin "included/exp"
  6127 00007822 00<rept>            <1> align 512,db 0
  6128                              <1> f1:
  6129 00007822 <incbin>            <1> incbin "included/solleros.bmp"
  6130 0005D9E6 00<rept>            <1> align 512,db 0
  6131                              <1> f2:
  6132 0005D9E6 <incbin>            <1> incbin "included/solleros.txt"
  6133 0005DB76 00<rept>            <1> align 512,db 0
  6134                              <1> f3:
  6135 0005DB76 <incbin>            <1> incbin "included/tely"
  6136 0005DDBD 00<rept>            <1> align 512,db 0
  6137                              <1> f4:
  6138 0005DDBD <incbin>            <1> incbin "included/time"
  6139 0005E07B 00<rept>            <1> align 512,db 0
  6140                              <1> f5:
  6141 0005E07B <incbin>            <1> incbin "included/tutorial.bat"
  6142 0005E6AA 00<rept>            <1> align 512,db 0
  6143                              <1> f6:
