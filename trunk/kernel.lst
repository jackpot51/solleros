     1                                  [BITS 16]
     2                                      %include 'source/menu.asm'
     3                              <1>     ; MENU.ASM
     4                              <1> menustart:	
     5 00000000 8CC8                <1> 	    mov ax, cs
     6 00000002 E90400              <1> 	    jmp mainindex	;;this command gives the solleros user the location of mainindex
     7 00000005 4A525300            <1> 	    db "JRS",0	;;this gives the bootloader a key to look for
     8                              <1> mainindex:
     9 00000009 E90000              <1> 	    jmp mainindexdn	;;this gives the size of the index
    10                              <1> 	    ;not needed;dw 0405h,progstart,batchprogend,fileindex,fileindexend,variables,varend,nwcmd,int30h,physbaseptr,0
    11                              <1> mainindexdn:
    12 0000000C 8ED8                <1> 	mov ds, ax
    13 0000000E 8EC0                <1> 	mov es, ax
    14 00000010 8ED0                <1> 	mov ss, ax
    15 00000012 880E[2B00]          <1> 	mov [DriveNumber], cl
    16 00000016 668916[2C00]        <1> 	mov [lbaad], edx
    17 0000001B B800A0              <1> 	mov ax, 0xA000
    18 0000001E 8EE8                <1> 	mov gs, ax
    19 00000020 B81200              <1> 	mov ax, 12h
    20 00000023 BB0000              <1> 	mov bx, 0
    21 00000026 CD10                <1> 	int 10h
    22 00000028 E90900              <1> 	jmp guiload
    23                              <1> 
    24 0000002B 00                  <1> DriveNumber db 0
    25 0000002C 00000000            <1> lbaad dd 0
    26                              <1> 	
    27 00000030 0000                <1> vesamode dw 0
    28 00000032 0000                <1> videomodecache dw 0
    29                              <1> 
    30                              <1> guiload:
    31 00000034 BE[5802]            <1> 	mov si, bootmsg
    32 00000037 E83301              <1> 	call printrm
    33 0000003A B80000              <1> 	mov ax, 0
    34 0000003D CD16                <1> 	int 16h
    35 0000003F 3C79                <1> 	cmp al, "y"
    36 00000041 0F85F400            <1> 	jne near guiload2
    37                              <1> guiloadagain:
    38 00000045 B8004F              <1> 	mov ax, 04F00h
    39 00000048 BF[034D]            <1> 	mov di, VBEMODEBLOCK
    40 0000004B CD10                <1> 	int 10h
    41 0000004D BE[254D]            <1> 	mov si, reserved
    42 00000050 81EE0200            <1> 	sub si, 2
    43                              <1> findvideomodes:
    44 00000054 81C60200            <1> 	add si, 2
    45 00000058 8B0C                <1> 	mov cx, [si]
    46 0000005A 81F9FFFF            <1> 	cmp cx, 0xFFFF
    47 0000005E 0F840A00            <1> 	je near nextvmode
    48 00000062 81FE[034E]          <1> 	cmp si, oemdata
    49 00000066 0F83CF00            <1> 	jae near guiload2	;;kill if no valid list is found
    50 0000006A EBE8                <1> 	jmp findvideomodes 	
    51                              <1> ;;debug,shows vmodes available
    52                              <1> nextvmode:
    53 0000006C 81EE0200            <1> 	sub si, 2
    54 00000070 81FE[254D]          <1> 	cmp si, reserved
    55 00000074 0F82CDFF            <1> 	jb near guiloadagain
    56 00000078 8B0C                <1> 	mov cx, [si]
    57 0000007A 81F9FFFF            <1> 	cmp cx, 0xFFFF
    58 0000007E 0F84EAFF            <1> 	je near nextvmode
    59 00000082 81C10040            <1> 	add cx, 0x4000 		;;Linear Frame Buffer
    60 00000086 B8014F              <1> 	mov ax, 04F01h
    61 00000089 BF[034F]            <1> 	mov di, VBEMODEINFOBLOCK
    62 0000008C 890E[3000]          <1> 	mov [vesamode], cx
    63 00000090 CD10                <1> 	int 10h
    64 00000092 A0[1C4F]            <1> 	mov al, [bitsperpixel]
    65 00000095 3C10                <1> 	cmp al, 16
    66 00000097 75D3                <1> 	jne nextvmode
    67 00000099 8936[3200]          <1> 	mov [videomodecache], si
    68 0000009D 80FC00              <1> 	cmp ah, 0
    69 000000A0 0F842200            <1> 	je near setvesamode
    70 000000A4 EBC6                <1> 	jmp nextvmode
    71 000000A6 0A0D49732074686973- <1> isthisvideook db 10,13,"Is this video mode OK?(y/n)",13,10,0
    72 000000AF 20766964656F206D6F- <1>
    73 000000B8 6465204F4B3F28792F- <1>
    74 000000C1 6E290D0A00          <1>
    75                              <1> setvesamode:
    76 000000C6 8B0E[154F]          <1> 	mov cx, [xresolution]
    77 000000CA E8B800              <1> 	call decshow
    78 000000CD B078                <1> 	mov al, "x"
    79 000000CF E82001              <1> 	call char
    80 000000D2 8B0E[174F]          <1> 	mov cx, [yresolution]
    81 000000D6 E8AC00              <1> 	call decshow
    82 000000D9 B040                <1> 	mov al, "@"
    83 000000DB E81401              <1> 	call char
    84 000000DE 8A0E[1C4F]          <1> 	mov cl, [bitsperpixel]
    85 000000E2 E8A000              <1> 	call decshow
    86 000000E5 BE[A600]            <1> 	mov si, isthisvideook
    87 000000E8 E88200              <1> 	call printrm
    88 000000EB B80000              <1> 	mov ax, 0
    89 000000EE CD16                <1> 	int 16h
    90 000000F0 8B36[3200]          <1> 	mov si, [videomodecache]
    91 000000F4 3C79                <1> 	cmp al, "y"
    92 000000F6 0F8572FF            <1> 	jne near nextvmode
    93 000000FA 8B16[154F]          <1> 	mov dx, [xresolution]
    94 000000FE 8B0E[174F]          <1> 	mov cx, [yresolution]
    95 00000102 8916[5237]          <1> 	mov [resolutionx], dx
    96 00000106 890E[5037]          <1> 	mov [resolutiony], cx
    97 0000010A 01D2                <1> 	add dx, dx
    98 0000010C 8916[5437]          <1> 	mov [resolutionx2], dx
    99 00000110 BA0000              <1> 	mov dx, 0
   100 00000113 B90000              <1> 	mov cx, 0
   101 00000116 B8024F              <1> 	mov ax, 04F02h
   102 00000119 8B1E[3000]          <1> 	mov bx, [vesamode]
   103 0000011D CD10                <1> 	int 10h		;;enter VESA mode
   104 0000011F C606[6C01]00        <1> 	mov byte [guinodo], 0
   105 00000124 6631C0              <1> 	xor eax, eax
   106 00000127 6631DB              <1> 	xor ebx, ebx
   107 0000012A 6631C9              <1> 	xor ecx, ecx
   108 0000012D 6631D2              <1> 	xor edx, edx
   109 00000130 6631F6              <1> 	xor esi, esi
   110 00000133 6631FF              <1> 	xor edi, edi	;;reset registers
   111 00000136 E93901              <1> 	jmp pmode
   112                              <1> guiload2:
   113 00000139 B9E001              <1> 	mov cx, 480
   114 0000013C BA8002              <1> 	mov dx, 640
   115 0000013F 8916[5237]          <1> 	mov [resolutionx], dx
   116 00000143 01D2                <1> 	add dx, dx
   117 00000145 8916[5437]          <1> 	mov [resolutionx2], dx
   118 00000149 890E[5037]          <1> 	mov [resolutiony], cx
   119 0000014D B81200              <1> 	mov ax, 12h
   120 00000150 BB0000              <1> 	mov bx, 0
   121 00000153 CD10                <1> 	int 10h
   122 00000155 C606[6C01]01        <1> 	mov byte [guinodo], 1
   123 0000015A 6631DB              <1> 	xor ebx, ebx
   124 0000015D 6631C9              <1> 	xor ecx, ecx
   125 00000160 6631D2              <1> 	xor edx, edx
   126 00000163 6631F6              <1> 	xor esi, esi
   127 00000166 6631FF              <1> 	xor edi, edi
   128 00000169 E90601              <1> 	jmp pmode
   129                              <1> ;;	jmp gui ;;test vesa
   130                              <1> 
   131 0000016C 00                  <1> guinodo db 0
   132                              <1> 
   133                              <1>     printrm:			; 'si' comes in with string address
   134 0000016D BB0700              <1> 	    mov bx,07		; write to display
   135 00000170 B40E                <1> 	    mov ah,0Eh		; screen function
   136 00000172 8A04                <1>     prs2:    mov al,[si]         ; get next character
   137 00000174 3C00                <1> 	    cmp al,0		; look for terminator 
   138 00000176 7405                <1>             je finpr2		; zero byte at end of string
   139 00000178 CD10                <1> 	    int 10h		; write character to screen.    
   140 0000017A 46                  <1>      	    inc si	     	; move to next character
   141 0000017B EBF5                <1> 	    jmp prs2		; loop
   142 0000017D C3                  <1>     finpr2: ret
   143                              <1> 
   144 0000017E 0000000000          <1> dcnm db 0,0,0,0,0
   145 00000183 0000                <1> dcnmend db 0,0
   146                              <1> 
   147                              <1> 
   148                              <1> decshow:
   149 00000185 BE[7E01]            <1> 	mov si, dcnm
   150                              <1> decclear:
   151 00000188 B030                <1> 	mov al, "0"
   152 0000018A 8804                <1> 	mov [si], al
   153 0000018C 46                  <1> 	inc si
   154 0000018D 81FE[8301]          <1> 	cmp si, dcnmend
   155 00000191 76F5                <1> 	jbe decclear
   156 00000193 4E                  <1> 	dec si
   157 00000194 E81500              <1> 	call convertrm
   158 00000197 BE[7E01]            <1> 	mov si, dcnm
   159                              <1> dectst:
   160 0000019A 8A04                <1> 	mov al, [si]
   161 0000019C 46                  <1> 	inc si
   162 0000019D 81FE[8301]          <1> 	cmp si, dcnmend
   163 000001A1 7704                <1> 	ja dectstend
   164 000001A3 3C30                <1> 	cmp al, "0"
   165 000001A5 76F3                <1> 	jbe dectst
   166                              <1> dectstend:
   167 000001A7 4E                  <1> 	dec si
   168 000001A8 E8C2FF              <1> 	call printrm
   169 000001AB C3                  <1> 	ret
   170                              <1> 	
   171                              <1> 	
   172                              <1> convertrm:
   173 000001AC 4E                  <1> 	dec si
   174 000001AD 89F3                <1> 	mov bx, si		;place to convert into must be in si, number to convert must be in cx
   175                              <1> cnvrtrm:
   176 000001AF 89DE                <1> 	mov si, bx
   177 000001B1 81EE0300            <1> 	sub si, 3
   178 000001B5 46                  <1> ten3rm:	inc si
   179 000001B6 81F9E803            <1> 	cmp cx, 1000
   180 000001BA 7208                <1> 	jb ten2rm
   181 000001BC 81E9E803            <1> 	sub cx, 1000
   182 000001C0 FE04                <1> 	inc byte [si]
   183 000001C2 EBEB                <1> 	jmp cnvrtrm
   184 000001C4 46                  <1> ten2rm:	inc si
   185 000001C5 81F96400            <1> 	cmp cx, 100
   186 000001C9 7208                <1> 	jb ten1rm
   187 000001CB 81E96400            <1> 	sub cx, 100
   188 000001CF FE04                <1> 	inc byte [si]
   189 000001D1 EBDC                <1> 	jmp cnvrtrm
   190 000001D3 46                  <1> ten1rm:	inc si
   191 000001D4 81F90A00            <1> 	cmp cx, 10
   192 000001D8 7208                <1> 	jb ten0rm
   193 000001DA 81E90A00            <1> 	sub cx, 10
   194 000001DE FE04                <1> 	inc byte [si]
   195 000001E0 EBCD                <1> 	jmp cnvrtrm
   196 000001E2 46                  <1> ten0rm:	inc si
   197 000001E3 81F90100            <1> 	cmp cx, 1
   198 000001E7 7208                <1> 	jb tendnrm
   199 000001E9 81E90100            <1> 	sub cx, 1
   200 000001ED FE04                <1> 	inc byte [si]
   201 000001EF EBBE                <1> 	jmp cnvrtrm
   202                              <1> tendnrm:
   203 000001F1 C3                  <1> 	ret
   204                              <1> 
   205                              <1> 
   206                              <1> 
   207                              <1> 
   208                              <1>     char: 		    ;char must be in al
   209 000001F2 BB0700              <1>            mov bx, 07
   210 000001F5 B40E                <1> 	   mov ah, 0Eh
   211 000001F7 CD10                <1> 	   int 10h
   212 000001F9 C3                  <1> 	    ret
   213                              <1> 
   214                              <1> 		shutdown:
   215 000001FA E84B00              <1> 			call realmode	
   216 000001FD B80053              <1> 			MOV AX, 5300h	; Shuts down APM-Machines.
   217 00000200 31DB                <1> 			XOR BX, BX	; Newer machines automatically
   218 00000202 CD15                <1> 			INT 15h		; shut down
   219 00000204 B80453              <1> 			MOV AX, 5304h
   220 00000207 31DB                <1> 			XOR BX, BX
   221 00000209 CD15                <1> 			INT 15h		; Interrupt 15h originally was
   222 0000020B B80153              <1> 			MOV AX, 5301h	; used for Cartridges (cassettes)
   223 0000020E 31DB                <1> 			XOR BX, BX	; but is still in use for
   224 00000210 CD15                <1> 			INT 15h		; diverse things
   225 00000212 B80753              <1> 			MOV AX, 5307h
   226 00000215 BB0100              <1> 			MOV BX, 1
   227 00000218 B90300              <1> 			MOV CX, 3
   228 0000021B CD15                <1> 			INT 15h
   229 0000021D CF                  <1> 			IRET
   230                              <1> 
   231                              <1> 	coldboot:
   232 0000021E E82700              <1> 			call realmode
   233 00000221 B84000              <1> 			MOV AX, 0040h
   234 00000224 8EC0                <1> 			MOV ES, AX
   235 00000226 26C70672000000      <1> 			MOV WORD [ES:00072h], 0h
   236 0000022D EA0000FFFF          <1> 			JMP 0FFFFh:0000h
   237 00000232 CF                  <1> 			IRET
   238                              <1> 
   239                              <1> 		warmboot:
   240 00000233 E81200              <1> 			call realmode
   241 00000236 B84000              <1> 			MOV AX, 0040h
   242 00000239 8EC0                <1> 			MOV ES, AX
   243 0000023B 26C70672003412      <1> 			MOV WORD [ES:00072h], 01234h
   244 00000242 EA0000FFFF          <1> 			JMP 0FFFFh:0000h
   245 00000247 CF                  <1> 			IRET
   246                              <1> 
   247                              <1> 
   248                              <1> realmode:
   249 00000248 0F20C0              <1>    mov eax, cr0
   250 0000024B 24FE                <1>    and al,0xFE     ; back to realmode
   251 0000024D 0F22C0              <1>    mov  cr0, eax   ; by toggling bit again
   252 00000250 FB                  <1>    sti
   253                              <1> 
   254 00000251 66B800000000        <1>    mov eax, 0
   255 00000257 C3                  <1>    ret
   256                              <1>    
   257 00000258 426F6F7420696E746F- <1> bootmsg:	db "Boot into the GUI?(y/n)",10,13,0
   258 00000261 20746865204755493F- <1>
   259 0000026A 28792F6E290A0D00    <1>
   260                                      %include 'source/pmode.asm'
   261                              <1> [BITS 16]
   262                              <1> ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
   263                              <1> ;	16-bit real mode
   264                              <1> ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
   265                              <1> 
   266                              <1> pmode:
   267 00000272 BA9200              <1> 	mov dx, 0x92
   268 00000275 EC                  <1> 	in al, dx	;;A20
   269 00000276 0C02                <1> 	or al, 2
   270 00000278 EE                  <1> 	out dx, al
   271 00000279 6631DB              <1> 	xor ebx,ebx
   272 0000027C 8CCB                <1> 	mov bx,cs		; EBX=segment
   273 0000027E 66C1E304            <1> 	shl ebx,4		;	<< 4
   274 00000282 67668D03            <1> 	lea eax,[ebx]		; EAX=linear address of segment base
   275 00000286 A3[4707]            <1> 	mov [gdt2 + 2],ax
   276 00000289 A3[4F07]            <1> 	mov [gdt3 + 2],ax
   277 0000028C 66C1E810            <1> 	shr eax,16
   278 00000290 A2[4907]            <1> 	mov [gdt2 + 4],al
   279 00000293 A2[5107]            <1> 	mov [gdt3 + 4],al
   280 00000296 8826[4C07]          <1> 	mov [gdt2 + 7],ah
   281 0000029A 8826[5407]          <1> 	mov [gdt3 + 7],ah
   282 0000029E 66B8[00000000]      <1> 	mov eax, stack
   283 000002A4 A3[5707]            <1> 	mov [gdts + 2],ax
   284 000002A7 66C1E810            <1> 	shr eax,16
   285 000002AB A2[5907]            <1> 	mov [gdts + 4],al
   286 000002AE 8826[5C07]          <1> 	mov [gdts + 7],ah
   287                              <1> ; fix up gdt and idt
   288 000002B2 67668D83[35070000]  <1> 	lea eax,[ebx + gdt]	; EAX=linear address of gdt
   289 000002BA 66A3[2B07]          <1> 	mov [gdtr + 2],eax
   290 000002BE 67668D83[62070000]  <1> 	lea eax,[ebx + idt]	; EAX=linear address of idt
   291 000002C6 66A3[3107]          <1> 	mov [idtr + 2],eax
   292 000002CA FA                  <1> 	cli
   293 000002CB 0F0116[2907]        <1> 	lgdt [gdtr]
   294 000002D0 0F011E[2F07]        <1> 	lidt [idtr]
   295 000002D5 66BB00000000        <1> 	mov ebx, 0
   296 000002DB 8CDB                <1> 	mov bx, ds
   297 000002DD 66891E[5C03]        <1> 	mov [basecache], ebx
   298 000002E2 0F20C0              <1> 	mov eax,cr0
   299 000002E5 0C01                <1> 	or al,1
   300 000002E7 0F22C0              <1> 	mov cr0,eax
   301 000002EA EA[EF02]1000        <1> 	jmp SYS_CODE_SEL:do_pm
   302                              <1> [BITS 32]
   303                              <1> do_pm:
   304 000002EF 66B81800            <1> 	mov ax, SYS_DATA_SEL
   305 000002F3 8ED8                <1> 	mov ds,ax
   306 000002F5 66B82000            <1> 	mov ax, STACK_SEL
   307 000002F9 8ED0                <1> 	mov ss, ax
   308 000002FB BC00100000          <1> 	mov esp, 4096
   309 00000300 90                  <1> 	nop
   310 00000301 90                  <1> 	nop
   311 00000302 66B81800            <1> 	mov ax, SYS_DATA_SEL
   312 00000306 8EC0                <1> 	mov es,ax
   313 00000308 8EE0                <1> 	mov fs,ax
   314 0000030A 8EE8                <1> 	mov gs,ax
   315 0000030C B800000000          <1> 	mov eax, 0
   316 00000311 BE[00000000]        <1> 	mov esi, bssstart
   317                              <1> clearkernelbuffers:
   318 00000316 8906                <1> 	mov [esi], eax
   319 00000318 81C604000000        <1> 	add esi, 4
   320 0000031E 81FE[21500000]      <1> 	cmp esi, bssend
   321 00000324 72F0                <1> 	jb clearkernelbuffers
   322                              <1> user1:
   323 00000326 8B3D[2B4F0000]      <1> 	mov edi, [physbaseptr]
   324 0000032C A1[5C030000]        <1> 	mov eax, [basecache]
   325 00000331 C1E004              <1> 	shl eax, 4
   326 00000334 29C7                <1> 	sub edi, eax
   327 00000336 893D[2B4F0000]      <1> 	mov [physbaseptr], edi
   328 0000033C E892100000          <1> 	call indexfiles
   329 00000341 803D[6C010000]00    <1> 	cmp byte [guinodo], 0
   330 00000348 0F8405000000        <1> 	je near guido
   331 0000034E E9D8090000          <1> 	jmp os
   332                              <1> 	
   333                              <1> guido:
   334 00000353 E981240000          <1> 	jmp gui
   335                              <1> 	
   336 00000358 00000000            <1> user2codepoint dw 0,0
   337 0000035C 00000000            <1> basecache dd 0
   338                              <1> 
   339                              <1> unhand:	
   340                              <1> 	%assign i 0
   341                              <1> 	%rep 40
   342                              <1> 	cli
   343                              <1> 	mov byte [intprob], i
   344                              <1> 	jmp unhand2
   345                              <1> 	%assign i i+1
   346                              <1> 	%endrep
   347 00000360 FA                  <2>  cli
   348 00000361 C605[65060000]00    <2>  mov byte [intprob], i
   349 00000368 E9FB010000          <2>  jmp unhand2
   350                              <2>  %assign i i+1
   351 0000036D FA                  <2>  cli
   352 0000036E C605[65060000]01    <2>  mov byte [intprob], i
   353 00000375 E9EE010000          <2>  jmp unhand2
   354                              <2>  %assign i i+1
   355 0000037A FA                  <2>  cli
   356 0000037B C605[65060000]02    <2>  mov byte [intprob], i
   357 00000382 E9E1010000          <2>  jmp unhand2
   358                              <2>  %assign i i+1
   359 00000387 FA                  <2>  cli
   360 00000388 C605[65060000]03    <2>  mov byte [intprob], i
   361 0000038F E9D4010000          <2>  jmp unhand2
   362                              <2>  %assign i i+1
   363 00000394 FA                  <2>  cli
   364 00000395 C605[65060000]04    <2>  mov byte [intprob], i
   365 0000039C E9C7010000          <2>  jmp unhand2
   366                              <2>  %assign i i+1
   367 000003A1 FA                  <2>  cli
   368 000003A2 C605[65060000]05    <2>  mov byte [intprob], i
   369 000003A9 E9BA010000          <2>  jmp unhand2
   370                              <2>  %assign i i+1
   371 000003AE FA                  <2>  cli
   372 000003AF C605[65060000]06    <2>  mov byte [intprob], i
   373 000003B6 E9AD010000          <2>  jmp unhand2
   374                              <2>  %assign i i+1
   375 000003BB FA                  <2>  cli
   376 000003BC C605[65060000]07    <2>  mov byte [intprob], i
   377 000003C3 E9A0010000          <2>  jmp unhand2
   378                              <2>  %assign i i+1
   379 000003C8 FA                  <2>  cli
   380 000003C9 C605[65060000]08    <2>  mov byte [intprob], i
   381 000003D0 E993010000          <2>  jmp unhand2
   382                              <2>  %assign i i+1
   383 000003D5 FA                  <2>  cli
   384 000003D6 C605[65060000]09    <2>  mov byte [intprob], i
   385 000003DD E986010000          <2>  jmp unhand2
   386                              <2>  %assign i i+1
   387 000003E2 FA                  <2>  cli
   388 000003E3 C605[65060000]0A    <2>  mov byte [intprob], i
   389 000003EA E979010000          <2>  jmp unhand2
   390                              <2>  %assign i i+1
   391 000003EF FA                  <2>  cli
   392 000003F0 C605[65060000]0B    <2>  mov byte [intprob], i
   393 000003F7 E96C010000          <2>  jmp unhand2
   394                              <2>  %assign i i+1
   395 000003FC FA                  <2>  cli
   396 000003FD C605[65060000]0C    <2>  mov byte [intprob], i
   397 00000404 E95F010000          <2>  jmp unhand2
   398                              <2>  %assign i i+1
   399 00000409 FA                  <2>  cli
   400 0000040A C605[65060000]0D    <2>  mov byte [intprob], i
   401 00000411 E952010000          <2>  jmp unhand2
   402                              <2>  %assign i i+1
   403 00000416 FA                  <2>  cli
   404 00000417 C605[65060000]0E    <2>  mov byte [intprob], i
   405 0000041E E945010000          <2>  jmp unhand2
   406                              <2>  %assign i i+1
   407 00000423 FA                  <2>  cli
   408 00000424 C605[65060000]0F    <2>  mov byte [intprob], i
   409 0000042B E938010000          <2>  jmp unhand2
   410                              <2>  %assign i i+1
   411 00000430 FA                  <2>  cli
   412 00000431 C605[65060000]10    <2>  mov byte [intprob], i
   413 00000438 E92B010000          <2>  jmp unhand2
   414                              <2>  %assign i i+1
   415 0000043D FA                  <2>  cli
   416 0000043E C605[65060000]11    <2>  mov byte [intprob], i
   417 00000445 E91E010000          <2>  jmp unhand2
   418                              <2>  %assign i i+1
   419 0000044A FA                  <2>  cli
   420 0000044B C605[65060000]12    <2>  mov byte [intprob], i
   421 00000452 E911010000          <2>  jmp unhand2
   422                              <2>  %assign i i+1
   423 00000457 FA                  <2>  cli
   424 00000458 C605[65060000]13    <2>  mov byte [intprob], i
   425 0000045F E904010000          <2>  jmp unhand2
   426                              <2>  %assign i i+1
   427 00000464 FA                  <2>  cli
   428 00000465 C605[65060000]14    <2>  mov byte [intprob], i
   429 0000046C E9F7000000          <2>  jmp unhand2
   430                              <2>  %assign i i+1
   431 00000471 FA                  <2>  cli
   432 00000472 C605[65060000]15    <2>  mov byte [intprob], i
   433 00000479 E9EA000000          <2>  jmp unhand2
   434                              <2>  %assign i i+1
   435 0000047E FA                  <2>  cli
   436 0000047F C605[65060000]16    <2>  mov byte [intprob], i
   437 00000486 E9DD000000          <2>  jmp unhand2
   438                              <2>  %assign i i+1
   439 0000048B FA                  <2>  cli
   440 0000048C C605[65060000]17    <2>  mov byte [intprob], i
   441 00000493 E9D0000000          <2>  jmp unhand2
   442                              <2>  %assign i i+1
   443 00000498 FA                  <2>  cli
   444 00000499 C605[65060000]18    <2>  mov byte [intprob], i
   445 000004A0 E9C3000000          <2>  jmp unhand2
   446                              <2>  %assign i i+1
   447 000004A5 FA                  <2>  cli
   448 000004A6 C605[65060000]19    <2>  mov byte [intprob], i
   449 000004AD E9B6000000          <2>  jmp unhand2
   450                              <2>  %assign i i+1
   451 000004B2 FA                  <2>  cli
   452 000004B3 C605[65060000]1A    <2>  mov byte [intprob], i
   453 000004BA E9A9000000          <2>  jmp unhand2
   454                              <2>  %assign i i+1
   455 000004BF FA                  <2>  cli
   456 000004C0 C605[65060000]1B    <2>  mov byte [intprob], i
   457 000004C7 E99C000000          <2>  jmp unhand2
   458                              <2>  %assign i i+1
   459 000004CC FA                  <2>  cli
   460 000004CD C605[65060000]1C    <2>  mov byte [intprob], i
   461 000004D4 E98F000000          <2>  jmp unhand2
   462                              <2>  %assign i i+1
   463 000004D9 FA                  <2>  cli
   464 000004DA C605[65060000]1D    <2>  mov byte [intprob], i
   465 000004E1 E982000000          <2>  jmp unhand2
   466                              <2>  %assign i i+1
   467 000004E6 FA                  <2>  cli
   468 000004E7 C605[65060000]1E    <2>  mov byte [intprob], i
   469 000004EE E975000000          <2>  jmp unhand2
   470                              <2>  %assign i i+1
   471 000004F3 FA                  <2>  cli
   472 000004F4 C605[65060000]1F    <2>  mov byte [intprob], i
   473 000004FB E968000000          <2>  jmp unhand2
   474                              <2>  %assign i i+1
   475 00000500 FA                  <2>  cli
   476 00000501 C605[65060000]20    <2>  mov byte [intprob], i
   477 00000508 E95B000000          <2>  jmp unhand2
   478                              <2>  %assign i i+1
   479 0000050D FA                  <2>  cli
   480 0000050E C605[65060000]21    <2>  mov byte [intprob], i
   481 00000515 E94E000000          <2>  jmp unhand2
   482                              <2>  %assign i i+1
   483 0000051A FA                  <2>  cli
   484 0000051B C605[65060000]22    <2>  mov byte [intprob], i
   485 00000522 E941000000          <2>  jmp unhand2
   486                              <2>  %assign i i+1
   487 00000527 FA                  <2>  cli
   488 00000528 C605[65060000]23    <2>  mov byte [intprob], i
   489 0000052F E934000000          <2>  jmp unhand2
   490                              <2>  %assign i i+1
   491 00000534 FA                  <2>  cli
   492 00000535 C605[65060000]24    <2>  mov byte [intprob], i
   493 0000053C E927000000          <2>  jmp unhand2
   494                              <2>  %assign i i+1
   495 00000541 FA                  <2>  cli
   496 00000542 C605[65060000]25    <2>  mov byte [intprob], i
   497 00000549 E91A000000          <2>  jmp unhand2
   498                              <2>  %assign i i+1
   499 0000054E FA                  <2>  cli
   500 0000054F C605[65060000]26    <2>  mov byte [intprob], i
   501 00000556 E90D000000          <2>  jmp unhand2
   502                              <2>  %assign i i+1
   503 0000055B FA                  <2>  cli
   504 0000055C C605[65060000]27    <2>  mov byte [intprob], i
   505 00000563 E900000000          <2>  jmp unhand2
   506                              <2>  %assign i i+1
   507                              <1> unhand2:
   508 00000568 60                  <1> 	pushad
   509 00000569 C705[58030000]0000- <1> 	mov dword [user2codepoint], 0
   510 00000571 0000                <1>
   511 00000573 89E6                <1> 	mov esi, esp
   512 00000575 81C628000000        <1> 	add esi, ((unhndrgend - unhndrg)/13)*4
   513 0000057B 8935[5B060000]      <1> 	mov [esploc], esi
   514 00000581 BE[66060000]        <1> 	mov esi, unhandmsg
   515 00000586 8935[5F060000]      <1> 	mov [esiloc], esi
   516 0000058C B900000000          <1> 	mov ecx, 0
   517 00000591 8A0D[65060000]      <1> 	mov cl, [intprob]
   518 00000597 E85A000000          <1> 	call expdump
   519                              <1> dumpstack:
   520 0000059C 8B35[5B060000]      <1> 	mov esi, [esploc]
   521 000005A2 39E6                <1> 	cmp esi, esp
   522 000005A4 7216                <1> 	jb donedump
   523 000005A6 368B0E              <1> 	mov ecx, [ss:esi]
   524 000005A9 81EE04000000        <1> 	sub esi, 4
   525 000005AF 8935[5B060000]      <1> 	mov [esploc], esi
   526 000005B5 E83C000000          <1> 	call expdump
   527 000005BA EBE0                <1> 	jmp dumpstack
   528                              <1> donedump:
   529 000005BC 8B35[5B060000]      <1> 	mov esi, [esploc]
   530 000005C2 368B7C2420          <1> 	mov edi, [ss:esp + 32]
   531 000005C7 8B4FFC              <1> 	mov ecx, [edi - 4]
   532 000005CA E827000000          <1> 	call expdump
   533 000005CF 8B35[5B060000]      <1> 	mov esi, [esploc]
   534 000005D5 368B7C2420          <1> 	mov edi, [ss:esp + 32]
   535 000005DA 8B0F                <1> 	mov ecx, [edi]
   536 000005DC E815000000          <1> 	call expdump
   537 000005E1 8B35[5B060000]      <1> 	mov esi, [esploc]
   538 000005E7 368B7C2420          <1> 	mov edi, [ss:esp + 32]
   539 000005EC 8B4F04              <1> 	mov ecx, [edi + 4]
   540 000005EF E802000000          <1> 	call expdump
   541 000005F4 EBFE                <1> 	jmp $
   542                              <1> expdump:
   543 000005F6 8B35[5F060000]      <1> 	mov esi, [esiloc]
   544 000005FC 89F7                <1> 	mov edi, esi
   545 000005FE 81C70D000000        <1> 	add edi, 13
   546 00000604 81C604000000        <1> 	add esi, 4
   547 0000060A 893D[5F060000]      <1> 	mov [esiloc], edi
   548 00000610 4F                  <1> 	dec edi
   549 00000611 E86D0B0000          <1> 	call converthex
   550 00000616 81EE04000000        <1> 	sub esi, 4
   551 0000061C 803D[33290000]00    <1> 	cmp byte [guion], 0
   552 00000623 0F8422000000        <1> 	je near expdumptext
   553 00000629 668B0D[63060000]    <1> 	mov cx, [locunhand]
   554 00000630 668105[63060000]10- <1> 	add word [locunhand], 16
   555 00000638 00                  <1>
   556 00000639 66BA0200            <1> 	mov dx, 2
   557 0000063D 66B80100            <1> 	mov ax, 1
   558 00000641 66BB0000            <1> 	mov bx, 0
   559 00000645 E8AE2C0000          <1> 	call showstring
   560 0000064A C3                  <1> 	ret
   561                              <1> expdumptext:
   562 0000064B E815050000          <1> 	call print
   563 00000650 BE[C0440000]        <1> 	mov esi, line
   564 00000655 E80B050000          <1> 	call print
   565 0000065A C3                  <1> 	ret
   566 0000065B 00000000            <1> esploc dd 0
   567 0000065F 00000000            <1> esiloc dd 0
   568 00000663 0100                <1> locunhand dw 1
   569 00000665 00                  <1> intprob db 0
   570                              <1> 	unhandmsg:	
   571 00000666 494E54203030303030- <1> 			db "INT 00000000",0
   572 0000066F 30303000            <1>
   573                              <1> unhndrg:
   574 00000673 45464C3D3030303030- <1> 			db "EFL=00000000",0
   575 0000067C 30303000            <1>
   576 00000680 43533A3D3030303030- <1> 			db "CS:=00000000",0
   577 00000689 30303000            <1>
   578 0000068D 4549503D3030303030- <1> 			db "EIP=00000000",0
   579 00000696 30303000            <1>
   580 0000069A 4541583D3030303030- <1> 			db "EAX=00000000",0
   581 000006A3 30303000            <1>
   582 000006A7 4543583D3030303030- <1> 			db "ECX=00000000",0
   583 000006B0 30303000            <1>
   584 000006B4 4544583D3030303030- <1> 			db "EDX=00000000",0
   585 000006BD 30303000            <1>
   586 000006C1 4542583D3030303030- <1> 			db "EBX=00000000",0
   587 000006CA 30303000            <1>
   588 000006CE 4553503D3030303030- <1> 			db "ESP=00000000",0
   589 000006D7 30303000            <1>
   590 000006DB 4542503D3030303030- <1> 			db "EBP=00000000",0
   591 000006E4 30303000            <1>
   592 000006E8 4553493D3030303030- <1> 			db "ESI=00000000",0
   593 000006F1 30303000            <1>
   594 000006F5 4544493D3030303030- <1> unhndrgend:	db "EDI=00000000",0
   595 000006FE 30303000            <1>
   596 00000702 434D443D3030303030- <1> 			db "CMD=00000000",0
   597 0000070B 30303000            <1>
   598 0000070F 434D443D3030303030- <1> 			db "CMD=00000000",0
   599 00000718 30303000            <1>
   600 0000071C 434D443D3030303030- <1> 			db "CMD=00000000",0
   601 00000725 30303000            <1>
   602                              <1> unhandmsgend:
   603                              <1> 
   604                              <1> [BITS 16]
   605                              <1> 
   606                              <1> ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
   607                              <1> ;	16-bit limit/32-bit linear base address of GDT and IDT
   608                              <1> ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
   609 00000729 2700                <1> gdtr:	dw gdt_end - gdt - 1	; GDT limit
   610 0000072B [35070000]          <1> 	dd gdt			; linear, physical address of GDT
   611                              <1> 
   612 0000072F 8701                <1> idtr:	dw idt_end - idt - 1	; IDT limit
   613 00000731 [62070000]          <1> 	dd idt			; linear, physical address of IDT
   614                              <1> 
   615                              <1> 
   616 00000735 0000                <1> gdt:	dw 0			; limit 15:0
   617 00000737 0000                <1> 	dw 0			; base 15:0
   618 00000739 00                  <1> 	db 0			; base 23:16
   619 0000073A 00                  <1> 	db 0			; type
   620 0000073B 00                  <1> 	db 0			; limit 19:16, flags
   621 0000073C 00                  <1> 	db 0			; base 31:24
   622                              <1> ; linear data segment descriptor
   623                              <1> LINEAR_SEL	equ	$-gdt
   624 0000073D FFFF                <1> 	dw 0xFFFF		; limit 0xFFFFF
   625 0000073F 0000                <1> 	dw 0			; base for this one is always 0
   626 00000741 00                  <1> 	db 0
   627 00000742 92                  <1> 	db 0x92			; present, ring 0, data, expand-up, writable
   628 00000743 CF                  <1> 	db 0xCF			; page-granular, 32-bit
   629 00000744 00                  <1> 	db 0
   630                              <1> ; code segment descriptor
   631                              <1> SYS_CODE_SEL	equ	$-gdt
   632 00000745 FFFF                <1> gdt2:	dw 0xFFFF
   633 00000747 0000                <1> 	dw 0			; (base gets set above)
   634 00000749 00                  <1> 	db 0
   635 0000074A 9A                  <1> 	db 0x9A			; present, ring 0, code, non-conforming, readable
   636 0000074B CF                  <1> 	db 0xCF
   637 0000074C 00                  <1> 	db 0
   638                              <1> ; data segment descriptor
   639                              <1> SYS_DATA_SEL	equ	$-gdt
   640 0000074D FFFF                <1> gdt3:	dw 0xFFFF
   641 0000074F 0000                <1> 	dw 0			; (base gets set above)
   642 00000751 00                  <1> 	db 0
   643 00000752 92                  <1> 	db 0x92			; present, ring 0, data, expand-up, writable
   644 00000753 CF                  <1> 	db 0xCF
   645 00000754 00                  <1> 	db 0
   646                              <1> STACK_SEL	equ	$-gdt
   647 00000755 0100                <1> gdts:	dw 1
   648 00000757 0000                <1> 	dw 0			; (base gets set above)
   649 00000759 00                  <1> 	db 0
   650 0000075A 92                  <1> 	db 0x92			; present, ring 0, data, expand-up, writable
   651 0000075B C0                  <1> 	db 0xC0
   652 0000075C 00                  <1> 	db 0
   653                              <1> gdt_end:
   654                              <1> ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
   655                              <1> ;	interrupt descriptor table (IDT)
   656                              <1> ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
   657                              <1> ; 32 reserved interrupts:
   658 0000075D 494454              <1> db "IDT"
   659 00000760 [6003]              <1> dw unhand
   660                              <1> idt:	
   661                              <1> %assign i 0
   662                              <1> %rep    48
   663                              <1>         dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   664                              <1> %assign i i+1 
   665                              <1> %endrep
   666 00000762 [6003]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   667                              <2> %assign i i+1
   668 0000076A [6D03]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   669                              <2> %assign i i+1
   670 00000772 [7A03]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   671                              <2> %assign i i+1
   672 0000077A [8703]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   673                              <2> %assign i i+1
   674 00000782 [9403]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   675                              <2> %assign i i+1
   676 0000078A [A103]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   677                              <2> %assign i i+1
   678 00000792 [AE03]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   679                              <2> %assign i i+1
   680 0000079A [BB03]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   681                              <2> %assign i i+1
   682 000007A2 [C803]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   683                              <2> %assign i i+1
   684 000007AA [D503]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   685                              <2> %assign i i+1
   686 000007B2 [E203]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   687                              <2> %assign i i+1
   688 000007BA [EF03]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   689                              <2> %assign i i+1
   690 000007C2 [FC03]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   691                              <2> %assign i i+1
   692 000007CA [0904]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   693                              <2> %assign i i+1
   694 000007D2 [1604]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   695                              <2> %assign i i+1
   696 000007DA [2304]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   697                              <2> %assign i i+1
   698 000007E2 [3004]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   699                              <2> %assign i i+1
   700 000007EA [3D04]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   701                              <2> %assign i i+1
   702 000007F2 [4A04]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   703                              <2> %assign i i+1
   704 000007FA [5704]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   705                              <2> %assign i i+1
   706 00000802 [6404]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   707                              <2> %assign i i+1
   708 0000080A [7104]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   709                              <2> %assign i i+1
   710 00000812 [7E04]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   711                              <2> %assign i i+1
   712 0000081A [8B04]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   713                              <2> %assign i i+1
   714 00000822 [9804]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   715                              <2> %assign i i+1
   716 0000082A [A504]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   717                              <2> %assign i i+1
   718 00000832 [B204]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   719                              <2> %assign i i+1
   720 0000083A [BF04]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   721                              <2> %assign i i+1
   722 00000842 [CC04]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   723                              <2> %assign i i+1
   724 0000084A [D904]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   725                              <2> %assign i i+1
   726 00000852 [E604]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   727                              <2> %assign i i+1
   728 0000085A [F304]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   729                              <2> %assign i i+1
   730 00000862 [0005]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   731                              <2> %assign i i+1
   732 0000086A [0D05]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   733                              <2> %assign i i+1
   734 00000872 [1A05]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   735                              <2> %assign i i+1
   736 0000087A [2705]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   737                              <2> %assign i i+1
   738 00000882 [3405]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   739                              <2> %assign i i+1
   740 0000088A [4105]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   741                              <2> %assign i i+1
   742 00000892 [4E05]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   743                              <2> %assign i i+1
   744 0000089A [5B05]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   745                              <2> %assign i i+1
   746 000008A2 [6805]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   747                              <2> %assign i i+1
   748 000008AA [7505]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   749                              <2> %assign i i+1
   750 000008B2 [8205]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   751                              <2> %assign i i+1
   752 000008BA [8F05]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   753                              <2> %assign i i+1
   754 000008C2 [9C05]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   755                              <2> %assign i i+1
   756 000008CA [A905]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   757                              <2> %assign i i+1
   758 000008D2 [B605]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   759                              <2> %assign i i+1
   760 000008DA [C305]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   761                              <2> %assign i i+1
   762                              <1> ;;INT 30h for os use and 3rd party use:
   763 000008E2 [EA08]1000008E0000  <1> 	dw newints,SYS_CODE_SEL,0x8E00,0
   764                              <1> idt_end:
   765                              <1> [BITS 32]
   766                                  [BITS 32]
   767                                      %include 'source/ints.asm'
   768                              <1> newints:	;;for great justice
   769 000008EA 80FC00              <1> 	cmp ah, 0		;;originally 0
   770 000008ED 0F8452000000        <1> 	je near intx0   ;;0=kills app
   771 000008F3 80FC01              <1> 	cmp ah, 1		;;originally 1
   772 000008F6 0F844E000000        <1> 	je near intx1   ;;3=print string
   773 000008FC 80FC02              <1> 	cmp ah, 2		;;originally 2
   774 000008FF 0F844B000000        <1> 	je near intx2	;;4=read string
   775 00000905 80FC03              <1> 	cmp ah, 3		;;originally 3
   776 00000908 0F8448000000        <1> 	je near intx3	;;6=clear screen
   777 0000090E 80FC04              <1> 	cmp ah, 4		;;originally 4
   778 00000911 0F8445000000        <1> 	je near intx4	;;5=read and print string
   779 00000917 80FC05              <1> 	cmp ah, 5		;;originally 5		
   780 0000091A 0F8442000000        <1> 	je near intx5	;;2=get char
   781 00000920 80FC06              <1> 	cmp ah, 6		;;originally 6
   782 00000923 0F843F000000        <1> 	je near intx6	;;1=print char
   783 00000929 80FC07              <1> 	cmp ah, 7
   784 0000092C 0F843C000000        <1> 	je near intx7	;;read file
   785 00000932 80FC09              <1> 	cmp ah, 9
   786 00000935 0F8439000000        <1> 	je near intx9	;;convert number
   787 0000093B 80FC0A              <1> 	cmp ah, 10
   788 0000093E 0F8440000000        <1> 	je near intx10	;;create thread
   789 00000944 C3                  <1> 	ret
   790                              <1> 	
   791                              <1> intx0:
   792 00000945 E9F3040000          <1> 	jmp nwcmd
   793                              <1> intx1:
   794 0000094A E81E020000          <1> 	call int303
   795 0000094F C3                  <1> 	ret
   796                              <1> intx2:
   797 00000950 E835020000          <1> 	call int304
   798 00000955 C3                  <1> 	ret
   799                              <1> intx3:
   800 00000956 E8B9020000          <1> 	call int306
   801 0000095B C3                  <1> 	ret
   802                              <1> intx4:
   803 0000095C E850020000          <1> 	call int305
   804 00000961 C3                  <1> 	ret
   805                              <1> intx5:
   806 00000962 E8CE010000          <1> 	call int302
   807 00000967 C3                  <1> 	ret
   808                              <1> intx6:
   809 00000968 E822000000          <1> 	call int301
   810 0000096D C3                  <1> 	ret
   811                              <1> intx7:
   812 0000096E E8E2380000          <1> 	call loadfile
   813 00000973 C3                  <1> 	ret
   814                              <1> intx9:
   815 00000974 3C00                <1> 	cmp al, 0
   816 00000976 7506                <1> 	jne intx9B
   817 00000978 E831090000          <1> 	call showdec
   818 0000097D C3                  <1> 	ret
   819                              <1> intx9B:
   820 0000097E E895080000          <1> 	call showhex
   821 00000983 C3                  <1> 	ret
   822                              <1> intx10:
   823                              <1> ;	call thread
   824 00000984 C3                  <1> 	ret
   825                              <1> 	
   826 00000985 0000                <1> linebeginpos dw 0
   827 00000987 0000                <1> videobufpos: dw 0
   828 00000989 0000                <1> charpos db 0,0
   829 0000098B A01E                <1> charxy db 160,30
   830 0000098D 0000                <1> charbuf dw 0
   831                              <1> 
   832                              <1> int301:	;;print char, char in al, modifier in bl, will run videobuf2copy if called as is
   833 0000098F E807000000          <1> 	call int301prnt
   834 00000994 E9C1020000          <1> 	jmp termcopy
   835 00000999 00                  <1> termguion db 0
   836 0000099A 00                  <1> termcopyon db 0
   837                              <1> int301prnt:
   838 0000099B 88DC                <1> 	mov ah, bl
   839 0000099D 66A3[8D090000]      <1> 	mov [charbuf], ax
   840 000009A3 BB00000000          <1> 	mov ebx, 0
   841 000009A8 668B1D[87090000]    <1> 	mov bx, [videobufpos]
   842 000009AF BF[851C0000]        <1> 	mov edi, videobuf2
   843 000009B4 01DF                <1> 	add edi, ebx
   844 000009B6 66A1[580C0000]      <1> 	mov ax, [removedvideo]
   845 000009BC 668907              <1> 	mov [edi], ax
   846 000009BF 66A1[8D090000]      <1> 	mov ax, [charbuf]
   847 000009C5 BA00000000          <1> 	mov edx, 0
   848 000009CA 668B15[89090000]    <1> 	mov dx, [charpos]
   849 000009D1 B900000000          <1> 	mov ecx, 0
   850 000009D6 668B0D[8B090000]    <1> 	mov cx, [charxy]
   851 000009DD 3C0D                <1> 	cmp al, 13
   852 000009DF 0F8454000000        <1> 	je near int301cr
   853 000009E5 3C0A                <1> 	cmp al, 10
   854 000009E7 0F8482000000        <1> 	je near int301nl
   855 000009ED 3C08                <1> 	cmp al, 8
   856 000009EF 0F845B000000        <1> 	je near int301bs
   857 000009F5 668907              <1> 	mov [edi], ax
   858 000009F8 81C702000000        <1> 	add edi, 2
   859 000009FE 80C202              <1> 	add dl, 2
   860                              <1> donecrnl:
   861 00000A01 38CA                <1> 	cmp dl, cl
   862 00000A03 0F8397000000        <1> 	jae near int301eol
   863                              <1> doneeol:
   864 00000A09 38EE                <1> 	cmp dh, ch
   865 00000A0B 0F83AD000000        <1> 	jae near int301scr	
   866                              <1> donescr:
   867 00000A11 89FB                <1> 	mov ebx, edi
   868 00000A13 668B07              <1> 	mov ax, [edi]
   869 00000A16 66A3[580C0000]      <1> 	mov [removedvideo], ax
   870 00000A1C 81EB[851C0000]      <1> 	sub ebx, videobuf2
   871 00000A22 66891D[87090000]    <1> 	mov [videobufpos], bx
   872 00000A29 668915[89090000]    <1> 	mov [charpos], dx
   873 00000A30 66A1[8D090000]      <1> 	mov ax, [charbuf]
   874 00000A36 88E3                <1> 	mov bl, ah
   875 00000A38 C3                  <1> 	ret
   876                              <1> 	
   877                              <1> 	int301cr:
   878 00000A39 B200                <1> 		mov dl, 0
   879 00000A3B BB00000000          <1> 		mov ebx, 0
   880 00000A40 BF[851C0000]        <1> 		mov edi, videobuf2
   881 00000A45 668B1D[85090000]    <1> 		mov bx, [linebeginpos]
   882 00000A4C 01DF                <1> 		add edi, ebx
   883 00000A4E EBB1                <1> 		jmp donecrnl
   884                              <1> 			
   885                              <1> 	int301bs:
   886 00000A50 80FA00              <1> 		cmp dl, 0
   887 00000A53 740F                <1> 		je int301backline
   888                              <1> 	int301nobmr:
   889 00000A55 80EA02              <1> 		sub dl, 2
   890 00000A58 66B80000            <1> 		mov ax, 0
   891 00000A5C 81EF02000000        <1> 		sub edi, 2
   892 00000A62 EB9D                <1> 		jmp donecrnl
   893                              <1> 	int301backline:
   894 00000A64 88CA                <1> 		mov dl, cl
   895 00000A66 80FE00              <1> 		cmp dh, 0
   896 00000A69 74EA                <1> 		je int301nobmr
   897 00000A6B FECE                <1> 		dec dh
   898 00000A6D EBE6                <1> 		jmp int301nobmr
   899                              <1> 		
   900                              <1> 	int301nl:
   901 00000A6F FEC6                <1> 		inc dh
   902 00000A71 BB00000000          <1> 		mov ebx, 0
   903 00000A76 88CB                <1> 		mov bl, cl
   904 00000A78 BF[851C0000]        <1> 		mov edi, videobuf2
   905 00000A7D 66031D[87090000]    <1> 		add bx, [videobufpos]
   906 00000A84 01DF                <1> 		add edi, ebx
   907 00000A86 BB00000000          <1> 		mov ebx, 0
   908 00000A8B 88CB                <1> 		mov bl, cl
   909 00000A8D 66031D[85090000]    <1> 		add bx, [linebeginpos]
   910 00000A94 66891D[85090000]    <1> 		mov [linebeginpos], bx
   911 00000A9B E961FFFFFF          <1> 		jmp donecrnl
   912                              <1> 		
   913                              <1> 	int301eol:
   914 00000AA0 B200                <1> 		mov dl, 0
   915 00000AA2 FEC6                <1> 		inc dh
   916 00000AA4 BB00000000          <1> 		mov ebx, 0
   917 00000AA9 88CB                <1> 		mov bl, cl
   918 00000AAB 66031D[85090000]    <1> 		add bx, [linebeginpos]
   919 00000AB2 66891D[85090000]    <1> 		mov [linebeginpos], bx
   920 00000AB9 E94BFFFFFF          <1> 		jmp doneeol
   921                              <1> 		
   922                              <1> 	int301scr:
   923 00000ABE FECE                <1> 		dec dh
   924 00000AC0 BF[851C0000]        <1> 		mov edi, videobuf2
   925 00000AC5 BB00000000          <1> 		mov ebx, 0
   926 00000ACA 88CB                <1> 		mov bl, cl
   927 00000ACC 01FB                <1> 		add ebx, edi
   928                              <1> 	intscrollloop:
   929 00000ACE 668B03              <1> 		mov ax, [ebx]
   930 00000AD1 668907              <1> 		mov [edi], ax
   931 00000AD4 81C702000000        <1> 		add edi, 2
   932 00000ADA 81C302000000        <1> 		add ebx, 2
   933 00000AE0 80E902              <1> 		sub cl, 2
   934 00000AE3 80F900              <1> 		cmp cl, 0
   935 00000AE6 75E6                <1> 		jne intscrollloop
   936 00000AE8 8A0D[8B090000]      <1> 		mov cl, [charxy]
   937 00000AEE FECD                <1> 		dec ch
   938 00000AF0 80FD01              <1> 		cmp ch, 1
   939 00000AF3 77D9                <1> 		ja intscrollloop
   940 00000AF5 66B80000            <1> 		mov ax, 0
   941 00000AF9 81EF[851C0000]      <1> 		sub edi, videobuf2
   942 00000AFF 66893D[85090000]    <1> 		mov [linebeginpos], di
   943 00000B06 81C7[851C0000]      <1> 		add edi, videobuf2
   944 00000B0C 89FB                <1> 		mov ebx, edi
   945                              <1> 	intloopclear:
   946 00000B0E 668903              <1> 		mov [ebx], ax
   947 00000B11 81C302000000        <1> 		add ebx, 2
   948 00000B17 80E902              <1> 		sub cl, 2
   949 00000B1A 80F900              <1> 		cmp cl, 0
   950 00000B1D 75EF                <1> 		jne intloopclear
   951 00000B1F FECD                <1> 		dec ch
   952 00000B21 80FD00              <1> 		cmp ch, 0
   953 00000B24 75E8                <1> 		jne intloopclear
   954 00000B26 668B0D[8B090000]    <1> 		mov cx, [charxy]
   955 00000B2D E9DFFEFFFF          <1> 		jmp donescr
   956                              <1> 		
   957                              <1> 		
   958 00000B32 0000                <1> lastkey db 0,0
   959 00000B34 00                  <1> trans db 0
   960                              <1> 
   961                              <1> 	int302:		;;get char, if al is 0, wait for key
   962 00000B35 A2[340B0000]        <1> 		mov [trans], al
   963                              <1> 	transcheck:
   964 00000B3A E8B5180000          <1> 		call guistartin
   965 00000B3F 8A3D[340B0000]      <1> 		mov bh, [trans]
   966 00000B45 66A1[320B0000]      <1> 		mov ax, [lastkey]
   967 00000B4B 80FC1C              <1> 		cmp ah, 1Ch
   968 00000B4E 740C                <1> 		je int302enter
   969 00000B50 08C7                <1> 		or bh, al
   970 00000B52 80FF00              <1> 		cmp bh, 0
   971 00000B55 74E3                <1> 		je transcheck
   972 00000B57 E907000000          <1> 		jmp int302end
   973                              <1> 	int302enter:
   974 00000B5C B00D                <1> 		mov al, 13
   975 00000B5E E900000000          <1> 		jmp int302end
   976                              <1> 	int302end:
   977 00000B63 C3                  <1> 		ret
   978                              <1> 	
   979 00000B64 00                  <1> endkey303 db 0
   980                              <1>     print:
   981 00000B65 66B80000            <1> 		mov ax, 0
   982 00000B69 66BB0700            <1> 		mov bx, 7
   983                              <1> 	int303:	;;print line, al=last key,bl=modifier, esi=buffer
   984 00000B6D A2[640B0000]        <1> 		mov [endkey303], al
   985                              <1> 	int303b:
   986 00000B72 8A06                <1> 		mov al, [esi]
   987 00000B74 3A05[640B0000]      <1> 		cmp al, [endkey303]
   988 00000B7A 7408                <1> 		je doneint303
   989 00000B7C E81AFEFFFF          <1> 		call int301prnt
   990 00000B81 46                  <1> 		inc esi
   991 00000B82 EBEE                <1> 		jmp int303b
   992                              <1> 	doneint303:
   993 00000B84 E9D1000000          <1> 		jmp termcopy
   994                              <1> 	
   995 00000B89 00                  <1> endkey304 db 0
   996                              <1> 	int304:	;;get line, al=last key, esi = buffer
   997 00000B8A A2[890B0000]        <1> 		mov [endkey304], al
   998                              <1> 	int304b:
   999 00000B8F 56                  <1> 		push esi
  1000 00000B90 B000                <1> 		mov al, 0
  1001 00000B92 E89EFFFFFF          <1> 		call int302
  1002 00000B97 5E                  <1> 		pop esi
  1003 00000B98 8806                <1> 		mov [esi], al
  1004 00000B9A 46                  <1> 		inc esi
  1005 00000B9B 3A05[890B0000]      <1> 		cmp al, [endkey304]
  1006 00000BA1 75EC                <1> 		jne int304b
  1007 00000BA3 4E                  <1> 		dec esi
  1008 00000BA4 C60600              <1> 		mov byte [esi], 0
  1009 00000BA7 C3                  <1> 	ret
  1010                              <1> 	
  1011 00000BA8 00                  <1> endkey305 db 0
  1012 00000BA9 00                  <1> modkey305 db 0
  1013 00000BAA 00000000            <1> firstesi305 dd 0
  1014 00000BAE 082000              <1> backcursor db 8," ",0
  1015                              <1> 	int305:	;;print and get line, al=last key, bl=modifier, esi=buffer
  1016 00000BB1 A2[A80B0000]        <1> 		mov [endkey305], al
  1017 00000BB6 881D[A90B0000]      <1> 		mov [modkey305], bl
  1018 00000BBC 8935[AA0B0000]      <1> 		mov [firstesi305], esi
  1019                              <1> 	int305b:
  1020 00000BC2 56                  <1> 		push esi
  1021 00000BC3 B000                <1> 		mov al, 0
  1022 00000BC5 E86BFFFFFF          <1> 		call int302
  1023 00000BCA 5E                  <1> 		pop esi
  1024 00000BCB 3C08                <1> 		cmp al, 8
  1025 00000BCD 0F841D000000        <1> 		je near int305bscheck
  1026 00000BD3 8806                <1> 		mov [esi], al
  1027 00000BD5 46                  <1> 		inc esi
  1028                              <1> 	bscheckequal:
  1029 00000BD6 8A1D[A90B0000]      <1> 		mov bl, [modkey305]
  1030 00000BDC E8AEFDFFFF          <1> 		call int301
  1031 00000BE1 8A25[A80B0000]      <1> 		mov ah, [endkey305]
  1032 00000BE7 38E0                <1> 		cmp al, ah
  1033 00000BE9 75D7                <1> 		jne int305b
  1034 00000BEB 4E                  <1> 		dec esi
  1035 00000BEC C60600              <1> 		mov byte [esi], 0
  1036 00000BEF C3                  <1> 		ret
  1037                              <1> 	
  1038                              <1> 	int305bscheck:
  1039 00000BF0 3B35[AA0B0000]      <1> 		cmp esi, [firstesi305]
  1040 00000BF6 7702                <1> 		ja goodbscheck
  1041 00000BF8 EBC8                <1> 		jmp int305b
  1042                              <1> 	goodbscheck:
  1043 00000BFA 4E                  <1> 		dec esi
  1044 00000BFB C60600              <1> 		mov byte [esi], 0
  1045 00000BFE 8A1D[A90B0000]      <1> 		mov bl, [modkey305]
  1046 00000C04 56                  <1> 		push esi
  1047 00000C05 BE[AE0B0000]        <1> 		mov esi, backcursor
  1048 00000C0A E856FFFFFF          <1> 		call print		
  1049 00000C0F 5E                  <1> 		pop esi
  1050 00000C10 B008                <1> 		mov al, 8
  1051 00000C12 EBC2                <1> 		jmp bscheckequal
  1052                              <1> 		
  1053                              <1> 	clear:		
  1054                              <1> 	
  1055                              <1> 	int306:	;;clear screen
  1056 00000C14 668B0D[8B090000]    <1> 		mov cx, [charxy]
  1057 00000C1B BF[851C0000]        <1> 		mov edi, videobuf2
  1058 00000C20 66B80000            <1> 		mov ax, 0
  1059 00000C24 66A3[85090000]      <1> 		mov [linebeginpos], ax
  1060 00000C2A 66A3[87090000]      <1> 		mov [videobufpos], ax
  1061 00000C30 66BA0000            <1> 		mov dx, 0
  1062 00000C34 66A3[89090000]      <1> 		mov [charpos], ax
  1063                              <1> 	int306b:
  1064 00000C3A 668907              <1> 		mov [edi], ax
  1065 00000C3D 81C702000000        <1> 		add edi, 2
  1066 00000C43 80E902              <1> 		sub cl, 2
  1067 00000C46 80F900              <1> 		cmp cl, 0
  1068 00000C49 75EF                <1> 		jne int306b
  1069 00000C4B 8A0D[8B090000]      <1> 		mov cl, [charxy]
  1070 00000C51 FECD                <1> 		dec ch
  1071 00000C53 80FD00              <1> 		cmp ch, 0
  1072 00000C56 75E2                <1> 		jne int306b
  1073                              <1> 	
  1074 00000C58 0000                <1> 	removedvideo dw 0
  1075                              <1> 	
  1076                              <1> termcopy:	
  1077 00000C5A 60                  <1> 	pusha
  1078 00000C5B BF[851C0000]        <1> 	mov edi, videobuf2
  1079 00000C60 BB00000000          <1> 	mov ebx, 0
  1080 00000C65 668B1D[87090000]    <1> 	mov bx, [videobufpos]
  1081 00000C6C 01DF                <1> 	add edi, ebx
  1082 00000C6E B05F                <1> 	mov al, "_"
  1083 00000C70 B407                <1> 	mov ah, 7
  1084 00000C72 668907              <1> 	mov [edi], ax
  1085 00000C75 C605[32290000]00    <1> 	mov byte [mouseselecton], 0
  1086 00000C7C C605[9A090000]01    <1> 	mov byte [termcopyon], 1
  1087 00000C83 803D[33290000]00    <1> 	cmp byte [guion], 0
  1088 00000C8A 0F840D000000        <1> 	je near nowincopy
  1089 00000C90 803D[99090000]01    <1> 	cmp byte [termguion], 1
  1090 00000C97 0F846E280000        <1> 	je near windowvideocopy
  1091                              <1> nowincopy:
  1092 00000C9D BE00000A00          <1> 	mov esi, 0xA0000
  1093 00000CA2 A1[5C030000]        <1> 	mov eax, [basecache]
  1094 00000CA7 C1E004              <1> 	shl eax, 4
  1095 00000CAA 29C6                <1> 	sub esi, eax
  1096 00000CAC BF[851C0000]        <1> 	mov edi, videobuf2
  1097 00000CB1 B900000000          <1> 	mov ecx, 0
  1098 00000CB6 668B0D[8B090000]    <1> 	mov cx, [charxy]
  1099                              <1> nowincopy2:
  1100 00000CBD BB[E3440000]        <1> 	mov ebx, fonts
  1101 00000CC2 B800000000          <1> 	mov eax, 0
  1102 00000CC7 8A07                <1> 	mov al, [edi]
  1103 00000CC9 C1E004              <1> 	shl eax, 4
  1104 00000CCC 01C3                <1> 	add ebx, eax
  1105 00000CCE 47                  <1> 	inc edi
  1106 00000CCF 8A27                <1> 	mov ah, [edi]
  1107 00000CD1 BA00000000          <1> 	mov edx, 0
  1108 00000CD6 8A15[8B090000]      <1> 	mov dl, [charxy]
  1109 00000CDC D1EA                <1> 	shr edx, 1
  1110 00000CDE C1C110              <1> 	rol ecx, 16
  1111 00000CE1 B110                <1> 	mov cl, 16
  1112                              <1> nowinfont:
  1113 00000CE3 8A03                <1> 	mov al, [ebx]
  1114 00000CE5 D0C8                <1> 	ror al, 1
  1115 00000CE7 80FC07              <1> 	cmp ah, 7
  1116 00000CEA 7602                <1> 	jbe notnotfont
  1117 00000CEC F6D0                <1> 	not al
  1118                              <1> notnotfont:
  1119 00000CEE 8806                <1> 	mov [esi], al
  1120 00000CF0 01D6                <1> 	add esi, edx
  1121 00000CF2 43                  <1> 	inc ebx
  1122 00000CF3 FEC9                <1> 	dec cl
  1123 00000CF5 80F900              <1> 	cmp cl, 0
  1124 00000CF8 75E9                <1> 	jne nowinfont
  1125 00000CFA C1E204              <1> 	shl edx, 4
  1126 00000CFD 29D6                <1> 	sub esi, edx
  1127 00000CFF C1C110              <1> 	rol ecx, 16
  1128                              <1> nopresentwinfont:
  1129 00000D02 47                  <1> 	inc edi
  1130 00000D03 46                  <1> 	inc esi
  1131 00000D04 80E902              <1> 	sub cl, 2
  1132 00000D07 80F900              <1> 	cmp cl, 0
  1133 00000D0A 75B1                <1> 	jne nowincopy2
  1134 00000D0C 8A0D[8B090000]      <1> 	mov cl, [charxy]
  1135 00000D12 BA00000000          <1> 	mov edx, 0
  1136 00000D17 88CA                <1> 	mov dl, cl
  1137 00000D19 D1EA                <1> 	shr edx, 1
  1138 00000D1B 29D6                <1> 	sub esi, edx
  1139 00000D1D C1E204              <1> 	shl edx, 4
  1140 00000D20 01D6                <1> 	add esi, edx
  1141 00000D22 FECD                <1> 	dec ch
  1142 00000D24 80FD00              <1> 	cmp ch, 0
  1143 00000D27 7594                <1> 	jne nowincopy2
  1144 00000D29 61                  <1> 	popa
  1145 00000D2A C3                  <1> 	ret
  1146                              <1> 	
  1147                                      %include 'source/solleros.asm'
  1148                              <1> 	;SOLLEROS.ASM
  1149                              <1> os:
  1150 00000D2B E8E4FEFFFF          <1> 	call clear
  1151 00000D30 BE[A0440000]        <1> 	mov esi, userask
  1152 00000D35 E82BFEFFFF          <1> 	call print
  1153                              <1> usercheck:
  1154 00000D3A BE[701A0000]        <1> 	mov esi, buftxt
  1155 00000D3F B00D                <1> 	mov al, 13
  1156 00000D41 B404                <1> 	mov ah, 4
  1157 00000D43 CD30                <1> 	int 30h
  1158 00000D45 56                  <1> 	push esi
  1159 00000D46 BE[C0440000]        <1> 	mov esi, line
  1160 00000D4B E815FEFFFF          <1> 	call print
  1161 00000D50 BE[AA440000]        <1> 	mov esi, pwdask
  1162 00000D55 E80BFEFFFF          <1> 	call print
  1163 00000D5A 5E                  <1> 	pop esi
  1164 00000D5B 46                  <1> 	inc esi
  1165 00000D5C 8935[120E0000]      <1> 	mov [esipass], esi
  1166                              <1> passcheck:
  1167 00000D62 B000                <1> 	mov al, 0
  1168 00000D64 B405                <1> 	mov ah, 5
  1169 00000D66 CD30                <1> 	int 30h
  1170 00000D68 3C0D                <1> 	cmp al, 13
  1171 00000D6A 0F8435000000        <1> 	je near gotpass
  1172 00000D70 3C08                <1> 	cmp al, 8
  1173 00000D72 0F840F000000        <1> 	je near backpass
  1174 00000D78 8806                <1> 	mov [esi], al
  1175 00000D7A 46                  <1> 	inc esi
  1176 00000D7B B02A                <1> 	mov al, '*'
  1177 00000D7D B406                <1> 	mov ah, 6
  1178 00000D7F CD30                <1> 	int 30h
  1179 00000D81 EBDF                <1> 	jmp passcheck
  1180 00000D83 08200800            <1> backcursor2 db 8," ",8,0
  1181                              <1> backpass:
  1182 00000D87 3B35[120E0000]      <1> 	cmp esi, [esipass]
  1183 00000D8D 0F84CFFFFFFF        <1> 	je near passcheck
  1184 00000D93 4E                  <1> 	dec esi
  1185 00000D94 C60600              <1> 	mov byte [esi], 0
  1186 00000D97 56                  <1> 	push esi
  1187 00000D98 BE[830D0000]        <1> 	mov esi, backcursor2
  1188 00000D9D E8C3FDFFFF          <1> 	call print
  1189 00000DA2 5E                  <1> 	pop esi
  1190 00000DA3 EBBD                <1> 	jmp passcheck
  1191                              <1> gotpass:
  1192 00000DA5 B000                <1> 	mov al,0
  1193 00000DA7 8806                <1> 	mov [esi], al
  1194 00000DA9 BE[C0440000]        <1> 	mov esi, line
  1195 00000DAE E8B2FDFFFF          <1> 	call print
  1196 00000DB3 BB[C3440000]        <1> 	mov ebx, userlst
  1197                              <1> userfind:
  1198 00000DB8 BE[701A0000]        <1> 	mov esi, buftxt
  1199 00000DBD 8A06                <1> 	mov al, [esi]
  1200 00000DBF 3C00                <1> 	cmp al, 0
  1201 00000DC1 0F8464FFFFFF        <1> 	je near os
  1202 00000DC7 891D[160E0000]      <1> 	mov [usercache], ebx
  1203 00000DCD E857010000          <1> 	call tester
  1204 00000DD2 3C01                <1> 	cmp al, 1
  1205 00000DD4 7415                <1> 	je pwdtest
  1206                              <1> nxtuser:
  1207 00000DD6 43                  <1> 	inc ebx
  1208 00000DD7 8A03                <1> 	mov al, [ebx]
  1209 00000DD9 3C00                <1> 	cmp al, 0
  1210 00000DDB 74DB                <1> 	je userfind
  1211 00000DDD 81FB[E3440000]      <1> 	cmp ebx, userlstend
  1212 00000DE3 0F8342FFFFFF        <1> 	jae near os
  1213 00000DE9 EBCD                <1> 	jmp userfind
  1214                              <1> pwdtest:
  1215 00000DEB 46                  <1> 	inc esi
  1216 00000DEC 43                  <1> 	inc ebx
  1217 00000DED E837010000          <1> 	call tester
  1218 00000DF2 3C01                <1> 	cmp al, 1
  1219 00000DF4 7402                <1> 	je pwdrgt
  1220 00000DF6 EBDE                <1> 	jmp nxtuser
  1221 00000DF8 E817FEFFFF          <1> pwdrgt:	call clear
  1222 00000DFD 66B90002            <1> 	mov cx, 200h
  1223 00000E01 BE[701A0000]        <1> 	mov esi, buftxt
  1224 00000E06 B000                <1> 	mov al, 0
  1225 00000E08 8806                <1> bufclr:	mov [esi], al
  1226 00000E0A 46                  <1> 	inc esi
  1227 00000E0B E2FB                <1> 	loop bufclr
  1228                              <1> ;;;;;;;;;;;;;;;;
  1229 00000E0D E92B000000          <1> 	jmp nwcmd
  1230                              <1> 
  1231 00000E12 00000000            <1> esipass dd 0
  1232 00000E16 [C3440000]          <1> usercache dd userlst
  1233                              <1> 	
  1234                              <1> buftxtclear:
  1235 00000E1A B000                <1> 	mov al, 0
  1236 00000E1C BE[701A0000]        <1> 	mov esi, buftxt
  1237 00000E21 81FE[701C0000]      <1> clearbuftxt: cmp esi, buf2
  1238 00000E27 730E                <1> 	jae retbufclr
  1239 00000E29 8806                <1> 	mov [esi], al
  1240 00000E2B 46                  <1> 	inc esi
  1241 00000E2C EBF3                <1> 	jmp clearbuftxt
  1242                              <1> 
  1243 00000E2E 39DE                <1> clearitbuf: cmp esi, ebx
  1244 00000E30 7305                <1> 	jae retbufclr
  1245 00000E32 8806                <1> 	mov [esi], al
  1246 00000E34 46                  <1> 	inc esi
  1247 00000E35 EBF7                <1> 	jmp clearitbuf
  1248 00000E37 C3                  <1> retbufclr: ret
  1249                              <1> 
  1250 00000E38 E900000000          <1> full:	jmp nwcmd
  1251                              <1> 
  1252                              <1> 
  1253 00000E3D B001                <1> nwcmd:	mov al, 1
  1254 00000E3F 3805[69130000]      <1> 	cmp [BATCHISON], al
  1255 00000E45 0F8345000000        <1> 	jae near batchran
  1256 00000E4B B000                <1> cancel:	mov al, 0
  1257 00000E4D A2[00130000]        <1> 	mov [IFON], al
  1258 00000E52 A2[69130000]        <1> 	mov [BATCHISON], al
  1259 00000E57 B05B                <1> 	mov al, '['
  1260 00000E59 B406                <1> 	mov ah, 6
  1261 00000E5B 66BB0700            <1> 	mov bx, 7
  1262 00000E5F E837FBFFFF          <1> 	call int301prnt
  1263 00000E64 8B35[160E0000]      <1> 	mov esi, [usercache]
  1264 00000E6A E8F6FCFFFF          <1> 	call print
  1265 00000E6F BE[B4440000]        <1> 	mov esi, location
  1266 00000E74 E8ECFCFFFF          <1> 	call print
  1267                              <1> 	;call time
  1268                              <1> 	;mov esi, timeshow
  1269                              <1> 	;call print
  1270                              <1> 	;mov esi, cmd
  1271                              <1> 	;call print
  1272 00000E79 E89CFFFFFF          <1> 	call buftxtclear
  1273 00000E7E BE[701A0000]        <1> 	mov esi, buftxt
  1274 00000E83 B00D                <1> 	mov al, 13
  1275 00000E85 B307                <1> 	mov bl, 7
  1276 00000E87 B404                <1> 	mov ah, 4
  1277 00000E89 CD30                <1> 	int 30h
  1278                              <1> gotcmd:	
  1279 00000E8B E914000000          <1> 	jmp run
  1280                              <1> 	
  1281                              <1> batchran:
  1282 00000E90 C3                  <1> 	ret
  1283                              <1> 
  1284 00000E91 E884FFFFFF          <1> input:	call buftxtclear
  1285 00000E96 BE[701A0000]        <1> 	mov esi, buftxt		;puts input into buftxt AND onto screen
  1286 00000E9B B00D                <1> stdin:	mov al, 13
  1287 00000E9D B307                <1> 	mov bl, 7
  1288 00000E9F B404                <1> 	mov ah, 4
  1289 00000EA1 CD30                <1> 	int 30h
  1290 00000EA3 C3                  <1> 	ret
  1291                              <1> 
  1292 00000EA4 BE[C0440000]        <1> run:	mov esi, line
  1293 00000EA9 E8B7FCFFFF          <1> 		call print
  1294                              <1> progtest:
  1295 00000EAE BE[701A0000]        <1> 	mov esi, buftxt
  1296 00000EB3 BB[6F130000]        <1> 	mov ebx, fileindex
  1297 00000EB8 668B03              <1> prgnxt:	mov ax, [ebx]
  1298 00000EBB B105                <1> 	mov cl, 5
  1299 00000EBD B504                <1> 	mov ch, 4
  1300 00000EBF 6639C8              <1> 	cmp ax, cx
  1301 00000EC2 740B                <1> 	je fndprg
  1302 00000EC4 43                  <1> 	inc ebx
  1303 00000EC5 81FB[6F150000]      <1> 	cmp ebx, fileindexend
  1304 00000ECB 7330                <1> 	jae prgnf
  1305 00000ECD EBE9                <1> 	jmp prgnxt
  1306 00000ECF 81C302000000        <1> fndprg: add ebx, 2
  1307 00000ED5 BE[701A0000]        <1> 	mov esi, buftxt
  1308 00000EDA 66B90000            <1> 	mov cx, 0
  1309 00000EDE E880000000          <1> 	call cndtest
  1310 00000EE3 3C01                <1> 	cmp al, 1
  1311 00000EE5 7302                <1> 	jae prggood
  1312 00000EE7 EBCF                <1> 	jmp prgnxt
  1313 00000EE9 81FB[6F150000]      <1> prggood: cmp ebx, fileindexend
  1314 00000EEF 7333                <1> 	jae prgdn
  1315 00000EF1 81C303000000        <1> 	add ebx, 3
  1316 00000EF7 8B3B                <1> 	mov edi, [ebx]
  1317 00000EF9 90                  <1> 	nop
  1318 00000EFA 90                  <1> 	nop
  1319 00000EFB FFE7                <1> 	jmp edi
  1320                              <1> prgnf:	
  1321 00000EFD A0[701A0000]        <1> 	mov al, [buftxt]
  1322 00000F02 3C00                <1> 	cmp al, 0
  1323 00000F04 741E                <1> 	je prgdn
  1324 00000F06 BE[87440000]        <1> 	mov esi, notfound1
  1325 00000F0B E855FCFFFF          <1> 	call print
  1326 00000F10 BE[701A0000]        <1> 	mov esi, buftxt
  1327 00000F15 E84BFCFFFF          <1> 	call print
  1328 00000F1A BE[91440000]        <1> 	mov esi, notfound2
  1329 00000F1F E841FCFFFF          <1> 	call print
  1330 00000F24 E914FFFFFF          <1> prgdn:	jmp nwcmd
  1331                              <1> 
  1332                              <1> 
  1333                              <1> tester:			;si=user bx=prog returns 1 in al if true
  1334 00000F29 B000                <1> 	mov al, 0
  1335 00000F2B 8A06                <1> retest:	mov al, [esi]
  1336 00000F2D 8A23                <1> 	mov ah, [ebx]
  1337 00000F2F 3C00                <1> 	cmp al, 0
  1338 00000F31 7408                <1> 	je testtrue
  1339 00000F33 38E0                <1> 	cmp al, ah
  1340 00000F35 750C                <1> 	jne testfalse
  1341 00000F37 43                  <1> 	inc ebx
  1342 00000F38 46                  <1> 	inc esi
  1343 00000F39 EBF0                <1> 	jmp retest
  1344                              <1> testtrue:
  1345 00000F3B 80FC00              <1> 	cmp ah, 0
  1346 00000F3E 7503                <1> 	jne testfalse
  1347 00000F40 B001                <1> 	mov al, 1
  1348 00000F42 C3                  <1> 	ret
  1349                              <1> testfalse:
  1350 00000F43 B000                <1> 	mov al, 0
  1351 00000F45 C3                  <1> 	ret
  1352                              <1> 
  1353                              <1> optest:			;si=user bx=prog returns 1 in al if true
  1354 00000F46 B000                <1> 	mov al, 0
  1355                              <1> opretest:
  1356 00000F48 8A06                <1> 	mov al, [esi]
  1357 00000F4A 8A23                <1> 	mov ah, [ebx]
  1358 00000F4C 38E0                <1> 	cmp al, ah
  1359 00000F4E 7510                <1> 	jne optestfalse
  1360 00000F50 80FC00              <1> 	cmp ah, 0
  1361 00000F53 7404                <1> 	je optesttrue
  1362 00000F55 43                  <1> 	inc ebx
  1363 00000F56 46                  <1> 	inc esi
  1364 00000F57 EBEF                <1> 	jmp opretest
  1365                              <1> optesttrue:
  1366 00000F59 3C00                <1> 	cmp al, 0
  1367 00000F5B 7503                <1> 	jne optestfalse
  1368 00000F5D B001                <1> 	mov al, 1
  1369 00000F5F C3                  <1> 	ret
  1370                              <1> optestfalse:
  1371 00000F60 B000                <1> 	mov al, 0
  1372 00000F62 C3                  <1> 	ret
  1373                              <1> 
  1374                              <1> cndtest:			;si=user bx=prog cl=endchar returns 1 in al if true
  1375 00000F63 B000                <1> 	mov al, 0
  1376 00000F65 8A06                <1> cndretest:	mov al, [esi]
  1377 00000F67 8A23                <1> 	mov ah, [ebx]
  1378 00000F69 38CC                <1> 	cmp ah, cl
  1379 00000F6B 7408                <1> 	je cndtesttrue
  1380 00000F6D 38E0                <1> 	cmp al, ah
  1381 00000F6F 750B                <1> 	jne cndtestfalse
  1382 00000F71 43                  <1> 	inc ebx
  1383 00000F72 46                  <1> 	inc esi
  1384 00000F73 EBF0                <1> 	jmp cndretest
  1385                              <1> cndtesttrue:
  1386 00000F75 38C8                <1> 	cmp al, cl
  1387 00000F77 7506                <1> 	jne cndtestalmost
  1388 00000F79 B001                <1> 	mov al, 1
  1389 00000F7B C3                  <1> 	ret
  1390                              <1> cndtestfalse:
  1391 00000F7C B000                <1> 	mov al, 0
  1392 00000F7E C3                  <1> 	ret
  1393                              <1> cndtestalmost:
  1394 00000F7F B002                <1> 	mov al, 2
  1395 00000F81 C3                  <1> 	ret
  1396 00000F82 00                  <1> currentdir db 0
  1397 00000F83 BE[6F130000]        <1> dir:	mov esi, fileindex
  1398 00000F88 8A06                <1> 	dirnxt:	mov al, [esi]
  1399 00000F8A B400                <1> 		mov ah, 0
  1400 00000F8C 3C05                <1> 		cmp al, 5
  1401 00000F8E 744A                <1> 		je dirfnd
  1402 00000F90 3C07                <1> 		cmp al, 7
  1403 00000F92 743C                <1> 		je dirfnd3
  1404 00000F94 3C06                <1> 		cmp al, 6
  1405 00000F96 7438                <1> 		je dirfnd3
  1406 00000F98 46                  <1> 		inc esi
  1407 00000F99 81FE[6F150000]      <1> 		cmp esi,  fileindexend
  1408 00000F9F 737B                <1> 		jae dirdn
  1409 00000FA1 EBE5                <1> 		jmp dirnxt
  1410 00000FA3 060400626174636800- <1> 	typetable db 6,4,0,"batch",0,7,4,0,"document",0,10,4,0,"folder",0,5,4,0,"executable",0
  1411 00000FAC 070400646F63756D65- <1>
  1412 00000FB5 6E74000A0400666F6C- <1>
  1413 00000FBE 646572000504006578- <1>
  1414 00000FC7 6563757461626C6500  <1>
  1415                              <1> 	dirfnd3:
  1416 00000FD0 46                  <1> 		inc esi
  1417 00000FD1 81FE[6F150000]      <1> 		cmp esi, fileindexend
  1418 00000FD7 76AF                <1> 		jbe dirnxt
  1419 00000FD9 4E                  <1> 		dec esi
  1420 00000FDA 46                  <1> 	dirfnd:	inc esi
  1421 00000FDB 8A06                <1> 		mov al, [esi]
  1422 00000FDD B400                <1> 		mov ah, 0
  1423 00000FDF 3C04                <1> 		cmp al, 4
  1424 00000FE1 740B                <1> 		je dirfnd2
  1425 00000FE3 46                  <1> 		inc esi
  1426 00000FE4 81FE[6F150000]      <1> 		cmp esi,  fileindexend
  1427 00000FEA 7330                <1> 		jae dirdn
  1428 00000FEC EB9A                <1> 		jmp dirnxt
  1429 00000FEE 81C601000000        <1> 	dirfnd2: add esi, 1
  1430 00000FF4 E86CFBFFFF          <1> 		call print
  1431 00000FF9 8935[21100000]      <1> 		mov [esidir], esi
  1432 00000FFF BE[C0440000]        <1> 		mov esi, line
  1433 00001004 E85CFBFFFF          <1> 		call print
  1434 00001009 8B35[21100000]      <1> 		mov esi, [esidir]
  1435 0000100F 81FE[6F150000]      <1> 		cmp esi,  fileindexend
  1436 00001015 7305                <1> 		jae dirdn
  1437 00001017 E96CFFFFFF          <1> 		jmp dirnxt
  1438 0000101C E91CFEFFFF          <1> 	dirdn:	jmp nwcmd
  1439 00001021 00000000            <1> esidir dd 0
  1440                              <1> 
  1441                              <1> array:				;arraystart in si, arrayend in bx, arrayseperator in cx
  1442                              <1> 		                ;ends if array seperator is found backwards after 0
  1443                              <1> 	arnxt:	      
  1444 00001025 88E8                <1> 		mov al, ch
  1445 00001027 88CC                <1> 		mov ah, cl        
  1446 00001029 663906              <1> 		cmp [esi], ax
  1447 0000102C 744D                <1> 		je ardn
  1448 0000102E 66390E              <1> 		cmp [esi], cx
  1449 00001031 7407                <1> 		je arfnd
  1450 00001033 46                  <1> 		inc esi
  1451 00001034 39DE                <1> 		cmp esi, ebx
  1452 00001036 7343                <1> 		jae ardn
  1453 00001038 EBEB                <1> 		jmp arnxt
  1454 0000103A 81C602000000        <1> 	arfnd: add esi, 2
  1455 00001040 891D[7C100000]      <1> 		mov [arbx], ebx
  1456 00001046 890D[80100000]      <1> 		mov [arcx], ecx
  1457 0000104C E814FBFFFF          <1> 		call print
  1458 00001051 8935[82100000]      <1> 		mov [arsi], esi
  1459 00001057 BE[C0440000]        <1> 		mov esi, line
  1460 0000105C E804FBFFFF          <1> 		call print
  1461 00001061 8B1D[7C100000]      <1> 		mov ebx, [arbx]
  1462 00001067 668B0D[80100000]    <1> 		mov cx, [arcx]
  1463 0000106E 8B35[82100000]      <1> 		mov esi, [arsi]
  1464 00001074 46                  <1> 		inc esi
  1465 00001075 39DE                <1> 		cmp esi, ebx
  1466 00001077 7302                <1> 		jae ardn
  1467 00001079 EBAA                <1> 		jmp arnxt
  1468 0000107B C3                  <1> 	ardn:	ret
  1469 0000107C 00000000            <1> arbx:	dw 0,0
  1470 00001080 0000                <1> arcx:	db 0,0
  1471 00001082 00000000            <1> arsi:	dw 0,0
  1472                              <1> 
  1473                              <1> clearbuffer:
  1474 00001086 BE[701C0000]        <1> 	mov esi, buf2
  1475 0000108B B030                <1> 	mov al, '0'
  1476 0000108D 81FE[841C0000]      <1> clearbuf: cmp esi, numbuf
  1477 00001093 7305                <1> 	jae doneclearbuff
  1478 00001095 8806                <1> 	mov [esi], al
  1479 00001097 46                  <1> 	inc esi
  1480 00001098 EBF3                <1> 	jmp clearbuf
  1481                              <1> doneclearbuff: 
  1482 0000109A C3                  <1> 		ret
  1483                              <1> 
  1484                              <1> convert:
  1485 0000109B 4E                  <1> 	dec esi
  1486 0000109C 89F3                <1> 	mov ebx, esi		;place to convert into must be in si, number to convert must be in cx
  1487                              <1> cnvrt:
  1488 0000109E 89DE                <1> 	mov esi, ebx
  1489 000010A0 81EE09000000        <1> 	sub esi, 9
  1490 000010A6 81F900CA9A3B        <1> 	cmp ecx, 1000000000
  1491 000010AC 720A                <1> 	jb ten8
  1492 000010AE 81E900CA9A3B        <1> 	sub ecx, 1000000000
  1493 000010B4 FE06                <1> 	inc byte [esi]
  1494 000010B6 EBE6                <1> 	jmp cnvrt
  1495 000010B8 46                  <1> ten8:	inc esi
  1496 000010B9 81F900E1F505        <1> 	cmp ecx, 100000000
  1497 000010BF 720A                <1> 	jb ten7
  1498 000010C1 81E900E1F505        <1> 	sub ecx, 100000000
  1499 000010C7 FE06                <1> 	inc byte [esi]
  1500 000010C9 EBD3                <1> 	jmp cnvrt
  1501 000010CB 46                  <1> ten7:	inc esi
  1502 000010CC 81F980969800        <1> 	cmp ecx, 10000000
  1503 000010D2 720A                <1> 	jb ten6
  1504 000010D4 81E980969800        <1> 	sub ecx, 10000000
  1505 000010DA FE06                <1> 	inc byte [esi]
  1506 000010DC EBC0                <1> 	jmp cnvrt
  1507 000010DE 46                  <1> ten6:	inc esi
  1508 000010DF 81F940420F00        <1> 	cmp ecx, 1000000
  1509 000010E5 720A                <1> 	jb ten5
  1510 000010E7 81E940420F00        <1> 	sub ecx, 1000000
  1511 000010ED FE06                <1> 	inc byte [esi]
  1512 000010EF EBAD                <1> 	jmp cnvrt
  1513 000010F1 46                  <1> ten5:	inc esi
  1514 000010F2 81F9A0860100        <1> 	cmp ecx, 100000
  1515 000010F8 720A                <1> 	jb ten4
  1516 000010FA 81E9A0860100        <1> 	sub ecx, 100000
  1517 00001100 FE06                <1> 	inc byte [esi]
  1518 00001102 EB9A                <1> 	jmp cnvrt
  1519 00001104 46                  <1> ten4:	inc esi
  1520 00001105 81F910270000        <1> 	cmp ecx, 10000
  1521 0000110B 720A                <1> 	jb ten3
  1522 0000110D 81E910270000        <1> 	sub ecx, 10000
  1523 00001113 FE06                <1> 	inc byte [esi]
  1524 00001115 EB87                <1> 	jmp cnvrt
  1525 00001117 46                  <1> ten3:	inc esi
  1526 00001118 81F9E8030000        <1> 	cmp ecx, 1000
  1527 0000111E 720D                <1> 	jb ten2
  1528 00001120 81E9E8030000        <1> 	sub ecx, 1000
  1529 00001126 FE06                <1> 	inc byte [esi]
  1530 00001128 E971FFFFFF          <1> 	jmp cnvrt
  1531 0000112D 46                  <1> ten2:	inc esi
  1532 0000112E 81F964000000        <1> 	cmp ecx, 100
  1533 00001134 720D                <1> 	jb ten1
  1534 00001136 81E964000000        <1> 	sub ecx, 100
  1535 0000113C FE06                <1> 	inc byte [esi]
  1536 0000113E E95BFFFFFF          <1> 	jmp cnvrt
  1537 00001143 46                  <1> ten1:	inc esi
  1538 00001144 81F90A000000        <1> 	cmp ecx, 10
  1539 0000114A 720D                <1> 	jb ten0
  1540 0000114C 81E90A000000        <1> 	sub ecx, 10
  1541 00001152 FE06                <1> 	inc byte [esi]
  1542 00001154 E945FFFFFF          <1> 	jmp cnvrt
  1543 00001159 46                  <1> ten0:	inc esi
  1544 0000115A 81F901000000        <1> 	cmp ecx, 1
  1545 00001160 720D                <1> 	jb tendn
  1546 00001162 81E901000000        <1> 	sub ecx, 1
  1547 00001168 FE06                <1> 	inc byte [esi]
  1548 0000116A E92FFFFFFF          <1> 	jmp cnvrt
  1549                              <1> tendn:
  1550 0000116F C3                  <1> 	ret
  1551                              <1> 
  1552                              <1> 	
  1553                              <1> 
  1554 00001170 00<rept>            <1> hexnumber times 8 db 0
  1555 00001178 202000              <1> hexnumberend db "  ",0
  1556                              <1> 
  1557                              <1> 
  1558 0000117B 00000000            <1> sibuf dw 0,0
  1559 0000117F 00000000            <1> dibuf dw 0,0
  1560                              <1> 
  1561                              <1> converthex:
  1562                              <1> clearbufferhex:
  1563 00001183 B030                <1> 	mov al, '0'
  1564 00001185 8935[7B110000]      <1> 	mov [sibuf], esi
  1565 0000118B 893D[7F110000]      <1> 	mov [dibuf], edi
  1566 00001191 39FE                <1> clearbufhex: cmp esi, edi
  1567 00001193 7305                <1> 	jae doneclearbuffhex
  1568 00001195 8806                <1> 	mov [esi], al
  1569 00001197 46                  <1> 	inc esi
  1570 00001198 EBF7                <1> 	jmp clearbufhex
  1571                              <1> doneclearbuffhex:
  1572 0000119A 8B35[7F110000]      <1> 	mov esi, [dibuf]
  1573 000011A0 89CA                <1> 	mov edx, ecx
  1574 000011A2 81FA00000000        <1> 	cmp edx, 0
  1575 000011A8 741F                <1> 	je donenxtephx
  1576                              <1> nxtexphx:	;0x10^x
  1577 000011AA 4E                  <1> 	dec esi
  1578 000011AB 89F7                <1> 	mov edi, esi		;;location of 0x10^x
  1579 000011AD 89D1                <1> 	mov ecx, edx
  1580 000011AF 81E10F000000        <1> 	and ecx, 0xF		;;just this digit
  1581 000011B5 E81C000000          <1> 	call cnvrtexphx		;;get this digit
  1582 000011BA 89FE                <1> 	mov esi, edi
  1583 000011BC C1EA04              <1> 	shr edx, 4		;;next digit
  1584 000011BF 81FA00000000        <1> 	cmp edx, 0
  1585 000011C5 7402                <1> 	je donenxtephx
  1586 000011C7 EBE1                <1> 	jmp nxtexphx
  1587                              <1> donenxtephx:
  1588 000011C9 8B35[7B110000]      <1> 	mov esi, [sibuf]
  1589 000011CF 8B3D[7F110000]      <1> 	mov edi, [dibuf]
  1590 000011D5 C3                  <1> 	ret
  1591                              <1> cnvrtexphx:			;;convert this number
  1592 000011D6 89F3                <1> 	mov ebx, esi		;place to convert to must be in si, number to convert must be in cx
  1593 000011D8 81F900000000        <1> 	cmp ecx, 0
  1594 000011DE 7429                <1> 	je zerohx
  1595 000011E0 8A06                <1> cnvrthx:  mov al, [esi]
  1596 000011E2 3C39                <1> 	cmp al, '9'
  1597 000011E4 741B                <1> 	je lettershx
  1598 000011E6 3C46                <1> lttrhxdn: cmp al, 'F'
  1599 000011E8 741F                <1> 	je zerohx
  1600 000011EA 8A06                <1> 	mov al, [esi]
  1601 000011EC FEC0                <1> 	inc al
  1602 000011EE 8806                <1> 	mov [esi], al
  1603 000011F0 89DE                <1> 	mov esi, ebx
  1604 000011F2 81E901000000        <1> cnvrtlphx: sub ecx, 1
  1605 000011F8 81F900000000        <1> 	cmp ecx, 0
  1606 000011FE 75E0                <1> 	jne cnvrthx
  1607 00001200 C3                  <1> 	ret
  1608                              <1> lettershx:
  1609 00001201 B041                <1> 	mov al, 'A'
  1610 00001203 2C01                <1> 	sub al, 1
  1611 00001205 8806                <1> 	mov [esi], al
  1612 00001207 EBDD                <1> 	jmp lttrhxdn
  1613 00001209 B030                <1> zerohx:	mov al, '0'
  1614 0000120B 8806                <1> 	mov [esi], al
  1615 0000120D 4E                  <1> 	dec esi
  1616 0000120E 8A06                <1> 	mov al, [esi]
  1617 00001210 3C46                <1> 	cmp al, 'F'
  1618 00001212 74F5                <1> 	je zerohx
  1619 00001214 41                  <1> 	inc ecx
  1620 00001215 EBDB                <1> 	jmp cnvrtlphx
  1621                              <1> 
  1622 00001217 01                  <1> firsthexshown db 1
  1623                              <1> showhex:
  1624 00001218 60                  <1> 	pusha
  1625 00001219 BE[70110000]        <1> 	mov esi, hexnumber
  1626 0000121E BF[78110000]        <1> 	mov edi, hexnumberend
  1627 00001223 E85BFFFFFF          <1> 	call converthex
  1628 00001228 803D[17120000]01    <1> 	cmp byte [firsthexshown], 1
  1629 0000122F 7504                <1> 	jne showthathex
  1630 00001231 66BA0000            <1> 	mov dx, 0
  1631                              <1> showthathex:
  1632 00001235 803D[17120000]03    <1> 	cmp byte [firsthexshown], 3
  1633 0000123C 750A                <1> 	jne nonewhexline
  1634 0000123E BE[C0440000]        <1> 	mov esi, line
  1635 00001243 E81DF9FFFF          <1> 	call print
  1636                              <1> nonewhexline:
  1637 00001248 803D[17120000]04    <1> 	cmp byte [firsthexshown], 4
  1638 0000124F 7527                <1> 	jne notabfixhex
  1639 00001251 B1A0                <1> 	mov cl, 160
  1640 00001253 28D1                <1> 	sub cl, dl
  1641 00001255 C0E905              <1> 	shr cl, 5
  1642 00001258 C0E105              <1> 	shl cl, 5
  1643 0000125B 80F900              <1> 	cmp cl, 0
  1644 0000125E 750F                <1> 	jne nonewlinetabfixhex
  1645 00001260 BE[C0440000]        <1> 	mov esi, line
  1646 00001265 E8FBF8FFFF          <1> 	call print
  1647 0000126A E909000000          <1> 	jmp notabfixhex
  1648                              <1> nonewlinetabfixhex:
  1649 0000126F 80C20F              <1> 	add dl, 15
  1650 00001272 C0EA04              <1> 	shr dl, 4
  1651 00001275 C0E204              <1> 	shl dl, 4
  1652                              <1> notabfixhex:
  1653 00001278 BE[70110000]        <1> 	mov esi, hexnumber
  1654 0000127D E8E3F8FFFF          <1> 	call print
  1655 00001282 803D[17120000]02    <1> 	cmp byte [firsthexshown], 2
  1656 00001289 750A                <1> 	jne hexshown
  1657 0000128B BE[C0440000]        <1> 	mov esi, line
  1658 00001290 E8D0F8FFFF          <1> 	call print
  1659                              <1> hexshown:
  1660 00001295 C605[17120000]00    <1> 	mov byte [firsthexshown], 0
  1661 0000129C 61                  <1> 	popa
  1662 0000129D C3                  <1> 	ret
  1663                              <1> 
  1664                              <1> 
  1665 0000129E 303030303030303030- <1> decnumber db "00000000000000"
  1666 000012A7 3030303030          <1>
  1667 000012AC 2000                <1> decnumberend: db " ",0
  1668                              <1> 
  1669                              <1> showdec: ;;same as showhex, just uses decimal conversion
  1670 000012AE 60                  <1> 	pusha
  1671 000012AF BF[9E120000]        <1> 	mov edi, decnumber
  1672 000012B4 BE[AC120000]        <1> 	mov esi, decnumberend
  1673                              <1> cleardecbuf:
  1674 000012B9 C60730              <1> 	mov byte [edi], '0'
  1675 000012BC 47                  <1> 	inc edi
  1676 000012BD 39F7                <1> 	cmp edi, esi
  1677 000012BF 72F8                <1> 	jb cleardecbuf
  1678 000012C1 BF[9E120000]        <1> 	mov edi, decnumber
  1679 000012C6 E8D0FDFFFF          <1> 	call convert
  1680 000012CB 803D[17120000]01    <1> 	cmp byte [firsthexshown], 1
  1681 000012D2 7504                <1> 	jne showthatdec
  1682 000012D4 66BA0000            <1> 	mov dx, 0
  1683                              <1> showthatdec:
  1684 000012D8 803D[17120000]03    <1> 	cmp byte [firsthexshown], 3
  1685 000012DF 750A                <1> 	jne nonewdecline
  1686 000012E1 BE[C0440000]        <1> 	mov esi, line
  1687 000012E6 E87AF8FFFF          <1> 	call print
  1688                              <1> nonewdecline:
  1689 000012EB 803D[17120000]04    <1> 	cmp byte [firsthexshown], 4
  1690 000012F2 7527                <1> 	jne notabfixdec
  1691 000012F4 B1A0                <1> 	mov cl, 160
  1692 000012F6 28D1                <1> 	sub cl, dl
  1693 000012F8 C0E905              <1> 	shr cl, 5
  1694 000012FB C0E105              <1> 	shl cl, 5
  1695 000012FE 80F900              <1> 	cmp cl, 0
  1696 00001301 750F                <1> 	jne nonewlinetabfixdec
  1697 00001303 BE[C0440000]        <1> 	mov esi, line
  1698 00001308 E858F8FFFF          <1> 	call print
  1699 0000130D E909000000          <1> 	jmp notabfixdec
  1700                              <1> nonewlinetabfixdec:
  1701 00001312 80C20F              <1> 	add dl, 15
  1702 00001315 C0EA04              <1> 	shr dl, 4
  1703 00001318 C0E204              <1> 	shl dl, 4
  1704                              <1> notabfixdec:
  1705 0000131B BE[9E120000]        <1> 	mov esi, decnumber
  1706 00001320 4E                  <1> 	dec esi
  1707                              <1> sifind:
  1708 00001321 46                  <1> 	inc esi
  1709 00001322 803E30              <1> 	cmp byte [esi], '0'
  1710 00001325 74FA                <1> 	je sifind
  1711 00001327 E839F8FFFF          <1> 	call print
  1712 0000132C 803D[17120000]02    <1> 	cmp byte [firsthexshown], 2
  1713 00001333 750A                <1> 	jne decshown
  1714 00001335 BE[C0440000]        <1> 	mov esi, line
  1715 0000133A E826F8FFFF          <1> 	call print
  1716                              <1> decshown:
  1717 0000133F C605[17120000]00    <1> 	mov byte [firsthexshown], 0
  1718 00001346 61                  <1> 	popa
  1719 00001347 C3                  <1> 	ret
  1720                              <1> 	
  1721                              <1> cnvrttxt: 
  1722 00001348 B900000000          <1> 	mov ecx, 0
  1723 0000134D B800000000          <1> 	mov eax, 0
  1724 00001352 BA00000000          <1> 	mov edx, 0
  1725 00001357 BB00000000          <1> 	mov ebx, 0
  1726 0000135C 4E                  <1> 	dec esi
  1727                              <1> cnvrtlptxt:
  1728 0000135D 46                  <1> 	inc esi
  1729 0000135E 8A06                <1> 	mov al, [esi]
  1730 00001360 3C00                <1> 	cmp al, 0
  1731 00001362 75F9                <1> 	jne cnvrtlptxt
  1732 00001364 4E                  <1> 	dec esi
  1733 00001365 8A06                <1> 	mov al, [esi]
  1734 00001367 3C30                <1> 	cmp al, '0'
  1735 00001369 7504                <1> 	jne txtlp
  1736 0000136B 39FE                <1> zerotest: cmp esi, edi
  1737 0000136D 745B                <1> 	je donecnvrt
  1738                              <1> txtlp:	
  1739 0000136F B800000000          <1> 	mov eax, 0
  1740 00001374 8A06                <1> 	mov al, [esi]
  1741 00001376 3C3D                <1> 	cmp al, '='
  1742 00001378 7450                <1> 	je donecnvrt
  1743 0000137A 3C30                <1> 	cmp al, 48
  1744 0000137C 724C                <1> 	jb donecnvrt
  1745 0000137E 3C23                <1> 	cmp al, '#'
  1746 00001380 7448                <1> 	je donecnvrt
  1747 00001382 39FE                <1> 	cmp esi, edi
  1748 00001384 7244                <1> 	jb donecnvrt
  1749 00001386 81F900000000        <1> 	cmp ecx, 0
  1750 0000138C 7708                <1> 	ja exp
  1751 0000138E 2C30                <1> noexp:	sub al, 48
  1752 00001390 01C2                <1> 	add edx, eax
  1753 00001392 4E                  <1> 	dec esi
  1754 00001393 41                  <1> 	inc ecx
  1755 00001394 EBD9                <1> 	jmp txtlp
  1756 00001396 81F900000000        <1> exp:	cmp ecx, 0
  1757 0000139C 74F0                <1> 	je noexp
  1758 0000139E 2C30                <1> 	sub al, 48
  1759 000013A0 51                  <1> 	push ecx
  1760 000013A1 89C3                <1> expmul:	mov ebx, eax
  1761 000013A3 01D8                <1> 	add eax, ebx
  1762 000013A5 01D8                <1> 	add eax, ebx
  1763 000013A7 01D8                <1> 	add eax, ebx
  1764 000013A9 01D8                <1> 	add eax, ebx
  1765 000013AB 01D8                <1> 	add eax, ebx
  1766 000013AD 01D8                <1> 	add eax, ebx
  1767 000013AF 01D8                <1> 	add eax, ebx
  1768 000013B1 01D8                <1> 	add eax, ebx
  1769 000013B3 01D8                <1> 	add eax, ebx
  1770 000013B5 81E901000000        <1> 	sub ecx, 1
  1771 000013BB 81F900000000        <1> 	cmp ecx, 0
  1772 000013C1 77DE                <1> 	ja expmul
  1773 000013C3 01C2                <1> 	add edx, eax
  1774 000013C5 59                  <1> 	pop ecx
  1775 000013C6 4E                  <1> 	dec esi
  1776 000013C7 41                  <1> 	inc ecx
  1777 000013C8 EBA5                <1> 	jmp txtlp
  1778 000013CA 89D1                <1> donecnvrt: mov ecx, edx
  1779 000013CC C3                  <1> 	ret
  1780                                      %include 'source/builtinprogs.asm'
  1781 000013CD 050406040704        <1> filetypes db 5,4,6,4,7,4
  1782                              <1> progstart:		;programs start here
  1783                              <1> ;db 5,4,"index",0
  1784                              <1> ;	call indexfiles
  1785                              <1> ;	jmp nwcmd
  1786                              <1> indexfiles:
  1787 000013D3 BE[D3130000]        <1> 	mov esi, progstart
  1788 000013D8 BB[6F130000]        <1> 	mov ebx, fileindex
  1789 000013DD BF[D3130000]        <1> 	mov edi, progstart
  1790 000013E2 81EF02000000        <1> 	sub edi, 2
  1791                              <1> indexloop:
  1792 000013E8 668B0E              <1> 	mov cx, [esi]
  1793                              <1> 	indexloop2:
  1794 000013EB 663B0F              <1> 		cmp cx, [edi]
  1795 000013EE 7424                <1> 		je indexloop2done
  1796 000013F0 81EF02000000        <1> 		sub edi, 2
  1797 000013F6 81FF[CD130000]      <1> 		cmp edi, filetypes
  1798 000013FC 73ED                <1> 		jae indexloop2
  1799 000013FE BF[D3130000]        <1> 	mov edi, progstart
  1800 00001403 81EF02000000        <1> 	sub edi, 2
  1801 00001409 46                  <1> 	inc esi
  1802 0000140A 81FE[77230000]      <1> 	cmp esi, batchprogend
  1803 00001410 734E                <1> 	jae indexloopdone
  1804 00001412 EBD4                <1> 	jmp indexloop
  1805                              <1> indexloop2done:
  1806 00001414 66890B              <1> 	mov [ebx], cx
  1807 00001417 81C302000000        <1> 	add ebx, 2
  1808 0000141D 81C602000000        <1> 	add esi, 2
  1809                              <1> 	nameindex:
  1810 00001423 8A0E                <1> 		mov cl, [esi]
  1811 00001425 80F900              <1> 		cmp cl, 0
  1812 00001428 7406                <1> 		je nameindexdone
  1813 0000142A 880B                <1> 		mov [ebx], cl
  1814 0000142C 46                  <1> 		inc esi
  1815 0000142D 43                  <1> 		inc ebx
  1816 0000142E EBF3                <1> 		jmp nameindex
  1817                              <1> 	nameindexdone:
  1818 00001430 43                  <1> 		inc ebx
  1819 00001431 66C7030000          <1> 		mov word [ebx], 0
  1820 00001436 81C302000000        <1> 		add ebx, 2
  1821 0000143C 46                  <1> 		inc esi
  1822 0000143D 8933                <1> 		mov [ebx], esi
  1823 0000143F 81C304000000        <1> 		add ebx, 4
  1824 00001445 66C7030000          <1> 		mov word [ebx], 0
  1825 0000144A 81C302000000        <1> 		add ebx, 2
  1826 00001450 81FB[6F150000]      <1> 		cmp ebx, fileindexend
  1827 00001456 7308                <1> 		jae indexloopdone
  1828 00001458 81C601000000        <1> 		add esi, 1
  1829 0000145E EB88                <1> 		jmp indexloop
  1830 00001460 C3                  <1> indexloopdone: 	ret
  1831                              <1> 
  1832                              <1> 
  1833                              <1> ;db 5,4,"showindex",0
  1834                              <1> ;	mov esi, fileindex
  1835                              <1> ;	mov ebx, fileindexend
  1836                              <1> ;	mov cl, 5
  1837                              <1> ;	mov ch, 4
  1838                              <1> ;	call array
  1839                              <1> ;	mov esi, fileindex
  1840                              <1> ;	mov ebx, fileindexend
  1841                              <1> ;	mov cl, 6
  1842                              <1> ;	mov ch, 4
  1843                              <1> ;	call array
  1844                              <1> ;	mov esi, fileindex
  1845                              <1> ;	mov ebx, fileindexend
  1846                              <1> ;	mov cl, 7
  1847                              <1> ;	mov ch, 4
  1848                              <1> ;	call array
  1849                              <1> ;	jmp nwcmd
  1850                              <1> 
  1851 00001461 05046C7300          <1> db 5,4,"ls",0
  1852 00001466 BE[D3130000]        <1> 	lscmd:	mov esi, progstart
  1853 0000146B BB[77230000]        <1> 		mov ebx, progend
  1854 00001470 E90EFBFFFF          <1> 		jmp dir
  1855                              <1> 		
  1856 00001475 05046469736B00      <1> db 5,4,"disk",0
  1857 0000147C B900000000          <1> 		mov ecx, 0
  1858 00001481 8A0D[2B000000]      <1> 		mov cl, [DriveNumber]
  1859 00001487 C605[17120000]00    <1> 		mov byte [firsthexshown], 0
  1860 0000148E E885FDFFFF          <1> 		call showhex
  1861 00001493 BE[C0440000]        <1> 		mov esi, line
  1862 00001498 E8C8F6FFFF          <1> 		call print
  1863 0000149D BE[0B440000]        <1> 		mov esi, diskfileindex
  1864                              <1> 	diskindexdir:
  1865 000014A2 E8BEF6FFFF          <1> 		call print
  1866 000014A7 8B4E05              <1> 		mov ecx, [esi + 5]
  1867 000014AA C605[17120000]03    <1> 		mov byte [firsthexshown], 3
  1868 000014B1 E8F8FDFFFF          <1> 		call showdec
  1869 000014B6 56                  <1> 		push esi
  1870 000014B7 BE[C0440000]        <1> 		mov esi, line
  1871 000014BC E8A4F6FFFF          <1> 		call print
  1872 000014C1 5E                  <1> 		pop esi
  1873 000014C2 81C609000000        <1> 		add esi, 9
  1874 000014C8 81FE[82440000]      <1> 		cmp esi, enddiskfileindex
  1875 000014CE 72D2                <1> 		jb diskindexdir
  1876 000014D0 E968F9FFFF          <1> 		jmp nwcmd
  1877                              <1> 
  1878 000014D5 0504636C65617200    <1> db 5,4,"clear",0
  1879 000014DD E832F7FFFF          <1> 	cls:	call clear
  1880 000014E2 E956F9FFFF          <1> 		jmp nwcmd
  1881                              <1> 		
  1882 000014E7 05047761697400      <1> db 5,4,"wait",0
  1883 000014EE B000                <1> 		mov al, 0
  1884 000014F0 E840F6FFFF          <1> 		call int302
  1885 000014F5 E943F9FFFF          <1> 		jmp nwcmd
  1886                              <1> 
  1887 000014FA 05046563686F00      <1> db 5,4,"echo",0
  1888 00001501 BE[701A0000]        <1> 	echo:	mov esi, buftxt
  1889 00001506 81C605000000        <1> 		add esi, 5
  1890 0000150C 8A06                <1> 		mov al, [esi]
  1891 0000150E 3C24                <1> 		cmp al, '$'
  1892 00001510 7414                <1> 		je echovr
  1893 00001512 E84EF6FFFF          <1> 		call print
  1894 00001517 BE[C0440000]        <1> 		mov esi, line
  1895 0000151C E844F6FFFF          <1> 		call print
  1896 00001521 E917F9FFFF          <1> 		jmp nwcmd
  1897 00001526 BB[6F150000]        <1> 	echovr:	mov ebx, variables
  1898 0000152B BF06000000          <1> 		mov edi, 6
  1899 00001530 E83A000000          <1> 		call nxtvrech
  1900 00001535 E957000000          <1> 		jmp prntvr2
  1901 0000153A B13D                <1> 	echvar:	mov cl, '='
  1902 0000153C 43                  <1> 		inc ebx
  1903 0000153D 8A03                <1> 		mov al, [ebx]
  1904 0000153F 3C00                <1> 		cmp al, 0
  1905 00001541 742C                <1> 		je nxtvrech
  1906 00001543 3C3D                <1> 		cmp al, '='
  1907 00001545 7420                <1> 		je nxtvrechb1
  1908 00001547 BE[701A0000]        <1> 		mov esi, buftxt
  1909 0000154C 01FE                <1> 		add esi, edi
  1910 0000154E E810FAFFFF          <1> 		call cndtest
  1911 00001553 3C02                <1> 		cmp al, 2
  1912 00001555 7436                <1> 		je prntvr
  1913 00001557 3C01                <1> 		cmp al, 1
  1914 00001559 7432                <1> 		je prntvr
  1915 0000155B BE[701A0000]        <1> 		mov esi, buftxt
  1916 00001560 01FE                <1> 		add esi, edi
  1917 00001562 E908000000          <1> 		jmp nxtvrech
  1918                              <1> 	nxtvrechb1:
  1919 00001567 81EB02000000        <1> 		sub ebx, 2
  1920 0000156D EBCB                <1> 		jmp echvar
  1921 0000156F 8A03                <1> 	nxtvrech: mov al, [ebx]
  1922 00001571 3C05                <1> 		cmp al, 5
  1923 00001573 740F                <1> 		je nxtvrec2
  1924 00001575 43                  <1> 		inc ebx
  1925 00001576 81FB[6F1A0000]      <1> 		cmp ebx, varend
  1926 0000157C 0F83BBF8FFFF        <1> 		jae nwcmd
  1927 00001582 EBEB                <1> 		jmp nxtvrech
  1928 00001584 43                  <1> 	nxtvrec2: inc ebx
  1929 00001585 8A03                <1> 		mov al, [ebx]
  1930 00001587 3C04                <1> 		cmp al, 4
  1931 00001589 74AF                <1> 		je echvar
  1932 0000158B EBE2                <1> 		jmp nxtvrech
  1933 0000158D 43                  <1> 	prntvr: inc ebx
  1934 0000158E 89DE                <1> 		mov esi, ebx
  1935 00001590 C3                  <1> 		ret
  1936 00001591 E8CFF5FFFF          <1> 	prntvr2: call print
  1937 00001596 BE[C0440000]        <1> 		mov esi, line
  1938 0000159B E8C5F5FFFF          <1> 		call print
  1939 000015A0 E998F8FFFF          <1> 		jmp nwcmd
  1940                              <1> 		
  1941                              <1> 
  1942 000015A5 05042300            <1> db 5,4,"#",0
  1943                              <1> 	num:	
  1944 000015A9 E8D8FAFFFF          <1> 		call clearbuffer
  1945 000015AE C605[65180000]00    <1> 		mov byte [decimal], 0
  1946 000015B5 C605[66180000]00    <1> 		mov byte [decimal2], 0
  1947 000015BC BE[701A0000]        <1> 		mov esi, buftxt
  1948 000015C1 B800000000          <1> 		mov eax, 0
  1949 000015C6 B900000000          <1> 		mov ecx, 0
  1950 000015CB BB00000000          <1> 		mov ebx, 0
  1951 000015D0 8A06                <1> 	num2:	mov al, [esi]
  1952 000015D2 3C2B                <1> 		cmp al, '+'
  1953 000015D4 741B                <1> 		je operatorfound
  1954 000015D6 3C2D                <1> 		cmp al, '-'
  1955 000015D8 7417                <1> 		je operatorfound
  1956 000015DA 3C2A                <1> 		cmp al, '*'
  1957 000015DC 7413                <1> 		je operatorfound
  1958 000015DE 3C2F                <1> 		cmp al, '/'
  1959 000015E0 740F                <1> 		je operatorfound
  1960 000015E2 3C5E                <1> 		cmp al, '^'
  1961 000015E4 740B                <1> 		je operatorfound
  1962 000015E6 46                  <1> 		inc esi
  1963 000015E7 3C00                <1> 		cmp al, 0
  1964 000015E9 0F844EF8FFFF        <1> 		je near nwcmd
  1965 000015EF EBDF                <1> 		jmp num2
  1966 000015F1 50                  <1> 	operatorfound: push eax
  1967 000015F2 B400                <1> 		mov ah, 0
  1968 000015F4 8826                <1> 		mov [esi], ah
  1969 000015F6 89F7                <1> 		mov edi, esi
  1970 000015F8 46                  <1> 		inc esi
  1971 000015F9 8A06                <1> 		mov al, [esi]
  1972 000015FB 3C24                <1> 		cmp al, '$'
  1973 000015FD 0F8481000000        <1> 		je near varnum1
  1974 00001603 3C25                <1> 		cmp al, '%'
  1975 00001605 0F8469000000        <1> 		je near resultnum1
  1976                              <1> 	varnum2: 
  1977 0000160B 57                  <1> 		push edi
  1978 0000160C E8C9000000          <1> 		call checkdecimal
  1979 00001611 5F                  <1> 		pop edi
  1980 00001612 E831FDFFFF          <1> 		call cnvrttxt
  1981                              <1> 	vrnm2:
  1982 00001617 89CB                <1> 		mov ebx, ecx
  1983 00001619 53                  <1> 		push ebx
  1984 0000161A E867FAFFFF          <1> 		call clearbuffer
  1985 0000161F BE[701A0000]        <1> 		mov esi, buftxt
  1986 00001624 89F7                <1> 		mov edi, esi
  1987 00001626 46                  <1> 		inc esi
  1988 00001627 8A06                <1> 		mov al, [esi]
  1989 00001629 3C24                <1> 		cmp al, '$'
  1990 0000162B 0F8474000000        <1> 		je near varnum3
  1991 00001631 3C25                <1> 		cmp al, '%'
  1992 00001633 0F8443000000        <1> 		je near resultnum2
  1993                              <1> 	varnum4: 
  1994 00001639 57                  <1> 		push edi
  1995 0000163A E887000000          <1> 		call checkdecimal2
  1996 0000163F 5F                  <1> 		pop edi
  1997 00001640 E803FDFFFF          <1> 		call cnvrttxt
  1998                              <1> 	vrnm4:
  1999 00001645 5B                  <1> 		pop ebx
  2000 00001646 58                  <1> 		pop eax
  2001 00001647 3C2B                <1> 		cmp al, '+'
  2002 00001649 0F84B9000000        <1> 		je near plusnum
  2003 0000164F 3C2D                <1> 		cmp al, '-'
  2004 00001651 0F84BD000000        <1> 		je near subnum
  2005 00001657 3C2A                <1> 		cmp al, '*'
  2006 00001659 0F84C1000000        <1> 		je near mulnum
  2007 0000165F 3C2F                <1> 		cmp al, '/'
  2008 00001661 0F84CF000000        <1> 		je near divnum
  2009 00001667 3C5E                <1> 		cmp al, '^'
  2010 00001669 0F84ED000000        <1> 		je near expnum
  2011 0000166F E9C9F7FFFF          <1> 		jmp nwcmd
  2012                              <1> 	resultnum1:
  2013 00001674 8B0D[67180000]      <1> 		mov ecx, [result]
  2014 0000167A EB9B                <1> 		jmp vrnm2
  2015                              <1> 	resultnum2:
  2016 0000167C 8B0D[67180000]      <1> 		mov ecx, [result]
  2017 00001682 EBC1                <1> 		jmp vrnm4
  2018 00001684 81EE[701A0000]      <1> 	varnum1: sub esi, buftxt
  2019 0000168A 89F7                <1> 		mov edi, esi
  2020 0000168C 81C6[701A0000]      <1> 		add esi, buftxt
  2021 00001692 47                  <1> 		inc edi
  2022 00001693 BB[6F150000]        <1> 		mov ebx, variables
  2023 00001698 E8D2FEFFFF          <1> 		call nxtvrech
  2024 0000169D 89F7                <1> 		mov edi, esi
  2025 0000169F 4F                  <1> 		dec edi
  2026 000016A0 E966FFFFFF          <1> 		jmp varnum2
  2027 000016A5 81EE[701A0000]      <1> 	varnum3: sub esi, buftxt
  2028 000016AB 89F7                <1> 		mov edi, esi
  2029 000016AD 81C6[701A0000]      <1> 		add esi, buftxt
  2030 000016B3 47                  <1> 		inc edi
  2031 000016B4 BB[6F150000]        <1> 		mov ebx, variables
  2032 000016B9 E8B1FEFFFF          <1> 		call nxtvrech
  2033 000016BE 89F7                <1> 		mov edi, esi
  2034 000016C0 4F                  <1> 		dec edi
  2035 000016C1 E973FFFFFF          <1> 		jmp varnum4
  2036                              <1> 	checkdecimal2:
  2037 000016C6 8A25[65180000]      <1> 		mov ah, [decimal]
  2038 000016CC 8825[66180000]      <1> 		mov [decimal2], ah
  2039 000016D2 B400                <1> 		mov ah, 0
  2040 000016D4 8825[65180000]      <1> 		mov [decimal], ah
  2041                              <1> 	checkdecimal:
  2042 000016DA 89F7                <1> 		mov edi, esi
  2043                              <1> 	chkdec1:
  2044 000016DC 8A07                <1> 		mov al, [edi]
  2045 000016DE 3C2E                <1> 		cmp al, '.'
  2046 000016E0 0F840B000000        <1> 		je near fnddec
  2047 000016E6 3C00                <1> 		cmp al, 0
  2048 000016E8 0F8419000000        <1> 		je near nodecimal
  2049 000016EE 47                  <1> 		inc edi
  2050 000016EF EBEB                <1> 		jmp chkdec1
  2051                              <1> 	fnddec:
  2052 000016F1 8A4701              <1> 		mov al, [edi + 1]
  2053 000016F4 8807                <1> 		mov [edi], al
  2054 000016F6 3C00                <1> 		cmp al, 0
  2055 000016F8 0F8409000000        <1> 		je near nodecimal
  2056 000016FE FE05[65180000]      <1> 		inc byte [decimal]
  2057 00001704 47                  <1> 		inc edi
  2058 00001705 EBEA                <1> 		jmp fnddec
  2059                              <1> 	nodecimal:
  2060 00001707 C3                  <1> 		ret
  2061                              <1> 	plusnum:
  2062 00001708 E816010000          <1> 		call decaddfix
  2063 0000170D 01D9                <1> 		add ecx, ebx
  2064 0000170F E991000000          <1> 		jmp retnum
  2065                              <1> 	subnum:
  2066 00001714 E80A010000          <1> 		call decaddfix
  2067 00001719 29D9                <1> 		sub ecx, ebx
  2068 0000171B E985000000          <1> 		jmp retnum
  2069                              <1> 	mulnum:
  2070 00001720 A0[66180000]        <1> 		mov al, [decimal2]
  2071 00001725 0005[65180000]      <1> 		add [decimal], al
  2072 0000172B 89C8                <1> 		mov eax, ecx
  2073 0000172D F7E3                <1> 		mul ebx
  2074 0000172F 89C1                <1> 		mov ecx, eax
  2075 00001731 E96F000000          <1> 		jmp retnum
  2076                              <1> 	divnum:
  2077 00001736 E8E8000000          <1> 		call decaddfix
  2078 0000173B B000                <1> 		mov al, 0
  2079 0000173D A2[65180000]        <1> 		mov [decimal], al
  2080 00001742 6689C8              <1> 		mov ax, cx
  2081 00001745 80FB00              <1> 		cmp bl, 0
  2082 00001748 0F8457000000        <1> 		je near retnum
  2083 0000174E F6F3                <1> 		div bl
  2084 00001750 B900000000          <1> 		mov ecx, 0
  2085 00001755 88C1                <1> 		mov cl, al
  2086 00001757 E949000000          <1> 		jmp retnum
  2087                              <1> 	expnum:
  2088 0000175C 8A15[65180000]      <1> 		mov dl, [decimal]
  2089 00001762 8815[66180000]      <1> 		mov [decimal2], dl
  2090 00001768 BA00000000          <1> 		mov edx, 0
  2091 0000176D 89C8                <1> 		mov eax, ecx
  2092 0000176F 89D9                <1> 		mov ecx, ebx
  2093 00001771 89C3                <1> 		mov ebx, eax
  2094 00001773 81F900000000        <1> 		cmp ecx, 0
  2095 00001779 7425                <1> 		je noexpnum
  2096 0000177B 49                  <1> 		dec ecx
  2097 0000177C 81F900000000        <1> 		cmp ecx, 0
  2098 00001782 7415                <1> 		je noexpnumlp
  2099 00001784 F7E3                <1> 	expnumlp: mul ebx
  2100 00001786 8A15[66180000]      <1> 		mov dl, [decimal2]
  2101 0000178C 0015[65180000]      <1> 		add [decimal], dl
  2102 00001792 BA00000000          <1> 		mov edx, 0
  2103 00001797 E2EB                <1> 		loop expnumlp
  2104                              <1> 	noexpnumlp:
  2105 00001799 89C1                <1> 		mov ecx, eax
  2106 0000179B E905000000          <1> 		jmp retnum
  2107                              <1> 	noexpnum:
  2108 000017A0 B901000000          <1> 		mov ecx, 1
  2109                              <1> 	retnum: 
  2110 000017A5 BE[841C0000]        <1> 		mov esi, numbuf
  2111 000017AA 890D[67180000]      <1> 		mov [result], ecx
  2112 000017B0 E8E6F8FFFF          <1> 		call convert
  2113 000017B5 BE[841C0000]        <1> 		mov esi, numbuf
  2114 000017BA 8A25[65180000]      <1> 		mov ah, [decimal]
  2115 000017C0 80FC00              <1> 		cmp ah, 0
  2116 000017C3 0F8425000000        <1> 		je near noputdecimal
  2117                              <1> 	putdecimal:
  2118 000017C9 4E                  <1> 		dec esi
  2119 000017CA FECC                <1> 		dec ah
  2120 000017CC 80FC00              <1> 		cmp ah, 0
  2121 000017CF 0F87F4FFFFFF        <1> 		ja near putdecimal
  2122 000017D5 4E                  <1> 		dec esi
  2123 000017D6 8A06                <1> 		mov al, [esi]
  2124 000017D8 C6062E              <1> 		mov byte [esi], '.'
  2125                              <1> 	decputloop:
  2126 000017DB 4E                  <1> 		dec esi
  2127 000017DC 8A26                <1> 		mov ah, [esi]
  2128 000017DE 8806                <1> 		mov [esi], al
  2129 000017E0 88E0                <1> 		mov al, ah
  2130 000017E2 81FE[701C0000]      <1> 		cmp esi, buf2
  2131 000017E8 0F87EDFFFFFF        <1> 		ja near decputloop
  2132                              <1> 	noputdecimal:
  2133 000017EE BE[701C0000]        <1> 		mov esi, buf2
  2134 000017F3 E809000000          <1> 		call chkadd
  2135 000017F8 E940F6FFFF          <1> 		jmp nwcmd
  2136 000017FD 00000000            <1> edxnumbuf dw 0,0
  2137 00001801 8A06                <1> 	chkadd: mov al, [esi]
  2138 00001803 3C30                <1> 		cmp al, '0'
  2139 00001805 750C                <1> 		jne dnadd
  2140 00001807 46                  <1> 		inc esi
  2141 00001808 81FE[841C0000]      <1> 		cmp esi, numbuf
  2142 0000180E 7402                <1> 		je dnaddm1
  2143 00001810 EBEF                <1> 		jmp chkadd
  2144 00001812 4E                  <1> 	dnaddm1: dec esi
  2145 00001813 E84DF3FFFF          <1> 	dnadd:	call print
  2146 00001818 BE[C0440000]        <1> 		mov esi, line
  2147 0000181D E843F3FFFF          <1> 		call print
  2148 00001822 C3                  <1> 		ret
  2149                              <1> 		
  2150                              <1> 	decaddfix:
  2151 00001823 A0[66180000]        <1> 		mov al, [decimal2]
  2152 00001828 8A25[65180000]      <1> 		mov ah, [decimal]
  2153 0000182E 38E0                <1> 		cmp al, ah
  2154 00001830 7432                <1> 		je gooddecadd
  2155 00001832 38E0                <1> 		cmp al, ah
  2156 00001834 721A                <1> 		jb lowdecadd
  2157                              <1> 	highdecadd:
  2158 00001836 FEC4                <1> 		inc ah
  2159 00001838 89CA                <1> 		mov edx, ecx
  2160 0000183A C1E103              <1> 		shl ecx, 3
  2161 0000183D 01D1                <1> 		add ecx, edx
  2162 0000183F 01D1                <1> 		add ecx, edx
  2163 00001841 38E0                <1> 		cmp al, ah
  2164 00001843 77F1                <1> 		ja highdecadd
  2165 00001845 8825[65180000]      <1> 		mov [decimal], ah
  2166 0000184B E914000000          <1> 		jmp gooddecadd
  2167                              <1> 	lowdecadd:
  2168 00001850 FEC0                <1> 		inc al
  2169 00001852 89DA                <1> 		mov edx, ebx
  2170 00001854 C1E303              <1> 		shl ebx, 3
  2171 00001857 01D3                <1> 		add ebx, edx
  2172 00001859 01D3                <1> 		add ebx, edx
  2173 0000185B 38E0                <1> 		cmp al, ah
  2174 0000185D 72F1                <1> 		jb lowdecadd
  2175 0000185F A2[65180000]        <1> 		mov [decimal], al
  2176                              <1> 	gooddecadd:
  2177 00001864 C3                  <1> 		ret
  2178                              <1> 		
  2179 00001865 00                  <1> decimal db 0
  2180 00001866 00                  <1> decimal2 db 0
  2181 00001867 00000000            <1> result db 0,0,0,0
  2182                              <1> 	
  2183 0000186B 05042500            <1> db 5,4,"%",0
  2184 0000186F E812F8FFFF          <1> 	ans:	call clearbuffer
  2185 00001874 8B0D[67180000]      <1> 		mov ecx, [result]
  2186 0000187A BE[701C0000]        <1> 		mov esi, buf2
  2187 0000187F E817F8FFFF          <1> 		call convert
  2188 00001884 BE[701C0000]        <1> 		mov esi, buf2
  2189 00001889 E873FFFFFF          <1> 		call chkadd
  2190 0000188E E9AAF5FFFF          <1> 		jmp nwcmd
  2191                              <1> 
  2192 00001893 05042400            <1> db 5,4,"$",0
  2193 00001897 BE[701A0000]        <1> var:	mov esi, buftxt
  2194 0000189C BB[6F150000]        <1> 	mov ebx, variables
  2195 000018A1 8A06                <1> lkeq:	mov al, [esi]
  2196 000018A3 3C3D                <1> 	cmp al, '='
  2197 000018A5 741F                <1> 	je eqfnd	;is there an '=' sign?
  2198 000018A7 3C00                <1> 	cmp al, 0
  2199 000018A9 7403                <1> 	je echovars
  2200 000018AB 46                  <1> 	inc esi
  2201 000018AC EBF3                <1> 	jmp lkeq
  2202 000018AE BE[6F150000]        <1> echovars: mov esi, variables
  2203 000018B3 BB[6F1A0000]        <1> 	mov ebx, varend
  2204 000018B8 B105                <1> 	mov cl, 5
  2205 000018BA B504                <1> 	mov ch, 4
  2206 000018BC E864F7FFFF          <1> 	call array
  2207 000018C1 E977F5FFFF          <1> 	jmp nwcmd
  2208 000018C6 46                  <1> eqfnd:	inc esi
  2209 000018C7 8A06                <1> 	mov al, [esi]
  2210 000018C9 3C00                <1> 	cmp al, 0
  2211 000018CB 740F                <1> 	je readvar
  2212 000018CD BE[701A0000]        <1> 	mov esi, buftxt
  2213 000018D2 BB[6F150000]        <1> 	mov ebx, variables
  2214 000018D7 E917000000          <1> 	jmp seek
  2215                              <1> readvar: 
  2216 000018DC B00D                <1> 	mov al, 13
  2217 000018DE B404                <1> 	mov ah, 4
  2218 000018E0 B307                <1> 	mov bl, 7
  2219 000018E2 E875F0FFFF          <1> 	call intx4
  2220 000018E7 BE[C0440000]        <1> 	mov esi, line
  2221 000018EC E874F2FFFF          <1> 	call print
  2222 000018F1 EBA4                <1> 	jmp var
  2223 000018F3 668B03              <1> seek:	mov ax, [ebx]
  2224 000018F6 B105                <1> 	mov cl, 5
  2225 000018F8 B504                <1> 	mov ch, 4
  2226 000018FA 663D0000            <1> 	cmp ax, 0
  2227 000018FE 0F8459000000        <1> 	je near save
  2228 00001904 6639C8              <1> 	cmp ax, cx
  2229 00001907 7403                <1> 	je skfnd
  2230 00001909 43                  <1> 	inc ebx
  2231 0000190A EBE7                <1> 	jmp seek
  2232 0000190C BE[701A0000]        <1> skfnd:	mov esi, buftxt
  2233 00001911 46                  <1> 	inc esi
  2234 00001912 81C302000000        <1> 	add ebx, 2
  2235 00001918 89DF                <1> 	mov edi, ebx
  2236 0000191A B13D                <1> 	mov cl, '='
  2237 0000191C E842F6FFFF          <1> 	call cndtest
  2238 00001921 3C01                <1> 	cmp al, 1	
  2239 00001923 7417                <1> 	je varfnd
  2240 00001925 89FB                <1> 	mov ebx, edi
  2241 00001927 BE[701A0000]        <1> 	mov esi, buftxt
  2242 0000192C 668B03              <1> 	mov ax, [ebx]
  2243 0000192F 663D0000            <1> 	cmp ax, 0
  2244 00001933 0F8424000000        <1> 	je near save
  2245 00001939 43                  <1> 	inc ebx
  2246 0000193A EBB7                <1> 	jmp seek
  2247 0000193C 8A03                <1> varfnd:	mov al, [ebx]
  2248 0000193E 3C04                <1> 	cmp al, 4
  2249 00001940 7404                <1> 	je save2
  2250 00001942 4B                  <1> 	dec ebx
  2251 00001943 4E                  <1> 	dec esi
  2252 00001944 EBF6                <1> 	jmp varfnd
  2253 00001946 4B                  <1> save2:	dec ebx
  2254 00001947 4E                  <1> 	dec esi
  2255 00001948 8A03                <1> 	mov al, [ebx]
  2256 0000194A 3C05                <1> 	cmp al, 5
  2257 0000194C 7402                <1> 	je remove
  2258 0000194E EBEC                <1> 	jmp varfnd
  2259 00001950 8A03                <1> remove: mov al, [ebx]
  2260 00001952 3C00                <1> 	cmp al, 0
  2261 00001954 749D                <1> 	je seek
  2262 00001956 B000                <1> 	mov al, 0
  2263 00001958 8803                <1> 	mov [ebx], al
  2264 0000195A 43                  <1> 	inc ebx
  2265 0000195B EBF3                <1> 	jmp remove	;do not need for now-need defragmentation
  2266 0000195D BE[701A0000]        <1> save:	mov esi, buftxt
  2267 00001962 43                  <1> 	inc ebx
  2268 00001963 B005                <1> 	mov al, 5
  2269 00001965 B404                <1> 	mov ah, 4
  2270 00001967 668903              <1> 	mov [ebx], ax
  2271 0000196A 43                  <1> 	inc ebx
  2272 0000196B 43                  <1> svhere:	inc ebx
  2273 0000196C 46                  <1> 	inc esi
  2274 0000196D 8A06                <1> 	mov al, [esi]
  2275 0000196F 3C00                <1> 	cmp al, 0
  2276 00001971 0F8442000000        <1> 	je near svdone
  2277 00001977 3C25                <1> 	cmp al, '%'
  2278 00001979 7404                <1> 	je ans2
  2279 0000197B 8803                <1> 	mov [ebx], al	
  2280 0000197D EBEC                <1> 	jmp svhere
  2281 0000197F 56                  <1> ans2:	push esi
  2282 00001980 BE[701C0000]        <1> 	mov esi, buf2
  2283 00001985 E823000000          <1> 	call ansfnd
  2284 0000198A E803000000          <1> 	call anscp
  2285 0000198F 5E                  <1> 	pop esi
  2286 00001990 EBD9                <1> 	jmp svhere
  2287 00001992 8A06                <1> anscp:	mov al, [esi]
  2288 00001994 8803                <1> 	mov [ebx], al
  2289 00001996 81FE[841C0000]      <1> 	cmp esi, numbuf
  2290 0000199C 74CD                <1> 	je svhere
  2291 0000199E 3C00                <1> 	cmp al, 0
  2292 000019A0 74C9                <1> 	je svhere
  2293 000019A2 43                  <1> 	inc ebx
  2294 000019A3 46                  <1> 	inc esi
  2295 000019A4 EBEC                <1> 	jmp anscp
  2296 000019A6 5E                  <1> ansnf:	pop esi
  2297 000019A7 8A06                <1> 	mov al, [esi]
  2298 000019A9 8803                <1> 	mov [ebx], al
  2299 000019AB EBBE                <1> 	jmp svhere
  2300 000019AD 46                  <1> ansfnd:	inc esi
  2301 000019AE 8A06                <1> 	mov al, [esi]
  2302 000019B0 3C00                <1> 	cmp al, 0
  2303 000019B2 74F2                <1> 	je ansnf
  2304 000019B4 3C30                <1> 	cmp al, '0'
  2305 000019B6 74F5                <1> 	je ansfnd
  2306 000019B8 C3                  <1> 	ret
  2307 000019B9 B000                <1> svdone:	mov al, 0
  2308 000019BB 8803                <1> 	mov [ebx], al
  2309 000019BD E97BF4FFFF          <1> 	jmp nwcmd
  2310                              <1> 	
  2311 000019C2 05046C6F676F757400  <1> 	db 5,4,"logout",0
  2312                              <1> logout
  2313 000019CB E95BF3FFFF          <1> 	jmp os
  2314                              <1> 	
  2315                              <1> 	
  2316 000019D0 05042E2F00          <1> 	db 5,4,"./",0
  2317                              <1> rundiskprog:
  2318 000019D5 BF[701A0000]        <1> 	mov edi, buftxt
  2319 000019DA 81C702000000        <1> 	add edi, 2
  2320 000019E0 BE00001000          <1> 	mov esi, 0x100000
  2321 000019E5 E86B280000          <1> 	call loadfile
  2322 000019EA 81FA94010000        <1> 	cmp edx, 404
  2323 000019F0 7414                <1> 	je noprogfound
  2324 000019F2 BB00001000          <1> 	mov ebx, 0x100000
  2325 000019F7 66813B4558          <1> 	cmp word [ebx], "EX"
  2326 000019FC 7531                <1> 	jne progbatchfound
  2327 000019FE 81C302000000        <1> 	add ebx, 2
  2328 00001A04 FFE3                <1> 	jmp ebx
  2329                              <1> noprogfound:
  2330 00001A06 BE[87440000]        <1> 	mov esi, notfound1
  2331 00001A0B E855F1FFFF          <1> 	call print
  2332 00001A10 BE[701A0000]        <1> 	mov esi, buftxt
  2333 00001A15 81C602000000        <1> 	add esi, 2
  2334 00001A1B E845F1FFFF          <1> 	call print
  2335 00001A20 BE[91440000]        <1> 	mov esi, notfound2
  2336 00001A25 E83BF1FFFF          <1> 	call print
  2337 00001A2A E90EF4FFFF          <1> 	jmp nwcmd
  2338                              <1> progbatchfound:
  2339 00001A2F BF00001000          <1> 		mov edi, 0x100000
  2340 00001A34 C605[69130000]01    <1> 		mov byte [BATCHISON], 1
  2341                              <1> 	batchrunloop:
  2342 00001A3B E8DAF3FFFF          <1> 		call buftxtclear
  2343 00001A40 BE[701A0000]        <1> 		mov esi, buftxt
  2344                              <1> 	batchrunloop2:
  2345 00001A45 B10D                <1> 		mov cl, 13
  2346 00001A47 B50A                <1> 		mov ch, 10
  2347 00001A49 66390F              <1> 		cmp [edi], cx
  2348 00001A4C 0F841E000000        <1> 		je near nxtbatchrunline
  2349 00001A52 66C1C108            <1> 		rol cx, 8
  2350 00001A56 66390F              <1> 		cmp [edi], cx
  2351 00001A59 0F8411000000        <1> 		je near nxtbatchrunline
  2352 00001A5F 803F00              <1> 		cmp byte [edi], 0
  2353 00001A62 0F8408000000        <1> 		je near nxtbatchrunline
  2354 00001A68 8A07                <1> 		mov al, [edi]
  2355 00001A6A 8806                <1> 		mov [esi], al
  2356 00001A6C 46                  <1> 		inc esi
  2357 00001A6D 47                  <1> 		inc edi
  2358 00001A6E EBD5                <1> 		jmp batchrunloop2
  2359                              <1> 	nxtbatchrunline:
  2360 00001A70 81C702000000        <1> 		add edi, 2
  2361 00001A76 893D[D51A0000]      <1> 		mov [batchedi], edi
  2362 00001A7C C60600              <1> 		mov byte [esi], 0
  2363 00001A7F BE[701A0000]        <1> 		mov esi, buftxt
  2364 00001A84 803E00              <1> 		cmp byte [esi], 0
  2365 00001A87 0F843C000000        <1> 		je near nobatchfoundrun
  2366 00001A8D BB00000000          <1> 		mov ebx, 0
  2367 00001A92 8A1D[00130000]      <1> 		mov bl, [IFON]
  2368 00001A98 80FB01              <1> 		cmp bl, 1
  2369 00001A9B 0F8338000000        <1> 		jae near iftestbatch
  2370                              <1> 	doneiftest:
  2371 00001AA1 803D[9C1B0000]00    <1> 		cmp byte [runnextline], 0
  2372 00001AA8 0F8405000000        <1> 		je near noruniftest
  2373 00001AAE E8FBF3FFFF          <1> 		call progtest
  2374                              <1> 	noruniftest:
  2375 00001AB3 C605[9C1B0000]01    <1> 		mov byte [runnextline], 1
  2376 00001ABA 8B3D[D51A0000]      <1> 		mov edi, [batchedi]
  2377 00001AC0 803F00              <1> 		cmp byte [edi], 0
  2378 00001AC3 0F8572FFFFFF        <1> 		jne near batchrunloop
  2379                              <1> 	nobatchfoundrun:
  2380 00001AC9 C605[69130000]00    <1> 		mov byte [BATCHISON], 0
  2381 00001AD0 E968F3FFFF          <1> 		jmp nwcmd
  2382                              <1> 	
  2383 00001AD5 00000000            <1> batchedi dd 0	
  2384                              <1> 	
  2385                              <1> 	iftestbatch:
  2386 00001AD9 BE[01130000]        <1> 		mov esi, IFTRUE
  2387 00001ADE 01DE                <1> 		add esi, ebx
  2388 00001AE0 803E00              <1> 		cmp byte [esi], 0
  2389 00001AE3 0F85B8FFFFFF        <1> 		jne near doneiftest
  2390 00001AE9 881D[9D1B0000]      <1> 		mov [iffalsebuf], bl
  2391 00001AEF 803D[6A130000]01    <1> 		cmp byte [LOOPON], 1
  2392 00001AF6 750B                <1> 		jne fifindbatch
  2393 00001AF8 8B3D[6B130000]      <1> 		mov edi, [LOOPPOS]
  2394 00001AFE E938FFFFFF          <1> 		jmp batchrunloop
  2395                              <1> 	fifindbatch:
  2396 00001B03 66B96966            <1> 		mov cx, "if"
  2397 00001B07 66B86669            <1> 		mov ax, "fi"
  2398 00001B0B 663907              <1> 		cmp [edi], ax
  2399 00001B0E 0F841A000000        <1> 		je near fifoundbatch
  2400 00001B14 66390F              <1> 		cmp [edi], cx
  2401 00001B17 0F8462000000        <1> 		je near iffoundbatch
  2402 00001B1D 803F00              <1> 		cmp byte [edi], 0
  2403 00001B20 0F8408000000        <1> 		je near fifoundbatch
  2404 00001B26 81C702000000        <1> 		add edi, 2
  2405 00001B2C EBD5                <1> 		jmp fifindbatch
  2406                              <1> 	fifoundbatch:
  2407 00001B2E 81C702000000        <1> 		add edi, 2
  2408 00001B34 B00D                <1> 		mov al, 13
  2409 00001B36 B40A                <1> 		mov ah, 10
  2410 00001B38 663907              <1> 		cmp [edi], ax
  2411 00001B3B 7414                <1> 		je goodfibatch
  2412 00001B3D 66C1C008            <1> 		rol ax, 8
  2413 00001B41 663907              <1> 		cmp [edi], ax
  2414 00001B44 740B                <1> 		je goodfibatch
  2415 00001B46 803F00              <1> 		cmp byte [edi], 0
  2416 00001B49 0F847AFFFFFF        <1> 		je near nobatchfoundrun
  2417 00001B4F EBB2                <1> 		jmp fifindbatch
  2418                              <1> 	goodfibatch:
  2419 00001B51 B001                <1> 		mov al, 1
  2420 00001B53 2805[00130000]      <1> 		sub [IFON], al 
  2421 00001B59 A0[00130000]        <1> 		mov al, [IFON]
  2422 00001B5E 8A1D[9D1B0000]      <1> 		mov bl, [iffalsebuf]
  2423 00001B64 38D8                <1> 		cmp al, bl
  2424 00001B66 779B                <1> 		ja fifindbatch
  2425 00001B68 BE[701A0000]        <1> 		mov esi, buftxt
  2426 00001B6D 81EF02000000        <1> 		sub edi, 2
  2427 00001B73 C605[9C1B0000]00    <1> 		mov byte [runnextline], 0
  2428 00001B7A E9BCFEFFFF          <1> 		jmp batchrunloop
  2429                              <1> 	iffoundbatch:
  2430 00001B7F B020                <1> 		mov al, ' '
  2431 00001B81 81C702000000        <1> 		add edi, 2
  2432 00001B87 3807                <1> 		cmp [edi], al
  2433 00001B89 0F8574FFFFFF        <1> 		jne near fifindbatch
  2434 00001B8F B001                <1> 		mov al, 1
  2435 00001B91 0005[00130000]      <1> 		add [IFON], al
  2436 00001B97 E967FFFFFF          <1> 		jmp fifindbatch
  2437                              <1> 		
  2438                              <1> 		
  2439 00001B9C 01                  <1> runnextline db 1
  2440 00001B9D 00                  <1> iffalsebuf db 0
  2441                              <1> 
  2442 00001B9E E99AF2FFFF          <1> notbatch: jmp nwcmd
  2443                              <1> 
  2444 00001BA3 05047768696C6500    <1> 	db 5,4,"while",0
  2445 00001BAB B000                <1> while:  mov al, 0
  2446 00001BAD 3805[69130000]      <1> 	cmp [BATCHISON], al
  2447 00001BB3 0F84E5FFFFFF        <1> 	je near notbatch
  2448 00001BB9 8B35[65130000]      <1> 	MOV esi, [BATCHPOS]
  2449 00001BBF 4E                  <1> whilefnd: dec esi
  2450 00001BC0 8A06                <1> 	mov al, [esi]
  2451 00001BC2 3C0A                <1> 	cmp al, 10
  2452 00001BC4 0F8412000000        <1> 	je near whilefnd2
  2453 00001BCA 3C0D                <1> 	cmp al, 13
  2454 00001BCC 0F840A000000        <1> 	je near whilefnd2
  2455 00001BD2 3C00                <1> 	cmp al, 0
  2456 00001BD4 0F8402000000        <1> 	je near whilefnd2
  2457 00001BDA EBE3                <1> 	jmp whilefnd
  2458                              <1> whilefnd2:
  2459 00001BDC 8935[6B130000]      <1> 	mov [LOOPPOS], esi
  2460 00001BE2 C605[6A130000]01    <1> 	mov BYTE [LOOPON], 1
  2461 00001BE9 0005[00130000]      <1> 	add [IFON], al
  2462 00001BEF BE[701A0000]        <1> 	mov esi, buftxt
  2463 00001BF4 BB[701A0000]        <1> 	mov ebx, buftxt
  2464 00001BF9 81C306000000        <1> 	add ebx, 6
  2465 00001BFF E923000000          <1> 	jmp chkeqsn
  2466                              <1> 
  2467                              <1> 
  2468 00001C04 0504696600          <1> 	db 5,4,"if",0
  2469 00001C09 B000                <1> if:	mov al, 0
  2470 00001C0B 3805[69130000]      <1> 	cmp [BATCHISON], al
  2471 00001C11 0F8487FFFFFF        <1> 	je near notbatch
  2472 00001C17 BE[701A0000]        <1> 	mov esi, buftxt
  2473 00001C1C BB[701A0000]        <1> 	mov ebx, buftxt
  2474 00001C21 81C303000000        <1> 	add ebx, 3
  2475 00001C27 8A06                <1> chkeqsn: mov al, [esi]
  2476 00001C29 3C00                <1> 	cmp al, 0
  2477 00001C2B 0F846DFFFFFF        <1> 	je near notbatch
  2478 00001C31 3C3D                <1> 	cmp al, '='
  2479 00001C33 0F8403000000        <1> 	je near chkeqdn
  2480 00001C39 46                  <1> 	inc esi
  2481 00001C3A EBEB                <1> 	jmp chkeqsn
  2482 00001C3C B000                <1> chkeqdn: mov al, 0 
  2483 00001C3E 8806                <1> 	mov [esi], al
  2484 00001C40 46                  <1> 	inc esi
  2485 00001C41 8A06                <1> 	mov al, [esi]
  2486 00001C43 3C24                <1> 	cmp al, '$'
  2487 00001C45 0F8462000000        <1> 	je near ifvar1
  2488 00001C4B 8A03                <1> ifvar2: mov al, [ebx]
  2489 00001C4D 3C24                <1> 	cmp al, '$'
  2490 00001C4F 0F847B000000        <1> 	je near ifvar3
  2491 00001C55 E8CFF2FFFF          <1> ifvar4:	call tester
  2492 00001C5A 3C01                <1> 	cmp al, 1
  2493 00001C5C 0F8405000000        <1> 	je near trueif
  2494 00001C62 E923000000          <1> 	jmp falseif
  2495 00001C67 B800000000          <1> trueif:	mov eax, 0
  2496 00001C6C A0[00130000]        <1> 	mov al, [IFON]
  2497 00001C71 FEC0                <1> 	inc al
  2498 00001C73 A2[00130000]        <1> 	mov [IFON], al
  2499 00001C78 B400                <1> 	mov ah, 0
  2500 00001C7A BE[01130000]        <1> 	mov esi, IFTRUE
  2501 00001C7F 01C6                <1> 	add esi, eax
  2502 00001C81 B401                <1> 	mov ah, 1
  2503 00001C83 8826                <1> 	mov [esi], ah
  2504 00001C85 E9B3F1FFFF          <1> 	jmp nwcmd
  2505 00001C8A B800000000          <1> falseif: mov eax, 0
  2506 00001C8F A0[00130000]        <1> 	mov al, [IFON]
  2507 00001C94 FEC0                <1> 	inc al
  2508 00001C96 A2[00130000]        <1> 	mov [IFON], al
  2509 00001C9B B400                <1> 	mov ah, 0
  2510 00001C9D BE[01130000]        <1> 	mov esi, IFTRUE
  2511 00001CA2 01C6                <1> 	add esi, eax
  2512 00001CA4 B400                <1> 	mov ah, 0
  2513 00001CA6 8826                <1> 	mov [esi], ah
  2514 00001CA8 E990F1FFFF          <1> 	jmp nwcmd
  2515 00001CAD 89F7                <1> ifvar1: mov edi, esi
  2516 00001CAF 81EF[701A0000]      <1> 	sub edi, buftxt
  2517 00001CB5 47                  <1> 	inc edi
  2518 00001CB6 BB[6F150000]        <1> 	mov ebx, variables
  2519 00001CBB E8AFF8FFFF          <1> 	call nxtvrech
  2520 00001CC0 BB[701A0000]        <1> 	mov ebx, buftxt
  2521 00001CC5 81C303000000        <1> 	add ebx, 3
  2522 00001CCB E97BFFFFFF          <1> 	jmp ifvar2
  2523 00001CD0 8935[F01C0000]      <1> ifvar3: mov [esiif], esi
  2524 00001CD6 BF04000000          <1> 	mov edi, 4
  2525 00001CDB BB[6F150000]        <1> 	mov ebx, variables
  2526 00001CE0 E88AF8FFFF          <1> 	call nxtvrech
  2527 00001CE5 8B35[F01C0000]      <1> 	mov esi, [esiif]
  2528 00001CEB E965FFFFFF          <1> 	jmp ifvar4
  2529                              <1> 
  2530 00001CF0 00000000            <1> esiif dd 0
  2531                              <1> 	
  2532 00001CF4 0504656C736500      <1> 	db 5,4,"else",0
  2533 00001CFB B800000000          <1> else:	mov eax, 0
  2534 00001D00 A0[00130000]        <1> 	mov al, [IFON]
  2535 00001D05 BE[01130000]        <1> 	mov esi, IFTRUE
  2536 00001D0A 01C6                <1> 	add esi, eax
  2537 00001D0C 8A06                <1> 	mov al, [esi]
  2538 00001D0E 3C00                <1> 	cmp al, 0		
  2539 00001D10 7409                <1> 	je else1
  2540 00001D12 3C01                <1> 	cmp al, 1
  2541 00001D14 740E                <1> 	je else2
  2542 00001D16 E922F1FFFF          <1> 	jmp nwcmd
  2543 00001D1B B001                <1> else1:  mov al, 1
  2544 00001D1D 8806                <1> 	mov [esi], al
  2545 00001D1F E919F1FFFF          <1> 	jmp nwcmd
  2546 00001D24 B000                <1> else2:	mov al, 0
  2547 00001D26 8806                <1> 	mov [esi], al
  2548 00001D28 E910F1FFFF          <1> 	jmp nwcmd
  2549                              <1> 
  2550 00001D2D 05046C6F6F7000      <1> 	db 5,4,"loop",0
  2551 00001D34 3805[6A130000]      <1> 	cmp [LOOPON], al
  2552 00001D3A 0F8405000000        <1> 	je near filoop
  2553 00001D40 E9F8F0FFFF          <1> 	jmp nwcmd
  2554 00001D45 8B35[6B130000]      <1> filoop: mov esi, [LOOPPOS]
  2555 00001D4B 8935[65130000]      <1> 	mov [BATCHPOS], esi
  2556 00001D51 E9E7F0FFFF          <1> 	jmp nwcmd
  2557                              <1> 	
  2558                              <1> 
  2559 00001D56 0504666900          <1> 	db 5,4,"fi",0
  2560 00001D5B B000                <1> 	mov al, 0
  2561 00001D5D 3805[69130000]      <1> 	cmp [BATCHISON], al
  2562 00001D63 0F8435FEFFFF        <1> 	je near notbatch
  2563 00001D69 B001                <1> fi:	mov al, 1
  2564 00001D6B 2805[00130000]      <1> 	sub [IFON],al
  2565 00001D71 E9C7F0FFFF          <1> 	jmp nwcmd
  2566                              <1> 
  2567 00001D76 050473746F7000      <1> 	db 5,4,"stop",0
  2568 00001D7D B000                <1> stop:	mov al, 0
  2569 00001D7F A2[69130000]        <1> 	mov [BATCHISON], al
  2570 00001D84 A2[00130000]        <1> 	mov [IFON], al
  2571 00001D89 A2[01130000]        <1> 	mov [IFTRUE], al
  2572 00001D8E A2[6A130000]        <1> 	mov [LOOPON], al
  2573 00001D93 E9A5F0FFFF          <1> 	jmp nwcmd
  2574                                      %include 'source/programs.asm'
  2575                              <1> ;db 5,4,"internet",0
  2576                              <1> 	internettest: 			;;initialize network card, lets hope this is right
  2577                              <1> 							;;^^used to^^, now tests int 30h functions		
  2578 00001D98 B403                <1> 		mov ah, 3
  2579 00001D9A CD30                <1> 		int 30h
  2580 00001D9C B401                <1> 		mov ah, 1
  2581                              <1> 		;mov esi, datmsg
  2582 00001D9E 66BB0700            <1> 		mov bx, 7
  2583 00001DA2 B000                <1> 		mov al, 0
  2584 00001DA4 CD30                <1> 		int 30h
  2585                              <1> 	    ;jmp packettest
  2586 00001DA6 E992F0FFFF          <1> 		jmp nwcmd
  2587                              <1> ;datmsg: db "Internet has not been implemented yet.",10,13,0
  2588                              <1> 		
  2589 00001DAB 050470636900        <1> db 5,4,"pci",0
  2590                              <1> 	pcishow:
  2591 00001DB1 E8E5220000          <1> 	call pcidump
  2592 00001DB6 E982F0FFFF          <1> 	jmp nwcmd
  2593                              <1> 	
  2594 00001DBB 050461727000        <1> db 5,4,"arp",0
  2595 00001DC1 E8DA210000          <1> 	call arptest
  2596 00001DC6 E972F0FFFF          <1> 	jmp nwcmd
  2597                              <1> 
  2598 00001DCB 0504626174636800    <1> db 5,4,"batch",0
  2599                              <1> 	batchst: 
  2600 00001DD3 BF[701A0000]        <1> 		mov edi, buftxt
  2601 00001DD8 81C706000000        <1> 		add edi, 6
  2602 00001DDE 803F00              <1> 		cmp byte [edi], 0
  2603 00001DE1 0F8473000000        <1> 		je near nonamefound
  2604 00001DE7 BE00001000          <1> 		mov esi, 0x100000
  2605 00001DEC E864240000          <1> 		call loadfile
  2606 00001DF1 89D0                <1> 		mov eax, edx
  2607 00001DF3 3D94010000          <1> 		cmp eax, 404
  2608 00001DF8 746F                <1> 		je goodbatchname
  2609 00001DFA BE[091E0000]        <1> 		mov esi, badbatchname
  2610 00001DFF E861EDFFFF          <1> 		call print
  2611 00001E04 E934F0FFFF          <1> 		jmp nwcmd
  2612 00001E09 546869732066696C65- <1> 		badbatchname db "This file already exists!",10,13,0
  2613 00001E12 20616C726561647920- <1>
  2614 00001E1B 657869737473210A0D- <1>
  2615 00001E24 00                  <1>
  2616 00001E25 596F75206861766520- <1> 		namenotfoundbatch db "You have to type a name after the command.",10,13,0
  2617 00001E2E 746F20747970652061- <1>
  2618 00001E37 206E616D6520616674- <1>
  2619 00001E40 65722074686520636F- <1>
  2620 00001E49 6D6D616E642E0A0D00  <1>
  2621 00001E52 00000000            <1> 		esicache3 dd 0
  2622 00001E56 00000000            <1> 		esicache2 dd 0
  2623                              <1> 	nonamefound:
  2624 00001E5A BE[251E0000]        <1> 		mov esi, namenotfoundbatch
  2625 00001E5F E801EDFFFF          <1> 		call print
  2626 00001E64 E9D4EFFFFF          <1> 		jmp nwcmd
  2627                              <1> 	goodbatchname:
  2628 00001E69 BE00001000          <1> 		mov esi, 0x100000
  2629                              <1> 	batchcreate:
  2630 00001E6E 8935[521E0000]      <1> 		mov [esicache3], esi
  2631 00001E74 B00D                <1> 		mov al, 13
  2632 00001E76 B307                <1> 		mov bl, 7
  2633 00001E78 B404                <1> 		mov ah, 4
  2634 00001E7A CD30                <1> 		int 30h
  2635 00001E7C 8935[561E0000]      <1> 		mov [esicache2], esi
  2636 00001E82 8A0E                <1> 		mov cl, [esi]
  2637 00001E84 8B35[521E0000]      <1> 		mov esi, [esicache3]
  2638 00001E8A BB[E11E0000]        <1> 		mov ebx, exitword
  2639 00001E8F E8CFF0FFFF          <1> 		call cndtest
  2640 00001E94 3C01                <1> 		cmp al, 1
  2641 00001E96 7423                <1> 		je endbatchcreate
  2642 00001E98 3C02                <1> 		cmp al, 2
  2643 00001E9A 741F                <1> 		je endbatchcreate
  2644 00001E9C BE[C0440000]        <1> 		mov esi, line
  2645 00001EA1 E8BFECFFFF          <1> 		call print
  2646 00001EA6 8B35[561E0000]      <1> 		mov esi, [esicache2]
  2647 00001EAC B00D                <1> 		mov al, 13
  2648 00001EAE B40A                <1> 		mov ah, 10
  2649 00001EB0 668906              <1> 		mov [esi], ax
  2650 00001EB3 81C602000000        <1> 		add esi, 2
  2651 00001EB9 EBB3                <1> 		jmp batchcreate
  2652                              <1> 	endbatchcreate:
  2653 00001EBB 8B35[521E0000]      <1> 		mov esi, [esicache3]
  2654 00001EC1 B800000000          <1> 		mov eax, 0
  2655 00001EC6 8806                <1> 		mov [esi], al
  2656 00001EC8 BE[C0440000]        <1> 		mov esi, line
  2657 00001ECD E893ECFFFF          <1> 		call print
  2658 00001ED2 BE00001000          <1> 		mov esi, 0x100000
  2659 00001ED7 E889ECFFFF          <1> 		call print
  2660 00001EDC E95CEFFFFF          <1> 		jmp nwcmd
  2661                              <1> 	
  2662 00001EE1 5C7800              <1> 	exitword db "\x",0
  2663 00001EE4 54797065205C782074- <1> 	wordmsg db "Type \x to exit.",10,13,0
  2664 00001EED 6F20657869742E0A0D- <1>
  2665 00001EF6 00                  <1>
  2666                              <1> 		
  2667 00001EF7 050473686F7700      <1> db 5,4,"show",0
  2668 00001EFE BF[701A0000]        <1> 		mov edi, buftxt
  2669 00001F03 81C705000000        <1> 		add edi, 5
  2670 00001F09 BE00001000          <1> 		mov esi, 0x100000
  2671 00001F0E E842230000          <1> 		call loadfile
  2672 00001F13 BE00001000          <1> 		mov esi, 0x100000
  2673 00001F18 66813E424D          <1> 		cmp word [esi], "BM"
  2674 00001F1D 7414                <1> 		je bmpfound
  2675 00001F1F E841ECFFFF          <1> 		call print
  2676 00001F24 BE[C0440000]        <1> 		mov esi, line
  2677 00001F29 E837ECFFFF          <1> 		call print
  2678 00001F2E E90AEFFFFF          <1> 		jmp nwcmd
  2679                              <1> bmpfound:
  2680 00001F33 803D[33290000]00    <1> 		cmp byte [guion], 0
  2681 00001F3A 0F844D000000        <1> 		je near noguibmp
  2682 00001F40 BE00001000          <1> 		mov esi, 0x100000
  2683 00001F45 B900000000          <1> 		mov ecx, 0
  2684 00001F4A BA00000000          <1> 		mov edx, 0
  2685 00001F4F B800000000          <1> 		mov eax, 0
  2686 00001F54 BB00000000          <1> 		mov ebx, 0
  2687 00001F59 E8A5190000          <1> 		call showbmp
  2688 00001F5E B000                <1> 		mov al, 0
  2689 00001F60 B405                <1> 		mov ah, 5
  2690 00001F62 CD30                <1> 		int 30h
  2691 00001F64 E831080000          <1> 		call guiclear
  2692 00001F69 E843100000          <1> 		call reloadallgraphics
  2693 00001F6E BE[701A0000]        <1> 		mov esi, buftxt
  2694 00001F73 81C605000000        <1> 		add esi, 5
  2695 00001F79 E8E7EBFFFF          <1> 		call print
  2696 00001F7E BE[10200000]        <1> 		mov esi, loadedbmpmsg
  2697 00001F83 E8DDEBFFFF          <1> 		call print
  2698 00001F88 E9B0EEFFFF          <1> 		jmp nwcmd
  2699                              <1> noguibmp:
  2700 00001F8D BE[9C1F0000]        <1> 		mov esi, warnguibmp
  2701 00001F92 E8CEEBFFFF          <1> 		call print
  2702 00001F97 E9A1EEFFFF          <1> 		jmp nwcmd
  2703 00001F9C 546869732063616E20- <1> warnguibmp db "This can not be done without the gui.",10,13,0
  2704 00001FA5 6E6F7420626520646F- <1>
  2705 00001FAE 6E6520776974686F75- <1>
  2706 00001FB7 742074686520677569- <1>
  2707 00001FC0 2E0A0D00            <1>
  2708                              <1> 
  2709                              <1> 		
  2710                              <1> filenotfound:
  2711 00001FC4 BE[ED1F0000]        <1> 		mov esi, filenf
  2712 00001FC9 E897EBFFFF          <1> 		call print
  2713 00001FCE BE[701A0000]        <1> 		mov esi, buftxt
  2714 00001FD3 81C608000000        <1> 		add esi, 8
  2715 00001FD9 E887EBFFFF          <1> 		call print
  2716 00001FDE BE[F81F0000]        <1> 		mov esi, filenf2
  2717 00001FE3 E87DEBFFFF          <1> 		call print
  2718 00001FE8 E950EEFFFF          <1> 		jmp nwcmd
  2719 00001FED 5468652066696C6520- <1> filenf db "The file ",34,0
  2720 00001FF6 2200                <1>
  2721 00001FF8 2220636F756C64206E- <1> filenf2 db 34," could not be found.",13,10,0
  2722 00002001 6F7420626520666F75- <1>
  2723 0000200A 6E642E0D0A00        <1>
  2724                              <1> 		
  2725 00002010 206C6F616465642E0D- <1> loadedbmpmsg db " loaded.",13,10,0
  2726 00002019 0A00                <1>
  2727                              <1> 
  2728 0000201B 050464756D7000      <1> 	db 5,4,"dump",0
  2729 00002022 BE[701A0000]        <1> 	mov esi, buftxt
  2730 00002027 81C605000000        <1> 	add esi, 5
  2731 0000202D B900000000          <1> 	mov ecx, 0
  2732 00002032 E811F3FFFF          <1> 	call cnvrttxt
  2733 00002037 89CF                <1> 	mov edi, ecx
  2734 00002039 89FE                <1> 	mov esi, edi
  2735 0000203B 81C680030000        <1> 	add esi, 896
  2736 00002041 C605[17120000]00    <1> 	mov byte [firsthexshown],0
  2737                              <1> dumphexloop:
  2738 00002048 8B0F                <1> 	mov ecx, [edi]
  2739 0000204A E8C9F1FFFF          <1> 	call showhex
  2740 0000204F 81C704000000        <1> 	add edi, 4
  2741 00002055 39F7                <1> 	cmp edi, esi
  2742 00002057 72EF                <1> 	jb dumphexloop
  2743 00002059 E9DFEDFFFF          <1> 	jmp nwcmd
  2744                              <1> 
  2745 0000205E 050474696D6500      <1> db 5,4,"time",0
  2746 00002065 E823000000          <1> 	call time
  2747 0000206A BE[77220000]        <1> 	mov esi, timeshow
  2748 0000206F E8F1EAFFFF          <1> 	call print
  2749 00002074 BE[C0440000]        <1> 	mov esi, line
  2750 00002079 E8E7EAFFFF          <1> 	call print
  2751 0000207E BE[81220000]        <1> 	mov esi, dateshow
  2752 00002083 E8DDEAFFFF          <1> 	call print
  2753 00002088 E9B0EDFFFF          <1> 	jmp nwcmd
  2754                              <1> 	time:
  2755 0000208D E86D010000          <1> 	call tstackput1
  2756 00002092 B00A                <1> 	mov al,10			;Get RTC register A
  2757 00002094 E897010000          <1> 	call tget1
  2758 00002099 A880                <1> 	test al,0x80			;Is update in progress?
  2759 0000209B 75F0                <1> 	jne time				; yes, wait
  2760                              <1> 
  2761 0000209D B000                <1> 	mov al,0			;Get seconds (00 to 59)
  2762 0000209F E88C010000          <1> 	call tget1
  2763 000020A4 A2[6E220000]        <1> 	mov [RTCtimeSecond],al
  2764                              <1> 
  2765 000020A9 B002                <1> 	mov al,0x02			;Get minutes (00 to 59)
  2766 000020AB E880010000          <1> 	call tget1
  2767 000020B0 A2[6F220000]        <1> 	mov [RTCtimeMinute],al
  2768                              <1> 
  2769 000020B5 B004                <1> 	mov al,0x04			;Get hours (see notes)
  2770 000020B7 E874010000          <1> 	call tget1
  2771 000020BC A2[70220000]        <1> 	mov [RTCtimeHour],al
  2772                              <1> 
  2773 000020C1 B007                <1> 	mov al,0x07			;Get day of month (01 to 31)
  2774 000020C3 E868010000          <1> 	call tget1
  2775                              <1> ;	mov ah, 0			;;fix day
  2776                              <1> ;	mov ah, al
  2777                              <1> ;	shr ah, 4
  2778                              <1> ;	shl al, 4
  2779                              <1> ;	shr al, 4
  2780                              <1> ;	cmp al, 0
  2781                              <1> ;	jne nodecahday
  2782                              <1> ;	mov al, 10
  2783                              <1> ;	dec ah
  2784                              <1> ;nodecahday:
  2785                              <1> ;	dec al
  2786                              <1> ;	shl ah, 4
  2787                              <1> ;	or al, ah
  2788 000020C8 A2[71220000]        <1> 	mov [RTCtimeDay],al
  2789                              <1> 
  2790 000020CD B008                <1> 	mov al,0x08			;Get month (01 to 12)
  2791 000020CF E85C010000          <1> 	call tget1
  2792 000020D4 A2[72220000]        <1> 	mov [RTCtimeMonth],al
  2793                              <1> 
  2794 000020D9 B009                <1> 	mov al,0x09			;Get year (00 to 99)
  2795 000020DB E850010000          <1> 	call tget1
  2796 000020E0 A2[73220000]        <1> 	mov [RTCtimeYear],al
  2797                              <1> 	
  2798 000020E5 BE[77220000]        <1> 	mov esi, timeshow
  2799 000020EA 8A2D[70220000]      <1> 	mov ch, [RTCtimeHour]
  2800 000020F0 E846010000          <1> 	call tput1
  2801 000020F5 8A2D[6F220000]      <1> 	mov ch, [RTCtimeMinute]
  2802 000020FB E83B010000          <1> 	call tput1
  2803 00002100 8A2D[6E220000]      <1> 	mov ch, [RTCtimeSecond]
  2804 00002106 E830010000          <1> 	call tput1
  2805 0000210B BE[81220000]        <1> 	mov esi, dateshow
  2806 00002110 8A2D[72220000]      <1> 	mov ch, [RTCtimeMonth]
  2807 00002116 E820010000          <1> 	call tput1
  2808 0000211B 8A2D[71220000]      <1> 	mov ch, [RTCtimeDay]
  2809 00002121 E815010000          <1> 	call tput1
  2810 00002126 B520                <1> 	mov ch, 0x20
  2811 00002128 E80E010000          <1> 	call tput1
  2812 0000212D 4E                  <1> 	dec esi
  2813 0000212E 8A2D[73220000]      <1> 	mov ch, [RTCtimeYear]
  2814 00002134 E802010000          <1> 	call tput1
  2815 00002139 E8DB000000          <1> 	call tstackget1
  2816 0000213E BE[77220000]        <1> 	mov esi, timeshow
  2817 00002143 66BB0700            <1> 	mov bx, 7
  2818 00002147 B401                <1> 	mov ah, 1
  2819 00002149 B000                <1> 	mov al, 0
  2820 0000214B CD30                <1> 	int 30h
  2821                              <1> ;;get day of week
  2822                              <1> ;;add these:
  2823                              <1> ;;century value
  2824                              <1> ;;last 2 digits of year
  2825                              <1> ;;last 2 digits of year right shifted twice
  2826                              <1> ;;month table value
  2827                              <1> ;;day of the month
  2828                              <1> ;;divide these by 7
  2829                              <1> ;;the remainder is the day
  2830 0000214D B800000000          <1> 	mov eax, 0
  2831                              <1> ;;first convert the values from BCD to hex
  2832 00002152 A0[71220000]        <1> 	mov al, [RTCtimeDay]
  2833 00002157 E88A000000          <1> 	call converttohex
  2834 0000215C 8825[74220000]      <1> 	mov [dayhex], ah
  2835 00002162 A0[72220000]        <1> 	mov al, [RTCtimeMonth]
  2836 00002167 E87A000000          <1> 	call converttohex
  2837 0000216C 8825[75220000]      <1> 	mov [monthhex], ah
  2838 00002172 A0[73220000]        <1> 	mov al, [RTCtimeYear]
  2839 00002177 E86A000000          <1> 	call converttohex
  2840 0000217C 8825[76220000]      <1> 	mov [yearhex], ah
  2841 00002182 B800000000          <1> 	mov eax, 0
  2842 00002187 A0[76220000]        <1> 	mov al, [yearhex]
  2843 0000218C C0E802              <1> 	shr al, 2
  2844 0000218F 0205[76220000]      <1> 	add al, [yearhex]
  2845 00002195 0506000000          <1> 	add eax, 6
  2846 0000219A BB00000000          <1> 	mov ebx, 0
  2847 0000219F 8A1D[75220000]      <1> 	mov bl, [monthhex]
  2848 000021A5 FECB                <1> 	dec bl
  2849 000021A7 81C3[97220000]      <1> 	add ebx, month
  2850 000021AD B900000000          <1> 	mov ecx, 0
  2851 000021B2 8A0B                <1> 	mov cl, [ebx]
  2852 000021B4 01C8                <1> 	add eax, ecx
  2853 000021B6 8A0D[74220000]      <1> 	mov cl, [dayhex]
  2854 000021BC 01C8                <1> 	add eax, ecx
  2855 000021BE 66BB0700            <1> 	mov bx, 7
  2856 000021C2 BA00000000          <1> 	mov edx, 0
  2857 000021C7 66F7F3              <1> 	div bx
  2858 000021CA C1E202              <1> 	shl edx, 2
  2859 000021CD 81C2[A3220000]      <1> 	add edx, day
  2860 000021D3 8B32                <1> 	mov esi, [edx]
  2861 000021D5 66BB0700            <1> 	mov bx, 7
  2862 000021D9 B401                <1> 	mov ah, 1
  2863 000021DB B000                <1> 	mov al, 0
  2864 000021DD CD30                <1> 	int 30h
  2865 000021DF 66B80000            <1> 	mov ax, 0
  2866 000021E3 CD30                <1> 	int 30h
  2867 000021E5 F4                  <1> 	hlt
  2868                              <1> 	
  2869                              <1> converttohex:
  2870 000021E6 88C4                <1> 	mov ah, al
  2871 000021E8 C0E804              <1> 	shr al, 4
  2872 000021EB C0E404              <1> 	shl ah, 4
  2873 000021EE C0EC04              <1> 	shr ah, 4
  2874 000021F1 3C00                <1> 	cmp al, 0
  2875 000021F3 7409                <1> 	je noconverttohex
  2876                              <1> converttohexlp:
  2877 000021F5 80C40A              <1> 	add ah, 10
  2878 000021F8 FEC8                <1> 	dec al
  2879 000021FA 3C00                <1> 	cmp al, 0
  2880 000021FC 75F7                <1> 	jne converttohexlp
  2881                              <1> noconverttohex:
  2882 000021FE C3                  <1> 	ret
  2883                              <1> 	
  2884                              <1> tstackput1:
  2885 000021FF 8935[6A220000]      <1> 	mov [tstack + 20], esi
  2886 00002205 BE[56220000]        <1> 	mov esi, tstack
  2887 0000220A 8906                <1> 	mov [esi], eax
  2888 0000220C 895E04              <1> 	mov [esi + 4], ebx
  2889 0000220F 894E08              <1> 	mov [esi + 8], ecx
  2890 00002212 89560C              <1> 	mov [esi + 12], edx
  2891 00002215 897E10              <1> 	mov [esi + 16], edi
  2892 00002218 C3                  <1> 	ret
  2893                              <1> 	
  2894                              <1> tstackget1:
  2895 00002219 BE[56220000]        <1> 	mov esi, tstack
  2896 0000221E 8B06                <1> 	mov eax, [esi]
  2897 00002220 8B5E04              <1> 	mov ebx, [esi + 4]
  2898 00002223 8B4E08              <1> 	mov ecx, [esi + 8]
  2899 00002226 8B560C              <1> 	mov edx, [esi + 12]
  2900 00002229 8B7E10              <1> 	mov edi, [esi + 16]
  2901 0000222C 8B7614              <1> 	mov esi, [esi + 20]
  2902 0000222F C3                  <1> 	ret
  2903                              <1> 	
  2904                              <1> tget1:
  2905 00002230 66BA7000            <1> 	mov dx, 0x70
  2906 00002234 EE                  <1> 	out dx, al
  2907 00002235 6642                <1> 	inc dx
  2908 00002237 EC                  <1> 	in al, dx
  2909 00002238 664A                <1> 	dec dx
  2910 0000223A C3                  <1> 	ret
  2911                              <1> 	
  2912                              <1> tput1:
  2913 0000223B 66C1E904            <1> 	shr cx, 4
  2914 0000223F B030                <1> 	mov al, 48
  2915 00002241 00E8                <1> 	add al, ch
  2916 00002243 8806                <1> 	mov [esi], al
  2917 00002245 46                  <1> 	inc esi
  2918 00002246 B030                <1> 	mov al, 48
  2919 00002248 C0E904              <1> 	shr cl, 4
  2920 0000224B 00C8                <1> 	add al, cl
  2921 0000224D 8806                <1> 	mov [esi], al
  2922 0000224F 81C602000000        <1> 	add esi, 2
  2923 00002255 C3                  <1> 	ret
  2924                              <1> 		
  2925 00002256 000000000000000000- <1> 	tstack dd 0,0,0,0,0,0
  2926 0000225F 000000000000000000- <1>
  2927 00002268 000000000000        <1>
  2928 0000226E 00                  <1> 	RTCtimeSecond db 0
  2929 0000226F 00                  <1> 	RTCtimeMinute db 0
  2930 00002270 00                  <1> 	RTCtimeHour db 0
  2931 00002271 00                  <1> 	RTCtimeDay db 0
  2932 00002272 00                  <1> 	RTCtimeMonth db 0
  2933 00002273 00                  <1> 	RTCtimeYear db 0
  2934 00002274 00                  <1> 	dayhex db 0
  2935 00002275 00                  <1> 	monthhex db 0
  2936 00002276 00                  <1> 	yearhex db 0
  2937 00002277 30303A30303A30300D- <1> 	timeshow db "00:00:00",13,10
  2938 00002280 0A                  <1>
  2939 00002281 30302D30302D303030- <1> 	dateshow db "00-00-0000",13,10,0
  2940 0000228A 300D0A00            <1>
  2941                              <1> 	oldcentury:	;;from 1700 to 1900
  2942 0000228E 040200              <1> 	db 4,2,0
  2943                              <1> 	century:	;;from 2000 to 2500
  2944 00002291 060402000604        <1> 	db 6,4,2,0,6,4
  2945                              <1> 	month:
  2946 00002297 000303060104060205- <1> 	db 0,3,3,6,1,4,6,2,5,0,3,5
  2947 000022A0 000305              <1>
  2948                              <1> 	day:
  2949 000022A3 [BF220000]          <1> 	dd sunday
  2950 000022A7 [C8220000]          <1> 	dd monday
  2951 000022AB [D1220000]          <1> 	dd tuesday
  2952 000022AF [DB220000]          <1> 	dd wednesday
  2953 000022B3 [E7220000]          <1> 	dd thursday
  2954 000022B7 [F2220000]          <1> 	dd friday
  2955 000022BB [FB220000]          <1> 	dd saturday
  2956                              <1> sunday:
  2957 000022BF 53756E6461790D0A00  <1> 	db "Sunday",13,10,0
  2958                              <1> monday:
  2959 000022C8 4D6F6E6461790D0A00  <1> 	db "Monday",13,10,0
  2960                              <1> tuesday:
  2961 000022D1 547565736461790D0A- <1> 	db "Tuesday",13,10,0
  2962 000022DA 00                  <1>
  2963                              <1> wednesday:
  2964 000022DB 5765646E6573646179- <1> 	db "Wednesday",13,10,0
  2965 000022E4 0D0A00              <1>
  2966                              <1> thursday:
  2967 000022E7 54687572736461790D- <1> 	db "Thursday",13,10,0
  2968 000022F0 0A00                <1>
  2969                              <1> friday:
  2970 000022F2 4672696461790D0A00  <1> 	db "Friday",13,10,0
  2971                              <1> saturday:
  2972 000022FB 53617475726461790D- <1> 	db "Saturday",13,10,0
  2973 00002304 0A00                <1>
  2974                              <1> 
  2975 00002306 0504637075696400    <1> db 5,4,"cpuid",0
  2976 0000230E B800000000          <1> 	mov eax, 0
  2977 00002313 0FA2                <1> 	cpuid
  2978 00002315 891D[6A230000]      <1> 	mov [cpuidbuf], ebx
  2979 0000231B 8915[6E230000]      <1> 	mov [cpuidbuf + 4], edx
  2980 00002321 890D[72230000]      <1> 	mov [cpuidbuf + 8], ecx
  2981 00002327 BE[6A230000]        <1> 	mov esi, cpuidbuf
  2982 0000232C E834E8FFFF          <1> 	call print
  2983 00002331 BE[C0440000]        <1> 	mov esi, line
  2984 00002336 E82AE8FFFF          <1> 	call print
  2985 0000233B B801000000          <1> 	mov eax, 1
  2986 00002340 0FA2                <1> 	cpuid
  2987 00002342 89C1                <1> 	mov ecx, eax
  2988 00002344 C605[17120000]02    <1> 	mov byte [firsthexshown], 2
  2989 0000234B E8C8EEFFFF          <1> 	call showhex
  2990 00002350 B808000080          <1> 	mov eax, 0x80000008
  2991 00002355 0FA2                <1> 	cpuid
  2992 00002357 89C1                <1> 	mov ecx, eax
  2993 00002359 C605[17120000]02    <1> 	mov byte [firsthexshown], 2
  2994 00002360 E8B3EEFFFF          <1> 	call showhex
  2995 00002365 E9D3EAFFFF          <1> 	jmp nwcmd
  2996                              <1> 	
  2997 0000236A 00<rept>            <1> cpuidbuf times 13 db 0
  2998                              <1> cpuidvendorend:
  2999                              <1> progend:		;programs end here	
  3000                              <1> batchprogend:
  3001                                      %include 'source/input.asm'
  3002                              <1> PS2SET:
  3003 00002377 B0A8                <1>   mov  al, 0xa8		; enable mouse port
  3004 00002379 E664                <1>   out  0x64, al		; write to keyboardcontroller
  3005 0000237B E801000000          <1>   call CHKPRT		; check if command is progressed (demand!)
  3006 00002380 C3                  <1> ret
  3007                              <1> 
  3008                              <1> CHKPRT:
  3009 00002381 66B96400            <1>   mov  cx, 100
  3010                              <1>  .again:
  3011 00002385 E464                <1>   in   al, 0x64		; read from keyboardcontroller
  3012 00002387 A802                <1>   test al, 2		; Check if input buffer is empty
  3013 00002389 7402                <1>   je .go
  3014 0000238B E2F8                <1>   loop .again
  3015                              <1>  .go:
  3016 0000238D C3                  <1> ret
  3017                              <1> 
  3018                              <1> WMOUS:
  3019 0000238E B0D4                <1>   mov  al, 0xd4		; write to mouse device instead of to keyboard
  3020 00002390 E664                <1>   out  0x64, al		; write to keyboardcontroller
  3021 00002392 E8EAFFFFFF          <1>   call CHKPRT		; check if command is progressed (demand!)
  3022 00002397 C3                  <1> ret
  3023                              <1> 
  3024                              <1> MBUFFUL:
  3025 00002398 66B96400            <1>   mov cx, 100
  3026                              <1>  .mn:
  3027 0000239C E464                <1>   in   al, 0x64		; read from keyboardcontroller
  3028 0000239E A820                <1>   test al, 0x20		; check if mouse output buffer is full
  3029 000023A0 7402                <1>   jz  .mnn
  3030 000023A2 E2F8                <1>   loop .mn
  3031                              <1>  .mnn:
  3032 000023A4 C3                  <1> ret
  3033                              <1> 
  3034                              <1> 
  3035                              <1> ACTMOUS:
  3036 000023A5 E8E4FFFFFF          <1>   call WMOUS
  3037 000023AA B0F4                <1>   mov  al, 0xf4 	; Command to activate mouse itselve (Stream mode)
  3038 000023AC E660                <1>   out  0x60, al		; write ps/2 controller output port (activate mouse)
  3039 000023AE E8CEFFFFFF          <1>   call CHKPRT		; check if command is progressed (demand!)
  3040 000023B3 E801000000          <1>   call CHKMOUS		; check if a byte is available
  3041 000023B8 C3                  <1> ret
  3042                              <1> 
  3043                              <1> CHKMOUS:
  3044 000023B9 B300                <1>   mov  bl, 0
  3045 000023BB 66B96400            <1>   mov cx, 100
  3046                              <1>  .vrd:
  3047 000023BF E464                <1>   in   al, 0x64		; read from keyboardcontroller
  3048 000023C1 A801                <1>   test al, 1		; check if controller buffer (60h) has data
  3049 000023C3 7504                <1>   jnz .yy
  3050 000023C5 E2F8                <1>   loop .vrd
  3051 000023C7 B301                <1>   mov  bl, 1
  3052                              <1>  .yy:
  3053 000023C9 C3                  <1> ret
  3054                              <1> 
  3055                              <1> GETB:
  3056                              <1>  .cagain:
  3057 000023CA E8EAFFFFFF          <1>   call CHKMOUS		; check if a byte is available
  3058 000023CF 08DB                <1>   or bl, bl
  3059 000023D1 75F7                <1>   jnz .cagain
  3060 000023D3 B0AD                <1>   mov  al, 0xad		; Disable Keyboard
  3061 000023D5 E664                <1>   out  0x64, al		; write to keyboardcontroller
  3062 000023D7 E8A5FFFFFF          <1>   call CHKPRT		; check if command is progressed (demand!)
  3063 000023DC 6631C0              <1>   xor  ax, ax
  3064 000023DF E460                <1>   in   al, 0x60		; read ps/2 controller output port (mousebyte)
  3065 000023E1 88C2                <1>   mov  dl, al
  3066 000023E3 B0AE                <1>   mov  al, 0xae		; Enable Keyboard
  3067 000023E5 E664                <1>   out  0x64, al		; write to keyboardcontroller
  3068 000023E7 E895FFFFFF          <1>   call CHKPRT		; check if command is progressed (demand!)
  3069 000023EC 88D0                <1>   mov  al, dl
  3070 000023EE C3                  <1> ret
  3071                              <1> 
  3072 000023EF 00                  <1> LBUTTON db 0x00	;	Left   button status 1=PRESSED 0=RELEASED
  3073 000023F0 00                  <1> RBUTTON db 0x00	;	Right  button status 1=PRESSED 0=RELEASED
  3074 000023F1 00                  <1> MBUTTON db 0x00	;	Middle button status 1=PRESSED 0=RELEASED
  3075 000023F2 00                  <1> XCOORD  db 0x00	;	the moved distance  (horizontal)
  3076 000023F3 00                  <1> YCOORD  db 0x00	;	the moved distance  (vertical)
  3077                              <1> 
  3078                              <1> 
  3079                              <1> 	guistartin:
  3080 000023F4 B800000000          <1> 		mov eax, 0
  3081 000023F9 66A3[320B0000]      <1> 		mov [lastkey], ax
  3082 000023FF E464                <1> 		in al, 64h ; Status
  3083 00002401 A801                <1> 		test al, 1 ; output buffer full?
  3084 00002403 74EF                <1> 		jz guistartin
  3085 00002405 A820                <1> 		test al, 20h ; PS2-Mouse?
  3086 00002407 0F85E2000000        <1> 		jnz near maincall2
  3087 0000240D E460                <1> 		in al, 60h
  3088 0000240F 88C4                <1> 		mov ah, al
  3089 00002411 B000                <1> 		mov al, 0
  3090 00002413 8825[330B0000]      <1> 		mov [lastkey + 1], ah
  3091 00002419 88E0                <1> 		mov al, ah
  3092 0000241B BF[26270000]        <1> 		mov edi, scancode
  3093                              <1> 	guisearchscan: 
  3094 00002420 3C40                <1> 		cmp al, 40h
  3095 00002422 7315                <1> 		jae guiscanother
  3096 00002424 B400                <1> 		mov ah, 0
  3097 00002426 D0E0                <1> 		shl al, 1
  3098 00002428 01C7                <1> 		add edi, eax
  3099 0000242A D0E8                <1> 		shr al, 1
  3100 0000242C 8A27                <1> 		mov ah, [edi]
  3101 0000242E 80FC00              <1> 		cmp ah, 0
  3102 00002431 7406                <1> 		je guiscanother
  3103 00002433 E964000000          <1> 		jmp guiscanfound
  3104 00002438 00                  <1> guiupper db 0
  3105                              <1> guiscanother:
  3106 00002439 88C4                <1> 		mov ah, al
  3107 0000243B B000                <1> 		mov al, 0
  3108 0000243D 66A3[320B0000]      <1> 		mov [lastkey], ax
  3109                              <1> 		;cmp ah, 4Dh
  3110                              <1> 		;je near nextimage
  3111 00002443 80FC2A              <1> 		cmp ah, 2Ah
  3112 00002446 0F8437000000        <1> 		je near guishifton
  3113 0000244C 80FC36              <1> 		cmp ah, 36h
  3114 0000244F 0F842E000000        <1> 		je near guishifton
  3115 00002455 80FC1C              <1> 		cmp ah, 1Ch
  3116 00002458 0F843D000000        <1> 		je near guientdown
  3117 0000245E 80FCAA              <1> 		cmp ah, 0AAh
  3118 00002461 0F8428000000        <1> 		je near guishiftoff
  3119 00002467 80FCB6              <1> 		cmp ah, 0B6h
  3120 0000246A 0F841F000000        <1> 		je near guishiftoff
  3121 00002470 80FC3A              <1> 		cmp ah, 3Ah
  3122 00002473 0F8401000000        <1> 		je near guishift
  3123 00002479 C3                  <1> 		ret
  3124                              <1> 	guishift:
  3125 0000247A A0[38240000]        <1> 		mov al, [guiupper]
  3126 0000247F 3C01                <1> 		cmp al, 1
  3127 00002481 730C                <1> 		jae guishiftoff
  3128                              <1> 	guishifton:
  3129 00002483 C605[38240000]01    <1> 		mov byte [guiupper], 1
  3130 0000248A E965FFFFFF          <1> 		jmp guistartin
  3131                              <1> 	guishiftoff:
  3132 0000248F C605[38240000]00    <1> 		mov byte [guiupper], 0
  3133 00002496 E959FFFFFF          <1> 		jmp guistartin
  3134                              <1> 	guientdown:
  3135 0000249B C3                  <1> 		ret
  3136                              <1> 	guiscanfound:
  3137 0000249C 81C701000000        <1> 		add edi, 1
  3138 000024A2 803D[38240000]01    <1> 		cmp byte [guiupper], 1
  3139 000024A9 7306                <1> 		jae uppercasegui
  3140 000024AB 81EF01000000        <1> 		sub edi, 1
  3141                              <1> uppercasegui:
  3142 000024B1 8A07                <1> 		mov al,[edi]
  3143 000024B3 A2[320B0000]        <1> 		mov [lastkey], al
  3144 000024B8 C3                  <1> 		ret
  3145                              <1> 		
  3146                              <1> 		
  3147                              <1> 	cursorgui:
  3148 000024B9 803D[A7390000]01    <1> 		cmp byte [mouseon], 1
  3149 000024C0 0F8429000000        <1> 		je near maincall2
  3150 000024C6 803D[33290000]00    <1> 		cmp byte [guion], 0
  3151 000024CD 0F84C8FFFFFF        <1> 		je near guientdown
  3152                              <1> 	initmouse:
  3153 000024D3 E828050000          <1> 		call switchmousepos2
  3154 000024D8 E89AFEFFFF          <1> 	  	call PS2SET
  3155 000024DD E8C3FEFFFF          <1> 		call ACTMOUS
  3156 000024E2 C605[A7390000]01    <1> 		mov byte [mouseon],1
  3157 000024E9 E8DCFEFFFF          <1> 		call GETB 	;;Get the responce byte of the mouse (like: Hey i am active)
  3158                              <1> 				;;If the bytes are mixed up,
  3159                              <1> 				;;remove this line or add another of this line.
  3160                              <1> 		;call GETB
  3161 000024EE C3                  <1> 		ret
  3162                              <1> 	maincall2:
  3163 000024EF 803D[A7390000]01    <1> 		  cmp byte [mouseon], 1
  3164 000024F6 75DB                <1> 		  jne initmouse
  3165 000024F8 E8CDFEFFFF          <1> 		  call GETB
  3166 000024FD 88C3                <1> 		  mov  bl, al
  3167 000024FF 80E301              <1> 		  and  bl, 1
  3168 00002502 881D[EF230000]      <1> 		  mov  BYTE [LBUTTON], bl
  3169 00002508 88C3                <1> 		  mov  bl, al
  3170 0000250A 80E302              <1> 		  and  bl, 2
  3171 0000250D D0EB                <1> 		  shr  bl, 1
  3172 0000250F 881D[F0230000]      <1> 		  mov  BYTE [RBUTTON], bl
  3173 00002515 88C3                <1> 		  mov  bl, al
  3174 00002517 80E304              <1> 		  and  bl, 4
  3175 0000251A C0EB02              <1> 		  shr  bl, 2
  3176 0000251D 881D[F1230000]      <1> 		  mov  BYTE [MBUTTON], bl
  3177 00002523 E8A2FEFFFF          <1> 		  call GETB
  3178 00002528 A2[F2230000]        <1> 		  mov  BYTE [XCOORD], al
  3179 0000252D E898FEFFFF          <1> 		  call GETB
  3180 00002532 A2[F3230000]        <1> 		  mov  BYTE [YCOORD], al
  3181                              <1> 
  3182                              <1> 	showpixelcursor:
  3183 00002537 668B15[84260000]    <1> 		mov dx, [mousecursorposition]
  3184 0000253E 668B0D[86260000]    <1> 		mov cx, [mousecursorposition + 2]
  3185 00002545 668915[80260000]    <1> 		mov [lastmouseposition], dx
  3186 0000254C 66890D[82260000]    <1> 		mov [lastmouseposition + 2], cx
  3187 00002553 A0[F2230000]        <1> 		mov al, [XCOORD]
  3188 00002558 3C80                <1> 		cmp al, 128
  3189 0000255A 730C                <1> 		jae subxcoord
  3190 0000255C 00C0                <1> 		add al, al
  3191 0000255E B400                <1> 		mov ah, 0
  3192 00002560 6601C2              <1> 		add dx, ax
  3193 00002563 E90B000000          <1> 		jmp subxcoorddn
  3194                              <1> 	subxcoord:
  3195 00002568 00C0                <1> 		add al, al
  3196 0000256A B300                <1> 		mov bl, 0
  3197 0000256C 28C3                <1> 		sub bl, al
  3198 0000256E B700                <1> 		mov bh, 0
  3199 00002570 6629DA              <1> 		sub dx, bx
  3200                              <1> 	subxcoorddn:
  3201 00002573 8A1D[F3230000]      <1> 		mov bl, [YCOORD]
  3202 00002579 B000                <1> 		mov al, 0
  3203 0000257B 28D8                <1> 		sub al, bl
  3204 0000257D 3C80                <1> 		cmp al, 128
  3205 0000257F 730A                <1> 		jae subycoord
  3206 00002581 B400                <1> 		mov ah, 0
  3207 00002583 6601C1              <1> 		add cx, ax
  3208 00002586 E909000000          <1> 		jmp subycoorddn
  3209                              <1> 	subycoord:
  3210 0000258B B300                <1> 		mov bl, 0
  3211 0000258D 28C3                <1> 		sub bl, al
  3212 0000258F B700                <1> 		mov bh, 0
  3213 00002591 6629D9              <1> 		sub cx, bx
  3214                              <1> 	subycoorddn:
  3215 00002594 6681FA204E          <1> 		cmp dx, 20000
  3216 00002599 7604                <1> 		jbe nooriginx2
  3217 0000259B 66BA0000            <1> 		mov dx, 0
  3218                              <1> 	nooriginx2:
  3219 0000259F 6681F9204E          <1> 		cmp cx, 20000
  3220 000025A4 7604                <1> 		jbe nooriginy2
  3221 000025A6 66B90000            <1> 		mov cx, 0
  3222                              <1> 	nooriginy2:
  3223 000025AA 6681FA0000          <1> 		cmp dx, 0
  3224 000025AF 7415                <1> 		je nofixxcolumn2
  3225 000025B1 663B15[54370000]    <1> 		cmp dx, [resolutionx2]
  3226 000025B8 720C                <1> 		jb nofixxcolumn2
  3227 000025BA 668B15[54370000]    <1> 		mov dx, [resolutionx2]
  3228 000025C1 6681EA0200          <1> 		sub dx, 2
  3229                              <1> 	nofixxcolumn2:
  3230 000025C6 6681F90000          <1> 		cmp cx, 0
  3231 000025CB 7415                <1> 		je nofixyrow2
  3232 000025CD 663B0D[50370000]    <1> 		cmp cx, [resolutiony]
  3233 000025D4 720C                <1> 		jb nofixyrow2
  3234 000025D6 668B0D[50370000]    <1> 		mov cx, [resolutiony]
  3235 000025DD 6681E90100          <1> 		sub cx, 1
  3236                              <1> 	nofixyrow2:
  3237 000025E2 668915[84260000]    <1> 		mov [mousecursorposition], dx
  3238 000025E9 66890D[86260000]    <1> 		mov [mousecursorposition + 2], cx
  3239 000025F0 E8A2030000          <1> 		call switchmousepos ;;use dragging code to ensure proper icon drag
  3240 000025F5 803D[EF230000]01    <1> 		cmp byte [LBUTTON], 1
  3241 000025FC 0F847B040000        <1> 		je near clickicon
  3242 00002602 803D[F0230000]01    <1> 		cmp byte [RBUTTON], 1
  3243 00002609 0F846E040000        <1> 		je near clickicon
  3244 0000260F A0[6A2A0000]        <1> 		mov al, [pbutton]
  3245 00002614 C705[6D2A0000]0000- <1> 		mov dword [dragging], 0
  3246 0000261C 0000                <1>
  3247 0000261E 3C00                <1> 		cmp al, 0
  3248 00002620 740F                <1> 		je nopreviousbutton
  3249 00002622 E80D030000          <1> 		call clearmousecursor
  3250 00002627 E885090000          <1> 		call reloadallgraphics
  3251 0000262C E8CF030000          <1> 		call switchmousepos2
  3252                              <1> 	nopreviousbutton:
  3253 00002631 B000                <1> 		mov al, 0
  3254 00002633 A2[6A2A0000]        <1> 		mov [pbutton], al
  3255 00002638 A0[EF230000]        <1> 		mov al, [LBUTTON]
  3256 0000263D A2[6B2A0000]        <1> 		mov [pLBUTTON], al
  3257 00002642 A0[F0230000]        <1> 		mov al, [RBUTTON]
  3258 00002647 A2[6C2A0000]        <1> 		mov [pRBUTTON], al
  3259 0000264C B900000000          <1> 		mov ecx, 0
  3260 00002651 BA00000000          <1> 		mov edx, 0
  3261 00002656 668B15[84260000]    <1> 		mov dx, [mousecursorposition]
  3262 0000265D 668B0D[86260000]    <1> 		mov cx, [mousecursorposition + 2]
  3263 00002664 66BB9CE7            <1> 		mov bx, 1110011110011100b
  3264 00002668 B400                <1> 		mov ah, 0
  3265 0000266A B080                <1> 		mov al, 128
  3266 0000266C C605[30290000]01    <1> 		mov byte [showcursorfonton], 1
  3267 00002673 E8EC100000          <1> 		call showfontvesa
  3268 00002678 C605[30290000]00    <1> 		mov byte [showcursorfonton], 0
  3269 0000267F C3                  <1> 		ret
  3270                              <1> 
  3271 00002680 84008400            <1> lastmouseposition dw 132,132
  3272 00002684 84008400            <1> mousecursorposition dw 132,132	
  3273                              <1> 
  3274                              <1> termmouse:
  3275 00002688 C3                  <1> 	ret	;;lets try this later
  3276 00002689 BE[851C0000]        <1> 		mov esi, videobuf2
  3277 0000268E BA00000000          <1> 		mov edx, 0
  3278 00002693 668B15[80260000]    <1> 		mov dx, [lastmouseposition]
  3279 0000269A 668B0D[82260000]    <1> 		mov cx, [lastmouseposition + 2]
  3280 000026A1 66A1[24270000]      <1> 		mov ax, [cursorcache]
  3281 000026A7 663D0000            <1> 		cmp ax, 0
  3282 000026AB 7426                <1> 		je nocopycursorcache
  3283 000026AD 66C1E104            <1> 		shl cx, 4
  3284 000026B1 66C1E203            <1> 		shl dx, 3
  3285 000026B5 01D6                <1> 		add esi, edx
  3286 000026B7 66BA0000            <1> 		mov dx, 0
  3287 000026BB 8A15[8B090000]      <1> 		mov dl, [charxy]
  3288 000026C1 6641                <1> 		inc cx
  3289                              <1> termmousecplp1:
  3290 000026C3 01D6                <1> 		add esi, edx
  3291 000026C5 6649                <1> 		dec cx
  3292 000026C7 6681F90000          <1> 		cmp cx, 0
  3293 000026CC 75F5                <1> 		jne termmousecplp1
  3294 000026CE 29D6                <1> 		sub esi, edx
  3295 000026D0 668906              <1> 		mov [esi], ax
  3296                              <1> nocopycursorcache:
  3297 000026D3 BE[851C0000]        <1> 		mov esi, videobuf2
  3298 000026D8 BA00000000          <1> 		mov edx, 0
  3299 000026DD 668B15[84260000]    <1> 		mov dx, [mousecursorposition]
  3300 000026E4 668B0D[86260000]    <1> 		mov cx, [mousecursorposition + 2]
  3301 000026EB 66C1E104            <1> 		shl cx, 4
  3302 000026EF 66C1E203            <1> 		shl dx, 3
  3303 000026F3 01D6                <1> 		add esi, edx
  3304 000026F5 66BA0000            <1> 		mov dx, 0
  3305 000026F9 8A15[8B090000]      <1> 		mov dl, [charxy]
  3306 000026FF 6641                <1> 		inc cx
  3307                              <1> termmousecplp2:
  3308 00002701 01D6                <1> 		add esi, edx
  3309 00002703 6649                <1> 		dec cx
  3310 00002705 6681F90000          <1> 		cmp cx, 0
  3311 0000270A 75F5                <1> 		jne termmousecplp2
  3312 0000270C 29D6                <1> 		sub esi, edx
  3313 0000270E 668B06              <1> 		mov ax, [esi]
  3314 00002711 66A3[24270000]      <1> 		mov [cursorcache], ax
  3315 00002717 B080                <1> 		mov al, 128
  3316 00002719 B407                <1> 		mov ah, 7
  3317 0000271B 668906              <1> 		mov [esi], ax
  3318 0000271E E837E5FFFF          <1> 		call termcopy
  3319 00002723 C3                  <1> 		ret
  3320 00002724 0000                <1> cursorcache db 0,0
  3321                              <1> 	
  3322                              <1> scancode:
  3323 00002726 0000                <1> 	db 0,0		;,0h
  3324 00002728 0000                <1> 	db 0,0		;,1h
  3325 0000272A 3121                <1> 	db '1','!'	;,2h
  3326 0000272C 3240                <1> 	db '2','@'	;,3h
  3327 0000272E 3323                <1> 	db '3','#'	;,4h
  3328 00002730 3424                <1> 	db '4','$'	;,5h
  3329 00002732 3525                <1> 	db '5','%'	;,6h
  3330 00002734 365E                <1> 	db '6','^'	;,7h
  3331 00002736 3726                <1> 	db '7','&'	;,8h
  3332 00002738 382A                <1> 	db '8','*'	;,9h
  3333 0000273A 3928                <1> 	db '9','('	;,0Ah
  3334 0000273C 3029                <1> 	db '0',')'	;,0Bh
  3335 0000273E 2D5F                <1> 	db '-','_'	;,0Ch
  3336 00002740 3D2B                <1> 	db '=','+'	;,0Dh
  3337 00002742 0808                <1> 	db 8,8		;,0Eh
  3338 00002744 0000                <1> 	db 0,0		;,0Fh
  3339 00002746 7151                <1> 	db 'q','Q'	;,10h
  3340 00002748 7757                <1> 	db 'w','W'	;,11h
  3341 0000274A 6545                <1> 	db 'e','E'	;,12h
  3342 0000274C 7252                <1> 	db 'r','R'	;,13h
  3343 0000274E 7454                <1> 	db 't','T'	;,14h
  3344 00002750 7959                <1> 	db 'y','Y'	;,15h
  3345 00002752 7555                <1> 	db 'u','U'	;,16h
  3346 00002754 6949                <1> 	db 'i','I'	;,17h
  3347 00002756 6F4F                <1> 	db 'o','O'	;,18h
  3348 00002758 7050                <1> 	db 'p','P'	;,19h
  3349 0000275A 5B7B                <1> 	db '[','{'	;,1Ah
  3350 0000275C 5D7D                <1> 	db ']','}'	;,1Bh
  3351 0000275E 0000                <1> 	db 0,0		;,1Ch
  3352 00002760 0000                <1> 	db 0,0		;,1Dh
  3353 00002762 6141                <1> 	db 'a','A'	;,1Eh
  3354 00002764 7353                <1> 	db 's','S'	;,1Fh
  3355 00002766 6444                <1> 	db 'd','D'	;,20h
  3356 00002768 6646                <1> 	db 'f','F'	;,21h
  3357 0000276A 6747                <1> 	db 'g','G'	;,22h
  3358 0000276C 6848                <1> 	db 'h','H'	;,23h
  3359 0000276E 6A4A                <1> 	db 'j','J'	;,24h
  3360 00002770 6B4B                <1> 	db 'k','K'	;,25h
  3361 00002772 6C4C                <1> 	db 'l','L'	;,26h
  3362 00002774 3B3A                <1> 	db ';',':'	;,27h
  3363 00002776 2722                <1> 	db 27h,22h	;,28h
  3364 00002778 607E                <1> 	db '`','~'	;,29h
  3365 0000277A 0000                <1> 	db 0,0		;,2Ah
  3366 0000277C 5C7C                <1> 	db '\','|'	;,2Bh
  3367 0000277E 7A5A                <1> 	db 'z','Z'	;,2Ch
  3368 00002780 7858                <1> 	db 'x','X'	;,2Dh
  3369 00002782 6343                <1> 	db 'c','C'	;,2Eh
  3370 00002784 7656                <1> 	db 'v','V'	;,2Fh
  3371 00002786 6242                <1> 	db 'b','B'	;,30h
  3372 00002788 6E4E                <1> 	db 'n','N'	;,31h
  3373 0000278A 6D4D                <1> 	db 'm','M'	;,32h
  3374 0000278C 2C3C                <1> 	db ',','<'	;,33h
  3375 0000278E 2E3E                <1> 	db '.','>'	;,34h
  3376 00002790 2F3F                <1> 	db '/','?'	;,35h
  3377 00002792 0000                <1> 	db 0,0		;,36h
  3378 00002794 0000                <1> 	db 0,0		;,37h
  3379 00002796 0000                <1> 	db 0,0		;,38h
  3380 00002798 2020                <1> 	db ' ',' '	;,39h
  3381                              <1> noscan:
  3382                                      %include 'source/gui.asm'
  3383                              <1> guiclear:
  3384 0000279A 8B3D[2B4F0000]      <1> 	mov edi, [physbaseptr]
  3385 000027A0 668B15[52370000]    <1> 	mov dx, [resolutionx]
  3386 000027A7 668B0D[50370000]    <1> 	mov cx, [resolutiony]
  3387 000027AE 66A1[D7270000]      <1> 	mov ax, [background]
  3388                              <1> guiclearloop:
  3389 000027B4 668907              <1> 	mov [edi], ax
  3390 000027B7 81C702000000        <1> 	add edi, 2
  3391 000027BD 664A                <1> 	dec dx
  3392 000027BF 6681FA0000          <1> 	cmp dx, 0
  3393 000027C4 77EE                <1> 	ja guiclearloop
  3394 000027C6 6649                <1> 	dec cx
  3395 000027C8 668B15[52370000]    <1> 	mov dx, [resolutionx]
  3396 000027CF 6681F90000          <1> 	cmp cx, 0
  3397 000027D4 77DE                <1> 	ja guiclearloop
  3398 000027D6 C3                  <1> 	ret
  3399                              <1> 
  3400 000027D7 CF7B                <1> background dw 0111101111001111b
  3401                              <1> 
  3402                              <1> gui:	;Let's see what I can do, I am going to try to make this as freestanding as possible
  3403 000027D9 B800000000          <1> 	mov eax, 0
  3404 000027DE BB00000000          <1> 	mov ebx, 0
  3405 000027E3 B900000000          <1> 	mov ecx, 0
  3406 000027E8 BA00000000          <1> 	mov edx, 0
  3407 000027ED 8B3D[2B4F0000]      <1> 	mov edi, [physbaseptr]
  3408 000027F3 668B15[52370000]    <1> 	mov dx, [resolutionx]
  3409 000027FA 668B0D[50370000]    <1> 	mov cx, [resolutiony]
  3410 00002801 668B1D[D7270000]    <1> 	mov bx, [background]
  3411                              <1> guiclearloop2:
  3412 00002808 66891F              <1> 	mov [edi], bx
  3413 0000280B 81C702000000        <1> 	add edi, 2
  3414 00002811 664A                <1> 	dec dx
  3415 00002813 6681FA0000          <1> 	cmp dx, 0
  3416 00002818 0F85EAFFFFFF        <1> 	jne near guiclearloop2
  3417 0000281E 6649                <1> 	dec cx
  3418 00002820 668B15[52370000]    <1> 	mov dx, [resolutionx]
  3419 00002827 6681F90000          <1> 	cmp cx, 0
  3420 0000282C 0F85D6FFFFFF        <1> 	jne near guiclearloop2
  3421 00002832 C605[33290000]01    <1> 	mov byte [guion], 1
  3422 00002839 C605[32290000]00    <1> 	mov byte [mouseselecton], 0
  3423 00002840 B800000000          <1> 	mov eax, 0
  3424 00002845 BB00000000          <1> 	mov ebx, 0
  3425 0000284A B900000000          <1> 	mov ecx, 0
  3426 0000284F BA00000000          <1> 	mov edx, 0
  3427                              <1> 	
  3428 00002854 BE[BC390000]        <1> 	mov esi, pacmsg
  3429 00002859 66B80000            <1> 	mov ax, 0
  3430 0000285D BB00000000          <1> 	mov ebx, 0
  3431 00002862 66B90200            <1> 	mov cx, 2
  3432 00002866 66BA0400            <1> 	mov dx, 4
  3433 0000286A E8890A0000          <1> 	call showstring
  3434                              <1> 	
  3435 0000286F BE[D23A0000]        <1> 	mov esi, interneticon
  3436 00002874 66B80000            <1> 	mov ax, 0
  3437 00002878 BB[313A0000]        <1> 	mov ebx, noie
  3438 0000287D 66B91800            <1> 	mov cx, 24
  3439 00002881 66BA0400            <1> 	mov dx, 4
  3440 00002885 E8ED0D0000          <1> 	call showicon
  3441                              <1> 	
  3442 0000288A BE[543B0000]        <1> 	mov esi, wordicon
  3443 0000288F 66B80000            <1> 	mov ax, 0
  3444 00002893 BB00000000          <1> 	mov ebx, 0
  3445 00002898 66B91800            <1> 	mov cx, 24
  3446 0000289C 66BA3000            <1> 	mov dx, 48
  3447 000028A0 E8D20D0000          <1> 	call showicon
  3448                              <1> 	
  3449 000028A5 BE[D63B0000]        <1> 	mov esi, pacmanpellet
  3450 000028AA 66B80000            <1> 	mov ax, 0
  3451 000028AE BB00000000          <1> 	mov ebx, 0
  3452 000028B3 66B94000            <1> 	mov cx, 64
  3453 000028B7 66BA0400            <1> 	mov dx, 4
  3454 000028BB E8B70D0000          <1> 	call showicon
  3455                              <1> 	
  3456 000028C0 BE[DA3C0000]        <1> 	mov esi, pacman
  3457 000028C5 66B80000            <1> 	mov ax, 0
  3458 000028C9 BB[163A0000]        <1> 	mov ebx, pacmannomnom
  3459 000028CE 66B94000            <1> 	mov cx, 64
  3460 000028D2 66BA3000            <1> 	mov dx, 48
  3461 000028D6 E89C0D0000          <1> 	call showicon
  3462                              <1> 	
  3463 000028DB BE[583C0000]        <1> 	mov esi, ghostie
  3464 000028E0 66B80000            <1> 	mov ax, 0
  3465 000028E4 BB[FB390000]        <1> 	mov ebx, boo
  3466 000028E9 66B96C00            <1> 	mov cx, 108
  3467 000028ED 66BA0400            <1> 	mov dx, 4
  3468 000028F1 E8810D0000          <1> 	call showicon
  3469                              <1> 
  3470 000028F6 BE[A8390000]        <1> 	mov esi, start
  3471 000028FB 668B0D[50370000]    <1> 	mov cx, [resolutiony]
  3472 00002902 6681E91000          <1> 	sub cx, 16
  3473 00002907 66BA0200            <1> 	mov dx, 2
  3474 0000290B B400                <1> 	mov ah, 0
  3475 0000290D B010                <1> 	mov al, 00010000b
  3476 0000290F BB[7F3A0000]        <1> 	mov ebx, winblows
  3477 00002914 E8DF090000          <1> 	call showstring
  3478                              <1> 	
  3479 00002919 E89BFBFFFF          <1> 	call cursorgui
  3480                              <1> guistart:
  3481 0000291E E8D1FAFFFF          <1> 	call guistartin
  3482 00002923 C605[2C290000]00    <1> 	mov byte [copygui], 0
  3483 0000292A EBF2                <1> 	jmp guistart
  3484                              <1> 	
  3485                              <1> ;guicopy:	;;for double buffering
  3486                              <1> ;	mov byte [copygui], 1
  3487                              <1> ;	mov edi, [offscreenmemoffset]
  3488                              <1> ;	mov edx, 0
  3489                              <1> ;	mov ecx, 0
  3490                              <1> ;	mov dx, [mousecursorposition]
  3491                              <1> ;	mov cx, [mousecursorposition + 2]
  3492                              <1> ;	add edi, edx
  3493                              <1> ;	mov dx, [resolutionx2]
  3494                              <1> ;	inc cx
  3495                              <1> ;guicp2:
  3496                              <1> ;	add edi, edx
  3497                              <1> ;	dec cx
  3498                              <1> ;	cmp cx, 0
  3499                              <1> ;	jne guicp2
  3500                              <1> ;	sub edi, edx
  3501                              <1> ;	mov [cursorloc], edi
  3502                              <1> ;	mov ebx, cursorbmp
  3503                              <1> ;	mov cx, [resolutiony]
  3504                              <1> ;	rol ecx, 16
  3505                              <1> ;	mov cx, [resolutionx]
  3506                              <1> ;	mov esi, [physbaseptr]
  3507                              <1> ;	mov edi, [offscreenmemoffset]
  3508                              <1> ;guicp1:
  3509                              <1> ;	mov ax, [esi]
  3510                              <1> ;	mov [edi], ax
  3511                              <1> ;	add esi, 2
  3512                              <1> ;	add edi, 2
  3513                              <1> ;	cmp edi, [cursorloc]
  3514                              <1> ;	je copycursor
  3515                              <1> ;dncopycursor:
  3516                              <1> ;	dec cx
  3517                              <1> ;	cmp cx, 0
  3518                              <1> ;	jne guicp1
  3519                              <1> ;	mov cx, [resolutionx]
  3520                              <1> ;	rol ecx, 16
  3521                              <1> ;	dec cx
  3522                              <1> ;	cmp cx, 0
  3523                              <1> ;	rol ecx, 16
  3524                              <1> ;	jne guicp1
  3525                              <1> ;	mov byte [copygui], 0
  3526                              <1> ;	ret
  3527                              <1> ;copycursor:
  3528                              <1> ;	cmp ebx, cursorbmpend
  3529                              <1> ;	jae dncopycursor
  3530                              <1> ;	mov dx, [resolutionx2]
  3531                              <1> ;	add edi, edx
  3532                              <1> ;	mov [cursorloc], edi
  3533                              <1> ;	sub edi, edx
  3534                              <1> ;	dec ebx
  3535                              <1> ;	sub edi, 2
  3536                              <1> ;	sub esi, 2
  3537                              <1> ;	mov dx, 9
  3538                              <1> ;curscplp:
  3539                              <1> ;	inc ebx
  3540                              <1> ;	add esi, 2
  3541                              <1> ;	add edi, 2
  3542                              <1> ;	mov ax, [esi]
  3543                              <1> ;	mov [edi], ax
  3544                              <1> ;	mov al, [ebx]
  3545                              <1> ;	cmp al, 0
  3546                              <1> ;	je curscplp2
  3547                              <1> ;	mov word [edi], 1110011110011100b
  3548                              <1> ;curscplp2:
  3549                              <1> ;	dec cx
  3550                              <1> ;	cmp cx, 0
  3551                              <1> ;	je dncopycursor
  3552                              <1> ;	dec dx
  3553                              <1> ;	cmp dx, 0
  3554                              <1> ;	jne curscplp
  3555                              <1> ;	jmp dncopycursor
  3556                              <1> 	
  3557                              <1> 	
  3558                              <1> ;cursorloc: dd 0
  3559                              <1> 		
  3560                              <1> ;nextimage:	
  3561                              <1> ;	call guiclear
  3562                              <1> ;	mov esi, [bmpend]
  3563                              <1> ;	mov eax, 0
  3564                              <1> ;	mov ebx, 0
  3565                              <1> ;	mov ecx, 0
  3566                              <1> ;	mov edx, 0
  3567                              <1> ;	call showbmp
  3568                              <1> ;	jmp guistartin
  3569                              <1> 		
  3570 0000292C 00                  <1> copygui db 0
  3571 0000292D 00                  <1> graphicsset db 0
  3572 0000292E 0000                <1> graphicspos db 0,0
  3573 00002930 00                  <1> showcursorfonton db 0
  3574 00002931 00                  <1> savefonton db 0
  3575 00002932 00                  <1> mouseselecton db 0
  3576 00002933 00                  <1> guion db 0
  3577                              <1> 
  3578                              <1> 		
  3579                              <1> clearmousecursor:
  3580 00002934 BE[D7270000]        <1> 		mov esi, background
  3581 00002939 8B3D[2B4F0000]      <1> 		mov edi, [physbaseptr]
  3582 0000293F BA00000000          <1> 		mov edx, 0
  3583 00002944 B900000000          <1> 		mov ecx, 0
  3584 00002949 668B15[80260000]    <1> 		mov dx, [lastmouseposition]
  3585 00002950 668B0D[82260000]    <1> 		mov cx, [lastmouseposition + 2]
  3586 00002957 01D7                <1> 		add edi, edx
  3587 00002959 BA00000000          <1> 		mov edx, 0
  3588 0000295E 668B15[54370000]    <1> 		mov dx, [resolutionx2]
  3589 00002965 6681F90000          <1> 		cmp cx, 0
  3590 0000296A 740B                <1> 		je noyclr
  3591 0000296C 01D7                <1> yclr:	add edi, edx
  3592 0000296E 6649                <1> 		dec cx
  3593 00002970 6681F90000          <1> 		cmp cx, 0
  3594 00002975 75F5                <1> 		jne yclr
  3595 00002977 668B06              <1> noyclr:	mov ax, [esi]
  3596 0000297A C1C010              <1> 		rol eax, 16
  3597 0000297D 668B06              <1> 		mov ax, [esi]
  3598 00002980 8907                <1> 		mov [edi], eax
  3599 00002982 894704              <1> 		mov [edi + 4], eax
  3600 00002985 894708              <1> 		mov [edi + 8], eax
  3601 00002988 89470C              <1> 		mov [edi + 12], eax
  3602 0000298B 01D7                <1> 		add edi, edx
  3603 0000298D 6641                <1> 		inc cx
  3604 0000298F 6681F91000          <1> 		cmp cx, 16
  3605 00002994 72E1                <1> 		jb noyclr
  3606 00002996 C3                  <1> 		ret
  3607                              <1> 
  3608                              <1> switchmousepos:		;;switch were the mouse is located
  3609 00002997 BE[00120000]        <1> 		mov esi, mousecolorbuf
  3610 0000299C 8B3D[2B4F0000]      <1> 		mov edi, [physbaseptr]
  3611 000029A2 BA00000000          <1> 		mov edx, 0
  3612 000029A7 B900000000          <1> 		mov ecx, 0
  3613 000029AC 668B15[80260000]    <1> 		mov dx, [lastmouseposition]
  3614 000029B3 668B0D[82260000]    <1> 		mov cx, [lastmouseposition + 2]
  3615 000029BA 01D7                <1> 		add edi, edx
  3616 000029BC BA00000000          <1> 		mov edx, 0
  3617 000029C1 668B15[54370000]    <1> 		mov dx, [resolutionx2]
  3618 000029C8 6681F90000          <1> 		cmp cx, 0
  3619 000029CD 740B                <1> 		je noswmsy
  3620 000029CF 01D7                <1> swmsy:		add edi, edx
  3621 000029D1 6649                <1> 		dec cx
  3622 000029D3 6681F90000          <1> 		cmp cx, 0
  3623 000029D8 75F5                <1> 		jne swmsy
  3624 000029DA 8B06                <1> noswmsy:	mov eax, [esi]
  3625 000029DC 8B5E04              <1> 		mov ebx, [esi + 4]
  3626 000029DF 8907                <1> 		mov [edi], eax
  3627 000029E1 895F04              <1> 		mov [edi + 4], ebx
  3628 000029E4 8B4608              <1> 		mov eax, [esi + 8]
  3629 000029E7 8B5E0C              <1> 		mov ebx, [esi + 12]
  3630 000029EA 894708              <1> 		mov [edi + 8], eax
  3631 000029ED 895F0C              <1> 		mov [edi + 12], ebx
  3632 000029F0 01D7                <1> 		add edi, edx
  3633 000029F2 81C610000000        <1> 		add esi, 16
  3634 000029F8 81FE[00130000]      <1> 		cmp esi, mcolorend
  3635 000029FE 72DA                <1> 		jb noswmsy
  3636                              <1> 		
  3637                              <1> switchmousepos2:
  3638 00002A00 BE[00120000]        <1> 		mov esi, mousecolorbuf
  3639 00002A05 8B3D[2B4F0000]      <1> 		mov edi, [physbaseptr]
  3640 00002A0B BA00000000          <1> 		mov edx, 0
  3641 00002A10 B900000000          <1> 		mov ecx, 0
  3642 00002A15 668B15[84260000]    <1> 		mov dx, [mousecursorposition]
  3643 00002A1C 668B0D[86260000]    <1> 		mov cx, [mousecursorposition + 2]
  3644 00002A23 01D7                <1> 		add edi, edx
  3645 00002A25 BA00000000          <1> 		mov edx, 0
  3646 00002A2A 668B15[54370000]    <1> 		mov dx, [resolutionx2]
  3647 00002A31 6681F90000          <1> 		cmp cx, 0
  3648 00002A36 740B                <1> 		je noswmsy2
  3649 00002A38 01D7                <1> swmsy2:		add edi, edx
  3650 00002A3A 6649                <1> 		dec cx
  3651 00002A3C 6681F90000          <1> 		cmp cx, 0
  3652 00002A41 75F5                <1> 		jne swmsy2
  3653 00002A43 8B07                <1> noswmsy2:	mov eax, [edi]
  3654 00002A45 8B5F04              <1> 		mov ebx, [edi + 4]
  3655 00002A48 8906                <1> 		mov [esi], eax
  3656 00002A4A 895E04              <1> 		mov [esi + 4], ebx
  3657 00002A4D 8B4708              <1> 		mov eax, [edi + 8]
  3658 00002A50 8B5F0C              <1> 		mov ebx, [edi + 12]
  3659 00002A53 894608              <1> 		mov [esi + 8], eax
  3660 00002A56 895E0C              <1> 		mov [esi + 12], ebx
  3661 00002A59 01D7                <1> 		add edi, edx
  3662 00002A5B 81C610000000        <1> 		add esi, 16
  3663 00002A61 81FE[00130000]      <1> 		cmp esi, mcolorend
  3664 00002A67 72DA                <1> 		jb noswmsy2
  3665 00002A69 C3                  <1> 		ret
  3666                              <1> 
  3667 00002A6A 00                  <1> pbutton db 0
  3668 00002A6B 00                  <1> pLBUTTON db 0
  3669 00002A6C 00                  <1> pRBUTTON db 0
  3670 00002A6D 00000000            <1> dragging dw 0,0
  3671 00002A71 0000000000000000    <1> lastpos dw 0,0,0,0
  3672 00002A79 00000000            <1> colorbuf dw 0,0
  3673                              <1> 	
  3674                              <1> 	clickicon:
  3675 00002A7D B001                <1> 		mov al, 1
  3676 00002A7F A2[6A2A0000]        <1> 		mov [pbutton], al
  3677 00002A84 A0[6B2A0000]        <1> 		mov al, [pLBUTTON]
  3678 00002A89 2205[EF230000]      <1> 		and al, [LBUTTON]
  3679 00002A8F 8A25[6C2A0000]      <1> 		mov ah, [pRBUTTON]
  3680 00002A95 2225[F0230000]      <1> 		and ah, [RBUTTON]
  3681 00002A9B 08E0                <1> 		or al, ah
  3682 00002A9D 3C00                <1> 		cmp al, 0
  3683 00002A9F 741B                <1> 		je nodragclick
  3684 00002AA1 813D[6D2A0000]0100- <1> 		cmp dword [dragging], 1
  3685 00002AA9 0000                <1>
  3686 00002AAB 732D                <1> 		jae dragclick
  3687 00002AAD C705[6D2A0000]0100- <1> 		mov dword [dragging], 1
  3688 00002AB5 0000                <1>
  3689 00002AB7 E91E000000          <1> 		jmp dragclick
  3690                              <1> 	nodragclick:
  3691 00002ABC C705[6D2A0000]0000- <1> 		mov dword [dragging], 0
  3692 00002AC4 0000                <1>
  3693 00002AC6 A0[EF230000]        <1> 		mov al, [LBUTTON]
  3694 00002ACB A2[6B2A0000]        <1> 		mov [pLBUTTON], al
  3695 00002AD0 A0[F0230000]        <1> 		mov al, [RBUTTON]
  3696 00002AD5 A2[6C2A0000]        <1> 		mov [pRBUTTON], al
  3697                              <1> 	dragclick:
  3698 00002ADA 66B80000            <1> 		mov ax, 0
  3699 00002ADE BE[00100000]        <1> 		mov esi, graphicstable
  3700 00002AE3 C705[F6390000]0000- <1> 		mov dword [codepointer], 0
  3701 00002AEB 0000                <1>
  3702                              <1> 	clicon2:
  3703 00002AED BA00000000          <1> 		mov edx, 0
  3704 00002AF2 B900000000          <1> 		mov ecx, 0
  3705 00002AF7 66813E0100          <1> 		cmp word [esi], 1
  3706 00002AFC 0F841B000000        <1> 		je near iconselect
  3707 00002B02 66813E0200          <1> 		cmp word [esi], 2
  3708 00002B07 0F8472010000        <1> 		je near textselected
  3709 00002B0D 66813E0300          <1> 		cmp word [esi], 3
  3710 00002B12 0F84C7020000        <1> 		je near windowselect
  3711 00002B18 E901040000          <1> 		jmp nexticonsel
  3712                              <1> 	iconselect:
  3713 00002B1D 668B5606            <1> 		mov dx, [esi + 6]
  3714 00002B21 6689D0              <1> 		mov ax, dx
  3715 00002B24 668B4E08            <1> 		mov cx, [esi + 8]
  3716 00002B28 6689CB              <1> 		mov bx, cx
  3717 00002B2B 6681C32000          <1> 		add bx, 32
  3718 00002B30 6601D0              <1> 		add ax, dx
  3719 00002B33 813D[6D2A0000]0100- <1> 		cmp dword [dragging], 1
  3720 00002B3B 0000                <1>
  3721 00002B3D 746F                <1> 		je dragicon
  3722 00002B3F 813D[6D2A0000]0000- <1> 		cmp dword [dragging], 0
  3723 00002B47 0000                <1>
  3724 00002B49 7411                <1> 		je nodragiconcheck
  3725 00002B4B 3935[6D2A0000]      <1> 		cmp dword [dragging], esi
  3726 00002B51 0F85C7030000        <1> 		jne near nexticonsel
  3727 00002B57 E952000000          <1> 		jmp dragicon
  3728                              <1> 	nodragiconcheck:
  3729 00002B5C 663905[84260000]    <1> 		cmp [mousecursorposition], ax
  3730 00002B63 0F82B5030000        <1> 		jb near nexticonsel
  3731 00002B69 66054000            <1> 		add ax, 64
  3732 00002B6D 663905[84260000]    <1> 		cmp [mousecursorposition], ax
  3733 00002B74 0F87A4030000        <1> 		ja near nexticonsel
  3734 00002B7A 6629D0              <1> 		sub ax, dx
  3735 00002B7D 66390D[86260000]    <1> 		cmp [mousecursorposition + 2], cx
  3736 00002B84 0F8294030000        <1> 		jb near nexticonsel
  3737 00002B8A 66391D[86260000]    <1> 		cmp [mousecursorposition + 2], bx
  3738 00002B91 0F8787030000        <1> 		ja near nexticonsel
  3739 00002B97 668B460A            <1> 		mov ax, [esi + 10]
  3740 00002B9B 66250100            <1> 		and ax, 1
  3741 00002B9F 663D0100            <1> 		cmp ax, 1
  3742 00002BA3 0F84B6000000        <1> 		je near unselecticon
  3743 00002BA9 E98D000000          <1> 		jmp nodragicon
  3744                              <1> 	dragicon:
  3745 00002BAE 663905[80260000]    <1> 		cmp [lastmouseposition], ax
  3746 00002BB5 0F8263030000        <1> 		jb near nexticonsel
  3747 00002BBB 66054000            <1> 		add ax, 64
  3748 00002BBF 663905[80260000]    <1> 		cmp [lastmouseposition], ax
  3749 00002BC6 0F8752030000        <1> 		ja near nexticonsel
  3750 00002BCC 6629D0              <1> 		sub ax, dx
  3751 00002BCF 66390D[82260000]    <1> 		cmp [lastmouseposition + 2], cx
  3752 00002BD6 0F8242030000        <1> 		jb near nexticonsel
  3753 00002BDC 66391D[82260000]    <1> 		cmp [lastmouseposition + 2], bx
  3754 00002BE3 0F8735030000        <1> 		ja near nexticonsel
  3755 00002BE9 668B460A            <1> 		mov ax, [esi + 10]
  3756 00002BED 2410                <1> 		and al, 00010000b
  3757 00002BEF 3C10                <1> 		cmp al, 00010000b
  3758 00002BF1 7448                <1> 		je nodragicon
  3759 00002BF3 8935[6D2A0000]      <1> 		mov [dragging], esi
  3760 00002BF9 66D1E2              <1> 		shl dx, 1
  3761 00002BFC 662B15[80260000]    <1> 		sub dx, [lastmouseposition]
  3762 00002C03 660315[84260000]    <1> 		add dx, [mousecursorposition]
  3763 00002C0A 66D1EA              <1> 		shr dx, 1
  3764 00002C0D 66030D[86260000]    <1> 		add cx, [mousecursorposition + 2]
  3765 00002C14 662B0D[82260000]    <1> 		sub cx, [lastmouseposition + 2]
  3766 00002C1B 663B15[54370000]    <1> 		cmp dx, [resolutionx2]
  3767 00002C22 7607                <1> 		jbe chkyresdrgicn
  3768 00002C24 668B15[84260000]    <1> 		mov dx, [mousecursorposition]
  3769                              <1> 	chkyresdrgicn:
  3770 00002C2B 663B0D[50370000]    <1> 		cmp cx, [resolutiony]
  3771 00002C32 7607                <1> 		jbe nodragicon
  3772 00002C34 668B0D[86260000]    <1> 		mov cx, [mousecursorposition + 2]
  3773                              <1> 	nodragicon:
  3774 00002C3B 66814E0A0100        <1> 		or word [esi + 10], 1
  3775 00002C41 8B5E0C              <1> 		mov ebx, [esi + 12]
  3776 00002C44 668B460A            <1> 		mov ax, [esi + 10]
  3777 00002C48 8B7602              <1> 		mov esi, [esi + 2]
  3778 00002C4B C705[F6390000]0000- <1> 		mov dword [codepointer], 0
  3779 00002C53 0000                <1>
  3780 00002C55 E81D0A0000          <1> 		call showicon
  3781 00002C5A E9D8020000          <1> 		jmp doneiconsel
  3782                              <1> 	unselecticon:
  3783 00002C5F 6681660AFEFF        <1> 		and word [esi + 10], 0xFFFE
  3784 00002C65 8B5E0C              <1> 		mov ebx, [esi + 12]
  3785 00002C68 668B460A            <1> 		mov ax, [esi + 10]
  3786 00002C6C 8B7602              <1> 		mov esi, [esi + 2]
  3787 00002C6F 891D[F6390000]      <1> 		mov [codepointer], ebx
  3788 00002C75 E8FD090000          <1> 		call showicon
  3789 00002C7A E9B8020000          <1> 		jmp doneiconsel
  3790                              <1> 	textselected:
  3791 00002C7F 8B5E02              <1> 		mov ebx, [esi + 2]
  3792 00002C82 668B5606            <1> 		mov dx, [esi + 6]
  3793 00002C86 6689D0              <1> 		mov ax, dx
  3794 00002C89 668B4E08            <1> 		mov cx, [esi + 8]
  3795                              <1> 	lengthtesttext:
  3796 00002C8D 803B00              <1> 		cmp byte [ebx], 0
  3797 00002C90 7407                <1> 		je donetesttextlength
  3798 00002C92 43                  <1> 		inc ebx
  3799 00002C93 66051000            <1> 		add ax, 16
  3800 00002C97 EBF4                <1> 		jmp lengthtesttext
  3801                              <1> 	donetesttextlength:
  3802 00002C99 6689CB              <1> 		mov bx, cx
  3803 00002C9C 6681C30F00          <1> 		add bx, 15
  3804 00002CA1 813D[6D2A0000]0100- <1> 		cmp dword [dragging], 1
  3805 00002CA9 0000                <1>
  3806 00002CAB 7468                <1> 		je dragtext
  3807 00002CAD 813D[6D2A0000]0000- <1> 		cmp dword [dragging], 0
  3808 00002CB5 0000                <1>
  3809 00002CB7 7411                <1> 		je nodragtextcheck
  3810 00002CB9 3935[6D2A0000]      <1> 		cmp dword [dragging], esi
  3811 00002CBF 0F8559020000        <1> 		jne near nexticonsel
  3812 00002CC5 E94B000000          <1> 		jmp dragtext
  3813                              <1> 	nodragtextcheck:
  3814 00002CCA 663915[84260000]    <1> 		cmp [mousecursorposition], dx
  3815 00002CD1 0F8247020000        <1> 		jb near nexticonsel
  3816 00002CD7 663905[84260000]    <1> 		cmp [mousecursorposition], ax
  3817 00002CDE 0F873A020000        <1> 		ja near nexticonsel
  3818 00002CE4 66390D[86260000]    <1> 		cmp [mousecursorposition + 2], cx
  3819 00002CEB 0F822D020000        <1> 		jb near nexticonsel
  3820 00002CF1 66391D[86260000]    <1> 		cmp [mousecursorposition + 2], bx
  3821 00002CF8 0F8720020000        <1> 		ja near nexticonsel
  3822 00002CFE 668B460A            <1> 		mov ax, [esi + 10]
  3823 00002D02 66250100            <1> 		and ax, 1
  3824 00002D06 663D0100            <1> 		cmp ax, 1
  3825 00002D0A 0F84AB000000        <1> 		je near unselecttext
  3826 00002D10 E986000000          <1> 		jmp nodragtext
  3827                              <1> 	dragtext:
  3828 00002D15 663915[80260000]    <1> 		cmp [lastmouseposition], dx
  3829 00002D1C 0F82FC010000        <1> 		jb near nexticonsel
  3830 00002D22 663905[80260000]    <1> 		cmp [lastmouseposition], ax
  3831 00002D29 0F87EF010000        <1> 		ja near nexticonsel
  3832 00002D2F 66390D[82260000]    <1> 		cmp [lastmouseposition + 2], cx
  3833 00002D36 0F82E2010000        <1> 		jb near nexticonsel
  3834 00002D3C 66391D[82260000]    <1> 		cmp [lastmouseposition + 2], bx
  3835 00002D43 0F87D5010000        <1> 		ja near nexticonsel
  3836 00002D49 668B460A            <1> 		mov ax, [esi + 10]
  3837 00002D4D 2410                <1> 		and al, 00010000b
  3838 00002D4F 663D1000            <1> 		cmp ax, 00010000b
  3839 00002D53 0F8442000000        <1> 		je near nodragtext
  3840 00002D59 8935[6D2A0000]      <1> 		mov [dragging], esi
  3841 00002D5F 662B15[80260000]    <1> 		sub dx, [lastmouseposition]
  3842 00002D66 660315[84260000]    <1> 		add dx, [mousecursorposition]
  3843 00002D6D 66030D[86260000]    <1> 		add cx, [mousecursorposition + 2]
  3844 00002D74 662B0D[82260000]    <1> 		sub cx, [lastmouseposition + 2]
  3845 00002D7B 663B15[54370000]    <1> 		cmp dx, [resolutionx2]
  3846 00002D82 7607                <1> 		jbe chkyresdrgtxt
  3847 00002D84 668B15[84260000]    <1> 		mov dx, [mousecursorposition]
  3848                              <1> 	chkyresdrgtxt:
  3849 00002D8B 663B0D[50370000]    <1> 		cmp cx, [resolutiony]
  3850 00002D92 7607                <1> 		jbe nodragtext
  3851 00002D94 668B0D[86260000]    <1> 		mov cx, [mousecursorposition + 2]
  3852                              <1> 	nodragtext:
  3853 00002D9B 66814E0A0100        <1> 		or word [esi + 10], 1
  3854 00002DA1 8B5E0C              <1> 		mov ebx, [esi + 12]
  3855 00002DA4 891D[F6390000]      <1> 		mov [codepointer], ebx
  3856 00002DAA 668B460A            <1> 		mov ax, [esi + 10]
  3857 00002DAE 8B7602              <1> 		mov esi, [esi + 2]
  3858 00002DB1 E842050000          <1> 		call showstring
  3859 00002DB6 E97C010000          <1> 		jmp doneiconsel
  3860                              <1> 	unselecttext:
  3861 00002DBB 6681660AFEFF        <1> 		and word [esi + 10], 0xFFFE
  3862 00002DC1 8B5E0C              <1> 		mov ebx, [esi + 12]
  3863 00002DC4 668B460A            <1> 		mov ax, [esi + 10]
  3864 00002DC8 8B7602              <1> 		mov esi, [esi + 2]
  3865 00002DCB C705[F6390000]0000- <1> 		mov dword [codepointer], 0
  3866 00002DD3 0000                <1>
  3867 00002DD5 E81E050000          <1> 		call showstring
  3868 00002DDA E958010000          <1> 		jmp doneiconsel
  3869                              <1> windowselect:
  3870 00002DDF 8B7E02              <1> 		mov edi, [esi + 2]
  3871 00002DE2 668B5606            <1> 		mov dx, [esi + 6]
  3872 00002DE6 6689D0              <1> 		mov ax, dx
  3873 00002DE9 668B4E08            <1> 		mov cx, [esi + 8]
  3874 00002DED 6689CB              <1> 		mov bx, cx
  3875 00002DF0 6681C31000          <1> 		add bx, 16
  3876 00002DF5 813D[6D2A0000]0100- <1> 		cmp dword [dragging], 1
  3877 00002DFD 0000                <1>
  3878 00002DFF 746D                <1> 		je dragwin
  3879 00002E01 813D[6D2A0000]0000- <1> 		cmp dword [dragging], 0
  3880 00002E09 0000                <1>
  3881 00002E0B 7411                <1> 		je nodragwincheck
  3882 00002E0D 3935[6D2A0000]      <1> 		cmp dword [dragging], esi
  3883 00002E13 0F8505010000        <1> 		jne near nexticonsel
  3884 00002E19 E950000000          <1> 		jmp dragwin
  3885                              <1> 	nodragwincheck:
  3886 00002E1E 663905[84260000]    <1> 		cmp [mousecursorposition], ax
  3887 00002E25 0F82F3000000        <1> 		jb near nexticonsel
  3888 00002E2B 660307              <1> 		add ax, [edi]
  3889 00002E2E 660307              <1> 		add ax, [edi]
  3890 00002E31 663905[84260000]    <1> 		cmp [mousecursorposition], ax
  3891 00002E38 0F87E0000000        <1> 		ja near nexticonsel
  3892 00002E3E 66390D[86260000]    <1> 		cmp [mousecursorposition + 2], cx
  3893 00002E45 0F82D3000000        <1> 		jb near nexticonsel
  3894 00002E4B 66391D[86260000]    <1> 		cmp [mousecursorposition + 2], bx
  3895 00002E52 0F87C6000000        <1> 		ja near nexticonsel
  3896 00002E58 662D1400            <1> 		sub ax, 20
  3897 00002E5C 663905[84260000]    <1> 		cmp [mousecursorposition], ax
  3898 00002E63 0F8795000000        <1> 		ja near killwin
  3899 00002E69 E97C000000          <1> 		jmp nodragwin
  3900                              <1> 	dragwin:
  3901 00002E6E 663905[80260000]    <1> 		cmp [lastmouseposition], ax
  3902 00002E75 0F82A3000000        <1> 		jb near nexticonsel
  3903 00002E7B 660307              <1> 		add ax, [edi]
  3904 00002E7E 660307              <1> 		add ax, [edi]
  3905 00002E81 663905[80260000]    <1> 		cmp [lastmouseposition], ax
  3906 00002E88 0F8790000000        <1> 		ja near nexticonsel
  3907 00002E8E 66390D[82260000]    <1> 		cmp [lastmouseposition + 2], cx
  3908 00002E95 0F8283000000        <1> 		jb near nexticonsel
  3909 00002E9B 66391D[82260000]    <1> 		cmp [lastmouseposition + 2], bx
  3910 00002EA2 0F8776000000        <1> 		ja near nexticonsel
  3911 00002EA8 8935[6D2A0000]      <1> 		mov [dragging], esi
  3912 00002EAE 662B15[80260000]    <1> 		sub dx, [lastmouseposition]
  3913 00002EB5 660315[84260000]    <1> 		add dx, [mousecursorposition]
  3914 00002EBC 66030D[86260000]    <1> 		add cx, [mousecursorposition + 2]
  3915 00002EC3 662B0D[82260000]    <1> 		sub cx, [lastmouseposition + 2]
  3916 00002ECA 663B15[54370000]    <1> 		cmp dx, [resolutionx2]
  3917 00002ED1 7607                <1> 		jbe chkyresdrgwin
  3918 00002ED3 668B15[84260000]    <1> 		mov dx, [mousecursorposition]
  3919                              <1> 	chkyresdrgwin:
  3920 00002EDA 663B0D[50370000]    <1> 		cmp cx, [resolutiony]
  3921 00002EE1 7607                <1> 		jbe nodragwin
  3922 00002EE3 668B0D[86260000]    <1> 		mov cx, [mousecursorposition + 2]
  3923                              <1> 	nodragwin:
  3924 00002EEA 8B5E0C              <1> 		mov ebx, [esi + 12]
  3925 00002EED 668B460A            <1> 		mov ax, [esi + 10]
  3926 00002EF1 8B7602              <1> 		mov esi, [esi + 2]
  3927 00002EF4 E854040000          <1> 		call showwindow
  3928 00002EF9 E939000000          <1> 		jmp doneiconsel
  3929                              <1> 	killwin:
  3930 00002EFE 66C7060000          <1> 		mov word [esi], 0
  3931 00002F03 C705[58030000]0000- <1> 		mov dword [user2codepoint], 0
  3932 00002F0B 0000                <1>
  3933 00002F0D C605[99090000]00    <1> 		mov byte [termguion], 0
  3934 00002F14 E881F8FFFF          <1> 		call guiclear
  3935 00002F19 E939000000          <1> 		jmp doneiconsel2
  3936                              <1> 	nexticonsel:
  3937 00002F1E 6681660AFEFF        <1> 		and word [esi + 10], 0xFFFE
  3938 00002F24 81C610000000        <1> 		add esi, 16
  3939 00002F2A 81FE[00120000]      <1> 		cmp esi, graphicstableend
  3940 00002F30 7305                <1> 		jae doneiconsel
  3941 00002F32 E9B6FBFFFF          <1> 		jmp clicon2
  3942                              <1> 	doneiconsel:
  3943 00002F37 813D[6D2A0000]0100- <1> 		cmp dword [dragging], 1
  3944 00002F3F 0000                <1>
  3945 00002F41 7314                <1> 		jae doneiconsel2
  3946 00002F43 813D[F6390000]0000- <1> 		cmp dword [codepointer], 0
  3947 00002F4B 0000                <1>
  3948 00002F4D 7408                <1> 		je doneiconsel2
  3949 00002F4F 8B1D[F6390000]      <1> 		mov ebx, [codepointer]
  3950 00002F55 FFE3                <1> 		jmp ebx 
  3951                              <1> 	doneiconsel2:
  3952 00002F57 A0[EF230000]        <1> 		mov al, [LBUTTON]
  3953 00002F5C A2[6B2A0000]        <1> 		mov [pLBUTTON], al
  3954 00002F61 A0[F0230000]        <1> 		mov al, [RBUTTON]
  3955 00002F66 A2[6C2A0000]        <1> 		mov [pRBUTTON], al
  3956 00002F6B E8C4F9FFFF          <1> call clearmousecursor
  3957 00002F70 E83C000000          <1> call reloadallgraphics
  3958 00002F75 B900000000          <1> 		mov ecx, 0
  3959 00002F7A BA00000000          <1> 		mov edx, 0
  3960 00002F7F B400                <1> 		mov ah, 0
  3961 00002F81 B080                <1> 		mov al, 128
  3962 00002F83 668B15[84260000]    <1> 		mov dx, [mousecursorposition]
  3963 00002F8A 668B0D[86260000]    <1> 		mov cx, [mousecursorposition + 2]
  3964 00002F91 66BBE738            <1> 		mov bx, 0011100011100111b
  3965 00002F95 C605[30290000]01    <1> 		mov byte [showcursorfonton], 1
  3966 00002F9C E8C3070000          <1> 		call showfontvesa
  3967 00002FA1 C605[30290000]00    <1> 		mov byte [showcursorfonton], 0
  3968 00002FA8 C3                  <1> 		ret
  3969 00002FA9 00000000            <1> lastdrag dw 0,0
  3970 00002FAD 00000000            <1> grpctblpos dw 0,0
  3971                              <1> 
  3972                              <1> reloadallgraphics:
  3973 00002FB1 BF[00100000]        <1> 		mov edi, graphicstable
  3974                              <1> reloadgraphicsloop:
  3975 00002FB6 8B7702              <1> 		mov esi, [edi + 2]
  3976 00002FB9 668B5706            <1> 		mov dx, [edi + 6]
  3977 00002FBD 668B4F08            <1> 		mov cx, [edi + 8]
  3978 00002FC1 668B07              <1> 		mov ax, [edi]
  3979 00002FC4 668B5F0A            <1> 		mov bx, [edi + 10]
  3980 00002FC8 893D[AD2F0000]      <1> 		mov [grpctblpos], edi
  3981 00002FCE 3B3D[6D2A0000]      <1> 		cmp edi, [dragging]
  3982 00002FD4 741E                <1> 		je loadedgraphic
  3983 00002FD6 663D0100            <1> 		cmp ax, 1
  3984 00002FDA 0F8431000000        <1> 		je near icongraphic
  3985 00002FE0 663D0200            <1> 		cmp ax, 2
  3986 00002FE4 0F8437000000        <1> 		je near stringgraphic
  3987 00002FEA 663D0300            <1> 		cmp ax, 3
  3988 00002FEE 0F8416000000        <1> 		je near windowgraphic
  3989 00002FF4 8B3D[AD2F0000]      <1> loadedgraphic:  mov edi, [grpctblpos]
  3990 00002FFA 81C710000000        <1> 		add edi, 16
  3991 00003000 81FF[00120000]      <1> 		cmp edi, graphicstableend
  3992 00003006 7329                <1> 		jae donereloadgraphics
  3993 00003008 EBAC                <1> 		jmp reloadgraphicsloop
  3994 0000300A E891030000          <1> windowgraphic:	call showwindow2
  3995 0000300F EBE3                <1> 		jmp loadedgraphic
  3996 00003011 80E301              <1> icongraphic:	and bl, 1
  3997 00003014 881D[FA390000]      <1> 		mov [iconselected], bl
  3998 0000301A E86B060000          <1> 		call showicon2
  3999 0000301F EBD3                <1> 		jmp loadedgraphic
  4000 00003021 80E301              <1> stringgraphic:  and bl, 1
  4001 00003024 881D[32290000]      <1> 		mov [mouseselecton], bl
  4002 0000302A E8DC020000          <1> 		call showstring2
  4003 0000302F EBC3                <1> 		jmp loadedgraphic
  4004                              <1> donereloadgraphics:
  4005 00003031 8B3D[6D2A0000]      <1> 		mov edi, [dragging]
  4006 00003037 81FF[00100000]      <1> 		cmp edi, graphicstable
  4007 0000303D 7226                <1> 		jb notcorrectdrag
  4008 0000303F 668B07              <1> 		mov ax, [edi]
  4009 00003042 8B7702              <1> 		mov esi, [edi + 2]
  4010 00003045 668B5706            <1> 		mov dx, [edi + 6]
  4011 00003049 668B4F08            <1> 		mov cx, [edi + 8]
  4012 0000304D 668B5F0A            <1> 		mov bx, [edi + 10]
  4013 00003051 663D0100            <1> 		cmp ax, 1
  4014 00003055 750F                <1> 		jne noticondragging
  4015 00003057 80E301              <1> 		and bl, 1
  4016 0000305A 881D[FA390000]      <1> 		mov [iconselected], bl
  4017 00003060 E825060000          <1> 		call showicon2
  4018                              <1> notcorrectdrag:
  4019 00003065 C3                  <1> 		ret
  4020                              <1> 
  4021                              <1> 	noticondragging:
  4022 00003066 663D0200            <1> 		cmp ax, 2
  4023 0000306A 75F9                <1> 		jne notcorrectdrag
  4024 0000306C 80E301              <1> 		and bl, 1
  4025 0000306F 881D[32290000]      <1> 		mov [mouseselecton], bl
  4026 00003075 E891020000          <1> 		call showstring2
  4027 0000307A EBE9                <1> 		jmp notcorrectdrag
  4028                              <1> 
  4029 0000307C 00<rept>            <1> grphbuf times 16 db 0
  4030                              <1> 	graphicsadd:
  4031 0000308C BF[00100000]        <1> 		mov edi, graphicstable
  4032                              <1> 	shwgrph1:
  4033 00003091 397702              <1> 		cmp dword [edi + 2], esi
  4034 00003094 7414                <1> 		je showgraphicsreplace2
  4035 00003096 81C710000000        <1> 		add edi, 16
  4036 0000309C 81FF[00120000]      <1> 		cmp edi, graphicstableend
  4037 000030A2 0F8335020000        <1> 		jae near showgraphicsnew
  4038 000030A8 EBE7                <1> 		jmp shwgrph1
  4039                              <1> 	showgraphicsreplace2:
  4040 000030AA 8935[7E300000]      <1> 		mov [grphbuf + 2], esi
  4041 000030B0 668915[82300000]    <1> 		mov [grphbuf + 6], dx
  4042 000030B7 66890D[84300000]    <1> 		mov [grphbuf + 8], cx
  4043 000030BE 891D[88300000]      <1> 		mov [grphbuf + 12], ebx
  4044 000030C4 B700                <1> 		mov bh, 0
  4045 000030C6 88E3                <1> 		mov bl, ah
  4046 000030C8 B400                <1> 		mov ah, 0
  4047 000030CA 66A3[86300000]      <1> 		mov [grphbuf + 10], ax	
  4048 000030D0 66891D[7C300000]    <1> 		mov [grphbuf], bx
  4049 000030D7 66A1[7C300000]      <1> 		mov ax, [grphbuf]
  4050 000030DD 663D0100            <1> 		cmp ax, 1
  4051 000030E1 0F8419000000        <1> 		je near replaceicon
  4052 000030E7 663D0200            <1> 		cmp ax, 2
  4053 000030EB 0F8493000000        <1> 		je near replacestring
  4054 000030F1 663D0300            <1> 		cmp ax, 3
  4055 000030F5 0F840F010000        <1> 		je near replacewindow
  4056 000030FB E9BA010000          <1> 		jmp showgraphicsreplace
  4057                              <1> 	replaceicon:
  4058 00003100 893D[712A0000]      <1> 		mov [lastpos], edi
  4059 00003106 8935[752A0000]      <1> 		mov [lastpos + 4], esi
  4060 0000310C 8B7702              <1> 		mov esi, [edi + 2]
  4061 0000310F 668B5F0C            <1> 		mov bx, [edi + 12]
  4062 00003113 668B5706            <1> 		mov dx, [edi + 6]
  4063 00003117 668B4F08            <1> 		mov cx, [edi + 8]
  4064 0000311B 668B06              <1> 		mov ax, [esi]
  4065 0000311E 66A3[792A0000]      <1> 		mov [colorbuf], ax
  4066 00003124 66A1[D7270000]      <1> 		mov ax, [background]
  4067 0000312A 668906              <1> 		mov [esi], ax
  4068 0000312D 8B5F0C              <1> 		mov ebx, [edi + 12]
  4069 00003130 668B470A            <1> 		mov ax, [edi + 10]
  4070 00003134 2401                <1> 		and al, 1
  4071 00003136 A2[FA390000]        <1> 		mov [iconselected], al
  4072 0000313B 668B470A            <1> 		mov ax, [edi + 10]
  4073 0000313F E846050000          <1> 		call showicon2
  4074 00003144 8B3D[712A0000]      <1> 		mov edi, [lastpos]
  4075 0000314A 8B7702              <1> 		mov esi, [edi + 2]
  4076 0000314D 66A1[792A0000]      <1> 		mov ax, [colorbuf]
  4077 00003153 668906              <1> 		mov [esi], ax
  4078 00003156 8B35[752A0000]      <1> 		mov esi, [lastpos + 4]
  4079 0000315C 668B15[82300000]    <1> 		mov dx, [grphbuf + 6]
  4080 00003163 668B0D[84300000]    <1> 		mov cx, [grphbuf + 8]
  4081 0000316A 668B1D[7C300000]    <1> 		mov bx, [grphbuf]
  4082 00003171 66A1[86300000]      <1> 		mov ax, [grphbuf + 10]
  4083 00003177 88DC                <1> 		mov ah, bl
  4084 00003179 8B1D[88300000]      <1> 		mov ebx, [grphbuf + 12]
  4085 0000317F E936010000          <1> 		jmp showgraphicsreplace
  4086                              <1> 	replacestring:
  4087 00003184 893D[712A0000]      <1> 		mov [lastpos], edi
  4088 0000318A 8935[752A0000]      <1> 		mov [lastpos + 4], esi
  4089 00003190 8B5F0C              <1> 		mov ebx, [edi + 12]
  4090 00003193 8B7702              <1> 		mov esi, [edi + 2]
  4091 00003196 668B5706            <1> 		mov dx, [edi + 6]
  4092 0000319A 668B4F08            <1> 		mov cx, [edi + 8]
  4093 0000319E 66A1[3B330000]      <1> 		mov ax, [colorfont2]
  4094 000031A4 66A3[792A0000]      <1> 		mov [colorbuf], ax
  4095 000031AA 66A1[D7270000]      <1> 		mov ax, [background]
  4096 000031B0 66A3[3B330000]      <1> 		mov [colorfont2], ax		
  4097 000031B6 8B5F0C              <1> 		mov ebx, [edi + 12]
  4098 000031B9 668B470A            <1> 		mov ax, [edi + 10]
  4099 000031BD 2401                <1> 		and al, 1
  4100 000031BF A2[32290000]        <1> 		mov [mouseselecton], al
  4101 000031C4 668B470A            <1> 		mov ax, [edi + 10]
  4102 000031C8 E83E010000          <1> 		call showstring2
  4103 000031CD 66A1[792A0000]      <1> 		mov ax, [colorbuf]
  4104 000031D3 66A3[3B330000]      <1> 		mov [colorfont2], ax
  4105 000031D9 8B3D[712A0000]      <1> 		mov edi, [lastpos]
  4106 000031DF 8B7702              <1> 		mov esi, [edi + 2]
  4107 000031E2 668B15[82300000]    <1> 		mov dx, [grphbuf + 6]
  4108 000031E9 668B0D[84300000]    <1> 		mov cx, [grphbuf + 8]
  4109 000031F0 668B1D[7C300000]    <1> 		mov bx, [grphbuf]
  4110 000031F7 66A1[86300000]      <1> 		mov ax, [grphbuf + 10]
  4111 000031FD 88DC                <1> 		mov ah, bl
  4112 000031FF 8B1D[88300000]      <1> 		mov ebx, [grphbuf + 12]
  4113 00003205 E9B0000000          <1> 		jmp showgraphicsreplace
  4114                              <1> 	replacewindow:
  4115 0000320A 893D[712A0000]      <1> 		mov [lastpos], edi
  4116 00003210 8935[752A0000]      <1> 		mov [lastpos + 4], esi
  4117 00003216 8B7702              <1> 		mov esi, [edi + 2]
  4118 00003219 8B3D[49330000]      <1> 		mov edi, [windowbufloc]
  4119 0000321F BA00000000          <1> 		mov edx, 0
  4120 00003224 668B15[54370000]    <1> 		mov dx, [resolutionx2]
  4121 0000322B C1E204              <1> 		shl edx, 4
  4122 0000322E 29D7                <1> 		sub edi, edx
  4123 00003230 BA00000000          <1> 		mov edx, 0
  4124 00003235 668B16              <1> 		mov dx, [esi]
  4125 00003238 660316              <1> 		add dx, [esi]
  4126 0000323B 668B4E02            <1> 		mov cx, [esi + 2]
  4127 0000323F 6681C11000          <1> 		add cx, 16
  4128 00003244 66A1[D7270000]      <1> 		mov ax, [background]
  4129                              <1> 	clearwindow:
  4130 0000324A 668907              <1> 		mov [edi], ax
  4131 0000324D 81C702000000        <1> 		add edi, 2
  4132 00003253 81EA02000000        <1> 		sub edx, 2
  4133 00003259 81FA00000000        <1> 		cmp edx, 0
  4134 0000325F 75E9                <1> 		jne clearwindow
  4135 00003261 6649                <1> 		dec cx
  4136 00003263 668B15[54370000]    <1> 		mov dx, [resolutionx2]
  4137 0000326A 662B16              <1> 		sub dx, [esi]
  4138 0000326D 662B16              <1> 		sub dx, [esi]
  4139 00003270 01D7                <1> 		add edi, edx
  4140 00003272 668B16              <1> 		mov dx, [esi]
  4141 00003275 660316              <1> 		add dx, [esi]
  4142 00003278 6681F90000          <1> 		cmp cx, 0
  4143 0000327D 75CB                <1> 		jne clearwindow
  4144 0000327F C605[9A090000]00    <1> 		mov byte [termcopyon], 0
  4145 00003286 8B3D[712A0000]      <1> 		mov edi, [lastpos]
  4146 0000328C 8B35[7E300000]      <1> 		mov esi, [grphbuf + 2]
  4147 00003292 668B15[82300000]    <1> 		mov dx, [grphbuf + 6]
  4148 00003299 668B0D[84300000]    <1> 		mov cx, [grphbuf + 8]
  4149 000032A0 668B1D[7C300000]    <1> 		mov bx, [grphbuf]
  4150 000032A7 66A1[86300000]      <1> 		mov ax, [grphbuf + 10]
  4151 000032AD 88DC                <1> 		mov ah, bl
  4152 000032AF 8B1D[88300000]      <1> 		mov ebx, [grphbuf + 12]
  4153 000032B5 E900000000          <1> 		jmp showgraphicsreplace
  4154                              <1> 	showgraphicsreplace:
  4155 000032BA 897702              <1> 		mov [edi + 2], esi
  4156 000032BD 66895706            <1> 		mov [edi + 6], dx
  4157 000032C1 66894F08            <1> 		mov [edi + 8], cx
  4158 000032C5 895F0C              <1> 		mov [edi + 12], ebx
  4159 000032C8 B700                <1> 		mov bh, 0
  4160 000032CA 88E3                <1> 		mov bl, ah
  4161 000032CC B400                <1> 		mov ah, 0
  4162 000032CE 6689470A            <1> 		mov [edi + 10], ax
  4163 000032D2 66891F              <1> 		mov [edi], bx
  4164 000032D5 8B5F0C              <1> 		mov ebx, [edi + 12]
  4165 000032D8 668B470A            <1> 		mov ax, [edi + 10]
  4166 000032DC C3                  <1> 		ret
  4167                              <1> 	showgraphicsnew:
  4168 000032DD BF[00100000]        <1> 		mov edi, graphicstable
  4169                              <1> 	shwgrph2:
  4170 000032E2 66813F0000          <1> 		cmp word [edi], 0
  4171 000032E7 74D1                <1> 		je showgraphicsreplace
  4172 000032E9 81C710000000        <1> 		add edi, 16
  4173 000032EF 81FF[00120000]      <1> 		cmp edi, graphicstableend
  4174 000032F5 72EB                <1> 		jb shwgrph2
  4175                              <1> 	showgraphicsdone:
  4176 000032F7 C3                  <1> 		ret
  4177                              <1> 
  4178                              <1> 	showstring:
  4179 000032F8 A2[32290000]        <1> 		mov [mouseselecton], al
  4180 000032FD 8025[32290000]01    <1> 		and byte [mouseselecton], 1
  4181 00003304 B402                <1> 		mov ah, 2
  4182 00003306 E881FDFFFF          <1> 		call graphicsadd
  4183                              <1> 	showstring2:
  4184 0000330B B400                <1> 		mov ah, 0
  4185 0000330D 8A06                <1> 		mov al, [esi]
  4186 0000330F 3C00                <1> 		cmp al, 0
  4187 00003311 7420                <1> 		je doneshowstring
  4188 00003313 46                  <1> 		inc esi
  4189 00003314 8935[A3390000]      <1> 		mov [showstringesi], esi
  4190 0000331A 668B1D[3B330000]    <1> 		mov bx, [colorfont2]
  4191 00003321 E83E040000          <1> 		call showfontvesa
  4192 00003326 6681C20800          <1> 		add dx, 8
  4193 0000332B 8B35[A3390000]      <1> 		mov esi, [showstringesi]
  4194 00003331 EBD8                <1> 		jmp showstring2
  4195                              <1> 	doneshowstring:
  4196 00003333 C605[32290000]00    <1> 		mov byte [mouseselecton], 0
  4197 0000333A C3                  <1> 		ret
  4198                              <1> 
  4199 0000333B FFFF                <1> colorfont2 dw 0xFFFF
  4200 0000333D 0000                <1> winvcopystx dw 0
  4201 0000333F 0000                <1> winvcopysty dw 0
  4202 00003341 0000                <1> winvcopydx dw 0
  4203 00003343 0000                <1> winvcopycx dw 0
  4204 00003345 FFFF0000            <1> windowcolor dw 0xFFFF,0x0
  4205 00003349 00000000            <1> windowbufloc: dw 0,0
  4206                              <1> 
  4207                              <1> 	showwindow:	;;windowstuff in si, position in (dx, cx), nothing in ax, code in bx
  4208 0000334D C605[99090000]01    <1> 		mov byte [termguion], 1
  4209 00003354 6681C11000          <1> 		add cx, 16
  4210 00003359 668915[3D330000]    <1> 		mov [winvcopystx], dx
  4211 00003360 66890D[3F330000]    <1> 		mov [winvcopysty], cx
  4212 00003367 668B16              <1> 		mov dx, [esi]
  4213 0000336A 668B4E02            <1> 		mov cx, [esi + 2]
  4214 0000336E 6601D2              <1> 		add dx, dx
  4215 00003371 668915[41330000]    <1> 		mov [winvcopydx], dx
  4216 00003378 66890D[43330000]    <1> 		mov [winvcopycx], cx
  4217 0000337F 668B0D[3F330000]    <1> 		mov cx, [winvcopysty]
  4218 00003386 6681E91000          <1> 		sub cx, 16
  4219 0000338B 668B15[3D330000]    <1> 		mov dx, [winvcopystx]
  4220 00003392 C605[9A090000]00    <1> 		mov byte [termcopyon], 0
  4221 00003399 B403                <1> 		mov ah, 3
  4222 0000339B E8ECFCFFFF          <1> 		call graphicsadd
  4223                              <1> 	showwindow2:
  4224 000033A0 6681C11000          <1> 		add cx, 16
  4225 000033A5 668915[3D330000]    <1> 		mov [winvcopystx], dx
  4226 000033AC 66890D[3F330000]    <1> 		mov [winvcopysty], cx
  4227 000033B3 668B16              <1> 		mov dx, [esi]
  4228 000033B6 668B4E02            <1> 		mov cx, [esi + 2]
  4229 000033BA 6601D2              <1> 		add dx, dx
  4230 000033BD 668915[41330000]    <1> 		mov [winvcopydx], dx
  4231 000033C4 66890D[43330000]    <1> 		mov [winvcopycx], cx
  4232 000033CB 8B3D[49330000]      <1> 		mov edi, [windowbufloc]
  4233 000033D1 BA00000000          <1> 		mov edx, 0
  4234 000033D6 668B15[54370000]    <1> 		mov dx, [resolutionx2]
  4235 000033DD C1E204              <1> 		shl edx, 4
  4236 000033E0 29D7                <1> 		sub edi, edx
  4237 000033E2 803D[9A090000]00    <1> 		cmp byte [termcopyon], 0
  4238 000033E9 753E                <1> 		jne nocleartitlebarpos
  4239 000033EB 8B3D[2B4F0000]      <1> 		mov edi, [physbaseptr]
  4240 000033F1 BA00000000          <1> 		mov edx, 0
  4241 000033F6 668B15[3D330000]    <1> 		mov dx, [winvcopystx]
  4242 000033FD 01D7                <1> 		add edi, edx
  4243 000033FF 668B0D[3F330000]    <1> 		mov cx, [winvcopysty]
  4244 00003406 6681E91000          <1> 		sub cx, 16
  4245 0000340B 6681F90000          <1> 		cmp cx, 0
  4246 00003410 7417                <1> 		je nocleartitlebarpos
  4247                              <1> 	cleartitlebarpos:
  4248 00003412 BA00000000          <1> 		mov edx, 0
  4249 00003417 668B15[54370000]    <1> 		mov dx, [resolutionx2]
  4250 0000341E 01D7                <1> 		add edi, edx
  4251 00003420 6649                <1> 		dec cx
  4252 00003422 6681F90000          <1> 		cmp cx, 0
  4253 00003427 75E9                <1> 		jne cleartitlebarpos
  4254                              <1> 	nocleartitlebarpos:
  4255 00003429 66B91000            <1> 		mov cx, 16
  4256 0000342D 668B15[41330000]    <1> 		mov dx, [winvcopydx]
  4257 00003434 6681F90000          <1> 		cmp cx, 0
  4258 00003439 0F844B000000        <1> 		je near canceltitlebarput
  4259 0000343F 6681FA0000          <1> 		cmp dx, 0
  4260 00003444 0F8440000000        <1> 		je near canceltitlebarput
  4261                              <1> 	titlebarput:
  4262 0000344A 66A1[45330000]      <1> 		mov ax, [windowcolor]
  4263 00003450 668907              <1> 		mov [edi], ax
  4264 00003453 6681EA0200          <1> 		sub dx, 2
  4265 00003458 81C702000000        <1> 		add edi, 2
  4266 0000345E 6681FA0000          <1> 		cmp dx, 0
  4267 00003463 75E5                <1> 		jne titlebarput
  4268 00003465 BA00000000          <1> 		mov edx, 0
  4269 0000346A 668B15[54370000]    <1> 		mov dx, [resolutionx2]
  4270 00003471 6649                <1> 		dec cx
  4271 00003473 662B15[41330000]    <1> 		sub dx, [winvcopydx]
  4272 0000347A 01D7                <1> 		add edi, edx
  4273 0000347C 668B15[41330000]    <1> 		mov dx, [winvcopydx]
  4274 00003483 6681F90000          <1> 		cmp cx, 0
  4275 00003488 75C0                <1> 		jne titlebarput
  4276                              <1> 	canceltitlebarput:
  4277 0000348A 893D[49330000]      <1> 		mov [windowbufloc], edi
  4278 00003490 803D[9A090000]02    <1> 		cmp byte [termcopyon], 2
  4279 00003497 0F8463000000        <1> 		je near winvcpst
  4280 0000349D 66B80000            <1> 		mov ax, 0
  4281 000034A1 81C604000000        <1> 		add esi, 4
  4282 000034A7 668B15[3D330000]    <1> 		mov dx, [winvcopystx]
  4283 000034AE 668B0D[3F330000]    <1> 		mov cx, [winvcopysty]
  4284 000034B5 6681E91000          <1> 		sub cx, 16
  4285 000034BA 66BB0000            <1> 		mov bx, 0
  4286 000034BE C605[32290000]01    <1> 		mov byte [mouseselecton], 1
  4287 000034C5 E841FEFFFF          <1> 		call showstring2
  4288 000034CA B058                <1> 		mov al, "X"
  4289 000034CC B400                <1> 		mov ah, 0
  4290 000034CE 668B1D[3B330000]    <1> 		mov bx, [colorfont2]
  4291 000034D5 668B15[3D330000]    <1> 		mov dx, [winvcopystx]
  4292 000034DC 668B0D[3F330000]    <1> 		mov cx, [winvcopysty]
  4293 000034E3 6681E91000          <1> 		sub cx, 16
  4294 000034E8 6681EA1400          <1> 		sub dx, 20
  4295 000034ED 660315[41330000]    <1> 		add dx, [winvcopydx]
  4296 000034F4 C605[32290000]01    <1> 		mov byte [mouseselecton], 1
  4297 000034FB E864020000          <1> 		call showfontvesa
  4298                              <1> 	winvcpst:
  4299 00003500 8B3D[49330000]      <1> 		mov edi, [windowbufloc]
  4300 00003506 E957000000          <1> 		jmp windowvideocopyset
  4301                              <1> 
  4302                              <1> 	windowvideocopy:
  4303 0000350B 8B3D[49330000]      <1> 		mov edi, [windowbufloc]
  4304 00003511 3B3D[2B4F0000]      <1> 		cmp edi, [physbaseptr]
  4305 00003517 0F8345000000        <1> 		jae near windowvideocopyset
  4306 0000351D B900000000          <1> 		mov ecx, 0
  4307 00003522 BA00000000          <1> 		mov edx, 0
  4308 00003527 668B15[3D330000]    <1> 		mov dx, [winvcopystx]
  4309 0000352E 668B0D[3F330000]    <1> 		mov cx, [winvcopysty]
  4310 00003535 8B3D[2B4F0000]      <1> 		mov edi, [physbaseptr]
  4311 0000353B 01D7                <1> 		add edi, edx
  4312 0000353D 81F900000000        <1> 		cmp ecx, 0
  4313 00003543 741D                <1> 		je windowvideocopyset
  4314                              <1> 	yrescopylp:
  4315 00003545 BA00000000          <1> 		mov edx, 0
  4316 0000354A 668B15[54370000]    <1> 		mov dx, [resolutionx2]
  4317 00003551 01D7                <1> 		add edi, edx
  4318 00003553 6649                <1> 		dec cx
  4319 00003555 6681F90000          <1> 		cmp cx, 0
  4320 0000355A 75E9                <1> 		jne yrescopylp
  4321 0000355C 893D[49330000]      <1> 		mov [windowbufloc], edi
  4322                              <1> 	windowvideocopyset:
  4323 00003562 66B90000            <1> 		mov cx, 0
  4324 00003566 66890D[6F360000]    <1> 		mov [charposline], cx
  4325 0000356D BE[851C0000]        <1> 		mov esi, videobuf2
  4326 00003572 8935[71360000]      <1> 		mov [charposvbuf], esi
  4327 00003578 8A1E                <1> 		mov bl, [esi]
  4328 0000357A B700                <1> 		mov bh, 0
  4329 0000357C 66C1E304            <1> 		shl bx, 4
  4330 00003580 678AB7[E344]        <1> 		mov dh, [fonts + bx]
  4331 00003585 D0CE                <1> 		ror dh, 1
  4332 00003587 89FE                <1> 		mov esi, edi
  4333                              <1> 	copywindow:
  4334 00003589 B201                <1> 		mov dl, 1
  4335 0000358B D0C6                <1> 		rol dh, 1
  4336 0000358D 20F2                <1> 		and dl, dh
  4337 0000358F 66A1[47330000]      <1> 		mov ax, [windowcolor + 2]
  4338 00003595 668907              <1> 		mov [edi], ax
  4339 00003598 80FA00              <1> 		cmp dl, 0
  4340 0000359B 7409                <1> 		je nowritewin
  4341 0000359D 66A1[45330000]      <1> 		mov ax, [windowcolor]
  4342 000035A3 668907              <1> 		mov [edi], ax
  4343                              <1> 	nowritewin:
  4344 000035A6 81C702000000        <1> 		add edi, 2
  4345 000035AC FEC1                <1> 		inc cl
  4346 000035AE 80F908              <1> 		cmp cl, 8
  4347 000035B1 75D6                <1> 		jne copywindow
  4348 000035B3 6643                <1> 		inc bx
  4349 000035B5 B100                <1> 		mov cl, 0
  4350 000035B7 BA00000000          <1> 		mov edx, 0
  4351 000035BC 668B15[54370000]    <1> 		mov dx, [resolutionx2]
  4352 000035C3 01D6                <1> 		add esi, edx
  4353 000035C5 89F7                <1> 		mov edi, esi
  4354 000035C7 678AB7[E344]        <1> 		mov dh, [fonts + bx]
  4355 000035CC D0CE                <1> 		ror dh, 1
  4356 000035CE FEC5                <1> 		inc ch
  4357 000035D0 80FD10              <1> 		cmp ch, 16
  4358 000035D3 75B4                <1> 		jne copywindow
  4359 000035D5 66B90000            <1> 		mov cx, 0
  4360 000035D9 8B3D[71360000]      <1> 		mov edi, [charposvbuf]
  4361 000035DF 81C702000000        <1> 		add edi, 2
  4362 000035E5 81FF[452F0000]      <1> 		cmp edi, videobufend
  4363 000035EB 7370                <1> 		jae donewincopynow
  4364 000035ED 8A1F                <1> 		mov bl, [edi]
  4365 000035EF B700                <1> 		mov bh, 0
  4366 000035F1 66C1E304            <1> 		shl bx, 4
  4367 000035F5 893D[71360000]      <1> 		mov [charposvbuf], edi
  4368 000035FB BA00000000          <1> 		mov edx, 0
  4369 00003600 668B15[54370000]    <1> 		mov dx, [resolutionx2]
  4370 00003607 C1E204              <1> 		shl edx, 4
  4371 0000360A 29D6                <1> 		sub esi, edx
  4372 0000360C 81C610000000        <1> 		add esi, 16
  4373 00003612 89F7                <1> 		mov edi, esi
  4374 00003614 668B0D[6F360000]    <1> 		mov cx, [charposline]
  4375 0000361B 6641                <1> 		inc cx
  4376 0000361D 6681F95000          <1> 		cmp cx, 80
  4377 00003622 7317                <1> 		jae fixwindowcopy
  4378 00003624 66890D[6F360000]    <1> 		mov [charposline], cx
  4379 0000362B 66B90000            <1> 		mov cx, 0
  4380 0000362F 678AB7[E344]        <1> 		mov dh, [fonts + bx]
  4381 00003634 D0CE                <1> 		ror dh, 1
  4382 00003636 E94EFFFFFF          <1> 		jmp copywindow
  4383                              <1> fixwindowcopy:
  4384 0000363B 66B90000            <1> 		mov cx, 0
  4385 0000363F 66890D[6F360000]    <1> 		mov [charposline], cx
  4386 00003646 662B15[41330000]    <1> 		sub dx, [winvcopydx]
  4387 0000364D 01D6                <1> 		add esi, edx
  4388 0000364F 89F7                <1> 		mov edi, esi
  4389 00003651 678AB7[E344]        <1> 		mov dh, [fonts + bx]
  4390 00003656 D0CE                <1> 		ror dh, 1
  4391 00003658 E92CFFFFFF          <1> 		jmp copywindow
  4392                              <1> donewincopynow:
  4393 0000365D 803D[9A090000]01    <1> 		cmp byte [termcopyon], 1
  4394 00003664 7501                <1> 		jne forgetresetstuff
  4395 00003666 61                  <1> 		popa
  4396                              <1> forgetresetstuff:
  4397 00003667 C605[9A090000]00    <1> 		mov byte [termcopyon], 0
  4398 0000366E C3                  <1> 		ret
  4399                              <1> 
  4400 0000366F 0000                <1> charposline dw 0
  4401 00003671 00000000            <1> charposvbuf dw 0,0
  4402 00003675 0000                <1> iconcolor dw 0
  4403                              <1> 	showicon:	;;icon in si, position in (dx,cx), selected in ax, code in bx
  4404 00003677 A2[FA390000]        <1> 		mov [iconselected], al
  4405 0000367C 8025[FA390000]01    <1> 		and byte [iconselected], 1
  4406 00003683 B401                <1> 		mov ah, 1
  4407 00003685 E802FAFFFF          <1> 		call graphicsadd
  4408                              <1> 	showicon2:
  4409 0000368A 8B3D[2B4F0000]      <1> 		mov edi, [physbaseptr]
  4410 00003690 6601D2              <1> 		add dx, dx
  4411 00003693 663B15[54370000]    <1> 		cmp dx, [resolutionx2]
  4412 0000369A 720C                <1> 		jb screenxgood
  4413 0000369C 668B15[54370000]    <1> 		mov dx, [resolutionx2]
  4414 000036A3 6681EA4000          <1> 		sub dx, 64
  4415                              <1> 	screenxgood:
  4416 000036A8 6681F90000          <1> 		cmp cx, 0
  4417 000036AD 7425                <1> 		je noscreenygoodchk
  4418 000036AF 663B0D[50370000]    <1> 		cmp cx, [resolutiony]
  4419 000036B6 720C                <1> 		jb screenygood
  4420 000036B8 668B0D[50370000]    <1> 		mov cx, [resolutiony]
  4421 000036BF 6681E92000          <1> 		sub cx, 32
  4422                              <1> 	screenygood:
  4423 000036C4 BB00000000          <1> 		mov ebx, 0
  4424 000036C9 668B1D[54370000]    <1> 		mov bx, [resolutionx2]
  4425 000036D0 01DF                <1> 		add edi, ebx
  4426 000036D2 E2F0                <1> 		loop screenygood
  4427                              <1> 	noscreenygoodchk:
  4428 000036D4 BB00000000          <1> 		mov ebx, 0
  4429 000036D9 6689D3              <1> 		mov bx, dx
  4430 000036DC 01DF                <1> 		add edi, ebx
  4431 000036DE 66B90000            <1> 		mov cx, 0
  4432 000036E2 668B06              <1> 		mov ax, [esi]
  4433 000036E5 81C602000000        <1> 		add esi, 2
  4434 000036EB 66A3[75360000]      <1> 		mov [iconcolor], ax
  4435                              <1> 	writeicon:
  4436 000036F1 8B06                <1> 		mov eax, [esi]
  4437 000036F3 D1C0                <1> 		rol eax, 1
  4438 000036F5 B100                <1> 		mov cl, 0
  4439                              <1> 	writeiconline:
  4440 000036F7 B201                <1> 		mov dl, 1
  4441 000036F9 20C2                <1> 		and dl, al
  4442 000036FB 3215[FA390000]      <1> 		xor dl, [iconselected]
  4443 00003701 668B1D[D7270000]    <1> 		mov bx, [background]
  4444 00003708 66891F              <1> 		mov [edi], bx
  4445 0000370B 80FA00              <1> 		cmp dl, 0
  4446 0000370E 740A                <1> 		je noiconline
  4447 00003710 668B15[75360000]    <1> 		mov dx, [iconcolor]
  4448 00003717 668917              <1> 		mov [edi], dx
  4449                              <1> 	noiconline:
  4450 0000371A 81C702000000        <1> 		add edi, 2
  4451 00003720 D1C0                <1> 		rol eax, 1
  4452 00003722 FEC1                <1> 		inc cl
  4453 00003724 80F920              <1> 		cmp cl, 32
  4454 00003727 72CE                <1> 		jb writeiconline
  4455 00003729 81C604000000        <1> 		add esi, 4
  4456 0000372F FEC5                <1> 		inc ch
  4457 00003731 BA00000000          <1> 		mov edx, 0
  4458 00003736 668B15[54370000]    <1> 		mov dx, [resolutionx2]
  4459 0000373D 01D7                <1> 		add edi, edx
  4460 0000373F 81EF40000000        <1> 		sub edi, 64
  4461 00003745 80FD20              <1> 		cmp ch, 32
  4462 00003748 72A7                <1> 		jb writeicon
  4463 0000374A B800000000          <1> 		mov eax, 0
  4464 0000374F C3                  <1> 		ret
  4465                              <1> 
  4466 00003750 0000                <1> resolutiony dw 0
  4467 00003752 0000                <1> resolutionx dw 0
  4468 00003754 0000                <1> resolutionx2 dw 0
  4469 00003756 02                  <1> resolutionbytes db 2
  4470 00003757 0000                <1> posxvesa dw 0
  4471 00003759 0000                <1> posyvesa dw 0
  4472 0000375B FFFF                <1> colorfont dw 0xFFFF
  4473                              <1> savefontvesa:		;;same rules as showfontvesa
  4474 0000375D C605[31290000]01    <1> 	mov byte [savefonton], 1
  4475                              <1> showfontvesa:		;;position in (dx,cx), color in bx, char in al
  4476 00003764 66890D[59370000]    <1> 	mov [posyvesa], cx
  4477 0000376B 668915[57370000]    <1> 	mov [posxvesa], dx
  4478 00003772 8B3D[2B4F0000]      <1> 	mov edi, [physbaseptr]
  4479 00003778 66891D[5B370000]    <1> 	mov [colorfont], bx
  4480 0000377F BB00000000          <1> 	mov ebx, 0
  4481 00003784 88C3                <1> 	mov bl, al
  4482 00003786 B800000000          <1> 	mov eax, 0
  4483 0000378B 88D8                <1> 	mov al, bl
  4484 0000378D 6689D3              <1> 	mov bx, dx
  4485 00003790 89DA                <1> 	mov edx, ebx
  4486 00003792 BB00000000          <1> 	mov ebx, 0
  4487 00003797 6681F90000          <1> 	cmp cx, 0
  4488 0000379C 7415                <1> 	je vesaposloopdn
  4489 0000379E 668B1D[54370000]    <1> 	mov bx, [resolutionx2]
  4490                              <1> vesaposloop:
  4491 000037A5 01DA                <1> 	add edx, ebx
  4492 000037A7 6681E90100          <1> 	sub cx, 1
  4493 000037AC 6681F90000          <1> 	cmp cx, 0
  4494 000037B1 75F2                <1> 	jne vesaposloop
  4495                              <1> vesaposloopdn:
  4496 000037B3 01D7                <1> 	add edi, edx
  4497 000037B5 BE[E3440000]        <1> 	mov esi, fonts
  4498                              <1> findfontvesa:
  4499 000037BA B400                <1> 	mov ah, 0
  4500 000037BC C1E004              <1> 	shl eax, 4
  4501 000037BF 01C6                <1> 	add esi, eax
  4502 000037C1 C1E804              <1> 	shr eax, 4
  4503 000037C4 81FE[034D0000]      <1> 	cmp esi, fontend
  4504 000037CA 0F83BF000000        <1> 	jae near donefontvesa
  4505 000037D0 4E                  <1> 	dec esi
  4506                              <1> foundfontvesa:
  4507 000037D1 46                  <1> 	inc esi
  4508 000037D2 803D[31290000]01    <1> 	cmp byte [savefonton], 1
  4509 000037D9 0F84E1000000        <1> 	je near vesafontsaver
  4510 000037DF B100                <1> 	mov cl, 0
  4511 000037E1 8A06                <1> 	mov al, [esi]
  4512 000037E3 668B15[54370000]    <1> 	mov dx, [resolutionx2]
  4513 000037EA 662B15[57370000]    <1> 	sub dx, [posxvesa]
  4514 000037F1 6681FA1000          <1> 	cmp dx, 16
  4515 000037F6 7708                <1> 	ja paintfontvesa
  4516 000037F8 D0EA                <1> 	shr dl, 1
  4517 000037FA 8815[BF380000]      <1> 	mov [charwidth], dl
  4518                              <1> paintfontvesa:
  4519 00003800 B201                <1> 	mov dl, 1
  4520 00003802 20C2                <1> 	and dl, al
  4521 00003804 803D[30290000]01    <1> 	cmp byte [showcursorfonton], 1
  4522 0000380B 0F8435000000        <1> 	je near nodelpaintedfont
  4523 00003811 803D[30290000]02    <1> 	cmp byte [showcursorfonton], 2
  4524 00003818 0F8518000000        <1> 	jne near noswitchcursorfonton
  4525 0000381E 80FA00              <1> 	cmp dl, 0
  4526 00003821 0F842E000000        <1> 	je near nopixelset
  4527 00003827 668B1D[5B370000]    <1> 	mov bx, [colorfont]
  4528 0000382E 66891F              <1> 	mov [edi], bx
  4529 00003831 E91F000000          <1> 	jmp nopixelset
  4530                              <1> noswitchcursorfonton:
  4531 00003836 3215[32290000]      <1> 	xor dl, [mouseselecton]
  4532 0000383C 668B1D[D7270000]    <1> 	mov bx, [background]
  4533 00003843 66891F              <1> 	mov [edi], bx
  4534                              <1> nodelpaintedfont:
  4535 00003846 80FA00              <1> 	cmp dl, 0
  4536 00003849 740A                <1> 	je nopixelset
  4537 0000384B 668B15[5B370000]    <1> 	mov dx, [colorfont]
  4538 00003852 668917              <1> 	mov [edi], dx
  4539                              <1> nopixelset:
  4540 00003855 81C702000000        <1> 	add edi, 2
  4541 0000385B D0C0                <1> 	rol al, 1
  4542 0000385D FEC1                <1> 	inc cl
  4543 0000385F 3A0D[BF380000]      <1> 	cmp cl, [charwidth]
  4544 00003865 7299                <1> 	jb paintfontvesa
  4545 00003867 FEC5                <1> 	inc ch
  4546 00003869 BA00000000          <1> 	mov edx, 0
  4547 0000386E 668B15[54370000]    <1> 	mov dx, [resolutionx2]
  4548 00003875 01D7                <1> 	add edi, edx
  4549 00003877 BA00000000          <1> 	mov edx, 0
  4550 0000387C 8A15[BF380000]      <1> 	mov dl, [charwidth]
  4551 00003882 00D2                <1> 	add dl, dl
  4552 00003884 29D7                <1> 	sub edi, edx
  4553 00003886 80FD10              <1> 	cmp ch, 16
  4554 00003889 0F8242FFFFFF        <1> 	jb foundfontvesa
  4555                              <1> donefontvesa:
  4556 0000388F B208                <1> 	mov dl, 8
  4557 00003891 8815[BF380000]      <1> 	mov [charwidth], dl
  4558 00003897 668B15[57370000]    <1> 	mov dx, [posxvesa]
  4559 0000389E 8A1D[BF380000]      <1> 	mov bl, [charwidth]
  4560 000038A4 B700                <1> 	mov bh, 0
  4561 000038A6 6601DA              <1> 	add dx, bx
  4562 000038A9 668B1D[5B370000]    <1> 	mov bx, [colorfont]
  4563 000038B0 668B0D[59370000]    <1> 	mov cx, [posyvesa]
  4564 000038B7 C605[31290000]00    <1> 	mov byte [savefonton], 0
  4565 000038BE C3                  <1> 	ret
  4566 000038BF 08                  <1> charwidth db 8
  4567                              <1> vesafontsaver:
  4568 000038C0 B000                <1> 	mov al, 0
  4569 000038C2 B100                <1> 	mov cl, 0
  4570                              <1> vesafontsaver2:
  4571 000038C4 668B17              <1> 	mov dx, [edi]
  4572 000038C7 663B15[5B370000]    <1> 	cmp dx, [colorfont]
  4573 000038CE 742F                <1> 	je colorfontmatch
  4574                              <1> donecolormatch:
  4575 000038D0 81C702000000        <1> 	add edi, 2
  4576 000038D6 D0C0                <1> 	rol al, 1
  4577 000038D8 FEC1                <1> 	inc cl
  4578 000038DA 80F908              <1> 	cmp cl, 8
  4579 000038DD 72E5                <1> 	jb vesafontsaver2
  4580 000038DF 8806                <1> 	mov [esi], al
  4581 000038E1 46                  <1> 	inc esi
  4582 000038E2 FEC5                <1> 	inc ch
  4583 000038E4 BA00000000          <1> 	mov edx, 0
  4584 000038E9 668B15[54370000]    <1> 	mov dx, [resolutionx2]
  4585 000038F0 01D7                <1> 	add edi, edx
  4586 000038F2 81EF10000000        <1> 	sub edi, 16
  4587 000038F8 80FD10              <1> 	cmp ch, 16
  4588 000038FB 72C3                <1> 	jb vesafontsaver
  4589 000038FD EB90                <1> 	jmp donefontvesa
  4590                              <1> colorfontmatch:
  4591 000038FF 0401                <1> 	add al, 1
  4592 00003901 EBCD                <1> 	jmp donecolormatch
  4593                              <1> 	
  4594                              <1> showbmp:
  4595 00003903 668B06              <1> 	mov ax, [esi]
  4596 00003906 663D424D            <1> 	cmp ax, "BM"
  4597 0000390A 0F858E000000        <1> 	jne near endedbmp
  4598 00003910 8B3D[2B4F0000]      <1> 	mov edi, [physbaseptr]
  4599 00003916 6689D0              <1> 	mov ax, dx
  4600 00003919 6689CB              <1> 	mov bx, cx
  4601 0000391C B900000000          <1> 	mov ecx, 0
  4602 00003921 BA00000000          <1> 	mov edx, 0
  4603 00003926 6689D9              <1> 	mov cx, bx
  4604 00003929 6689C2              <1> 	mov dx, ax
  4605 0000392C 01D7                <1> 	add edi, edx
  4606 0000392E 01D7                <1> 	add edi, edx
  4607 00003930 BA00000000          <1> 	mov edx, 0
  4608 00003935 668B15[54370000]    <1> 	mov dx, [resolutionx2]
  4609 0000393C 41                  <1> 	inc ecx
  4610 0000393D 034E16              <1> 	add ecx, [esi + 22]
  4611                              <1> bmplocloop:
  4612 00003940 01D7                <1> 	add edi, edx
  4613 00003942 E2FC                <1> 	loop bmplocloop
  4614 00003944 29D7                <1> 	sub edi, edx
  4615 00003946 8B5612              <1> 	mov edx, [esi + 18]
  4616 00003949 8B4E16              <1> 	mov ecx, [esi + 22]
  4617 0000394C 8B460A              <1> 	mov eax, [esi + 10]
  4618 0000394F 8B5E02              <1> 	mov ebx, [esi + 2]
  4619 00003952 01F3                <1> 	add ebx, esi
  4620 00003954 891D[9F390000]      <1> 	mov [bmpend], ebx
  4621 0000395A 89D3                <1> 	mov ebx, edx
  4622 0000395C 01C6                <1> 	add esi, eax
  4623                              <1> ldxbmp:
  4624 0000395E 668B06              <1> 	mov ax, [esi]
  4625 00003961 668907              <1> 	mov [edi], ax
  4626 00003964 81C702000000        <1> 	add edi, 2
  4627 0000396A 81C602000000        <1> 	add esi, 2
  4628 00003970 3B35[9F390000]      <1> 	cmp esi, [bmpend]
  4629 00003976 7726                <1> 	ja endedbmp
  4630 00003978 4A                  <1> 	dec edx
  4631 00003979 81FA00000000        <1> 	cmp edx, 0
  4632 0000397F 77DD                <1> 	ja ldxbmp
  4633 00003981 BA00000000          <1> 	mov edx, 0
  4634 00003986 668B15[54370000]    <1> 	mov dx, [resolutionx2]
  4635 0000398D 29DF                <1> 	sub edi, ebx
  4636 0000398F 29DF                <1> 	sub edi, ebx
  4637 00003991 29D7                <1> 	sub edi, edx
  4638 00003993 49                  <1> 	dec ecx
  4639 00003994 89DA                <1> 	mov edx, ebx
  4640 00003996 81F900000000        <1> 	cmp ecx, 0
  4641 0000399C 77C0                <1> 	ja ldxbmp
  4642                              <1> endedbmp:
  4643 0000399E C3                  <1> 	ret
  4644                              <1> 	
  4645 0000399F 00000000            <1> 	bmpend dd 0
  4646                              <1> 
  4647                              <1> ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;Here are some vars;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
  4648 000039A3 00000000            <1> 	showstringesi dw 0,0
  4649 000039A7 00                  <1> 	mouseon db 0
  4650 000039A8 737461727400        <1> 	start	db "start",0
  4651 000039AE 536F6C6C65724F5300  <1> 	gotomenu db "SollerOS",0
  4652 000039B7 426F6F2100          <1> 	boomsg db "Boo!",0
  4653 000039BC 5061636D616E207761- <1> 	pacmsg	db "Pacman was easy to draw.",0
  4654 000039C5 73206561737920746F- <1>
  4655 000039CE 20647261772E00      <1>
  4656 000039D5 4F6D206E6F6D206E6F- <1> 	pacnom  db "Om nom nom nom",0
  4657 000039DE 6D206E6F6D00        <1>
  4658 000039E4 77696E646F77732073- <1> 	winmsg	db "windows sucks",0
  4659 000039ED 75636B7300          <1>
  4660 000039F2 5800                <1> 	xmsg db "X",0
  4661 000039F4 0000                <1> 	icon dw 0	;pointer to icon
  4662 000039F6 00000000            <1> 	codepointer dw 0,0 ;pointer to code
  4663 000039FA 00                  <1> 	iconselected db 0
  4664                              <1> 	
  4665                              <1> 	boo:
  4666 000039FB BE[B7390000]        <1> 		mov esi, boomsg
  4667 00003A00 66BA6400            <1> 		mov dx, 100
  4668 00003A04 66B94001            <1> 		mov cx, 320
  4669 00003A08 BB00000000          <1> 		mov ebx, 0
  4670 00003A0D 66B80000            <1> 		mov ax, 0
  4671 00003A11 E9E2F8FFFF          <1> 		jmp showstring
  4672                              <1> 
  4673                              <1> 	pacmannomnom:
  4674 00003A16 BE[D5390000]        <1> 		mov esi, pacnom
  4675 00003A1B 66BA8200            <1> 		mov dx, 130
  4676 00003A1F 66B93C00            <1> 		mov cx, 60
  4677 00003A23 BB00000000          <1> 		mov ebx, 0
  4678 00003A28 66B80000            <1> 		mov ax, 0
  4679 00003A2C E9C7F8FFFF          <1> 		jmp showstring	
  4680                              <1> 	
  4681                              <1> 	noie:
  4682 00003A31 BE[C53A0000]        <1> 		mov esi, termwindow
  4683 00003A36 66BA0000            <1> 		mov dx, 0
  4684 00003A3A 66B90000            <1> 		mov cx, 0
  4685 00003A3E BB[2B0D0000]        <1> 		mov ebx, os
  4686                              <1> ;;		mov ebx, internettest
  4687 00003A43 891D[58030000]      <1> 		mov [user2codepoint], ebx
  4688 00003A49 66B80000            <1> 		mov ax, 0
  4689 00003A4D E8FBF8FFFF          <1> 		call showwindow
  4690                              <1> ;;		jmp internettest
  4691 00003A52 E9D4D2FFFF          <1> 		jmp os
  4692 00003A57 C3                  <1> 		ret
  4693                              <1> 
  4694                              <1> 	gotomenuboot:
  4695 00003A58 BE[C53A0000]        <1> 		mov esi, termwindow
  4696 00003A5D 66BA0000            <1> 		mov dx, 0
  4697 00003A61 66B90000            <1> 		mov cx, 0
  4698 00003A65 BB[2B0D0000]        <1> 		mov ebx, os
  4699 00003A6A 891D[58030000]      <1> 		mov [user2codepoint], ebx
  4700 00003A70 66B80000            <1> 		mov ax, 0
  4701 00003A74 E8D4F8FFFF          <1> 		call showwindow
  4702 00003A79 E9ADD2FFFF          <1> jmp os
  4703 00003A7E C3                  <1> 		ret
  4704                              <1> 
  4705                              <1> 	winblows:
  4706 00003A7F BE[E4390000]        <1> 		mov esi, winmsg
  4707 00003A84 66BA0000            <1> 		mov dx, 0
  4708 00003A88 668B0D[50370000]    <1> 		mov cx, [resolutiony]
  4709 00003A8F 6681E92000          <1> 		sub cx, 32
  4710 00003A94 BB00000000          <1> 		mov ebx, 0
  4711 00003A99 B400                <1> 		mov ah, 0
  4712 00003A9B B011                <1> 		mov al, 00010001b
  4713 00003A9D E856F8FFFF          <1> 		call showstring
  4714 00003AA2 BE[AE390000]        <1> 		mov esi, gotomenu
  4715 00003AA7 668B0D[50370000]    <1> 		mov cx, [resolutiony]
  4716 00003AAE 6681E93000          <1> 		sub cx, 48
  4717 00003AB3 66BA0000            <1> 		mov dx, 0
  4718 00003AB7 B400                <1> 		mov ah, 0
  4719 00003AB9 B010                <1> 		mov al, 00010000b
  4720 00003ABB BB[583A0000]        <1> 		mov ebx, gotomenuboot
  4721 00003AC0 E933F8FFFF          <1> 		jmp showstring
  4722                              <1> 
  4723 00003AC5 8002E001            <1> 	termwindow:	dw 640,480	;;window size
  4724 00003AC9 5445524D494E414C00  <1> 	termmsg:	db "TERMINAL",0	;;window title
  4725                              <1> 	
  4726 00003AC9 <incbin>            <1> interneticon: 	incbin 'source/precompiled/interneticon.pak'
  4727 00003AC9 <incbin>            <1> wordicon: 	incbin 'source/precompiled/wordicon.pak'
  4728 00003AC9 <incbin>            <1> pacmanpellet: incbin 'source/precompiled/pacmanpellet.pak'
  4729 00003AC9 <incbin>            <1> ghostie	incbin 'source/precompiled/ghostie.pak'
  4730 00003AC9 <incbin>            <1> pacman	incbin 'source/precompiled/pacman.pak'
  4731                                      ;%include 'source/network.asm'
  4732                                  	%include 'source/rtl8139.asm'
  4733                              <1> ;;rtl8139.asm
  4734                              <1> initcard:	;;should find card, get mac, and initialize card
  4735 00003D5C B800000000          <1> 	mov eax, 0
  4736 00003D61 A2[8C400000]        <1> 	mov [pcifunction], al
  4737 00003D66 A2[8A400000]        <1> 	mov [pcibus], al
  4738 00003D6B A2[8B400000]        <1> 	mov [pcidevice], al
  4739 00003D70 B002                <1> 	mov al, 0x02 ;;type code
  4740 00003D72 A2[0F410000]        <1> 	mov [pcitype], al
  4741 00003D77 E813030000          <1> 	call getpciport
  4742                              <1> initnic:		;;;;Here i tried the rtl8139 interface, fuck it
  4743 00003D7C 8915[6B3F0000]      <1> 	mov [basenicaddr], edx
  4744 00003D82 89D1                <1> 	mov ecx, edx
  4745 00003D84 C605[17120000]03    <1> 	mov byte [firsthexshown], 3
  4746 00003D8B E888D4FFFF          <1> 	call showhex	;;for debugging, please remove
  4747 00003D90 BE[0D300000]        <1> 	mov esi, rbuffstart
  4748 00003D95 B900200000          <1> 	mov ecx, 8192
  4749 00003D9A B800000000          <1> 	mov eax, 0
  4750                              <1> clearrbuff:		;;clear receive buffer which starts at rbuffstart
  4751 00003D9F 8806                <1> 	mov [esi], al
  4752 00003DA1 46                  <1> 	inc esi
  4753 00003DA2 6649                <1> 	dec cx
  4754 00003DA4 6681F90000          <1> 	cmp cx, 0
  4755 00003DA9 75F4                <1> 	jne clearrbuff
  4756                              <1> findmac:
  4757 00003DAB 8B15[6B3F0000]      <1> 	mov edx, [basenicaddr]
  4758 00003DB1 BF[733F0000]        <1> 	mov edi, sysmac
  4759 00003DB6 B906000000          <1> 	mov ecx, 6
  4760                              <1> macputloop:
  4761 00003DBB EC                  <1> 	in al, dx
  4762 00003DBC 8807                <1> 	mov [edi], al
  4763 00003DBE 47                  <1> 	inc edi
  4764 00003DBF 42                  <1> 	inc edx
  4765 00003DC0 49                  <1> 	dec ecx
  4766 00003DC1 75F8                <1> 	jnz macputloop
  4767 00003DC3 B9[733F0000]        <1> 	mov ecx, sysmac
  4768 00003DC8 E837010000          <1> 	call showmac
  4769                              <1> resetnic:
  4770 00003DCD 8B15[6B3F0000]      <1> 	mov edx, [basenicaddr]
  4771 00003DD3 81C252000000        <1> 	add edx, 0x52
  4772 00003DD9 B000                <1> 	mov al, 0
  4773 00003DDB EE                  <1> 	out dx, al	;;WAKE UP!!!!
  4774 00003DDC 8B15[6B3F0000]      <1> 	mov edx, [basenicaddr]
  4775 00003DE2 81C237000000        <1> 	add edx, 0x37
  4776 00003DE8 B010                <1> 	mov al, 0x10
  4777 00003DEA EE                  <1> 	out dx, al	;;Reset
  4778                              <1> resetnicwait:
  4779 00003DEB 8B15[6B3F0000]      <1> 	mov edx, [basenicaddr]
  4780 00003DF1 81C237000000        <1> 	add edx, 0x37
  4781 00003DF7 EC                  <1> 	in al, dx
  4782 00003DF8 2410                <1> 	and al, 0x10
  4783 00003DFA 3C10                <1> 	cmp al, 0x10
  4784 00003DFC 0F84E9FFFFFF        <1> 	je near resetnicwait
  4785 00003E02 8B15[6B3F0000]      <1> 	mov edx, [basenicaddr]
  4786 00003E08 81C230000000        <1> 	add edx, 0x30
  4787 00003E0E B8[0D300000]        <1> 	mov eax, rbuffstart
  4788 00003E13 EF                  <1> 	out dx, eax	;;give nic receive buffer location
  4789 00003E14 8B15[6B3F0000]      <1> 	mov edx, [basenicaddr]
  4790 00003E1A 81C23C000000        <1> 	add edx, 0x3C
  4791 00003E20 66B80500            <1> 	mov ax, 0x0005
  4792 00003E24 66EF                <1> 	out dx, ax	;;set TOK and ROK
  4793 00003E26 8B15[6B3F0000]      <1> 	mov edx, [basenicaddr]
  4794 00003E2C 81C244000000        <1> 	add edx, 0x44
  4795 00003E32 B80F000000          <1> 	mov eax, 0xf
  4796 00003E37 EF                  <1> 	out dx, eax	;;recieve packets from all matches
  4797 00003E38 8B15[6B3F0000]      <1> 	mov edx, [basenicaddr]
  4798 00003E3E 81C237000000        <1> 	add edx, 0x37
  4799 00003E44 B00C                <1> 	mov al, 0x0C
  4800 00003E46 EE                  <1> 	out dx, al	;;use transmit and receive
  4801 00003E47 C605[543F0000]01    <1> 	mov byte [nicconfig], 1
  4802 00003E4E C3                  <1> 	ret
  4803                              <1> 	
  4804                              <1> sendframe:	;;padded frame with beginning in edi and end in esi
  4805 00003E4F 56                  <1> 	push esi
  4806 00003E50 57                  <1> 	push edi
  4807                              <1> nic2:		;;here come the low level drivers :(
  4808                              <1> 			;;frame begins at esi, ends at edi 			;;0x0200 is the class code for ethernet cards
  4809 00003E51 803D[543F0000]01    <1> 	cmp byte [nicconfig], 1
  4810 00003E58 7405                <1> 	je sendcachedata
  4811 00003E5A E8FDFEFFFF          <1> 	call initcard
  4812                              <1> sendcachedata:
  4813 00003E5F 8B15[6B3F0000]      <1> 	mov edx, [basenicaddr]
  4814 00003E65 81C210000000        <1> 	add edx, 0x10
  4815 00003E6B ED                  <1> 	in eax, dx
  4816 00003E6C 89C1                <1> 	mov ecx, eax
  4817 00003E6E E8A5D3FFFF          <1> 	call showhex
  4818 00003E73 8B15[6B3F0000]      <1> 	mov edx, [basenicaddr]
  4819 00003E79 81C213000000        <1> 	add edx, 0x13
  4820 00003E7F ED                  <1> 	in eax, dx
  4821 00003E80 89C1                <1> 	mov ecx, eax
  4822 00003E82 E891D3FFFF          <1> 	call showhex
  4823 00003E87 8B15[6B3F0000]      <1> 	mov edx, [basenicaddr]
  4824 00003E8D 81C223000000        <1> 	add edx, 0x23	;;23 or 20?
  4825 00003E93 5F                  <1> 	pop edi
  4826 00003E94 89F8                <1> 	mov eax, edi
  4827 00003E96 EF                  <1> 	out dx, eax	;;here's Johnny!
  4828 00003E97 5E                  <1> 	pop esi
  4829 00003E98 29FE                <1> 	sub esi, edi
  4830 00003E9A 89F0                <1> 	mov eax, esi
  4831 00003E9C 8B15[6B3F0000]      <1> 	mov edx, [basenicaddr]
  4832 00003EA2 81C213000000        <1> 	add edx, 0x13	;;13 or 10?
  4833 00003EA8 EF                  <1> 	out dx, eax
  4834                              <1> checknicstatus1:
  4835 00003EA9 8B15[6B3F0000]      <1> 	mov edx, [basenicaddr]
  4836 00003EAF 81C213000000        <1> 	add edx, 0x13	;;13 or 10?
  4837 00003EB5 ED                  <1> 	in eax, dx
  4838 00003EB6 2500200000          <1> 	and eax, 0x2000
  4839 00003EBB 3D00200000          <1> 	cmp eax, 0x2000
  4840 00003EC0 75E7                <1> 	jne checknicstatus1
  4841                              <1> checknicstatus:
  4842 00003EC2 8B15[6B3F0000]      <1> 	mov edx, [basenicaddr]
  4843 00003EC8 81C213000000        <1> 	add edx, 0x13	;;13 or 10?
  4844 00003ECE ED                  <1> 	in eax, dx
  4845 00003ECF 2500800000          <1> 	and eax, 0x8000
  4846 00003ED4 3D00800000          <1> 	cmp eax, 0x8000
  4847 00003ED9 75E7                <1> 	jne checknicstatus
  4848 00003EDB 8B15[6B3F0000]      <1> 	mov edx, [basenicaddr]
  4849 00003EE1 81C210000000        <1> 	add edx, 0x10
  4850 00003EE7 ED                  <1> 	in eax, dx
  4851 00003EE8 89C1                <1> 	mov ecx, eax
  4852 00003EEA E829D3FFFF          <1> 	call showhex
  4853 00003EEF 8B15[6B3F0000]      <1> 	mov edx, [basenicaddr]
  4854 00003EF5 81C213000000        <1> 	add edx, 0x13
  4855 00003EFB ED                  <1> 	in eax, dx
  4856 00003EFC 89C1                <1> 	mov ecx, eax
  4857 00003EFE E815D3FFFF          <1> 	call showhex
  4858 00003F03 C3                  <1> 	ret
  4859                              <1> 	
  4860                              <1> showmac:	;;mac begins in [ecx]
  4861 00003F04 BE[3C3F0000]        <1> 	mov esi, macprint
  4862 00003F09 89CF                <1> 	mov edi, ecx
  4863 00003F0B 81C106000000        <1> 	add ecx, 6
  4864                              <1> showmacloop:
  4865 00003F11 8A07                <1> 	mov al, [edi]
  4866 00003F13 8A27                <1> 	mov ah, [edi]
  4867 00003F15 C0E804              <1> 	shr al, 4
  4868 00003F18 C0E404              <1> 	shl ah, 4
  4869 00003F1B C0EC04              <1> 	shr ah, 4
  4870 00003F1E 0430                <1> 	add al, 48
  4871 00003F20 80C430              <1> 	add ah, 48
  4872 00003F23 668906              <1> 	mov [esi], ax
  4873 00003F26 81C603000000        <1> 	add esi, 3
  4874 00003F2C 47                  <1> 	inc edi
  4875 00003F2D 39CF                <1> 	cmp edi, ecx
  4876 00003F2F 72E0                <1> 	jb showmacloop
  4877 00003F31 BE[3C3F0000]        <1> 	mov esi, macprint
  4878 00003F36 E82ACCFFFF          <1> 	call print
  4879 00003F3B C3                  <1> 	ret
  4880                              <1> 	
  4881 00003F3C 30302D30302D30302D- <1> macprint db "00-00-00-00-00-00  ",0
  4882 00003F45 30302D30302D303020- <1>
  4883 00003F4E 2000                <1>
  4884 00003F50 00000000            <1> ethernetend dw 0,0
  4885 00003F54 00                  <1> nicconfig db 0
  4886 00003F55 4E4F204E494300      <1> nonicfoundmsg db "NO NIC",0
  4887 00003F5C 496E6974696174696E- <1> initnicmsg	db "Initiating NIC",0
  4888 00003F65 67204E494300        <1>
  4889 00003F6B 00000000            <1> basenicaddr	db 0,0,0,0
  4890 00003F6F C0A80005            <1> sysip db 192,168,0,5
  4891 00003F73 000000000000        <1> sysmac	db 0,0,0,0,0,0		;;my mac address
  4892                                  	%include 'source/arp.asm'
  4893                              <1> ;;let's try something else
  4894                              <1> ;;arp.asm
  4895                              <1> arpinit:
  4896 00003F79 BE[26400000]        <1> 	mov esi, arptable
  4897 00003F7E BF[733F0000]        <1> 	mov edi, sysmac
  4898 00003F83 BB[6F3F0000]        <1> 	mov ebx, sysip
  4899 00003F88 8B0F                <1> 	mov ecx, [edi]
  4900 00003F8A 890E                <1> 	mov [esi], ecx
  4901 00003F8C 668B4F04            <1> 	mov cx, [edi + 4]
  4902 00003F90 894E04              <1> 	mov [esi + 4], ecx
  4903 00003F93 8B0B                <1> 	mov ecx, [ebx]
  4904 00003F95 894E06              <1> 	mov [esi + 6], ecx
  4905 00003F98 C605[25400000]01    <1> 	mov byte [arpconfig], 1
  4906 00003F9F C3                  <1> 	ret
  4907                              <1> arptest:
  4908 00003FA0 803D[25400000]01    <1> 	cmp byte [arpconfig], 1
  4909 00003FA7 7405                <1> 	je arptest2
  4910 00003FA9 E8CBFFFFFF          <1> 	call arpinit
  4911                              <1> arptest2:	;;try to reach 192.168.0.1
  4912 00003FAE 8B0D[733F0000]      <1> 	mov ecx, [sysmac]
  4913 00003FB4 668B1D[773F0000]    <1> 	mov bx, [sysmac + 4]
  4914 00003FBB 890D[EB3F0000]      <1> 	mov [sourcemac], ecx
  4915 00003FC1 66891D[EF3F0000]    <1> 	mov [sourcemac + 4],bx
  4916 00003FC8 890D[FB3F0000]      <1> 	mov [arpsenderinfo], ecx
  4917 00003FCE 66891D[FF3F0000]    <1> 	mov [arpsenderinfo + 4], bx
  4918 00003FD5 BF[E53F0000]        <1> 	mov edi, frame
  4919 00003FDA BE[25400000]        <1> 	mov esi, framend
  4920 00003FDF E86BFEFFFF          <1> 	call sendframe
  4921 00003FE4 C3                  <1> 	ret
  4922                              <1> 	
  4923                              <1> ;;example frame
  4924                              <1> frame:
  4925 00003FE5 FFFFFFFFFFFF        <1> destinationmac:	db 0xFF,0xFF,0xFF,0xFF,0xFF,0xFF
  4926 00003FEB 000000000000        <1> sourcemac:		db 0,0,0,0,0,0
  4927 00003FF1 0608                <1> ethertype:		dw 0x0806			;;arp
  4928                              <1> 	;;example packet
  4929 00003FF3 0100                <1> 	arppacket: 		dw 1				;;ethernet is 1
  4930 00003FF5 0008                <1> 	arpprotocol: 	dw 0x0800			;;ip is 0x800
  4931 00003FF7 0604                <1> 					db 6,4				;;length of mac, length of ip
  4932 00003FF9 0100                <1> 	arpoperation: 	dw 1				;;one for arp request
  4933 00003FFB 000000000000        <1> 	arpsenderinfo:	db 0x00,0x00,0x00,0x00,0x00,0x00	;;mac
  4934 00004001 C0A80005            <1> 					db 192,168,0,5			;;ip
  4935 00004005 000000000000        <1> 	arptargetinfo:	db 0x00,0x00,0x00,0x00,0x00,0x00	;;ignored in requests
  4936 0000400B C0A80001            <1> 					db 192,168,0,1			;;ip
  4937 0000400F 00<rept>            <1> padding:		times (64-($-frame)) db 0
  4938                              <1> framend:
  4939                              <1> 
  4940 00004025 00                  <1> arpconfig db 0
  4941                              <1> arptable:	;;mac,ip
  4942 00004026 000000000000000000- <1> 	times 10 db 0,0,0,0,0,0,0,0,0,0
  4943 0000402F 00<rept>            <1>
  4944                              <1> arptableend:
  4945                                  	%include 'source/pci.asm'
  4946 0000408A 00                  <1> pcibus		db 0
  4947 0000408B 00                  <1> pcidevice	db 0
  4948 0000408C 00                  <1> pcifunction	db 0
  4949 0000408D 00                  <1> pciregister	db 0
  4950 0000408E 00                  <1> pcireqtype db 0
  4951                              <1> 
  4952                              <1> getpciport:
  4953 0000408F B001                <1> 	mov al, 1
  4954 00004091 A2[8E400000]        <1> 	mov [pcireqtype], al
  4955 00004096 E91E000000          <1> 	jmp searchpci
  4956                              <1> pcidump:
  4957 0000409B B800000000          <1> 	mov eax, 0
  4958 000040A0 A2[8C400000]        <1> 	mov [pcifunction], al
  4959 000040A5 A2[8A400000]        <1> 	mov [pcibus], al
  4960 000040AA A2[8B400000]        <1> 	mov [pcidevice], al
  4961 000040AF A2[8E400000]        <1> 	mov [pcireqtype], al
  4962 000040B4 E900000000          <1> 	jmp searchpci
  4963                              <1> searchpci:		;;return in ebx, start X in pciX
  4964 000040B9 B000                <1> 	mov al, 0
  4965 000040BB A2[8D400000]        <1> 	mov [pciregister], al
  4966 000040C0 E84F010000          <1> 	call getpciaddr
  4967 000040C5 BAF80C0000          <1> 	mov edx, 0xCF8
  4968 000040CA EF                  <1> 	out dx, eax	;;request pci config
  4969 000040CB BAFC0C0000          <1> 	mov edx, 0xCFC
  4970 000040D0 ED                  <1> 	in eax, dx 	;;read in pci config
  4971 000040D1 3D0000FFFF          <1> 	cmp eax, 0xFFFF0000
  4972 000040D6 0F8237000000        <1> 	jb near checkpcidevice
  4973                              <1> searchpciret:
  4974                              <1> nextpcidevice:
  4975 000040DC B000                <1> 	mov al, 0
  4976 000040DE A2[8C400000]        <1> 	mov [pcifunction], al
  4977 000040E3 A0[8B400000]        <1> 	mov al, [pcidevice]
  4978 000040E8 3C1F                <1> 	cmp al, 11111b
  4979 000040EA 0F83B8000000        <1> 	jae near nextpcibus
  4980 000040F0 FEC0                <1> 	inc al
  4981 000040F2 A2[8B400000]        <1> 	mov [pcidevice], al
  4982 000040F7 EBC0                <1> 	jmp searchpci
  4983 000040F9 A0[8C400000]        <1> 	mov al, [pcifunction]
  4984 000040FE 3C07                <1> 	cmp al, 111b
  4985 00004100 0F83D6FFFFFF        <1> 	jae near nextpcidevice
  4986 00004106 FEC0                <1> 	inc al
  4987 00004108 A2[8C400000]        <1> 	mov [pcifunction], al
  4988 0000410D EBAA                <1> 	jmp searchpci
  4989 0000410F 00000000            <1> pcitype: db 0,0,0,0
  4990                              <1> checkpcidevice:
  4991 00004113 B000                <1> 	mov al, 0
  4992 00004115 3805[8E400000]      <1> 	cmp [pcireqtype], al
  4993 0000411B 0F842B000000        <1> 	je near dumppcidevice
  4994 00004121 B008                <1> 	mov al, 0x08
  4995 00004123 A2[8D400000]        <1> 	mov [pciregister], al	;;class code, subclass, revision id
  4996 00004128 E8E7000000          <1> 	call getpciaddr
  4997 0000412D BAF80C0000          <1> 	mov edx, 0xCF8
  4998 00004132 EF                  <1> 	out dx, eax
  4999 00004133 BAFC0C0000          <1> 	mov edx, 0xCFC
  5000 00004138 ED                  <1> 	in eax, dx
  5001 00004139 C1C008              <1> 	rol eax, 8
  5002 0000413C 8A1D[0F410000]      <1> 	mov bl, [pcitype]
  5003 00004142 38D8                <1> 	cmp al, bl
  5004 00004144 0F8480000000        <1> 	je near foundpciaddr
  5005 0000414A EB90                <1> 	jmp searchpciret
  5006                              <1> dumppcidevice:
  5007 0000414C B000                <1> 	mov al, 0
  5008 0000414E A2[8D400000]        <1> 	mov [pciregister], al
  5009 00004153 E8BC000000          <1> 	call getpciaddr
  5010 00004158 89C1                <1> 	mov ecx, eax
  5011 0000415A C605[17120000]03    <1> 	mov byte [firsthexshown],3
  5012 00004161 E8B2D0FFFF          <1> 	call showhex
  5013                              <1> dumppcidevicelp:
  5014 00004166 A2[8D400000]        <1> 	mov [pciregister], al
  5015 0000416B E8A4000000          <1> 	call getpciaddr
  5016 00004170 BAF80C0000          <1> 	mov edx, 0xCF8
  5017 00004175 EF                  <1> 	out dx, eax
  5018 00004176 BAFC0C0000          <1> 	mov edx, 0xCFC
  5019 0000417B ED                  <1> 	in eax, dx
  5020 0000417C 89C1                <1> 	mov ecx, eax
  5021 0000417E A0[8D400000]        <1> 	mov al, [pciregister]
  5022 00004183 0404                <1> 	add al, 4
  5023 00004185 3C3C                <1> 	cmp al, 0x3C
  5024 00004187 730E                <1> 	jae dumppcidn
  5025 00004189 C605[17120000]00    <1> 	mov byte [firsthexshown],0
  5026 00004190 E883D0FFFF          <1> 	call showhex
  5027 00004195 EBCF                <1> 	jmp dumppcidevicelp
  5028                              <1> dumppcidn:
  5029 00004197 C605[17120000]02    <1> 	mov byte [firsthexshown],2
  5030 0000419E E875D0FFFF          <1> 	call showhex
  5031 000041A3 E934FFFFFF          <1> 	jmp searchpciret
  5032                              <1> nextpcibus:
  5033 000041A8 B000                <1> 	mov al, 0
  5034 000041AA A2[8B400000]        <1> 	mov [pcidevice], al
  5035 000041AF A0[8A400000]        <1> 	mov al, [pcibus]
  5036 000041B4 3C7F                <1> 	cmp al, 1111111b
  5037 000041B6 730C                <1> 	jae donesearchpci
  5038 000041B8 FEC0                <1> 	inc al
  5039 000041BA A2[8A400000]        <1> 	mov [pcibus], al
  5040 000041BF E9F5FEFFFF          <1> 	jmp searchpci
  5041                              <1> donesearchpci:
  5042 000041C4 BA00000000          <1> 	mov edx, 0
  5043 000041C9 C3                  <1> 	ret
  5044                              <1> foundpciaddr:
  5045 000041CA B010                <1> 	mov al, 0x10
  5046 000041CC A2[8D400000]        <1> 	mov [pciregister], al
  5047                              <1> findpciioaddr:
  5048 000041D1 E83E000000          <1> 	call getpciaddr
  5049 000041D6 BAF80C0000          <1> 	mov edx, 0xCF8
  5050 000041DB EF                  <1> 	out dx, eax
  5051 000041DC BAFC0C0000          <1> 	mov edx, 0xCFC
  5052 000041E1 ED                  <1> 	in eax, dx
  5053 000041E2 89C3                <1> 	mov ebx, eax
  5054 000041E4 81E301000000        <1> 	and ebx, 1
  5055 000041EA 81FB00000000        <1> 	cmp ebx, 0
  5056 000041F0 0F8408000000        <1> 	je near notpciioaddr
  5057 000041F6 2D01000000          <1> 	sub eax, 1
  5058 000041FB 89C2                <1> 	mov edx, eax
  5059 000041FD C3                  <1> 	ret
  5060                              <1> notpciioaddr:
  5061 000041FE A0[8D400000]        <1> 	mov al, [pciregister]
  5062 00004203 0404                <1> 	add al, 4
  5063 00004205 3C28                <1> 	cmp al, 0x28
  5064 00004207 0F87CFFEFFFF        <1> 	ja near searchpciret
  5065 0000420D A2[8D400000]        <1> 	mov [pciregister], al
  5066 00004212 EBBD                <1> 	jmp findpciioaddr
  5067                              <1> getpciaddr:		;;puts it in eax and ebx
  5068 00004214 B800000000          <1> 			mov eax, 0
  5069 00004219 BB00000080          <1> 			mov ebx, 0x80000000
  5070 0000421E A0[8A400000]        <1> 			mov al, [pcibus]
  5071 00004223 C1E010              <1> 			shl eax, 16
  5072 00004226 01C3                <1> 			add ebx, eax
  5073 00004228 B800000000          <1> 			mov eax, 0
  5074 0000422D A0[8B400000]        <1> 			mov al, [pcidevice]
  5075 00004232 C1E00B              <1> 			shl eax, 11
  5076 00004235 01C3                <1> 			add ebx, eax
  5077 00004237 B800000000          <1> 			mov eax, 0
  5078 0000423C A0[8C400000]        <1> 			mov al, [pcifunction]
  5079 00004241 C1E008              <1> 			shl eax, 8
  5080 00004244 01C3                <1> 			add ebx, eax
  5081 00004246 B800000000          <1> 			mov eax, 0
  5082 0000424B A0[8D400000]        <1> 			mov al, [pciregister]
  5083 00004250 01C3                <1> 			add ebx, eax
  5084 00004252 89D8                <1> 			mov eax, ebx
  5085 00004254 C3                  <1> 			ret
  5086                              <1> 			
  5087                                  	;%include 'source/process.asm'
  5088                                      %include 'source/disk.asm'
  5089                              <1> ;;disk.asm - new - using lba
  5090                              <1> loadfile:	;;loads a file with the name buffer's location in edi into location in esi
  5091 00004255 803F00              <1> 	cmp byte [edi], 0
  5092 00004258 0F8444000000        <1> 	je near nofileload
  5093 0000425E 89FA                <1> 	mov edx, edi
  5094 00004260 BB[0B440000]        <1> 	mov ebx, diskfileindex
  5095                              <1> nextnamechar:
  5096 00004265 8A07                <1> 	mov al, [edi]
  5097 00004267 8A23                <1> 	mov ah, [ebx]
  5098 00004269 47                  <1> 	inc edi
  5099 0000426A 43                  <1> 	inc ebx
  5100 0000426B 88C1                <1> 	mov cl, al
  5101 0000426D 08E1                <1> 	or cl, ah
  5102 0000426F 80F900              <1> 	cmp cl, 0
  5103 00004272 744E                <1> 	je equalfilenames
  5104 00004274 80F920              <1> 	cmp cl, ' '
  5105 00004277 7449                <1> 	je equalfilenames
  5106 00004279 3C2A                <1> 	cmp al, '*'
  5107 0000427B 742B                <1> 	je equalfilenames2
  5108 0000427D 80FC00              <1> 	cmp ah, 0
  5109 00004280 7410                <1> 	je nextfilename
  5110 00004282 3C00                <1> 	cmp al, 0
  5111 00004284 740C                <1> 	je nextfilename
  5112 00004286 38E0                <1> 	cmp al, ah
  5113 00004288 74DB                <1> 	je nextnamechar
  5114                              <1> getebxzero:
  5115 0000428A 8A23                <1> 	mov ah, [ebx]
  5116 0000428C 43                  <1> 	inc ebx
  5117 0000428D 80FC00              <1> 	cmp ah, 0
  5118 00004290 75F8                <1> 	jne getebxzero
  5119                              <1> nextfilename:
  5120 00004292 81C308000000        <1> 	add ebx, 8		;;next descriptor
  5121 00004298 89D7                <1> 	mov edi, edx
  5122 0000429A 81FB[82440000]      <1> 	cmp ebx, enddiskfileindex
  5123 000042A0 72C3                <1> 	jb nextnamechar
  5124                              <1> nofileload:
  5125 000042A2 BA94010000          <1> 	mov edx, 404	;;indicate not found error
  5126 000042A7 C3                  <1> 	ret
  5127                              <1> equalfilenames2:
  5128 000042A8 81EB02000000        <1> 	sub ebx, 2
  5129                              <1> eqfilefind:
  5130 000042AE 43                  <1> 	inc ebx
  5131 000042AF 81FB[82440000]      <1> 	cmp ebx, enddiskfileindex
  5132 000042B5 0F83E7FFFFFF        <1> 	jae near nofileload
  5133 000042BB 8A03                <1> 	mov al, [ebx]
  5134 000042BD 3C00                <1> 	cmp al, 0
  5135 000042BF 75ED                <1> 	jne eqfilefind
  5136 000042C1 43                  <1> 	inc ebx
  5137                              <1> equalfilenames:
  5138 000042C2 8B4304              <1> 	mov eax, [ebx + 4] 	;;put file size in eax
  5139 000042C5 8B1B                <1> 	mov ebx, [ebx]		;;put file beginning in ebx
  5140 000042C7 031D[2C000000]      <1> 	add ebx, [lbaad]	;;add offset to solleros
  5141 000042CD B900000000          <1> 	mov ecx, 0
  5142 000042D2 88C1                <1> 	mov cl, al			;;get excess number of sectors
  5143 000042D4 D0E1                <1> 	shl cl, 1
  5144 000042D6 D0E9                <1> 	shr cl, 1			;;cut off at 128
  5145 000042D8 29C8                <1> 	sub eax, ecx		;;get rid of excess sectors
  5146 000042DA B500                <1> 	mov ch, 0			;;drive 0
  5147 000042DC C1E807              <1> 	shr eax, 7			;;get number of 128 sector tracks
  5148                              <1> loaddiskfile:		;;tracks in eax, excess sectors in cl, drive in ch, buffer in esi, address in ebx
  5149 000042DF A3[1D430000]        <1> 	mov [filetracks], eax
  5150 000042E4 89F7                <1> 	mov edi, esi		;;just in case cl is 0
  5151 000042E6 89DA                <1> 	mov edx, ebx
  5152 000042E8 80F900              <1> 	cmp cl, 0
  5153 000042EB 7405                <1> 	je copytracksforfile
  5154 000042ED E831000000          <1> 	call diskr		;;take care of excess sectors
  5155                              <1> copytracksforfile:
  5156 000042F2 A1[1D430000]        <1> 	mov eax, [filetracks]
  5157 000042F7 3D00000000          <1> 	cmp eax, 0
  5158 000042FC 7419                <1> 	je donecopyfile
  5159 000042FE 48                  <1> 	dec eax
  5160 000042FF A3[1D430000]        <1> 	mov [filetracks], eax
  5161 00004304 89D3                <1> 	mov ebx, edx	;;get end lba
  5162 00004306 B180                <1> 	mov cl, 0x80
  5163 00004308 8A2D[2B000000]      <1> 	mov ch, [DriveNumber]
  5164 0000430E 89FE                <1> 	mov esi, edi	;;reset buffer
  5165 00004310 E80E000000          <1> 	call diskr
  5166 00004315 EBDB                <1> 	jmp copytracksforfile
  5167                              <1> donecopyfile:
  5168 00004317 BA00000000          <1> 	mov edx, 0	;;no error
  5169 0000431C C3                  <1> 	ret
  5170                              <1> 	
  5171 0000431D 00000000            <1> filetracks dd 0
  5172                              <1> 	
  5173 00004321 6400                <1> segments dw 100
  5174                              <1> 
  5175                              <1> diskr:		;;sector count in cl, disk number in ch, 48 bit address with first 32 bits in ebx, buffer in esi, puts end buffer in edi and end lba in edx
  5176 00004323 8935[07440000]      <1> 	mov [bufferstartesi], esi
  5177 00004329 891D[03440000]      <1> 	mov [lbaadstartebx], ebx
  5178 0000432F BA00000000          <1> 	mov edx, 0
  5179 00004334 88CA                <1> 	mov dl, cl
  5180 00004336 01DA                <1> 	add edx, ebx
  5181 00004338 8915[FF430000]      <1> 	mov [lbaadend], edx
  5182 0000433E 66B80000            <1> 	mov ax, 0
  5183 00004342 66BAF101            <1> 	mov dx, 0x1F1
  5184 00004346 EE                  <1> 	out dx, al	;;2 null bytes
  5185 00004347 EE                  <1> 	out dx, al
  5186 00004348 B000                <1> 	mov al, 0
  5187 0000434A 66BAF201            <1> 	mov dx, 0x1F2
  5188 0000434E EE                  <1> 	out dx, al	;;16 bit sector count-last byte now 0
  5189 0000434F 88C8                <1> 	mov al, cl
  5190 00004351 EE                  <1> 	out dx, al
  5191 00004352 66BAF301            <1> 	mov dx, 0x1F3
  5192 00004356 89D8                <1> 	mov eax, ebx
  5193 00004358 C1C818              <1> 	ror eax, 24
  5194 0000435B EE                  <1> 	out dx, al	;;4th byte of address
  5195 0000435C C1C018              <1> 	rol eax, 24
  5196 0000435F EE                  <1> 	out dx, al	;;1st byte of address
  5197 00004360 66BAF401            <1> 	mov dx, 0x1F4
  5198 00004364 B000                <1> 	mov al, 0
  5199 00004366 EE                  <1> 	out dx, al	;;5th byte of address-always 0 for now
  5200 00004367 C1C808              <1> 	ror eax, 8
  5201 0000436A EE                  <1> 	out dx, al	;;2nd byte of address
  5202 0000436B 66BAF501            <1> 	mov dx, 0x1F5
  5203 0000436F C1C008              <1> 	rol eax, 8
  5204 00004372 B000                <1> 	mov al, 0
  5205 00004374 EE                  <1> 	out dx, al	;;6th byte
  5206 00004375 C1C810              <1> 	ror eax, 16
  5207 00004378 EE                  <1> 	out dx, al	;;3rd byte
  5208 00004379 B840000000          <1> 	mov eax, 0x40
  5209 0000437E 66BAF601            <1> 	mov dx, 0x1F6
  5210 00004382 EE                  <1> 	out dx, al	;;send magic bits-add drive indicator later
  5211 00004383 B024                <1> 	mov al, 0x24
  5212 00004385 66BAF701            <1> 	mov dx, 0x1F7
  5213 00004389 EE                  <1> 	out dx, al	;;READ!!!
  5214                              <1> diskrwait:
  5215 0000438A 66BAF701            <1> 	mov dx, 0x1F7
  5216 0000438E EC                  <1> 	in al, dx
  5217 0000438F 2408                <1> 	and al, 0x08
  5218 00004391 3C08                <1> 	cmp al, 0x08
  5219 00004393 75F5                <1> 	jne diskrwait
  5220 00004395 88CD                <1> 	mov ch, cl	;;move sector data into ch, multiplying it by 256
  5221 00004397 B100                <1> 	mov cl, 0
  5222                              <1> diskdataread:
  5223 00004399 66BAF001            <1> 	mov dx, 0x1F0
  5224 0000439D 66ED                <1> 	in ax, dx
  5225 0000439F 668906              <1> 	mov [esi], ax
  5226 000043A2 81C602000000        <1> 	add esi, 2
  5227 000043A8 6649                <1> 	dec cx
  5228 000043AA 6681F90000          <1> 	cmp cx, 0
  5229 000043AF 75E8                <1> 	jne diskdataread		;;read all sectors
  5230 000043B1 89F7                <1> 	mov edi, esi
  5231 000043B3 8B15[FF430000]      <1> 	mov edx, [lbaadend]
  5232 000043B9 8B35[07440000]      <1> 	mov esi, [bufferstartesi]
  5233 000043BF 8B1D[03440000]      <1> 	mov ebx, [lbaadstartebx]
  5234 000043C5 C3                  <1> 	ret
  5235                              <1> 	
  5236                              <1> 	
  5237                              <1> diskold: ;;28 bits
  5238 000043C6 66B80000            <1> 	mov ax, 0
  5239 000043CA 66BAF101            <1> 	mov dx, 0x1F1
  5240 000043CE EE                  <1> 	out dx, al	;;send null byte to port
  5241 000043CF 6642                <1> 	inc dx	;;0x1F2
  5242 000043D1 88C8                <1> 	mov al, cl	;;get sector count
  5243 000043D3 EE                  <1> 	out dx, al	;;send sector count
  5244 000043D4 6642                <1> 	inc dx	;;0x1F3
  5245 000043D6 88D8                <1> 	mov al, bl	;;get first 8 bits of address
  5246 000043D8 EE                  <1> 	out dx, al	;;send them
  5247 000043D9 6642                <1> 	inc dx	;;0x1F4
  5248 000043DB C1CB08              <1> 	ror ebx, 8	;;get next 8 bits
  5249 000043DE 88D8                <1> 	mov al, bl
  5250 000043E0 EE                  <1> 	out dx, al
  5251 000043E1 6642                <1> 	inc dx	;;0x1F5
  5252 000043E3 C1CB08              <1> 	ror ebx, 8	;;again
  5253 000043E6 88D8                <1> 	mov al, bl
  5254 000043E8 EE                  <1> 	out dx, al
  5255 000043E9 6642                <1> 	inc dx	;;0x1F6
  5256 000043EB C1CB08              <1> 	ror ebx, 8
  5257 000043EE 88D8                <1> 	mov al, bl
  5258 000043F0 240F                <1> 	and al, 00001111b	;;last 4 bits of address
  5259 000043F2 0CE0                <1> 	or al, 0xE0			;;majic number
  5260 000043F4 C0E504              <1> 	shl ch, 4
  5261 000043F7 08E8                <1> 	or al, ch
  5262 000043F9 EE                  <1> 	out dx, al			;;send drive indicator, magic bits, and highest 4 bits of address
  5263 000043FA 6642                <1> 	inc dx	;;0x1F7
  5264 000043FC B020                <1> 	mov al, 0x20
  5265 000043FE EE                  <1> 	out dx, al			;;execute read command
  5266                              <1> 	
  5267 000043FF 00000000            <1> lbaadend dd 0
  5268 00004403 00000000            <1> lbaadstartebx dd 0
  5269 00004407 00000000            <1> bufferstartesi dd 0
  5270                                      %include 'fileindex.asm'
  5271                              <1> diskfileindex:
  5272 0000440B 65787000            <1> db "exp",0
  5273 0000440F 29000000            <1> dd (f0-$$)/512
  5274 00004413 01000000            <1> dd (f1-f0)/512
  5275 00004417 736F6C6C65726F732E- <1> db "solleros.bmp",0
  5276 00004420 626D7000            <1>
  5277 00004424 2A000000            <1> dd (f1-$$)/512
  5278 00004428 B0020000            <1> dd (f2-f1)/512
  5279 0000442C 736F6C6C65726F732E- <1> db "solleros.txt",0
  5280 00004435 74787400            <1>
  5281 00004439 DA020000            <1> dd (f2-$$)/512
  5282 0000443D 01000000            <1> dd (f3-f2)/512
  5283 00004441 74656C7900          <1> db "tely",0
  5284 00004446 DB020000            <1> dd (f3-$$)/512
  5285 0000444A 01000000            <1> dd (f4-f3)/512
  5286 0000444E 5468756D62732E6462- <1> db "Thumbs.db",0
  5287 00004457 00                  <1>
  5288 00004458 DC020000            <1> dd (f4-$$)/512
  5289 0000445C 1F000000            <1> dd (f5-f4)/512
  5290 00004460 74696D6500          <1> db "time",0
  5291 00004465 FB020000            <1> dd (f5-$$)/512
  5292 00004469 02000000            <1> dd (f6-f5)/512
  5293 0000446D 7475746F7269616C2E- <1> db "tutorial.bat",0
  5294 00004476 62617400            <1>
  5295 0000447A FD020000            <1> dd (f6-$$)/512
  5296 0000447E 03000000            <1> dd (f7-f6)/512
  5297                              <1> enddiskfileindex:
  5298                              <1> 
  5299                                  	%include 'source/msg.asm'
  5300 00004482 6578697400          <1> 	exitmsg db	"exit",0
  5301 00004487 50726F6772616D2022- <1> 	notfound1 db "Program ",34,0
  5302 00004490 00                  <1>
  5303 00004491 22206E6F7420666F75- <1> 	notfound2 db  34," not found.",13,10,0
  5304 0000449A 6E642E0D0A00        <1>
  5305 000044A0 757365726E616D653A- <1> 	userask db "username:",0
  5306 000044A9 00                  <1>
  5307 000044AA 70617373776F72643A- <1> 	pwdask	db	"password:",0
  5308 000044B3 00                  <1>
  5309 000044B4 40536F6C6C65724F53- <1> 	location	db	"@SollerOS]#",0
  5310 000044BD 5D2300              <1>
  5311 000044C0 0D0A00              <1> 	line	db	13,10,0
  5312                              <1>     ;msg:       db "SollerOS Beta version 0.9.0 - compiled by Jeremy Soller.",13,10,0
  5313                              <1> 	userlst:
  5314 000044C3 7573657200          <1> 			db "user",0
  5315 000044C8 70617373776F726400  <1> 			db "password",0
  5316 000044D1 726F6F7400          <1> 			db "root",0
  5317 000044D6 617765736F6D65706F- <1> 			db "awesomepower",0
  5318 000044DF 77657200            <1>
  5319                              <1> 	userlstend:
  5320                              <1> 	
  5321 000044DF <incbin>            <1> fonts:	incbin 'source/precompiled/fonts.pak'
  5322                              <1> fontend2:
  5323                              <1> mcursor:
  5324 00004CF3 01                  <1> 	db	00000001b
  5325 00004CF4 81                  <1> 	db	10000001b
  5326 00004CF5 C1                  <1> 	db	11000001b
  5327 00004CF6 E1                  <1> 	db	11100001b
  5328 00004CF7 F1                  <1> 	db	11110001b
  5329 00004CF8 F9                  <1> 	db	11111001b
  5330 00004CF9 FD                  <1> 	db	11111101b
  5331 00004CFA FF                  <1> 	db	11111111b
  5332 00004CFB F9                  <1> 	db	11111001b
  5333 00004CFC B9                  <1> 	db	10111001b
  5334 00004CFD 39                  <1> 	db	00111001b
  5335 00004CFE 1C                  <1> 	db	00011100b
  5336 00004CFF 1C                  <1> 	db	00011100b
  5337 00004D00 0E                  <1> 	db	00001110b
  5338 00004D01 0E                  <1> 	db	00001110b
  5339 00004D02 0C                  <1> 	db	00001100b
  5340                              <1> fontend:
  5341                              <1> 
  5342                              <1> ;cursorbmp:
  5343                              <1> ;	db	1,0,0,0,0,0,0,0
  5344                              <1> ;	db	1,1,0,0,0,0,0,0
  5345                              <1> ;	db	1,1,1,0,0,0,0,0
  5346                              <1> ;	db	1,1,1,1,0,0,0,0
  5347                              <1> ;	db	1,1,1,1,1,0,0,0
  5348                              <1> ;	db	1,1,1,1,1,1,0,0
  5349                              <1> ;	db	1,1,1,1,1,1,1,0
  5350                              <1> ;	db	1,1,1,1,1,1,1,1
  5351                              <1> ;	db	1,1,1,1,1,1,0,0
  5352                              <1> ;	db	1,1,0,1,1,1,0,0
  5353                              <1> ;	db	1,0,0,1,1,1,0,0
  5354                              <1> ;	db	0,0,0,0,1,1,1,0
  5355                              <1> ;	db	0,0,0,0,1,1,1,0
  5356                              <1> ;	db	0,0,0,0,0,1,1,1
  5357                              <1> ;	db	0,0,0,0,0,1,1,1
  5358                              <1> ;	db	0,0,0,0,0,1,1,0
  5359                              <1> ;cursorbmpend:
  5360                              <1> 
  5361                              <1> 
  5362                              <1> VBEMODEBLOCK:
  5363 00004D03 00<rept>            <1> vbesignature 		times 4 db 0	;VBE Signature
  5364 00004D07 00<rept>            <1> vbeversion  		times 2 db 0	;VBE Version
  5365 00004D09 00<rept>            <1> oemstringptr  		times 4 db 0	;Pointer to OEM String
  5366 00004D0D 00<rept>            <1> capabilities 		times 4 db 0	;Capabilities of graphics cont.
  5367 00004D11 00<rept>            <1> videomodeptr 		times 4 db 0	;Pointer to Video Mode List
  5368 00004D15 00<rept>            <1> totalmemory   		times 2 db 0	;number of 64Kb memory blocks
  5369 00004D17 00<rept>            <1> oemsoftwarerev  	times 2 db 0	;VBE implementation Software revision
  5370 00004D19 00<rept>            <1> oemvendornameptr 	times 4 db 0	;Pointer to Vendor Name String
  5371 00004D1D 00<rept>            <1> oemproductnameptr 	times 4 db 0	;Pointer to Product Name String
  5372 00004D21 00<rept>            <1> oemproductrevptr 	times 4 db 0	;Pointer to Product Revision String
  5373 00004D25 00<rept>            <1> reserved			times 222 db 0	;Reserved for VBE implementation scratch area
  5374 00004E03 00<rept>            <1> oemdata 			times 256 db 0	;Data Area for OEM Strings
  5375                              <1> 
  5376                              <1> 
  5377                              <1> VBEMODEINFOBLOCK:
  5378                              <1> ;Mandatory information for all VBE revision
  5379 00004F03 00<rept>            <1> modeattributes   	times 2 db 0	;Mode attributes
  5380 00004F05 00                  <1> winaattributes   	times 1 db 0	;Window A attributes
  5381 00004F06 00                  <1> winbattributes   	times 1 db 0	;Window B attributes
  5382 00004F07 00<rept>            <1> wingranularity   	times 2 db 0	;Window granularity
  5383 00004F09 00<rept>            <1> winsize          	times 2 db 0	;Window size
  5384 00004F0B 00<rept>            <1> winasegment      	times 2 db 0	;Window A start segment
  5385 00004F0D 00<rept>            <1> winbsegment      	times 2 db 0	;Window B start segment
  5386 00004F0F 00<rept>            <1> winfuncptr       	times 4 db 0	;pointer to window function
  5387 00004F13 00<rept>            <1> bytesperscanline 	times 2 db 0	;Bytes per scan line
  5388                              <1> 
  5389                              <1> ;Mandatory information for VBE 1.2 and above
  5390 00004F15 00<rept>            <1> xresolution     	times 2 db 0	;Horizontal resolution in pixel or chars
  5391 00004F17 00<rept>            <1> yresolution	    	times 2 db 0	;Vertical resolution in pixel or chars
  5392 00004F19 00                  <1> xcharsize       	times 1 db 0	;Character cell width in pixel
  5393 00004F1A 00                  <1> ycharsize       	times 1 db 0	;Character cell height in pixel
  5394 00004F1B 00                  <1> numberofplanes  	times 1 db 0	;Number of memory planes
  5395 00004F1C 00                  <1> bitsperpixel    	times 1 db 0	;Bits per pixel
  5396 00004F1D 00                  <1> numberofbanks   	times 1 db 0	;Number of banks
  5397 00004F1E 00                  <1> memorymodel     	times 1 db 0	;Memory model type
  5398 00004F1F 00                  <1> banksize        	times 1 db 0	;Bank size in KB
  5399 00004F20 00                  <1> numberofimagepages	times 1 db 0	;Number of images
  5400 00004F21 00                  <1> reserved1       	times 1 db 0	;Reserved for page function
  5401                              <1> 
  5402                              <1> ;Direct Color fields (required for direct/6 and YUV/7 memory models)
  5403 00004F22 00                  <1> redmasksize			times 1 db 0	;Size of direct color red mask in bits
  5404 00004F23 00                  <1> redfieldposition	times 1 db 0	;Bit position of lsb of red bask
  5405 00004F24 00                  <1> greenmasksize   	times 1 db 0	;Size of direct color green mask in bits
  5406 00004F25 00                  <1> greenfieldposition	times 1 db 0	;Bit position of lsb of green bask
  5407 00004F26 00                  <1> bluemasksize		times 1 db 0	;Size of direct color blue mask in bits
  5408 00004F27 00                  <1> bluefieldposition	times 1 db 0	;Bit position of lsb of blue bask
  5409 00004F28 00                  <1> rsvdmasksize        times 1	db 0	;Size of direct color reserved mask in bits
  5410 00004F29 00                  <1> rsvdfieldposition	times 1	db 0	;Bit position of lsb of reserved bask
  5411 00004F2A 00                  <1> directcolormodeinfo	times 1 db 0	;Direct color mode attributes
  5412                              <1> 
  5413                              <1> ;Mandatory information for VBE 2.0 and above
  5414 00004F2B 00<rept>            <1> physbaseptr 		times 4 db 0	;Physical address for flat frame buffer
  5415 00004F2F 00<rept>            <1> offscreenmemoffset 	times 4 db 0	;Pointer to start of off screen memory
  5416 00004F33 00<rept>            <1> offscreenmemsize 	times 2 db 0    ;Amount of off screen memory in 1Kb units
  5417 00004F35 00<rept>            <1> reserved2 			times 206 db 0  ;Remainder of ModeInfoBlock
  5418                                  	;%include 'source/memory.asm'
  5419                                  	%include 'source/buf.asm'
  5420                              <1> [section .bss]
  5421                              <1> bssstart:
  5422                              <1> stack:
  5423 00000000 <res 00001000>      <1> 	resb 4096
  5424                              <1> stackend:
  5425                              <1> graphicstable: ;w type, dw datalocation, w locationx, w locationy, w selected, dw code
  5426 00001000 <res 00000200>      <1> 	resb 200h 
  5427                              <1> 	graphicstableend:
  5428                              <1> mousecolorbuf: ;where the gui under the mouse is stored
  5429 00001200 <res 00000100>      <1> 	resb 256 
  5430                              <1> mcolorend:
  5431 00001300 <res 00000001>      <1> IFON resb 1 
  5432 00001301 <res 00000064>      <1> IFTRUE resb 100 
  5433 00001365 <res 00000004>      <1> BATCHPOS resb 4 
  5434 00001369 <res 00000001>      <1> BATCHISON resb 1 
  5435 0000136A <res 00000001>      <1> LOOPON resb 1 
  5436 0000136B <res 00000004>      <1> LOOPPOS	resb 4 
  5437 0000136F <res 00000200>      <1> fileindex: resb 200h 
  5438                              <1> fileindexend:
  5439 0000156F <res 00000500>      <1> variables: 	resb 500h 
  5440 00001A6F <res 00000001>      <1> varend: resb 1 
  5441 00001A70 <res 00000200>      <1> buftxt: resb 200h 
  5442 00001C70 <res 00000014>      <1> buf2:	resb 20 
  5443 00001C84 <res 00000001>      <1> numbuf: resb 1 
  5444 00001C85 <res 000012C0>      <1> videobuf2 		resb 0x12C0 
  5445 00002F45 <res 000000C8>      <1> videobufend		resb 200 
  5446                              <1> ;processcache:	;;eip, eax, ebx, ecx, edx, edi, esi, esp, ebp-9*4=36 bytes each
  5447                              <1> ;processcacheend:
  5448                              <1> ;alignb 4096		;;align 4 kbytes
  5449                              <1> ;ospagedir:
  5450                              <1> ;	resb 4096
  5451                              <1> ;ospagedirend:
  5452                              <1> ;pagetables:
  5453                              <1> ;	resb 4096
  5454                              <1> 
  5455                              <1> rbuffstart: ;for use with networking
  5456 0000300D <res 00002014>      <1> resb 8212
  5457                              <1> bssend:
  5458                              <1> [section .text]
  5459                                      %include 'files.asm'
  5460 00005003 00<rept>            <1> align 512,db 0
  5461                              <1> f0:
  5462 00005003 <incbin>            <1> incbin "included/exp"
  5463 00005222 00<rept>            <1> align 512,db 0
  5464                              <1> f1:
  5465 00005222 <incbin>            <1> incbin "included/solleros.bmp"
  5466 0005B3E6 00<rept>            <1> align 512,db 0
  5467                              <1> f2:
  5468 0005B3E6 <incbin>            <1> incbin "included/solleros.txt"
  5469 0005B576 00<rept>            <1> align 512,db 0
  5470                              <1> f3:
  5471 0005B576 <incbin>            <1> incbin "included/tely"
  5472 0005B7BD 00<rept>            <1> align 512,db 0
  5473                              <1> f4:
  5474 0005B7BD <incbin>            <1> incbin "included/Thumbs.db"
  5475                              <1> align 512,db 0
  5476                              <1> f5:
  5477 0005B7BD <incbin>            <1> incbin "included/time"
  5478 0005F87B 00<rept>            <1> align 512,db 0
  5479                              <1> f6:
  5480 0005F87B <incbin>            <1> incbin "included/tutorial.bat"
  5481 0005FEAA 00<rept>            <1> align 512,db 0
  5482                              <1> f7:
