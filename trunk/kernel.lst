     1                                  [BITS 16]
     2                                      %include 'source/menu.asm'
     3                              <1>     ; MENU.ASM
     4                              <1> menustart:	
     5 00000000 8CC8                <1> 	    mov ax, cs
     6 00000002 E90400              <1> 	    jmp mainindex	;;this command gives the solleros user the location of mainindex
     7 00000005 4A525300            <1> 	    db "JRS",0	;;this gives the bootloader a key to look for
     8                              <1> mainindex:
     9 00000009 E90000              <1> 	    jmp mainindexdn	;;this gives the size of the index
    10                              <1> 	    ;not needed;dw 0405h,progstart,batchprogend,fileindex,fileindexend,variables,varend,nwcmd,int30h,physbaseptr,0
    11                              <1> mainindexdn:
    12 0000000C 8ED8                <1> 	mov ds, ax
    13 0000000E 8EC0                <1> 	mov es, ax
    14 00000010 8ED0                <1> 	mov ss, ax
    15 00000012 880E[2B00]          <1> 	mov [DriveNumber], cl
    16 00000016 668916[2C00]        <1> 	mov [lbaad], edx
    17 0000001B B800A0              <1> 	mov ax, 0xA000
    18 0000001E 8EE8                <1> 	mov gs, ax
    19 00000020 B81200              <1> 	mov ax, 12h
    20 00000023 BB0000              <1> 	mov bx, 0
    21 00000026 CD10                <1> 	int 10h
    22 00000028 E90900              <1> 	jmp guiload
    23                              <1> 
    24 0000002B 00                  <1> DriveNumber db 0
    25 0000002C 00000000            <1> lbaad dd 0
    26                              <1> 	
    27 00000030 0000                <1> vesamode dw 0
    28 00000032 0000                <1> videomodecache dw 0
    29                              <1> 
    30                              <1> guiload:
    31 00000034 B8004F              <1> 	mov ax, 04F00h
    32 00000037 BF[4948]            <1> 	mov di, VBEMODEBLOCK
    33 0000003A CD10                <1> 	int 10h
    34 0000003C BE[6B48]            <1> 	mov si, reserved
    35 0000003F 81EE0200            <1> 	sub si, 2
    36                              <1> findvideomodes:
    37 00000043 81C60200            <1> 	add si, 2
    38 00000047 8B0C                <1> 	mov cx, [si]
    39 00000049 81F9FFFF            <1> 	cmp cx, 0xFFFF
    40 0000004D 0F840A00            <1> 	je near nextvmode
    41 00000051 81FE[4949]          <1> 	cmp si, oemdata
    42 00000055 0F83CF00            <1> 	jae near guiload2	;;kill if no valid list is found
    43 00000059 EBE8                <1> 	jmp findvideomodes 	
    44                              <1> ;;debug,shows vmodes available
    45                              <1> nextvmode:
    46 0000005B 81EE0200            <1> 	sub si, 2
    47 0000005F 81FE[6B48]          <1> 	cmp si, reserved
    48 00000063 0F82C100            <1> 	jb near guiload2
    49 00000067 8B0C                <1> 	mov cx, [si]
    50 00000069 81F9FFFF            <1> 	cmp cx, 0xFFFF
    51 0000006D 0F84EAFF            <1> 	je near nextvmode
    52 00000071 81C10040            <1> 	add cx, 0x4000 		;;Linear Frame Buffer
    53 00000075 B8014F              <1> 	mov ax, 04F01h
    54 00000078 BF[494A]            <1> 	mov di, VBEMODEINFOBLOCK
    55 0000007B 890E[3000]          <1> 	mov [vesamode], cx
    56 0000007F CD10                <1> 	int 10h
    57 00000081 A0[624A]            <1> 	mov al, [bitsperpixel]
    58 00000084 3C10                <1> 	cmp al, 16
    59 00000086 75D3                <1> 	jne nextvmode
    60 00000088 8936[3200]          <1> 	mov [videomodecache], si
    61 0000008C 80FC00              <1> 	cmp ah, 0
    62 0000008F 0F842200            <1> 	je near setvesamode
    63 00000093 EBC6                <1> 	jmp nextvmode
    64 00000095 0A0D49732074686973- <1> isthisvideook db 10,13,"Is this video mode OK?(y/n)",13,10,0
    65 0000009E 20766964656F206D6F- <1>
    66 000000A7 6465204F4B3F28792F- <1>
    67 000000B0 6E290D0A00          <1>
    68                              <1> setvesamode:
    69 000000B5 8B0E[5B4A]          <1> 	mov cx, [xresolution]
    70 000000B9 E8B800              <1> 	call decshow
    71 000000BC B078                <1> 	mov al, "x"
    72 000000BE E82001              <1> 	call char
    73 000000C1 8B0E[5D4A]          <1> 	mov cx, [yresolution]
    74 000000C5 E8AC00              <1> 	call decshow
    75 000000C8 B040                <1> 	mov al, "@"
    76 000000CA E81401              <1> 	call char
    77 000000CD 8A0E[624A]          <1> 	mov cl, [bitsperpixel]
    78 000000D1 E8A000              <1> 	call decshow
    79 000000D4 BE[9500]            <1> 	mov si, isthisvideook
    80 000000D7 E88200              <1> 	call printrm
    81 000000DA B80000              <1> 	mov ax, 0
    82 000000DD CD16                <1> 	int 16h
    83 000000DF 8B36[3200]          <1> 	mov si, [videomodecache]
    84 000000E3 3C79                <1> 	cmp al, "y"
    85 000000E5 0F8572FF            <1> 	jne near nextvmode
    86 000000E9 8B16[5B4A]          <1> 	mov dx, [xresolution]
    87 000000ED 8B0E[5D4A]          <1> 	mov cx, [yresolution]
    88 000000F1 8916[D835]          <1> 	mov [resolutionx], dx
    89 000000F5 890E[D635]          <1> 	mov [resolutiony], cx
    90 000000F9 01D2                <1> 	add dx, dx
    91 000000FB 8916[DA35]          <1> 	mov [resolutionx2], dx
    92 000000FF BA0000              <1> 	mov dx, 0
    93 00000102 B90000              <1> 	mov cx, 0
    94 00000105 B8024F              <1> 	mov ax, 04F02h
    95 00000108 8B1E[3000]          <1> 	mov bx, [vesamode]
    96 0000010C CD10                <1> 	int 10h		;;enter VESA mode
    97 0000010E C606[5B01]00        <1> 	mov byte [guinodo], 0
    98 00000113 6631C0              <1> 	xor eax, eax
    99 00000116 6631DB              <1> 	xor ebx, ebx
   100 00000119 6631C9              <1> 	xor ecx, ecx
   101 0000011C 6631D2              <1> 	xor edx, edx
   102 0000011F 6631F6              <1> 	xor esi, esi
   103 00000122 6631FF              <1> 	xor edi, edi	;;reset registers
   104 00000125 E91F01              <1> 	jmp pmode
   105                              <1> guiload2:
   106 00000128 B9E001              <1> 	mov cx, 480
   107 0000012B BA8002              <1> 	mov dx, 640
   108 0000012E 8916[D835]          <1> 	mov [resolutionx], dx
   109 00000132 01D2                <1> 	add dx, dx
   110 00000134 8916[DA35]          <1> 	mov [resolutionx2], dx
   111 00000138 890E[D635]          <1> 	mov [resolutiony], cx
   112 0000013C B81200              <1> 	mov ax, 12h
   113 0000013F BB0000              <1> 	mov bx, 0
   114 00000142 CD10                <1> 	int 10h
   115 00000144 C606[5B01]01        <1> 	mov byte [guinodo], 1
   116 00000149 6631DB              <1> 	xor ebx, ebx
   117 0000014C 6631C9              <1> 	xor ecx, ecx
   118 0000014F 6631D2              <1> 	xor edx, edx
   119 00000152 6631F6              <1> 	xor esi, esi
   120 00000155 6631FF              <1> 	xor edi, edi
   121 00000158 E9EC00              <1> 	jmp pmode
   122                              <1> ;;	jmp gui ;;test vesa
   123                              <1> 
   124 0000015B 00                  <1> guinodo db 0
   125                              <1> 
   126                              <1>     printrm:			; 'si' comes in with string address
   127 0000015C BB0700              <1> 	    mov bx,07		; write to display
   128 0000015F B40E                <1> 	    mov ah,0Eh		; screen function
   129 00000161 8A04                <1>     prs2:    mov al,[si]         ; get next character
   130 00000163 3C00                <1> 	    cmp al,0		; look for terminator 
   131 00000165 7405                <1>             je finpr2		; zero byte at end of string
   132 00000167 CD10                <1> 	    int 10h		; write character to screen.    
   133 00000169 46                  <1>      	    inc si	     	; move to next character
   134 0000016A EBF5                <1> 	    jmp prs2		; loop
   135 0000016C C3                  <1>     finpr2: ret
   136                              <1> 
   137 0000016D 0000000000          <1> dcnm db 0,0,0,0,0
   138 00000172 0000                <1> dcnmend db 0,0
   139                              <1> 
   140                              <1> 
   141                              <1> decshow:
   142 00000174 BE[6D01]            <1> 	mov si, dcnm
   143                              <1> decclear:
   144 00000177 B030                <1> 	mov al, "0"
   145 00000179 8804                <1> 	mov [si], al
   146 0000017B 46                  <1> 	inc si
   147 0000017C 81FE[7201]          <1> 	cmp si, dcnmend
   148 00000180 76F5                <1> 	jbe decclear
   149 00000182 4E                  <1> 	dec si
   150 00000183 E81500              <1> 	call convertrm
   151 00000186 BE[6D01]            <1> 	mov si, dcnm
   152                              <1> dectst:
   153 00000189 8A04                <1> 	mov al, [si]
   154 0000018B 46                  <1> 	inc si
   155 0000018C 81FE[7201]          <1> 	cmp si, dcnmend
   156 00000190 7704                <1> 	ja dectstend
   157 00000192 3C30                <1> 	cmp al, "0"
   158 00000194 76F3                <1> 	jbe dectst
   159                              <1> dectstend:
   160 00000196 4E                  <1> 	dec si
   161 00000197 E8C2FF              <1> 	call printrm
   162 0000019A C3                  <1> 	ret
   163                              <1> 	
   164                              <1> 	
   165                              <1> convertrm:
   166 0000019B 4E                  <1> 	dec si
   167 0000019C 89F3                <1> 	mov bx, si		;place to convert into must be in si, number to convert must be in cx
   168                              <1> cnvrtrm:
   169 0000019E 89DE                <1> 	mov si, bx
   170 000001A0 81EE0300            <1> 	sub si, 3
   171 000001A4 46                  <1> ten3rm:	inc si
   172 000001A5 81F9E803            <1> 	cmp cx, 1000
   173 000001A9 7208                <1> 	jb ten2rm
   174 000001AB 81E9E803            <1> 	sub cx, 1000
   175 000001AF FE04                <1> 	inc byte [si]
   176 000001B1 EBEB                <1> 	jmp cnvrtrm
   177 000001B3 46                  <1> ten2rm:	inc si
   178 000001B4 81F96400            <1> 	cmp cx, 100
   179 000001B8 7208                <1> 	jb ten1rm
   180 000001BA 81E96400            <1> 	sub cx, 100
   181 000001BE FE04                <1> 	inc byte [si]
   182 000001C0 EBDC                <1> 	jmp cnvrtrm
   183 000001C2 46                  <1> ten1rm:	inc si
   184 000001C3 81F90A00            <1> 	cmp cx, 10
   185 000001C7 7208                <1> 	jb ten0rm
   186 000001C9 81E90A00            <1> 	sub cx, 10
   187 000001CD FE04                <1> 	inc byte [si]
   188 000001CF EBCD                <1> 	jmp cnvrtrm
   189 000001D1 46                  <1> ten0rm:	inc si
   190 000001D2 81F90100            <1> 	cmp cx, 1
   191 000001D6 7208                <1> 	jb tendnrm
   192 000001D8 81E90100            <1> 	sub cx, 1
   193 000001DC FE04                <1> 	inc byte [si]
   194 000001DE EBBE                <1> 	jmp cnvrtrm
   195                              <1> tendnrm:
   196 000001E0 C3                  <1> 	ret
   197                              <1> 
   198                              <1> 
   199                              <1> 
   200                              <1> 
   201                              <1>     char: 		    ;char must be in al
   202 000001E1 BB0700              <1>            mov bx, 07
   203 000001E4 B40E                <1> 	   mov ah, 0Eh
   204 000001E6 CD10                <1> 	   int 10h
   205 000001E8 C3                  <1> 	    ret
   206                              <1> 
   207                              <1> 		shutdown:
   208 000001E9 E84B00              <1> 			call realmode	
   209 000001EC B80053              <1> 			MOV AX, 5300h	; Shuts down APM-Machines.
   210 000001EF 31DB                <1> 			XOR BX, BX	; Newer machines automatically
   211 000001F1 CD15                <1> 			INT 15h		; shut down
   212 000001F3 B80453              <1> 			MOV AX, 5304h
   213 000001F6 31DB                <1> 			XOR BX, BX
   214 000001F8 CD15                <1> 			INT 15h		; Interrupt 15h originally was
   215 000001FA B80153              <1> 			MOV AX, 5301h	; used for Cartridges (cassettes)
   216 000001FD 31DB                <1> 			XOR BX, BX	; but is still in use for
   217 000001FF CD15                <1> 			INT 15h		; diverse things
   218 00000201 B80753              <1> 			MOV AX, 5307h
   219 00000204 BB0100              <1> 			MOV BX, 1
   220 00000207 B90300              <1> 			MOV CX, 3
   221 0000020A CD15                <1> 			INT 15h
   222 0000020C CF                  <1> 			IRET
   223                              <1> 
   224                              <1> 	coldboot:
   225 0000020D E82700              <1> 			call realmode
   226 00000210 B84000              <1> 			MOV AX, 0040h
   227 00000213 8EC0                <1> 			MOV ES, AX
   228 00000215 26C70672000000      <1> 			MOV WORD [ES:00072h], 0h
   229 0000021C EA0000FFFF          <1> 			JMP 0FFFFh:0000h
   230 00000221 CF                  <1> 			IRET
   231                              <1> 
   232                              <1> 		warmboot:
   233 00000222 E81200              <1> 			call realmode
   234 00000225 B84000              <1> 			MOV AX, 0040h
   235 00000228 8EC0                <1> 			MOV ES, AX
   236 0000022A 26C70672003412      <1> 			MOV WORD [ES:00072h], 01234h
   237 00000231 EA0000FFFF          <1> 			JMP 0FFFFh:0000h
   238 00000236 CF                  <1> 			IRET
   239                              <1> 
   240                              <1> 
   241                              <1> realmode:
   242 00000237 0F20C0              <1>    mov eax, cr0
   243 0000023A 24FE                <1>    and al,0xFE     ; back to realmode
   244 0000023C 0F22C0              <1>    mov  cr0, eax   ; by toggling bit again
   245 0000023F FB                  <1>    sti
   246                              <1> 
   247 00000240 66B800000000        <1>    mov eax, 0
   248 00000246 C3                  <1>    ret
   249                                      %include 'source/pmode.asm'
   250                              <1> [BITS 16]
   251                              <1> ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
   252                              <1> ;	16-bit real mode
   253                              <1> ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
   254                              <1> 
   255                              <1> pmode:
   256 00000247 BA9200              <1> 	mov dx, 0x92
   257 0000024A EC                  <1> 	in al, dx	;;A20
   258 0000024B 0C02                <1> 	or al, 2
   259 0000024D EE                  <1> 	out dx, al
   260 0000024E 6631DB              <1> 	xor ebx,ebx
   261 00000251 8CCB                <1> 	mov bx,cs		; EBX=segment
   262 00000253 66C1E304            <1> 	shl ebx,4		;	<< 4
   263 00000257 67668D03            <1> 	lea eax,[ebx]		; EAX=linear address of segment base
   264 0000025B A3[1C07]            <1> 	mov [gdt2 + 2],ax
   265 0000025E A3[2407]            <1> 	mov [gdt3 + 2],ax
   266 00000261 66C1E810            <1> 	shr eax,16
   267 00000265 A2[1E07]            <1> 	mov [gdt2 + 4],al
   268 00000268 A2[2607]            <1> 	mov [gdt3 + 4],al
   269 0000026B 8826[2107]          <1> 	mov [gdt2 + 7],ah
   270 0000026F 8826[2907]          <1> 	mov [gdt3 + 7],ah
   271 00000273 66B8[00000000]      <1> 	mov eax, stack
   272 00000279 A3[2C07]            <1> 	mov [gdts + 2],ax
   273 0000027C 66C1E810            <1> 	shr eax,16
   274 00000280 A2[2E07]            <1> 	mov [gdts + 4],al
   275 00000283 8826[3107]          <1> 	mov [gdts + 7],ah
   276                              <1> ; fix up gdt and idt
   277 00000287 67668D83[0A070000]  <1> 	lea eax,[ebx + gdt]	; EAX=linear address of gdt
   278 0000028F 66A3[0007]          <1> 	mov [gdtr + 2],eax
   279 00000293 67668D83[37070000]  <1> 	lea eax,[ebx + idt]	; EAX=linear address of idt
   280 0000029B 66A3[0607]          <1> 	mov [idtr + 2],eax
   281 0000029F FA                  <1> 	cli
   282 000002A0 0F0116[FE06]        <1> 	lgdt [gdtr]
   283 000002A5 0F011E[0407]        <1> 	lidt [idtr]
   284 000002AA 66BB00000000        <1> 	mov ebx, 0
   285 000002B0 8CDB                <1> 	mov bx, ds
   286 000002B2 66891E[3103]        <1> 	mov [basecache], ebx
   287 000002B7 0F20C0              <1> 	mov eax,cr0
   288 000002BA 0C01                <1> 	or al,1
   289 000002BC 0F22C0              <1> 	mov cr0,eax
   290 000002BF EA[C402]1000        <1> 	jmp SYS_CODE_SEL:do_pm
   291                              <1> [BITS 32]
   292                              <1> do_pm:
   293 000002C4 66B81800            <1> 	mov ax, SYS_DATA_SEL
   294 000002C8 8ED8                <1> 	mov ds,ax
   295 000002CA 66B82000            <1> 	mov ax, STACK_SEL
   296 000002CE 8ED0                <1> 	mov ss, ax
   297 000002D0 BC00100000          <1> 	mov esp, 4096
   298 000002D5 90                  <1> 	nop
   299 000002D6 90                  <1> 	nop
   300 000002D7 66B81800            <1> 	mov ax, SYS_DATA_SEL
   301 000002DB 8EC0                <1> 	mov es,ax
   302 000002DD 8EE0                <1> 	mov fs,ax
   303 000002DF 8EE8                <1> 	mov gs,ax
   304 000002E1 B800000000          <1> 	mov eax, 0
   305 000002E6 BE[00000000]        <1> 	mov esi, bssstart
   306                              <1> clearkernelbuffers:
   307 000002EB 8906                <1> 	mov [esi], eax
   308 000002ED 81C604000000        <1> 	add esi, 4
   309 000002F3 81FE[0D300000]      <1> 	cmp esi, bssend
   310 000002F9 72F0                <1> 	jb clearkernelbuffers
   311                              <1> user1:
   312 000002FB 8B3D[714A0000]      <1> 	mov edi, [physbaseptr]
   313 00000301 A1[31030000]        <1> 	mov eax, [basecache]
   314 00000306 C1E004              <1> 	shl eax, 4
   315 00000309 29C7                <1> 	sub edi, eax
   316 0000030B 893D[714A0000]      <1> 	mov [physbaseptr], edi
   317 00000311 E879100000          <1> 	call indexfiles
   318 00000316 803D[5B010000]00    <1> 	cmp byte [guinodo], 0
   319 0000031D 0F8405000000        <1> 	je near guido
   320 00000323 E9BF090000          <1> 	jmp os
   321                              <1> 	
   322                              <1> guido:
   323 00000328 E933230000          <1> 	jmp gui
   324                              <1> 	
   325 0000032D 00000000            <1> user2codepoint dw 0,0
   326 00000331 00000000            <1> basecache dd 0
   327                              <1> 
   328                              <1> unhand:	
   329                              <1> 	%assign i 0
   330                              <1> 	%rep 40
   331                              <1> 	cli
   332                              <1> 	mov byte [intprob], i
   333                              <1> 	jmp unhand2
   334                              <1> 	%assign i i+1
   335                              <1> 	%endrep
   336 00000335 FA                  <2>  cli
   337 00000336 C605[3A060000]00    <2>  mov byte [intprob], i
   338 0000033D E9FB010000          <2>  jmp unhand2
   339                              <2>  %assign i i+1
   340 00000342 FA                  <2>  cli
   341 00000343 C605[3A060000]01    <2>  mov byte [intprob], i
   342 0000034A E9EE010000          <2>  jmp unhand2
   343                              <2>  %assign i i+1
   344 0000034F FA                  <2>  cli
   345 00000350 C605[3A060000]02    <2>  mov byte [intprob], i
   346 00000357 E9E1010000          <2>  jmp unhand2
   347                              <2>  %assign i i+1
   348 0000035C FA                  <2>  cli
   349 0000035D C605[3A060000]03    <2>  mov byte [intprob], i
   350 00000364 E9D4010000          <2>  jmp unhand2
   351                              <2>  %assign i i+1
   352 00000369 FA                  <2>  cli
   353 0000036A C605[3A060000]04    <2>  mov byte [intprob], i
   354 00000371 E9C7010000          <2>  jmp unhand2
   355                              <2>  %assign i i+1
   356 00000376 FA                  <2>  cli
   357 00000377 C605[3A060000]05    <2>  mov byte [intprob], i
   358 0000037E E9BA010000          <2>  jmp unhand2
   359                              <2>  %assign i i+1
   360 00000383 FA                  <2>  cli
   361 00000384 C605[3A060000]06    <2>  mov byte [intprob], i
   362 0000038B E9AD010000          <2>  jmp unhand2
   363                              <2>  %assign i i+1
   364 00000390 FA                  <2>  cli
   365 00000391 C605[3A060000]07    <2>  mov byte [intprob], i
   366 00000398 E9A0010000          <2>  jmp unhand2
   367                              <2>  %assign i i+1
   368 0000039D FA                  <2>  cli
   369 0000039E C605[3A060000]08    <2>  mov byte [intprob], i
   370 000003A5 E993010000          <2>  jmp unhand2
   371                              <2>  %assign i i+1
   372 000003AA FA                  <2>  cli
   373 000003AB C605[3A060000]09    <2>  mov byte [intprob], i
   374 000003B2 E986010000          <2>  jmp unhand2
   375                              <2>  %assign i i+1
   376 000003B7 FA                  <2>  cli
   377 000003B8 C605[3A060000]0A    <2>  mov byte [intprob], i
   378 000003BF E979010000          <2>  jmp unhand2
   379                              <2>  %assign i i+1
   380 000003C4 FA                  <2>  cli
   381 000003C5 C605[3A060000]0B    <2>  mov byte [intprob], i
   382 000003CC E96C010000          <2>  jmp unhand2
   383                              <2>  %assign i i+1
   384 000003D1 FA                  <2>  cli
   385 000003D2 C605[3A060000]0C    <2>  mov byte [intprob], i
   386 000003D9 E95F010000          <2>  jmp unhand2
   387                              <2>  %assign i i+1
   388 000003DE FA                  <2>  cli
   389 000003DF C605[3A060000]0D    <2>  mov byte [intprob], i
   390 000003E6 E952010000          <2>  jmp unhand2
   391                              <2>  %assign i i+1
   392 000003EB FA                  <2>  cli
   393 000003EC C605[3A060000]0E    <2>  mov byte [intprob], i
   394 000003F3 E945010000          <2>  jmp unhand2
   395                              <2>  %assign i i+1
   396 000003F8 FA                  <2>  cli
   397 000003F9 C605[3A060000]0F    <2>  mov byte [intprob], i
   398 00000400 E938010000          <2>  jmp unhand2
   399                              <2>  %assign i i+1
   400 00000405 FA                  <2>  cli
   401 00000406 C605[3A060000]10    <2>  mov byte [intprob], i
   402 0000040D E92B010000          <2>  jmp unhand2
   403                              <2>  %assign i i+1
   404 00000412 FA                  <2>  cli
   405 00000413 C605[3A060000]11    <2>  mov byte [intprob], i
   406 0000041A E91E010000          <2>  jmp unhand2
   407                              <2>  %assign i i+1
   408 0000041F FA                  <2>  cli
   409 00000420 C605[3A060000]12    <2>  mov byte [intprob], i
   410 00000427 E911010000          <2>  jmp unhand2
   411                              <2>  %assign i i+1
   412 0000042C FA                  <2>  cli
   413 0000042D C605[3A060000]13    <2>  mov byte [intprob], i
   414 00000434 E904010000          <2>  jmp unhand2
   415                              <2>  %assign i i+1
   416 00000439 FA                  <2>  cli
   417 0000043A C605[3A060000]14    <2>  mov byte [intprob], i
   418 00000441 E9F7000000          <2>  jmp unhand2
   419                              <2>  %assign i i+1
   420 00000446 FA                  <2>  cli
   421 00000447 C605[3A060000]15    <2>  mov byte [intprob], i
   422 0000044E E9EA000000          <2>  jmp unhand2
   423                              <2>  %assign i i+1
   424 00000453 FA                  <2>  cli
   425 00000454 C605[3A060000]16    <2>  mov byte [intprob], i
   426 0000045B E9DD000000          <2>  jmp unhand2
   427                              <2>  %assign i i+1
   428 00000460 FA                  <2>  cli
   429 00000461 C605[3A060000]17    <2>  mov byte [intprob], i
   430 00000468 E9D0000000          <2>  jmp unhand2
   431                              <2>  %assign i i+1
   432 0000046D FA                  <2>  cli
   433 0000046E C605[3A060000]18    <2>  mov byte [intprob], i
   434 00000475 E9C3000000          <2>  jmp unhand2
   435                              <2>  %assign i i+1
   436 0000047A FA                  <2>  cli
   437 0000047B C605[3A060000]19    <2>  mov byte [intprob], i
   438 00000482 E9B6000000          <2>  jmp unhand2
   439                              <2>  %assign i i+1
   440 00000487 FA                  <2>  cli
   441 00000488 C605[3A060000]1A    <2>  mov byte [intprob], i
   442 0000048F E9A9000000          <2>  jmp unhand2
   443                              <2>  %assign i i+1
   444 00000494 FA                  <2>  cli
   445 00000495 C605[3A060000]1B    <2>  mov byte [intprob], i
   446 0000049C E99C000000          <2>  jmp unhand2
   447                              <2>  %assign i i+1
   448 000004A1 FA                  <2>  cli
   449 000004A2 C605[3A060000]1C    <2>  mov byte [intprob], i
   450 000004A9 E98F000000          <2>  jmp unhand2
   451                              <2>  %assign i i+1
   452 000004AE FA                  <2>  cli
   453 000004AF C605[3A060000]1D    <2>  mov byte [intprob], i
   454 000004B6 E982000000          <2>  jmp unhand2
   455                              <2>  %assign i i+1
   456 000004BB FA                  <2>  cli
   457 000004BC C605[3A060000]1E    <2>  mov byte [intprob], i
   458 000004C3 E975000000          <2>  jmp unhand2
   459                              <2>  %assign i i+1
   460 000004C8 FA                  <2>  cli
   461 000004C9 C605[3A060000]1F    <2>  mov byte [intprob], i
   462 000004D0 E968000000          <2>  jmp unhand2
   463                              <2>  %assign i i+1
   464 000004D5 FA                  <2>  cli
   465 000004D6 C605[3A060000]20    <2>  mov byte [intprob], i
   466 000004DD E95B000000          <2>  jmp unhand2
   467                              <2>  %assign i i+1
   468 000004E2 FA                  <2>  cli
   469 000004E3 C605[3A060000]21    <2>  mov byte [intprob], i
   470 000004EA E94E000000          <2>  jmp unhand2
   471                              <2>  %assign i i+1
   472 000004EF FA                  <2>  cli
   473 000004F0 C605[3A060000]22    <2>  mov byte [intprob], i
   474 000004F7 E941000000          <2>  jmp unhand2
   475                              <2>  %assign i i+1
   476 000004FC FA                  <2>  cli
   477 000004FD C605[3A060000]23    <2>  mov byte [intprob], i
   478 00000504 E934000000          <2>  jmp unhand2
   479                              <2>  %assign i i+1
   480 00000509 FA                  <2>  cli
   481 0000050A C605[3A060000]24    <2>  mov byte [intprob], i
   482 00000511 E927000000          <2>  jmp unhand2
   483                              <2>  %assign i i+1
   484 00000516 FA                  <2>  cli
   485 00000517 C605[3A060000]25    <2>  mov byte [intprob], i
   486 0000051E E91A000000          <2>  jmp unhand2
   487                              <2>  %assign i i+1
   488 00000523 FA                  <2>  cli
   489 00000524 C605[3A060000]26    <2>  mov byte [intprob], i
   490 0000052B E90D000000          <2>  jmp unhand2
   491                              <2>  %assign i i+1
   492 00000530 FA                  <2>  cli
   493 00000531 C605[3A060000]27    <2>  mov byte [intprob], i
   494 00000538 E900000000          <2>  jmp unhand2
   495                              <2>  %assign i i+1
   496                              <1> unhand2:
   497 0000053D 60                  <1> 	pushad
   498 0000053E C705[2D030000]0000- <1> 	mov dword [user2codepoint], 0
   499 00000546 0000                <1>
   500 00000548 89E6                <1> 	mov esi, esp
   501 0000054A 81C628000000        <1> 	add esi, ((unhndrgend - unhndrg)/13)*4
   502 00000550 8935[30060000]      <1> 	mov [esploc], esi
   503 00000556 BE[3B060000]        <1> 	mov esi, unhandmsg
   504 0000055B 8935[34060000]      <1> 	mov [esiloc], esi
   505 00000561 B900000000          <1> 	mov ecx, 0
   506 00000566 8A0D[3A060000]      <1> 	mov cl, [intprob]
   507 0000056C E85A000000          <1> 	call expdump
   508                              <1> dumpstack:
   509 00000571 8B35[30060000]      <1> 	mov esi, [esploc]
   510 00000577 39E6                <1> 	cmp esi, esp
   511 00000579 7216                <1> 	jb donedump
   512 0000057B 368B0E              <1> 	mov ecx, [ss:esi]
   513 0000057E 81EE04000000        <1> 	sub esi, 4
   514 00000584 8935[30060000]      <1> 	mov [esploc], esi
   515 0000058A E83C000000          <1> 	call expdump
   516 0000058F EBE0                <1> 	jmp dumpstack
   517                              <1> donedump:
   518 00000591 8B35[30060000]      <1> 	mov esi, [esploc]
   519 00000597 368B7C2420          <1> 	mov edi, [ss:esp + 32]
   520 0000059C 8B4FFC              <1> 	mov ecx, [edi - 4]
   521 0000059F E827000000          <1> 	call expdump
   522 000005A4 8B35[30060000]      <1> 	mov esi, [esploc]
   523 000005AA 368B7C2420          <1> 	mov edi, [ss:esp + 32]
   524 000005AF 8B0F                <1> 	mov ecx, [edi]
   525 000005B1 E815000000          <1> 	call expdump
   526 000005B6 8B35[30060000]      <1> 	mov esi, [esploc]
   527 000005BC 368B7C2420          <1> 	mov edi, [ss:esp + 32]
   528 000005C1 8B4F04              <1> 	mov ecx, [edi + 4]
   529 000005C4 E802000000          <1> 	call expdump
   530 000005C9 EBFE                <1> 	jmp $
   531                              <1> expdump:
   532 000005CB 8B35[34060000]      <1> 	mov esi, [esiloc]
   533 000005D1 89F7                <1> 	mov edi, esi
   534 000005D3 81C70D000000        <1> 	add edi, 13
   535 000005D9 81C604000000        <1> 	add esi, 4
   536 000005DF 893D[34060000]      <1> 	mov [esiloc], edi
   537 000005E5 4F                  <1> 	dec edi
   538 000005E6 E8540B0000          <1> 	call converthex
   539 000005EB 81EE04000000        <1> 	sub esi, 4
   540 000005F1 803D[BA270000]00    <1> 	cmp byte [guion], 0
   541 000005F8 0F8422000000        <1> 	je near expdumptext
   542 000005FE 668B0D[38060000]    <1> 	mov cx, [locunhand]
   543 00000605 668105[38060000]10- <1> 	add word [locunhand], 16
   544 0000060D 00                  <1>
   545 0000060E 66BA0200            <1> 	mov dx, 2
   546 00000612 66B80100            <1> 	mov ax, 1
   547 00000616 66BB0000            <1> 	mov bx, 0
   548 0000061A E85F2B0000          <1> 	call showstring
   549 0000061F C3                  <1> 	ret
   550                              <1> expdumptext:
   551 00000620 E8FC040000          <1> 	call print
   552 00000625 BE[06400000]        <1> 	mov esi, line
   553 0000062A E8F2040000          <1> 	call print
   554 0000062F C3                  <1> 	ret
   555 00000630 00000000            <1> esploc dd 0
   556 00000634 00000000            <1> esiloc dd 0
   557 00000638 0100                <1> locunhand dw 1
   558 0000063A 00                  <1> intprob db 0
   559                              <1> 	unhandmsg:	
   560 0000063B 494E54203030303030- <1> 			db "INT 00000000",0
   561 00000644 30303000            <1>
   562                              <1> unhndrg:
   563 00000648 45464C3D3030303030- <1> 			db "EFL=00000000",0
   564 00000651 30303000            <1>
   565 00000655 43533A3D3030303030- <1> 			db "CS:=00000000",0
   566 0000065E 30303000            <1>
   567 00000662 4549503D3030303030- <1> 			db "EIP=00000000",0
   568 0000066B 30303000            <1>
   569 0000066F 4541583D3030303030- <1> 			db "EAX=00000000",0
   570 00000678 30303000            <1>
   571 0000067C 4543583D3030303030- <1> 			db "ECX=00000000",0
   572 00000685 30303000            <1>
   573 00000689 4544583D3030303030- <1> 			db "EDX=00000000",0
   574 00000692 30303000            <1>
   575 00000696 4542583D3030303030- <1> 			db "EBX=00000000",0
   576 0000069F 30303000            <1>
   577 000006A3 4553503D3030303030- <1> 			db "ESP=00000000",0
   578 000006AC 30303000            <1>
   579 000006B0 4542503D3030303030- <1> 			db "EBP=00000000",0
   580 000006B9 30303000            <1>
   581 000006BD 4553493D3030303030- <1> 			db "ESI=00000000",0
   582 000006C6 30303000            <1>
   583 000006CA 4544493D3030303030- <1> unhndrgend:	db "EDI=00000000",0
   584 000006D3 30303000            <1>
   585 000006D7 434D443D3030303030- <1> 			db "CMD=00000000",0
   586 000006E0 30303000            <1>
   587 000006E4 434D443D3030303030- <1> 			db "CMD=00000000",0
   588 000006ED 30303000            <1>
   589 000006F1 434D443D3030303030- <1> 			db "CMD=00000000",0
   590 000006FA 30303000            <1>
   591                              <1> unhandmsgend:
   592                              <1> 
   593                              <1> [BITS 16]
   594                              <1> 
   595                              <1> ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
   596                              <1> ;	16-bit limit/32-bit linear base address of GDT and IDT
   597                              <1> ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
   598 000006FE 2700                <1> gdtr:	dw gdt_end - gdt - 1	; GDT limit
   599 00000700 [0A070000]          <1> 	dd gdt			; linear, physical address of GDT
   600                              <1> 
   601 00000704 8701                <1> idtr:	dw idt_end - idt - 1	; IDT limit
   602 00000706 [37070000]          <1> 	dd idt			; linear, physical address of IDT
   603                              <1> 
   604                              <1> 
   605 0000070A 0000                <1> gdt:	dw 0			; limit 15:0
   606 0000070C 0000                <1> 	dw 0			; base 15:0
   607 0000070E 00                  <1> 	db 0			; base 23:16
   608 0000070F 00                  <1> 	db 0			; type
   609 00000710 00                  <1> 	db 0			; limit 19:16, flags
   610 00000711 00                  <1> 	db 0			; base 31:24
   611                              <1> ; linear data segment descriptor
   612                              <1> LINEAR_SEL	equ	$-gdt
   613 00000712 FFFF                <1> 	dw 0xFFFF		; limit 0xFFFFF
   614 00000714 0000                <1> 	dw 0			; base for this one is always 0
   615 00000716 00                  <1> 	db 0
   616 00000717 92                  <1> 	db 0x92			; present, ring 0, data, expand-up, writable
   617 00000718 CF                  <1> 	db 0xCF			; page-granular, 32-bit
   618 00000719 00                  <1> 	db 0
   619                              <1> ; code segment descriptor
   620                              <1> SYS_CODE_SEL	equ	$-gdt
   621 0000071A FFFF                <1> gdt2:	dw 0xFFFF
   622 0000071C 0000                <1> 	dw 0			; (base gets set above)
   623 0000071E 00                  <1> 	db 0
   624 0000071F 9A                  <1> 	db 0x9A			; present, ring 0, code, non-conforming, readable
   625 00000720 CF                  <1> 	db 0xCF
   626 00000721 00                  <1> 	db 0
   627                              <1> ; data segment descriptor
   628                              <1> SYS_DATA_SEL	equ	$-gdt
   629 00000722 FFFF                <1> gdt3:	dw 0xFFFF
   630 00000724 0000                <1> 	dw 0			; (base gets set above)
   631 00000726 00                  <1> 	db 0
   632 00000727 92                  <1> 	db 0x92			; present, ring 0, data, expand-up, writable
   633 00000728 CF                  <1> 	db 0xCF
   634 00000729 00                  <1> 	db 0
   635                              <1> STACK_SEL	equ	$-gdt
   636 0000072A 0100                <1> gdts:	dw 1
   637 0000072C 0000                <1> 	dw 0			; (base gets set above)
   638 0000072E 00                  <1> 	db 0
   639 0000072F 92                  <1> 	db 0x92			; present, ring 0, data, expand-up, writable
   640 00000730 C0                  <1> 	db 0xC0
   641 00000731 00                  <1> 	db 0
   642                              <1> gdt_end:
   643                              <1> ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
   644                              <1> ;	interrupt descriptor table (IDT)
   645                              <1> ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
   646                              <1> ; 32 reserved interrupts:
   647 00000732 494454              <1> db "IDT"
   648 00000735 [3503]              <1> dw unhand
   649                              <1> idt:	
   650                              <1> %assign i 0
   651                              <1> %rep    48
   652                              <1>         dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   653                              <1> %assign i i+1 
   654                              <1> %endrep
   655 00000737 [3503]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   656                              <2> %assign i i+1
   657 0000073F [4203]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   658                              <2> %assign i i+1
   659 00000747 [4F03]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   660                              <2> %assign i i+1
   661 0000074F [5C03]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   662                              <2> %assign i i+1
   663 00000757 [6903]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   664                              <2> %assign i i+1
   665 0000075F [7603]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   666                              <2> %assign i i+1
   667 00000767 [8303]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   668                              <2> %assign i i+1
   669 0000076F [9003]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   670                              <2> %assign i i+1
   671 00000777 [9D03]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   672                              <2> %assign i i+1
   673 0000077F [AA03]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   674                              <2> %assign i i+1
   675 00000787 [B703]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   676                              <2> %assign i i+1
   677 0000078F [C403]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   678                              <2> %assign i i+1
   679 00000797 [D103]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   680                              <2> %assign i i+1
   681 0000079F [DE03]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   682                              <2> %assign i i+1
   683 000007A7 [EB03]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   684                              <2> %assign i i+1
   685 000007AF [F803]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   686                              <2> %assign i i+1
   687 000007B7 [0504]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   688                              <2> %assign i i+1
   689 000007BF [1204]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   690                              <2> %assign i i+1
   691 000007C7 [1F04]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   692                              <2> %assign i i+1
   693 000007CF [2C04]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   694                              <2> %assign i i+1
   695 000007D7 [3904]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   696                              <2> %assign i i+1
   697 000007DF [4604]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   698                              <2> %assign i i+1
   699 000007E7 [5304]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   700                              <2> %assign i i+1
   701 000007EF [6004]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   702                              <2> %assign i i+1
   703 000007F7 [6D04]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   704                              <2> %assign i i+1
   705 000007FF [7A04]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   706                              <2> %assign i i+1
   707 00000807 [8704]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   708                              <2> %assign i i+1
   709 0000080F [9404]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   710                              <2> %assign i i+1
   711 00000817 [A104]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   712                              <2> %assign i i+1
   713 0000081F [AE04]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   714                              <2> %assign i i+1
   715 00000827 [BB04]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   716                              <2> %assign i i+1
   717 0000082F [C804]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   718                              <2> %assign i i+1
   719 00000837 [D504]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   720                              <2> %assign i i+1
   721 0000083F [E204]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   722                              <2> %assign i i+1
   723 00000847 [EF04]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   724                              <2> %assign i i+1
   725 0000084F [FC04]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   726                              <2> %assign i i+1
   727 00000857 [0905]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   728                              <2> %assign i i+1
   729 0000085F [1605]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   730                              <2> %assign i i+1
   731 00000867 [2305]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   732                              <2> %assign i i+1
   733 0000086F [3005]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   734                              <2> %assign i i+1
   735 00000877 [3D05]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   736                              <2> %assign i i+1
   737 0000087F [4A05]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   738                              <2> %assign i i+1
   739 00000887 [5705]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   740                              <2> %assign i i+1
   741 0000088F [6405]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   742                              <2> %assign i i+1
   743 00000897 [7105]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   744                              <2> %assign i i+1
   745 0000089F [7E05]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   746                              <2> %assign i i+1
   747 000008A7 [8B05]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   748                              <2> %assign i i+1
   749 000008AF [9805]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   750                              <2> %assign i i+1
   751                              <1> ;;INT 30h for os use and 3rd party use:
   752 000008B7 [BF08]1000008E0000  <1> 	dw newints,SYS_CODE_SEL,0x8E00,0
   753                              <1> idt_end:
   754                              <1> [BITS 32]
   755                                  [BITS 32]
   756                                      %include 'source/ints.asm'
   757                              <1> newints:	;;for great justice
   758 000008BF 80FC00              <1> 	cmp ah, 0		;;originally 0
   759 000008C2 0F8449000000        <1> 	je near intx0   ;;0=kills app
   760 000008C8 80FC01              <1> 	cmp ah, 1		;;originally 1
   761 000008CB 0F8445000000        <1> 	je near intx1   ;;3=print string
   762 000008D1 80FC02              <1> 	cmp ah, 2		;;originally 2
   763 000008D4 0F8442000000        <1> 	je near intx2	;;4=read string
   764 000008DA 80FC03              <1> 	cmp ah, 3		;;originally 3
   765 000008DD 0F843F000000        <1> 	je near intx3	;;6=clear screen
   766 000008E3 80FC04              <1> 	cmp ah, 4		;;originally 4
   767 000008E6 0F843C000000        <1> 	je near intx4	;;5=read and print string
   768 000008EC 80FC05              <1> 	cmp ah, 5		;;originally 5		
   769 000008EF 0F8439000000        <1> 	je near intx5	;;2=get char
   770 000008F5 80FC06              <1> 	cmp ah, 6		;;originally 6
   771 000008F8 0F8436000000        <1> 	je near intx6	;;1=print char
   772 000008FE 80FC07              <1> 	cmp ah, 7
   773 00000901 0F8433000000        <1> 	je near intx7	;;read file
   774 00000907 80FC0A              <1> 	cmp ah, 10
   775 0000090A 0F8430000000        <1> 	je near intx10	;;create thread
   776 00000910 C3                  <1> 	ret
   777                              <1> 	
   778                              <1> intx0:
   779 00000911 E9E3040000          <1> 	jmp nwcmd
   780                              <1> intx1:
   781 00000916 E80E020000          <1> 	call int303
   782 0000091B C3                  <1> 	ret
   783                              <1> intx2:
   784 0000091C E825020000          <1> 	call int304
   785 00000921 C3                  <1> 	ret
   786                              <1> intx3:
   787 00000922 E8A9020000          <1> 	call int306
   788 00000927 C3                  <1> 	ret
   789                              <1> intx4:
   790 00000928 E840020000          <1> 	call int305
   791 0000092D C3                  <1> 	ret
   792                              <1> intx5:
   793 0000092E E8BE010000          <1> 	call int302
   794 00000933 C3                  <1> 	ret
   795                              <1> intx6:
   796 00000934 E812000000          <1> 	call int301
   797 00000939 C3                  <1> 	ret
   798                              <1> intx7:
   799 0000093A E86E340000          <1> 	call loadfile
   800 0000093F C3                  <1> 	ret
   801                              <1> intx10:
   802                              <1> ;	call thread
   803 00000940 C3                  <1> 	ret
   804                              <1> 	
   805 00000941 0000                <1> linebeginpos dw 0
   806 00000943 0000                <1> videobufpos: dw 0
   807 00000945 0000                <1> charpos db 0,0
   808 00000947 A01E                <1> charxy db 160,30
   809 00000949 0000                <1> charbuf dw 0
   810                              <1> 
   811                              <1> int301:	;;print char, char in al, modifier in bl, will run videobuf2copy if called as is
   812 0000094B E807000000          <1> 	call int301prnt
   813 00000950 E9C1020000          <1> 	jmp termcopy
   814 00000955 00                  <1> termguion db 0
   815 00000956 00                  <1> termcopyon db 0
   816                              <1> int301prnt:
   817 00000957 88DC                <1> 	mov ah, bl
   818 00000959 66A3[49090000]      <1> 	mov [charbuf], ax
   819 0000095F BB00000000          <1> 	mov ebx, 0
   820 00000964 668B1D[43090000]    <1> 	mov bx, [videobufpos]
   821 0000096B BF[851C0000]        <1> 	mov edi, videobuf2
   822 00000970 01DF                <1> 	add edi, ebx
   823 00000972 66A1[140C0000]      <1> 	mov ax, [removedvideo]
   824 00000978 668907              <1> 	mov [edi], ax
   825 0000097B 66A1[49090000]      <1> 	mov ax, [charbuf]
   826 00000981 BA00000000          <1> 	mov edx, 0
   827 00000986 668B15[45090000]    <1> 	mov dx, [charpos]
   828 0000098D B900000000          <1> 	mov ecx, 0
   829 00000992 668B0D[47090000]    <1> 	mov cx, [charxy]
   830 00000999 3C0D                <1> 	cmp al, 13
   831 0000099B 0F8454000000        <1> 	je near int301cr
   832 000009A1 3C0A                <1> 	cmp al, 10
   833 000009A3 0F8482000000        <1> 	je near int301nl
   834 000009A9 3C08                <1> 	cmp al, 8
   835 000009AB 0F845B000000        <1> 	je near int301bs
   836 000009B1 668907              <1> 	mov [edi], ax
   837 000009B4 81C702000000        <1> 	add edi, 2
   838 000009BA 80C202              <1> 	add dl, 2
   839                              <1> donecrnl:
   840 000009BD 38CA                <1> 	cmp dl, cl
   841 000009BF 0F8397000000        <1> 	jae near int301eol
   842                              <1> doneeol:
   843 000009C5 38EE                <1> 	cmp dh, ch
   844 000009C7 0F83AD000000        <1> 	jae near int301scr	
   845                              <1> donescr:
   846 000009CD 89FB                <1> 	mov ebx, edi
   847 000009CF 668B07              <1> 	mov ax, [edi]
   848 000009D2 66A3[140C0000]      <1> 	mov [removedvideo], ax
   849 000009D8 81EB[851C0000]      <1> 	sub ebx, videobuf2
   850 000009DE 66891D[43090000]    <1> 	mov [videobufpos], bx
   851 000009E5 668915[45090000]    <1> 	mov [charpos], dx
   852 000009EC 66A1[49090000]      <1> 	mov ax, [charbuf]
   853 000009F2 88E3                <1> 	mov bl, ah
   854 000009F4 C3                  <1> 	ret
   855                              <1> 	
   856                              <1> 	int301cr:
   857 000009F5 B200                <1> 		mov dl, 0
   858 000009F7 BB00000000          <1> 		mov ebx, 0
   859 000009FC BF[851C0000]        <1> 		mov edi, videobuf2
   860 00000A01 668B1D[41090000]    <1> 		mov bx, [linebeginpos]
   861 00000A08 01DF                <1> 		add edi, ebx
   862 00000A0A EBB1                <1> 		jmp donecrnl
   863                              <1> 			
   864                              <1> 	int301bs:
   865 00000A0C 80FA00              <1> 		cmp dl, 0
   866 00000A0F 740F                <1> 		je int301backline
   867                              <1> 	int301nobmr:
   868 00000A11 80EA02              <1> 		sub dl, 2
   869 00000A14 66B80000            <1> 		mov ax, 0
   870 00000A18 81EF02000000        <1> 		sub edi, 2
   871 00000A1E EB9D                <1> 		jmp donecrnl
   872                              <1> 	int301backline:
   873 00000A20 88CA                <1> 		mov dl, cl
   874 00000A22 80FE00              <1> 		cmp dh, 0
   875 00000A25 74EA                <1> 		je int301nobmr
   876 00000A27 FECE                <1> 		dec dh
   877 00000A29 EBE6                <1> 		jmp int301nobmr
   878                              <1> 		
   879                              <1> 	int301nl:
   880 00000A2B FEC6                <1> 		inc dh
   881 00000A2D BB00000000          <1> 		mov ebx, 0
   882 00000A32 88CB                <1> 		mov bl, cl
   883 00000A34 BF[851C0000]        <1> 		mov edi, videobuf2
   884 00000A39 66031D[43090000]    <1> 		add bx, [videobufpos]
   885 00000A40 01DF                <1> 		add edi, ebx
   886 00000A42 BB00000000          <1> 		mov ebx, 0
   887 00000A47 88CB                <1> 		mov bl, cl
   888 00000A49 66031D[41090000]    <1> 		add bx, [linebeginpos]
   889 00000A50 66891D[41090000]    <1> 		mov [linebeginpos], bx
   890 00000A57 E961FFFFFF          <1> 		jmp donecrnl
   891                              <1> 		
   892                              <1> 	int301eol:
   893 00000A5C B200                <1> 		mov dl, 0
   894 00000A5E FEC6                <1> 		inc dh
   895 00000A60 BB00000000          <1> 		mov ebx, 0
   896 00000A65 88CB                <1> 		mov bl, cl
   897 00000A67 66031D[41090000]    <1> 		add bx, [linebeginpos]
   898 00000A6E 66891D[41090000]    <1> 		mov [linebeginpos], bx
   899 00000A75 E94BFFFFFF          <1> 		jmp doneeol
   900                              <1> 		
   901                              <1> 	int301scr:
   902 00000A7A FECE                <1> 		dec dh
   903 00000A7C BF[851C0000]        <1> 		mov edi, videobuf2
   904 00000A81 BB00000000          <1> 		mov ebx, 0
   905 00000A86 88CB                <1> 		mov bl, cl
   906 00000A88 01FB                <1> 		add ebx, edi
   907                              <1> 	intscrollloop:
   908 00000A8A 668B03              <1> 		mov ax, [ebx]
   909 00000A8D 668907              <1> 		mov [edi], ax
   910 00000A90 81C702000000        <1> 		add edi, 2
   911 00000A96 81C302000000        <1> 		add ebx, 2
   912 00000A9C 80E902              <1> 		sub cl, 2
   913 00000A9F 80F900              <1> 		cmp cl, 0
   914 00000AA2 75E6                <1> 		jne intscrollloop
   915 00000AA4 8A0D[47090000]      <1> 		mov cl, [charxy]
   916 00000AAA FECD                <1> 		dec ch
   917 00000AAC 80FD01              <1> 		cmp ch, 1
   918 00000AAF 77D9                <1> 		ja intscrollloop
   919 00000AB1 66B80000            <1> 		mov ax, 0
   920 00000AB5 81EF[851C0000]      <1> 		sub edi, videobuf2
   921 00000ABB 66893D[41090000]    <1> 		mov [linebeginpos], di
   922 00000AC2 81C7[851C0000]      <1> 		add edi, videobuf2
   923 00000AC8 89FB                <1> 		mov ebx, edi
   924                              <1> 	intloopclear:
   925 00000ACA 668903              <1> 		mov [ebx], ax
   926 00000ACD 81C302000000        <1> 		add ebx, 2
   927 00000AD3 80E902              <1> 		sub cl, 2
   928 00000AD6 80F900              <1> 		cmp cl, 0
   929 00000AD9 75EF                <1> 		jne intloopclear
   930 00000ADB FECD                <1> 		dec ch
   931 00000ADD 80FD00              <1> 		cmp ch, 0
   932 00000AE0 75E8                <1> 		jne intloopclear
   933 00000AE2 668B0D[47090000]    <1> 		mov cx, [charxy]
   934 00000AE9 E9DFFEFFFF          <1> 		jmp donescr
   935                              <1> 		
   936                              <1> 		
   937 00000AEE 0000                <1> lastkey db 0,0
   938 00000AF0 00                  <1> trans db 0
   939                              <1> 
   940                              <1> 	int302:		;;get char, if al is 0, wait for key
   941 00000AF1 A2[F00A0000]        <1> 		mov [trans], al
   942                              <1> 	transcheck:
   943 00000AF6 E880170000          <1> 		call guistartin
   944 00000AFB 8A3D[F00A0000]      <1> 		mov bh, [trans]
   945 00000B01 66A1[EE0A0000]      <1> 		mov ax, [lastkey]
   946 00000B07 80FC1C              <1> 		cmp ah, 1Ch
   947 00000B0A 740C                <1> 		je int302enter
   948 00000B0C 08C7                <1> 		or bh, al
   949 00000B0E 80FF00              <1> 		cmp bh, 0
   950 00000B11 74E3                <1> 		je transcheck
   951 00000B13 E907000000          <1> 		jmp int302end
   952                              <1> 	int302enter:
   953 00000B18 B00D                <1> 		mov al, 13
   954 00000B1A E900000000          <1> 		jmp int302end
   955                              <1> 	int302end:
   956 00000B1F C3                  <1> 		ret
   957                              <1> 	
   958 00000B20 00                  <1> endkey303 db 0
   959                              <1>     print:
   960 00000B21 66B80000            <1> 		mov ax, 0
   961 00000B25 66BB0700            <1> 		mov bx, 7
   962                              <1> 	int303:	;;print line, al=last key,bl=modifier, esi=buffer
   963 00000B29 A2[200B0000]        <1> 		mov [endkey303], al
   964                              <1> 	int303b:
   965 00000B2E 8A06                <1> 		mov al, [esi]
   966 00000B30 3A05[200B0000]      <1> 		cmp al, [endkey303]
   967 00000B36 7408                <1> 		je doneint303
   968 00000B38 E81AFEFFFF          <1> 		call int301prnt
   969 00000B3D 46                  <1> 		inc esi
   970 00000B3E EBEE                <1> 		jmp int303b
   971                              <1> 	doneint303:
   972 00000B40 E9D1000000          <1> 		jmp termcopy
   973                              <1> 	
   974 00000B45 00                  <1> endkey304 db 0
   975                              <1> 	int304:	;;get line, al=last key, esi = buffer
   976 00000B46 A2[450B0000]        <1> 		mov [endkey304], al
   977                              <1> 	int304b:
   978 00000B4B 56                  <1> 		push esi
   979 00000B4C B000                <1> 		mov al, 0
   980 00000B4E E89EFFFFFF          <1> 		call int302
   981 00000B53 5E                  <1> 		pop esi
   982 00000B54 8806                <1> 		mov [esi], al
   983 00000B56 46                  <1> 		inc esi
   984 00000B57 3A05[450B0000]      <1> 		cmp al, [endkey304]
   985 00000B5D 75EC                <1> 		jne int304b
   986 00000B5F 4E                  <1> 		dec esi
   987 00000B60 C60600              <1> 		mov byte [esi], 0
   988 00000B63 C3                  <1> 	ret
   989                              <1> 	
   990 00000B64 00                  <1> endkey305 db 0
   991 00000B65 00                  <1> modkey305 db 0
   992 00000B66 00000000            <1> firstesi305 dd 0
   993 00000B6A 082000              <1> backcursor db 8," ",0
   994                              <1> 	int305:	;;print and get line, al=last key, bl=modifier, esi=buffer
   995 00000B6D A2[640B0000]        <1> 		mov [endkey305], al
   996 00000B72 881D[650B0000]      <1> 		mov [modkey305], bl
   997 00000B78 8935[660B0000]      <1> 		mov [firstesi305], esi
   998                              <1> 	int305b:
   999 00000B7E 56                  <1> 		push esi
  1000 00000B7F B000                <1> 		mov al, 0
  1001 00000B81 E86BFFFFFF          <1> 		call int302
  1002 00000B86 5E                  <1> 		pop esi
  1003 00000B87 3C08                <1> 		cmp al, 8
  1004 00000B89 0F841D000000        <1> 		je near int305bscheck
  1005 00000B8F 8806                <1> 		mov [esi], al
  1006 00000B91 46                  <1> 		inc esi
  1007                              <1> 	bscheckequal:
  1008 00000B92 8A1D[650B0000]      <1> 		mov bl, [modkey305]
  1009 00000B98 E8AEFDFFFF          <1> 		call int301
  1010 00000B9D 8A25[640B0000]      <1> 		mov ah, [endkey305]
  1011 00000BA3 38E0                <1> 		cmp al, ah
  1012 00000BA5 75D7                <1> 		jne int305b
  1013 00000BA7 4E                  <1> 		dec esi
  1014 00000BA8 C60600              <1> 		mov byte [esi], 0
  1015 00000BAB C3                  <1> 		ret
  1016                              <1> 	
  1017                              <1> 	int305bscheck:
  1018 00000BAC 3B35[660B0000]      <1> 		cmp esi, [firstesi305]
  1019 00000BB2 7702                <1> 		ja goodbscheck
  1020 00000BB4 EBC8                <1> 		jmp int305b
  1021                              <1> 	goodbscheck:
  1022 00000BB6 4E                  <1> 		dec esi
  1023 00000BB7 C60600              <1> 		mov byte [esi], 0
  1024 00000BBA 8A1D[650B0000]      <1> 		mov bl, [modkey305]
  1025 00000BC0 56                  <1> 		push esi
  1026 00000BC1 BE[6A0B0000]        <1> 		mov esi, backcursor
  1027 00000BC6 E856FFFFFF          <1> 		call print		
  1028 00000BCB 5E                  <1> 		pop esi
  1029 00000BCC B008                <1> 		mov al, 8
  1030 00000BCE EBC2                <1> 		jmp bscheckequal
  1031                              <1> 		
  1032                              <1> 	clear:		
  1033                              <1> 	
  1034                              <1> 	int306:	;;clear screen
  1035 00000BD0 668B0D[47090000]    <1> 		mov cx, [charxy]
  1036 00000BD7 BF[851C0000]        <1> 		mov edi, videobuf2
  1037 00000BDC 66B80000            <1> 		mov ax, 0
  1038 00000BE0 66A3[41090000]      <1> 		mov [linebeginpos], ax
  1039 00000BE6 66A3[43090000]      <1> 		mov [videobufpos], ax
  1040 00000BEC 66BA0000            <1> 		mov dx, 0
  1041 00000BF0 66A3[45090000]      <1> 		mov [charpos], ax
  1042                              <1> 	int306b:
  1043 00000BF6 668907              <1> 		mov [edi], ax
  1044 00000BF9 81C702000000        <1> 		add edi, 2
  1045 00000BFF 80E902              <1> 		sub cl, 2
  1046 00000C02 80F900              <1> 		cmp cl, 0
  1047 00000C05 75EF                <1> 		jne int306b
  1048 00000C07 8A0D[47090000]      <1> 		mov cl, [charxy]
  1049 00000C0D FECD                <1> 		dec ch
  1050 00000C0F 80FD00              <1> 		cmp ch, 0
  1051 00000C12 75E2                <1> 		jne int306b
  1052                              <1> 	
  1053 00000C14 0000                <1> 	removedvideo dw 0
  1054                              <1> 	
  1055                              <1> termcopy:	
  1056 00000C16 60                  <1> 	pusha
  1057 00000C17 BF[851C0000]        <1> 	mov edi, videobuf2
  1058 00000C1C BB00000000          <1> 	mov ebx, 0
  1059 00000C21 668B1D[43090000]    <1> 	mov bx, [videobufpos]
  1060 00000C28 01DF                <1> 	add edi, ebx
  1061 00000C2A B05F                <1> 	mov al, "_"
  1062 00000C2C B407                <1> 	mov ah, 7
  1063 00000C2E 668907              <1> 	mov [edi], ax
  1064 00000C31 C605[B9270000]00    <1> 	mov byte [mouseselecton], 0
  1065 00000C38 C605[56090000]01    <1> 	mov byte [termcopyon], 1
  1066 00000C3F 803D[BA270000]00    <1> 	cmp byte [guion], 0
  1067 00000C46 0F840D000000        <1> 	je near nowincopy
  1068 00000C4C 803D[55090000]01    <1> 	cmp byte [termguion], 1
  1069 00000C53 0F8438270000        <1> 	je near windowvideocopy
  1070                              <1> nowincopy:
  1071 00000C59 BE00000A00          <1> 	mov esi, 0xA0000
  1072 00000C5E A1[31030000]        <1> 	mov eax, [basecache]
  1073 00000C63 C1E004              <1> 	shl eax, 4
  1074 00000C66 29C6                <1> 	sub esi, eax
  1075 00000C68 BF[851C0000]        <1> 	mov edi, videobuf2
  1076 00000C6D B900000000          <1> 	mov ecx, 0
  1077 00000C72 668B0D[47090000]    <1> 	mov cx, [charxy]
  1078                              <1> nowincopy2:
  1079 00000C79 BB[29400000]        <1> 	mov ebx, fonts
  1080 00000C7E B800000000          <1> 	mov eax, 0
  1081 00000C83 8A07                <1> 	mov al, [edi]
  1082 00000C85 C1E004              <1> 	shl eax, 4
  1083 00000C88 01C3                <1> 	add ebx, eax
  1084 00000C8A 47                  <1> 	inc edi
  1085 00000C8B 8A27                <1> 	mov ah, [edi]
  1086 00000C8D BA00000000          <1> 	mov edx, 0
  1087 00000C92 8A15[47090000]      <1> 	mov dl, [charxy]
  1088 00000C98 D1EA                <1> 	shr edx, 1
  1089 00000C9A C1C110              <1> 	rol ecx, 16
  1090 00000C9D B110                <1> 	mov cl, 16
  1091                              <1> nowinfont:
  1092 00000C9F 8A03                <1> 	mov al, [ebx]
  1093 00000CA1 D0C8                <1> 	ror al, 1
  1094 00000CA3 80FC07              <1> 	cmp ah, 7
  1095 00000CA6 7602                <1> 	jbe notnotfont
  1096 00000CA8 F6D0                <1> 	not al
  1097                              <1> notnotfont:
  1098 00000CAA 8806                <1> 	mov [esi], al
  1099 00000CAC 01D6                <1> 	add esi, edx
  1100 00000CAE 43                  <1> 	inc ebx
  1101 00000CAF FEC9                <1> 	dec cl
  1102 00000CB1 80F900              <1> 	cmp cl, 0
  1103 00000CB4 75E9                <1> 	jne nowinfont
  1104 00000CB6 C1E204              <1> 	shl edx, 4
  1105 00000CB9 29D6                <1> 	sub esi, edx
  1106 00000CBB C1C110              <1> 	rol ecx, 16
  1107                              <1> nopresentwinfont:
  1108 00000CBE 47                  <1> 	inc edi
  1109 00000CBF 46                  <1> 	inc esi
  1110 00000CC0 80E902              <1> 	sub cl, 2
  1111 00000CC3 80F900              <1> 	cmp cl, 0
  1112 00000CC6 75B1                <1> 	jne nowincopy2
  1113 00000CC8 8A0D[47090000]      <1> 	mov cl, [charxy]
  1114 00000CCE BA00000000          <1> 	mov edx, 0
  1115 00000CD3 88CA                <1> 	mov dl, cl
  1116 00000CD5 D1EA                <1> 	shr edx, 1
  1117 00000CD7 29D6                <1> 	sub esi, edx
  1118 00000CD9 C1E204              <1> 	shl edx, 4
  1119 00000CDC 01D6                <1> 	add esi, edx
  1120 00000CDE FECD                <1> 	dec ch
  1121 00000CE0 80FD00              <1> 	cmp ch, 0
  1122 00000CE3 7594                <1> 	jne nowincopy2
  1123 00000CE5 61                  <1> 	popa
  1124 00000CE6 C3                  <1> 	ret
  1125                                      %include 'source/solleros.asm'
  1126                              <1> 	;SOLLEROS.ASM
  1127                              <1> os:
  1128 00000CE7 E8E4FEFFFF          <1> 	call clear
  1129 00000CEC BE[E63F0000]        <1> 	mov esi, userask
  1130 00000CF1 E82BFEFFFF          <1> 	call print
  1131                              <1> usercheck:
  1132 00000CF6 BE[701A0000]        <1> 	mov esi, buftxt
  1133 00000CFB B00D                <1> 	mov al, 13
  1134 00000CFD B404                <1> 	mov ah, 4
  1135 00000CFF CD30                <1> 	int 30h
  1136 00000D01 56                  <1> 	push esi
  1137 00000D02 BE[06400000]        <1> 	mov esi, line
  1138 00000D07 E815FEFFFF          <1> 	call print
  1139 00000D0C BE[F03F0000]        <1> 	mov esi, pwdask
  1140 00000D11 E80BFEFFFF          <1> 	call print
  1141 00000D16 5E                  <1> 	pop esi
  1142 00000D17 46                  <1> 	inc esi
  1143 00000D18 8935[CE0D0000]      <1> 	mov [esipass], esi
  1144                              <1> passcheck:
  1145 00000D1E B000                <1> 	mov al, 0
  1146 00000D20 B405                <1> 	mov ah, 5
  1147 00000D22 CD30                <1> 	int 30h
  1148 00000D24 3C0D                <1> 	cmp al, 13
  1149 00000D26 0F8435000000        <1> 	je near gotpass
  1150 00000D2C 3C08                <1> 	cmp al, 8
  1151 00000D2E 0F840F000000        <1> 	je near backpass
  1152 00000D34 8806                <1> 	mov [esi], al
  1153 00000D36 46                  <1> 	inc esi
  1154 00000D37 B02A                <1> 	mov al, '*'
  1155 00000D39 B406                <1> 	mov ah, 6
  1156 00000D3B CD30                <1> 	int 30h
  1157 00000D3D EBDF                <1> 	jmp passcheck
  1158 00000D3F 08200800            <1> backcursor2 db 8," ",8,0
  1159                              <1> backpass:
  1160 00000D43 3B35[CE0D0000]      <1> 	cmp esi, [esipass]
  1161 00000D49 0F84CFFFFFFF        <1> 	je near passcheck
  1162 00000D4F 4E                  <1> 	dec esi
  1163 00000D50 C60600              <1> 	mov byte [esi], 0
  1164 00000D53 56                  <1> 	push esi
  1165 00000D54 BE[3F0D0000]        <1> 	mov esi, backcursor2
  1166 00000D59 E8C3FDFFFF          <1> 	call print
  1167 00000D5E 5E                  <1> 	pop esi
  1168 00000D5F EBBD                <1> 	jmp passcheck
  1169                              <1> gotpass:
  1170 00000D61 B000                <1> 	mov al,0
  1171 00000D63 8806                <1> 	mov [esi], al
  1172 00000D65 BE[06400000]        <1> 	mov esi, line
  1173 00000D6A E8B2FDFFFF          <1> 	call print
  1174 00000D6F BB[09400000]        <1> 	mov ebx, userlst
  1175                              <1> userfind:
  1176 00000D74 BE[701A0000]        <1> 	mov esi, buftxt
  1177 00000D79 8A06                <1> 	mov al, [esi]
  1178 00000D7B 3C00                <1> 	cmp al, 0
  1179 00000D7D 0F8464FFFFFF        <1> 	je near os
  1180 00000D83 891D[D20D0000]      <1> 	mov [usercache], ebx
  1181 00000D89 E857010000          <1> 	call tester
  1182 00000D8E 3C01                <1> 	cmp al, 1
  1183 00000D90 7415                <1> 	je pwdtest
  1184                              <1> nxtuser:
  1185 00000D92 43                  <1> 	inc ebx
  1186 00000D93 8A03                <1> 	mov al, [ebx]
  1187 00000D95 3C00                <1> 	cmp al, 0
  1188 00000D97 74DB                <1> 	je userfind
  1189 00000D99 81FB[29400000]      <1> 	cmp ebx, userlstend
  1190 00000D9F 0F8342FFFFFF        <1> 	jae near os
  1191 00000DA5 EBCD                <1> 	jmp userfind
  1192                              <1> pwdtest:
  1193 00000DA7 46                  <1> 	inc esi
  1194 00000DA8 43                  <1> 	inc ebx
  1195 00000DA9 E837010000          <1> 	call tester
  1196 00000DAE 3C01                <1> 	cmp al, 1
  1197 00000DB0 7402                <1> 	je pwdrgt
  1198 00000DB2 EBDE                <1> 	jmp nxtuser
  1199 00000DB4 E817FEFFFF          <1> pwdrgt:	call clear
  1200 00000DB9 66B90002            <1> 	mov cx, 200h
  1201 00000DBD BE[701A0000]        <1> 	mov esi, buftxt
  1202 00000DC2 B000                <1> 	mov al, 0
  1203 00000DC4 8806                <1> bufclr:	mov [esi], al
  1204 00000DC6 46                  <1> 	inc esi
  1205 00000DC7 E2FB                <1> 	loop bufclr
  1206                              <1> ;;;;;;;;;;;;;;;;
  1207 00000DC9 E92B000000          <1> 	jmp nwcmd
  1208                              <1> 
  1209 00000DCE 00000000            <1> esipass dd 0
  1210 00000DD2 [09400000]          <1> usercache dd userlst
  1211                              <1> 	
  1212                              <1> buftxtclear:
  1213 00000DD6 B000                <1> 	mov al, 0
  1214 00000DD8 BE[701A0000]        <1> 	mov esi, buftxt
  1215 00000DDD 81FE[701C0000]      <1> clearbuftxt: cmp esi, buf2
  1216 00000DE3 730E                <1> 	jae retbufclr
  1217 00000DE5 8806                <1> 	mov [esi], al
  1218 00000DE7 46                  <1> 	inc esi
  1219 00000DE8 EBF3                <1> 	jmp clearbuftxt
  1220                              <1> 
  1221 00000DEA 39DE                <1> clearitbuf: cmp esi, ebx
  1222 00000DEC 7305                <1> 	jae retbufclr
  1223 00000DEE 8806                <1> 	mov [esi], al
  1224 00000DF0 46                  <1> 	inc esi
  1225 00000DF1 EBF7                <1> 	jmp clearitbuf
  1226 00000DF3 C3                  <1> retbufclr: ret
  1227                              <1> 
  1228 00000DF4 E900000000          <1> full:	jmp nwcmd
  1229                              <1> 
  1230                              <1> 
  1231 00000DF9 B001                <1> nwcmd:	mov al, 1
  1232 00000DFB 3805[69130000]      <1> 	cmp [BATCHISON], al
  1233 00000E01 0F8345000000        <1> 	jae near batchran
  1234 00000E07 B000                <1> cancel:	mov al, 0
  1235 00000E09 A2[00130000]        <1> 	mov [IFON], al
  1236 00000E0E A2[69130000]        <1> 	mov [BATCHISON], al
  1237 00000E13 B05B                <1> 	mov al, '['
  1238 00000E15 B406                <1> 	mov ah, 6
  1239 00000E17 66BB0700            <1> 	mov bx, 7
  1240 00000E1B E837FBFFFF          <1> 	call int301prnt
  1241 00000E20 8B35[D20D0000]      <1> 	mov esi, [usercache]
  1242 00000E26 E8F6FCFFFF          <1> 	call print
  1243 00000E2B BE[FA3F0000]        <1> 	mov esi, location
  1244 00000E30 E8ECFCFFFF          <1> 	call print
  1245                              <1> 	;call time
  1246                              <1> 	;mov esi, timeshow
  1247                              <1> 	;call print
  1248                              <1> 	;mov esi, cmd
  1249                              <1> 	;call print
  1250 00000E35 E89CFFFFFF          <1> 	call buftxtclear
  1251 00000E3A BE[701A0000]        <1> 	mov esi, buftxt
  1252 00000E3F B00D                <1> 	mov al, 13
  1253 00000E41 B307                <1> 	mov bl, 7
  1254 00000E43 B404                <1> 	mov ah, 4
  1255 00000E45 CD30                <1> 	int 30h
  1256                              <1> gotcmd:	
  1257 00000E47 E914000000          <1> 	jmp run
  1258                              <1> 	
  1259                              <1> batchran:
  1260 00000E4C C3                  <1> 	ret
  1261                              <1> 
  1262 00000E4D E884FFFFFF          <1> input:	call buftxtclear
  1263 00000E52 BE[701A0000]        <1> 	mov esi, buftxt		;puts input into buftxt AND onto screen
  1264 00000E57 B00D                <1> stdin:	mov al, 13
  1265 00000E59 B307                <1> 	mov bl, 7
  1266 00000E5B B404                <1> 	mov ah, 4
  1267 00000E5D CD30                <1> 	int 30h
  1268 00000E5F C3                  <1> 	ret
  1269                              <1> 
  1270 00000E60 BE[06400000]        <1> run:	mov esi, line
  1271 00000E65 E8B7FCFFFF          <1> 		call print
  1272                              <1> progtest:
  1273 00000E6A BE[701A0000]        <1> 	mov esi, buftxt
  1274 00000E6F BB[6F130000]        <1> 	mov ebx, fileindex
  1275 00000E74 668B03              <1> prgnxt:	mov ax, [ebx]
  1276 00000E77 B105                <1> 	mov cl, 5
  1277 00000E79 B504                <1> 	mov ch, 4
  1278 00000E7B 6639C8              <1> 	cmp ax, cx
  1279 00000E7E 740B                <1> 	je fndprg
  1280 00000E80 43                  <1> 	inc ebx
  1281 00000E81 81FB[6F150000]      <1> 	cmp ebx, fileindexend
  1282 00000E87 7330                <1> 	jae prgnf
  1283 00000E89 EBE9                <1> 	jmp prgnxt
  1284 00000E8B 81C302000000        <1> fndprg: add ebx, 2
  1285 00000E91 BE[701A0000]        <1> 	mov esi, buftxt
  1286 00000E96 66B90000            <1> 	mov cx, 0
  1287 00000E9A E880000000          <1> 	call cndtest
  1288 00000E9F 3C01                <1> 	cmp al, 1
  1289 00000EA1 7302                <1> 	jae prggood
  1290 00000EA3 EBCF                <1> 	jmp prgnxt
  1291 00000EA5 81FB[6F150000]      <1> prggood: cmp ebx, fileindexend
  1292 00000EAB 7333                <1> 	jae prgdn
  1293 00000EAD 81C303000000        <1> 	add ebx, 3
  1294 00000EB3 8B3B                <1> 	mov edi, [ebx]
  1295 00000EB5 90                  <1> 	nop
  1296 00000EB6 90                  <1> 	nop
  1297 00000EB7 FFE7                <1> 	jmp edi
  1298                              <1> prgnf:	
  1299 00000EB9 A0[701A0000]        <1> 	mov al, [buftxt]
  1300 00000EBE 3C00                <1> 	cmp al, 0
  1301 00000EC0 741E                <1> 	je prgdn
  1302 00000EC2 BE[CD3F0000]        <1> 	mov esi, notfound1
  1303 00000EC7 E855FCFFFF          <1> 	call print
  1304 00000ECC BE[701A0000]        <1> 	mov esi, buftxt
  1305 00000ED1 E84BFCFFFF          <1> 	call print
  1306 00000ED6 BE[D73F0000]        <1> 	mov esi, notfound2
  1307 00000EDB E841FCFFFF          <1> 	call print
  1308 00000EE0 E914FFFFFF          <1> prgdn:	jmp nwcmd
  1309                              <1> 
  1310                              <1> 
  1311                              <1> tester:			;si=user bx=prog returns 1 in al if true
  1312 00000EE5 B000                <1> 	mov al, 0
  1313 00000EE7 8A06                <1> retest:	mov al, [esi]
  1314 00000EE9 8A23                <1> 	mov ah, [ebx]
  1315 00000EEB 3C00                <1> 	cmp al, 0
  1316 00000EED 7408                <1> 	je testtrue
  1317 00000EEF 38E0                <1> 	cmp al, ah
  1318 00000EF1 750C                <1> 	jne testfalse
  1319 00000EF3 43                  <1> 	inc ebx
  1320 00000EF4 46                  <1> 	inc esi
  1321 00000EF5 EBF0                <1> 	jmp retest
  1322                              <1> testtrue:
  1323 00000EF7 80FC00              <1> 	cmp ah, 0
  1324 00000EFA 7503                <1> 	jne testfalse
  1325 00000EFC B001                <1> 	mov al, 1
  1326 00000EFE C3                  <1> 	ret
  1327                              <1> testfalse:
  1328 00000EFF B000                <1> 	mov al, 0
  1329 00000F01 C3                  <1> 	ret
  1330                              <1> 
  1331                              <1> optest:			;si=user bx=prog returns 1 in al if true
  1332 00000F02 B000                <1> 	mov al, 0
  1333                              <1> opretest:
  1334 00000F04 8A06                <1> 	mov al, [esi]
  1335 00000F06 8A23                <1> 	mov ah, [ebx]
  1336 00000F08 38E0                <1> 	cmp al, ah
  1337 00000F0A 7510                <1> 	jne optestfalse
  1338 00000F0C 80FC00              <1> 	cmp ah, 0
  1339 00000F0F 7404                <1> 	je optesttrue
  1340 00000F11 43                  <1> 	inc ebx
  1341 00000F12 46                  <1> 	inc esi
  1342 00000F13 EBEF                <1> 	jmp opretest
  1343                              <1> optesttrue:
  1344 00000F15 3C00                <1> 	cmp al, 0
  1345 00000F17 7503                <1> 	jne optestfalse
  1346 00000F19 B001                <1> 	mov al, 1
  1347 00000F1B C3                  <1> 	ret
  1348                              <1> optestfalse:
  1349 00000F1C B000                <1> 	mov al, 0
  1350 00000F1E C3                  <1> 	ret
  1351                              <1> 
  1352                              <1> cndtest:			;si=user bx=prog cl=endchar returns 1 in al if true
  1353 00000F1F B000                <1> 	mov al, 0
  1354 00000F21 8A06                <1> cndretest:	mov al, [esi]
  1355 00000F23 8A23                <1> 	mov ah, [ebx]
  1356 00000F25 38CC                <1> 	cmp ah, cl
  1357 00000F27 7408                <1> 	je cndtesttrue
  1358 00000F29 38E0                <1> 	cmp al, ah
  1359 00000F2B 750B                <1> 	jne cndtestfalse
  1360 00000F2D 43                  <1> 	inc ebx
  1361 00000F2E 46                  <1> 	inc esi
  1362 00000F2F EBF0                <1> 	jmp cndretest
  1363                              <1> cndtesttrue:
  1364 00000F31 38C8                <1> 	cmp al, cl
  1365 00000F33 7506                <1> 	jne cndtestalmost
  1366 00000F35 B001                <1> 	mov al, 1
  1367 00000F37 C3                  <1> 	ret
  1368                              <1> cndtestfalse:
  1369 00000F38 B000                <1> 	mov al, 0
  1370 00000F3A C3                  <1> 	ret
  1371                              <1> cndtestalmost:
  1372 00000F3B B002                <1> 	mov al, 2
  1373 00000F3D C3                  <1> 	ret
  1374 00000F3E 00                  <1> currentdir db 0
  1375 00000F3F BE[6F130000]        <1> dir:	mov esi, fileindex
  1376 00000F44 8A06                <1> 	dirnxt:	mov al, [esi]
  1377 00000F46 B400                <1> 		mov ah, 0
  1378 00000F48 3C05                <1> 		cmp al, 5
  1379 00000F4A 744A                <1> 		je dirfnd
  1380 00000F4C 3C07                <1> 		cmp al, 7
  1381 00000F4E 743C                <1> 		je dirfnd3
  1382 00000F50 3C06                <1> 		cmp al, 6
  1383 00000F52 7438                <1> 		je dirfnd3
  1384 00000F54 46                  <1> 		inc esi
  1385 00000F55 81FE[6F150000]      <1> 		cmp esi,  fileindexend
  1386 00000F5B 737B                <1> 		jae dirdn
  1387 00000F5D EBE5                <1> 		jmp dirnxt
  1388 00000F5F 060400626174636800- <1> 	typetable db 6,4,0,"batch",0,7,4,0,"document",0,10,4,0,"folder",0,5,4,0,"executable",0
  1389 00000F68 070400646F63756D65- <1>
  1390 00000F71 6E74000A0400666F6C- <1>
  1391 00000F7A 646572000504006578- <1>
  1392 00000F83 6563757461626C6500  <1>
  1393                              <1> 	dirfnd3:
  1394 00000F8C 46                  <1> 		inc esi
  1395 00000F8D 81FE[6F150000]      <1> 		cmp esi, fileindexend
  1396 00000F93 76AF                <1> 		jbe dirnxt
  1397 00000F95 4E                  <1> 		dec esi
  1398 00000F96 46                  <1> 	dirfnd:	inc esi
  1399 00000F97 8A06                <1> 		mov al, [esi]
  1400 00000F99 B400                <1> 		mov ah, 0
  1401 00000F9B 3C04                <1> 		cmp al, 4
  1402 00000F9D 740B                <1> 		je dirfnd2
  1403 00000F9F 46                  <1> 		inc esi
  1404 00000FA0 81FE[6F150000]      <1> 		cmp esi,  fileindexend
  1405 00000FA6 7330                <1> 		jae dirdn
  1406 00000FA8 EB9A                <1> 		jmp dirnxt
  1407 00000FAA 81C601000000        <1> 	dirfnd2: add esi, 1
  1408 00000FB0 E86CFBFFFF          <1> 		call print
  1409 00000FB5 8935[DD0F0000]      <1> 		mov [esidir], esi
  1410 00000FBB BE[06400000]        <1> 		mov esi, line
  1411 00000FC0 E85CFBFFFF          <1> 		call print
  1412 00000FC5 8B35[DD0F0000]      <1> 		mov esi, [esidir]
  1413 00000FCB 81FE[6F150000]      <1> 		cmp esi,  fileindexend
  1414 00000FD1 7305                <1> 		jae dirdn
  1415 00000FD3 E96CFFFFFF          <1> 		jmp dirnxt
  1416 00000FD8 E91CFEFFFF          <1> 	dirdn:	jmp nwcmd
  1417 00000FDD 00000000            <1> esidir dd 0
  1418                              <1> 
  1419                              <1> array:				;arraystart in si, arrayend in bx, arrayseperator in cx
  1420                              <1> 		                ;ends if array seperator is found backwards after 0
  1421                              <1> 	arnxt:	      
  1422 00000FE1 88E8                <1> 		mov al, ch
  1423 00000FE3 88CC                <1> 		mov ah, cl        
  1424 00000FE5 663906              <1> 		cmp [esi], ax
  1425 00000FE8 744D                <1> 		je ardn
  1426 00000FEA 66390E              <1> 		cmp [esi], cx
  1427 00000FED 7407                <1> 		je arfnd
  1428 00000FEF 46                  <1> 		inc esi
  1429 00000FF0 39DE                <1> 		cmp esi, ebx
  1430 00000FF2 7343                <1> 		jae ardn
  1431 00000FF4 EBEB                <1> 		jmp arnxt
  1432 00000FF6 81C602000000        <1> 	arfnd: add esi, 2
  1433 00000FFC 891D[38100000]      <1> 		mov [arbx], ebx
  1434 00001002 890D[3C100000]      <1> 		mov [arcx], ecx
  1435 00001008 E814FBFFFF          <1> 		call print
  1436 0000100D 8935[3E100000]      <1> 		mov [arsi], esi
  1437 00001013 BE[06400000]        <1> 		mov esi, line
  1438 00001018 E804FBFFFF          <1> 		call print
  1439 0000101D 8B1D[38100000]      <1> 		mov ebx, [arbx]
  1440 00001023 668B0D[3C100000]    <1> 		mov cx, [arcx]
  1441 0000102A 8B35[3E100000]      <1> 		mov esi, [arsi]
  1442 00001030 46                  <1> 		inc esi
  1443 00001031 39DE                <1> 		cmp esi, ebx
  1444 00001033 7302                <1> 		jae ardn
  1445 00001035 EBAA                <1> 		jmp arnxt
  1446 00001037 C3                  <1> 	ardn:	ret
  1447 00001038 00000000            <1> arbx:	dw 0,0
  1448 0000103C 0000                <1> arcx:	db 0,0
  1449 0000103E 00000000            <1> arsi:	dw 0,0
  1450                              <1> 
  1451                              <1> clearbuffer:
  1452 00001042 BE[701C0000]        <1> 	mov esi, buf2
  1453 00001047 B030                <1> 	mov al, '0'
  1454 00001049 81FE[841C0000]      <1> clearbuf: cmp esi, numbuf
  1455 0000104F 7305                <1> 	jae doneclearbuff
  1456 00001051 8806                <1> 	mov [esi], al
  1457 00001053 46                  <1> 	inc esi
  1458 00001054 EBF3                <1> 	jmp clearbuf
  1459                              <1> doneclearbuff: 
  1460 00001056 C3                  <1> 		ret
  1461                              <1> 
  1462                              <1> convert:
  1463 00001057 4E                  <1> 	dec esi
  1464 00001058 89F3                <1> 	mov ebx, esi		;place to convert into must be in si, number to convert must be in cx
  1465                              <1> cnvrt:
  1466 0000105A 89DE                <1> 	mov esi, ebx
  1467 0000105C 81EE09000000        <1> 	sub esi, 9
  1468 00001062 81F900CA9A3B        <1> 	cmp ecx, 1000000000
  1469 00001068 720A                <1> 	jb ten8
  1470 0000106A 81E900CA9A3B        <1> 	sub ecx, 1000000000
  1471 00001070 FE06                <1> 	inc byte [esi]
  1472 00001072 EBE6                <1> 	jmp cnvrt
  1473 00001074 46                  <1> ten8:	inc esi
  1474 00001075 81F900E1F505        <1> 	cmp ecx, 100000000
  1475 0000107B 720A                <1> 	jb ten7
  1476 0000107D 81E900E1F505        <1> 	sub ecx, 100000000
  1477 00001083 FE06                <1> 	inc byte [esi]
  1478 00001085 EBD3                <1> 	jmp cnvrt
  1479 00001087 46                  <1> ten7:	inc esi
  1480 00001088 81F980969800        <1> 	cmp ecx, 10000000
  1481 0000108E 720A                <1> 	jb ten6
  1482 00001090 81E980969800        <1> 	sub ecx, 10000000
  1483 00001096 FE06                <1> 	inc byte [esi]
  1484 00001098 EBC0                <1> 	jmp cnvrt
  1485 0000109A 46                  <1> ten6:	inc esi
  1486 0000109B 81F940420F00        <1> 	cmp ecx, 1000000
  1487 000010A1 720A                <1> 	jb ten5
  1488 000010A3 81E940420F00        <1> 	sub ecx, 1000000
  1489 000010A9 FE06                <1> 	inc byte [esi]
  1490 000010AB EBAD                <1> 	jmp cnvrt
  1491 000010AD 46                  <1> ten5:	inc esi
  1492 000010AE 81F9A0860100        <1> 	cmp ecx, 100000
  1493 000010B4 720A                <1> 	jb ten4
  1494 000010B6 81E9A0860100        <1> 	sub ecx, 100000
  1495 000010BC FE06                <1> 	inc byte [esi]
  1496 000010BE EB9A                <1> 	jmp cnvrt
  1497 000010C0 46                  <1> ten4:	inc esi
  1498 000010C1 81F910270000        <1> 	cmp ecx, 10000
  1499 000010C7 720A                <1> 	jb ten3
  1500 000010C9 81E910270000        <1> 	sub ecx, 10000
  1501 000010CF FE06                <1> 	inc byte [esi]
  1502 000010D1 EB87                <1> 	jmp cnvrt
  1503 000010D3 46                  <1> ten3:	inc esi
  1504 000010D4 81F9E8030000        <1> 	cmp ecx, 1000
  1505 000010DA 720D                <1> 	jb ten2
  1506 000010DC 81E9E8030000        <1> 	sub ecx, 1000
  1507 000010E2 FE06                <1> 	inc byte [esi]
  1508 000010E4 E971FFFFFF          <1> 	jmp cnvrt
  1509 000010E9 46                  <1> ten2:	inc esi
  1510 000010EA 81F964000000        <1> 	cmp ecx, 100
  1511 000010F0 720D                <1> 	jb ten1
  1512 000010F2 81E964000000        <1> 	sub ecx, 100
  1513 000010F8 FE06                <1> 	inc byte [esi]
  1514 000010FA E95BFFFFFF          <1> 	jmp cnvrt
  1515 000010FF 46                  <1> ten1:	inc esi
  1516 00001100 81F90A000000        <1> 	cmp ecx, 10
  1517 00001106 720D                <1> 	jb ten0
  1518 00001108 81E90A000000        <1> 	sub ecx, 10
  1519 0000110E FE06                <1> 	inc byte [esi]
  1520 00001110 E945FFFFFF          <1> 	jmp cnvrt
  1521 00001115 46                  <1> ten0:	inc esi
  1522 00001116 81F901000000        <1> 	cmp ecx, 1
  1523 0000111C 720D                <1> 	jb tendn
  1524 0000111E 81E901000000        <1> 	sub ecx, 1
  1525 00001124 FE06                <1> 	inc byte [esi]
  1526 00001126 E92FFFFFFF          <1> 	jmp cnvrt
  1527                              <1> tendn:
  1528 0000112B C3                  <1> 	ret
  1529                              <1> 
  1530                              <1> 	
  1531                              <1> 
  1532 0000112C 00<rept>            <1> hexnumber times 8 db 0
  1533 00001134 202000              <1> hexnumberend db "  ",0
  1534                              <1> 
  1535                              <1> 
  1536 00001137 00000000            <1> sibuf dw 0,0
  1537 0000113B 00000000            <1> dibuf dw 0,0
  1538                              <1> 
  1539                              <1> converthex:
  1540                              <1> clearbufferhex:
  1541 0000113F B030                <1> 	mov al, '0'
  1542 00001141 8935[37110000]      <1> 	mov [sibuf], esi
  1543 00001147 893D[3B110000]      <1> 	mov [dibuf], edi
  1544 0000114D 39FE                <1> clearbufhex: cmp esi, edi
  1545 0000114F 7305                <1> 	jae doneclearbuffhex
  1546 00001151 8806                <1> 	mov [esi], al
  1547 00001153 46                  <1> 	inc esi
  1548 00001154 EBF7                <1> 	jmp clearbufhex
  1549                              <1> doneclearbuffhex:
  1550 00001156 8B35[3B110000]      <1> 	mov esi, [dibuf]
  1551 0000115C 89CA                <1> 	mov edx, ecx
  1552 0000115E 81FA00000000        <1> 	cmp edx, 0
  1553 00001164 741F                <1> 	je donenxtephx
  1554                              <1> nxtexphx:	;0x10^x
  1555 00001166 4E                  <1> 	dec esi
  1556 00001167 89F7                <1> 	mov edi, esi		;;location of 0x10^x
  1557 00001169 89D1                <1> 	mov ecx, edx
  1558 0000116B 81E10F000000        <1> 	and ecx, 0xF		;;just this digit
  1559 00001171 E81C000000          <1> 	call cnvrtexphx		;;get this digit
  1560 00001176 89FE                <1> 	mov esi, edi
  1561 00001178 C1EA04              <1> 	shr edx, 4		;;next digit
  1562 0000117B 81FA00000000        <1> 	cmp edx, 0
  1563 00001181 7402                <1> 	je donenxtephx
  1564 00001183 EBE1                <1> 	jmp nxtexphx
  1565                              <1> donenxtephx:
  1566 00001185 8B35[37110000]      <1> 	mov esi, [sibuf]
  1567 0000118B 8B3D[3B110000]      <1> 	mov edi, [dibuf]
  1568 00001191 C3                  <1> 	ret
  1569                              <1> cnvrtexphx:			;;convert this number
  1570 00001192 89F3                <1> 	mov ebx, esi		;place to convert to must be in si, number to convert must be in cx
  1571 00001194 81F900000000        <1> 	cmp ecx, 0
  1572 0000119A 7429                <1> 	je zerohx
  1573 0000119C 8A06                <1> cnvrthx:  mov al, [esi]
  1574 0000119E 3C39                <1> 	cmp al, '9'
  1575 000011A0 741B                <1> 	je lettershx
  1576 000011A2 3C46                <1> lttrhxdn: cmp al, 'F'
  1577 000011A4 741F                <1> 	je zerohx
  1578 000011A6 8A06                <1> 	mov al, [esi]
  1579 000011A8 FEC0                <1> 	inc al
  1580 000011AA 8806                <1> 	mov [esi], al
  1581 000011AC 89DE                <1> 	mov esi, ebx
  1582 000011AE 81E901000000        <1> cnvrtlphx: sub ecx, 1
  1583 000011B4 81F900000000        <1> 	cmp ecx, 0
  1584 000011BA 75E0                <1> 	jne cnvrthx
  1585 000011BC C3                  <1> 	ret
  1586                              <1> lettershx:
  1587 000011BD B041                <1> 	mov al, 'A'
  1588 000011BF 2C01                <1> 	sub al, 1
  1589 000011C1 8806                <1> 	mov [esi], al
  1590 000011C3 EBDD                <1> 	jmp lttrhxdn
  1591 000011C5 B030                <1> zerohx:	mov al, '0'
  1592 000011C7 8806                <1> 	mov [esi], al
  1593 000011C9 4E                  <1> 	dec esi
  1594 000011CA 8A06                <1> 	mov al, [esi]
  1595 000011CC 3C46                <1> 	cmp al, 'F'
  1596 000011CE 74F5                <1> 	je zerohx
  1597 000011D0 41                  <1> 	inc ecx
  1598 000011D1 EBDB                <1> 	jmp cnvrtlphx
  1599                              <1> 
  1600 000011D3 01                  <1> firsthexshown db 1
  1601                              <1> showhex:
  1602 000011D4 60                  <1> 	pusha
  1603 000011D5 BE[2C110000]        <1> 	mov esi, hexnumber
  1604 000011DA BF[34110000]        <1> 	mov edi, hexnumberend
  1605 000011DF E85BFFFFFF          <1> 	call converthex
  1606 000011E4 803D[D3110000]01    <1> 	cmp byte [firsthexshown], 1
  1607 000011EB 7504                <1> 	jne showthathex
  1608 000011ED 66BA0000            <1> 	mov dx, 0
  1609                              <1> showthathex:
  1610 000011F1 803D[D3110000]03    <1> 	cmp byte [firsthexshown], 3
  1611 000011F8 750A                <1> 	jne nonewhexline
  1612 000011FA BE[06400000]        <1> 	mov esi, line
  1613 000011FF E81DF9FFFF          <1> 	call print
  1614                              <1> nonewhexline:
  1615 00001204 803D[D3110000]04    <1> 	cmp byte [firsthexshown], 4
  1616 0000120B 7527                <1> 	jne notabfixhex
  1617 0000120D B1A0                <1> 	mov cl, 160
  1618 0000120F 28D1                <1> 	sub cl, dl
  1619 00001211 C0E905              <1> 	shr cl, 5
  1620 00001214 C0E105              <1> 	shl cl, 5
  1621 00001217 80F900              <1> 	cmp cl, 0
  1622 0000121A 750F                <1> 	jne nonewlinetabfixhex
  1623 0000121C BE[06400000]        <1> 	mov esi, line
  1624 00001221 E8FBF8FFFF          <1> 	call print
  1625 00001226 E909000000          <1> 	jmp notabfixhex
  1626                              <1> nonewlinetabfixhex:
  1627 0000122B 80C20F              <1> 	add dl, 15
  1628 0000122E C0EA04              <1> 	shr dl, 4
  1629 00001231 C0E204              <1> 	shl dl, 4
  1630                              <1> notabfixhex:
  1631 00001234 BE[2C110000]        <1> 	mov esi, hexnumber
  1632 00001239 E8E3F8FFFF          <1> 	call print
  1633 0000123E 803D[D3110000]02    <1> 	cmp byte [firsthexshown], 2
  1634 00001245 750A                <1> 	jne hexshown
  1635 00001247 BE[06400000]        <1> 	mov esi, line
  1636 0000124C E8D0F8FFFF          <1> 	call print
  1637                              <1> hexshown:
  1638 00001251 C605[D3110000]00    <1> 	mov byte [firsthexshown], 0
  1639 00001258 61                  <1> 	popa
  1640 00001259 C3                  <1> 	ret
  1641                              <1> 
  1642                              <1> 
  1643 0000125A 303030303030303030- <1> decnumber db "00000000000000"
  1644 00001263 3030303030          <1>
  1645 00001268 2000                <1> decnumberend: db " ",0
  1646                              <1> 
  1647                              <1> showdec: ;;same as showhex, just uses decimal conversion
  1648 0000126A 60                  <1> 	pusha
  1649 0000126B BF[5A120000]        <1> 	mov edi, decnumber
  1650 00001270 BE[68120000]        <1> 	mov esi, decnumberend
  1651                              <1> cleardecbuf:
  1652 00001275 C60730              <1> 	mov byte [edi], '0'
  1653 00001278 47                  <1> 	inc edi
  1654 00001279 39F7                <1> 	cmp edi, esi
  1655 0000127B 72F8                <1> 	jb cleardecbuf
  1656 0000127D BF[5A120000]        <1> 	mov edi, decnumber
  1657 00001282 E8D0FDFFFF          <1> 	call convert
  1658 00001287 803D[D3110000]01    <1> 	cmp byte [firsthexshown], 1
  1659 0000128E 7504                <1> 	jne showthatdec
  1660 00001290 66BA0000            <1> 	mov dx, 0
  1661                              <1> showthatdec:
  1662 00001294 803D[D3110000]03    <1> 	cmp byte [firsthexshown], 3
  1663 0000129B 750A                <1> 	jne nonewdecline
  1664 0000129D BE[06400000]        <1> 	mov esi, line
  1665 000012A2 E87AF8FFFF          <1> 	call print
  1666                              <1> nonewdecline:
  1667 000012A7 803D[D3110000]04    <1> 	cmp byte [firsthexshown], 4
  1668 000012AE 7527                <1> 	jne notabfixdec
  1669 000012B0 B1A0                <1> 	mov cl, 160
  1670 000012B2 28D1                <1> 	sub cl, dl
  1671 000012B4 C0E905              <1> 	shr cl, 5
  1672 000012B7 C0E105              <1> 	shl cl, 5
  1673 000012BA 80F900              <1> 	cmp cl, 0
  1674 000012BD 750F                <1> 	jne nonewlinetabfixdec
  1675 000012BF BE[06400000]        <1> 	mov esi, line
  1676 000012C4 E858F8FFFF          <1> 	call print
  1677 000012C9 E909000000          <1> 	jmp notabfixdec
  1678                              <1> nonewlinetabfixdec:
  1679 000012CE 80C20F              <1> 	add dl, 15
  1680 000012D1 C0EA04              <1> 	shr dl, 4
  1681 000012D4 C0E204              <1> 	shl dl, 4
  1682                              <1> notabfixdec:
  1683 000012D7 BE[5A120000]        <1> 	mov esi, decnumber
  1684 000012DC 4E                  <1> 	dec esi
  1685                              <1> sifind:
  1686 000012DD 46                  <1> 	inc esi
  1687 000012DE 803E30              <1> 	cmp byte [esi], '0'
  1688 000012E1 74FA                <1> 	je sifind
  1689 000012E3 E839F8FFFF          <1> 	call print
  1690 000012E8 803D[D3110000]02    <1> 	cmp byte [firsthexshown], 2
  1691 000012EF 750A                <1> 	jne decshown
  1692 000012F1 BE[06400000]        <1> 	mov esi, line
  1693 000012F6 E826F8FFFF          <1> 	call print
  1694                              <1> decshown:
  1695 000012FB C605[D3110000]00    <1> 	mov byte [firsthexshown], 0
  1696 00001302 61                  <1> 	popa
  1697 00001303 C3                  <1> 	ret
  1698                              <1> 	
  1699                              <1> cnvrttxt: 
  1700 00001304 B900000000          <1> 	mov ecx, 0
  1701 00001309 B800000000          <1> 	mov eax, 0
  1702 0000130E BA00000000          <1> 	mov edx, 0
  1703 00001313 BB00000000          <1> 	mov ebx, 0
  1704 00001318 4E                  <1> 	dec esi
  1705                              <1> cnvrtlptxt:
  1706 00001319 46                  <1> 	inc esi
  1707 0000131A 8A06                <1> 	mov al, [esi]
  1708 0000131C 3C00                <1> 	cmp al, 0
  1709 0000131E 75F9                <1> 	jne cnvrtlptxt
  1710 00001320 4E                  <1> 	dec esi
  1711 00001321 8A06                <1> 	mov al, [esi]
  1712 00001323 3C30                <1> 	cmp al, '0'
  1713 00001325 7504                <1> 	jne txtlp
  1714 00001327 39FE                <1> zerotest: cmp esi, edi
  1715 00001329 745B                <1> 	je donecnvrt
  1716                              <1> txtlp:	
  1717 0000132B B800000000          <1> 	mov eax, 0
  1718 00001330 8A06                <1> 	mov al, [esi]
  1719 00001332 3C3D                <1> 	cmp al, '='
  1720 00001334 7450                <1> 	je donecnvrt
  1721 00001336 3C30                <1> 	cmp al, 48
  1722 00001338 724C                <1> 	jb donecnvrt
  1723 0000133A 3C23                <1> 	cmp al, '#'
  1724 0000133C 7448                <1> 	je donecnvrt
  1725 0000133E 39FE                <1> 	cmp esi, edi
  1726 00001340 7244                <1> 	jb donecnvrt
  1727 00001342 81F900000000        <1> 	cmp ecx, 0
  1728 00001348 7708                <1> 	ja exp
  1729 0000134A 2C30                <1> noexp:	sub al, 48
  1730 0000134C 01C2                <1> 	add edx, eax
  1731 0000134E 4E                  <1> 	dec esi
  1732 0000134F 41                  <1> 	inc ecx
  1733 00001350 EBD9                <1> 	jmp txtlp
  1734 00001352 81F900000000        <1> exp:	cmp ecx, 0
  1735 00001358 74F0                <1> 	je noexp
  1736 0000135A 2C30                <1> 	sub al, 48
  1737 0000135C 51                  <1> 	push ecx
  1738 0000135D 89C3                <1> expmul:	mov ebx, eax
  1739 0000135F 01D8                <1> 	add eax, ebx
  1740 00001361 01D8                <1> 	add eax, ebx
  1741 00001363 01D8                <1> 	add eax, ebx
  1742 00001365 01D8                <1> 	add eax, ebx
  1743 00001367 01D8                <1> 	add eax, ebx
  1744 00001369 01D8                <1> 	add eax, ebx
  1745 0000136B 01D8                <1> 	add eax, ebx
  1746 0000136D 01D8                <1> 	add eax, ebx
  1747 0000136F 01D8                <1> 	add eax, ebx
  1748 00001371 81E901000000        <1> 	sub ecx, 1
  1749 00001377 81F900000000        <1> 	cmp ecx, 0
  1750 0000137D 77DE                <1> 	ja expmul
  1751 0000137F 01C2                <1> 	add edx, eax
  1752 00001381 59                  <1> 	pop ecx
  1753 00001382 4E                  <1> 	dec esi
  1754 00001383 41                  <1> 	inc ecx
  1755 00001384 EBA5                <1> 	jmp txtlp
  1756 00001386 89D1                <1> donecnvrt: mov ecx, edx
  1757 00001388 C3                  <1> 	ret
  1758                                      %include 'source/builtinprogs.asm'
  1759 00001389 050406040704        <1> filetypes db 5,4,6,4,7,4
  1760                              <1> progstart:		;programs start here
  1761                              <1> ;db 5,4,"index",0
  1762                              <1> ;	call indexfiles
  1763                              <1> ;	jmp nwcmd
  1764                              <1> indexfiles:
  1765 0000138F BE[8F130000]        <1> 	mov esi, progstart
  1766 00001394 BB[6F130000]        <1> 	mov ebx, fileindex
  1767 00001399 BF[8F130000]        <1> 	mov edi, progstart
  1768 0000139E 81EF02000000        <1> 	sub edi, 2
  1769                              <1> indexloop:
  1770 000013A4 668B0E              <1> 	mov cx, [esi]
  1771                              <1> 	indexloop2:
  1772 000013A7 663B0F              <1> 		cmp cx, [edi]
  1773 000013AA 7424                <1> 		je indexloop2done
  1774 000013AC 81EF02000000        <1> 		sub edi, 2
  1775 000013B2 81FF[89130000]      <1> 		cmp edi, filetypes
  1776 000013B8 73ED                <1> 		jae indexloop2
  1777 000013BA BF[8F130000]        <1> 	mov edi, progstart
  1778 000013BF 81EF02000000        <1> 	sub edi, 2
  1779 000013C5 46                  <1> 	inc esi
  1780 000013C6 81FE[FE210000]      <1> 	cmp esi, batchprogend
  1781 000013CC 734E                <1> 	jae indexloopdone
  1782 000013CE EBD4                <1> 	jmp indexloop
  1783                              <1> indexloop2done:
  1784 000013D0 66890B              <1> 	mov [ebx], cx
  1785 000013D3 81C302000000        <1> 	add ebx, 2
  1786 000013D9 81C602000000        <1> 	add esi, 2
  1787                              <1> 	nameindex:
  1788 000013DF 8A0E                <1> 		mov cl, [esi]
  1789 000013E1 80F900              <1> 		cmp cl, 0
  1790 000013E4 7406                <1> 		je nameindexdone
  1791 000013E6 880B                <1> 		mov [ebx], cl
  1792 000013E8 46                  <1> 		inc esi
  1793 000013E9 43                  <1> 		inc ebx
  1794 000013EA EBF3                <1> 		jmp nameindex
  1795                              <1> 	nameindexdone:
  1796 000013EC 43                  <1> 		inc ebx
  1797 000013ED 66C7030000          <1> 		mov word [ebx], 0
  1798 000013F2 81C302000000        <1> 		add ebx, 2
  1799 000013F8 46                  <1> 		inc esi
  1800 000013F9 8933                <1> 		mov [ebx], esi
  1801 000013FB 81C304000000        <1> 		add ebx, 4
  1802 00001401 66C7030000          <1> 		mov word [ebx], 0
  1803 00001406 81C302000000        <1> 		add ebx, 2
  1804 0000140C 81FB[6F150000]      <1> 		cmp ebx, fileindexend
  1805 00001412 7308                <1> 		jae indexloopdone
  1806 00001414 81C601000000        <1> 		add esi, 1
  1807 0000141A EB88                <1> 		jmp indexloop
  1808 0000141C C3                  <1> indexloopdone: 	ret
  1809                              <1> 
  1810                              <1> 
  1811                              <1> ;db 5,4,"showindex",0
  1812                              <1> ;	mov esi, fileindex
  1813                              <1> ;	mov ebx, fileindexend
  1814                              <1> ;	mov cl, 5
  1815                              <1> ;	mov ch, 4
  1816                              <1> ;	call array
  1817                              <1> ;	mov esi, fileindex
  1818                              <1> ;	mov ebx, fileindexend
  1819                              <1> ;	mov cl, 6
  1820                              <1> ;	mov ch, 4
  1821                              <1> ;	call array
  1822                              <1> ;	mov esi, fileindex
  1823                              <1> ;	mov ebx, fileindexend
  1824                              <1> ;	mov cl, 7
  1825                              <1> ;	mov ch, 4
  1826                              <1> ;	call array
  1827                              <1> ;	jmp nwcmd
  1828                              <1> 
  1829 0000141D 05046C7300          <1> db 5,4,"ls",0
  1830 00001422 BE[8F130000]        <1> 	lscmd:	mov esi, progstart
  1831 00001427 BB[FE210000]        <1> 		mov ebx, progend
  1832 0000142C E90EFBFFFF          <1> 		jmp dir
  1833                              <1> 		
  1834 00001431 05046469736B00      <1> db 5,4,"disk",0
  1835 00001438 B900000000          <1> 		mov ecx, 0
  1836 0000143D 8A0D[2B000000]      <1> 		mov cl, [DriveNumber]
  1837 00001443 C605[D3110000]00    <1> 		mov byte [firsthexshown], 0
  1838 0000144A E885FDFFFF          <1> 		call showhex
  1839 0000144F BE[06400000]        <1> 		mov esi, line
  1840 00001454 E8C8F6FFFF          <1> 		call print
  1841 00001459 BE[633F0000]        <1> 		mov esi, diskfileindex
  1842                              <1> 	diskindexdir:
  1843 0000145E E8BEF6FFFF          <1> 		call print
  1844 00001463 8B4E05              <1> 		mov ecx, [esi + 5]
  1845 00001466 C605[D3110000]03    <1> 		mov byte [firsthexshown], 3
  1846 0000146D E8F8FDFFFF          <1> 		call showdec
  1847 00001472 56                  <1> 		push esi
  1848 00001473 BE[06400000]        <1> 		mov esi, line
  1849 00001478 E8A4F6FFFF          <1> 		call print
  1850 0000147D 5E                  <1> 		pop esi
  1851 0000147E 81C609000000        <1> 		add esi, 9
  1852 00001484 81FE[C83F0000]      <1> 		cmp esi, enddiskfileindex
  1853 0000148A 72D2                <1> 		jb diskindexdir
  1854 0000148C E968F9FFFF          <1> 		jmp nwcmd
  1855                              <1> 
  1856 00001491 0504636C65617200    <1> db 5,4,"clear",0
  1857 00001499 E832F7FFFF          <1> 	cls:	call clear
  1858 0000149E E956F9FFFF          <1> 		jmp nwcmd
  1859                              <1> 		
  1860 000014A3 05047761697400      <1> db 5,4,"wait",0
  1861 000014AA B000                <1> 		mov al, 0
  1862 000014AC E840F6FFFF          <1> 		call int302
  1863 000014B1 E943F9FFFF          <1> 		jmp nwcmd
  1864                              <1> 
  1865 000014B6 05046563686F00      <1> db 5,4,"echo",0
  1866 000014BD BE[701A0000]        <1> 	echo:	mov esi, buftxt
  1867 000014C2 81C605000000        <1> 		add esi, 5
  1868 000014C8 8A06                <1> 		mov al, [esi]
  1869 000014CA 3C24                <1> 		cmp al, '$'
  1870 000014CC 7414                <1> 		je echovr
  1871 000014CE E84EF6FFFF          <1> 		call print
  1872 000014D3 BE[06400000]        <1> 		mov esi, line
  1873 000014D8 E844F6FFFF          <1> 		call print
  1874 000014DD E917F9FFFF          <1> 		jmp nwcmd
  1875 000014E2 BB[6F150000]        <1> 	echovr:	mov ebx, variables
  1876 000014E7 BF06000000          <1> 		mov edi, 6
  1877 000014EC E83A000000          <1> 		call nxtvrech
  1878 000014F1 E957000000          <1> 		jmp prntvr2
  1879 000014F6 B13D                <1> 	echvar:	mov cl, '='
  1880 000014F8 43                  <1> 		inc ebx
  1881 000014F9 8A03                <1> 		mov al, [ebx]
  1882 000014FB 3C00                <1> 		cmp al, 0
  1883 000014FD 742C                <1> 		je nxtvrech
  1884 000014FF 3C3D                <1> 		cmp al, '='
  1885 00001501 7420                <1> 		je nxtvrechb1
  1886 00001503 BE[701A0000]        <1> 		mov esi, buftxt
  1887 00001508 01FE                <1> 		add esi, edi
  1888 0000150A E810FAFFFF          <1> 		call cndtest
  1889 0000150F 3C02                <1> 		cmp al, 2
  1890 00001511 7436                <1> 		je prntvr
  1891 00001513 3C01                <1> 		cmp al, 1
  1892 00001515 7432                <1> 		je prntvr
  1893 00001517 BE[701A0000]        <1> 		mov esi, buftxt
  1894 0000151C 01FE                <1> 		add esi, edi
  1895 0000151E E908000000          <1> 		jmp nxtvrech
  1896                              <1> 	nxtvrechb1:
  1897 00001523 81EB02000000        <1> 		sub ebx, 2
  1898 00001529 EBCB                <1> 		jmp echvar
  1899 0000152B 8A03                <1> 	nxtvrech: mov al, [ebx]
  1900 0000152D 3C05                <1> 		cmp al, 5
  1901 0000152F 740F                <1> 		je nxtvrec2
  1902 00001531 43                  <1> 		inc ebx
  1903 00001532 81FB[6F1A0000]      <1> 		cmp ebx, varend
  1904 00001538 0F83BBF8FFFF        <1> 		jae nwcmd
  1905 0000153E EBEB                <1> 		jmp nxtvrech
  1906 00001540 43                  <1> 	nxtvrec2: inc ebx
  1907 00001541 8A03                <1> 		mov al, [ebx]
  1908 00001543 3C04                <1> 		cmp al, 4
  1909 00001545 74AF                <1> 		je echvar
  1910 00001547 EBE2                <1> 		jmp nxtvrech
  1911 00001549 43                  <1> 	prntvr: inc ebx
  1912 0000154A 89DE                <1> 		mov esi, ebx
  1913 0000154C C3                  <1> 		ret
  1914 0000154D E8CFF5FFFF          <1> 	prntvr2: call print
  1915 00001552 BE[06400000]        <1> 		mov esi, line
  1916 00001557 E8C5F5FFFF          <1> 		call print
  1917 0000155C E998F8FFFF          <1> 		jmp nwcmd
  1918                              <1> 		
  1919                              <1> 
  1920 00001561 05042300            <1> db 5,4,"#",0
  1921                              <1> 	num:	
  1922 00001565 E8D8FAFFFF          <1> 		call clearbuffer
  1923 0000156A C605[21180000]00    <1> 		mov byte [decimal], 0
  1924 00001571 C605[22180000]00    <1> 		mov byte [decimal2], 0
  1925 00001578 BE[701A0000]        <1> 		mov esi, buftxt
  1926 0000157D B800000000          <1> 		mov eax, 0
  1927 00001582 B900000000          <1> 		mov ecx, 0
  1928 00001587 BB00000000          <1> 		mov ebx, 0
  1929 0000158C 8A06                <1> 	num2:	mov al, [esi]
  1930 0000158E 3C2B                <1> 		cmp al, '+'
  1931 00001590 741B                <1> 		je operatorfound
  1932 00001592 3C2D                <1> 		cmp al, '-'
  1933 00001594 7417                <1> 		je operatorfound
  1934 00001596 3C2A                <1> 		cmp al, '*'
  1935 00001598 7413                <1> 		je operatorfound
  1936 0000159A 3C2F                <1> 		cmp al, '/'
  1937 0000159C 740F                <1> 		je operatorfound
  1938 0000159E 3C5E                <1> 		cmp al, '^'
  1939 000015A0 740B                <1> 		je operatorfound
  1940 000015A2 46                  <1> 		inc esi
  1941 000015A3 3C00                <1> 		cmp al, 0
  1942 000015A5 0F844EF8FFFF        <1> 		je near nwcmd
  1943 000015AB EBDF                <1> 		jmp num2
  1944 000015AD 50                  <1> 	operatorfound: push eax
  1945 000015AE B400                <1> 		mov ah, 0
  1946 000015B0 8826                <1> 		mov [esi], ah
  1947 000015B2 89F7                <1> 		mov edi, esi
  1948 000015B4 46                  <1> 		inc esi
  1949 000015B5 8A06                <1> 		mov al, [esi]
  1950 000015B7 3C24                <1> 		cmp al, '$'
  1951 000015B9 0F8481000000        <1> 		je near varnum1
  1952 000015BF 3C25                <1> 		cmp al, '%'
  1953 000015C1 0F8469000000        <1> 		je near resultnum1
  1954                              <1> 	varnum2: 
  1955 000015C7 57                  <1> 		push edi
  1956 000015C8 E8C9000000          <1> 		call checkdecimal
  1957 000015CD 5F                  <1> 		pop edi
  1958 000015CE E831FDFFFF          <1> 		call cnvrttxt
  1959                              <1> 	vrnm2:
  1960 000015D3 89CB                <1> 		mov ebx, ecx
  1961 000015D5 53                  <1> 		push ebx
  1962 000015D6 E867FAFFFF          <1> 		call clearbuffer
  1963 000015DB BE[701A0000]        <1> 		mov esi, buftxt
  1964 000015E0 89F7                <1> 		mov edi, esi
  1965 000015E2 46                  <1> 		inc esi
  1966 000015E3 8A06                <1> 		mov al, [esi]
  1967 000015E5 3C24                <1> 		cmp al, '$'
  1968 000015E7 0F8474000000        <1> 		je near varnum3
  1969 000015ED 3C25                <1> 		cmp al, '%'
  1970 000015EF 0F8443000000        <1> 		je near resultnum2
  1971                              <1> 	varnum4: 
  1972 000015F5 57                  <1> 		push edi
  1973 000015F6 E887000000          <1> 		call checkdecimal2
  1974 000015FB 5F                  <1> 		pop edi
  1975 000015FC E803FDFFFF          <1> 		call cnvrttxt
  1976                              <1> 	vrnm4:
  1977 00001601 5B                  <1> 		pop ebx
  1978 00001602 58                  <1> 		pop eax
  1979 00001603 3C2B                <1> 		cmp al, '+'
  1980 00001605 0F84B9000000        <1> 		je near plusnum
  1981 0000160B 3C2D                <1> 		cmp al, '-'
  1982 0000160D 0F84BD000000        <1> 		je near subnum
  1983 00001613 3C2A                <1> 		cmp al, '*'
  1984 00001615 0F84C1000000        <1> 		je near mulnum
  1985 0000161B 3C2F                <1> 		cmp al, '/'
  1986 0000161D 0F84CF000000        <1> 		je near divnum
  1987 00001623 3C5E                <1> 		cmp al, '^'
  1988 00001625 0F84ED000000        <1> 		je near expnum
  1989 0000162B E9C9F7FFFF          <1> 		jmp nwcmd
  1990                              <1> 	resultnum1:
  1991 00001630 8B0D[23180000]      <1> 		mov ecx, [result]
  1992 00001636 EB9B                <1> 		jmp vrnm2
  1993                              <1> 	resultnum2:
  1994 00001638 8B0D[23180000]      <1> 		mov ecx, [result]
  1995 0000163E EBC1                <1> 		jmp vrnm4
  1996 00001640 81EE[701A0000]      <1> 	varnum1: sub esi, buftxt
  1997 00001646 89F7                <1> 		mov edi, esi
  1998 00001648 81C6[701A0000]      <1> 		add esi, buftxt
  1999 0000164E 47                  <1> 		inc edi
  2000 0000164F BB[6F150000]        <1> 		mov ebx, variables
  2001 00001654 E8D2FEFFFF          <1> 		call nxtvrech
  2002 00001659 89F7                <1> 		mov edi, esi
  2003 0000165B 4F                  <1> 		dec edi
  2004 0000165C E966FFFFFF          <1> 		jmp varnum2
  2005 00001661 81EE[701A0000]      <1> 	varnum3: sub esi, buftxt
  2006 00001667 89F7                <1> 		mov edi, esi
  2007 00001669 81C6[701A0000]      <1> 		add esi, buftxt
  2008 0000166F 47                  <1> 		inc edi
  2009 00001670 BB[6F150000]        <1> 		mov ebx, variables
  2010 00001675 E8B1FEFFFF          <1> 		call nxtvrech
  2011 0000167A 89F7                <1> 		mov edi, esi
  2012 0000167C 4F                  <1> 		dec edi
  2013 0000167D E973FFFFFF          <1> 		jmp varnum4
  2014                              <1> 	checkdecimal2:
  2015 00001682 8A25[21180000]      <1> 		mov ah, [decimal]
  2016 00001688 8825[22180000]      <1> 		mov [decimal2], ah
  2017 0000168E B400                <1> 		mov ah, 0
  2018 00001690 8825[21180000]      <1> 		mov [decimal], ah
  2019                              <1> 	checkdecimal:
  2020 00001696 89F7                <1> 		mov edi, esi
  2021                              <1> 	chkdec1:
  2022 00001698 8A07                <1> 		mov al, [edi]
  2023 0000169A 3C2E                <1> 		cmp al, '.'
  2024 0000169C 0F840B000000        <1> 		je near fnddec
  2025 000016A2 3C00                <1> 		cmp al, 0
  2026 000016A4 0F8419000000        <1> 		je near nodecimal
  2027 000016AA 47                  <1> 		inc edi
  2028 000016AB EBEB                <1> 		jmp chkdec1
  2029                              <1> 	fnddec:
  2030 000016AD 8A4701              <1> 		mov al, [edi + 1]
  2031 000016B0 8807                <1> 		mov [edi], al
  2032 000016B2 3C00                <1> 		cmp al, 0
  2033 000016B4 0F8409000000        <1> 		je near nodecimal
  2034 000016BA FE05[21180000]      <1> 		inc byte [decimal]
  2035 000016C0 47                  <1> 		inc edi
  2036 000016C1 EBEA                <1> 		jmp fnddec
  2037                              <1> 	nodecimal:
  2038 000016C3 C3                  <1> 		ret
  2039                              <1> 	plusnum:
  2040 000016C4 E816010000          <1> 		call decaddfix
  2041 000016C9 01D9                <1> 		add ecx, ebx
  2042 000016CB E991000000          <1> 		jmp retnum
  2043                              <1> 	subnum:
  2044 000016D0 E80A010000          <1> 		call decaddfix
  2045 000016D5 29D9                <1> 		sub ecx, ebx
  2046 000016D7 E985000000          <1> 		jmp retnum
  2047                              <1> 	mulnum:
  2048 000016DC A0[22180000]        <1> 		mov al, [decimal2]
  2049 000016E1 0005[21180000]      <1> 		add [decimal], al
  2050 000016E7 89C8                <1> 		mov eax, ecx
  2051 000016E9 F7E3                <1> 		mul ebx
  2052 000016EB 89C1                <1> 		mov ecx, eax
  2053 000016ED E96F000000          <1> 		jmp retnum
  2054                              <1> 	divnum:
  2055 000016F2 E8E8000000          <1> 		call decaddfix
  2056 000016F7 B000                <1> 		mov al, 0
  2057 000016F9 A2[21180000]        <1> 		mov [decimal], al
  2058 000016FE 6689C8              <1> 		mov ax, cx
  2059 00001701 80FB00              <1> 		cmp bl, 0
  2060 00001704 0F8457000000        <1> 		je near retnum
  2061 0000170A F6F3                <1> 		div bl
  2062 0000170C B900000000          <1> 		mov ecx, 0
  2063 00001711 88C1                <1> 		mov cl, al
  2064 00001713 E949000000          <1> 		jmp retnum
  2065                              <1> 	expnum:
  2066 00001718 8A15[21180000]      <1> 		mov dl, [decimal]
  2067 0000171E 8815[22180000]      <1> 		mov [decimal2], dl
  2068 00001724 BA00000000          <1> 		mov edx, 0
  2069 00001729 89C8                <1> 		mov eax, ecx
  2070 0000172B 89D9                <1> 		mov ecx, ebx
  2071 0000172D 89C3                <1> 		mov ebx, eax
  2072 0000172F 81F900000000        <1> 		cmp ecx, 0
  2073 00001735 7425                <1> 		je noexpnum
  2074 00001737 49                  <1> 		dec ecx
  2075 00001738 81F900000000        <1> 		cmp ecx, 0
  2076 0000173E 7415                <1> 		je noexpnumlp
  2077 00001740 F7E3                <1> 	expnumlp: mul ebx
  2078 00001742 8A15[22180000]      <1> 		mov dl, [decimal2]
  2079 00001748 0015[21180000]      <1> 		add [decimal], dl
  2080 0000174E BA00000000          <1> 		mov edx, 0
  2081 00001753 E2EB                <1> 		loop expnumlp
  2082                              <1> 	noexpnumlp:
  2083 00001755 89C1                <1> 		mov ecx, eax
  2084 00001757 E905000000          <1> 		jmp retnum
  2085                              <1> 	noexpnum:
  2086 0000175C B901000000          <1> 		mov ecx, 1
  2087                              <1> 	retnum: 
  2088 00001761 BE[841C0000]        <1> 		mov esi, numbuf
  2089 00001766 890D[23180000]      <1> 		mov [result], ecx
  2090 0000176C E8E6F8FFFF          <1> 		call convert
  2091 00001771 BE[841C0000]        <1> 		mov esi, numbuf
  2092 00001776 8A25[21180000]      <1> 		mov ah, [decimal]
  2093 0000177C 80FC00              <1> 		cmp ah, 0
  2094 0000177F 0F8425000000        <1> 		je near noputdecimal
  2095                              <1> 	putdecimal:
  2096 00001785 4E                  <1> 		dec esi
  2097 00001786 FECC                <1> 		dec ah
  2098 00001788 80FC00              <1> 		cmp ah, 0
  2099 0000178B 0F87F4FFFFFF        <1> 		ja near putdecimal
  2100 00001791 4E                  <1> 		dec esi
  2101 00001792 8A06                <1> 		mov al, [esi]
  2102 00001794 C6062E              <1> 		mov byte [esi], '.'
  2103                              <1> 	decputloop:
  2104 00001797 4E                  <1> 		dec esi
  2105 00001798 8A26                <1> 		mov ah, [esi]
  2106 0000179A 8806                <1> 		mov [esi], al
  2107 0000179C 88E0                <1> 		mov al, ah
  2108 0000179E 81FE[701C0000]      <1> 		cmp esi, buf2
  2109 000017A4 0F87EDFFFFFF        <1> 		ja near decputloop
  2110                              <1> 	noputdecimal:
  2111 000017AA BE[701C0000]        <1> 		mov esi, buf2
  2112 000017AF E809000000          <1> 		call chkadd
  2113 000017B4 E940F6FFFF          <1> 		jmp nwcmd
  2114 000017B9 00000000            <1> edxnumbuf dw 0,0
  2115 000017BD 8A06                <1> 	chkadd: mov al, [esi]
  2116 000017BF 3C30                <1> 		cmp al, '0'
  2117 000017C1 750C                <1> 		jne dnadd
  2118 000017C3 46                  <1> 		inc esi
  2119 000017C4 81FE[841C0000]      <1> 		cmp esi, numbuf
  2120 000017CA 7402                <1> 		je dnaddm1
  2121 000017CC EBEF                <1> 		jmp chkadd
  2122 000017CE 4E                  <1> 	dnaddm1: dec esi
  2123 000017CF E84DF3FFFF          <1> 	dnadd:	call print
  2124 000017D4 BE[06400000]        <1> 		mov esi, line
  2125 000017D9 E843F3FFFF          <1> 		call print
  2126 000017DE C3                  <1> 		ret
  2127                              <1> 		
  2128                              <1> 	decaddfix:
  2129 000017DF A0[22180000]        <1> 		mov al, [decimal2]
  2130 000017E4 8A25[21180000]      <1> 		mov ah, [decimal]
  2131 000017EA 38E0                <1> 		cmp al, ah
  2132 000017EC 7432                <1> 		je gooddecadd
  2133 000017EE 38E0                <1> 		cmp al, ah
  2134 000017F0 721A                <1> 		jb lowdecadd
  2135                              <1> 	highdecadd:
  2136 000017F2 FEC4                <1> 		inc ah
  2137 000017F4 89CA                <1> 		mov edx, ecx
  2138 000017F6 C1E103              <1> 		shl ecx, 3
  2139 000017F9 01D1                <1> 		add ecx, edx
  2140 000017FB 01D1                <1> 		add ecx, edx
  2141 000017FD 38E0                <1> 		cmp al, ah
  2142 000017FF 77F1                <1> 		ja highdecadd
  2143 00001801 8825[21180000]      <1> 		mov [decimal], ah
  2144 00001807 E914000000          <1> 		jmp gooddecadd
  2145                              <1> 	lowdecadd:
  2146 0000180C FEC0                <1> 		inc al
  2147 0000180E 89DA                <1> 		mov edx, ebx
  2148 00001810 C1E303              <1> 		shl ebx, 3
  2149 00001813 01D3                <1> 		add ebx, edx
  2150 00001815 01D3                <1> 		add ebx, edx
  2151 00001817 38E0                <1> 		cmp al, ah
  2152 00001819 72F1                <1> 		jb lowdecadd
  2153 0000181B A2[21180000]        <1> 		mov [decimal], al
  2154                              <1> 	gooddecadd:
  2155 00001820 C3                  <1> 		ret
  2156                              <1> 		
  2157 00001821 00                  <1> decimal db 0
  2158 00001822 00                  <1> decimal2 db 0
  2159 00001823 00000000            <1> result db 0,0,0,0
  2160                              <1> 	
  2161 00001827 05042500            <1> db 5,4,"%",0
  2162 0000182B E812F8FFFF          <1> 	ans:	call clearbuffer
  2163 00001830 8B0D[23180000]      <1> 		mov ecx, [result]
  2164 00001836 BE[701C0000]        <1> 		mov esi, buf2
  2165 0000183B E817F8FFFF          <1> 		call convert
  2166 00001840 BE[701C0000]        <1> 		mov esi, buf2
  2167 00001845 E873FFFFFF          <1> 		call chkadd
  2168 0000184A E9AAF5FFFF          <1> 		jmp nwcmd
  2169                              <1> 
  2170 0000184F 05042400            <1> db 5,4,"$",0
  2171 00001853 BE[701A0000]        <1> var:	mov esi, buftxt
  2172 00001858 BB[6F150000]        <1> 	mov ebx, variables
  2173 0000185D 8A06                <1> lkeq:	mov al, [esi]
  2174 0000185F 3C3D                <1> 	cmp al, '='
  2175 00001861 741F                <1> 	je eqfnd	;is there an '=' sign?
  2176 00001863 3C00                <1> 	cmp al, 0
  2177 00001865 7403                <1> 	je echovars
  2178 00001867 46                  <1> 	inc esi
  2179 00001868 EBF3                <1> 	jmp lkeq
  2180 0000186A BE[6F150000]        <1> echovars: mov esi, variables
  2181 0000186F BB[6F1A0000]        <1> 	mov ebx, varend
  2182 00001874 B105                <1> 	mov cl, 5
  2183 00001876 B504                <1> 	mov ch, 4
  2184 00001878 E864F7FFFF          <1> 	call array
  2185 0000187D E977F5FFFF          <1> 	jmp nwcmd
  2186 00001882 46                  <1> eqfnd:	inc esi
  2187 00001883 8A06                <1> 	mov al, [esi]
  2188 00001885 3C00                <1> 	cmp al, 0
  2189 00001887 740F                <1> 	je readvar
  2190 00001889 BE[701A0000]        <1> 	mov esi, buftxt
  2191 0000188E BB[6F150000]        <1> 	mov ebx, variables
  2192 00001893 E917000000          <1> 	jmp seek
  2193                              <1> readvar: 
  2194 00001898 B00D                <1> 	mov al, 13
  2195 0000189A B404                <1> 	mov ah, 4
  2196 0000189C B307                <1> 	mov bl, 7
  2197 0000189E E885F0FFFF          <1> 	call intx4
  2198 000018A3 BE[06400000]        <1> 	mov esi, line
  2199 000018A8 E874F2FFFF          <1> 	call print
  2200 000018AD EBA4                <1> 	jmp var
  2201 000018AF 668B03              <1> seek:	mov ax, [ebx]
  2202 000018B2 B105                <1> 	mov cl, 5
  2203 000018B4 B504                <1> 	mov ch, 4
  2204 000018B6 663D0000            <1> 	cmp ax, 0
  2205 000018BA 0F8459000000        <1> 	je near save
  2206 000018C0 6639C8              <1> 	cmp ax, cx
  2207 000018C3 7403                <1> 	je skfnd
  2208 000018C5 43                  <1> 	inc ebx
  2209 000018C6 EBE7                <1> 	jmp seek
  2210 000018C8 BE[701A0000]        <1> skfnd:	mov esi, buftxt
  2211 000018CD 46                  <1> 	inc esi
  2212 000018CE 81C302000000        <1> 	add ebx, 2
  2213 000018D4 89DF                <1> 	mov edi, ebx
  2214 000018D6 B13D                <1> 	mov cl, '='
  2215 000018D8 E842F6FFFF          <1> 	call cndtest
  2216 000018DD 3C01                <1> 	cmp al, 1	
  2217 000018DF 7417                <1> 	je varfnd
  2218 000018E1 89FB                <1> 	mov ebx, edi
  2219 000018E3 BE[701A0000]        <1> 	mov esi, buftxt
  2220 000018E8 668B03              <1> 	mov ax, [ebx]
  2221 000018EB 663D0000            <1> 	cmp ax, 0
  2222 000018EF 0F8424000000        <1> 	je near save
  2223 000018F5 43                  <1> 	inc ebx
  2224 000018F6 EBB7                <1> 	jmp seek
  2225 000018F8 8A03                <1> varfnd:	mov al, [ebx]
  2226 000018FA 3C04                <1> 	cmp al, 4
  2227 000018FC 7404                <1> 	je save2
  2228 000018FE 4B                  <1> 	dec ebx
  2229 000018FF 4E                  <1> 	dec esi
  2230 00001900 EBF6                <1> 	jmp varfnd
  2231 00001902 4B                  <1> save2:	dec ebx
  2232 00001903 4E                  <1> 	dec esi
  2233 00001904 8A03                <1> 	mov al, [ebx]
  2234 00001906 3C05                <1> 	cmp al, 5
  2235 00001908 7402                <1> 	je remove
  2236 0000190A EBEC                <1> 	jmp varfnd
  2237 0000190C 8A03                <1> remove: mov al, [ebx]
  2238 0000190E 3C00                <1> 	cmp al, 0
  2239 00001910 749D                <1> 	je seek
  2240 00001912 B000                <1> 	mov al, 0
  2241 00001914 8803                <1> 	mov [ebx], al
  2242 00001916 43                  <1> 	inc ebx
  2243 00001917 EBF3                <1> 	jmp remove	;do not need for now-need defragmentation
  2244 00001919 BE[701A0000]        <1> save:	mov esi, buftxt
  2245 0000191E 43                  <1> 	inc ebx
  2246 0000191F B005                <1> 	mov al, 5
  2247 00001921 B404                <1> 	mov ah, 4
  2248 00001923 668903              <1> 	mov [ebx], ax
  2249 00001926 43                  <1> 	inc ebx
  2250 00001927 43                  <1> svhere:	inc ebx
  2251 00001928 46                  <1> 	inc esi
  2252 00001929 8A06                <1> 	mov al, [esi]
  2253 0000192B 3C00                <1> 	cmp al, 0
  2254 0000192D 0F8442000000        <1> 	je near svdone
  2255 00001933 3C25                <1> 	cmp al, '%'
  2256 00001935 7404                <1> 	je ans2
  2257 00001937 8803                <1> 	mov [ebx], al	
  2258 00001939 EBEC                <1> 	jmp svhere
  2259 0000193B 56                  <1> ans2:	push esi
  2260 0000193C BE[701C0000]        <1> 	mov esi, buf2
  2261 00001941 E823000000          <1> 	call ansfnd
  2262 00001946 E803000000          <1> 	call anscp
  2263 0000194B 5E                  <1> 	pop esi
  2264 0000194C EBD9                <1> 	jmp svhere
  2265 0000194E 8A06                <1> anscp:	mov al, [esi]
  2266 00001950 8803                <1> 	mov [ebx], al
  2267 00001952 81FE[841C0000]      <1> 	cmp esi, numbuf
  2268 00001958 74CD                <1> 	je svhere
  2269 0000195A 3C00                <1> 	cmp al, 0
  2270 0000195C 74C9                <1> 	je svhere
  2271 0000195E 43                  <1> 	inc ebx
  2272 0000195F 46                  <1> 	inc esi
  2273 00001960 EBEC                <1> 	jmp anscp
  2274 00001962 5E                  <1> ansnf:	pop esi
  2275 00001963 8A06                <1> 	mov al, [esi]
  2276 00001965 8803                <1> 	mov [ebx], al
  2277 00001967 EBBE                <1> 	jmp svhere
  2278 00001969 46                  <1> ansfnd:	inc esi
  2279 0000196A 8A06                <1> 	mov al, [esi]
  2280 0000196C 3C00                <1> 	cmp al, 0
  2281 0000196E 74F2                <1> 	je ansnf
  2282 00001970 3C30                <1> 	cmp al, '0'
  2283 00001972 74F5                <1> 	je ansfnd
  2284 00001974 C3                  <1> 	ret
  2285 00001975 B000                <1> svdone:	mov al, 0
  2286 00001977 8803                <1> 	mov [ebx], al
  2287 00001979 E97BF4FFFF          <1> 	jmp nwcmd
  2288                              <1> 	
  2289                              <1> 	
  2290 0000197E 05042E2F00          <1> 	db 5,4,"./",0
  2291                              <1> rundiskprog:
  2292 00001983 BF[701A0000]        <1> 	mov edi, buftxt
  2293 00001988 81C702000000        <1> 	add edi, 2
  2294 0000198E BE00001000          <1> 	mov esi, 0x100000
  2295 00001993 E815240000          <1> 	call loadfile
  2296 00001998 81FA94010000        <1> 	cmp edx, 404
  2297 0000199E 7414                <1> 	je noprogfound
  2298 000019A0 BB00001000          <1> 	mov ebx, 0x100000
  2299 000019A5 66813B4558          <1> 	cmp word [ebx], "EX"
  2300 000019AA 7531                <1> 	jne progbatchfound
  2301 000019AC 81C302000000        <1> 	add ebx, 2
  2302 000019B2 FFE3                <1> 	jmp ebx
  2303                              <1> noprogfound:
  2304 000019B4 BE[CD3F0000]        <1> 	mov esi, notfound1
  2305 000019B9 E863F1FFFF          <1> 	call print
  2306 000019BE BE[701A0000]        <1> 	mov esi, buftxt
  2307 000019C3 81C602000000        <1> 	add esi, 2
  2308 000019C9 E853F1FFFF          <1> 	call print
  2309 000019CE BE[D73F0000]        <1> 	mov esi, notfound2
  2310 000019D3 E849F1FFFF          <1> 	call print
  2311 000019D8 E91CF4FFFF          <1> 	jmp nwcmd
  2312                              <1> progbatchfound:
  2313 000019DD BF00001000          <1> 		mov edi, 0x100000
  2314 000019E2 C605[69130000]01    <1> 		mov byte [BATCHISON], 1
  2315                              <1> 	batchrunloop:
  2316 000019E9 E8E8F3FFFF          <1> 		call buftxtclear
  2317 000019EE BE[701A0000]        <1> 		mov esi, buftxt
  2318                              <1> 	batchrunloop2:
  2319 000019F3 B10D                <1> 		mov cl, 13
  2320 000019F5 B50A                <1> 		mov ch, 10
  2321 000019F7 66390F              <1> 		cmp [edi], cx
  2322 000019FA 0F841E000000        <1> 		je near nxtbatchrunline
  2323 00001A00 66C1C108            <1> 		rol cx, 8
  2324 00001A04 66390F              <1> 		cmp [edi], cx
  2325 00001A07 0F8411000000        <1> 		je near nxtbatchrunline
  2326 00001A0D 803F00              <1> 		cmp byte [edi], 0
  2327 00001A10 0F8408000000        <1> 		je near nxtbatchrunline
  2328 00001A16 8A07                <1> 		mov al, [edi]
  2329 00001A18 8806                <1> 		mov [esi], al
  2330 00001A1A 46                  <1> 		inc esi
  2331 00001A1B 47                  <1> 		inc edi
  2332 00001A1C EBD5                <1> 		jmp batchrunloop2
  2333                              <1> 	nxtbatchrunline:
  2334 00001A1E 81C702000000        <1> 		add edi, 2
  2335 00001A24 893D[831A0000]      <1> 		mov [batchedi], edi
  2336 00001A2A C60600              <1> 		mov byte [esi], 0
  2337 00001A2D BE[701A0000]        <1> 		mov esi, buftxt
  2338 00001A32 803E00              <1> 		cmp byte [esi], 0
  2339 00001A35 0F843C000000        <1> 		je near nobatchfoundrun
  2340 00001A3B BB00000000          <1> 		mov ebx, 0
  2341 00001A40 8A1D[00130000]      <1> 		mov bl, [IFON]
  2342 00001A46 80FB01              <1> 		cmp bl, 1
  2343 00001A49 0F8338000000        <1> 		jae near iftestbatch
  2344                              <1> 	doneiftest:
  2345 00001A4F 803D[4A1B0000]00    <1> 		cmp byte [runnextline], 0
  2346 00001A56 0F8405000000        <1> 		je near noruniftest
  2347 00001A5C E809F4FFFF          <1> 		call progtest
  2348                              <1> 	noruniftest:
  2349 00001A61 C605[4A1B0000]01    <1> 		mov byte [runnextline], 1
  2350 00001A68 8B3D[831A0000]      <1> 		mov edi, [batchedi]
  2351 00001A6E 803F00              <1> 		cmp byte [edi], 0
  2352 00001A71 0F8572FFFFFF        <1> 		jne near batchrunloop
  2353                              <1> 	nobatchfoundrun:
  2354 00001A77 C605[69130000]00    <1> 		mov byte [BATCHISON], 0
  2355 00001A7E E976F3FFFF          <1> 		jmp nwcmd
  2356                              <1> 	
  2357 00001A83 00000000            <1> batchedi dd 0	
  2358                              <1> 	
  2359                              <1> 	iftestbatch:
  2360 00001A87 BE[01130000]        <1> 		mov esi, IFTRUE
  2361 00001A8C 01DE                <1> 		add esi, ebx
  2362 00001A8E 803E00              <1> 		cmp byte [esi], 0
  2363 00001A91 0F85B8FFFFFF        <1> 		jne near doneiftest
  2364 00001A97 881D[4B1B0000]      <1> 		mov [iffalsebuf], bl
  2365 00001A9D 803D[6A130000]01    <1> 		cmp byte [LOOPON], 1
  2366 00001AA4 750B                <1> 		jne fifindbatch
  2367 00001AA6 8B3D[6B130000]      <1> 		mov edi, [LOOPPOS]
  2368 00001AAC E938FFFFFF          <1> 		jmp batchrunloop
  2369                              <1> 	fifindbatch:
  2370 00001AB1 66B96966            <1> 		mov cx, "if"
  2371 00001AB5 66B86669            <1> 		mov ax, "fi"
  2372 00001AB9 663907              <1> 		cmp [edi], ax
  2373 00001ABC 0F841A000000        <1> 		je near fifoundbatch
  2374 00001AC2 66390F              <1> 		cmp [edi], cx
  2375 00001AC5 0F8462000000        <1> 		je near iffoundbatch
  2376 00001ACB 803F00              <1> 		cmp byte [edi], 0
  2377 00001ACE 0F8408000000        <1> 		je near fifoundbatch
  2378 00001AD4 81C702000000        <1> 		add edi, 2
  2379 00001ADA EBD5                <1> 		jmp fifindbatch
  2380                              <1> 	fifoundbatch:
  2381 00001ADC 81C702000000        <1> 		add edi, 2
  2382 00001AE2 B00D                <1> 		mov al, 13
  2383 00001AE4 B40A                <1> 		mov ah, 10
  2384 00001AE6 663907              <1> 		cmp [edi], ax
  2385 00001AE9 7414                <1> 		je goodfibatch
  2386 00001AEB 66C1C008            <1> 		rol ax, 8
  2387 00001AEF 663907              <1> 		cmp [edi], ax
  2388 00001AF2 740B                <1> 		je goodfibatch
  2389 00001AF4 803F00              <1> 		cmp byte [edi], 0
  2390 00001AF7 0F847AFFFFFF        <1> 		je near nobatchfoundrun
  2391 00001AFD EBB2                <1> 		jmp fifindbatch
  2392                              <1> 	goodfibatch:
  2393 00001AFF B001                <1> 		mov al, 1
  2394 00001B01 2805[00130000]      <1> 		sub [IFON], al 
  2395 00001B07 A0[00130000]        <1> 		mov al, [IFON]
  2396 00001B0C 8A1D[4B1B0000]      <1> 		mov bl, [iffalsebuf]
  2397 00001B12 38D8                <1> 		cmp al, bl
  2398 00001B14 779B                <1> 		ja fifindbatch
  2399 00001B16 BE[701A0000]        <1> 		mov esi, buftxt
  2400 00001B1B 81EF02000000        <1> 		sub edi, 2
  2401 00001B21 C605[4A1B0000]00    <1> 		mov byte [runnextline], 0
  2402 00001B28 E9BCFEFFFF          <1> 		jmp batchrunloop
  2403                              <1> 	iffoundbatch:
  2404 00001B2D B020                <1> 		mov al, ' '
  2405 00001B2F 81C702000000        <1> 		add edi, 2
  2406 00001B35 3807                <1> 		cmp [edi], al
  2407 00001B37 0F8574FFFFFF        <1> 		jne near fifindbatch
  2408 00001B3D B001                <1> 		mov al, 1
  2409 00001B3F 0005[00130000]      <1> 		add [IFON], al
  2410 00001B45 E967FFFFFF          <1> 		jmp fifindbatch
  2411                              <1> 		
  2412                              <1> 		
  2413 00001B4A 01                  <1> runnextline db 1
  2414 00001B4B 00                  <1> iffalsebuf db 0
  2415                              <1> 
  2416 00001B4C E9A8F2FFFF          <1> notbatch: jmp nwcmd
  2417                              <1> 
  2418 00001B51 05047768696C6500    <1> 	db 5,4,"while",0
  2419 00001B59 B000                <1> while:  mov al, 0
  2420 00001B5B 3805[69130000]      <1> 	cmp [BATCHISON], al
  2421 00001B61 0F84E5FFFFFF        <1> 	je near notbatch
  2422 00001B67 8B35[65130000]      <1> 	MOV esi, [BATCHPOS]
  2423 00001B6D 4E                  <1> whilefnd: dec esi
  2424 00001B6E 8A06                <1> 	mov al, [esi]
  2425 00001B70 3C0A                <1> 	cmp al, 10
  2426 00001B72 0F8412000000        <1> 	je near whilefnd2
  2427 00001B78 3C0D                <1> 	cmp al, 13
  2428 00001B7A 0F840A000000        <1> 	je near whilefnd2
  2429 00001B80 3C00                <1> 	cmp al, 0
  2430 00001B82 0F8402000000        <1> 	je near whilefnd2
  2431 00001B88 EBE3                <1> 	jmp whilefnd
  2432                              <1> whilefnd2:
  2433 00001B8A 8935[6B130000]      <1> 	mov [LOOPPOS], esi
  2434 00001B90 C605[6A130000]01    <1> 	mov BYTE [LOOPON], 1
  2435 00001B97 0005[00130000]      <1> 	add [IFON], al
  2436 00001B9D BE[701A0000]        <1> 	mov esi, buftxt
  2437 00001BA2 BB[701A0000]        <1> 	mov ebx, buftxt
  2438 00001BA7 81C306000000        <1> 	add ebx, 6
  2439 00001BAD E923000000          <1> 	jmp chkeqsn
  2440                              <1> 
  2441                              <1> 
  2442 00001BB2 0504696600          <1> 	db 5,4,"if",0
  2443 00001BB7 B000                <1> if:	mov al, 0
  2444 00001BB9 3805[69130000]      <1> 	cmp [BATCHISON], al
  2445 00001BBF 0F8487FFFFFF        <1> 	je near notbatch
  2446 00001BC5 BE[701A0000]        <1> 	mov esi, buftxt
  2447 00001BCA BB[701A0000]        <1> 	mov ebx, buftxt
  2448 00001BCF 81C303000000        <1> 	add ebx, 3
  2449 00001BD5 8A06                <1> chkeqsn: mov al, [esi]
  2450 00001BD7 3C00                <1> 	cmp al, 0
  2451 00001BD9 0F846DFFFFFF        <1> 	je near notbatch
  2452 00001BDF 3C3D                <1> 	cmp al, '='
  2453 00001BE1 0F8403000000        <1> 	je near chkeqdn
  2454 00001BE7 46                  <1> 	inc esi
  2455 00001BE8 EBEB                <1> 	jmp chkeqsn
  2456 00001BEA B000                <1> chkeqdn: mov al, 0 
  2457 00001BEC 8806                <1> 	mov [esi], al
  2458 00001BEE 46                  <1> 	inc esi
  2459 00001BEF 8A06                <1> 	mov al, [esi]
  2460 00001BF1 3C24                <1> 	cmp al, '$'
  2461 00001BF3 0F8462000000        <1> 	je near ifvar1
  2462 00001BF9 8A03                <1> ifvar2: mov al, [ebx]
  2463 00001BFB 3C24                <1> 	cmp al, '$'
  2464 00001BFD 0F847B000000        <1> 	je near ifvar3
  2465 00001C03 E8DDF2FFFF          <1> ifvar4:	call tester
  2466 00001C08 3C01                <1> 	cmp al, 1
  2467 00001C0A 0F8405000000        <1> 	je near trueif
  2468 00001C10 E923000000          <1> 	jmp falseif
  2469 00001C15 B800000000          <1> trueif:	mov eax, 0
  2470 00001C1A A0[00130000]        <1> 	mov al, [IFON]
  2471 00001C1F FEC0                <1> 	inc al
  2472 00001C21 A2[00130000]        <1> 	mov [IFON], al
  2473 00001C26 B400                <1> 	mov ah, 0
  2474 00001C28 BE[01130000]        <1> 	mov esi, IFTRUE
  2475 00001C2D 01C6                <1> 	add esi, eax
  2476 00001C2F B401                <1> 	mov ah, 1
  2477 00001C31 8826                <1> 	mov [esi], ah
  2478 00001C33 E9C1F1FFFF          <1> 	jmp nwcmd
  2479 00001C38 B800000000          <1> falseif: mov eax, 0
  2480 00001C3D A0[00130000]        <1> 	mov al, [IFON]
  2481 00001C42 FEC0                <1> 	inc al
  2482 00001C44 A2[00130000]        <1> 	mov [IFON], al
  2483 00001C49 B400                <1> 	mov ah, 0
  2484 00001C4B BE[01130000]        <1> 	mov esi, IFTRUE
  2485 00001C50 01C6                <1> 	add esi, eax
  2486 00001C52 B400                <1> 	mov ah, 0
  2487 00001C54 8826                <1> 	mov [esi], ah
  2488 00001C56 E99EF1FFFF          <1> 	jmp nwcmd
  2489 00001C5B 89F7                <1> ifvar1: mov edi, esi
  2490 00001C5D 81EF[701A0000]      <1> 	sub edi, buftxt
  2491 00001C63 47                  <1> 	inc edi
  2492 00001C64 BB[6F150000]        <1> 	mov ebx, variables
  2493 00001C69 E8BDF8FFFF          <1> 	call nxtvrech
  2494 00001C6E BB[701A0000]        <1> 	mov ebx, buftxt
  2495 00001C73 81C303000000        <1> 	add ebx, 3
  2496 00001C79 E97BFFFFFF          <1> 	jmp ifvar2
  2497 00001C7E 8935[9E1C0000]      <1> ifvar3: mov [esiif], esi
  2498 00001C84 BF04000000          <1> 	mov edi, 4
  2499 00001C89 BB[6F150000]        <1> 	mov ebx, variables
  2500 00001C8E E898F8FFFF          <1> 	call nxtvrech
  2501 00001C93 8B35[9E1C0000]      <1> 	mov esi, [esiif]
  2502 00001C99 E965FFFFFF          <1> 	jmp ifvar4
  2503                              <1> 
  2504 00001C9E 00000000            <1> esiif dd 0
  2505                              <1> 	
  2506 00001CA2 0504656C736500      <1> 	db 5,4,"else",0
  2507 00001CA9 B800000000          <1> else:	mov eax, 0
  2508 00001CAE A0[00130000]        <1> 	mov al, [IFON]
  2509 00001CB3 BE[01130000]        <1> 	mov esi, IFTRUE
  2510 00001CB8 01C6                <1> 	add esi, eax
  2511 00001CBA 8A06                <1> 	mov al, [esi]
  2512 00001CBC 3C00                <1> 	cmp al, 0		
  2513 00001CBE 7409                <1> 	je else1
  2514 00001CC0 3C01                <1> 	cmp al, 1
  2515 00001CC2 740E                <1> 	je else2
  2516 00001CC4 E930F1FFFF          <1> 	jmp nwcmd
  2517 00001CC9 B001                <1> else1:  mov al, 1
  2518 00001CCB 8806                <1> 	mov [esi], al
  2519 00001CCD E927F1FFFF          <1> 	jmp nwcmd
  2520 00001CD2 B000                <1> else2:	mov al, 0
  2521 00001CD4 8806                <1> 	mov [esi], al
  2522 00001CD6 E91EF1FFFF          <1> 	jmp nwcmd
  2523                              <1> 
  2524 00001CDB 05046C6F6F7000      <1> 	db 5,4,"loop",0
  2525 00001CE2 3805[6A130000]      <1> 	cmp [LOOPON], al
  2526 00001CE8 0F8405000000        <1> 	je near filoop
  2527 00001CEE E906F1FFFF          <1> 	jmp nwcmd
  2528 00001CF3 8B35[6B130000]      <1> filoop: mov esi, [LOOPPOS]
  2529 00001CF9 8935[65130000]      <1> 	mov [BATCHPOS], esi
  2530 00001CFF E9F5F0FFFF          <1> 	jmp nwcmd
  2531                              <1> 	
  2532                              <1> 
  2533 00001D04 0504666900          <1> 	db 5,4,"fi",0
  2534 00001D09 B000                <1> 	mov al, 0
  2535 00001D0B 3805[69130000]      <1> 	cmp [BATCHISON], al
  2536 00001D11 0F8435FEFFFF        <1> 	je near notbatch
  2537 00001D17 B001                <1> fi:	mov al, 1
  2538 00001D19 2805[00130000]      <1> 	sub [IFON],al
  2539 00001D1F E9D5F0FFFF          <1> 	jmp nwcmd
  2540                              <1> 
  2541 00001D24 050473746F7000      <1> 	db 5,4,"stop",0
  2542 00001D2B B000                <1> stop:	mov al, 0
  2543 00001D2D A2[69130000]        <1> 	mov [BATCHISON], al
  2544 00001D32 A2[00130000]        <1> 	mov [IFON], al
  2545 00001D37 A2[01130000]        <1> 	mov [IFTRUE], al
  2546 00001D3C A2[6A130000]        <1> 	mov [LOOPON], al
  2547 00001D41 E9B3F0FFFF          <1> 	jmp nwcmd
  2548                                      %include 'source/programs.asm'
  2549                              <1> 
  2550                              <1> ;db 5,4,"internet",0
  2551                              <1> 	internettest: 			;;initialize network card, lets hope this is right
  2552                              <1> 							;;^^used to^^, now tests int 30h functions		
  2553 00001D46 B403                <1> 		mov ah, 3
  2554 00001D48 CD30                <1> 		int 30h
  2555 00001D4A B401                <1> 		mov ah, 1
  2556 00001D4C BE[5E1D0000]        <1> 		mov esi, datmsg
  2557 00001D51 66BB0700            <1> 		mov bx, 7
  2558 00001D55 B000                <1> 		mov al, 0
  2559 00001D57 CD30                <1> 		int 30h
  2560                              <1> 	;jmp packettest
  2561 00001D59 E99BF0FFFF          <1> 		jmp nwcmd
  2562 00001D5E 496E7465726E657420- <1> datmsg: db "Internet has not been implemented yet.",10,13,0
  2563 00001D67 686173206E6F742062- <1>
  2564 00001D70 65656E20696D706C65- <1>
  2565 00001D79 6D656E746564207965- <1>
  2566 00001D82 742E0A0D00          <1>
  2567                              <1> 		
  2568 00001D87 050470636900        <1> db 5,4,"pci",0
  2569                              <1> 	pcishow:
  2570 00001D8D E8611E0000          <1> 	call pcidump
  2571 00001D92 E962F0FFFF          <1> 	jmp nwcmd
  2572                              <1> ;db 5,4,"runbat",0
  2573                              <1> ;	runbatch2:
  2574                              <1> ;		mov esi, line
  2575                              <1> ;		call print
  2576                              <1> ;		mov edi, buftxt
  2577                              <1> ;		add edi, 7
  2578                              <1> ;		mov esi, 0x100000
  2579                              <1> ;		call loadfile
  2580                              <1> 
  2581                              <1> 
  2582 00001D97 0504626174636800    <1> db 5,4,"batch",0
  2583                              <1> 	batchst: 
  2584 00001D9F BF[701A0000]        <1> 		mov edi, buftxt
  2585 00001DA4 81C706000000        <1> 		add edi, 6
  2586 00001DAA 803F00              <1> 		cmp byte [edi], 0
  2587 00001DAD 0F8473000000        <1> 		je near nonamefound
  2588 00001DB3 BE00001000          <1> 		mov esi, 0x100000
  2589 00001DB8 E8F01F0000          <1> 		call loadfile
  2590 00001DBD 89D0                <1> 		mov eax, edx
  2591 00001DBF 3D94010000          <1> 		cmp eax, 404
  2592 00001DC4 746F                <1> 		je goodbatchname
  2593 00001DC6 BE[D51D0000]        <1> 		mov esi, badbatchname
  2594 00001DCB E851EDFFFF          <1> 		call print
  2595 00001DD0 E924F0FFFF          <1> 		jmp nwcmd
  2596 00001DD5 546869732066696C65- <1> 		badbatchname db "This file already exists!",10,13,0
  2597 00001DDE 20616C726561647920- <1>
  2598 00001DE7 657869737473210A0D- <1>
  2599 00001DF0 00                  <1>
  2600 00001DF1 596F75206861766520- <1> 		namenotfoundbatch db "You have to type a name after the command.",10,13,0
  2601 00001DFA 746F20747970652061- <1>
  2602 00001E03 206E616D6520616674- <1>
  2603 00001E0C 65722074686520636F- <1>
  2604 00001E15 6D6D616E642E0A0D00  <1>
  2605 00001E1E 00000000            <1> 		esicache3 dd 0
  2606 00001E22 00000000            <1> 		esicache2 dd 0
  2607                              <1> 	nonamefound:
  2608 00001E26 BE[F11D0000]        <1> 		mov esi, namenotfoundbatch
  2609 00001E2B E8F1ECFFFF          <1> 		call print
  2610 00001E30 E9C4EFFFFF          <1> 		jmp nwcmd
  2611                              <1> 	goodbatchname:
  2612 00001E35 BE00001000          <1> 		mov esi, 0x100000
  2613                              <1> 	batchcreate:
  2614 00001E3A 8935[1E1E0000]      <1> 		mov [esicache3], esi
  2615 00001E40 B00D                <1> 		mov al, 13
  2616 00001E42 B307                <1> 		mov bl, 7
  2617 00001E44 B404                <1> 		mov ah, 4
  2618 00001E46 CD30                <1> 		int 30h
  2619 00001E48 8935[221E0000]      <1> 		mov [esicache2], esi
  2620 00001E4E 8A0E                <1> 		mov cl, [esi]
  2621 00001E50 8B35[1E1E0000]      <1> 		mov esi, [esicache3]
  2622 00001E56 BB[AD1E0000]        <1> 		mov ebx, exitword
  2623 00001E5B E8BFF0FFFF          <1> 		call cndtest
  2624 00001E60 3C01                <1> 		cmp al, 1
  2625 00001E62 7423                <1> 		je endbatchcreate
  2626 00001E64 3C02                <1> 		cmp al, 2
  2627 00001E66 741F                <1> 		je endbatchcreate
  2628 00001E68 BE[06400000]        <1> 		mov esi, line
  2629 00001E6D E8AFECFFFF          <1> 		call print
  2630 00001E72 8B35[221E0000]      <1> 		mov esi, [esicache2]
  2631 00001E78 B00D                <1> 		mov al, 13
  2632 00001E7A B40A                <1> 		mov ah, 10
  2633 00001E7C 668906              <1> 		mov [esi], ax
  2634 00001E7F 81C602000000        <1> 		add esi, 2
  2635 00001E85 EBB3                <1> 		jmp batchcreate
  2636                              <1> 	endbatchcreate:
  2637 00001E87 8B35[1E1E0000]      <1> 		mov esi, [esicache3]
  2638 00001E8D B800000000          <1> 		mov eax, 0
  2639 00001E92 8806                <1> 		mov [esi], al
  2640 00001E94 BE[06400000]        <1> 		mov esi, line
  2641 00001E99 E883ECFFFF          <1> 		call print
  2642 00001E9E BE00001000          <1> 		mov esi, 0x100000
  2643 00001EA3 E879ECFFFF          <1> 		call print
  2644 00001EA8 E94CEFFFFF          <1> 		jmp nwcmd
  2645                              <1> 	
  2646 00001EAD 5C7800              <1> 	exitword db "\x",0
  2647 00001EB0 54797065205C782074- <1> 	wordmsg db "Type \x to exit.",10,13,0
  2648 00001EB9 6F20657869742E0A0D- <1>
  2649 00001EC2 00                  <1>
  2650                              <1> 		
  2651 00001EC3 050473686F7700      <1> db 5,4,"show",0
  2652 00001ECA BF[701A0000]        <1> 		mov edi, buftxt
  2653 00001ECF 81C705000000        <1> 		add edi, 5
  2654 00001ED5 BE00001000          <1> 		mov esi, 0x100000
  2655 00001EDA E8CE1E0000          <1> 		call loadfile
  2656 00001EDF BE00001000          <1> 		mov esi, 0x100000
  2657 00001EE4 66813E424D          <1> 		cmp word [esi], "BM"
  2658 00001EE9 7414                <1> 		je bmpfound
  2659 00001EEB E831ECFFFF          <1> 		call print
  2660 00001EF0 BE[06400000]        <1> 		mov esi, line
  2661 00001EF5 E827ECFFFF          <1> 		call print
  2662 00001EFA E9FAEEFFFF          <1> 		jmp nwcmd
  2663                              <1> bmpfound:
  2664 00001EFF 803D[BA270000]00    <1> 		cmp byte [guion], 0
  2665 00001F06 0F8443000000        <1> 		je near noguibmp
  2666 00001F0C BE00001000          <1> 		mov esi, 0x100000
  2667 00001F11 B900000000          <1> 		mov ecx, 0
  2668 00001F16 BA00000000          <1> 		mov edx, 0
  2669 00001F1B B800000000          <1> 		mov eax, 0
  2670 00001F20 BB00000000          <1> 		mov ebx, 0
  2671 00001F25 E85F180000          <1> 		call showbmp
  2672 00001F2A B000                <1> 		mov al, 0
  2673 00001F2C B405                <1> 		mov ah, 5
  2674 00001F2E CD30                <1> 		int 30h
  2675 00001F30 BE[701A0000]        <1> 		mov esi, buftxt
  2676 00001F35 81C608000000        <1> 		add esi, 8
  2677 00001F3B E8E1EBFFFF          <1> 		call print
  2678 00001F40 BE[D21F0000]        <1> 		mov esi, loadedbmpmsg
  2679 00001F45 E8D7EBFFFF          <1> 		call print
  2680 00001F4A E9AAEEFFFF          <1> 		jmp nwcmd
  2681                              <1> noguibmp:
  2682 00001F4F BE[5E1F0000]        <1> 		mov esi, warnguibmp
  2683 00001F54 E8C8EBFFFF          <1> 		call print
  2684 00001F59 E99BEEFFFF          <1> 		jmp nwcmd
  2685 00001F5E 546869732063616E20- <1> warnguibmp db "This can not be done without the gui.",10,13,0
  2686 00001F67 6E6F7420626520646F- <1>
  2687 00001F70 6E6520776974686F75- <1>
  2688 00001F79 742074686520677569- <1>
  2689 00001F82 2E0A0D00            <1>
  2690                              <1> 
  2691                              <1> 		
  2692                              <1> filenotfound:
  2693 00001F86 BE[AF1F0000]        <1> 		mov esi, filenf
  2694 00001F8B E891EBFFFF          <1> 		call print
  2695 00001F90 BE[701A0000]        <1> 		mov esi, buftxt
  2696 00001F95 81C608000000        <1> 		add esi, 8
  2697 00001F9B E881EBFFFF          <1> 		call print
  2698 00001FA0 BE[BA1F0000]        <1> 		mov esi, filenf2
  2699 00001FA5 E877EBFFFF          <1> 		call print
  2700 00001FAA E94AEEFFFF          <1> 		jmp nwcmd
  2701 00001FAF 5468652066696C6520- <1> filenf db "The file ",34,0
  2702 00001FB8 2200                <1>
  2703 00001FBA 2220636F756C64206E- <1> filenf2 db 34," could not be found.",13,10,0
  2704 00001FC3 6F7420626520666F75- <1>
  2705 00001FCC 6E642E0D0A00        <1>
  2706                              <1> 		
  2707 00001FD2 206C6F616465642E0D- <1> loadedbmpmsg db " loaded.",13,10,0
  2708 00001FDB 0A00                <1>
  2709                              <1> 
  2710 00001FDD 050464756D7000      <1> 	db 5,4,"dump",0
  2711 00001FE4 BE[701A0000]        <1> 	mov esi, buftxt
  2712 00001FE9 81C605000000        <1> 	add esi, 5
  2713 00001FEF B900000000          <1> 	mov ecx, 0
  2714 00001FF4 E80BF3FFFF          <1> 	call cnvrttxt
  2715 00001FF9 89CF                <1> 	mov edi, ecx
  2716 00001FFB 89FE                <1> 	mov esi, edi
  2717 00001FFD 81C680030000        <1> 	add esi, 896
  2718 00002003 C605[D3110000]00    <1> 	mov byte [firsthexshown],0
  2719                              <1> dumphexloop:
  2720 0000200A 8B0F                <1> 	mov ecx, [edi]
  2721 0000200C E8C3F1FFFF          <1> 	call showhex
  2722 00002011 81C704000000        <1> 	add edi, 4
  2723 00002017 39F7                <1> 	cmp edi, esi
  2724 00002019 72EF                <1> 	jb dumphexloop
  2725 0000201B E9D9EDFFFF          <1> 	jmp nwcmd
  2726                              <1> 
  2727 00002020 050474696D6500      <1> db 5,4,"time",0
  2728 00002027 E823000000          <1> 	call time
  2729 0000202C BE[76210000]        <1> 	mov esi, timeshow
  2730 00002031 E8EBEAFFFF          <1> 	call print
  2731 00002036 BE[06400000]        <1> 	mov esi, line
  2732 0000203B E8E1EAFFFF          <1> 	call print
  2733 00002040 BE[80210000]        <1> 	mov esi, dateshow
  2734 00002045 E8D7EAFFFF          <1> 	call print
  2735 0000204A E9AAEDFFFF          <1> 	jmp nwcmd
  2736                              <1> time:
  2737 0000204F E8AD000000          <1> 	call tstackput1
  2738 00002054 B00A                <1> 	mov al,10			;Get RTC register A
  2739 00002056 E8D7000000          <1> 	call tget1
  2740 0000205B A880                <1> 	test al,0x80			;Is update in progress?
  2741 0000205D 75F0                <1> 	jne time				; yes, wait
  2742                              <1> 
  2743 0000205F B000                <1> 	mov al,0			;Get seconds (00 to 59)
  2744 00002061 E8CC000000          <1> 	call tget1
  2745 00002066 A2[70210000]        <1> 	mov [RTCtimeSecond],al
  2746                              <1> 
  2747 0000206B B002                <1> 	mov al,0x02			;Get minutes (00 to 59)
  2748 0000206D E8C0000000          <1> 	call tget1
  2749 00002072 A2[71210000]        <1> 	mov [RTCtimeMinute],al
  2750                              <1> 
  2751 00002077 B004                <1> 	mov al,0x04			;Get hours (see notes)
  2752 00002079 E8B4000000          <1> 	call tget1
  2753 0000207E A2[72210000]        <1> 	mov [RTCtimeHour],al
  2754                              <1> 
  2755 00002083 B007                <1> 	mov al,0x07			;Get day of month (01 to 31)
  2756 00002085 E8A8000000          <1> 	call tget1
  2757 0000208A A2[73210000]        <1> 	mov [RTCtimeDay],al
  2758                              <1> 
  2759 0000208F B008                <1> 	mov al,0x08			;Get month (01 to 12)
  2760 00002091 E89C000000          <1> 	call tget1
  2761 00002096 A2[74210000]        <1> 	mov [RTCtimeMonth],al
  2762                              <1> 
  2763 0000209B B009                <1> 	mov al,0x09			;Get year (00 to 99)
  2764 0000209D E890000000          <1> 	call tget1
  2765 000020A2 A2[75210000]        <1> 	mov [RTCtimeYear],al
  2766                              <1> 	
  2767 000020A7 BE[76210000]        <1> 	mov esi, timeshow
  2768 000020AC 8A2D[72210000]      <1> 	mov ch, [RTCtimeHour]
  2769 000020B2 E886000000          <1> 	call tput1
  2770 000020B7 8A2D[71210000]      <1> 	mov ch, [RTCtimeMinute]
  2771 000020BD E87B000000          <1> 	call tput1
  2772 000020C2 8A2D[70210000]      <1> 	mov ch, [RTCtimeSecond]
  2773 000020C8 E870000000          <1> 	call tput1
  2774 000020CD BE[80210000]        <1> 	mov esi, dateshow
  2775 000020D2 8A2D[74210000]      <1> 	mov ch, [RTCtimeMonth]
  2776 000020D8 E860000000          <1> 	call tput1
  2777 000020DD 8A2D[73210000]      <1> 	mov ch, [RTCtimeDay]
  2778 000020E3 E855000000          <1> 	call tput1
  2779 000020E8 B520                <1> 	mov ch, 0x20
  2780 000020EA E84E000000          <1> 	call tput1
  2781 000020EF 4E                  <1> 	dec esi
  2782 000020F0 8A2D[75210000]      <1> 	mov ch, [RTCtimeYear]
  2783 000020F6 E842000000          <1> 	call tput1
  2784 000020FB E81B000000          <1> 	call tstackget1
  2785 00002100 C3                  <1> 	ret
  2786                              <1> 	
  2787                              <1> tstackput1:
  2788 00002101 8935[6C210000]      <1> 	mov [tstack + 20], esi
  2789 00002107 BE[58210000]        <1> 	mov esi, tstack
  2790 0000210C 8906                <1> 	mov [esi], eax
  2791 0000210E 895E04              <1> 	mov [esi + 4], ebx
  2792 00002111 894E08              <1> 	mov [esi + 8], ecx
  2793 00002114 89560C              <1> 	mov [esi + 12], edx
  2794 00002117 897E10              <1> 	mov [esi + 16], edi
  2795 0000211A C3                  <1> 	ret
  2796                              <1> 	
  2797                              <1> tstackget1:
  2798 0000211B BE[58210000]        <1> 	mov esi, tstack
  2799 00002120 8B06                <1> 	mov eax, [esi]
  2800 00002122 8B5E04              <1> 	mov ebx, [esi + 4]
  2801 00002125 8B4E08              <1> 	mov ecx, [esi + 8]
  2802 00002128 8B560C              <1> 	mov edx, [esi + 12]
  2803 0000212B 8B7E10              <1> 	mov edi, [esi + 16]
  2804 0000212E 8B7614              <1> 	mov esi, [esi + 20]
  2805 00002131 C3                  <1> 	ret
  2806                              <1> 	
  2807                              <1> tget1:
  2808 00002132 66BA7000            <1> 	mov dx, 0x70
  2809 00002136 EE                  <1> 	out dx, al
  2810 00002137 6642                <1> 	inc dx
  2811 00002139 EC                  <1> 	in al, dx
  2812 0000213A 664A                <1> 	dec dx
  2813 0000213C C3                  <1> 	ret
  2814                              <1> 	
  2815                              <1> tput1:
  2816 0000213D 66C1E904            <1> 	shr cx, 4
  2817 00002141 B030                <1> 	mov al, 48
  2818 00002143 00E8                <1> 	add al, ch
  2819 00002145 8806                <1> 	mov [esi], al
  2820 00002147 46                  <1> 	inc esi
  2821 00002148 B030                <1> 	mov al, 48
  2822 0000214A C0E904              <1> 	shr cl, 4
  2823 0000214D 00C8                <1> 	add al, cl
  2824 0000214F 8806                <1> 	mov [esi], al
  2825 00002151 81C602000000        <1> 	add esi, 2
  2826 00002157 C3                  <1> 	ret
  2827                              <1> 		
  2828 00002158 000000000000000000- <1> 	tstack dd 0,0,0,0,0,0
  2829 00002161 000000000000000000- <1>
  2830 0000216A 000000000000        <1>
  2831 00002170 00                  <1> 	RTCtimeSecond db 0
  2832 00002171 00                  <1> 	RTCtimeMinute db 0
  2833 00002172 00                  <1> 	RTCtimeHour db 0
  2834 00002173 00                  <1> 	RTCtimeDay db 0
  2835 00002174 00                  <1> 	RTCtimeMonth db 0
  2836 00002175 00                  <1> 	RTCtimeYear db 0
  2837 00002176 30303A30303A303000- <1> 	timeshow db "00:00:00",0,0
  2838 0000217F 00                  <1>
  2839 00002180 30302D30302D303030- <1> 	dateshow db "00-00-0000",13,10,0
  2840 00002189 300D0A00            <1>
  2841                              <1> 
  2842 0000218D 0504637075696400    <1> db 5,4,"cpuid",0
  2843 00002195 B800000000          <1> 	mov eax, 0
  2844 0000219A 0FA2                <1> 	cpuid
  2845 0000219C 891D[F1210000]      <1> 	mov [cpuidbuf], ebx
  2846 000021A2 8915[F5210000]      <1> 	mov [cpuidbuf + 4], edx
  2847 000021A8 890D[F9210000]      <1> 	mov [cpuidbuf + 8], ecx
  2848 000021AE BE[F1210000]        <1> 	mov esi, cpuidbuf
  2849 000021B3 E869E9FFFF          <1> 	call print
  2850 000021B8 BE[06400000]        <1> 	mov esi, line
  2851 000021BD E85FE9FFFF          <1> 	call print
  2852 000021C2 B801000000          <1> 	mov eax, 1
  2853 000021C7 0FA2                <1> 	cpuid
  2854 000021C9 89C1                <1> 	mov ecx, eax
  2855 000021CB C605[D3110000]02    <1> 	mov byte [firsthexshown], 2
  2856 000021D2 E8FDEFFFFF          <1> 	call showhex
  2857 000021D7 B808000080          <1> 	mov eax, 0x80000008
  2858 000021DC 0FA2                <1> 	cpuid
  2859 000021DE 89C1                <1> 	mov ecx, eax
  2860 000021E0 C605[D3110000]02    <1> 	mov byte [firsthexshown], 2
  2861 000021E7 E8E8EFFFFF          <1> 	call showhex
  2862 000021EC E908ECFFFF          <1> 	jmp nwcmd
  2863                              <1> 	
  2864 000021F1 00<rept>            <1> cpuidbuf times 13 db 0
  2865                              <1> cpuidvendorend:
  2866                              <1> progend:		;programs end here	
  2867                              <1> batchprogend:
  2868                                      %include 'source/input.asm'
  2869                              <1> PS2SET:
  2870 000021FE B0A8                <1>   mov  al, 0xa8		; enable mouse port
  2871 00002200 E664                <1>   out  0x64, al		; write to keyboardcontroller
  2872 00002202 E801000000          <1>   call CHKPRT		; check if command is progressed (demand!)
  2873 00002207 C3                  <1> ret
  2874                              <1> 
  2875                              <1> ;***********************************************************************
  2876                              <1> ;Check if command is accepted. (not got stuck in inputbuffer)
  2877                              <1> ;***********************************************************************
  2878                              <1> CHKPRT:
  2879 00002208 66B96400            <1>   mov  cx, 100
  2880                              <1>  .again:
  2881 0000220C E464                <1>   in   al, 0x64		; read from keyboardcontroller
  2882 0000220E A802                <1>   test al, 2		; Check if input buffer is empty
  2883 00002210 7402                <1>   je .go
  2884 00002212 E2F8                <1>   loop .again
  2885                              <1>  .go:
  2886 00002214 C3                  <1> ret
  2887                              <1> 
  2888                              <1> ;***********************************************************************
  2889                              <1> ;Write to mouse
  2890                              <1> ;***********************************************************************
  2891                              <1> WMOUS:
  2892 00002215 B0D4                <1>   mov  al, 0xd4		; write to mouse device instead of to keyboard
  2893 00002217 E664                <1>   out  0x64, al		; write to keyboardcontroller
  2894 00002219 E8EAFFFFFF          <1>   call CHKPRT		; check if command is progressed (demand!)
  2895 0000221E C3                  <1> ret
  2896                              <1> 
  2897                              <1> 
  2898                              <1> 
  2899                              <1> ;***********************************************************************
  2900                              <1> ;mouse output buffer full
  2901                              <1> ;***********************************************************************
  2902                              <1> MBUFFUL:
  2903 0000221F 66B96400            <1>   mov cx, 100
  2904                              <1>  .mn:
  2905 00002223 E464                <1>   in   al, 0x64		; read from keyboardcontroller
  2906 00002225 A820                <1>   test al, 0x20		; check if mouse output buffer is full
  2907 00002227 7402                <1>   jz  .mnn
  2908 00002229 E2F8                <1>   loop .mn
  2909                              <1>  .mnn:
  2910 0000222B C3                  <1> ret
  2911                              <1> 
  2912                              <1> 
  2913                              <1> ;***********************************************************************
  2914                              <1> ;Write activate Mouse HardWare
  2915                              <1> ;***********************************************************************
  2916                              <1> ACTMOUS:
  2917 0000222C E8E4FFFFFF          <1>   call WMOUS
  2918 00002231 B0F4                <1>   mov  al, 0xf4 	; Command to activate mouse itselve (Stream mode)
  2919 00002233 E660                <1>   out  0x60, al		; write ps/2 controller output port (activate mouse)
  2920 00002235 E8CEFFFFFF          <1>   call CHKPRT		; check if command is progressed (demand!)
  2921 0000223A E801000000          <1>   call CHKMOUS		; check if a byte is available
  2922 0000223F C3                  <1> ret
  2923                              <1> 
  2924                              <1> ;***********************************************************************
  2925                              <1> ;Check if mouse has info for us
  2926                              <1> ;***********************************************************************
  2927                              <1> CHKMOUS:
  2928 00002240 B300                <1>   mov  bl, 0
  2929 00002242 66B96400            <1>   mov cx, 100
  2930                              <1>  .vrd:
  2931 00002246 E464                <1>   in   al, 0x64		; read from keyboardcontroller
  2932 00002248 A801                <1>   test al, 1		; check if controller buffer (60h) has data
  2933 0000224A 7504                <1>   jnz .yy
  2934 0000224C E2F8                <1>   loop .vrd
  2935 0000224E B301                <1>   mov  bl, 1
  2936                              <1>  .yy:
  2937 00002250 C3                  <1> ret
  2938                              <1> 
  2939                              <1> ;***********************************************************************
  2940                              <1> ;Get Mouse Byte
  2941                              <1> ;***********************************************************************
  2942                              <1> GETB:
  2943                              <1>  .cagain:
  2944 00002251 E8EAFFFFFF          <1>   call CHKMOUS		; check if a byte is available
  2945 00002256 08DB                <1>   or bl, bl
  2946 00002258 75F7                <1>   jnz .cagain
  2947 0000225A B0AD                <1>   mov  al, 0xad		; Disable Keyboard
  2948 0000225C E664                <1>   out  0x64, al		; write to keyboardcontroller
  2949 0000225E E8A5FFFFFF          <1>   call CHKPRT		; check if command is progressed (demand!)
  2950 00002263 6631C0              <1>   xor  ax, ax
  2951 00002266 E460                <1>   in   al, 0x60		; read ps/2 controller output port (mousebyte)
  2952 00002268 88C2                <1>   mov  dl, al
  2953 0000226A B0AE                <1>   mov  al, 0xae		; Enable Keyboard
  2954 0000226C E664                <1>   out  0x64, al		; write to keyboardcontroller
  2955 0000226E E895FFFFFF          <1>   call CHKPRT		; check if command is progressed (demand!)
  2956 00002273 88D0                <1>   mov  al, dl
  2957 00002275 C3                  <1> ret
  2958                              <1> 
  2959 00002276 00                  <1> LBUTTON db 0x00	;	Left   button status 1=PRESSED 0=RELEASED
  2960 00002277 00                  <1> RBUTTON db 0x00	;	Right  button status 1=PRESSED 0=RELEASED
  2961 00002278 00                  <1> MBUTTON db 0x00	;	Middle button status 1=PRESSED 0=RELEASED
  2962 00002279 00                  <1> XCOORD  db 0x00	;	the moved distance  (horizontal)
  2963 0000227A 00                  <1> YCOORD  db 0x00	;	the moved distance  (vertical)
  2964                              <1> 
  2965                              <1> 
  2966                              <1> 	guistartin:
  2967 0000227B B800000000          <1> 		mov eax, 0
  2968 00002280 66A3[EE0A0000]      <1> 		mov [lastkey], ax
  2969 00002286 E464                <1> 		in al, 64h ; Status
  2970 00002288 A801                <1> 		test al, 1 ; output buffer full?
  2971 0000228A 74EF                <1> 		jz guistartin
  2972 0000228C A820                <1> 		test al, 20h ; PS2-Mouse?
  2973 0000228E 0F85E2000000        <1> 		jnz near maincall2
  2974 00002294 E460                <1> 		in al, 60h
  2975 00002296 88C4                <1> 		mov ah, al
  2976 00002298 B000                <1> 		mov al, 0
  2977 0000229A 8825[EF0A0000]      <1> 		mov [lastkey + 1], ah
  2978 000022A0 88E0                <1> 		mov al, ah
  2979 000022A2 BF[AD250000]        <1> 		mov edi, scancode
  2980                              <1> 	guisearchscan: 
  2981 000022A7 3C40                <1> 		cmp al, 40h
  2982 000022A9 7315                <1> 		jae guiscanother
  2983 000022AB B400                <1> 		mov ah, 0
  2984 000022AD D0E0                <1> 		shl al, 1
  2985 000022AF 01C7                <1> 		add edi, eax
  2986 000022B1 D0E8                <1> 		shr al, 1
  2987 000022B3 8A27                <1> 		mov ah, [edi]
  2988 000022B5 80FC00              <1> 		cmp ah, 0
  2989 000022B8 7406                <1> 		je guiscanother
  2990 000022BA E964000000          <1> 		jmp guiscanfound
  2991 000022BF 00                  <1> guiupper db 0
  2992                              <1> guiscanother:
  2993 000022C0 88C4                <1> 		mov ah, al
  2994 000022C2 B000                <1> 		mov al, 0
  2995 000022C4 66A3[EE0A0000]      <1> 		mov [lastkey], ax
  2996                              <1> 		;cmp ah, 4Dh
  2997                              <1> 		;je near nextimage
  2998 000022CA 80FC2A              <1> 		cmp ah, 2Ah
  2999 000022CD 0F8437000000        <1> 		je near guishifton
  3000 000022D3 80FC36              <1> 		cmp ah, 36h
  3001 000022D6 0F842E000000        <1> 		je near guishifton
  3002 000022DC 80FC1C              <1> 		cmp ah, 1Ch
  3003 000022DF 0F843D000000        <1> 		je near guientdown
  3004 000022E5 80FCAA              <1> 		cmp ah, 0AAh
  3005 000022E8 0F8428000000        <1> 		je near guishiftoff
  3006 000022EE 80FCB6              <1> 		cmp ah, 0B6h
  3007 000022F1 0F841F000000        <1> 		je near guishiftoff
  3008 000022F7 80FC3A              <1> 		cmp ah, 3Ah
  3009 000022FA 0F8401000000        <1> 		je near guishift
  3010 00002300 C3                  <1> 		ret
  3011                              <1> 	guishift:
  3012 00002301 A0[BF220000]        <1> 		mov al, [guiupper]
  3013 00002306 3C01                <1> 		cmp al, 1
  3014 00002308 730C                <1> 		jae guishiftoff
  3015                              <1> 	guishifton:
  3016 0000230A C605[BF220000]01    <1> 		mov byte [guiupper], 1
  3017 00002311 E965FFFFFF          <1> 		jmp guistartin
  3018                              <1> 	guishiftoff:
  3019 00002316 C605[BF220000]00    <1> 		mov byte [guiupper], 0
  3020 0000231D E959FFFFFF          <1> 		jmp guistartin
  3021                              <1> 	guientdown:
  3022 00002322 C3                  <1> 		ret
  3023                              <1> 	guiscanfound:
  3024 00002323 81C701000000        <1> 		add edi, 1
  3025 00002329 803D[BF220000]01    <1> 		cmp byte [guiupper], 1
  3026 00002330 7306                <1> 		jae uppercasegui
  3027 00002332 81EF01000000        <1> 		sub edi, 1
  3028                              <1> uppercasegui:
  3029 00002338 8A07                <1> 		mov al,[edi]
  3030 0000233A A2[EE0A0000]        <1> 		mov [lastkey], al
  3031 0000233F C3                  <1> 		ret
  3032                              <1> 		
  3033                              <1> 		
  3034                              <1> 	cursorgui:
  3035 00002340 803D[2D380000]01    <1> 		cmp byte [mouseon], 1
  3036 00002347 0F8429000000        <1> 		je near maincall2
  3037 0000234D 803D[BA270000]00    <1> 		cmp byte [guion], 0
  3038 00002354 0F84C8FFFFFF        <1> 		je near guientdown
  3039                              <1> 	initmouse:
  3040 0000235A E828050000          <1> 		call switchmousepos2
  3041 0000235F E89AFEFFFF          <1> 	  	call PS2SET
  3042 00002364 E8C3FEFFFF          <1> 		call ACTMOUS
  3043 00002369 C605[2D380000]01    <1> 		mov byte [mouseon],1
  3044 00002370 E8DCFEFFFF          <1> 		call GETB 	;;Get the responce byte of the mouse (like: Hey i am active)
  3045                              <1> 				;;If the bytes are mixed up,
  3046                              <1> 				;;remove this line or add another of this line.
  3047                              <1> 		;call GETB
  3048 00002375 C3                  <1> 		ret
  3049                              <1> 	maincall2:
  3050 00002376 803D[2D380000]01    <1> 		  cmp byte [mouseon], 1
  3051 0000237D 75DB                <1> 		  jne initmouse
  3052 0000237F E8CDFEFFFF          <1> 		  call GETB
  3053 00002384 88C3                <1> 		  mov  bl, al
  3054 00002386 80E301              <1> 		  and  bl, 1
  3055 00002389 881D[76220000]      <1> 		  mov  BYTE [LBUTTON], bl
  3056 0000238F 88C3                <1> 		  mov  bl, al
  3057 00002391 80E302              <1> 		  and  bl, 2
  3058 00002394 D0EB                <1> 		  shr  bl, 1
  3059 00002396 881D[77220000]      <1> 		  mov  BYTE [RBUTTON], bl
  3060 0000239C 88C3                <1> 		  mov  bl, al
  3061 0000239E 80E304              <1> 		  and  bl, 4
  3062 000023A1 C0EB02              <1> 		  shr  bl, 2
  3063 000023A4 881D[78220000]      <1> 		  mov  BYTE [MBUTTON], bl
  3064 000023AA E8A2FEFFFF          <1> 		  call GETB
  3065 000023AF A2[79220000]        <1> 		  mov  BYTE [XCOORD], al
  3066 000023B4 E898FEFFFF          <1> 		  call GETB
  3067 000023B9 A2[7A220000]        <1> 		  mov  BYTE [YCOORD], al
  3068                              <1> 
  3069                              <1> 	showpixelcursor:
  3070 000023BE 668B15[0B250000]    <1> 		mov dx, [mousecursorposition]
  3071 000023C5 668B0D[0D250000]    <1> 		mov cx, [mousecursorposition + 2]
  3072 000023CC 668915[07250000]    <1> 		mov [lastmouseposition], dx
  3073 000023D3 66890D[09250000]    <1> 		mov [lastmouseposition + 2], cx
  3074 000023DA A0[79220000]        <1> 		mov al, [XCOORD]
  3075 000023DF 3C80                <1> 		cmp al, 128
  3076 000023E1 730C                <1> 		jae subxcoord
  3077 000023E3 00C0                <1> 		add al, al
  3078 000023E5 B400                <1> 		mov ah, 0
  3079 000023E7 6601C2              <1> 		add dx, ax
  3080 000023EA E90B000000          <1> 		jmp subxcoorddn
  3081                              <1> 	subxcoord:
  3082 000023EF 00C0                <1> 		add al, al
  3083 000023F1 B300                <1> 		mov bl, 0
  3084 000023F3 28C3                <1> 		sub bl, al
  3085 000023F5 B700                <1> 		mov bh, 0
  3086 000023F7 6629DA              <1> 		sub dx, bx
  3087                              <1> 	subxcoorddn:
  3088 000023FA 8A1D[7A220000]      <1> 		mov bl, [YCOORD]
  3089 00002400 B000                <1> 		mov al, 0
  3090 00002402 28D8                <1> 		sub al, bl
  3091 00002404 3C80                <1> 		cmp al, 128
  3092 00002406 730A                <1> 		jae subycoord
  3093 00002408 B400                <1> 		mov ah, 0
  3094 0000240A 6601C1              <1> 		add cx, ax
  3095 0000240D E909000000          <1> 		jmp subycoorddn
  3096                              <1> 	subycoord:
  3097 00002412 B300                <1> 		mov bl, 0
  3098 00002414 28C3                <1> 		sub bl, al
  3099 00002416 B700                <1> 		mov bh, 0
  3100 00002418 6629D9              <1> 		sub cx, bx
  3101                              <1> 	subycoorddn:
  3102 0000241B 6681FA204E          <1> 		cmp dx, 20000
  3103 00002420 7604                <1> 		jbe nooriginx2
  3104 00002422 66BA0000            <1> 		mov dx, 0
  3105                              <1> 	nooriginx2:
  3106 00002426 6681F9204E          <1> 		cmp cx, 20000
  3107 0000242B 7604                <1> 		jbe nooriginy2
  3108 0000242D 66B90000            <1> 		mov cx, 0
  3109                              <1> 	nooriginy2:
  3110 00002431 6681FA0000          <1> 		cmp dx, 0
  3111 00002436 7415                <1> 		je nofixxcolumn2
  3112 00002438 663B15[DA350000]    <1> 		cmp dx, [resolutionx2]
  3113 0000243F 720C                <1> 		jb nofixxcolumn2
  3114 00002441 668B15[DA350000]    <1> 		mov dx, [resolutionx2]
  3115 00002448 6681EA0200          <1> 		sub dx, 2
  3116                              <1> 	nofixxcolumn2:
  3117 0000244D 6681F90000          <1> 		cmp cx, 0
  3118 00002452 7415                <1> 		je nofixyrow2
  3119 00002454 663B0D[D6350000]    <1> 		cmp cx, [resolutiony]
  3120 0000245B 720C                <1> 		jb nofixyrow2
  3121 0000245D 668B0D[D6350000]    <1> 		mov cx, [resolutiony]
  3122 00002464 6681E90100          <1> 		sub cx, 1
  3123                              <1> 	nofixyrow2:
  3124 00002469 668915[0B250000]    <1> 		mov [mousecursorposition], dx
  3125 00002470 66890D[0D250000]    <1> 		mov [mousecursorposition + 2], cx
  3126 00002477 E8A2030000          <1> 		call switchmousepos ;;use dragging code to ensure proper icon drag
  3127 0000247C 803D[76220000]01    <1> 		cmp byte [LBUTTON], 1
  3128 00002483 0F847B040000        <1> 		je near clickicon
  3129 00002489 803D[77220000]01    <1> 		cmp byte [RBUTTON], 1
  3130 00002490 0F846E040000        <1> 		je near clickicon
  3131 00002496 A0[F1280000]        <1> 		mov al, [pbutton]
  3132 0000249B C705[F4280000]0000- <1> 		mov dword [dragging], 0
  3133 000024A3 0000                <1>
  3134 000024A5 3C00                <1> 		cmp al, 0
  3135 000024A7 740F                <1> 		je nopreviousbutton
  3136 000024A9 E80D030000          <1> 		call clearmousecursor
  3137 000024AE E885090000          <1> 		call reloadallgraphics
  3138 000024B3 E8CF030000          <1> 		call switchmousepos2
  3139                              <1> 	nopreviousbutton:
  3140 000024B8 B000                <1> 		mov al, 0
  3141 000024BA A2[F1280000]        <1> 		mov [pbutton], al
  3142 000024BF A0[76220000]        <1> 		mov al, [LBUTTON]
  3143 000024C4 A2[F2280000]        <1> 		mov [pLBUTTON], al
  3144 000024C9 A0[77220000]        <1> 		mov al, [RBUTTON]
  3145 000024CE A2[F3280000]        <1> 		mov [pRBUTTON], al
  3146 000024D3 B900000000          <1> 		mov ecx, 0
  3147 000024D8 BA00000000          <1> 		mov edx, 0
  3148 000024DD 668B15[0B250000]    <1> 		mov dx, [mousecursorposition]
  3149 000024E4 668B0D[0D250000]    <1> 		mov cx, [mousecursorposition + 2]
  3150 000024EB 66BB9CE7            <1> 		mov bx, 1110011110011100b
  3151 000024EF B400                <1> 		mov ah, 0
  3152 000024F1 B080                <1> 		mov al, 128
  3153 000024F3 C605[B7270000]01    <1> 		mov byte [showcursorfonton], 1
  3154 000024FA E8EB100000          <1> 		call showfontvesa
  3155 000024FF C605[B7270000]00    <1> 		mov byte [showcursorfonton], 0
  3156 00002506 C3                  <1> 		ret
  3157                              <1> 
  3158 00002507 84008400            <1> lastmouseposition dw 132,132
  3159 0000250B 84008400            <1> mousecursorposition dw 132,132	
  3160                              <1> 
  3161                              <1> termmouse:
  3162 0000250F C3                  <1> 	ret	;;lets try this later
  3163 00002510 BE[851C0000]        <1> 		mov esi, videobuf2
  3164 00002515 BA00000000          <1> 		mov edx, 0
  3165 0000251A 668B15[07250000]    <1> 		mov dx, [lastmouseposition]
  3166 00002521 668B0D[09250000]    <1> 		mov cx, [lastmouseposition + 2]
  3167 00002528 66A1[AB250000]      <1> 		mov ax, [cursorcache]
  3168 0000252E 663D0000            <1> 		cmp ax, 0
  3169 00002532 7426                <1> 		je nocopycursorcache
  3170 00002534 66C1E104            <1> 		shl cx, 4
  3171 00002538 66C1E203            <1> 		shl dx, 3
  3172 0000253C 01D6                <1> 		add esi, edx
  3173 0000253E 66BA0000            <1> 		mov dx, 0
  3174 00002542 8A15[47090000]      <1> 		mov dl, [charxy]
  3175 00002548 6641                <1> 		inc cx
  3176                              <1> termmousecplp1:
  3177 0000254A 01D6                <1> 		add esi, edx
  3178 0000254C 6649                <1> 		dec cx
  3179 0000254E 6681F90000          <1> 		cmp cx, 0
  3180 00002553 75F5                <1> 		jne termmousecplp1
  3181 00002555 29D6                <1> 		sub esi, edx
  3182 00002557 668906              <1> 		mov [esi], ax
  3183                              <1> nocopycursorcache:
  3184 0000255A BE[851C0000]        <1> 		mov esi, videobuf2
  3185 0000255F BA00000000          <1> 		mov edx, 0
  3186 00002564 668B15[0B250000]    <1> 		mov dx, [mousecursorposition]
  3187 0000256B 668B0D[0D250000]    <1> 		mov cx, [mousecursorposition + 2]
  3188 00002572 66C1E104            <1> 		shl cx, 4
  3189 00002576 66C1E203            <1> 		shl dx, 3
  3190 0000257A 01D6                <1> 		add esi, edx
  3191 0000257C 66BA0000            <1> 		mov dx, 0
  3192 00002580 8A15[47090000]      <1> 		mov dl, [charxy]
  3193 00002586 6641                <1> 		inc cx
  3194                              <1> termmousecplp2:
  3195 00002588 01D6                <1> 		add esi, edx
  3196 0000258A 6649                <1> 		dec cx
  3197 0000258C 6681F90000          <1> 		cmp cx, 0
  3198 00002591 75F5                <1> 		jne termmousecplp2
  3199 00002593 29D6                <1> 		sub esi, edx
  3200 00002595 668B06              <1> 		mov ax, [esi]
  3201 00002598 66A3[AB250000]      <1> 		mov [cursorcache], ax
  3202 0000259E B080                <1> 		mov al, 128
  3203 000025A0 B407                <1> 		mov ah, 7
  3204 000025A2 668906              <1> 		mov [esi], ax
  3205 000025A5 E86CE6FFFF          <1> 		call termcopy
  3206 000025AA C3                  <1> 		ret
  3207 000025AB 0000                <1> cursorcache db 0,0
  3208                              <1> 	
  3209                              <1> scancode:
  3210 000025AD 0000                <1> 	db 0,0		;,0h
  3211 000025AF 0000                <1> 	db 0,0		;,1h
  3212 000025B1 3121                <1> 	db '1','!'	;,2h
  3213 000025B3 3240                <1> 	db '2','@'	;,3h
  3214 000025B5 3323                <1> 	db '3','#'	;,4h
  3215 000025B7 3424                <1> 	db '4','$'	;,5h
  3216 000025B9 3525                <1> 	db '5','%'	;,6h
  3217 000025BB 365E                <1> 	db '6','^'	;,7h
  3218 000025BD 3726                <1> 	db '7','&'	;,8h
  3219 000025BF 382A                <1> 	db '8','*'	;,9h
  3220 000025C1 3928                <1> 	db '9','('	;,0Ah
  3221 000025C3 3029                <1> 	db '0',')'	;,0Bh
  3222 000025C5 2D5F                <1> 	db '-','_'	;,0Ch
  3223 000025C7 3D2B                <1> 	db '=','+'	;,0Dh
  3224 000025C9 0808                <1> 	db 8,8		;,0Eh
  3225 000025CB 0000                <1> 	db 0,0		;,0Fh
  3226 000025CD 7151                <1> 	db 'q','Q'	;,10h
  3227 000025CF 7757                <1> 	db 'w','W'	;,11h
  3228 000025D1 6545                <1> 	db 'e','E'	;,12h
  3229 000025D3 7252                <1> 	db 'r','R'	;,13h
  3230 000025D5 7454                <1> 	db 't','T'	;,14h
  3231 000025D7 7959                <1> 	db 'y','Y'	;,15h
  3232 000025D9 7555                <1> 	db 'u','U'	;,16h
  3233 000025DB 6949                <1> 	db 'i','I'	;,17h
  3234 000025DD 6F4F                <1> 	db 'o','O'	;,18h
  3235 000025DF 7050                <1> 	db 'p','P'	;,19h
  3236 000025E1 5B7B                <1> 	db '[','{'	;,1Ah
  3237 000025E3 5D7D                <1> 	db ']','}'	;,1Bh
  3238 000025E5 0000                <1> 	db 0,0		;,1Ch
  3239 000025E7 0000                <1> 	db 0,0		;,1Dh
  3240 000025E9 6141                <1> 	db 'a','A'	;,1Eh
  3241 000025EB 7353                <1> 	db 's','S'	;,1Fh
  3242 000025ED 6444                <1> 	db 'd','D'	;,20h
  3243 000025EF 6646                <1> 	db 'f','F'	;,21h
  3244 000025F1 6747                <1> 	db 'g','G'	;,22h
  3245 000025F3 6848                <1> 	db 'h','H'	;,23h
  3246 000025F5 6A4A                <1> 	db 'j','J'	;,24h
  3247 000025F7 6B4B                <1> 	db 'k','K'	;,25h
  3248 000025F9 6C4C                <1> 	db 'l','L'	;,26h
  3249 000025FB 3B3A                <1> 	db ';',':'	;,27h
  3250 000025FD 2722                <1> 	db 27h,22h	;,28h
  3251 000025FF 607E                <1> 	db '`','~'	;,29h
  3252 00002601 0000                <1> 	db 0,0		;,2Ah
  3253 00002603 5C7C                <1> 	db '\','|'	;,2Bh
  3254 00002605 7A5A                <1> 	db 'z','Z'	;,2Ch
  3255 00002607 7858                <1> 	db 'x','X'	;,2Dh
  3256 00002609 6343                <1> 	db 'c','C'	;,2Eh
  3257 0000260B 7656                <1> 	db 'v','V'	;,2Fh
  3258 0000260D 6242                <1> 	db 'b','B'	;,30h
  3259 0000260F 6E4E                <1> 	db 'n','N'	;,31h
  3260 00002611 6D4D                <1> 	db 'm','M'	;,32h
  3261 00002613 2C3C                <1> 	db ',','<'	;,33h
  3262 00002615 2E3E                <1> 	db '.','>'	;,34h
  3263 00002617 2F3F                <1> 	db '/','?'	;,35h
  3264 00002619 0000                <1> 	db 0,0		;,36h
  3265 0000261B 0000                <1> 	db 0,0		;,37h
  3266 0000261D 0000                <1> 	db 0,0		;,38h
  3267 0000261F 2020                <1> 	db ' ',' '	;,39h
  3268                              <1> noscan:
  3269                                      %include 'source/gui.asm'
  3270                              <1> guiclear:
  3271 00002621 8B3D[714A0000]      <1> 	mov edi, [physbaseptr]
  3272 00002627 668B15[D8350000]    <1> 	mov dx, [resolutionx]
  3273 0000262E 668B0D[D6350000]    <1> 	mov cx, [resolutiony]
  3274 00002635 66A1[5E260000]      <1> 	mov ax, [background]
  3275                              <1> guiclearloop:
  3276 0000263B 668907              <1> 	mov [edi], ax
  3277 0000263E 81C702000000        <1> 	add edi, 2
  3278 00002644 664A                <1> 	dec dx
  3279 00002646 6681FA0000          <1> 	cmp dx, 0
  3280 0000264B 77EE                <1> 	ja guiclearloop
  3281 0000264D 6649                <1> 	dec cx
  3282 0000264F 668B15[D8350000]    <1> 	mov dx, [resolutionx]
  3283 00002656 6681F90000          <1> 	cmp cx, 0
  3284 0000265B 77DE                <1> 	ja guiclearloop
  3285 0000265D C3                  <1> 	ret
  3286                              <1> 
  3287 0000265E CF7B                <1> background dw 0111101111001111b
  3288                              <1> 
  3289                              <1> gui:	;Let's see what I can do, I am going to try to make this as freestanding as possible
  3290 00002660 B800000000          <1> 	mov eax, 0
  3291 00002665 BB00000000          <1> 	mov ebx, 0
  3292 0000266A B900000000          <1> 	mov ecx, 0
  3293 0000266F BA00000000          <1> 	mov edx, 0
  3294 00002674 8B3D[714A0000]      <1> 	mov edi, [physbaseptr]
  3295 0000267A 668B15[D8350000]    <1> 	mov dx, [resolutionx]
  3296 00002681 668B0D[D6350000]    <1> 	mov cx, [resolutiony]
  3297 00002688 668B1D[5E260000]    <1> 	mov bx, [background]
  3298                              <1> guiclearloop2:
  3299 0000268F 66891F              <1> 	mov [edi], bx
  3300 00002692 81C702000000        <1> 	add edi, 2
  3301 00002698 664A                <1> 	dec dx
  3302 0000269A 6681FA0000          <1> 	cmp dx, 0
  3303 0000269F 0F85EAFFFFFF        <1> 	jne near guiclearloop2
  3304 000026A5 6649                <1> 	dec cx
  3305 000026A7 668B15[D8350000]    <1> 	mov dx, [resolutionx]
  3306 000026AE 6681F90000          <1> 	cmp cx, 0
  3307 000026B3 0F85D6FFFFFF        <1> 	jne near guiclearloop2
  3308 000026B9 C605[BA270000]01    <1> 	mov byte [guion], 1
  3309 000026C0 C605[B9270000]00    <1> 	mov byte [mouseselecton], 0
  3310 000026C7 B800000000          <1> 	mov eax, 0
  3311 000026CC BB00000000          <1> 	mov ebx, 0
  3312 000026D1 B900000000          <1> 	mov ecx, 0
  3313 000026D6 BA00000000          <1> 	mov edx, 0
  3314                              <1> 	
  3315 000026DB BE[42380000]        <1> 	mov esi, pacmsg
  3316 000026E0 66B80000            <1> 	mov ax, 0
  3317 000026E4 BB00000000          <1> 	mov ebx, 0
  3318 000026E9 66B90200            <1> 	mov cx, 2
  3319 000026ED 66BA0400            <1> 	mov dx, 4
  3320 000026F1 E8880A0000          <1> 	call showstring
  3321                              <1> 	
  3322 000026F6 BE[58390000]        <1> 	mov esi, interneticon
  3323 000026FB 66B80000            <1> 	mov ax, 0
  3324 000026FF BB[B7380000]        <1> 	mov ebx, noie
  3325 00002704 66B91800            <1> 	mov cx, 24
  3326 00002708 66BA0400            <1> 	mov dx, 4
  3327 0000270C E8EC0D0000          <1> 	call showicon
  3328                              <1> 	
  3329 00002711 BE[DA390000]        <1> 	mov esi, wordicon
  3330 00002716 66B80000            <1> 	mov ax, 0
  3331 0000271A BB00000000          <1> 	mov ebx, 0
  3332 0000271F 66B91800            <1> 	mov cx, 24
  3333 00002723 66BA3000            <1> 	mov dx, 48
  3334 00002727 E8D10D0000          <1> 	call showicon
  3335                              <1> 	
  3336 0000272C BE[5C3A0000]        <1> 	mov esi, pacmanpellet
  3337 00002731 66B80000            <1> 	mov ax, 0
  3338 00002735 BB00000000          <1> 	mov ebx, 0
  3339 0000273A 66B94000            <1> 	mov cx, 64
  3340 0000273E 66BA0400            <1> 	mov dx, 4
  3341 00002742 E8B60D0000          <1> 	call showicon
  3342                              <1> 	
  3343 00002747 BE[603B0000]        <1> 	mov esi, pacman
  3344 0000274C 66B80000            <1> 	mov ax, 0
  3345 00002750 BB[9C380000]        <1> 	mov ebx, pacmannomnom
  3346 00002755 66B94000            <1> 	mov cx, 64
  3347 00002759 66BA3000            <1> 	mov dx, 48
  3348 0000275D E89B0D0000          <1> 	call showicon
  3349                              <1> 	
  3350 00002762 BE[DE3A0000]        <1> 	mov esi, ghostie
  3351 00002767 66B80000            <1> 	mov ax, 0
  3352 0000276B BB[81380000]        <1> 	mov ebx, boo
  3353 00002770 66B96C00            <1> 	mov cx, 108
  3354 00002774 66BA0400            <1> 	mov dx, 4
  3355 00002778 E8800D0000          <1> 	call showicon
  3356                              <1> 
  3357 0000277D BE[2E380000]        <1> 	mov esi, start
  3358 00002782 668B0D[D6350000]    <1> 	mov cx, [resolutiony]
  3359 00002789 6681E91000          <1> 	sub cx, 16
  3360 0000278E 66BA0200            <1> 	mov dx, 2
  3361 00002792 B400                <1> 	mov ah, 0
  3362 00002794 B010                <1> 	mov al, 00010000b
  3363 00002796 BB[05390000]        <1> 	mov ebx, winblows
  3364 0000279B E8DE090000          <1> 	call showstring
  3365                              <1> 	
  3366 000027A0 E89BFBFFFF          <1> 	call cursorgui
  3367                              <1> guistart:
  3368 000027A5 E8D1FAFFFF          <1> 	call guistartin
  3369 000027AA C605[B3270000]00    <1> 	mov byte [copygui], 0
  3370 000027B1 EBF2                <1> 	jmp guistart
  3371                              <1> 	
  3372                              <1> ;guicopy:	;;for double buffering
  3373                              <1> ;	mov byte [copygui], 1
  3374                              <1> ;	mov edi, [offscreenmemoffset]
  3375                              <1> ;	mov edx, 0
  3376                              <1> ;	mov ecx, 0
  3377                              <1> ;	mov dx, [mousecursorposition]
  3378                              <1> ;	mov cx, [mousecursorposition + 2]
  3379                              <1> ;	add edi, edx
  3380                              <1> ;	mov dx, [resolutionx2]
  3381                              <1> ;	inc cx
  3382                              <1> ;guicp2:
  3383                              <1> ;	add edi, edx
  3384                              <1> ;	dec cx
  3385                              <1> ;	cmp cx, 0
  3386                              <1> ;	jne guicp2
  3387                              <1> ;	sub edi, edx
  3388                              <1> ;	mov [cursorloc], edi
  3389                              <1> ;	mov ebx, cursorbmp
  3390                              <1> ;	mov cx, [resolutiony]
  3391                              <1> ;	rol ecx, 16
  3392                              <1> ;	mov cx, [resolutionx]
  3393                              <1> ;	mov esi, [physbaseptr]
  3394                              <1> ;	mov edi, [offscreenmemoffset]
  3395                              <1> ;guicp1:
  3396                              <1> ;	mov ax, [esi]
  3397                              <1> ;	mov [edi], ax
  3398                              <1> ;	add esi, 2
  3399                              <1> ;	add edi, 2
  3400                              <1> ;	cmp edi, [cursorloc]
  3401                              <1> ;	je copycursor
  3402                              <1> ;dncopycursor:
  3403                              <1> ;	dec cx
  3404                              <1> ;	cmp cx, 0
  3405                              <1> ;	jne guicp1
  3406                              <1> ;	mov cx, [resolutionx]
  3407                              <1> ;	rol ecx, 16
  3408                              <1> ;	dec cx
  3409                              <1> ;	cmp cx, 0
  3410                              <1> ;	rol ecx, 16
  3411                              <1> ;	jne guicp1
  3412                              <1> ;	mov byte [copygui], 0
  3413                              <1> ;	ret
  3414                              <1> ;copycursor:
  3415                              <1> ;	cmp ebx, cursorbmpend
  3416                              <1> ;	jae dncopycursor
  3417                              <1> ;	mov dx, [resolutionx2]
  3418                              <1> ;	add edi, edx
  3419                              <1> ;	mov [cursorloc], edi
  3420                              <1> ;	sub edi, edx
  3421                              <1> ;	dec ebx
  3422                              <1> ;	sub edi, 2
  3423                              <1> ;	sub esi, 2
  3424                              <1> ;	mov dx, 9
  3425                              <1> ;curscplp:
  3426                              <1> ;	inc ebx
  3427                              <1> ;	add esi, 2
  3428                              <1> ;	add edi, 2
  3429                              <1> ;	mov ax, [esi]
  3430                              <1> ;	mov [edi], ax
  3431                              <1> ;	mov al, [ebx]
  3432                              <1> ;	cmp al, 0
  3433                              <1> ;	je curscplp2
  3434                              <1> ;	mov word [edi], 1110011110011100b
  3435                              <1> ;curscplp2:
  3436                              <1> ;	dec cx
  3437                              <1> ;	cmp cx, 0
  3438                              <1> ;	je dncopycursor
  3439                              <1> ;	dec dx
  3440                              <1> ;	cmp dx, 0
  3441                              <1> ;	jne curscplp
  3442                              <1> ;	jmp dncopycursor
  3443                              <1> 	
  3444                              <1> 	
  3445                              <1> ;cursorloc: dd 0
  3446                              <1> 		
  3447                              <1> ;nextimage:	
  3448                              <1> ;	call guiclear
  3449                              <1> ;	mov esi, [bmpend]
  3450                              <1> ;	mov eax, 0
  3451                              <1> ;	mov ebx, 0
  3452                              <1> ;	mov ecx, 0
  3453                              <1> ;	mov edx, 0
  3454                              <1> ;	call showbmp
  3455                              <1> ;	jmp guistartin
  3456                              <1> 		
  3457 000027B3 00                  <1> copygui db 0
  3458 000027B4 00                  <1> graphicsset db 0
  3459 000027B5 0000                <1> graphicspos db 0,0
  3460 000027B7 00                  <1> showcursorfonton db 0
  3461 000027B8 00                  <1> savefonton db 0
  3462 000027B9 00                  <1> mouseselecton db 0
  3463 000027BA 00                  <1> guion db 0
  3464                              <1> 
  3465                              <1> 		
  3466                              <1> clearmousecursor:
  3467 000027BB BE[5E260000]        <1> 		mov esi, background
  3468 000027C0 8B3D[714A0000]      <1> 		mov edi, [physbaseptr]
  3469 000027C6 BA00000000          <1> 		mov edx, 0
  3470 000027CB B900000000          <1> 		mov ecx, 0
  3471 000027D0 668B15[07250000]    <1> 		mov dx, [lastmouseposition]
  3472 000027D7 668B0D[09250000]    <1> 		mov cx, [lastmouseposition + 2]
  3473 000027DE 01D7                <1> 		add edi, edx
  3474 000027E0 BA00000000          <1> 		mov edx, 0
  3475 000027E5 668B15[DA350000]    <1> 		mov dx, [resolutionx2]
  3476 000027EC 6681F90000          <1> 		cmp cx, 0
  3477 000027F1 740B                <1> 		je noyclr
  3478 000027F3 01D7                <1> yclr:	add edi, edx
  3479 000027F5 6649                <1> 		dec cx
  3480 000027F7 6681F90000          <1> 		cmp cx, 0
  3481 000027FC 75F5                <1> 		jne yclr
  3482 000027FE 668B06              <1> noyclr:	mov ax, [esi]
  3483 00002801 C1C010              <1> 		rol eax, 16
  3484 00002804 668B06              <1> 		mov ax, [esi]
  3485 00002807 8907                <1> 		mov [edi], eax
  3486 00002809 894704              <1> 		mov [edi + 4], eax
  3487 0000280C 894708              <1> 		mov [edi + 8], eax
  3488 0000280F 89470C              <1> 		mov [edi + 12], eax
  3489 00002812 01D7                <1> 		add edi, edx
  3490 00002814 6641                <1> 		inc cx
  3491 00002816 6681F91000          <1> 		cmp cx, 16
  3492 0000281B 72E1                <1> 		jb noyclr
  3493 0000281D C3                  <1> 		ret
  3494                              <1> 
  3495                              <1> switchmousepos:		;;switch were the mouse is located
  3496 0000281E BE[00120000]        <1> 		mov esi, mousecolorbuf
  3497 00002823 8B3D[714A0000]      <1> 		mov edi, [physbaseptr]
  3498 00002829 BA00000000          <1> 		mov edx, 0
  3499 0000282E B900000000          <1> 		mov ecx, 0
  3500 00002833 668B15[07250000]    <1> 		mov dx, [lastmouseposition]
  3501 0000283A 668B0D[09250000]    <1> 		mov cx, [lastmouseposition + 2]
  3502 00002841 01D7                <1> 		add edi, edx
  3503 00002843 BA00000000          <1> 		mov edx, 0
  3504 00002848 668B15[DA350000]    <1> 		mov dx, [resolutionx2]
  3505 0000284F 6681F90000          <1> 		cmp cx, 0
  3506 00002854 740B                <1> 		je noswmsy
  3507 00002856 01D7                <1> swmsy:		add edi, edx
  3508 00002858 6649                <1> 		dec cx
  3509 0000285A 6681F90000          <1> 		cmp cx, 0
  3510 0000285F 75F5                <1> 		jne swmsy
  3511 00002861 8B06                <1> noswmsy:	mov eax, [esi]
  3512 00002863 8B5E04              <1> 		mov ebx, [esi + 4]
  3513 00002866 8907                <1> 		mov [edi], eax
  3514 00002868 895F04              <1> 		mov [edi + 4], ebx
  3515 0000286B 8B4608              <1> 		mov eax, [esi + 8]
  3516 0000286E 8B5E0C              <1> 		mov ebx, [esi + 12]
  3517 00002871 894708              <1> 		mov [edi + 8], eax
  3518 00002874 895F0C              <1> 		mov [edi + 12], ebx
  3519 00002877 01D7                <1> 		add edi, edx
  3520 00002879 81C610000000        <1> 		add esi, 16
  3521 0000287F 81FE[00130000]      <1> 		cmp esi, mcolorend
  3522 00002885 72DA                <1> 		jb noswmsy
  3523                              <1> 		
  3524                              <1> switchmousepos2:
  3525 00002887 BE[00120000]        <1> 		mov esi, mousecolorbuf
  3526 0000288C 8B3D[714A0000]      <1> 		mov edi, [physbaseptr]
  3527 00002892 BA00000000          <1> 		mov edx, 0
  3528 00002897 B900000000          <1> 		mov ecx, 0
  3529 0000289C 668B15[0B250000]    <1> 		mov dx, [mousecursorposition]
  3530 000028A3 668B0D[0D250000]    <1> 		mov cx, [mousecursorposition + 2]
  3531 000028AA 01D7                <1> 		add edi, edx
  3532 000028AC BA00000000          <1> 		mov edx, 0
  3533 000028B1 668B15[DA350000]    <1> 		mov dx, [resolutionx2]
  3534 000028B8 6681F90000          <1> 		cmp cx, 0
  3535 000028BD 740B                <1> 		je noswmsy2
  3536 000028BF 01D7                <1> swmsy2:		add edi, edx
  3537 000028C1 6649                <1> 		dec cx
  3538 000028C3 6681F90000          <1> 		cmp cx, 0
  3539 000028C8 75F5                <1> 		jne swmsy2
  3540 000028CA 8B07                <1> noswmsy2:	mov eax, [edi]
  3541 000028CC 8B5F04              <1> 		mov ebx, [edi + 4]
  3542 000028CF 8906                <1> 		mov [esi], eax
  3543 000028D1 895E04              <1> 		mov [esi + 4], ebx
  3544 000028D4 8B4708              <1> 		mov eax, [edi + 8]
  3545 000028D7 8B5F0C              <1> 		mov ebx, [edi + 12]
  3546 000028DA 894608              <1> 		mov [esi + 8], eax
  3547 000028DD 895E0C              <1> 		mov [esi + 12], ebx
  3548 000028E0 01D7                <1> 		add edi, edx
  3549 000028E2 81C610000000        <1> 		add esi, 16
  3550 000028E8 81FE[00130000]      <1> 		cmp esi, mcolorend
  3551 000028EE 72DA                <1> 		jb noswmsy2
  3552 000028F0 C3                  <1> 		ret
  3553                              <1> 
  3554 000028F1 00                  <1> pbutton db 0
  3555 000028F2 00                  <1> pLBUTTON db 0
  3556 000028F3 00                  <1> pRBUTTON db 0
  3557 000028F4 00000000            <1> dragging dw 0,0
  3558 000028F8 0000000000000000    <1> lastpos dw 0,0,0,0
  3559 00002900 00000000            <1> colorbuf dw 0,0
  3560                              <1> 	
  3561                              <1> 	clickicon:
  3562 00002904 B001                <1> 		mov al, 1
  3563 00002906 A2[F1280000]        <1> 		mov [pbutton], al
  3564 0000290B A0[F2280000]        <1> 		mov al, [pLBUTTON]
  3565 00002910 2205[76220000]      <1> 		and al, [LBUTTON]
  3566 00002916 8A25[F3280000]      <1> 		mov ah, [pRBUTTON]
  3567 0000291C 2225[77220000]      <1> 		and ah, [RBUTTON]
  3568 00002922 08E0                <1> 		or al, ah
  3569 00002924 3C00                <1> 		cmp al, 0
  3570 00002926 741B                <1> 		je nodragclick
  3571 00002928 813D[F4280000]0100- <1> 		cmp dword [dragging], 1
  3572 00002930 0000                <1>
  3573 00002932 732D                <1> 		jae dragclick
  3574 00002934 C705[F4280000]0100- <1> 		mov dword [dragging], 1
  3575 0000293C 0000                <1>
  3576 0000293E E91E000000          <1> 		jmp dragclick
  3577                              <1> 	nodragclick:
  3578 00002943 C705[F4280000]0000- <1> 		mov dword [dragging], 0
  3579 0000294B 0000                <1>
  3580 0000294D A0[76220000]        <1> 		mov al, [LBUTTON]
  3581 00002952 A2[F2280000]        <1> 		mov [pLBUTTON], al
  3582 00002957 A0[77220000]        <1> 		mov al, [RBUTTON]
  3583 0000295C A2[F3280000]        <1> 		mov [pRBUTTON], al
  3584                              <1> 	dragclick:
  3585 00002961 66B80000            <1> 		mov ax, 0
  3586 00002965 BE[00100000]        <1> 		mov esi, graphicstable
  3587 0000296A C705[7C380000]0000- <1> 		mov dword [codepointer], 0
  3588 00002972 0000                <1>
  3589                              <1> 	clicon2:
  3590 00002974 BA00000000          <1> 		mov edx, 0
  3591 00002979 B900000000          <1> 		mov ecx, 0
  3592 0000297E 66813E0100          <1> 		cmp word [esi], 1
  3593 00002983 0F841B000000        <1> 		je near iconselect
  3594 00002989 66813E0200          <1> 		cmp word [esi], 2
  3595 0000298E 0F8472010000        <1> 		je near textselected
  3596 00002994 66813E0300          <1> 		cmp word [esi], 3
  3597 00002999 0F84C7020000        <1> 		je near windowselect
  3598 0000299F E901040000          <1> 		jmp nexticonsel
  3599                              <1> 	iconselect:
  3600 000029A4 668B5606            <1> 		mov dx, [esi + 6]
  3601 000029A8 6689D0              <1> 		mov ax, dx
  3602 000029AB 668B4E08            <1> 		mov cx, [esi + 8]
  3603 000029AF 6689CB              <1> 		mov bx, cx
  3604 000029B2 6681C32000          <1> 		add bx, 32
  3605 000029B7 6601D0              <1> 		add ax, dx
  3606 000029BA 813D[F4280000]0100- <1> 		cmp dword [dragging], 1
  3607 000029C2 0000                <1>
  3608 000029C4 746F                <1> 		je dragicon
  3609 000029C6 813D[F4280000]0000- <1> 		cmp dword [dragging], 0
  3610 000029CE 0000                <1>
  3611 000029D0 7411                <1> 		je nodragiconcheck
  3612 000029D2 3935[F4280000]      <1> 		cmp dword [dragging], esi
  3613 000029D8 0F85C7030000        <1> 		jne near nexticonsel
  3614 000029DE E952000000          <1> 		jmp dragicon
  3615                              <1> 	nodragiconcheck:
  3616 000029E3 663905[0B250000]    <1> 		cmp [mousecursorposition], ax
  3617 000029EA 0F82B5030000        <1> 		jb near nexticonsel
  3618 000029F0 66054000            <1> 		add ax, 64
  3619 000029F4 663905[0B250000]    <1> 		cmp [mousecursorposition], ax
  3620 000029FB 0F87A4030000        <1> 		ja near nexticonsel
  3621 00002A01 6629D0              <1> 		sub ax, dx
  3622 00002A04 66390D[0D250000]    <1> 		cmp [mousecursorposition + 2], cx
  3623 00002A0B 0F8294030000        <1> 		jb near nexticonsel
  3624 00002A11 66391D[0D250000]    <1> 		cmp [mousecursorposition + 2], bx
  3625 00002A18 0F8787030000        <1> 		ja near nexticonsel
  3626 00002A1E 668B460A            <1> 		mov ax, [esi + 10]
  3627 00002A22 66250100            <1> 		and ax, 1
  3628 00002A26 663D0100            <1> 		cmp ax, 1
  3629 00002A2A 0F84B6000000        <1> 		je near unselecticon
  3630 00002A30 E98D000000          <1> 		jmp nodragicon
  3631                              <1> 	dragicon:
  3632 00002A35 663905[07250000]    <1> 		cmp [lastmouseposition], ax
  3633 00002A3C 0F8263030000        <1> 		jb near nexticonsel
  3634 00002A42 66054000            <1> 		add ax, 64
  3635 00002A46 663905[07250000]    <1> 		cmp [lastmouseposition], ax
  3636 00002A4D 0F8752030000        <1> 		ja near nexticonsel
  3637 00002A53 6629D0              <1> 		sub ax, dx
  3638 00002A56 66390D[09250000]    <1> 		cmp [lastmouseposition + 2], cx
  3639 00002A5D 0F8242030000        <1> 		jb near nexticonsel
  3640 00002A63 66391D[09250000]    <1> 		cmp [lastmouseposition + 2], bx
  3641 00002A6A 0F8735030000        <1> 		ja near nexticonsel
  3642 00002A70 668B460A            <1> 		mov ax, [esi + 10]
  3643 00002A74 2410                <1> 		and al, 00010000b
  3644 00002A76 3C10                <1> 		cmp al, 00010000b
  3645 00002A78 7448                <1> 		je nodragicon
  3646 00002A7A 8935[F4280000]      <1> 		mov [dragging], esi
  3647 00002A80 66D1E2              <1> 		shl dx, 1
  3648 00002A83 662B15[07250000]    <1> 		sub dx, [lastmouseposition]
  3649 00002A8A 660315[0B250000]    <1> 		add dx, [mousecursorposition]
  3650 00002A91 66D1EA              <1> 		shr dx, 1
  3651 00002A94 66030D[0D250000]    <1> 		add cx, [mousecursorposition + 2]
  3652 00002A9B 662B0D[09250000]    <1> 		sub cx, [lastmouseposition + 2]
  3653 00002AA2 663B15[DA350000]    <1> 		cmp dx, [resolutionx2]
  3654 00002AA9 7607                <1> 		jbe chkyresdrgicn
  3655 00002AAB 668B15[0B250000]    <1> 		mov dx, [mousecursorposition]
  3656                              <1> 	chkyresdrgicn:
  3657 00002AB2 663B0D[D6350000]    <1> 		cmp cx, [resolutiony]
  3658 00002AB9 7607                <1> 		jbe nodragicon
  3659 00002ABB 668B0D[0D250000]    <1> 		mov cx, [mousecursorposition + 2]
  3660                              <1> 	nodragicon:
  3661 00002AC2 66814E0A0100        <1> 		or word [esi + 10], 1
  3662 00002AC8 8B5E0C              <1> 		mov ebx, [esi + 12]
  3663 00002ACB 668B460A            <1> 		mov ax, [esi + 10]
  3664 00002ACF 8B7602              <1> 		mov esi, [esi + 2]
  3665 00002AD2 C705[7C380000]0000- <1> 		mov dword [codepointer], 0
  3666 00002ADA 0000                <1>
  3667 00002ADC E81C0A0000          <1> 		call showicon
  3668 00002AE1 E9D8020000          <1> 		jmp doneiconsel
  3669                              <1> 	unselecticon:
  3670 00002AE6 6681660AFEFF        <1> 		and word [esi + 10], 0xFFFE
  3671 00002AEC 8B5E0C              <1> 		mov ebx, [esi + 12]
  3672 00002AEF 668B460A            <1> 		mov ax, [esi + 10]
  3673 00002AF3 8B7602              <1> 		mov esi, [esi + 2]
  3674 00002AF6 891D[7C380000]      <1> 		mov [codepointer], ebx
  3675 00002AFC E8FC090000          <1> 		call showicon
  3676 00002B01 E9B8020000          <1> 		jmp doneiconsel
  3677                              <1> 	textselected:
  3678 00002B06 8B5E02              <1> 		mov ebx, [esi + 2]
  3679 00002B09 668B5606            <1> 		mov dx, [esi + 6]
  3680 00002B0D 6689D0              <1> 		mov ax, dx
  3681 00002B10 668B4E08            <1> 		mov cx, [esi + 8]
  3682                              <1> 	lengthtesttext:
  3683 00002B14 803B00              <1> 		cmp byte [ebx], 0
  3684 00002B17 7407                <1> 		je donetesttextlength
  3685 00002B19 43                  <1> 		inc ebx
  3686 00002B1A 66051000            <1> 		add ax, 16
  3687 00002B1E EBF4                <1> 		jmp lengthtesttext
  3688                              <1> 	donetesttextlength:
  3689 00002B20 6689CB              <1> 		mov bx, cx
  3690 00002B23 6681C30F00          <1> 		add bx, 15
  3691 00002B28 813D[F4280000]0100- <1> 		cmp dword [dragging], 1
  3692 00002B30 0000                <1>
  3693 00002B32 7468                <1> 		je dragtext
  3694 00002B34 813D[F4280000]0000- <1> 		cmp dword [dragging], 0
  3695 00002B3C 0000                <1>
  3696 00002B3E 7411                <1> 		je nodragtextcheck
  3697 00002B40 3935[F4280000]      <1> 		cmp dword [dragging], esi
  3698 00002B46 0F8559020000        <1> 		jne near nexticonsel
  3699 00002B4C E94B000000          <1> 		jmp dragtext
  3700                              <1> 	nodragtextcheck:
  3701 00002B51 663915[0B250000]    <1> 		cmp [mousecursorposition], dx
  3702 00002B58 0F8247020000        <1> 		jb near nexticonsel
  3703 00002B5E 663905[0B250000]    <1> 		cmp [mousecursorposition], ax
  3704 00002B65 0F873A020000        <1> 		ja near nexticonsel
  3705 00002B6B 66390D[0D250000]    <1> 		cmp [mousecursorposition + 2], cx
  3706 00002B72 0F822D020000        <1> 		jb near nexticonsel
  3707 00002B78 66391D[0D250000]    <1> 		cmp [mousecursorposition + 2], bx
  3708 00002B7F 0F8720020000        <1> 		ja near nexticonsel
  3709 00002B85 668B460A            <1> 		mov ax, [esi + 10]
  3710 00002B89 66250100            <1> 		and ax, 1
  3711 00002B8D 663D0100            <1> 		cmp ax, 1
  3712 00002B91 0F84AB000000        <1> 		je near unselecttext
  3713 00002B97 E986000000          <1> 		jmp nodragtext
  3714                              <1> 	dragtext:
  3715 00002B9C 663915[07250000]    <1> 		cmp [lastmouseposition], dx
  3716 00002BA3 0F82FC010000        <1> 		jb near nexticonsel
  3717 00002BA9 663905[07250000]    <1> 		cmp [lastmouseposition], ax
  3718 00002BB0 0F87EF010000        <1> 		ja near nexticonsel
  3719 00002BB6 66390D[09250000]    <1> 		cmp [lastmouseposition + 2], cx
  3720 00002BBD 0F82E2010000        <1> 		jb near nexticonsel
  3721 00002BC3 66391D[09250000]    <1> 		cmp [lastmouseposition + 2], bx
  3722 00002BCA 0F87D5010000        <1> 		ja near nexticonsel
  3723 00002BD0 668B460A            <1> 		mov ax, [esi + 10]
  3724 00002BD4 2410                <1> 		and al, 00010000b
  3725 00002BD6 663D1000            <1> 		cmp ax, 00010000b
  3726 00002BDA 0F8442000000        <1> 		je near nodragtext
  3727 00002BE0 8935[F4280000]      <1> 		mov [dragging], esi
  3728 00002BE6 662B15[07250000]    <1> 		sub dx, [lastmouseposition]
  3729 00002BED 660315[0B250000]    <1> 		add dx, [mousecursorposition]
  3730 00002BF4 66030D[0D250000]    <1> 		add cx, [mousecursorposition + 2]
  3731 00002BFB 662B0D[09250000]    <1> 		sub cx, [lastmouseposition + 2]
  3732 00002C02 663B15[DA350000]    <1> 		cmp dx, [resolutionx2]
  3733 00002C09 7607                <1> 		jbe chkyresdrgtxt
  3734 00002C0B 668B15[0B250000]    <1> 		mov dx, [mousecursorposition]
  3735                              <1> 	chkyresdrgtxt:
  3736 00002C12 663B0D[D6350000]    <1> 		cmp cx, [resolutiony]
  3737 00002C19 7607                <1> 		jbe nodragtext
  3738 00002C1B 668B0D[0D250000]    <1> 		mov cx, [mousecursorposition + 2]
  3739                              <1> 	nodragtext:
  3740 00002C22 66814E0A0100        <1> 		or word [esi + 10], 1
  3741 00002C28 8B5E0C              <1> 		mov ebx, [esi + 12]
  3742 00002C2B 891D[7C380000]      <1> 		mov [codepointer], ebx
  3743 00002C31 668B460A            <1> 		mov ax, [esi + 10]
  3744 00002C35 8B7602              <1> 		mov esi, [esi + 2]
  3745 00002C38 E841050000          <1> 		call showstring
  3746 00002C3D E97C010000          <1> 		jmp doneiconsel
  3747                              <1> 	unselecttext:
  3748 00002C42 6681660AFEFF        <1> 		and word [esi + 10], 0xFFFE
  3749 00002C48 8B5E0C              <1> 		mov ebx, [esi + 12]
  3750 00002C4B 668B460A            <1> 		mov ax, [esi + 10]
  3751 00002C4F 8B7602              <1> 		mov esi, [esi + 2]
  3752 00002C52 C705[7C380000]0000- <1> 		mov dword [codepointer], 0
  3753 00002C5A 0000                <1>
  3754 00002C5C E81D050000          <1> 		call showstring
  3755 00002C61 E958010000          <1> 		jmp doneiconsel
  3756                              <1> windowselect:
  3757 00002C66 8B7E02              <1> 		mov edi, [esi + 2]
  3758 00002C69 668B5606            <1> 		mov dx, [esi + 6]
  3759 00002C6D 6689D0              <1> 		mov ax, dx
  3760 00002C70 668B4E08            <1> 		mov cx, [esi + 8]
  3761 00002C74 6689CB              <1> 		mov bx, cx
  3762 00002C77 6681C31000          <1> 		add bx, 16
  3763 00002C7C 813D[F4280000]0100- <1> 		cmp dword [dragging], 1
  3764 00002C84 0000                <1>
  3765 00002C86 746D                <1> 		je dragwin
  3766 00002C88 813D[F4280000]0000- <1> 		cmp dword [dragging], 0
  3767 00002C90 0000                <1>
  3768 00002C92 7411                <1> 		je nodragwincheck
  3769 00002C94 3935[F4280000]      <1> 		cmp dword [dragging], esi
  3770 00002C9A 0F8505010000        <1> 		jne near nexticonsel
  3771 00002CA0 E950000000          <1> 		jmp dragwin
  3772                              <1> 	nodragwincheck:
  3773 00002CA5 663905[0B250000]    <1> 		cmp [mousecursorposition], ax
  3774 00002CAC 0F82F3000000        <1> 		jb near nexticonsel
  3775 00002CB2 660307              <1> 		add ax, [edi]
  3776 00002CB5 660307              <1> 		add ax, [edi]
  3777 00002CB8 663905[0B250000]    <1> 		cmp [mousecursorposition], ax
  3778 00002CBF 0F87E0000000        <1> 		ja near nexticonsel
  3779 00002CC5 66390D[0D250000]    <1> 		cmp [mousecursorposition + 2], cx
  3780 00002CCC 0F82D3000000        <1> 		jb near nexticonsel
  3781 00002CD2 66391D[0D250000]    <1> 		cmp [mousecursorposition + 2], bx
  3782 00002CD9 0F87C6000000        <1> 		ja near nexticonsel
  3783 00002CDF 662D1400            <1> 		sub ax, 20
  3784 00002CE3 663905[0B250000]    <1> 		cmp [mousecursorposition], ax
  3785 00002CEA 0F8795000000        <1> 		ja near killwin
  3786 00002CF0 E97C000000          <1> 		jmp nodragwin
  3787                              <1> 	dragwin:
  3788 00002CF5 663905[07250000]    <1> 		cmp [lastmouseposition], ax
  3789 00002CFC 0F82A3000000        <1> 		jb near nexticonsel
  3790 00002D02 660307              <1> 		add ax, [edi]
  3791 00002D05 660307              <1> 		add ax, [edi]
  3792 00002D08 663905[07250000]    <1> 		cmp [lastmouseposition], ax
  3793 00002D0F 0F8790000000        <1> 		ja near nexticonsel
  3794 00002D15 66390D[09250000]    <1> 		cmp [lastmouseposition + 2], cx
  3795 00002D1C 0F8283000000        <1> 		jb near nexticonsel
  3796 00002D22 66391D[09250000]    <1> 		cmp [lastmouseposition + 2], bx
  3797 00002D29 0F8776000000        <1> 		ja near nexticonsel
  3798 00002D2F 8935[F4280000]      <1> 		mov [dragging], esi
  3799 00002D35 662B15[07250000]    <1> 		sub dx, [lastmouseposition]
  3800 00002D3C 660315[0B250000]    <1> 		add dx, [mousecursorposition]
  3801 00002D43 66030D[0D250000]    <1> 		add cx, [mousecursorposition + 2]
  3802 00002D4A 662B0D[09250000]    <1> 		sub cx, [lastmouseposition + 2]
  3803 00002D51 663B15[DA350000]    <1> 		cmp dx, [resolutionx2]
  3804 00002D58 7607                <1> 		jbe chkyresdrgwin
  3805 00002D5A 668B15[0B250000]    <1> 		mov dx, [mousecursorposition]
  3806                              <1> 	chkyresdrgwin:
  3807 00002D61 663B0D[D6350000]    <1> 		cmp cx, [resolutiony]
  3808 00002D68 7607                <1> 		jbe nodragwin
  3809 00002D6A 668B0D[0D250000]    <1> 		mov cx, [mousecursorposition + 2]
  3810                              <1> 	nodragwin:
  3811 00002D71 8B5E0C              <1> 		mov ebx, [esi + 12]
  3812 00002D74 668B460A            <1> 		mov ax, [esi + 10]
  3813 00002D78 8B7602              <1> 		mov esi, [esi + 2]
  3814 00002D7B E853040000          <1> 		call showwindow
  3815 00002D80 E939000000          <1> 		jmp doneiconsel
  3816                              <1> 	killwin:
  3817 00002D85 66C7060000          <1> 		mov word [esi], 0
  3818 00002D8A C705[2D030000]0000- <1> 		mov dword [user2codepoint], 0
  3819 00002D92 0000                <1>
  3820 00002D94 C605[55090000]00    <1> 		mov byte [termguion], 0
  3821 00002D9B E881F8FFFF          <1> 		call guiclear
  3822 00002DA0 E939000000          <1> 		jmp doneiconsel2
  3823                              <1> 	nexticonsel:
  3824 00002DA5 6681660AFEFF        <1> 		and word [esi + 10], 0xFFFE
  3825 00002DAB 81C610000000        <1> 		add esi, 16
  3826 00002DB1 81FE[00120000]      <1> 		cmp esi, graphicstableend
  3827 00002DB7 7305                <1> 		jae doneiconsel
  3828 00002DB9 E9B6FBFFFF          <1> 		jmp clicon2
  3829                              <1> 	doneiconsel:
  3830 00002DBE 813D[F4280000]0100- <1> 		cmp dword [dragging], 1
  3831 00002DC6 0000                <1>
  3832 00002DC8 7314                <1> 		jae doneiconsel2
  3833 00002DCA 813D[7C380000]0000- <1> 		cmp dword [codepointer], 0
  3834 00002DD2 0000                <1>
  3835 00002DD4 7408                <1> 		je doneiconsel2
  3836 00002DD6 8B1D[7C380000]      <1> 		mov ebx, [codepointer]
  3837 00002DDC FFE3                <1> 		jmp ebx 
  3838                              <1> 	doneiconsel2:
  3839 00002DDE A0[76220000]        <1> 		mov al, [LBUTTON]
  3840 00002DE3 A2[F2280000]        <1> 		mov [pLBUTTON], al
  3841 00002DE8 A0[77220000]        <1> 		mov al, [RBUTTON]
  3842 00002DED A2[F3280000]        <1> 		mov [pRBUTTON], al
  3843 00002DF2 E8C4F9FFFF          <1> call clearmousecursor
  3844 00002DF7 E83C000000          <1> call reloadallgraphics
  3845 00002DFC B900000000          <1> 		mov ecx, 0
  3846 00002E01 BA00000000          <1> 		mov edx, 0
  3847 00002E06 B400                <1> 		mov ah, 0
  3848 00002E08 B080                <1> 		mov al, 128
  3849 00002E0A 668B15[0B250000]    <1> 		mov dx, [mousecursorposition]
  3850 00002E11 668B0D[0D250000]    <1> 		mov cx, [mousecursorposition + 2]
  3851 00002E18 66BBE738            <1> 		mov bx, 0011100011100111b
  3852 00002E1C C605[B7270000]01    <1> 		mov byte [showcursorfonton], 1
  3853 00002E23 E8C2070000          <1> 		call showfontvesa
  3854 00002E28 C605[B7270000]00    <1> 		mov byte [showcursorfonton], 0
  3855 00002E2F C3                  <1> 		ret
  3856 00002E30 00000000            <1> lastdrag dw 0,0
  3857 00002E34 00000000            <1> grpctblpos dw 0,0
  3858                              <1> 
  3859                              <1> reloadallgraphics:
  3860 00002E38 BF[00100000]        <1> 		mov edi, graphicstable
  3861                              <1> reloadgraphicsloop:
  3862 00002E3D 8B7702              <1> 		mov esi, [edi + 2]
  3863 00002E40 668B5706            <1> 		mov dx, [edi + 6]
  3864 00002E44 668B4F08            <1> 		mov cx, [edi + 8]
  3865 00002E48 668B07              <1> 		mov ax, [edi]
  3866 00002E4B 668B5F0A            <1> 		mov bx, [edi + 10]
  3867 00002E4F 893D[342E0000]      <1> 		mov [grpctblpos], edi
  3868 00002E55 3B3D[F4280000]      <1> 		cmp edi, [dragging]
  3869 00002E5B 741E                <1> 		je loadedgraphic
  3870 00002E5D 663D0100            <1> 		cmp ax, 1
  3871 00002E61 0F8431000000        <1> 		je near icongraphic
  3872 00002E67 663D0200            <1> 		cmp ax, 2
  3873 00002E6B 0F8437000000        <1> 		je near stringgraphic
  3874 00002E71 663D0300            <1> 		cmp ax, 3
  3875 00002E75 0F8416000000        <1> 		je near windowgraphic
  3876 00002E7B 8B3D[342E0000]      <1> loadedgraphic:  mov edi, [grpctblpos]
  3877 00002E81 81C710000000        <1> 		add edi, 16
  3878 00002E87 81FF[00120000]      <1> 		cmp edi, graphicstableend
  3879 00002E8D 7329                <1> 		jae donereloadgraphics
  3880 00002E8F EBAC                <1> 		jmp reloadgraphicsloop
  3881 00002E91 E890030000          <1> windowgraphic:	call showwindow2
  3882 00002E96 EBE3                <1> 		jmp loadedgraphic
  3883 00002E98 80E301              <1> icongraphic:	and bl, 1
  3884 00002E9B 881D[80380000]      <1> 		mov [iconselected], bl
  3885 00002EA1 E86A060000          <1> 		call showicon2
  3886 00002EA6 EBD3                <1> 		jmp loadedgraphic
  3887 00002EA8 80E301              <1> stringgraphic:  and bl, 1
  3888 00002EAB 881D[B9270000]      <1> 		mov [mouseselecton], bl
  3889 00002EB1 E8DB020000          <1> 		call showstring2
  3890 00002EB6 EBC3                <1> 		jmp loadedgraphic
  3891                              <1> donereloadgraphics:
  3892 00002EB8 8B3D[F4280000]      <1> 		mov edi, [dragging]
  3893 00002EBE 81FF[00100000]      <1> 		cmp edi, graphicstable
  3894 00002EC4 723B                <1> 		jb notcorrectdrag
  3895 00002EC6 668B07              <1> 		mov ax, [edi]
  3896 00002EC9 8B7702              <1> 		mov esi, [edi + 2]
  3897 00002ECC 668B5706            <1> 		mov dx, [edi + 6]
  3898 00002ED0 668B4F08            <1> 		mov cx, [edi + 8]
  3899 00002ED4 668B5F0A            <1> 		mov bx, [edi + 10]
  3900 00002ED8 663D0100            <1> 		cmp ax, 1
  3901 00002EDC 750F                <1> 		jne noticondragging
  3902 00002EDE 80E301              <1> 		and bl, 1
  3903 00002EE1 881D[80380000]      <1> 		mov [iconselected], bl
  3904 00002EE7 E824060000          <1> 		call showicon2
  3905 00002EEC C3                  <1> 		ret
  3906                              <1> 
  3907                              <1> 	noticondragging:
  3908 00002EED 663D0200            <1> 		cmp ax, 2
  3909 00002EF1 750E                <1> 		jne notcorrectdrag
  3910 00002EF3 80E301              <1> 		and bl, 1
  3911 00002EF6 881D[B9270000]      <1> 		mov [mouseselecton], bl
  3912 00002EFC E890020000          <1> 		call showstring2
  3913                              <1> 	notcorrectdrag:
  3914 00002F01 C3                  <1> 		ret
  3915                              <1> 
  3916 00002F02 00<rept>            <1> grphbuf times 16 db 0
  3917                              <1> 	graphicsadd:
  3918 00002F12 BF[00100000]        <1> 		mov edi, graphicstable
  3919                              <1> 	shwgrph1:
  3920 00002F17 397702              <1> 		cmp dword [edi + 2], esi
  3921 00002F1A 7414                <1> 		je showgraphicsreplace2
  3922 00002F1C 81C710000000        <1> 		add edi, 16
  3923 00002F22 81FF[00120000]      <1> 		cmp edi, graphicstableend
  3924 00002F28 0F8335020000        <1> 		jae near showgraphicsnew
  3925 00002F2E EBE7                <1> 		jmp shwgrph1
  3926                              <1> 	showgraphicsreplace2:
  3927 00002F30 8935[042F0000]      <1> 		mov [grphbuf + 2], esi
  3928 00002F36 668915[082F0000]    <1> 		mov [grphbuf + 6], dx
  3929 00002F3D 66890D[0A2F0000]    <1> 		mov [grphbuf + 8], cx
  3930 00002F44 891D[0E2F0000]      <1> 		mov [grphbuf + 12], ebx
  3931 00002F4A B700                <1> 		mov bh, 0
  3932 00002F4C 88E3                <1> 		mov bl, ah
  3933 00002F4E B400                <1> 		mov ah, 0
  3934 00002F50 66A3[0C2F0000]      <1> 		mov [grphbuf + 10], ax	
  3935 00002F56 66891D[022F0000]    <1> 		mov [grphbuf], bx
  3936 00002F5D 66A1[022F0000]      <1> 		mov ax, [grphbuf]
  3937 00002F63 663D0100            <1> 		cmp ax, 1
  3938 00002F67 0F8419000000        <1> 		je near replaceicon
  3939 00002F6D 663D0200            <1> 		cmp ax, 2
  3940 00002F71 0F8493000000        <1> 		je near replacestring
  3941 00002F77 663D0300            <1> 		cmp ax, 3
  3942 00002F7B 0F840F010000        <1> 		je near replacewindow
  3943 00002F81 E9BA010000          <1> 		jmp showgraphicsreplace
  3944                              <1> 	replaceicon:
  3945 00002F86 893D[F8280000]      <1> 		mov [lastpos], edi
  3946 00002F8C 8935[FC280000]      <1> 		mov [lastpos + 4], esi
  3947 00002F92 8B7702              <1> 		mov esi, [edi + 2]
  3948 00002F95 668B5F0C            <1> 		mov bx, [edi + 12]
  3949 00002F99 668B5706            <1> 		mov dx, [edi + 6]
  3950 00002F9D 668B4F08            <1> 		mov cx, [edi + 8]
  3951 00002FA1 668B06              <1> 		mov ax, [esi]
  3952 00002FA4 66A3[00290000]      <1> 		mov [colorbuf], ax
  3953 00002FAA 66A1[5E260000]      <1> 		mov ax, [background]
  3954 00002FB0 668906              <1> 		mov [esi], ax
  3955 00002FB3 8B5F0C              <1> 		mov ebx, [edi + 12]
  3956 00002FB6 668B470A            <1> 		mov ax, [edi + 10]
  3957 00002FBA 2401                <1> 		and al, 1
  3958 00002FBC A2[80380000]        <1> 		mov [iconselected], al
  3959 00002FC1 668B470A            <1> 		mov ax, [edi + 10]
  3960 00002FC5 E846050000          <1> 		call showicon2
  3961 00002FCA 8B3D[F8280000]      <1> 		mov edi, [lastpos]
  3962 00002FD0 8B7702              <1> 		mov esi, [edi + 2]
  3963 00002FD3 66A1[00290000]      <1> 		mov ax, [colorbuf]
  3964 00002FD9 668906              <1> 		mov [esi], ax
  3965 00002FDC 8B35[FC280000]      <1> 		mov esi, [lastpos + 4]
  3966 00002FE2 668B15[082F0000]    <1> 		mov dx, [grphbuf + 6]
  3967 00002FE9 668B0D[0A2F0000]    <1> 		mov cx, [grphbuf + 8]
  3968 00002FF0 668B1D[022F0000]    <1> 		mov bx, [grphbuf]
  3969 00002FF7 66A1[0C2F0000]      <1> 		mov ax, [grphbuf + 10]
  3970 00002FFD 88DC                <1> 		mov ah, bl
  3971 00002FFF 8B1D[0E2F0000]      <1> 		mov ebx, [grphbuf + 12]
  3972 00003005 E936010000          <1> 		jmp showgraphicsreplace
  3973                              <1> 	replacestring:
  3974 0000300A 893D[F8280000]      <1> 		mov [lastpos], edi
  3975 00003010 8935[FC280000]      <1> 		mov [lastpos + 4], esi
  3976 00003016 8B5F0C              <1> 		mov ebx, [edi + 12]
  3977 00003019 8B7702              <1> 		mov esi, [edi + 2]
  3978 0000301C 668B5706            <1> 		mov dx, [edi + 6]
  3979 00003020 668B4F08            <1> 		mov cx, [edi + 8]
  3980 00003024 66A1[C1310000]      <1> 		mov ax, [colorfont2]
  3981 0000302A 66A3[00290000]      <1> 		mov [colorbuf], ax
  3982 00003030 66A1[5E260000]      <1> 		mov ax, [background]
  3983 00003036 66A3[C1310000]      <1> 		mov [colorfont2], ax		
  3984 0000303C 8B5F0C              <1> 		mov ebx, [edi + 12]
  3985 0000303F 668B470A            <1> 		mov ax, [edi + 10]
  3986 00003043 2401                <1> 		and al, 1
  3987 00003045 A2[B9270000]        <1> 		mov [mouseselecton], al
  3988 0000304A 668B470A            <1> 		mov ax, [edi + 10]
  3989 0000304E E83E010000          <1> 		call showstring2
  3990 00003053 66A1[00290000]      <1> 		mov ax, [colorbuf]
  3991 00003059 66A3[C1310000]      <1> 		mov [colorfont2], ax
  3992 0000305F 8B3D[F8280000]      <1> 		mov edi, [lastpos]
  3993 00003065 8B7702              <1> 		mov esi, [edi + 2]
  3994 00003068 668B15[082F0000]    <1> 		mov dx, [grphbuf + 6]
  3995 0000306F 668B0D[0A2F0000]    <1> 		mov cx, [grphbuf + 8]
  3996 00003076 668B1D[022F0000]    <1> 		mov bx, [grphbuf]
  3997 0000307D 66A1[0C2F0000]      <1> 		mov ax, [grphbuf + 10]
  3998 00003083 88DC                <1> 		mov ah, bl
  3999 00003085 8B1D[0E2F0000]      <1> 		mov ebx, [grphbuf + 12]
  4000 0000308B E9B0000000          <1> 		jmp showgraphicsreplace
  4001                              <1> 	replacewindow:
  4002 00003090 893D[F8280000]      <1> 		mov [lastpos], edi
  4003 00003096 8935[FC280000]      <1> 		mov [lastpos + 4], esi
  4004 0000309C 8B7702              <1> 		mov esi, [edi + 2]
  4005 0000309F 8B3D[CF310000]      <1> 		mov edi, [windowbufloc]
  4006 000030A5 BA00000000          <1> 		mov edx, 0
  4007 000030AA 668B15[DA350000]    <1> 		mov dx, [resolutionx2]
  4008 000030B1 C1E204              <1> 		shl edx, 4
  4009 000030B4 29D7                <1> 		sub edi, edx
  4010 000030B6 BA00000000          <1> 		mov edx, 0
  4011 000030BB 668B16              <1> 		mov dx, [esi]
  4012 000030BE 660316              <1> 		add dx, [esi]
  4013 000030C1 668B4E02            <1> 		mov cx, [esi + 2]
  4014 000030C5 6681C11000          <1> 		add cx, 16
  4015 000030CA 66A1[5E260000]      <1> 		mov ax, [background]
  4016                              <1> 	clearwindow:
  4017 000030D0 668907              <1> 		mov [edi], ax
  4018 000030D3 81C702000000        <1> 		add edi, 2
  4019 000030D9 81EA02000000        <1> 		sub edx, 2
  4020 000030DF 81FA00000000        <1> 		cmp edx, 0
  4021 000030E5 75E9                <1> 		jne clearwindow
  4022 000030E7 6649                <1> 		dec cx
  4023 000030E9 668B15[DA350000]    <1> 		mov dx, [resolutionx2]
  4024 000030F0 662B16              <1> 		sub dx, [esi]
  4025 000030F3 662B16              <1> 		sub dx, [esi]
  4026 000030F6 01D7                <1> 		add edi, edx
  4027 000030F8 668B16              <1> 		mov dx, [esi]
  4028 000030FB 660316              <1> 		add dx, [esi]
  4029 000030FE 6681F90000          <1> 		cmp cx, 0
  4030 00003103 75CB                <1> 		jne clearwindow
  4031 00003105 C605[56090000]00    <1> 		mov byte [termcopyon], 0
  4032 0000310C 8B3D[F8280000]      <1> 		mov edi, [lastpos]
  4033 00003112 8B35[042F0000]      <1> 		mov esi, [grphbuf + 2]
  4034 00003118 668B15[082F0000]    <1> 		mov dx, [grphbuf + 6]
  4035 0000311F 668B0D[0A2F0000]    <1> 		mov cx, [grphbuf + 8]
  4036 00003126 668B1D[022F0000]    <1> 		mov bx, [grphbuf]
  4037 0000312D 66A1[0C2F0000]      <1> 		mov ax, [grphbuf + 10]
  4038 00003133 88DC                <1> 		mov ah, bl
  4039 00003135 8B1D[0E2F0000]      <1> 		mov ebx, [grphbuf + 12]
  4040 0000313B E900000000          <1> 		jmp showgraphicsreplace
  4041                              <1> 	showgraphicsreplace:
  4042 00003140 897702              <1> 		mov [edi + 2], esi
  4043 00003143 66895706            <1> 		mov [edi + 6], dx
  4044 00003147 66894F08            <1> 		mov [edi + 8], cx
  4045 0000314B 895F0C              <1> 		mov [edi + 12], ebx
  4046 0000314E B700                <1> 		mov bh, 0
  4047 00003150 88E3                <1> 		mov bl, ah
  4048 00003152 B400                <1> 		mov ah, 0
  4049 00003154 6689470A            <1> 		mov [edi + 10], ax
  4050 00003158 66891F              <1> 		mov [edi], bx
  4051 0000315B 8B5F0C              <1> 		mov ebx, [edi + 12]
  4052 0000315E 668B470A            <1> 		mov ax, [edi + 10]
  4053 00003162 C3                  <1> 		ret
  4054                              <1> 	showgraphicsnew:
  4055 00003163 BF[00100000]        <1> 		mov edi, graphicstable
  4056                              <1> 	shwgrph2:
  4057 00003168 66813F0000          <1> 		cmp word [edi], 0
  4058 0000316D 74D1                <1> 		je showgraphicsreplace
  4059 0000316F 81C710000000        <1> 		add edi, 16
  4060 00003175 81FF[00120000]      <1> 		cmp edi, graphicstableend
  4061 0000317B 72EB                <1> 		jb shwgrph2
  4062                              <1> 	showgraphicsdone:
  4063 0000317D C3                  <1> 		ret
  4064                              <1> 
  4065                              <1> 	showstring:
  4066 0000317E A2[B9270000]        <1> 		mov [mouseselecton], al
  4067 00003183 8025[B9270000]01    <1> 		and byte [mouseselecton], 1
  4068 0000318A B402                <1> 		mov ah, 2
  4069 0000318C E881FDFFFF          <1> 		call graphicsadd
  4070                              <1> 	showstring2:
  4071 00003191 B400                <1> 		mov ah, 0
  4072 00003193 8A06                <1> 		mov al, [esi]
  4073 00003195 3C00                <1> 		cmp al, 0
  4074 00003197 7420                <1> 		je doneshowstring
  4075 00003199 46                  <1> 		inc esi
  4076 0000319A 8935[29380000]      <1> 		mov [showstringesi], esi
  4077 000031A0 668B1D[C1310000]    <1> 		mov bx, [colorfont2]
  4078 000031A7 E83E040000          <1> 		call showfontvesa
  4079 000031AC 6681C20800          <1> 		add dx, 8
  4080 000031B1 8B35[29380000]      <1> 		mov esi, [showstringesi]
  4081 000031B7 EBD8                <1> 		jmp showstring2
  4082                              <1> 	doneshowstring:
  4083 000031B9 C605[B9270000]00    <1> 		mov byte [mouseselecton], 0
  4084 000031C0 C3                  <1> 		ret
  4085                              <1> 
  4086 000031C1 FFFF                <1> colorfont2 dw 0xFFFF
  4087 000031C3 0000                <1> winvcopystx dw 0
  4088 000031C5 0000                <1> winvcopysty dw 0
  4089 000031C7 0000                <1> winvcopydx dw 0
  4090 000031C9 0000                <1> winvcopycx dw 0
  4091 000031CB FFFF0000            <1> windowcolor dw 0xFFFF,0x0
  4092 000031CF 00000000            <1> windowbufloc: dw 0,0
  4093                              <1> 
  4094                              <1> 	showwindow:	;;windowstuff in si, position in (dx, cx), nothing in ax, code in bx
  4095 000031D3 C605[55090000]01    <1> 		mov byte [termguion], 1
  4096 000031DA 6681C11000          <1> 		add cx, 16
  4097 000031DF 668915[C3310000]    <1> 		mov [winvcopystx], dx
  4098 000031E6 66890D[C5310000]    <1> 		mov [winvcopysty], cx
  4099 000031ED 668B16              <1> 		mov dx, [esi]
  4100 000031F0 668B4E02            <1> 		mov cx, [esi + 2]
  4101 000031F4 6601D2              <1> 		add dx, dx
  4102 000031F7 668915[C7310000]    <1> 		mov [winvcopydx], dx
  4103 000031FE 66890D[C9310000]    <1> 		mov [winvcopycx], cx
  4104 00003205 668B0D[C5310000]    <1> 		mov cx, [winvcopysty]
  4105 0000320C 6681E91000          <1> 		sub cx, 16
  4106 00003211 668B15[C3310000]    <1> 		mov dx, [winvcopystx]
  4107 00003218 C605[56090000]00    <1> 		mov byte [termcopyon], 0
  4108 0000321F B403                <1> 		mov ah, 3
  4109 00003221 E8ECFCFFFF          <1> 		call graphicsadd
  4110                              <1> 	showwindow2:
  4111 00003226 6681C11000          <1> 		add cx, 16
  4112 0000322B 668915[C3310000]    <1> 		mov [winvcopystx], dx
  4113 00003232 66890D[C5310000]    <1> 		mov [winvcopysty], cx
  4114 00003239 668B16              <1> 		mov dx, [esi]
  4115 0000323C 668B4E02            <1> 		mov cx, [esi + 2]
  4116 00003240 6601D2              <1> 		add dx, dx
  4117 00003243 668915[C7310000]    <1> 		mov [winvcopydx], dx
  4118 0000324A 66890D[C9310000]    <1> 		mov [winvcopycx], cx
  4119 00003251 8B3D[CF310000]      <1> 		mov edi, [windowbufloc]
  4120 00003257 BA00000000          <1> 		mov edx, 0
  4121 0000325C 668B15[DA350000]    <1> 		mov dx, [resolutionx2]
  4122 00003263 C1E204              <1> 		shl edx, 4
  4123 00003266 29D7                <1> 		sub edi, edx
  4124 00003268 803D[56090000]00    <1> 		cmp byte [termcopyon], 0
  4125 0000326F 753E                <1> 		jne nocleartitlebarpos
  4126 00003271 8B3D[714A0000]      <1> 		mov edi, [physbaseptr]
  4127 00003277 BA00000000          <1> 		mov edx, 0
  4128 0000327C 668B15[C3310000]    <1> 		mov dx, [winvcopystx]
  4129 00003283 01D7                <1> 		add edi, edx
  4130 00003285 668B0D[C5310000]    <1> 		mov cx, [winvcopysty]
  4131 0000328C 6681E91000          <1> 		sub cx, 16
  4132 00003291 6681F90000          <1> 		cmp cx, 0
  4133 00003296 7417                <1> 		je nocleartitlebarpos
  4134                              <1> 	cleartitlebarpos:
  4135 00003298 BA00000000          <1> 		mov edx, 0
  4136 0000329D 668B15[DA350000]    <1> 		mov dx, [resolutionx2]
  4137 000032A4 01D7                <1> 		add edi, edx
  4138 000032A6 6649                <1> 		dec cx
  4139 000032A8 6681F90000          <1> 		cmp cx, 0
  4140 000032AD 75E9                <1> 		jne cleartitlebarpos
  4141                              <1> 	nocleartitlebarpos:
  4142 000032AF 66B91000            <1> 		mov cx, 16
  4143 000032B3 668B15[C7310000]    <1> 		mov dx, [winvcopydx]
  4144 000032BA 6681F90000          <1> 		cmp cx, 0
  4145 000032BF 0F844B000000        <1> 		je near canceltitlebarput
  4146 000032C5 6681FA0000          <1> 		cmp dx, 0
  4147 000032CA 0F8440000000        <1> 		je near canceltitlebarput
  4148                              <1> 	titlebarput:
  4149 000032D0 66A1[CB310000]      <1> 		mov ax, [windowcolor]
  4150 000032D6 668907              <1> 		mov [edi], ax
  4151 000032D9 6681EA0200          <1> 		sub dx, 2
  4152 000032DE 81C702000000        <1> 		add edi, 2
  4153 000032E4 6681FA0000          <1> 		cmp dx, 0
  4154 000032E9 75E5                <1> 		jne titlebarput
  4155 000032EB BA00000000          <1> 		mov edx, 0
  4156 000032F0 668B15[DA350000]    <1> 		mov dx, [resolutionx2]
  4157 000032F7 6649                <1> 		dec cx
  4158 000032F9 662B15[C7310000]    <1> 		sub dx, [winvcopydx]
  4159 00003300 01D7                <1> 		add edi, edx
  4160 00003302 668B15[C7310000]    <1> 		mov dx, [winvcopydx]
  4161 00003309 6681F90000          <1> 		cmp cx, 0
  4162 0000330E 75C0                <1> 		jne titlebarput
  4163                              <1> 	canceltitlebarput:
  4164 00003310 893D[CF310000]      <1> 		mov [windowbufloc], edi
  4165 00003316 803D[56090000]02    <1> 		cmp byte [termcopyon], 2
  4166 0000331D 0F8463000000        <1> 		je near winvcpst
  4167 00003323 66B80000            <1> 		mov ax, 0
  4168 00003327 81C604000000        <1> 		add esi, 4
  4169 0000332D 668B15[C3310000]    <1> 		mov dx, [winvcopystx]
  4170 00003334 668B0D[C5310000]    <1> 		mov cx, [winvcopysty]
  4171 0000333B 6681E91000          <1> 		sub cx, 16
  4172 00003340 66BB0000            <1> 		mov bx, 0
  4173 00003344 C605[B9270000]01    <1> 		mov byte [mouseselecton], 1
  4174 0000334B E841FEFFFF          <1> 		call showstring2
  4175 00003350 B058                <1> 		mov al, "X"
  4176 00003352 B400                <1> 		mov ah, 0
  4177 00003354 668B1D[C1310000]    <1> 		mov bx, [colorfont2]
  4178 0000335B 668B15[C3310000]    <1> 		mov dx, [winvcopystx]
  4179 00003362 668B0D[C5310000]    <1> 		mov cx, [winvcopysty]
  4180 00003369 6681E91000          <1> 		sub cx, 16
  4181 0000336E 6681EA1400          <1> 		sub dx, 20
  4182 00003373 660315[C7310000]    <1> 		add dx, [winvcopydx]
  4183 0000337A C605[B9270000]01    <1> 		mov byte [mouseselecton], 1
  4184 00003381 E864020000          <1> 		call showfontvesa
  4185                              <1> 	winvcpst:
  4186 00003386 8B3D[CF310000]      <1> 		mov edi, [windowbufloc]
  4187 0000338C E957000000          <1> 		jmp windowvideocopyset
  4188                              <1> 
  4189                              <1> 	windowvideocopy:
  4190 00003391 8B3D[CF310000]      <1> 		mov edi, [windowbufloc]
  4191 00003397 3B3D[714A0000]      <1> 		cmp edi, [physbaseptr]
  4192 0000339D 0F8345000000        <1> 		jae near windowvideocopyset
  4193 000033A3 B900000000          <1> 		mov ecx, 0
  4194 000033A8 BA00000000          <1> 		mov edx, 0
  4195 000033AD 668B15[C3310000]    <1> 		mov dx, [winvcopystx]
  4196 000033B4 668B0D[C5310000]    <1> 		mov cx, [winvcopysty]
  4197 000033BB 8B3D[714A0000]      <1> 		mov edi, [physbaseptr]
  4198 000033C1 01D7                <1> 		add edi, edx
  4199 000033C3 81F900000000        <1> 		cmp ecx, 0
  4200 000033C9 741D                <1> 		je windowvideocopyset
  4201                              <1> 	yrescopylp:
  4202 000033CB BA00000000          <1> 		mov edx, 0
  4203 000033D0 668B15[DA350000]    <1> 		mov dx, [resolutionx2]
  4204 000033D7 01D7                <1> 		add edi, edx
  4205 000033D9 6649                <1> 		dec cx
  4206 000033DB 6681F90000          <1> 		cmp cx, 0
  4207 000033E0 75E9                <1> 		jne yrescopylp
  4208 000033E2 893D[CF310000]      <1> 		mov [windowbufloc], edi
  4209                              <1> 	windowvideocopyset:
  4210 000033E8 66B90000            <1> 		mov cx, 0
  4211 000033EC 66890D[F5340000]    <1> 		mov [charposline], cx
  4212 000033F3 BE[851C0000]        <1> 		mov esi, videobuf2
  4213 000033F8 8935[F7340000]      <1> 		mov [charposvbuf], esi
  4214 000033FE 8A1E                <1> 		mov bl, [esi]
  4215 00003400 B700                <1> 		mov bh, 0
  4216 00003402 66C1E304            <1> 		shl bx, 4
  4217 00003406 678AB7[2940]        <1> 		mov dh, [fonts + bx]
  4218 0000340B D0CE                <1> 		ror dh, 1
  4219 0000340D 89FE                <1> 		mov esi, edi
  4220                              <1> 	copywindow:
  4221 0000340F B201                <1> 		mov dl, 1
  4222 00003411 D0C6                <1> 		rol dh, 1
  4223 00003413 20F2                <1> 		and dl, dh
  4224 00003415 66A1[CD310000]      <1> 		mov ax, [windowcolor + 2]
  4225 0000341B 668907              <1> 		mov [edi], ax
  4226 0000341E 80FA00              <1> 		cmp dl, 0
  4227 00003421 7409                <1> 		je nowritewin
  4228 00003423 66A1[CB310000]      <1> 		mov ax, [windowcolor]
  4229 00003429 668907              <1> 		mov [edi], ax
  4230                              <1> 	nowritewin:
  4231 0000342C 81C702000000        <1> 		add edi, 2
  4232 00003432 FEC1                <1> 		inc cl
  4233 00003434 80F908              <1> 		cmp cl, 8
  4234 00003437 75D6                <1> 		jne copywindow
  4235 00003439 6643                <1> 		inc bx
  4236 0000343B B100                <1> 		mov cl, 0
  4237 0000343D BA00000000          <1> 		mov edx, 0
  4238 00003442 668B15[DA350000]    <1> 		mov dx, [resolutionx2]
  4239 00003449 01D6                <1> 		add esi, edx
  4240 0000344B 89F7                <1> 		mov edi, esi
  4241 0000344D 678AB7[2940]        <1> 		mov dh, [fonts + bx]
  4242 00003452 D0CE                <1> 		ror dh, 1
  4243 00003454 FEC5                <1> 		inc ch
  4244 00003456 80FD10              <1> 		cmp ch, 16
  4245 00003459 75B4                <1> 		jne copywindow
  4246 0000345B 66B90000            <1> 		mov cx, 0
  4247 0000345F 8B3D[F7340000]      <1> 		mov edi, [charposvbuf]
  4248 00003465 81C702000000        <1> 		add edi, 2
  4249 0000346B 81FF[452F0000]      <1> 		cmp edi, videobufend
  4250 00003471 7370                <1> 		jae donewincopynow
  4251 00003473 8A1F                <1> 		mov bl, [edi]
  4252 00003475 B700                <1> 		mov bh, 0
  4253 00003477 66C1E304            <1> 		shl bx, 4
  4254 0000347B 893D[F7340000]      <1> 		mov [charposvbuf], edi
  4255 00003481 BA00000000          <1> 		mov edx, 0
  4256 00003486 668B15[DA350000]    <1> 		mov dx, [resolutionx2]
  4257 0000348D C1E204              <1> 		shl edx, 4
  4258 00003490 29D6                <1> 		sub esi, edx
  4259 00003492 81C610000000        <1> 		add esi, 16
  4260 00003498 89F7                <1> 		mov edi, esi
  4261 0000349A 668B0D[F5340000]    <1> 		mov cx, [charposline]
  4262 000034A1 6641                <1> 		inc cx
  4263 000034A3 6681F95000          <1> 		cmp cx, 80
  4264 000034A8 7317                <1> 		jae fixwindowcopy
  4265 000034AA 66890D[F5340000]    <1> 		mov [charposline], cx
  4266 000034B1 66B90000            <1> 		mov cx, 0
  4267 000034B5 678AB7[2940]        <1> 		mov dh, [fonts + bx]
  4268 000034BA D0CE                <1> 		ror dh, 1
  4269 000034BC E94EFFFFFF          <1> 		jmp copywindow
  4270                              <1> fixwindowcopy:
  4271 000034C1 66B90000            <1> 		mov cx, 0
  4272 000034C5 66890D[F5340000]    <1> 		mov [charposline], cx
  4273 000034CC 662B15[C7310000]    <1> 		sub dx, [winvcopydx]
  4274 000034D3 01D6                <1> 		add esi, edx
  4275 000034D5 89F7                <1> 		mov edi, esi
  4276 000034D7 678AB7[2940]        <1> 		mov dh, [fonts + bx]
  4277 000034DC D0CE                <1> 		ror dh, 1
  4278 000034DE E92CFFFFFF          <1> 		jmp copywindow
  4279                              <1> donewincopynow:
  4280 000034E3 803D[56090000]01    <1> 		cmp byte [termcopyon], 1
  4281 000034EA 7501                <1> 		jne forgetresetstuff
  4282 000034EC 61                  <1> 		popa
  4283                              <1> forgetresetstuff:
  4284 000034ED C605[56090000]00    <1> 		mov byte [termcopyon], 0
  4285 000034F4 C3                  <1> 		ret
  4286                              <1> 
  4287 000034F5 0000                <1> charposline dw 0
  4288 000034F7 00000000            <1> charposvbuf dw 0,0
  4289 000034FB 0000                <1> iconcolor dw 0
  4290                              <1> 	showicon:	;;icon in si, position in (dx,cx), selected in ax, code in bx
  4291 000034FD A2[80380000]        <1> 		mov [iconselected], al
  4292 00003502 8025[80380000]01    <1> 		and byte [iconselected], 1
  4293 00003509 B401                <1> 		mov ah, 1
  4294 0000350B E802FAFFFF          <1> 		call graphicsadd
  4295                              <1> 	showicon2:
  4296 00003510 8B3D[714A0000]      <1> 		mov edi, [physbaseptr]
  4297 00003516 6601D2              <1> 		add dx, dx
  4298 00003519 663B15[DA350000]    <1> 		cmp dx, [resolutionx2]
  4299 00003520 720C                <1> 		jb screenxgood
  4300 00003522 668B15[DA350000]    <1> 		mov dx, [resolutionx2]
  4301 00003529 6681EA4000          <1> 		sub dx, 64
  4302                              <1> 	screenxgood:
  4303 0000352E 6681F90000          <1> 		cmp cx, 0
  4304 00003533 7425                <1> 		je noscreenygoodchk
  4305 00003535 663B0D[D6350000]    <1> 		cmp cx, [resolutiony]
  4306 0000353C 720C                <1> 		jb screenygood
  4307 0000353E 668B0D[D6350000]    <1> 		mov cx, [resolutiony]
  4308 00003545 6681E92000          <1> 		sub cx, 32
  4309                              <1> 	screenygood:
  4310 0000354A BB00000000          <1> 		mov ebx, 0
  4311 0000354F 668B1D[DA350000]    <1> 		mov bx, [resolutionx2]
  4312 00003556 01DF                <1> 		add edi, ebx
  4313 00003558 E2F0                <1> 		loop screenygood
  4314                              <1> 	noscreenygoodchk:
  4315 0000355A BB00000000          <1> 		mov ebx, 0
  4316 0000355F 6689D3              <1> 		mov bx, dx
  4317 00003562 01DF                <1> 		add edi, ebx
  4318 00003564 66B90000            <1> 		mov cx, 0
  4319 00003568 668B06              <1> 		mov ax, [esi]
  4320 0000356B 81C602000000        <1> 		add esi, 2
  4321 00003571 66A3[FB340000]      <1> 		mov [iconcolor], ax
  4322                              <1> 	writeicon:
  4323 00003577 8B06                <1> 		mov eax, [esi]
  4324 00003579 D1C0                <1> 		rol eax, 1
  4325 0000357B B100                <1> 		mov cl, 0
  4326                              <1> 	writeiconline:
  4327 0000357D B201                <1> 		mov dl, 1
  4328 0000357F 20C2                <1> 		and dl, al
  4329 00003581 3215[80380000]      <1> 		xor dl, [iconselected]
  4330 00003587 668B1D[5E260000]    <1> 		mov bx, [background]
  4331 0000358E 66891F              <1> 		mov [edi], bx
  4332 00003591 80FA00              <1> 		cmp dl, 0
  4333 00003594 740A                <1> 		je noiconline
  4334 00003596 668B15[FB340000]    <1> 		mov dx, [iconcolor]
  4335 0000359D 668917              <1> 		mov [edi], dx
  4336                              <1> 	noiconline:
  4337 000035A0 81C702000000        <1> 		add edi, 2
  4338 000035A6 D1C0                <1> 		rol eax, 1
  4339 000035A8 FEC1                <1> 		inc cl
  4340 000035AA 80F920              <1> 		cmp cl, 32
  4341 000035AD 72CE                <1> 		jb writeiconline
  4342 000035AF 81C604000000        <1> 		add esi, 4
  4343 000035B5 FEC5                <1> 		inc ch
  4344 000035B7 BA00000000          <1> 		mov edx, 0
  4345 000035BC 668B15[DA350000]    <1> 		mov dx, [resolutionx2]
  4346 000035C3 01D7                <1> 		add edi, edx
  4347 000035C5 81EF40000000        <1> 		sub edi, 64
  4348 000035CB 80FD20              <1> 		cmp ch, 32
  4349 000035CE 72A7                <1> 		jb writeicon
  4350 000035D0 B800000000          <1> 		mov eax, 0
  4351 000035D5 C3                  <1> 		ret
  4352                              <1> 
  4353 000035D6 0000                <1> resolutiony dw 0
  4354 000035D8 0000                <1> resolutionx dw 0
  4355 000035DA 0000                <1> resolutionx2 dw 0
  4356 000035DC 02                  <1> resolutionbytes db 2
  4357 000035DD 0000                <1> posxvesa dw 0
  4358 000035DF 0000                <1> posyvesa dw 0
  4359 000035E1 FFFF                <1> colorfont dw 0xFFFF
  4360                              <1> savefontvesa:		;;same rules as showfontvesa
  4361 000035E3 C605[B8270000]01    <1> 	mov byte [savefonton], 1
  4362                              <1> showfontvesa:		;;position in (dx,cx), color in bx, char in al
  4363 000035EA 66890D[DF350000]    <1> 	mov [posyvesa], cx
  4364 000035F1 668915[DD350000]    <1> 	mov [posxvesa], dx
  4365 000035F8 8B3D[714A0000]      <1> 	mov edi, [physbaseptr]
  4366 000035FE 66891D[E1350000]    <1> 	mov [colorfont], bx
  4367 00003605 BB00000000          <1> 	mov ebx, 0
  4368 0000360A 88C3                <1> 	mov bl, al
  4369 0000360C B800000000          <1> 	mov eax, 0
  4370 00003611 88D8                <1> 	mov al, bl
  4371 00003613 6689D3              <1> 	mov bx, dx
  4372 00003616 89DA                <1> 	mov edx, ebx
  4373 00003618 BB00000000          <1> 	mov ebx, 0
  4374 0000361D 6681F90000          <1> 	cmp cx, 0
  4375 00003622 7415                <1> 	je vesaposloopdn
  4376 00003624 668B1D[DA350000]    <1> 	mov bx, [resolutionx2]
  4377                              <1> vesaposloop:
  4378 0000362B 01DA                <1> 	add edx, ebx
  4379 0000362D 6681E90100          <1> 	sub cx, 1
  4380 00003632 6681F90000          <1> 	cmp cx, 0
  4381 00003637 75F2                <1> 	jne vesaposloop
  4382                              <1> vesaposloopdn:
  4383 00003639 01D7                <1> 	add edi, edx
  4384 0000363B BE[29400000]        <1> 	mov esi, fonts
  4385                              <1> findfontvesa:
  4386 00003640 B400                <1> 	mov ah, 0
  4387 00003642 C1E004              <1> 	shl eax, 4
  4388 00003645 01C6                <1> 	add esi, eax
  4389 00003647 C1E804              <1> 	shr eax, 4
  4390 0000364A 81FE[49480000]      <1> 	cmp esi, fontend
  4391 00003650 0F83BF000000        <1> 	jae near donefontvesa
  4392 00003656 4E                  <1> 	dec esi
  4393                              <1> foundfontvesa:
  4394 00003657 46                  <1> 	inc esi
  4395 00003658 803D[B8270000]01    <1> 	cmp byte [savefonton], 1
  4396 0000365F 0F84E1000000        <1> 	je near vesafontsaver
  4397 00003665 B100                <1> 	mov cl, 0
  4398 00003667 8A06                <1> 	mov al, [esi]
  4399 00003669 668B15[DA350000]    <1> 	mov dx, [resolutionx2]
  4400 00003670 662B15[DD350000]    <1> 	sub dx, [posxvesa]
  4401 00003677 6681FA1000          <1> 	cmp dx, 16
  4402 0000367C 7708                <1> 	ja paintfontvesa
  4403 0000367E D0EA                <1> 	shr dl, 1
  4404 00003680 8815[45370000]      <1> 	mov [charwidth], dl
  4405                              <1> paintfontvesa:
  4406 00003686 B201                <1> 	mov dl, 1
  4407 00003688 20C2                <1> 	and dl, al
  4408 0000368A 803D[B7270000]01    <1> 	cmp byte [showcursorfonton], 1
  4409 00003691 0F8435000000        <1> 	je near nodelpaintedfont
  4410 00003697 803D[B7270000]02    <1> 	cmp byte [showcursorfonton], 2
  4411 0000369E 0F8518000000        <1> 	jne near noswitchcursorfonton
  4412 000036A4 80FA00              <1> 	cmp dl, 0
  4413 000036A7 0F842E000000        <1> 	je near nopixelset
  4414 000036AD 668B1D[E1350000]    <1> 	mov bx, [colorfont]
  4415 000036B4 66891F              <1> 	mov [edi], bx
  4416 000036B7 E91F000000          <1> 	jmp nopixelset
  4417                              <1> noswitchcursorfonton:
  4418 000036BC 3215[B9270000]      <1> 	xor dl, [mouseselecton]
  4419 000036C2 668B1D[5E260000]    <1> 	mov bx, [background]
  4420 000036C9 66891F              <1> 	mov [edi], bx
  4421                              <1> nodelpaintedfont:
  4422 000036CC 80FA00              <1> 	cmp dl, 0
  4423 000036CF 740A                <1> 	je nopixelset
  4424 000036D1 668B15[E1350000]    <1> 	mov dx, [colorfont]
  4425 000036D8 668917              <1> 	mov [edi], dx
  4426                              <1> nopixelset:
  4427 000036DB 81C702000000        <1> 	add edi, 2
  4428 000036E1 D0C0                <1> 	rol al, 1
  4429 000036E3 FEC1                <1> 	inc cl
  4430 000036E5 3A0D[45370000]      <1> 	cmp cl, [charwidth]
  4431 000036EB 7299                <1> 	jb paintfontvesa
  4432 000036ED FEC5                <1> 	inc ch
  4433 000036EF BA00000000          <1> 	mov edx, 0
  4434 000036F4 668B15[DA350000]    <1> 	mov dx, [resolutionx2]
  4435 000036FB 01D7                <1> 	add edi, edx
  4436 000036FD BA00000000          <1> 	mov edx, 0
  4437 00003702 8A15[45370000]      <1> 	mov dl, [charwidth]
  4438 00003708 00D2                <1> 	add dl, dl
  4439 0000370A 29D7                <1> 	sub edi, edx
  4440 0000370C 80FD10              <1> 	cmp ch, 16
  4441 0000370F 0F8242FFFFFF        <1> 	jb foundfontvesa
  4442                              <1> donefontvesa:
  4443 00003715 B208                <1> 	mov dl, 8
  4444 00003717 8815[45370000]      <1> 	mov [charwidth], dl
  4445 0000371D 668B15[DD350000]    <1> 	mov dx, [posxvesa]
  4446 00003724 8A1D[45370000]      <1> 	mov bl, [charwidth]
  4447 0000372A B700                <1> 	mov bh, 0
  4448 0000372C 6601DA              <1> 	add dx, bx
  4449 0000372F 668B1D[E1350000]    <1> 	mov bx, [colorfont]
  4450 00003736 668B0D[DF350000]    <1> 	mov cx, [posyvesa]
  4451 0000373D C605[B8270000]00    <1> 	mov byte [savefonton], 0
  4452 00003744 C3                  <1> 	ret
  4453 00003745 08                  <1> charwidth db 8
  4454                              <1> vesafontsaver:
  4455 00003746 B000                <1> 	mov al, 0
  4456 00003748 B100                <1> 	mov cl, 0
  4457                              <1> vesafontsaver2:
  4458 0000374A 668B17              <1> 	mov dx, [edi]
  4459 0000374D 663B15[E1350000]    <1> 	cmp dx, [colorfont]
  4460 00003754 742F                <1> 	je colorfontmatch
  4461                              <1> donecolormatch:
  4462 00003756 81C702000000        <1> 	add edi, 2
  4463 0000375C D0C0                <1> 	rol al, 1
  4464 0000375E FEC1                <1> 	inc cl
  4465 00003760 80F908              <1> 	cmp cl, 8
  4466 00003763 72E5                <1> 	jb vesafontsaver2
  4467 00003765 8806                <1> 	mov [esi], al
  4468 00003767 46                  <1> 	inc esi
  4469 00003768 FEC5                <1> 	inc ch
  4470 0000376A BA00000000          <1> 	mov edx, 0
  4471 0000376F 668B15[DA350000]    <1> 	mov dx, [resolutionx2]
  4472 00003776 01D7                <1> 	add edi, edx
  4473 00003778 81EF10000000        <1> 	sub edi, 16
  4474 0000377E 80FD10              <1> 	cmp ch, 16
  4475 00003781 72C3                <1> 	jb vesafontsaver
  4476 00003783 EB90                <1> 	jmp donefontvesa
  4477                              <1> colorfontmatch:
  4478 00003785 0401                <1> 	add al, 1
  4479 00003787 EBCD                <1> 	jmp donecolormatch
  4480                              <1> 	
  4481                              <1> showbmp:
  4482 00003789 668B06              <1> 	mov ax, [esi]
  4483 0000378C 663D424D            <1> 	cmp ax, "BM"
  4484 00003790 0F858E000000        <1> 	jne near endedbmp
  4485 00003796 8B3D[714A0000]      <1> 	mov edi, [physbaseptr]
  4486 0000379C 6689D0              <1> 	mov ax, dx
  4487 0000379F 6689CB              <1> 	mov bx, cx
  4488 000037A2 B900000000          <1> 	mov ecx, 0
  4489 000037A7 BA00000000          <1> 	mov edx, 0
  4490 000037AC 6689D9              <1> 	mov cx, bx
  4491 000037AF 6689C2              <1> 	mov dx, ax
  4492 000037B2 01D7                <1> 	add edi, edx
  4493 000037B4 01D7                <1> 	add edi, edx
  4494 000037B6 BA00000000          <1> 	mov edx, 0
  4495 000037BB 668B15[DA350000]    <1> 	mov dx, [resolutionx2]
  4496 000037C2 41                  <1> 	inc ecx
  4497 000037C3 034E16              <1> 	add ecx, [esi + 22]
  4498                              <1> bmplocloop:
  4499 000037C6 01D7                <1> 	add edi, edx
  4500 000037C8 E2FC                <1> 	loop bmplocloop
  4501 000037CA 29D7                <1> 	sub edi, edx
  4502 000037CC 8B5612              <1> 	mov edx, [esi + 18]
  4503 000037CF 8B4E16              <1> 	mov ecx, [esi + 22]
  4504 000037D2 8B460A              <1> 	mov eax, [esi + 10]
  4505 000037D5 8B5E02              <1> 	mov ebx, [esi + 2]
  4506 000037D8 01F3                <1> 	add ebx, esi
  4507 000037DA 891D[25380000]      <1> 	mov [bmpend], ebx
  4508 000037E0 89D3                <1> 	mov ebx, edx
  4509 000037E2 01C6                <1> 	add esi, eax
  4510                              <1> ldxbmp:
  4511 000037E4 668B06              <1> 	mov ax, [esi]
  4512 000037E7 668907              <1> 	mov [edi], ax
  4513 000037EA 81C702000000        <1> 	add edi, 2
  4514 000037F0 81C602000000        <1> 	add esi, 2
  4515 000037F6 3B35[25380000]      <1> 	cmp esi, [bmpend]
  4516 000037FC 7726                <1> 	ja endedbmp
  4517 000037FE 4A                  <1> 	dec edx
  4518 000037FF 81FA00000000        <1> 	cmp edx, 0
  4519 00003805 77DD                <1> 	ja ldxbmp
  4520 00003807 BA00000000          <1> 	mov edx, 0
  4521 0000380C 668B15[DA350000]    <1> 	mov dx, [resolutionx2]
  4522 00003813 29DF                <1> 	sub edi, ebx
  4523 00003815 29DF                <1> 	sub edi, ebx
  4524 00003817 29D7                <1> 	sub edi, edx
  4525 00003819 49                  <1> 	dec ecx
  4526 0000381A 89DA                <1> 	mov edx, ebx
  4527 0000381C 81F900000000        <1> 	cmp ecx, 0
  4528 00003822 77C0                <1> 	ja ldxbmp
  4529                              <1> endedbmp:
  4530 00003824 C3                  <1> 	ret
  4531                              <1> 	
  4532 00003825 00000000            <1> 	bmpend dd 0
  4533                              <1> 
  4534                              <1> ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;Here are some vars;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
  4535 00003829 00000000            <1> 	showstringesi dw 0,0
  4536 0000382D 00                  <1> 	mouseon db 0
  4537 0000382E 737461727400        <1> 	start	db "start",0
  4538 00003834 536F6C6C65724F5300  <1> 	gotomenu db "SollerOS",0
  4539 0000383D 426F6F2100          <1> 	boomsg db "Boo!",0
  4540 00003842 5061636D616E207761- <1> 	pacmsg	db "Pacman was easy to draw.",0
  4541 0000384B 73206561737920746F- <1>
  4542 00003854 20647261772E00      <1>
  4543 0000385B 4F6D206E6F6D206E6F- <1> 	pacnom  db "Om nom nom nom",0
  4544 00003864 6D206E6F6D00        <1>
  4545 0000386A 77696E646F77732073- <1> 	winmsg	db "windows sucks",0
  4546 00003873 75636B7300          <1>
  4547 00003878 5800                <1> 	xmsg db "X",0
  4548 0000387A 0000                <1> 	icon dw 0	;pointer to icon
  4549 0000387C 00000000            <1> 	codepointer dw 0,0 ;pointer to code
  4550 00003880 00                  <1> 	iconselected db 0
  4551                              <1> 	
  4552                              <1> 	boo:
  4553 00003881 BE[3D380000]        <1> 		mov esi, boomsg
  4554 00003886 66BA6400            <1> 		mov dx, 100
  4555 0000388A 66B94001            <1> 		mov cx, 320
  4556 0000388E BB00000000          <1> 		mov ebx, 0
  4557 00003893 66B80000            <1> 		mov ax, 0
  4558 00003897 E9E2F8FFFF          <1> 		jmp showstring
  4559                              <1> 
  4560                              <1> 	pacmannomnom:
  4561 0000389C BE[5B380000]        <1> 		mov esi, pacnom
  4562 000038A1 66BA8200            <1> 		mov dx, 130
  4563 000038A5 66B93C00            <1> 		mov cx, 60
  4564 000038A9 BB00000000          <1> 		mov ebx, 0
  4565 000038AE 66B80000            <1> 		mov ax, 0
  4566 000038B2 E9C7F8FFFF          <1> 		jmp showstring	
  4567                              <1> 	
  4568                              <1> 	noie:
  4569 000038B7 BE[4B390000]        <1> 		mov esi, termwindow
  4570 000038BC 66BA0000            <1> 		mov dx, 0
  4571 000038C0 66B90000            <1> 		mov cx, 0
  4572 000038C4 BB[F90D0000]        <1> 		mov ebx, nwcmd
  4573                              <1> ;;		mov ebx, internettest
  4574 000038C9 891D[2D030000]      <1> 		mov [user2codepoint], ebx
  4575 000038CF 66B80000            <1> 		mov ax, 0
  4576 000038D3 E8FBF8FFFF          <1> 		call showwindow
  4577                              <1> ;;		jmp internettest
  4578 000038D8 E91CD5FFFF          <1> 		jmp nwcmd
  4579 000038DD C3                  <1> 		ret
  4580                              <1> 
  4581                              <1> 	gotomenuboot:
  4582 000038DE BE[4B390000]        <1> 		mov esi, termwindow
  4583 000038E3 66BA0000            <1> 		mov dx, 0
  4584 000038E7 66B90000            <1> 		mov cx, 0
  4585 000038EB BB[E70C0000]        <1> 		mov ebx, os
  4586 000038F0 891D[2D030000]      <1> 		mov [user2codepoint], ebx
  4587 000038F6 66B80000            <1> 		mov ax, 0
  4588 000038FA E8D4F8FFFF          <1> 		call showwindow
  4589 000038FF E9E3D3FFFF          <1> jmp os
  4590 00003904 C3                  <1> 		ret
  4591                              <1> 
  4592                              <1> 	winblows:
  4593 00003905 BE[6A380000]        <1> 		mov esi, winmsg
  4594 0000390A 66BA0000            <1> 		mov dx, 0
  4595 0000390E 668B0D[D6350000]    <1> 		mov cx, [resolutiony]
  4596 00003915 6681E92000          <1> 		sub cx, 32
  4597 0000391A BB00000000          <1> 		mov ebx, 0
  4598 0000391F B400                <1> 		mov ah, 0
  4599 00003921 B011                <1> 		mov al, 00010001b
  4600 00003923 E856F8FFFF          <1> 		call showstring
  4601 00003928 BE[34380000]        <1> 		mov esi, gotomenu
  4602 0000392D 668B0D[D6350000]    <1> 		mov cx, [resolutiony]
  4603 00003934 6681E93000          <1> 		sub cx, 48
  4604 00003939 66BA0000            <1> 		mov dx, 0
  4605 0000393D B400                <1> 		mov ah, 0
  4606 0000393F B010                <1> 		mov al, 00010000b
  4607 00003941 BB[DE380000]        <1> 		mov ebx, gotomenuboot
  4608 00003946 E933F8FFFF          <1> 		jmp showstring
  4609                              <1> 
  4610 0000394B 8002E001            <1> 	termwindow:	dw 640,480	;;window size
  4611 0000394F 5445524D494E414C00  <1> 	termmsg:	db "TERMINAL",0	;;window title
  4612                              <1> 	
  4613 0000394F <incbin>            <1> interneticon: 	incbin 'source/precompiled/interneticon.pak'
  4614 0000394F <incbin>            <1> wordicon: 	incbin 'source/precompiled/wordicon.pak'
  4615 0000394F <incbin>            <1> pacmanpellet: incbin 'source/precompiled/pacmanpellet.pak'
  4616 0000394F <incbin>            <1> ghostie	incbin 'source/precompiled/ghostie.pak'
  4617 0000394F <incbin>            <1> pacman	incbin 'source/precompiled/pacman.pak'
  4618                                      ;%include 'source/network.asm'
  4619                                  	%include 'source/pci.asm'
  4620 00003BE2 00                  <1> pcibus		db 0
  4621 00003BE3 00                  <1> pcidevice	db 0
  4622 00003BE4 00                  <1> pcifunction	db 0
  4623 00003BE5 00                  <1> pciregister	db 0
  4624 00003BE6 00                  <1> pcireqtype db 0
  4625                              <1> 
  4626                              <1> getpciport:
  4627 00003BE7 B001                <1> 	mov al, 1
  4628 00003BE9 A2[E63B0000]        <1> 	mov [pcireqtype], al
  4629 00003BEE E91E000000          <1> 	jmp searchpci
  4630                              <1> pcidump:
  4631 00003BF3 B800000000          <1> 	mov eax, 0
  4632 00003BF8 A2[E43B0000]        <1> 	mov [pcifunction], al
  4633 00003BFD A2[E23B0000]        <1> 	mov [pcibus], al
  4634 00003C02 A2[E33B0000]        <1> 	mov [pcidevice], al
  4635 00003C07 A2[E63B0000]        <1> 	mov [pcireqtype], al
  4636 00003C0C E900000000          <1> 	jmp searchpci
  4637                              <1> searchpci:		;;return in ebx, start X in pciX
  4638 00003C11 B000                <1> 	mov al, 0
  4639 00003C13 A2[E53B0000]        <1> 	mov [pciregister], al
  4640 00003C18 E84F010000          <1> 	call getpciaddr
  4641 00003C1D BAF80C0000          <1> 	mov edx, 0xCF8
  4642 00003C22 EF                  <1> 	out dx, eax	;;request pci config
  4643 00003C23 BAFC0C0000          <1> 	mov edx, 0xCFC
  4644 00003C28 ED                  <1> 	in eax, dx 	;;read in pci config
  4645 00003C29 3D0000FFFF          <1> 	cmp eax, 0xFFFF0000
  4646 00003C2E 0F8237000000        <1> 	jb near checkpcidevice
  4647                              <1> searchpciret:
  4648                              <1> nextpcidevice:
  4649 00003C34 B000                <1> 	mov al, 0
  4650 00003C36 A2[E43B0000]        <1> 	mov [pcifunction], al
  4651 00003C3B A0[E33B0000]        <1> 	mov al, [pcidevice]
  4652 00003C40 3C1F                <1> 	cmp al, 11111b
  4653 00003C42 0F83B8000000        <1> 	jae near nextpcibus
  4654 00003C48 FEC0                <1> 	inc al
  4655 00003C4A A2[E33B0000]        <1> 	mov [pcidevice], al
  4656 00003C4F EBC0                <1> 	jmp searchpci
  4657 00003C51 A0[E43B0000]        <1> 	mov al, [pcifunction]
  4658 00003C56 3C07                <1> 	cmp al, 111b
  4659 00003C58 0F83D6FFFFFF        <1> 	jae near nextpcidevice
  4660 00003C5E FEC0                <1> 	inc al
  4661 00003C60 A2[E43B0000]        <1> 	mov [pcifunction], al
  4662 00003C65 EBAA                <1> 	jmp searchpci
  4663 00003C67 00000000            <1> pcitype: db 0,0,0,0
  4664                              <1> checkpcidevice:
  4665 00003C6B B000                <1> 	mov al, 0
  4666 00003C6D 3805[E63B0000]      <1> 	cmp [pcireqtype], al
  4667 00003C73 0F842B000000        <1> 	je near dumppcidevice
  4668 00003C79 B008                <1> 	mov al, 0x08
  4669 00003C7B A2[E53B0000]        <1> 	mov [pciregister], al	;;class code, subclass, revision id
  4670 00003C80 E8E7000000          <1> 	call getpciaddr
  4671 00003C85 BAF80C0000          <1> 	mov edx, 0xCF8
  4672 00003C8A EF                  <1> 	out dx, eax
  4673 00003C8B BAFC0C0000          <1> 	mov edx, 0xCFC
  4674 00003C90 ED                  <1> 	in eax, dx
  4675 00003C91 C1C008              <1> 	rol eax, 8
  4676 00003C94 8A1D[673C0000]      <1> 	mov bl, [pcitype]
  4677 00003C9A 38D8                <1> 	cmp al, bl
  4678 00003C9C 0F8480000000        <1> 	je near foundpciaddr
  4679 00003CA2 EB90                <1> 	jmp searchpciret
  4680                              <1> dumppcidevice:
  4681 00003CA4 B000                <1> 	mov al, 0
  4682 00003CA6 A2[E53B0000]        <1> 	mov [pciregister], al
  4683 00003CAB E8BC000000          <1> 	call getpciaddr
  4684 00003CB0 89C1                <1> 	mov ecx, eax
  4685 00003CB2 C605[D3110000]03    <1> 	mov byte [firsthexshown],3
  4686 00003CB9 E816D5FFFF          <1> 	call showhex
  4687                              <1> dumppcidevicelp:
  4688 00003CBE A2[E53B0000]        <1> 	mov [pciregister], al
  4689 00003CC3 E8A4000000          <1> 	call getpciaddr
  4690 00003CC8 BAF80C0000          <1> 	mov edx, 0xCF8
  4691 00003CCD EF                  <1> 	out dx, eax
  4692 00003CCE BAFC0C0000          <1> 	mov edx, 0xCFC
  4693 00003CD3 ED                  <1> 	in eax, dx
  4694 00003CD4 89C1                <1> 	mov ecx, eax
  4695 00003CD6 A0[E53B0000]        <1> 	mov al, [pciregister]
  4696 00003CDB 0404                <1> 	add al, 4
  4697 00003CDD 3C3C                <1> 	cmp al, 0x3C
  4698 00003CDF 730E                <1> 	jae dumppcidn
  4699 00003CE1 C605[D3110000]00    <1> 	mov byte [firsthexshown],0
  4700 00003CE8 E8E7D4FFFF          <1> 	call showhex
  4701 00003CED EBCF                <1> 	jmp dumppcidevicelp
  4702                              <1> dumppcidn:
  4703 00003CEF C605[D3110000]02    <1> 	mov byte [firsthexshown],2
  4704 00003CF6 E8D9D4FFFF          <1> 	call showhex
  4705 00003CFB E934FFFFFF          <1> 	jmp searchpciret
  4706                              <1> nextpcibus:
  4707 00003D00 B000                <1> 	mov al, 0
  4708 00003D02 A2[E33B0000]        <1> 	mov [pcidevice], al
  4709 00003D07 A0[E23B0000]        <1> 	mov al, [pcibus]
  4710 00003D0C 3C7F                <1> 	cmp al, 1111111b
  4711 00003D0E 730C                <1> 	jae donesearchpci
  4712 00003D10 FEC0                <1> 	inc al
  4713 00003D12 A2[E23B0000]        <1> 	mov [pcibus], al
  4714 00003D17 E9F5FEFFFF          <1> 	jmp searchpci
  4715                              <1> donesearchpci:
  4716 00003D1C BA00000000          <1> 	mov edx, 0
  4717 00003D21 C3                  <1> 	ret
  4718                              <1> foundpciaddr:
  4719 00003D22 B010                <1> 	mov al, 0x10
  4720 00003D24 A2[E53B0000]        <1> 	mov [pciregister], al
  4721                              <1> findpciioaddr:
  4722 00003D29 E83E000000          <1> 	call getpciaddr
  4723 00003D2E BAF80C0000          <1> 	mov edx, 0xCF8
  4724 00003D33 EF                  <1> 	out dx, eax
  4725 00003D34 BAFC0C0000          <1> 	mov edx, 0xCFC
  4726 00003D39 ED                  <1> 	in eax, dx
  4727 00003D3A 89C3                <1> 	mov ebx, eax
  4728 00003D3C 81E301000000        <1> 	and ebx, 1
  4729 00003D42 81FB00000000        <1> 	cmp ebx, 0
  4730 00003D48 0F8408000000        <1> 	je near notpciioaddr
  4731 00003D4E 2D01000000          <1> 	sub eax, 1
  4732 00003D53 89C2                <1> 	mov edx, eax
  4733 00003D55 C3                  <1> 	ret
  4734                              <1> notpciioaddr:
  4735 00003D56 A0[E53B0000]        <1> 	mov al, [pciregister]
  4736 00003D5B 0404                <1> 	add al, 4
  4737 00003D5D 3C28                <1> 	cmp al, 0x28
  4738 00003D5F 0F87CFFEFFFF        <1> 	ja near searchpciret
  4739 00003D65 A2[E53B0000]        <1> 	mov [pciregister], al
  4740 00003D6A EBBD                <1> 	jmp findpciioaddr
  4741                              <1> getpciaddr:		;;puts it in eax and ebx
  4742 00003D6C B800000000          <1> 			mov eax, 0
  4743 00003D71 BB00000080          <1> 			mov ebx, 0x80000000
  4744 00003D76 A0[E23B0000]        <1> 			mov al, [pcibus]
  4745 00003D7B C1E010              <1> 			shl eax, 16
  4746 00003D7E 01C3                <1> 			add ebx, eax
  4747 00003D80 B800000000          <1> 			mov eax, 0
  4748 00003D85 A0[E33B0000]        <1> 			mov al, [pcidevice]
  4749 00003D8A C1E00B              <1> 			shl eax, 11
  4750 00003D8D 01C3                <1> 			add ebx, eax
  4751 00003D8F B800000000          <1> 			mov eax, 0
  4752 00003D94 A0[E43B0000]        <1> 			mov al, [pcifunction]
  4753 00003D99 C1E008              <1> 			shl eax, 8
  4754 00003D9C 01C3                <1> 			add ebx, eax
  4755 00003D9E B800000000          <1> 			mov eax, 0
  4756 00003DA3 A0[E53B0000]        <1> 			mov al, [pciregister]
  4757 00003DA8 01C3                <1> 			add ebx, eax
  4758 00003DAA 89D8                <1> 			mov eax, ebx
  4759 00003DAC C3                  <1> 			ret
  4760                                  	;%include 'source/process.asm'
  4761                                      %include 'source/disk.asm'
  4762                              <1> ;;disk.asm - new - using lba
  4763                              <1> loadfile:	;;loads a file with the name buffer's location in edi into location in esi
  4764 00003DAD 803F00              <1> 	cmp byte [edi], 0
  4765 00003DB0 0F8444000000        <1> 	je near nofileload
  4766 00003DB6 89FA                <1> 	mov edx, edi
  4767 00003DB8 BB[633F0000]        <1> 	mov ebx, diskfileindex
  4768                              <1> nextnamechar:
  4769 00003DBD 8A07                <1> 	mov al, [edi]
  4770 00003DBF 8A23                <1> 	mov ah, [ebx]
  4771 00003DC1 47                  <1> 	inc edi
  4772 00003DC2 43                  <1> 	inc ebx
  4773 00003DC3 88C1                <1> 	mov cl, al
  4774 00003DC5 08E1                <1> 	or cl, ah
  4775 00003DC7 80F900              <1> 	cmp cl, 0
  4776 00003DCA 744E                <1> 	je equalfilenames
  4777 00003DCC 80F920              <1> 	cmp cl, ' '
  4778 00003DCF 7449                <1> 	je equalfilenames
  4779 00003DD1 3C2A                <1> 	cmp al, '*'
  4780 00003DD3 742B                <1> 	je equalfilenames2
  4781 00003DD5 80FC00              <1> 	cmp ah, 0
  4782 00003DD8 7410                <1> 	je nextfilename
  4783 00003DDA 3C00                <1> 	cmp al, 0
  4784 00003DDC 740C                <1> 	je nextfilename
  4785 00003DDE 38E0                <1> 	cmp al, ah
  4786 00003DE0 74DB                <1> 	je nextnamechar
  4787                              <1> getebxzero:
  4788 00003DE2 8A23                <1> 	mov ah, [ebx]
  4789 00003DE4 43                  <1> 	inc ebx
  4790 00003DE5 80FC00              <1> 	cmp ah, 0
  4791 00003DE8 75F8                <1> 	jne getebxzero
  4792                              <1> nextfilename:
  4793 00003DEA 81C308000000        <1> 	add ebx, 8		;;next descriptor
  4794 00003DF0 89D7                <1> 	mov edi, edx
  4795 00003DF2 81FB[C83F0000]      <1> 	cmp ebx, enddiskfileindex
  4796 00003DF8 72C3                <1> 	jb nextnamechar
  4797                              <1> nofileload:
  4798 00003DFA BA94010000          <1> 	mov edx, 404	;;indicate not found error
  4799 00003DFF C3                  <1> 	ret
  4800                              <1> equalfilenames2:
  4801 00003E00 81EB02000000        <1> 	sub ebx, 2
  4802                              <1> eqfilefind:
  4803 00003E06 43                  <1> 	inc ebx
  4804 00003E07 81FB[C83F0000]      <1> 	cmp ebx, enddiskfileindex
  4805 00003E0D 0F83E7FFFFFF        <1> 	jae near nofileload
  4806 00003E13 8A03                <1> 	mov al, [ebx]
  4807 00003E15 3C00                <1> 	cmp al, 0
  4808 00003E17 75ED                <1> 	jne eqfilefind
  4809 00003E19 43                  <1> 	inc ebx
  4810                              <1> equalfilenames:
  4811 00003E1A 8B4304              <1> 	mov eax, [ebx + 4] 	;;put file size in eax
  4812 00003E1D 8B1B                <1> 	mov ebx, [ebx]		;;put file beginning in ebx
  4813 00003E1F 031D[2C000000]      <1> 	add ebx, [lbaad]	;;add offset to solleros
  4814 00003E25 B900000000          <1> 	mov ecx, 0
  4815 00003E2A 88C1                <1> 	mov cl, al			;;get excess number of sectors
  4816 00003E2C D0E1                <1> 	shl cl, 1
  4817 00003E2E D0E9                <1> 	shr cl, 1			;;cut off at 128
  4818 00003E30 29C8                <1> 	sub eax, ecx		;;get rid of excess sectors
  4819 00003E32 B500                <1> 	mov ch, 0			;;drive 0
  4820 00003E34 C1E807              <1> 	shr eax, 7			;;get number of 128 sector tracks
  4821                              <1> loaddiskfile:		;;tracks in eax, excess sectors in cl, drive in ch, buffer in esi, address in ebx
  4822 00003E37 A3[753E0000]        <1> 	mov [filetracks], eax
  4823 00003E3C 89F7                <1> 	mov edi, esi		;;just in case cl is 0
  4824 00003E3E 89DA                <1> 	mov edx, ebx
  4825 00003E40 80F900              <1> 	cmp cl, 0
  4826 00003E43 7405                <1> 	je copytracksforfile
  4827 00003E45 E831000000          <1> 	call diskr		;;take care of excess sectors
  4828                              <1> copytracksforfile:
  4829 00003E4A A1[753E0000]        <1> 	mov eax, [filetracks]
  4830 00003E4F 3D00000000          <1> 	cmp eax, 0
  4831 00003E54 7419                <1> 	je donecopyfile
  4832 00003E56 48                  <1> 	dec eax
  4833 00003E57 A3[753E0000]        <1> 	mov [filetracks], eax
  4834 00003E5C 89D3                <1> 	mov ebx, edx	;;get end lba
  4835 00003E5E B180                <1> 	mov cl, 0x80
  4836 00003E60 8A2D[2B000000]      <1> 	mov ch, [DriveNumber]
  4837 00003E66 89FE                <1> 	mov esi, edi	;;reset buffer
  4838 00003E68 E80E000000          <1> 	call diskr
  4839 00003E6D EBDB                <1> 	jmp copytracksforfile
  4840                              <1> donecopyfile:
  4841 00003E6F BA00000000          <1> 	mov edx, 0	;;no error
  4842 00003E74 C3                  <1> 	ret
  4843                              <1> 	
  4844 00003E75 00000000            <1> filetracks dd 0
  4845                              <1> 	
  4846 00003E79 6400                <1> segments dw 100
  4847                              <1> 
  4848                              <1> diskr:		;;sector count in cl, disk number in ch, 48 bit address with first 32 bits in ebx, buffer in esi, puts end buffer in edi and end lba in edx
  4849 00003E7B 8935[5F3F0000]      <1> 	mov [bufferstartesi], esi
  4850 00003E81 891D[5B3F0000]      <1> 	mov [lbaadstartebx], ebx
  4851 00003E87 BA00000000          <1> 	mov edx, 0
  4852 00003E8C 88CA                <1> 	mov dl, cl
  4853 00003E8E 01DA                <1> 	add edx, ebx
  4854 00003E90 8915[573F0000]      <1> 	mov [lbaadend], edx
  4855 00003E96 66B80000            <1> 	mov ax, 0
  4856 00003E9A 66BAF101            <1> 	mov dx, 0x1F1
  4857 00003E9E EE                  <1> 	out dx, al	;;2 null bytes
  4858 00003E9F EE                  <1> 	out dx, al
  4859 00003EA0 B000                <1> 	mov al, 0
  4860 00003EA2 66BAF201            <1> 	mov dx, 0x1F2
  4861 00003EA6 EE                  <1> 	out dx, al	;;16 bit sector count-last byte now 0
  4862 00003EA7 88C8                <1> 	mov al, cl
  4863 00003EA9 EE                  <1> 	out dx, al
  4864 00003EAA 66BAF301            <1> 	mov dx, 0x1F3
  4865 00003EAE 89D8                <1> 	mov eax, ebx
  4866 00003EB0 C1C818              <1> 	ror eax, 24
  4867 00003EB3 EE                  <1> 	out dx, al	;;4th byte of address
  4868 00003EB4 C1C018              <1> 	rol eax, 24
  4869 00003EB7 EE                  <1> 	out dx, al	;;1st byte of address
  4870 00003EB8 66BAF401            <1> 	mov dx, 0x1F4
  4871 00003EBC B000                <1> 	mov al, 0
  4872 00003EBE EE                  <1> 	out dx, al	;;5th byte of address-always 0 for now
  4873 00003EBF C1C808              <1> 	ror eax, 8
  4874 00003EC2 EE                  <1> 	out dx, al	;;2nd byte of address
  4875 00003EC3 66BAF501            <1> 	mov dx, 0x1F5
  4876 00003EC7 C1C008              <1> 	rol eax, 8
  4877 00003ECA B000                <1> 	mov al, 0
  4878 00003ECC EE                  <1> 	out dx, al	;;6th byte
  4879 00003ECD C1C810              <1> 	ror eax, 16
  4880 00003ED0 EE                  <1> 	out dx, al	;;3rd byte
  4881 00003ED1 B840000000          <1> 	mov eax, 0x40
  4882 00003ED6 66BAF601            <1> 	mov dx, 0x1F6
  4883 00003EDA EE                  <1> 	out dx, al	;;send magic bits-add drive indicator later
  4884 00003EDB B024                <1> 	mov al, 0x24
  4885 00003EDD 66BAF701            <1> 	mov dx, 0x1F7
  4886 00003EE1 EE                  <1> 	out dx, al	;;READ!!!
  4887                              <1> diskrwait:
  4888 00003EE2 66BAF701            <1> 	mov dx, 0x1F7
  4889 00003EE6 EC                  <1> 	in al, dx
  4890 00003EE7 2408                <1> 	and al, 0x08
  4891 00003EE9 3C08                <1> 	cmp al, 0x08
  4892 00003EEB 75F5                <1> 	jne diskrwait
  4893 00003EED 88CD                <1> 	mov ch, cl	;;move sector data into ch, multiplying it by 256
  4894 00003EEF B100                <1> 	mov cl, 0
  4895                              <1> diskdataread:
  4896 00003EF1 66BAF001            <1> 	mov dx, 0x1F0
  4897 00003EF5 66ED                <1> 	in ax, dx
  4898 00003EF7 668906              <1> 	mov [esi], ax
  4899 00003EFA 81C602000000        <1> 	add esi, 2
  4900 00003F00 6649                <1> 	dec cx
  4901 00003F02 6681F90000          <1> 	cmp cx, 0
  4902 00003F07 75E8                <1> 	jne diskdataread		;;read all sectors
  4903 00003F09 89F7                <1> 	mov edi, esi
  4904 00003F0B 8B15[573F0000]      <1> 	mov edx, [lbaadend]
  4905 00003F11 8B35[5F3F0000]      <1> 	mov esi, [bufferstartesi]
  4906 00003F17 8B1D[5B3F0000]      <1> 	mov ebx, [lbaadstartebx]
  4907 00003F1D C3                  <1> 	ret
  4908                              <1> 	
  4909                              <1> 	
  4910                              <1> diskold: ;;28 bits
  4911 00003F1E 66B80000            <1> 	mov ax, 0
  4912 00003F22 66BAF101            <1> 	mov dx, 0x1F1
  4913 00003F26 EE                  <1> 	out dx, al	;;send null byte to port
  4914 00003F27 6642                <1> 	inc dx	;;0x1F2
  4915 00003F29 88C8                <1> 	mov al, cl	;;get sector count
  4916 00003F2B EE                  <1> 	out dx, al	;;send sector count
  4917 00003F2C 6642                <1> 	inc dx	;;0x1F3
  4918 00003F2E 88D8                <1> 	mov al, bl	;;get first 8 bits of address
  4919 00003F30 EE                  <1> 	out dx, al	;;send them
  4920 00003F31 6642                <1> 	inc dx	;;0x1F4
  4921 00003F33 C1CB08              <1> 	ror ebx, 8	;;get next 8 bits
  4922 00003F36 88D8                <1> 	mov al, bl
  4923 00003F38 EE                  <1> 	out dx, al
  4924 00003F39 6642                <1> 	inc dx	;;0x1F5
  4925 00003F3B C1CB08              <1> 	ror ebx, 8	;;again
  4926 00003F3E 88D8                <1> 	mov al, bl
  4927 00003F40 EE                  <1> 	out dx, al
  4928 00003F41 6642                <1> 	inc dx	;;0x1F6
  4929 00003F43 C1CB08              <1> 	ror ebx, 8
  4930 00003F46 88D8                <1> 	mov al, bl
  4931 00003F48 240F                <1> 	and al, 00001111b	;;last 4 bits of address
  4932 00003F4A 0CE0                <1> 	or al, 0xE0			;;majic number
  4933 00003F4C C0E504              <1> 	shl ch, 4
  4934 00003F4F 08E8                <1> 	or al, ch
  4935 00003F51 EE                  <1> 	out dx, al			;;send drive indicator, magic bits, and highest 4 bits of address
  4936 00003F52 6642                <1> 	inc dx	;;0x1F7
  4937 00003F54 B020                <1> 	mov al, 0x20
  4938 00003F56 EE                  <1> 	out dx, al			;;execute read command
  4939                              <1> 	
  4940 00003F57 00000000            <1> lbaadend dd 0
  4941 00003F5B 00000000            <1> lbaadstartebx dd 0
  4942 00003F5F 00000000            <1> bufferstartesi dd 0
  4943                                      %include 'fileindex.asm'
  4944                              <1> diskfileindex:
  4945 00003F63 65787000            <1> db "exp",0
  4946 00003F67 26000000            <1> dd (f0-$$)/512
  4947 00003F6B 01000000            <1> dd (f1-f0)/512
  4948 00003F6F 736F6C6C65726F732E- <1> db "solleros.bmp",0
  4949 00003F78 626D7000            <1>
  4950 00003F7C 27000000            <1> dd (f1-$$)/512
  4951 00003F80 B0020000            <1> dd (f2-f1)/512
  4952 00003F84 736F6C6C65726F732E- <1> db "solleros.txt",0
  4953 00003F8D 74787400            <1>
  4954 00003F91 D7020000            <1> dd (f2-$$)/512
  4955 00003F95 01000000            <1> dd (f3-f2)/512
  4956 00003F99 74656C7900          <1> db "tely",0
  4957 00003F9E D8020000            <1> dd (f3-$$)/512
  4958 00003FA2 01000000            <1> dd (f4-f3)/512
  4959 00003FA6 74696D6500          <1> db "time",0
  4960 00003FAB D9020000            <1> dd (f4-$$)/512
  4961 00003FAF 02000000            <1> dd (f5-f4)/512
  4962 00003FB3 7475746F7269616C2E- <1> db "tutorial.bat",0
  4963 00003FBC 62617400            <1>
  4964 00003FC0 DB020000            <1> dd (f5-$$)/512
  4965 00003FC4 02000000            <1> dd (f6-f5)/512
  4966                              <1> enddiskfileindex:
  4967                              <1> 
  4968                                  	%include 'source/msg.asm'
  4969 00003FC8 6578697400          <1> 	exitmsg db	"exit",0
  4970 00003FCD 50726F6772616D2022- <1> 	notfound1 db "Program ",34,0
  4971 00003FD6 00                  <1>
  4972 00003FD7 22206E6F7420666F75- <1> 	notfound2 db  34," not found.",13,10,0
  4973 00003FE0 6E642E0D0A00        <1>
  4974 00003FE6 757365726E616D653A- <1> 	userask db "username:",0
  4975 00003FEF 00                  <1>
  4976 00003FF0 70617373776F72643A- <1> 	pwdask	db	"password:",0
  4977 00003FF9 00                  <1>
  4978 00003FFA 40536F6C6C65724F53- <1> 	location	db	"@SollerOS]#",0
  4979 00004003 5D2300              <1>
  4980 00004006 0D0A00              <1> 	line	db	13,10,0
  4981                              <1>     ;msg:       db "SollerOS Beta version 0.9.0 - compiled by Jeremy Soller.",13,10,0
  4982                              <1> 	userlst:
  4983 00004009 7573657200          <1> 			db "user",0
  4984 0000400E 70617373776F726400  <1> 			db "password",0
  4985 00004017 726F6F7400          <1> 			db "root",0
  4986 0000401C 617765736F6D65706F- <1> 			db "awesomepower",0
  4987 00004025 77657200            <1>
  4988                              <1> 	userlstend:
  4989                              <1> 	
  4990 00004025 <incbin>            <1> fonts:	incbin 'source/precompiled/fonts.pak'
  4991                              <1> fontend2:
  4992                              <1> mcursor:
  4993 00004839 01                  <1> 	db	00000001b
  4994 0000483A 81                  <1> 	db	10000001b
  4995 0000483B C1                  <1> 	db	11000001b
  4996 0000483C E1                  <1> 	db	11100001b
  4997 0000483D F1                  <1> 	db	11110001b
  4998 0000483E F9                  <1> 	db	11111001b
  4999 0000483F FD                  <1> 	db	11111101b
  5000 00004840 FF                  <1> 	db	11111111b
  5001 00004841 F9                  <1> 	db	11111001b
  5002 00004842 B9                  <1> 	db	10111001b
  5003 00004843 39                  <1> 	db	00111001b
  5004 00004844 1C                  <1> 	db	00011100b
  5005 00004845 1C                  <1> 	db	00011100b
  5006 00004846 0E                  <1> 	db	00001110b
  5007 00004847 0E                  <1> 	db	00001110b
  5008 00004848 0C                  <1> 	db	00001100b
  5009                              <1> fontend:
  5010                              <1> 
  5011                              <1> ;cursorbmp:
  5012                              <1> ;	db	1,0,0,0,0,0,0,0
  5013                              <1> ;	db	1,1,0,0,0,0,0,0
  5014                              <1> ;	db	1,1,1,0,0,0,0,0
  5015                              <1> ;	db	1,1,1,1,0,0,0,0
  5016                              <1> ;	db	1,1,1,1,1,0,0,0
  5017                              <1> ;	db	1,1,1,1,1,1,0,0
  5018                              <1> ;	db	1,1,1,1,1,1,1,0
  5019                              <1> ;	db	1,1,1,1,1,1,1,1
  5020                              <1> ;	db	1,1,1,1,1,1,0,0
  5021                              <1> ;	db	1,1,0,1,1,1,0,0
  5022                              <1> ;	db	1,0,0,1,1,1,0,0
  5023                              <1> ;	db	0,0,0,0,1,1,1,0
  5024                              <1> ;	db	0,0,0,0,1,1,1,0
  5025                              <1> ;	db	0,0,0,0,0,1,1,1
  5026                              <1> ;	db	0,0,0,0,0,1,1,1
  5027                              <1> ;	db	0,0,0,0,0,1,1,0
  5028                              <1> ;cursorbmpend:
  5029                              <1> 
  5030                              <1> 
  5031                              <1> VBEMODEBLOCK:
  5032 00004849 00<rept>            <1> vbesignature 		times 4 db 0	;VBE Signature
  5033 0000484D 00<rept>            <1> vbeversion  		times 2 db 0	;VBE Version
  5034 0000484F 00<rept>            <1> oemstringptr  		times 4 db 0	;Pointer to OEM String
  5035 00004853 00<rept>            <1> capabilities 		times 4 db 0	;Capabilities of graphics cont.
  5036 00004857 00<rept>            <1> videomodeptr 		times 4 db 0	;Pointer to Video Mode List
  5037 0000485B 00<rept>            <1> totalmemory   		times 2 db 0	;number of 64Kb memory blocks
  5038 0000485D 00<rept>            <1> oemsoftwarerev  	times 2 db 0	;VBE implementation Software revision
  5039 0000485F 00<rept>            <1> oemvendornameptr 	times 4 db 0	;Pointer to Vendor Name String
  5040 00004863 00<rept>            <1> oemproductnameptr 	times 4 db 0	;Pointer to Product Name String
  5041 00004867 00<rept>            <1> oemproductrevptr 	times 4 db 0	;Pointer to Product Revision String
  5042 0000486B 00<rept>            <1> reserved			times 222 db 0	;Reserved for VBE implementation scratch area
  5043 00004949 00<rept>            <1> oemdata 			times 256 db 0	;Data Area for OEM Strings
  5044                              <1> 
  5045                              <1> 
  5046                              <1> VBEMODEINFOBLOCK:
  5047                              <1> ;Mandatory information for all VBE revision
  5048 00004A49 00<rept>            <1> modeattributes   	times 2 db 0	;Mode attributes
  5049 00004A4B 00                  <1> winaattributes   	times 1 db 0	;Window A attributes
  5050 00004A4C 00                  <1> winbattributes   	times 1 db 0	;Window B attributes
  5051 00004A4D 00<rept>            <1> wingranularity   	times 2 db 0	;Window granularity
  5052 00004A4F 00<rept>            <1> winsize          	times 2 db 0	;Window size
  5053 00004A51 00<rept>            <1> winasegment      	times 2 db 0	;Window A start segment
  5054 00004A53 00<rept>            <1> winbsegment      	times 2 db 0	;Window B start segment
  5055 00004A55 00<rept>            <1> winfuncptr       	times 4 db 0	;pointer to window function
  5056 00004A59 00<rept>            <1> bytesperscanline 	times 2 db 0	;Bytes per scan line
  5057                              <1> 
  5058                              <1> ;Mandatory information for VBE 1.2 and above
  5059 00004A5B 00<rept>            <1> xresolution     	times 2 db 0	;Horizontal resolution in pixel or chars
  5060 00004A5D 00<rept>            <1> yresolution	    	times 2 db 0	;Vertical resolution in pixel or chars
  5061 00004A5F 00                  <1> xcharsize       	times 1 db 0	;Character cell width in pixel
  5062 00004A60 00                  <1> ycharsize       	times 1 db 0	;Character cell height in pixel
  5063 00004A61 00                  <1> numberofplanes  	times 1 db 0	;Number of memory planes
  5064 00004A62 00                  <1> bitsperpixel    	times 1 db 0	;Bits per pixel
  5065 00004A63 00                  <1> numberofbanks   	times 1 db 0	;Number of banks
  5066 00004A64 00                  <1> memorymodel     	times 1 db 0	;Memory model type
  5067 00004A65 00                  <1> banksize        	times 1 db 0	;Bank size in KB
  5068 00004A66 00                  <1> numberofimagepages	times 1 db 0	;Number of images
  5069 00004A67 00                  <1> reserved1       	times 1 db 0	;Reserved for page function
  5070                              <1> 
  5071                              <1> ;Direct Color fields (required for direct/6 and YUV/7 memory models)
  5072 00004A68 00                  <1> redmasksize			times 1 db 0	;Size of direct color red mask in bits
  5073 00004A69 00                  <1> redfieldposition	times 1 db 0	;Bit position of lsb of red bask
  5074 00004A6A 00                  <1> greenmasksize   	times 1 db 0	;Size of direct color green mask in bits
  5075 00004A6B 00                  <1> greenfieldposition	times 1 db 0	;Bit position of lsb of green bask
  5076 00004A6C 00                  <1> bluemasksize		times 1 db 0	;Size of direct color blue mask in bits
  5077 00004A6D 00                  <1> bluefieldposition	times 1 db 0	;Bit position of lsb of blue bask
  5078 00004A6E 00                  <1> rsvdmasksize        times 1	db 0	;Size of direct color reserved mask in bits
  5079 00004A6F 00                  <1> rsvdfieldposition	times 1	db 0	;Bit position of lsb of reserved bask
  5080 00004A70 00                  <1> directcolormodeinfo	times 1 db 0	;Direct color mode attributes
  5081                              <1> 
  5082                              <1> ;Mandatory information for VBE 2.0 and above
  5083 00004A71 00<rept>            <1> physbaseptr 		times 4 db 0	;Physical address for flat frame buffer
  5084 00004A75 00<rept>            <1> offscreenmemoffset 	times 4 db 0	;Pointer to start of off screen memory
  5085 00004A79 00<rept>            <1> offscreenmemsize 	times 2 db 0    ;Amount of off screen memory in 1Kb units
  5086 00004A7B 00<rept>            <1> reserved2 			times 206 db 0  ;Remainder of ModeInfoBlock
  5087                                  	;%include 'source/memory.asm'
  5088                                  	%include 'source/buf.asm'
  5089                              <1> [section .bss]
  5090                              <1> bssstart:
  5091                              <1> stack:
  5092 00000000 <res 00001000>      <1> 	resb 4096
  5093                              <1> stackend:
  5094                              <1> graphicstable: ;w type, dw datalocation, w locationx, w locationy, w selected, dw code
  5095 00001000 <res 00000200>      <1> 	resb 200h 
  5096                              <1> 	graphicstableend:
  5097                              <1> mousecolorbuf: ;where the gui under the mouse is stored
  5098 00001200 <res 00000100>      <1> 	resb 256 
  5099                              <1> mcolorend:
  5100 00001300 <res 00000001>      <1> IFON resb 1 
  5101 00001301 <res 00000064>      <1> IFTRUE resb 100 
  5102 00001365 <res 00000004>      <1> BATCHPOS resb 4 
  5103 00001369 <res 00000001>      <1> BATCHISON resb 1 
  5104 0000136A <res 00000001>      <1> LOOPON resb 1 
  5105 0000136B <res 00000004>      <1> LOOPPOS	resb 4 
  5106 0000136F <res 00000200>      <1> fileindex: resb 200h 
  5107                              <1> fileindexend:
  5108 0000156F <res 00000500>      <1> variables: 	resb 500h 
  5109 00001A6F <res 00000001>      <1> varend: resb 1 
  5110 00001A70 <res 00000200>      <1> buftxt: resb 200h 
  5111 00001C70 <res 00000014>      <1> buf2:	resb 20 
  5112 00001C84 <res 00000001>      <1> numbuf: resb 1 
  5113 00001C85 <res 000012C0>      <1> videobuf2 		resb 0x12C0 
  5114 00002F45 <res 000000C8>      <1> videobufend		resb 200 
  5115                              <1> ;processcache:	;;eip, eax, ebx, ecx, edx, edi, esi, esp, ebp-9*4=36 bytes each
  5116                              <1> ;processcacheend:
  5117                              <1> ;alignb 4096		;;align 4 kbytes
  5118                              <1> ;ospagedir:
  5119                              <1> ;	resb 4096
  5120                              <1> ;ospagedirend:
  5121                              <1> ;pagetables:
  5122                              <1> ;	resb 4096
  5123                              <1> bssend:
  5124                              <1> [section .text]
  5125                                      %include 'files.asm'
  5126 00004B49 00<rept>            <1> align 512,db 0
  5127                              <1> f0:
  5128 00004B49 <incbin>            <1> incbin "included/exp"
  5129 00004C22 00<rept>            <1> align 512,db 0
  5130                              <1> f1:
  5131 00004C22 <incbin>            <1> incbin "included/solleros.bmp"
  5132 0005ADE6 00<rept>            <1> align 512,db 0
  5133                              <1> f2:
  5134 0005ADE6 <incbin>            <1> incbin "included/solleros.txt"
  5135 0005AF76 00<rept>            <1> align 512,db 0
  5136                              <1> f3:
  5137 0005AF76 <incbin>            <1> incbin "included/tely"
  5138 0005B1BD 00<rept>            <1> align 512,db 0
  5139                              <1> f4:
  5140 0005B1BD <incbin>            <1> incbin "included/time"
  5141 0005B421 00<rept>            <1> align 512,db 0
  5142                              <1> f5:
  5143 0005B421 <incbin>            <1> incbin "included/tutorial.bat"
  5144 0005B978 00<rept>            <1> align 512,db 0
  5145                              <1> f6:
