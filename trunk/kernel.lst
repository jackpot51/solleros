     1                                  [BITS 16]
     2                                      %include 'source/boot.asm'
     3                              <1>     ; MENU.ASM
     4                              <1> %include 'source/signature.asm'
     5                              <2> signature:
     6 00000000 536F6C6C65724F53    <2> db "SollerOS" ;Operating system name
     7 00000008 20416C706861204275- <2> db " Alpha Build ",0	;Soller OS development level
     8 00000011 696C642000          <2>
     9 00000016 CE000000            <2> dd 206	;version number
    10                              <2> signatureend:
    11                              <1> menustart:	
    12 0000001A 8CC8                <1> 	mov ax, cs
    13 0000001C 8ED8                <1> 	mov ds, ax
    14 0000001E 8EC0                <1> 	mov es, ax
    15 00000020 8ED0                <1> 	mov ss, ax
    16 00000022 880E[5401]          <1> 	mov [DriveNumber], cl
    17 00000026 668916[5501]        <1> 	mov [lbaad], edx
    18 0000002B E80501              <1> 	call guiload2	;make users switch using a command-this leads to very fast boots
    19 0000002E E8C901              <1> 	call getmemorysize ;get the memory map after the video is initialized
    20 00000031 6631DB              <1> 	xor ebx, ebx
    21 00000034 6631C9              <1> 	xor ecx, ecx
    22 00000037 6631D2              <1> 	xor edx, edx
    23 0000003A 6631F6              <1> 	xor esi, esi
    24 0000003D 6631FF              <1> 	xor edi, edi
    25 00000040 E94704              <1> 	jmp pmode
    26                              <1> guiswitch:
    27 00000043 B81200              <1> 	mov ax, 12h
    28 00000046 31DB                <1> 	xor bx, bx
    29 00000048 CD10                <1> 	int 10h
    30 0000004A E91600              <1> 	jmp guiloadagain
    31                              <1> guiload:
    32 0000004D BE[7204]            <1> 	mov si, bootmsg
    33 00000050 E81A01              <1> 	call printrm
    34 00000053 31C0                <1> 	xor ax, ax
    35 00000055 CD16                <1> 	int 16h
    36 00000057 3C79                <1> 	cmp al, "y"
    37 00000059 0F85D600            <1> 	jne near guiload2
    38 0000005D BE[7378]            <1> 	mov si, crlf
    39 00000060 E80A01              <1> 	call printrm
    40                              <1> guiloadagain:
    41 00000063 B8004F              <1> 	mov ax, 04F00h
    42 00000066 BF[A988]            <1> 	mov di, VBEMODEBLOCK
    43 00000069 CD10                <1> 	int 10h
    44 0000006B BE[CB88]            <1> 	mov si, reserved
    45 0000006E 81EE0200            <1> 	sub si, 2
    46                              <1> findvideomodes:
    47 00000072 81C60200            <1> 	add si, 2
    48 00000076 8B0C                <1> 	mov cx, [si]
    49 00000078 81F9FFFF            <1> 	cmp cx, 0xFFFF
    50 0000007C 0F840A00            <1> 	je near nextvmode
    51 00000080 81FE[A989]          <1> 	cmp si, oemdata
    52 00000084 0F83AB00            <1> 	jae near guiload2	;;kill if no valid list is found
    53 00000088 EBE8                <1> 	jmp findvideomodes 	
    54                              <1> ;;debug,shows vmodes available
    55                              <1> nextvmode:
    56 0000008A 81EE0200            <1> 	sub si, 2
    57 0000008E 81FE[CB88]          <1> 	cmp si, reserved
    58 00000092 0F82CDFF            <1> 	jb near guiloadagain
    59 00000096 8B0C                <1> 	mov cx, [si]
    60 00000098 81F9FFFF            <1> 	cmp cx, 0xFFFF
    61 0000009C 0F84EAFF            <1> 	je near nextvmode
    62 000000A0 81C10040            <1> 	add cx, 0x4000 		;;Linear Frame Buffer
    63 000000A4 B8014F              <1> 	mov ax, 04F01h
    64 000000A7 BF[A98A]            <1> 	mov di, VBEMODEINFOBLOCK
    65 000000AA 890E[5901]          <1> 	mov [vesamode], cx
    66 000000AE CD10                <1> 	int 10h
    67 000000B0 A0[C28A]            <1> 	mov al, [bitsperpixel]
    68 000000B3 3C10                <1> 	cmp al, 16
    69 000000B5 75D3                <1> 	jne nextvmode
    70 000000B7 8936[5B01]          <1> 	mov [videomodecache], si
    71 000000BB 84E4                <1> 	test ah, ah
    72 000000BD 0F842200            <1> 	jz near setvesamode
    73 000000C1 EBC7                <1> 	jmp nextvmode
    74 000000C3 0A0D49732074686973- <1> isthisvideook db 10,13,"Is this video mode OK?(y/n)",13,10,0
    75 000000CC 20766964656F206D6F- <1>
    76 000000D5 6465204F4B3F28792F- <1>
    77 000000DE 6E290D0A00          <1>
    78                              <1> setvesamode:
    79 000000E3 8B0E[BB8A]          <1> 	mov cx, [resolutionx]
    80 000000E7 E89B00              <1> 	call decshow
    81 000000EA B078                <1> 	mov al, "x"
    82 000000EC E80301              <1> 	call char
    83 000000EF 8B0E[BD8A]          <1> 	mov cx, [resolutiony]
    84 000000F3 E88F00              <1> 	call decshow
    85 000000F6 B040                <1> 	mov al, "@"
    86 000000F8 E8F700              <1> 	call char
    87 000000FB 8A0E[C28A]          <1> 	mov cl, [bitsperpixel]
    88 000000FF E88300              <1> 	call decshow
    89 00000102 BE[C300]            <1> 	mov si, isthisvideook
    90 00000105 E86500              <1> 	call printrm
    91 00000108 31C0                <1> 	xor ax, ax
    92 0000010A CD16                <1> 	int 16h
    93 0000010C 8B36[5B01]          <1> 	mov si, [videomodecache]
    94 00000110 3C79                <1> 	cmp al, "y"
    95 00000112 0F8574FF            <1> 	jne near nextvmode
    96 00000116 8B16[BB8A]          <1> 	mov dx, [resolutionx]
    97 0000011A 01D2                <1> 	add dx, dx
    98 0000011C 8916[A98B]          <1> 	mov [resolutionx2], dx
    99 00000120 31D2                <1> 	xor dx, dx
   100 00000122 31C9                <1> 	xor cx, cx
   101 00000124 B8024F              <1> 	mov ax, 04F02h
   102 00000127 8B1E[5901]          <1> 	mov bx, [vesamode]
   103 0000012B CD10                <1> 	int 10h		;;enter VESA mode
   104 0000012D C606[AB8B]01        <1> 	mov byte [guion], 1
   105 00000132 C3                  <1> 	ret
   106                              <1> guiload2:
   107 00000133 B9E001              <1> 	mov cx, 480
   108 00000136 BA8002              <1> 	mov dx, 640
   109 00000139 8916[BB8A]          <1> 	mov [resolutionx], dx
   110 0000013D 01D2                <1> 	add dx, dx
   111 0000013F 8916[A98B]          <1> 	mov [resolutionx2], dx
   112 00000143 890E[BD8A]          <1> 	mov [resolutiony], cx
   113 00000147 B81200              <1> 	mov ax, 12h
   114 0000014A 31DB                <1> 	xor bx, bx
   115 0000014C CD10                <1> 	int 10h
   116 0000014E C606[AB8B]00        <1> 	mov byte [guion], 0
   117 00000153 C3                  <1> 	ret
   118                              <1> 
   119 00000154 00                  <1> DriveNumber db 0
   120 00000155 00000000            <1> lbaad dd 0
   121                              <1> 	
   122 00000159 0000                <1> vesamode dw 0
   123 0000015B 0000                <1> videomodecache dw 0
   124                              <1> 
   125                              <1> tests:
   126 0000015D BB0700              <1> 	mov bx, 7
   127 00000160 B40E                <1> 	mov ah, 0Eh
   128 00000162 FEC0                <1> 	inc al
   129 00000164 3C02                <1> 	cmp al, 2
   130 00000166 7501                <1> 	jne cnttest
   131 00000168 C3                  <1> 	ret
   132                              <1> cnttest:
   133 00000169 CD10                <1> 	int 10h
   134 0000016B EBF0                <1> 	jmp tests
   135                              <1> 
   136                              <1>     printrm:			; 'si' comes in with string address
   137 0000016D BB0700              <1> 	    mov bx,07		; write to display
   138 00000170 B40E                <1> 	    mov ah,0Eh		; screen function
   139 00000172 8A04                <1>     prs2:    mov al,[si]         ; get next character
   140 00000174 3C00                <1> 	    cmp al,0		; look for terminator 
   141 00000176 7405                <1>             je finpr2		; zero byte at end of string
   142 00000178 CD10                <1> 	    int 10h		; write character to screen.    
   143 0000017A 46                  <1>      	    inc si	     	; move to next character
   144 0000017B EBF5                <1> 	    jmp prs2		; loop
   145 0000017D C3                  <1>     finpr2: ret
   146                              <1> 
   147 0000017E 0000000000          <1> dcnm db 0,0,0,0,0
   148 00000183 0000                <1> dcnmend db 0,0
   149                              <1> 
   150                              <1> 
   151                              <1> decshow:
   152 00000185 BE[7E01]            <1> 	mov si, dcnm
   153                              <1> decclear:
   154 00000188 B030                <1> 	mov al, "0"
   155 0000018A 8804                <1> 	mov [si], al
   156 0000018C 46                  <1> 	inc si
   157 0000018D 81FE[8301]          <1> 	cmp si, dcnmend
   158 00000191 76F5                <1> 	jbe decclear
   159 00000193 4E                  <1> 	dec si
   160 00000194 E81500              <1> 	call convertrm
   161 00000197 BE[7E01]            <1> 	mov si, dcnm
   162                              <1> dectst:
   163 0000019A 8A04                <1> 	mov al, [si]
   164 0000019C 46                  <1> 	inc si
   165 0000019D 81FE[8301]          <1> 	cmp si, dcnmend
   166 000001A1 7704                <1> 	ja dectstend
   167 000001A3 3C30                <1> 	cmp al, "0"
   168 000001A5 76F3                <1> 	jbe dectst
   169                              <1> dectstend:
   170 000001A7 4E                  <1> 	dec si
   171 000001A8 E8C2FF              <1> 	call printrm
   172 000001AB C3                  <1> 	ret
   173                              <1> 	
   174                              <1> 	
   175                              <1> convertrm:
   176 000001AC 4E                  <1> 	dec si
   177 000001AD 89F3                <1> 	mov bx, si		;place to convert into must be in si, number to convert must be in cx
   178                              <1> cnvrtrm:
   179 000001AF 89DE                <1> 	mov si, bx
   180 000001B1 81EE0300            <1> 	sub si, 3
   181 000001B5 46                  <1> ten3rm:	inc si
   182 000001B6 81F9E803            <1> 	cmp cx, 1000
   183 000001BA 7208                <1> 	jb ten2rm
   184 000001BC 81E9E803            <1> 	sub cx, 1000
   185 000001C0 FE04                <1> 	inc byte [si]
   186 000001C2 EBEB                <1> 	jmp cnvrtrm
   187 000001C4 46                  <1> ten2rm:	inc si
   188 000001C5 81F96400            <1> 	cmp cx, 100
   189 000001C9 7208                <1> 	jb ten1rm
   190 000001CB 81E96400            <1> 	sub cx, 100
   191 000001CF FE04                <1> 	inc byte [si]
   192 000001D1 EBDC                <1> 	jmp cnvrtrm
   193 000001D3 46                  <1> ten1rm:	inc si
   194 000001D4 81F90A00            <1> 	cmp cx, 10
   195 000001D8 7208                <1> 	jb ten0rm
   196 000001DA 81E90A00            <1> 	sub cx, 10
   197 000001DE FE04                <1> 	inc byte [si]
   198 000001E0 EBCD                <1> 	jmp cnvrtrm
   199 000001E2 46                  <1> ten0rm:	inc si
   200 000001E3 81F90100            <1> 	cmp cx, 1
   201 000001E7 7208                <1> 	jb tendnrm
   202 000001E9 81E90100            <1> 	sub cx, 1
   203 000001ED FE04                <1> 	inc byte [si]
   204 000001EF EBBE                <1> 	jmp cnvrtrm
   205                              <1> tendnrm:
   206 000001F1 C3                  <1> 	ret
   207                              <1> 
   208                              <1>     char: 		    ;char must be in al
   209 000001F2 BB0700              <1>        mov bx, 07
   210 000001F5 B40E                <1> 	   mov ah, 0Eh
   211 000001F7 CD10                <1> 	   int 10h
   212 000001F9 C3                  <1> 	   ret
   213                              <1> 
   214                              <1> 
   215                              <1> getmemorysize:
   216 000001FA BF[3002]            <1> 	mov di, memlistbuf
   217 000001FD 6631DB              <1> 	xor ebx, ebx
   218                              <1> getmemsizeloop:
   219 00000200 66B820E80000        <1> 	mov eax, 0xE820
   220 00000206 66BA50414D53        <1> 	mov edx, 0x0534D4150
   221 0000020C 66B918000000        <1> 	mov ecx, 24
   222 00000212 CD15                <1> 	int 0x15
   223 00000214 81C71800            <1> 	add di, 24
   224 00000218 81FF[7004]          <1> 	cmp di, memlistend
   225 0000021C 7309                <1> 	jae nomoregetmemsize
   226 0000021E 6681FB00000000      <1> 	cmp ebx, 0
   227 00000225 75D9                <1> 	jne getmemsizeloop
   228                              <1> nomoregetmemsize:
   229 00000227 81EF[3002]          <1> 	sub di, memlistbuf
   230 0000022B 893E[7004]          <1> 	mov [memlistend], di
   231 0000022F C3                  <1> 	ret
   232                              <1> 	
   233                              <1> 
   234                              <1> memlistbuf:
   235 00000230 00<rept>            <1> 	times 576 db 0
   236 00000470 0000                <1> memlistend: dw 0
   237                              <1> 	
   238 00000472 426F6F7420696E746F- <1> bootmsg:	db "Boot into the GUI?(y/n)",0
   239 0000047B 20746865204755493F- <1>
   240 00000484 28792F6E2900        <1>
   241                                      %include 'source/pmode.asm'
   242                              <1> [BITS 16]
   243                              <1> ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
   244                              <1> ;	16-bit real mode
   245                              <1> ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
   246                              <1> 
   247                              <1> pmode:
   248 0000048A BA9200              <1> 	mov dx, 0x92
   249 0000048D EC                  <1> 	in al, dx	;;A20
   250 0000048E 0C02                <1> 	or al, 2
   251 00000490 EE                  <1> 	out dx, al
   252 00000491 6631DB              <1> 	xor ebx, ebx
   253 00000494 8CCB                <1> 	mov bx,cs		; EBX=segment
   254 00000496 66C1E304            <1> 	shl ebx,4		;	<< 4
   255 0000049A 67668D03            <1> 	lea eax,[ebx]		; EAX=linear address of segment base
   256 0000049E A3[8507]            <1> 	mov [gdt2 + 2],ax
   257 000004A1 A3[8D07]            <1> 	mov [gdt3 + 2],ax
   258 000004A4 66C1E810            <1> 	shr eax,16
   259 000004A8 A2[8707]            <1> 	mov [gdt2 + 4],al
   260 000004AB A2[8F07]            <1> 	mov [gdt3 + 4],al
   261 000004AE 8826[8A07]          <1> 	mov [gdt2 + 7],ah
   262 000004B2 8826[9207]          <1> 	mov [gdt3 + 7],ah
   263                              <1> 	
   264 000004B6 66A1[2306]          <1> 	mov eax, [newcodecache]
   265 000004BA A3[9507]            <1> 	mov [gdt4 + 2],ax
   266 000004BD A3[9D07]            <1> 	mov [gdt5 + 2],ax
   267 000004C0 A3[A507]            <1> 	mov [gdtv8086 + 2], ax
   268 000004C3 A3[AD07]            <1> 	mov [gdtv80862 + 2], ax
   269 000004C6 66C1E810            <1> 	shr eax,16
   270 000004CA A2[9707]            <1> 	mov [gdt4 + 4],al
   271 000004CD A2[9F07]            <1> 	mov [gdt5 + 4],al
   272 000004D0 A2[A707]            <1> 	mov [gdtv8086 + 4],al
   273 000004D3 A2[AF07]            <1> 	mov [gdtv80862 + 4],al
   274 000004D6 8826[9A07]          <1> 	mov [gdt4 + 7],ah
   275 000004DA 8826[A207]          <1> 	mov [gdt5 + 7],ah
   276 000004DE 8826[AA07]          <1> 	mov [gdtv8086 + 7],ah
   277 000004E2 8826[B207]          <1> 	mov [gdtv80862 + 7],ah
   278                              <1> 	
   279 000004E6 66B800004000        <1> 	mov eax, dosprogloc
   280 000004EC 660306[2306]        <1> 	add eax, [newcodecache]
   281 000004F1 A3[B507]            <1> 	mov [gdtdos + 2],ax
   282 000004F4 A3[BD07]            <1> 	mov [gdtdos2 + 2],ax
   283 000004F7 66C1E810            <1> 	shr eax,16
   284 000004FB A2[B707]            <1> 	mov [gdtdos + 4],al
   285 000004FE A2[BF07]            <1> 	mov [gdtdos2 + 4],al
   286 00000501 8826[BA07]          <1> 	mov [gdtdos + 7],ah
   287 00000505 8826[C207]          <1> 	mov [gdtdos2 + 7],ah
   288                              <1> 	
   289                              <1> ; fix up gdt and idt
   290 00000509 67668D83[73070000]  <1> 	lea eax,[ebx + gdt]	; EAX=linear address of gdt
   291 00000511 66A3[6907]          <1> 	mov [gdtr + 2],eax
   292 00000515 67668D83[C3070000]  <1> 	lea eax,[ebx + idt]	; EAX=linear address of idt
   293 0000051D 66A3[6F07]          <1> 	mov [idtr + 2],eax
   294 00000521 FA                  <1> 	cli
   295 00000522 0F0116[6707]        <1> 	lgdt [gdtr]
   296 00000527 0F011E[6D07]        <1> 	lidt [idtr]
   297 0000052C 6631DB              <1> 	xor ebx, ebx
   298 0000052F 8CDB                <1> 	mov bx, ds
   299 00000531 66891E[1F06]        <1> 	mov [basecache], ebx
   300 00000536 0F20C0              <1> 	mov eax,cr0
   301 00000539 0C01                <1> 	or al,1
   302 0000053B 0F22C0              <1> 	mov cr0,eax
   303 0000053E EA[4305]1000        <1> 	jmp SYS_CODE_SEL:do_pm
   304                              <1> [BITS 32]
   305                              <1> do_pm:
   306 00000543 31C0                <1> 	xor eax, eax
   307 00000545 66B81800            <1> 	mov ax, SYS_DATA_SEL
   308 00000549 8ED8                <1> 	mov ds,ax
   309 0000054B 8ED0                <1> 	mov ss,ax	;;can switch back to STACK_SEL later
   310 0000054D BC[129D0000]        <1> 	mov esp, stackend	;;can switch back to 4096 later
   311 00000552 8EC0                <1> 	mov es, ax
   312 00000554 8EE0                <1> 	mov fs, ax
   313 00000556 66B82800            <1> 	mov ax, NEW_DATA_SEL
   314 0000055A 8EE8                <1> 	mov gs, ax
   315                              <1> 	
   316                              <1> copykernel:
   317 0000055C 648B06              <1> 	mov eax, [fs:esi]
   318 0000055F 658906              <1> 	mov [gs:esi], eax
   319 00000562 81C604000000        <1> 	add esi, 4
   320 00000568 81FE[128D0000]      <1> 	cmp esi, bssstart
   321 0000056E 72EC                <1> 	jb copykernel
   322 00000570 EA[77050000]2000    <1> 	jmp NEW_CODE_SEL:done_copy
   323                              <1> 	
   324                              <1> done_copy:
   325 00000577 66B82800            <1> 	mov ax, NEW_DATA_SEL	;;these MUST be setup AFTER the kernel switches places!!!
   326 0000057B 8ED8                <1> 	mov ds, ax
   327 0000057D 8ED0                <1> 	mov ss, ax
   328 0000057F BC[129D0000]        <1> 	mov esp, stackend
   329 00000584 8EC0                <1> 	mov es, ax
   330 00000586 8EE0                <1> 	mov fs, ax
   331 00000588 66B81800            <1> 	mov ax, SYS_DATA_SEL
   332 0000058C 8EE8                <1> 	mov gs, ax
   333                              <1> 	
   334 0000058E E87D500000          <1> 	call initialize	;initialize drivers
   335                              <1> 	
   336 00000593 A1[23060000]        <1> 	mov eax, [newcodecache]
   337 00000598 C1E804              <1> 	shr eax, 4
   338 0000059B A3[1F060000]        <1> 	mov [basecache], eax
   339                              <1> 	
   340 000005A0 89C3                <1> 	mov ebx, eax
   341 000005A2 C1E304              <1> 	shl ebx, 4
   342 000005A5 8B3D[D18A0000]      <1> 	mov edi, [physbaseptr]
   343 000005AB 29DF                <1> 	sub edi, ebx
   344 000005AD 893D[D18A0000]      <1> 	mov [physbaseptr], edi
   345                              <1> 	
   346 000005B3 BE[128D0000]        <1> 	mov esi, bssstart
   347 000005B8 31C0                <1> 	xor eax, eax
   348                              <1> clearkernelbuffers:
   349 000005BA 8906                <1> 	mov [esi], eax
   350 000005BC 81C604000000        <1> 	add esi, 4
   351 000005C2 81FE[48BF2100]      <1> 	cmp esi, bssend
   352 000005C8 72F0                <1> 	jb clearkernelbuffers
   353 000005CA FB                  <1> 	sti
   354                              <1> 
   355                              <1> getmemoryspace:
   356 000005CB BE[30020000]        <1> 	mov esi, memlistbuf
   357 000005D0 31FF                <1> 	xor edi, edi
   358 000005D2 668B3D[70040000]    <1> 	mov di, [memlistend]
   359 000005D9 01F7                <1> 	add edi, esi
   360 000005DB 31C0                <1> 	xor eax, eax
   361                              <1> memoryspaceaddition:
   362 000005DD 39FE                <1> 	cmp esi, edi
   363 000005DF 7322                <1> 	jae finishedmemspacecalc
   364 000005E1 81C608000000        <1> 	add esi, 8
   365 000005E7 8B0E                <1> 	mov ecx, [esi]
   366 000005E9 81C608000000        <1> 	add esi, 8
   367 000005EF 8B1E                <1> 	mov ebx, [esi]
   368 000005F1 81C608000000        <1> 	add esi, 8
   369 000005F7 81FB01000000        <1> 	cmp ebx, 1
   370 000005FD 75DE                <1> 	jne memoryspaceaddition
   371 000005FF 01C8                <1> 	add eax, ecx
   372 00000601 EBDA                <1> 	jmp memoryspaceaddition
   373                              <1> finishedmemspacecalc:
   374 00000603 A3[2C060000]        <1> 	mov [memoryspace], eax
   375                              <1> 	
   376 00000608 803D[AB8B0000]00    <1> 	cmp byte [guion], 0
   377 0000060F 0F8505000000        <1> 	jne near guistartup
   378 00000615 E93B260000          <1> 	jmp os
   379                              <1> guistartup:	;this prevents weird issues
   380 0000061A E9B3500000          <1> 	jmp gui
   381                              <1> 	
   382 0000061F 00000000            <1> basecache dd 0
   383 00000623 00001000            <1> newcodecache dd 0x100000
   384                              <1> 
   385 00000627 00                  <1> testingcpuspeed db 0
   386 00000628 00000000            <1> cpuspeedperint dd 0
   387 0000062C 00000000            <1> memoryspace dd 0
   388 00000630 7D0A                <1> pitdiv dw 2685
   389 00000632 00000000            <1> timeseconds dd 0
   390 00000636 00000000            <1> timenanoseconds dd 0
   391 0000063A 2E562200            <1> timeinterval dd 2250286;4500572
   392 0000063E 00                  <1> soundon db 0
   393 0000063F 0000                <1> soundrepititions dw 0
   394 00000641 00000000            <1> soundpos dd 0
   395 00000645 00000000            <1> soundendpos dd 0
   396 00000649 0000                <1> WAVSamplingRate dw 0
   397 0000064B 00000000            <1> WAVFileSize         dd 0
   398 0000064F 00                  <1> EnableDigitized     db 0
   399                              <1> 
   400                              <1> cpuspeedend:
   401 00000650 C605[27060000]00    <1> 	mov byte [testingcpuspeed], 0
   402 00000657 A3[28060000]        <1> 	mov [cpuspeedperint], eax
   403 0000065C B8[B5460000]        <1> 	mov eax, cpuspeedloopend
   404 00000661 890424              <1> 	mov [esp], eax
   405 00000664 E9F7000000          <1> 	jmp handled
   406                              <1> 
   407                              <1> ;if using the rtc, the default frequency yeilds a period of 976562.5ns
   408                              <1> ;if using the pit, div=451 is 377981.0004, div=5370 is 4500572.00007ns
   409                              <1> ;div=55483 is 46500044.000006ns, div=2685 is 2250286.00004ns, div=902 is 755962.0008
   410                              <1> 
   411                              <1> pitinterrupt: ;this controls threading
   412 00000669 FA                  <1> 	cli
   413 0000066A 803D[27060000]01    <1> 	cmp byte [testingcpuspeed], 1	;check to see if the cpu speed test is running
   414 00000671 74DD                <1> 	je cpuspeedend
   415                              <1> 	
   416 00000673 803D[4F060000]01    <1> 	cmp byte [EnableDigitized], 1
   417 0000067A 0F8406450000        <1> 	je near PCSpeakerPWM
   418                              <1> 	
   419 00000680 E8B4000000          <1> 	call timekeeper ;this updates the internal time
   420                              <1> 	
   421 00000685 803D[3E060000]01    <1> 	cmp byte [soundon], 1
   422 0000068C 0F840D450000        <1> 	je near PCSpeakerRAW
   423                              <1> timerinterrupt:	;put this into the interrupt handler that controls threading
   424 00000692 803D[3C720000]01    <1> 	cmp byte [threadson], 1
   425 00000699 0F8432710000        <1> 	je near threadswitch
   426                              <1> keyinterrupt:		;checks for escape, if pressed, it quits the program currently running
   427 0000069F 803D[3C720000]00    <1> 	cmp byte [threadson], 0
   428 000006A6 0F84B4000000        <1> 	je near handled
   429 000006AC FA                  <1> 	cli
   430 000006AD 60                  <1> 	pusha
   431 000006AE E460                <1> 	in al, 60h
   432 000006B0 3C01                <1> 	cmp al, 1		;escape
   433 000006B2 7405                <1> 	je userint
   434 000006B4 E9A5000000          <1> 	jmp handled2
   435                              <1> userint:
   436                              <1> 	;UNMASK ALL INTS
   437 000006B9 30C0                <1> 	xor al, al
   438 000006BB E621                <1> 	out 0x21, al
   439 000006BD 30C0                <1> 	xor al, al
   440 000006BF E6A1                <1> 	out 0xA1, al
   441 000006C1 B020                <1> 	mov al, 0x20
   442 000006C3 E6A0                <1> 	out 0xA0, al
   443 000006C5 E620                <1> 	out 0x20, al
   444                              <1> 	;RESET PIT DIVISOR
   445 000006C7 66A1[30060000]      <1> 	mov ax, [pitdiv]
   446 000006CD E640                <1> 	out 0x40, al
   447 000006CF 66C1C008            <1> 	rol ax, 8
   448 000006D3 E640                <1> 	out 0x40, al
   449                              <1> 	;RESET PIC
   450 000006D5 B020                <1> 	mov al, 0x20
   451 000006D7 E620                <1> 	out 0x20, al
   452 000006D9 61                  <1> 	popa
   453 000006DA FB                  <1> 	sti
   454 000006DB E9BC260000          <1> 	jmp nwcmd
   455                              <1> 
   456                              <1> rtl8139.irq:
   457 000006E0 FA                  <1> 	cli
   458 000006E1 60                  <1> 	pusha
   459 000006E2 8B15[CB4F0000]      <1> 	mov edx, [basenicaddr]
   460 000006E8 81C23E000000        <1> 	add edx, rtl8139.ISR
   461 000006EE 31C0                <1> 	xor eax, eax
   462 000006F0 66ED                <1> 	in ax, dx
   463 000006F2 89C1                <1> 	mov ecx, eax
   464 000006F4 E8B32B0000          <1> 	call showhex
   465 000006F9 BE[08070000]        <1> 	mov esi, rtl8139.irq.msg
   466 000006FE E8E11B0000          <1> 	call print
   467 00000703 E956000000          <1> 	jmp handled2
   468 00000708 0A5A4F4D4720544548- <1> .msg db 10,"ZOMG TEH RTL8139 REZPONDED",10,0
   469 00000711 2052544C3831333920- <1>
   470 0000071A 52455A504F4E444544- <1>
   471 00000723 0A00                <1>
   472                              <1> sblaster.irq:
   473 00000725 FA                  <1> 	cli
   474 00000726 60                  <1> 	pusha
   475 00000727 803D[124E0000]01    <1> 	cmp byte [SoundBlaster], 1
   476 0000072E 0F845F450000        <1> 	je near sblastercont
   477 00000734 E925000000          <1> 	jmp handled2
   478                              <1> 	
   479                              <1> timekeeper:
   480 00000739 50                  <1> 	push eax
   481 0000073A A1[36060000]        <1> 	mov eax, [timenanoseconds]
   482 0000073F 0305[3A060000]      <1> 	add eax, [timeinterval]
   483 00000745 3D00CA9A3B          <1> 	cmp eax, 1000000000
   484 0000074A 720B                <1> 	jb nonanosecondrollover
   485 0000074C FF05[32060000]      <1> 	inc dword [timeseconds]
   486 00000752 2D00CA9A3B          <1> 	sub eax, 1000000000
   487                              <1> nonanosecondrollover:
   488 00000757 A3[36060000]        <1> 	mov [timenanoseconds], eax
   489 0000075C 58                  <1> 	pop eax
   490 0000075D C3                  <1> 	ret
   491                              <1> 	
   492                              <1> handled2:
   493 0000075E 61                  <1> 	popa
   494                              <1> handled3:
   495 0000075F FB                  <1> 	sti
   496                              <1> handled:
   497 00000760 50                  <1> 	push eax
   498 00000761 B020                <1> 	mov al, 0x20
   499 00000763 E620                <1> 	out 0x20, al
   500 00000765 58                  <1> 	pop eax
   501 00000766 CF                  <1> 	iret
   502                              <1> [BITS 16]
   503                              <1> ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
   504                              <1> ;	16-bit limit/32-bit linear base address of GDT and IDT
   505                              <1> ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
   506 00000767 4F00                <1> gdtr:	dw gdt_end - gdt - 1	; GDT limit
   507 00000769 00000000            <1> 	dd 0    		; filled with linear, physical address of GDT
   508                              <1> 
   509 0000076D FF07                <1> idtr:	dw idt_end - idt - 1	; IDT limit
   510 0000076F 00000000            <1> 	dd 0			; filled with linear, physical address of IDT
   511                              <1> 
   512                              <1> 
   513 00000773 0000                <1> gdt:	dw 0			; limit 15:0
   514 00000775 0000                <1> 	dw 0			; base 15:0
   515 00000777 00                  <1> 	db 0			; base 23:16
   516 00000778 00                  <1> 	db 0			; type
   517 00000779 00                  <1> 	db 0			; limit 19:16, flags
   518 0000077A 00                  <1> 	db 0			; base 31:24
   519                              <1> ; linear data segment descriptor
   520                              <1> LINEAR_SEL	equ	$-gdt
   521 0000077B FFFF                <1> 	dw 0xFFFF		; limit 0xFFFFF
   522 0000077D 0000                <1> 	dw 0			; base for this one is always 0
   523 0000077F 00                  <1> 	db 0
   524 00000780 92                  <1> 	db 0x92			; present, ring 0, data, expand-up, writable
   525 00000781 CF                  <1> 	db 0xCF			; page-granular, 32-bit
   526 00000782 00                  <1> 	db 0
   527                              <1> ; code segment descriptor
   528                              <1> SYS_CODE_SEL	equ	$-gdt
   529 00000783 FFFF                <1> gdt2:	dw 0xFFFF
   530 00000785 0000                <1> 	dw 0			; (base gets set above)
   531 00000787 00                  <1> 	db 0
   532 00000788 9A                  <1> 	db 0x9A			; present, ring 0, code, non-conforming, readable
   533 00000789 CF                  <1> 	db 0xCF
   534 0000078A 00                  <1> 	db 0
   535                              <1> ; data segment descriptor
   536                              <1> SYS_DATA_SEL	equ	$-gdt
   537 0000078B FFFF                <1> gdt3:	dw 0xFFFF
   538 0000078D 0000                <1> 	dw 0			; (base gets set above)
   539 0000078F 00                  <1> 	db 0
   540 00000790 92                  <1> 	db 0x92			; present, ring 0, data, expand-up, writable
   541 00000791 CF                  <1> 	db 0xCF
   542 00000792 00                  <1> 	db 0
   543                              <1> NEW_CODE_SEL	equ	$-gdt
   544 00000793 FFFF                <1> gdt4:	dw 0xFFFF
   545 00000795 0000                <1> 	dw 0			; (base gets set above)
   546 00000797 00                  <1> 	db 0
   547 00000798 9A                  <1> 	db 0x9A			; present, ring 0, code, non-conforming, readable
   548 00000799 CF                  <1> 	db 0xCF
   549 0000079A 00                  <1> 	db 0
   550                              <1> ; data segment descriptor
   551                              <1> NEW_DATA_SEL	equ	$-gdt
   552 0000079B FFFF                <1> gdt5:	dw 0xFFFF
   553 0000079D 0000                <1> 	dw 0			; (base gets set above)
   554 0000079F 00                  <1> 	db 0
   555 000007A0 92                  <1> 	db 0x92			; present, ring 0, data, expand-up, writable
   556 000007A1 CF                  <1> 	db 0xCF
   557 000007A2 00                  <1> 	db 0
   558                              <1> V8086_CODE_SEL	equ $-gdt
   559 000007A3 FFFF                <1> gdtv8086: dw 0xFFFF
   560 000007A5 0000                <1> 	dw 0
   561 000007A7 00                  <1> 	db 0
   562 000007A8 9A                  <1> 	db 0x9A
   563 000007A9 8F                  <1> 	db 0x8F
   564 000007AA 00                  <1> 	db 0
   565                              <1> V8086_DATA_SEL	equ $-gdt
   566 000007AB FFFF                <1> gdtv80862: dw 0xFFFF
   567 000007AD 0000                <1> 	dw 0
   568 000007AF 00                  <1> 	db 0
   569 000007B0 92                  <1> 	db 0x92
   570 000007B1 8F                  <1> 	db 0x8F
   571 000007B2 00                  <1> 	db 0
   572                              <1> DOS_CODE_SEL	equ $-gdt	;this gives dos programs complete access to one megabyte at the beginning of memory
   573 000007B3 0001                <1> gdtdos:	dw 256	;give it 1 MB
   574 000007B5 0000                <1> 	dw 0
   575 000007B7 00                  <1> 	db 0
   576 000007B8 9A                  <1> 	db 0x9A
   577 000007B9 8F                  <1> 	db 0x8F ;16 bit
   578 000007BA 00                  <1> 	db 0
   579                              <1> DOS_DATA_SEL 	equ $-gdt
   580 000007BB 0001                <1> gdtdos2:	dw 256
   581 000007BD 0000                <1> 	dw 0
   582 000007BF 00                  <1> 	db 0
   583 000007C0 92                  <1> 	db 0x92
   584 000007C1 8F                  <1> 	db 0x8F ;16 bit
   585 000007C2 00                  <1> 	db 0
   586                              <1> gdt_end:
   587                              <1> ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
   588                              <1> ;	interrupt descriptor table (IDT)
   589                              <1> ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
   590                              <1> ; 32 reserved interrupts:
   591                              <1> idt:	
   592                              <1> %assign i 0
   593                              <1> %rep    32
   594                              <1> 		dw unhand + i*13,NEW_CODE_SEL,0x8E00,0
   595                              <1> %assign i i+1
   596                              <1> %endrep
   597 000007C3 [CB10]2000008E0000  <2>  dw unhand + i*13,NEW_CODE_SEL,0x8E00,0
   598                              <2> %assign i i+1
   599 000007CB [D810]2000008E0000  <2>  dw unhand + i*13,NEW_CODE_SEL,0x8E00,0
   600                              <2> %assign i i+1
   601 000007D3 [E510]2000008E0000  <2>  dw unhand + i*13,NEW_CODE_SEL,0x8E00,0
   602                              <2> %assign i i+1
   603 000007DB [F210]2000008E0000  <2>  dw unhand + i*13,NEW_CODE_SEL,0x8E00,0
   604                              <2> %assign i i+1
   605 000007E3 [FF10]2000008E0000  <2>  dw unhand + i*13,NEW_CODE_SEL,0x8E00,0
   606                              <2> %assign i i+1
   607 000007EB [0C11]2000008E0000  <2>  dw unhand + i*13,NEW_CODE_SEL,0x8E00,0
   608                              <2> %assign i i+1
   609 000007F3 [1911]2000008E0000  <2>  dw unhand + i*13,NEW_CODE_SEL,0x8E00,0
   610                              <2> %assign i i+1
   611 000007FB [2611]2000008E0000  <2>  dw unhand + i*13,NEW_CODE_SEL,0x8E00,0
   612                              <2> %assign i i+1
   613 00000803 [3311]2000008E0000  <2>  dw unhand + i*13,NEW_CODE_SEL,0x8E00,0
   614                              <2> %assign i i+1
   615 0000080B [4011]2000008E0000  <2>  dw unhand + i*13,NEW_CODE_SEL,0x8E00,0
   616                              <2> %assign i i+1
   617 00000813 [4D11]2000008E0000  <2>  dw unhand + i*13,NEW_CODE_SEL,0x8E00,0
   618                              <2> %assign i i+1
   619 0000081B [5A11]2000008E0000  <2>  dw unhand + i*13,NEW_CODE_SEL,0x8E00,0
   620                              <2> %assign i i+1
   621 00000823 [6711]2000008E0000  <2>  dw unhand + i*13,NEW_CODE_SEL,0x8E00,0
   622                              <2> %assign i i+1
   623 0000082B [7411]2000008E0000  <2>  dw unhand + i*13,NEW_CODE_SEL,0x8E00,0
   624                              <2> %assign i i+1
   625 00000833 [8111]2000008E0000  <2>  dw unhand + i*13,NEW_CODE_SEL,0x8E00,0
   626                              <2> %assign i i+1
   627 0000083B [8E11]2000008E0000  <2>  dw unhand + i*13,NEW_CODE_SEL,0x8E00,0
   628                              <2> %assign i i+1
   629 00000843 [9B11]2000008E0000  <2>  dw unhand + i*13,NEW_CODE_SEL,0x8E00,0
   630                              <2> %assign i i+1
   631 0000084B [A811]2000008E0000  <2>  dw unhand + i*13,NEW_CODE_SEL,0x8E00,0
   632                              <2> %assign i i+1
   633 00000853 [B511]2000008E0000  <2>  dw unhand + i*13,NEW_CODE_SEL,0x8E00,0
   634                              <2> %assign i i+1
   635 0000085B [C211]2000008E0000  <2>  dw unhand + i*13,NEW_CODE_SEL,0x8E00,0
   636                              <2> %assign i i+1
   637 00000863 [CF11]2000008E0000  <2>  dw unhand + i*13,NEW_CODE_SEL,0x8E00,0
   638                              <2> %assign i i+1
   639 0000086B [DC11]2000008E0000  <2>  dw unhand + i*13,NEW_CODE_SEL,0x8E00,0
   640                              <2> %assign i i+1
   641 00000873 [E911]2000008E0000  <2>  dw unhand + i*13,NEW_CODE_SEL,0x8E00,0
   642                              <2> %assign i i+1
   643 0000087B [F611]2000008E0000  <2>  dw unhand + i*13,NEW_CODE_SEL,0x8E00,0
   644                              <2> %assign i i+1
   645 00000883 [0312]2000008E0000  <2>  dw unhand + i*13,NEW_CODE_SEL,0x8E00,0
   646                              <2> %assign i i+1
   647 0000088B [1012]2000008E0000  <2>  dw unhand + i*13,NEW_CODE_SEL,0x8E00,0
   648                              <2> %assign i i+1
   649 00000893 [1D12]2000008E0000  <2>  dw unhand + i*13,NEW_CODE_SEL,0x8E00,0
   650                              <2> %assign i i+1
   651 0000089B [2A12]2000008E0000  <2>  dw unhand + i*13,NEW_CODE_SEL,0x8E00,0
   652                              <2> %assign i i+1
   653 000008A3 [3712]2000008E0000  <2>  dw unhand + i*13,NEW_CODE_SEL,0x8E00,0
   654                              <2> %assign i i+1
   655 000008AB [4412]2000008E0000  <2>  dw unhand + i*13,NEW_CODE_SEL,0x8E00,0
   656                              <2> %assign i i+1
   657 000008B3 [5112]2000008E0000  <2>  dw unhand + i*13,NEW_CODE_SEL,0x8E00,0
   658                              <2> %assign i i+1
   659 000008BB [5E12]2000008E0000  <2>  dw unhand + i*13,NEW_CODE_SEL,0x8E00,0
   660                              <2> %assign i i+1
   661 000008C3 [2D2B]2000008E0000  <1> 		dw int20h,NEW_CODE_SEL,0x8E00,0
   662 000008CB [312B]2000008E0000  <1> 		dw int21h,NEW_CODE_SEL,0x8E00,0
   663                              <1> %assign i 0x22
   664                              <1> %rep 14
   665                              <1> 		dw unhand + i*13,NEW_CODE_SEL,0x8E00,0
   666                              <1> %assign i +1
   667                              <1> %endrep
   668 000008D3 [8512]2000008E0000  <2>  dw unhand + i*13,NEW_CODE_SEL,0x8E00,0
   669                              <2> %assign i +1
   670 000008DB [D810]2000008E0000  <2>  dw unhand + i*13,NEW_CODE_SEL,0x8E00,0
   671                              <2> %assign i +1
   672 000008E3 [D810]2000008E0000  <2>  dw unhand + i*13,NEW_CODE_SEL,0x8E00,0
   673                              <2> %assign i +1
   674 000008EB [D810]2000008E0000  <2>  dw unhand + i*13,NEW_CODE_SEL,0x8E00,0
   675                              <2> %assign i +1
   676 000008F3 [D810]2000008E0000  <2>  dw unhand + i*13,NEW_CODE_SEL,0x8E00,0
   677                              <2> %assign i +1
   678 000008FB [D810]2000008E0000  <2>  dw unhand + i*13,NEW_CODE_SEL,0x8E00,0
   679                              <2> %assign i +1
   680 00000903 [D810]2000008E0000  <2>  dw unhand + i*13,NEW_CODE_SEL,0x8E00,0
   681                              <2> %assign i +1
   682 0000090B [D810]2000008E0000  <2>  dw unhand + i*13,NEW_CODE_SEL,0x8E00,0
   683                              <2> %assign i +1
   684 00000913 [D810]2000008E0000  <2>  dw unhand + i*13,NEW_CODE_SEL,0x8E00,0
   685                              <2> %assign i +1
   686 0000091B [D810]2000008E0000  <2>  dw unhand + i*13,NEW_CODE_SEL,0x8E00,0
   687                              <2> %assign i +1
   688 00000923 [D810]2000008E0000  <2>  dw unhand + i*13,NEW_CODE_SEL,0x8E00,0
   689                              <2> %assign i +1
   690 0000092B [D810]2000008E0000  <2>  dw unhand + i*13,NEW_CODE_SEL,0x8E00,0
   691                              <2> %assign i +1
   692 00000933 [D810]2000008E0000  <2>  dw unhand + i*13,NEW_CODE_SEL,0x8E00,0
   693                              <2> %assign i +1
   694 0000093B [D810]2000008E0000  <2>  dw unhand + i*13,NEW_CODE_SEL,0x8E00,0
   695                              <2> %assign i +1
   696                              <1> ;INT 30h for os use and 3rd party use:
   697 00000943 [D321]2000008E0000  <1> 		dw newints,NEW_CODE_SEL,0x8E00,0
   698                              <1> %assign i 0x31
   699                              <1> %rep 15
   700                              <1> 		dw unhand + i*13,NEW_CODE_SEL,0x8E00,0
   701                              <1> %assign i +1
   702                              <1> %endrep
   703 0000094B [4813]2000008E0000  <2>  dw unhand + i*13,NEW_CODE_SEL,0x8E00,0
   704                              <2> %assign i +1
   705 00000953 [D810]2000008E0000  <2>  dw unhand + i*13,NEW_CODE_SEL,0x8E00,0
   706                              <2> %assign i +1
   707 0000095B [D810]2000008E0000  <2>  dw unhand + i*13,NEW_CODE_SEL,0x8E00,0
   708                              <2> %assign i +1
   709 00000963 [D810]2000008E0000  <2>  dw unhand + i*13,NEW_CODE_SEL,0x8E00,0
   710                              <2> %assign i +1
   711 0000096B [D810]2000008E0000  <2>  dw unhand + i*13,NEW_CODE_SEL,0x8E00,0
   712                              <2> %assign i +1
   713 00000973 [D810]2000008E0000  <2>  dw unhand + i*13,NEW_CODE_SEL,0x8E00,0
   714                              <2> %assign i +1
   715 0000097B [D810]2000008E0000  <2>  dw unhand + i*13,NEW_CODE_SEL,0x8E00,0
   716                              <2> %assign i +1
   717 00000983 [D810]2000008E0000  <2>  dw unhand + i*13,NEW_CODE_SEL,0x8E00,0
   718                              <2> %assign i +1
   719 0000098B [D810]2000008E0000  <2>  dw unhand + i*13,NEW_CODE_SEL,0x8E00,0
   720                              <2> %assign i +1
   721 00000993 [D810]2000008E0000  <2>  dw unhand + i*13,NEW_CODE_SEL,0x8E00,0
   722                              <2> %assign i +1
   723 0000099B [D810]2000008E0000  <2>  dw unhand + i*13,NEW_CODE_SEL,0x8E00,0
   724                              <2> %assign i +1
   725 000009A3 [D810]2000008E0000  <2>  dw unhand + i*13,NEW_CODE_SEL,0x8E00,0
   726                              <2> %assign i +1
   727 000009AB [D810]2000008E0000  <2>  dw unhand + i*13,NEW_CODE_SEL,0x8E00,0
   728                              <2> %assign i +1
   729 000009B3 [D810]2000008E0000  <2>  dw unhand + i*13,NEW_CODE_SEL,0x8E00,0
   730                              <2> %assign i +1
   731 000009BB [D810]2000008E0000  <2>  dw unhand + i*13,NEW_CODE_SEL,0x8E00,0
   732                              <2> %assign i +1
   733                              <1> ;and here we are at 0x40
   734                              <1> ;here are all the irq's
   735 000009C3 [6906]2000008E0000  <1> 		dw pitinterrupt,NEW_CODE_SEL,0x8E00,0 ;IRQ 0 = PIT
   736 000009CB [6007]2000008E0000  <1> 		dw handled,NEW_CODE_SEL,0x8E00,0 ;IRQ 1 = keyboard
   737 000009D3 [6007]2000008E0000  <1> 		dw handled,NEW_CODE_SEL,0x8E00,0 ;IRQ 2
   738 000009DB [6007]2000008E0000  <1> 		dw handled,NEW_CODE_SEL,0x8E00,0 ;IRQ 3
   739 000009E3 [6007]2000008E0000  <1> 		dw handled,NEW_CODE_SEL,0x8E00,0 ;IRQ 4
   740 000009EB [2507]2000008E0000  <1> 		dw sblaster.irq,NEW_CODE_SEL,0x8E00,0 ;IRQ 5 = default SoundBlaster
   741 000009F3 [6007]2000008E0000  <1> 		dw handled,NEW_CODE_SEL,0x8E00,0 ;IRQ 6
   742 000009FB [6007]2000008E0000  <1> 		dw handled,NEW_CODE_SEL,0x8E00,0 ;IRQ 7
   743 00000A03 [6007]2000008E0000  <1> 		dw handled,NEW_CODE_SEL,0x8E00,0 ;IRQ 8 = RTC
   744 00000A0B [6007]2000008E0000  <1> 		dw handled,NEW_CODE_SEL,0x8E00,0 ;IRQ 9
   745 00000A13 [6007]2000008E0000  <1> 		dw handled,NEW_CODE_SEL,0x8E00,0 ;IRQ 10
   746 00000A1B [E006]2000008E0000  <1> 		dw rtl8139.irq,NEW_CODE_SEL,0x8E00,0 ;IRQ 11 = default RTL8139
   747 00000A23 [6007]2000008E0000  <1> 		dw handled,NEW_CODE_SEL,0x8E00,0 ;IRQ 12
   748 00000A2B [6007]2000008E0000  <1> 		dw handled,NEW_CODE_SEL,0x8E00,0 ;IRQ 13
   749 00000A33 [6007]2000008E0000  <1> 		dw handled,NEW_CODE_SEL,0x8E00,0 ;IRQ 14
   750 00000A3B [6007]2000008E0000  <1> 		dw handled,NEW_CODE_SEL,0x8E00,0 ;IRQ 15
   751                              <1> ;This brings me up to 0x50
   752                              <1> %assign i 0x50
   753                              <1> %rep 176
   754                              <1> 		dw handled, NEW_CODE_SEL,0x8E00,0
   755                              <1> 		;dw unhand + i*13, NEW_CODE_SEL,0x8E00,0
   756                              <1> %assign i +1
   757                              <1> %endrep
   758 00000A43 [6007]2000008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
   759                              <2> 
   760                              <2> %assign i +1
   761 00000A4B [6007]2000008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
   762                              <2> 
   763                              <2> %assign i +1
   764 00000A53 [6007]2000008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
   765                              <2> 
   766                              <2> %assign i +1
   767 00000A5B [6007]2000008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
   768                              <2> 
   769                              <2> %assign i +1
   770 00000A63 [6007]2000008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
   771                              <2> 
   772                              <2> %assign i +1
   773 00000A6B [6007]2000008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
   774                              <2> 
   775                              <2> %assign i +1
   776 00000A73 [6007]2000008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
   777                              <2> 
   778                              <2> %assign i +1
   779 00000A7B [6007]2000008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
   780                              <2> 
   781                              <2> %assign i +1
   782 00000A83 [6007]2000008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
   783                              <2> 
   784                              <2> %assign i +1
   785 00000A8B [6007]2000008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
   786                              <2> 
   787                              <2> %assign i +1
   788 00000A93 [6007]2000008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
   789                              <2> 
   790                              <2> %assign i +1
   791 00000A9B [6007]2000008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
   792                              <2> 
   793                              <2> %assign i +1
   794 00000AA3 [6007]2000008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
   795                              <2> 
   796                              <2> %assign i +1
   797 00000AAB [6007]2000008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
   798                              <2> 
   799                              <2> %assign i +1
   800 00000AB3 [6007]2000008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
   801                              <2> 
   802                              <2> %assign i +1
   803 00000ABB [6007]2000008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
   804                              <2> 
   805                              <2> %assign i +1
   806 00000AC3 [6007]2000008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
   807                              <2> 
   808                              <2> %assign i +1
   809 00000ACB [6007]2000008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
   810                              <2> 
   811                              <2> %assign i +1
   812 00000AD3 [6007]2000008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
   813                              <2> 
   814                              <2> %assign i +1
   815 00000ADB [6007]2000008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
   816                              <2> 
   817                              <2> %assign i +1
   818 00000AE3 [6007]2000008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
   819                              <2> 
   820                              <2> %assign i +1
   821 00000AEB [6007]2000008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
   822                              <2> 
   823                              <2> %assign i +1
   824 00000AF3 [6007]2000008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
   825                              <2> 
   826                              <2> %assign i +1
   827 00000AFB [6007]2000008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
   828                              <2> 
   829                              <2> %assign i +1
   830 00000B03 [6007]2000008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
   831                              <2> 
   832                              <2> %assign i +1
   833 00000B0B [6007]2000008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
   834                              <2> 
   835                              <2> %assign i +1
   836 00000B13 [6007]2000008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
   837                              <2> 
   838                              <2> %assign i +1
   839 00000B1B [6007]2000008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
   840                              <2> 
   841                              <2> %assign i +1
   842 00000B23 [6007]2000008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
   843                              <2> 
   844                              <2> %assign i +1
   845 00000B2B [6007]2000008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
   846                              <2> 
   847                              <2> %assign i +1
   848 00000B33 [6007]2000008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
   849                              <2> 
   850                              <2> %assign i +1
   851 00000B3B [6007]2000008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
   852                              <2> 
   853                              <2> %assign i +1
   854 00000B43 [6007]2000008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
   855                              <2> 
   856                              <2> %assign i +1
   857 00000B4B [6007]2000008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
   858                              <2> 
   859                              <2> %assign i +1
   860 00000B53 [6007]2000008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
   861                              <2> 
   862                              <2> %assign i +1
   863 00000B5B [6007]2000008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
   864                              <2> 
   865                              <2> %assign i +1
   866 00000B63 [6007]2000008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
   867                              <2> 
   868                              <2> %assign i +1
   869 00000B6B [6007]2000008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
   870                              <2> 
   871                              <2> %assign i +1
   872 00000B73 [6007]2000008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
   873                              <2> 
   874                              <2> %assign i +1
   875 00000B7B [6007]2000008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
   876                              <2> 
   877                              <2> %assign i +1
   878 00000B83 [6007]2000008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
   879                              <2> 
   880                              <2> %assign i +1
   881 00000B8B [6007]2000008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
   882                              <2> 
   883                              <2> %assign i +1
   884 00000B93 [6007]2000008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
   885                              <2> 
   886                              <2> %assign i +1
   887 00000B9B [6007]2000008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
   888                              <2> 
   889                              <2> %assign i +1
   890 00000BA3 [6007]2000008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
   891                              <2> 
   892                              <2> %assign i +1
   893 00000BAB [6007]2000008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
   894                              <2> 
   895                              <2> %assign i +1
   896 00000BB3 [6007]2000008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
   897                              <2> 
   898                              <2> %assign i +1
   899 00000BBB [6007]2000008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
   900                              <2> 
   901                              <2> %assign i +1
   902 00000BC3 [6007]2000008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
   903                              <2> 
   904                              <2> %assign i +1
   905 00000BCB [6007]2000008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
   906                              <2> 
   907                              <2> %assign i +1
   908 00000BD3 [6007]2000008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
   909                              <2> 
   910                              <2> %assign i +1
   911 00000BDB [6007]2000008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
   912                              <2> 
   913                              <2> %assign i +1
   914 00000BE3 [6007]2000008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
   915                              <2> 
   916                              <2> %assign i +1
   917 00000BEB [6007]2000008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
   918                              <2> 
   919                              <2> %assign i +1
   920 00000BF3 [6007]2000008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
   921                              <2> 
   922                              <2> %assign i +1
   923 00000BFB [6007]2000008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
   924                              <2> 
   925                              <2> %assign i +1
   926 00000C03 [6007]2000008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
   927                              <2> 
   928                              <2> %assign i +1
   929 00000C0B [6007]2000008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
   930                              <2> 
   931                              <2> %assign i +1
   932 00000C13 [6007]2000008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
   933                              <2> 
   934                              <2> %assign i +1
   935 00000C1B [6007]2000008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
   936                              <2> 
   937                              <2> %assign i +1
   938 00000C23 [6007]2000008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
   939                              <2> 
   940                              <2> %assign i +1
   941 00000C2B [6007]2000008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
   942                              <2> 
   943                              <2> %assign i +1
   944 00000C33 [6007]2000008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
   945                              <2> 
   946                              <2> %assign i +1
   947 00000C3B [6007]2000008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
   948                              <2> 
   949                              <2> %assign i +1
   950 00000C43 [6007]2000008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
   951                              <2> 
   952                              <2> %assign i +1
   953 00000C4B [6007]2000008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
   954                              <2> 
   955                              <2> %assign i +1
   956 00000C53 [6007]2000008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
   957                              <2> 
   958                              <2> %assign i +1
   959 00000C5B [6007]2000008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
   960                              <2> 
   961                              <2> %assign i +1
   962 00000C63 [6007]2000008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
   963                              <2> 
   964                              <2> %assign i +1
   965 00000C6B [6007]2000008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
   966                              <2> 
   967                              <2> %assign i +1
   968 00000C73 [6007]2000008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
   969                              <2> 
   970                              <2> %assign i +1
   971 00000C7B [6007]2000008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
   972                              <2> 
   973                              <2> %assign i +1
   974 00000C83 [6007]2000008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
   975                              <2> 
   976                              <2> %assign i +1
   977 00000C8B [6007]2000008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
   978                              <2> 
   979                              <2> %assign i +1
   980 00000C93 [6007]2000008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
   981                              <2> 
   982                              <2> %assign i +1
   983 00000C9B [6007]2000008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
   984                              <2> 
   985                              <2> %assign i +1
   986 00000CA3 [6007]2000008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
   987                              <2> 
   988                              <2> %assign i +1
   989 00000CAB [6007]2000008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
   990                              <2> 
   991                              <2> %assign i +1
   992 00000CB3 [6007]2000008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
   993                              <2> 
   994                              <2> %assign i +1
   995 00000CBB [6007]2000008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
   996                              <2> 
   997                              <2> %assign i +1
   998 00000CC3 [6007]2000008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
   999                              <2> 
  1000                              <2> %assign i +1
  1001 00000CCB [6007]2000008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1002                              <2> 
  1003                              <2> %assign i +1
  1004 00000CD3 [6007]2000008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1005                              <2> 
  1006                              <2> %assign i +1
  1007 00000CDB [6007]2000008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1008                              <2> 
  1009                              <2> %assign i +1
  1010 00000CE3 [6007]2000008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1011                              <2> 
  1012                              <2> %assign i +1
  1013 00000CEB [6007]2000008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1014                              <2> 
  1015                              <2> %assign i +1
  1016 00000CF3 [6007]2000008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1017                              <2> 
  1018                              <2> %assign i +1
  1019 00000CFB [6007]2000008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1020                              <2> 
  1021                              <2> %assign i +1
  1022 00000D03 [6007]2000008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1023                              <2> 
  1024                              <2> %assign i +1
  1025 00000D0B [6007]2000008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1026                              <2> 
  1027                              <2> %assign i +1
  1028 00000D13 [6007]2000008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1029                              <2> 
  1030                              <2> %assign i +1
  1031 00000D1B [6007]2000008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1032                              <2> 
  1033                              <2> %assign i +1
  1034 00000D23 [6007]2000008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1035                              <2> 
  1036                              <2> %assign i +1
  1037 00000D2B [6007]2000008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1038                              <2> 
  1039                              <2> %assign i +1
  1040 00000D33 [6007]2000008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1041                              <2> 
  1042                              <2> %assign i +1
  1043 00000D3B [6007]2000008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1044                              <2> 
  1045                              <2> %assign i +1
  1046 00000D43 [6007]2000008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1047                              <2> 
  1048                              <2> %assign i +1
  1049 00000D4B [6007]2000008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1050                              <2> 
  1051                              <2> %assign i +1
  1052 00000D53 [6007]2000008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1053                              <2> 
  1054                              <2> %assign i +1
  1055 00000D5B [6007]2000008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1056                              <2> 
  1057                              <2> %assign i +1
  1058 00000D63 [6007]2000008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1059                              <2> 
  1060                              <2> %assign i +1
  1061 00000D6B [6007]2000008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1062                              <2> 
  1063                              <2> %assign i +1
  1064 00000D73 [6007]2000008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1065                              <2> 
  1066                              <2> %assign i +1
  1067 00000D7B [6007]2000008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1068                              <2> 
  1069                              <2> %assign i +1
  1070 00000D83 [6007]2000008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1071                              <2> 
  1072                              <2> %assign i +1
  1073 00000D8B [6007]2000008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1074                              <2> 
  1075                              <2> %assign i +1
  1076 00000D93 [6007]2000008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1077                              <2> 
  1078                              <2> %assign i +1
  1079 00000D9B [6007]2000008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1080                              <2> 
  1081                              <2> %assign i +1
  1082 00000DA3 [6007]2000008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1083                              <2> 
  1084                              <2> %assign i +1
  1085 00000DAB [6007]2000008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1086                              <2> 
  1087                              <2> %assign i +1
  1088 00000DB3 [6007]2000008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1089                              <2> 
  1090                              <2> %assign i +1
  1091 00000DBB [6007]2000008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1092                              <2> 
  1093                              <2> %assign i +1
  1094 00000DC3 [6007]2000008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1095                              <2> 
  1096                              <2> %assign i +1
  1097 00000DCB [6007]2000008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1098                              <2> 
  1099                              <2> %assign i +1
  1100 00000DD3 [6007]2000008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1101                              <2> 
  1102                              <2> %assign i +1
  1103 00000DDB [6007]2000008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1104                              <2> 
  1105                              <2> %assign i +1
  1106 00000DE3 [6007]2000008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1107                              <2> 
  1108                              <2> %assign i +1
  1109 00000DEB [6007]2000008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1110                              <2> 
  1111                              <2> %assign i +1
  1112 00000DF3 [6007]2000008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1113                              <2> 
  1114                              <2> %assign i +1
  1115 00000DFB [6007]2000008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1116                              <2> 
  1117                              <2> %assign i +1
  1118 00000E03 [6007]2000008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1119                              <2> 
  1120                              <2> %assign i +1
  1121 00000E0B [6007]2000008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1122                              <2> 
  1123                              <2> %assign i +1
  1124 00000E13 [6007]2000008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1125                              <2> 
  1126                              <2> %assign i +1
  1127 00000E1B [6007]2000008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1128                              <2> 
  1129                              <2> %assign i +1
  1130 00000E23 [6007]2000008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1131                              <2> 
  1132                              <2> %assign i +1
  1133 00000E2B [6007]2000008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1134                              <2> 
  1135                              <2> %assign i +1
  1136 00000E33 [6007]2000008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1137                              <2> 
  1138                              <2> %assign i +1
  1139 00000E3B [6007]2000008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1140                              <2> 
  1141                              <2> %assign i +1
  1142 00000E43 [6007]2000008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1143                              <2> 
  1144                              <2> %assign i +1
  1145 00000E4B [6007]2000008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1146                              <2> 
  1147                              <2> %assign i +1
  1148 00000E53 [6007]2000008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1149                              <2> 
  1150                              <2> %assign i +1
  1151 00000E5B [6007]2000008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1152                              <2> 
  1153                              <2> %assign i +1
  1154 00000E63 [6007]2000008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1155                              <2> 
  1156                              <2> %assign i +1
  1157 00000E6B [6007]2000008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1158                              <2> 
  1159                              <2> %assign i +1
  1160 00000E73 [6007]2000008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1161                              <2> 
  1162                              <2> %assign i +1
  1163 00000E7B [6007]2000008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1164                              <2> 
  1165                              <2> %assign i +1
  1166 00000E83 [6007]2000008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1167                              <2> 
  1168                              <2> %assign i +1
  1169 00000E8B [6007]2000008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1170                              <2> 
  1171                              <2> %assign i +1
  1172 00000E93 [6007]2000008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1173                              <2> 
  1174                              <2> %assign i +1
  1175 00000E9B [6007]2000008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1176                              <2> 
  1177                              <2> %assign i +1
  1178 00000EA3 [6007]2000008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1179                              <2> 
  1180                              <2> %assign i +1
  1181 00000EAB [6007]2000008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1182                              <2> 
  1183                              <2> %assign i +1
  1184 00000EB3 [6007]2000008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1185                              <2> 
  1186                              <2> %assign i +1
  1187 00000EBB [6007]2000008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1188                              <2> 
  1189                              <2> %assign i +1
  1190 00000EC3 [6007]2000008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1191                              <2> 
  1192                              <2> %assign i +1
  1193 00000ECB [6007]2000008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1194                              <2> 
  1195                              <2> %assign i +1
  1196 00000ED3 [6007]2000008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1197                              <2> 
  1198                              <2> %assign i +1
  1199 00000EDB [6007]2000008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1200                              <2> 
  1201                              <2> %assign i +1
  1202 00000EE3 [6007]2000008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1203                              <2> 
  1204                              <2> %assign i +1
  1205 00000EEB [6007]2000008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1206                              <2> 
  1207                              <2> %assign i +1
  1208 00000EF3 [6007]2000008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1209                              <2> 
  1210                              <2> %assign i +1
  1211 00000EFB [6007]2000008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1212                              <2> 
  1213                              <2> %assign i +1
  1214 00000F03 [6007]2000008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1215                              <2> 
  1216                              <2> %assign i +1
  1217 00000F0B [6007]2000008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1218                              <2> 
  1219                              <2> %assign i +1
  1220 00000F13 [6007]2000008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1221                              <2> 
  1222                              <2> %assign i +1
  1223 00000F1B [6007]2000008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1224                              <2> 
  1225                              <2> %assign i +1
  1226 00000F23 [6007]2000008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1227                              <2> 
  1228                              <2> %assign i +1
  1229 00000F2B [6007]2000008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1230                              <2> 
  1231                              <2> %assign i +1
  1232 00000F33 [6007]2000008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1233                              <2> 
  1234                              <2> %assign i +1
  1235 00000F3B [6007]2000008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1236                              <2> 
  1237                              <2> %assign i +1
  1238 00000F43 [6007]2000008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1239                              <2> 
  1240                              <2> %assign i +1
  1241 00000F4B [6007]2000008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1242                              <2> 
  1243                              <2> %assign i +1
  1244 00000F53 [6007]2000008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1245                              <2> 
  1246                              <2> %assign i +1
  1247 00000F5B [6007]2000008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1248                              <2> 
  1249                              <2> %assign i +1
  1250 00000F63 [6007]2000008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1251                              <2> 
  1252                              <2> %assign i +1
  1253 00000F6B [6007]2000008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1254                              <2> 
  1255                              <2> %assign i +1
  1256 00000F73 [6007]2000008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1257                              <2> 
  1258                              <2> %assign i +1
  1259 00000F7B [6007]2000008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1260                              <2> 
  1261                              <2> %assign i +1
  1262 00000F83 [6007]2000008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1263                              <2> 
  1264                              <2> %assign i +1
  1265 00000F8B [6007]2000008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1266                              <2> 
  1267                              <2> %assign i +1
  1268 00000F93 [6007]2000008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1269                              <2> 
  1270                              <2> %assign i +1
  1271 00000F9B [6007]2000008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1272                              <2> 
  1273                              <2> %assign i +1
  1274 00000FA3 [6007]2000008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1275                              <2> 
  1276                              <2> %assign i +1
  1277 00000FAB [6007]2000008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1278                              <2> 
  1279                              <2> %assign i +1
  1280 00000FB3 [6007]2000008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1281                              <2> 
  1282                              <2> %assign i +1
  1283 00000FBB [6007]2000008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1284                              <2> 
  1285                              <2> %assign i +1
  1286                              <1> idt_end:
  1287                              <1> [BITS 32]
  1288                                  	%include 'source/realmode.asm'
  1289                              <1> realmode:	;make sure the real mode program's address is in realmodeptr 
  1290                              <1> 			;and the return address is in realmodereturn
  1291 00000FC3 FA                  <1> 	cli
  1292 00000FC4 A3[BD100000]        <1> 	mov [realmodeeax], eax
  1293 00000FC9 891D[B9100000]      <1> 	mov [realmodeebx], ebx
  1294                              <1> 
  1295 00000FCF BB[B5100000]        <1> 	mov ebx, cr0old
  1296                              <1> rmcopytofirstmbyte:
  1297 00000FD4 8B03                <1> 	mov eax, [ebx]
  1298 00000FD6 658903              <1> 	mov [gs:ebx], eax
  1299 00000FD9 81C304000000        <1> 	add ebx, 4
  1300 00000FDF 81FB[C5100000]      <1> 	cmp ebx, realmodeptr
  1301 00000FE5 76ED                <1> 	jbe rmcopytofirstmbyte
  1302                              <1> 
  1303 00000FE7 EA[EE0F0000]3000    <1> 	jmp V8086_CODE_SEL:protected16bit
  1304                              <1> 
  1305                              <1> [BITS 16]
  1306                              <1> protected16bit:
  1307 00000FEE B83800              <1> 	mov ax, V8086_DATA_SEL
  1308 00000FF1 8ED8                <1> 	mov ds, ax
  1309 00000FF3 8EC0                <1> 	mov es, ax
  1310 00000FF5 8EE0                <1> 	mov fs, ax
  1311 00000FF7 8EE8                <1> 	mov gs, ax
  1312 00000FF9 8ED0                <1> 	mov ss, ax
  1313 00000FFB 0F20C0              <1> 	mov eax, cr0
  1314 00000FFE 66A3[B510]          <1> 	mov [cr0old], eax
  1315 00001002 6625FEFFFF7F        <1> 	and eax, 0x7FFFFFFE
  1316 00001008 0F22C0              <1> 	mov cr0, eax	;now in real mode
  1317 0000100B EA[1010]0010        <1> 	jmp 0x1000:inrealmode
  1318                              <1> 
  1319                              <1> inrealmode:
  1320 00001010 8CC8                <1> 	mov ax, cs
  1321 00001012 8ED8                <1> 	mov ds, ax
  1322 00001014 8EC0                <1> 	mov es, ax
  1323 00001016 8EE0                <1> 	mov fs, ax
  1324 00001018 8EE8                <1> 	mov gs, ax
  1325 0000101A 8ED0                <1> 	mov ss, ax
  1326                              <1> 	
  1327 0000101C B011                <1> 	mov al, 0x11
  1328 0000101E E620                <1> 	out 0x20, al
  1329 00001020 E6A0                <1> 	out 0xA0, al
  1330 00001022 B008                <1> 	mov al, 0x8		;interrupt for master
  1331 00001024 E621                <1> 	out 0x21, al
  1332 00001026 B070                <1> 	mov al, 0x70	;interrupt for slave
  1333 00001028 E6A1                <1> 	out 0xA1, al
  1334 0000102A B004                <1> 	mov al, 4
  1335 0000102C E621                <1> 	out 0x21, al
  1336 0000102E B002                <1> 	mov al, 2
  1337 00001030 E6A1                <1> 	out 0xA1, al
  1338 00001032 B001                <1> 	mov al, 0x1
  1339 00001034 E621                <1> 	out 0x21, al
  1340 00001036 B001                <1> 	mov al, 0x1
  1341 00001038 E6A1                <1> 	out 0xA1, al
  1342                              <1> 	
  1343 0000103A 0F011E[AF10]        <1> 	lidt [idt_real]
  1344 0000103F FB                  <1> 	sti
  1345                              <1> 
  1346 00001040 66A1[BD10]          <1> 	mov eax, [realmodeeax]
  1347 00001044 668B1E[B910]        <1> 	mov ebx, [realmodeebx]
  1348                              <1> 
  1349 00001049 FF16[C510]          <1> 	call word [realmodeptr] ;call the real mode program here
  1350                              <1> 
  1351 0000104D 66A3[BD10]          <1> 	mov [realmodeeax], eax
  1352 00001051 66891E[B910]        <1> 	mov [realmodeebx], ebx
  1353                              <1> 
  1354 00001056 FA                  <1> 	cli
  1355 00001057 0F0116[6707]        <1> 	lgdt [gdtr]
  1356 0000105C 0F011E[6D07]        <1> 	lidt [idtr]
  1357 00001061 0F20C0              <1> 	mov eax, cr0
  1358 00001064 0C01                <1> 	or al, 1
  1359 00001066 0F22C0              <1> 	mov cr0,eax
  1360 00001069 EA[6E10]2000        <1> 	jmp NEW_CODE_SEL:returntopmode
  1361                              <1> 
  1362                              <1> [BITS 32]
  1363                              <1> returntopmode:
  1364 0000106E 66B82800            <1> 	mov ax, NEW_DATA_SEL
  1365 00001072 8ED8                <1> 	mov ds, ax
  1366 00001074 8EC0                <1> 	mov es, ax
  1367 00001076 8EE0                <1> 	mov fs, ax
  1368 00001078 8ED0                <1> 	mov ss, ax
  1369 0000107A 66B81800            <1> 	mov ax, SYS_DATA_SEL
  1370 0000107E 8EE8                <1> 	mov gs, ax
  1371                              <1> 
  1372 00001080 BB[B5100000]        <1> 	mov ebx, cr0old
  1373                              <1> rmcopyfromfirstmbyte:
  1374 00001085 658B03              <1> 	mov eax, [gs:ebx]
  1375 00001088 8903                <1> 	mov [ebx], eax
  1376 0000108A 81C304000000        <1> 	add ebx, 4
  1377 00001090 81FB[C5100000]      <1> 	cmp ebx, realmodeptr
  1378 00001096 76ED                <1> 	jbe rmcopyfromfirstmbyte
  1379                              <1> 
  1380 00001098 E88C450000          <1> 	call initialize.pic ;reset irq's and masks
  1381 0000109D FB                  <1> 	sti
  1382 0000109E A1[BD100000]        <1> 	mov eax, [realmodeeax]
  1383 000010A3 8B1D[B9100000]      <1> 	mov ebx, [realmodeebx]
  1384 000010A9 FF25[C1100000]      <1> 	jmp dword [realmodereturn]
  1385                              <1> 
  1386                              <1> idt_real:
  1387 000010AF FF03                <1> 	dw 0x3FF
  1388 000010B1 00000000            <1> 	dd 0
  1389 000010B5 00000000            <1> cr0old dd 0
  1390 000010B9 00000000            <1> realmodeebx dd 0
  1391 000010BD 00000000            <1> realmodeeax dd 0
  1392 000010C1 00000000            <1> realmodereturn dd 0
  1393 000010C5 0000                <1> realmodeptr dw 0
  1394 000010C7 00000000            <1> dd 0 ;make sure the copy thing doesnt overflow
  1395                                  [BITS 32]
  1396                                      %include 'source/exception.asm'
  1397                              <1> unhand:	
  1398                              <1> 	%assign i 0
  1399                              <1> 	%rep 0x50
  1400                              <1> 	cli
  1401                              <1> 	mov byte [intprob], i
  1402                              <1> 	jmp unhand2
  1403                              <1> 	%assign i i+1
  1404                              <1> 	%endrep
  1405 000010CB FA                  <2>  cli
  1406 000010CC C605[D4170000]00    <2>  mov byte [intprob], i
  1407 000010D3 E903040000          <2>  jmp unhand2
  1408                              <2>  %assign i i+1
  1409 000010D8 FA                  <2>  cli
  1410 000010D9 C605[D4170000]01    <2>  mov byte [intprob], i
  1411 000010E0 E9F6030000          <2>  jmp unhand2
  1412                              <2>  %assign i i+1
  1413 000010E5 FA                  <2>  cli
  1414 000010E6 C605[D4170000]02    <2>  mov byte [intprob], i
  1415 000010ED E9E9030000          <2>  jmp unhand2
  1416                              <2>  %assign i i+1
  1417 000010F2 FA                  <2>  cli
  1418 000010F3 C605[D4170000]03    <2>  mov byte [intprob], i
  1419 000010FA E9DC030000          <2>  jmp unhand2
  1420                              <2>  %assign i i+1
  1421 000010FF FA                  <2>  cli
  1422 00001100 C605[D4170000]04    <2>  mov byte [intprob], i
  1423 00001107 E9CF030000          <2>  jmp unhand2
  1424                              <2>  %assign i i+1
  1425 0000110C FA                  <2>  cli
  1426 0000110D C605[D4170000]05    <2>  mov byte [intprob], i
  1427 00001114 E9C2030000          <2>  jmp unhand2
  1428                              <2>  %assign i i+1
  1429 00001119 FA                  <2>  cli
  1430 0000111A C605[D4170000]06    <2>  mov byte [intprob], i
  1431 00001121 E9B5030000          <2>  jmp unhand2
  1432                              <2>  %assign i i+1
  1433 00001126 FA                  <2>  cli
  1434 00001127 C605[D4170000]07    <2>  mov byte [intprob], i
  1435 0000112E E9A8030000          <2>  jmp unhand2
  1436                              <2>  %assign i i+1
  1437 00001133 FA                  <2>  cli
  1438 00001134 C605[D4170000]08    <2>  mov byte [intprob], i
  1439 0000113B E99B030000          <2>  jmp unhand2
  1440                              <2>  %assign i i+1
  1441 00001140 FA                  <2>  cli
  1442 00001141 C605[D4170000]09    <2>  mov byte [intprob], i
  1443 00001148 E98E030000          <2>  jmp unhand2
  1444                              <2>  %assign i i+1
  1445 0000114D FA                  <2>  cli
  1446 0000114E C605[D4170000]0A    <2>  mov byte [intprob], i
  1447 00001155 E981030000          <2>  jmp unhand2
  1448                              <2>  %assign i i+1
  1449 0000115A FA                  <2>  cli
  1450 0000115B C605[D4170000]0B    <2>  mov byte [intprob], i
  1451 00001162 E974030000          <2>  jmp unhand2
  1452                              <2>  %assign i i+1
  1453 00001167 FA                  <2>  cli
  1454 00001168 C605[D4170000]0C    <2>  mov byte [intprob], i
  1455 0000116F E967030000          <2>  jmp unhand2
  1456                              <2>  %assign i i+1
  1457 00001174 FA                  <2>  cli
  1458 00001175 C605[D4170000]0D    <2>  mov byte [intprob], i
  1459 0000117C E95A030000          <2>  jmp unhand2
  1460                              <2>  %assign i i+1
  1461 00001181 FA                  <2>  cli
  1462 00001182 C605[D4170000]0E    <2>  mov byte [intprob], i
  1463 00001189 E94D030000          <2>  jmp unhand2
  1464                              <2>  %assign i i+1
  1465 0000118E FA                  <2>  cli
  1466 0000118F C605[D4170000]0F    <2>  mov byte [intprob], i
  1467 00001196 E940030000          <2>  jmp unhand2
  1468                              <2>  %assign i i+1
  1469 0000119B FA                  <2>  cli
  1470 0000119C C605[D4170000]10    <2>  mov byte [intprob], i
  1471 000011A3 E933030000          <2>  jmp unhand2
  1472                              <2>  %assign i i+1
  1473 000011A8 FA                  <2>  cli
  1474 000011A9 C605[D4170000]11    <2>  mov byte [intprob], i
  1475 000011B0 E926030000          <2>  jmp unhand2
  1476                              <2>  %assign i i+1
  1477 000011B5 FA                  <2>  cli
  1478 000011B6 C605[D4170000]12    <2>  mov byte [intprob], i
  1479 000011BD E919030000          <2>  jmp unhand2
  1480                              <2>  %assign i i+1
  1481 000011C2 FA                  <2>  cli
  1482 000011C3 C605[D4170000]13    <2>  mov byte [intprob], i
  1483 000011CA E90C030000          <2>  jmp unhand2
  1484                              <2>  %assign i i+1
  1485 000011CF FA                  <2>  cli
  1486 000011D0 C605[D4170000]14    <2>  mov byte [intprob], i
  1487 000011D7 E9FF020000          <2>  jmp unhand2
  1488                              <2>  %assign i i+1
  1489 000011DC FA                  <2>  cli
  1490 000011DD C605[D4170000]15    <2>  mov byte [intprob], i
  1491 000011E4 E9F2020000          <2>  jmp unhand2
  1492                              <2>  %assign i i+1
  1493 000011E9 FA                  <2>  cli
  1494 000011EA C605[D4170000]16    <2>  mov byte [intprob], i
  1495 000011F1 E9E5020000          <2>  jmp unhand2
  1496                              <2>  %assign i i+1
  1497 000011F6 FA                  <2>  cli
  1498 000011F7 C605[D4170000]17    <2>  mov byte [intprob], i
  1499 000011FE E9D8020000          <2>  jmp unhand2
  1500                              <2>  %assign i i+1
  1501 00001203 FA                  <2>  cli
  1502 00001204 C605[D4170000]18    <2>  mov byte [intprob], i
  1503 0000120B E9CB020000          <2>  jmp unhand2
  1504                              <2>  %assign i i+1
  1505 00001210 FA                  <2>  cli
  1506 00001211 C605[D4170000]19    <2>  mov byte [intprob], i
  1507 00001218 E9BE020000          <2>  jmp unhand2
  1508                              <2>  %assign i i+1
  1509 0000121D FA                  <2>  cli
  1510 0000121E C605[D4170000]1A    <2>  mov byte [intprob], i
  1511 00001225 E9B1020000          <2>  jmp unhand2
  1512                              <2>  %assign i i+1
  1513 0000122A FA                  <2>  cli
  1514 0000122B C605[D4170000]1B    <2>  mov byte [intprob], i
  1515 00001232 E9A4020000          <2>  jmp unhand2
  1516                              <2>  %assign i i+1
  1517 00001237 FA                  <2>  cli
  1518 00001238 C605[D4170000]1C    <2>  mov byte [intprob], i
  1519 0000123F E997020000          <2>  jmp unhand2
  1520                              <2>  %assign i i+1
  1521 00001244 FA                  <2>  cli
  1522 00001245 C605[D4170000]1D    <2>  mov byte [intprob], i
  1523 0000124C E98A020000          <2>  jmp unhand2
  1524                              <2>  %assign i i+1
  1525 00001251 FA                  <2>  cli
  1526 00001252 C605[D4170000]1E    <2>  mov byte [intprob], i
  1527 00001259 E97D020000          <2>  jmp unhand2
  1528                              <2>  %assign i i+1
  1529 0000125E FA                  <2>  cli
  1530 0000125F C605[D4170000]1F    <2>  mov byte [intprob], i
  1531 00001266 E970020000          <2>  jmp unhand2
  1532                              <2>  %assign i i+1
  1533 0000126B FA                  <2>  cli
  1534 0000126C C605[D4170000]20    <2>  mov byte [intprob], i
  1535 00001273 E963020000          <2>  jmp unhand2
  1536                              <2>  %assign i i+1
  1537 00001278 FA                  <2>  cli
  1538 00001279 C605[D4170000]21    <2>  mov byte [intprob], i
  1539 00001280 E956020000          <2>  jmp unhand2
  1540                              <2>  %assign i i+1
  1541 00001285 FA                  <2>  cli
  1542 00001286 C605[D4170000]22    <2>  mov byte [intprob], i
  1543 0000128D E949020000          <2>  jmp unhand2
  1544                              <2>  %assign i i+1
  1545 00001292 FA                  <2>  cli
  1546 00001293 C605[D4170000]23    <2>  mov byte [intprob], i
  1547 0000129A E93C020000          <2>  jmp unhand2
  1548                              <2>  %assign i i+1
  1549 0000129F FA                  <2>  cli
  1550 000012A0 C605[D4170000]24    <2>  mov byte [intprob], i
  1551 000012A7 E92F020000          <2>  jmp unhand2
  1552                              <2>  %assign i i+1
  1553 000012AC FA                  <2>  cli
  1554 000012AD C605[D4170000]25    <2>  mov byte [intprob], i
  1555 000012B4 E922020000          <2>  jmp unhand2
  1556                              <2>  %assign i i+1
  1557 000012B9 FA                  <2>  cli
  1558 000012BA C605[D4170000]26    <2>  mov byte [intprob], i
  1559 000012C1 E915020000          <2>  jmp unhand2
  1560                              <2>  %assign i i+1
  1561 000012C6 FA                  <2>  cli
  1562 000012C7 C605[D4170000]27    <2>  mov byte [intprob], i
  1563 000012CE E908020000          <2>  jmp unhand2
  1564                              <2>  %assign i i+1
  1565 000012D3 FA                  <2>  cli
  1566 000012D4 C605[D4170000]28    <2>  mov byte [intprob], i
  1567 000012DB E9FB010000          <2>  jmp unhand2
  1568                              <2>  %assign i i+1
  1569 000012E0 FA                  <2>  cli
  1570 000012E1 C605[D4170000]29    <2>  mov byte [intprob], i
  1571 000012E8 E9EE010000          <2>  jmp unhand2
  1572                              <2>  %assign i i+1
  1573 000012ED FA                  <2>  cli
  1574 000012EE C605[D4170000]2A    <2>  mov byte [intprob], i
  1575 000012F5 E9E1010000          <2>  jmp unhand2
  1576                              <2>  %assign i i+1
  1577 000012FA FA                  <2>  cli
  1578 000012FB C605[D4170000]2B    <2>  mov byte [intprob], i
  1579 00001302 E9D4010000          <2>  jmp unhand2
  1580                              <2>  %assign i i+1
  1581 00001307 FA                  <2>  cli
  1582 00001308 C605[D4170000]2C    <2>  mov byte [intprob], i
  1583 0000130F E9C7010000          <2>  jmp unhand2
  1584                              <2>  %assign i i+1
  1585 00001314 FA                  <2>  cli
  1586 00001315 C605[D4170000]2D    <2>  mov byte [intprob], i
  1587 0000131C E9BA010000          <2>  jmp unhand2
  1588                              <2>  %assign i i+1
  1589 00001321 FA                  <2>  cli
  1590 00001322 C605[D4170000]2E    <2>  mov byte [intprob], i
  1591 00001329 E9AD010000          <2>  jmp unhand2
  1592                              <2>  %assign i i+1
  1593 0000132E FA                  <2>  cli
  1594 0000132F C605[D4170000]2F    <2>  mov byte [intprob], i
  1595 00001336 E9A0010000          <2>  jmp unhand2
  1596                              <2>  %assign i i+1
  1597 0000133B FA                  <2>  cli
  1598 0000133C C605[D4170000]30    <2>  mov byte [intprob], i
  1599 00001343 E993010000          <2>  jmp unhand2
  1600                              <2>  %assign i i+1
  1601 00001348 FA                  <2>  cli
  1602 00001349 C605[D4170000]31    <2>  mov byte [intprob], i
  1603 00001350 E986010000          <2>  jmp unhand2
  1604                              <2>  %assign i i+1
  1605 00001355 FA                  <2>  cli
  1606 00001356 C605[D4170000]32    <2>  mov byte [intprob], i
  1607 0000135D E979010000          <2>  jmp unhand2
  1608                              <2>  %assign i i+1
  1609 00001362 FA                  <2>  cli
  1610 00001363 C605[D4170000]33    <2>  mov byte [intprob], i
  1611 0000136A E96C010000          <2>  jmp unhand2
  1612                              <2>  %assign i i+1
  1613 0000136F FA                  <2>  cli
  1614 00001370 C605[D4170000]34    <2>  mov byte [intprob], i
  1615 00001377 E95F010000          <2>  jmp unhand2
  1616                              <2>  %assign i i+1
  1617 0000137C FA                  <2>  cli
  1618 0000137D C605[D4170000]35    <2>  mov byte [intprob], i
  1619 00001384 E952010000          <2>  jmp unhand2
  1620                              <2>  %assign i i+1
  1621 00001389 FA                  <2>  cli
  1622 0000138A C605[D4170000]36    <2>  mov byte [intprob], i
  1623 00001391 E945010000          <2>  jmp unhand2
  1624                              <2>  %assign i i+1
  1625 00001396 FA                  <2>  cli
  1626 00001397 C605[D4170000]37    <2>  mov byte [intprob], i
  1627 0000139E E938010000          <2>  jmp unhand2
  1628                              <2>  %assign i i+1
  1629 000013A3 FA                  <2>  cli
  1630 000013A4 C605[D4170000]38    <2>  mov byte [intprob], i
  1631 000013AB E92B010000          <2>  jmp unhand2
  1632                              <2>  %assign i i+1
  1633 000013B0 FA                  <2>  cli
  1634 000013B1 C605[D4170000]39    <2>  mov byte [intprob], i
  1635 000013B8 E91E010000          <2>  jmp unhand2
  1636                              <2>  %assign i i+1
  1637 000013BD FA                  <2>  cli
  1638 000013BE C605[D4170000]3A    <2>  mov byte [intprob], i
  1639 000013C5 E911010000          <2>  jmp unhand2
  1640                              <2>  %assign i i+1
  1641 000013CA FA                  <2>  cli
  1642 000013CB C605[D4170000]3B    <2>  mov byte [intprob], i
  1643 000013D2 E904010000          <2>  jmp unhand2
  1644                              <2>  %assign i i+1
  1645 000013D7 FA                  <2>  cli
  1646 000013D8 C605[D4170000]3C    <2>  mov byte [intprob], i
  1647 000013DF E9F7000000          <2>  jmp unhand2
  1648                              <2>  %assign i i+1
  1649 000013E4 FA                  <2>  cli
  1650 000013E5 C605[D4170000]3D    <2>  mov byte [intprob], i
  1651 000013EC E9EA000000          <2>  jmp unhand2
  1652                              <2>  %assign i i+1
  1653 000013F1 FA                  <2>  cli
  1654 000013F2 C605[D4170000]3E    <2>  mov byte [intprob], i
  1655 000013F9 E9DD000000          <2>  jmp unhand2
  1656                              <2>  %assign i i+1
  1657 000013FE FA                  <2>  cli
  1658 000013FF C605[D4170000]3F    <2>  mov byte [intprob], i
  1659 00001406 E9D0000000          <2>  jmp unhand2
  1660                              <2>  %assign i i+1
  1661 0000140B FA                  <2>  cli
  1662 0000140C C605[D4170000]40    <2>  mov byte [intprob], i
  1663 00001413 E9C3000000          <2>  jmp unhand2
  1664                              <2>  %assign i i+1
  1665 00001418 FA                  <2>  cli
  1666 00001419 C605[D4170000]41    <2>  mov byte [intprob], i
  1667 00001420 E9B6000000          <2>  jmp unhand2
  1668                              <2>  %assign i i+1
  1669 00001425 FA                  <2>  cli
  1670 00001426 C605[D4170000]42    <2>  mov byte [intprob], i
  1671 0000142D E9A9000000          <2>  jmp unhand2
  1672                              <2>  %assign i i+1
  1673 00001432 FA                  <2>  cli
  1674 00001433 C605[D4170000]43    <2>  mov byte [intprob], i
  1675 0000143A E99C000000          <2>  jmp unhand2
  1676                              <2>  %assign i i+1
  1677 0000143F FA                  <2>  cli
  1678 00001440 C605[D4170000]44    <2>  mov byte [intprob], i
  1679 00001447 E98F000000          <2>  jmp unhand2
  1680                              <2>  %assign i i+1
  1681 0000144C FA                  <2>  cli
  1682 0000144D C605[D4170000]45    <2>  mov byte [intprob], i
  1683 00001454 E982000000          <2>  jmp unhand2
  1684                              <2>  %assign i i+1
  1685 00001459 FA                  <2>  cli
  1686 0000145A C605[D4170000]46    <2>  mov byte [intprob], i
  1687 00001461 E975000000          <2>  jmp unhand2
  1688                              <2>  %assign i i+1
  1689 00001466 FA                  <2>  cli
  1690 00001467 C605[D4170000]47    <2>  mov byte [intprob], i
  1691 0000146E E968000000          <2>  jmp unhand2
  1692                              <2>  %assign i i+1
  1693 00001473 FA                  <2>  cli
  1694 00001474 C605[D4170000]48    <2>  mov byte [intprob], i
  1695 0000147B E95B000000          <2>  jmp unhand2
  1696                              <2>  %assign i i+1
  1697 00001480 FA                  <2>  cli
  1698 00001481 C605[D4170000]49    <2>  mov byte [intprob], i
  1699 00001488 E94E000000          <2>  jmp unhand2
  1700                              <2>  %assign i i+1
  1701 0000148D FA                  <2>  cli
  1702 0000148E C605[D4170000]4A    <2>  mov byte [intprob], i
  1703 00001495 E941000000          <2>  jmp unhand2
  1704                              <2>  %assign i i+1
  1705 0000149A FA                  <2>  cli
  1706 0000149B C605[D4170000]4B    <2>  mov byte [intprob], i
  1707 000014A2 E934000000          <2>  jmp unhand2
  1708                              <2>  %assign i i+1
  1709 000014A7 FA                  <2>  cli
  1710 000014A8 C605[D4170000]4C    <2>  mov byte [intprob], i
  1711 000014AF E927000000          <2>  jmp unhand2
  1712                              <2>  %assign i i+1
  1713 000014B4 FA                  <2>  cli
  1714 000014B5 C605[D4170000]4D    <2>  mov byte [intprob], i
  1715 000014BC E91A000000          <2>  jmp unhand2
  1716                              <2>  %assign i i+1
  1717 000014C1 FA                  <2>  cli
  1718 000014C2 C605[D4170000]4E    <2>  mov byte [intprob], i
  1719 000014C9 E90D000000          <2>  jmp unhand2
  1720                              <2>  %assign i i+1
  1721 000014CE FA                  <2>  cli
  1722 000014CF C605[D4170000]4F    <2>  mov byte [intprob], i
  1723 000014D6 E900000000          <2>  jmp unhand2
  1724                              <2>  %assign i i+1
  1725                              <1> unhand2:
  1726 000014DB FA                  <1> 	cli
  1727 000014DC 1E                  <1> 	push ds
  1728 000014DD 06                  <1> 	push es
  1729 000014DE 0FA0                <1> 	push fs
  1730 000014E0 0FA8                <1> 	push gs
  1731 000014E2 16                  <1> 	push ss
  1732 000014E3 60                  <1> 	pushad
  1733 000014E4 803D[AB8B0000]00    <1> 	cmp byte [guion], 0
  1734 000014EB 0F8432000000        <1> 	je near noguiunhandstuff
  1735 000014F1 66C705[CE170000]08- <1> 	mov word [locunhandy], 8
  1736 000014F9 00                  <1>
  1737 000014FA 66C705[D0170000]08- <1> 	mov word [locunhandx], 8
  1738 00001502 00                  <1>
  1739 00001503 668B1D[D0560000]    <1> 	mov bx, [background]
  1740 0000150A 66891D[D2170000]    <1> 	mov [backgroundcache], bx
  1741 00001511 C605[D94F0000]01    <1> 	mov byte [mousedisabled],1
  1742 00001518 66BB00F8            <1> 	mov bx, 1111100000000000b
  1743 0000151C 66891D[D0560000]    <1> 	mov [background], bx
  1744                              <1> noguiunhandstuff:
  1745 00001523 89E6                <1> 	mov esi, esp
  1746 00001525 8935[C2170000]      <1> 	mov [espfirst], esi
  1747 0000152B 81C6BC000000        <1> 	add esi, ((unhndrgend - unhndrg)/15)*4
  1748 00001531 8935[BE170000]      <1> 	mov [esploc], esi
  1749 00001537 BE[DD170000]        <1> 	mov esi, unhandmsg
  1750 0000153C 8935[C6170000]      <1> 	mov [esiloc], esi
  1751 00001542 31C9                <1> 	xor ecx, ecx
  1752 00001544 8A0D[D4170000]      <1> 	mov cl, [intprob]
  1753 0000154A BB[701B0000]        <1> 	mov ebx, errortypes
  1754 0000154F C1E102              <1> 	shl ecx, 2
  1755 00001552 01CB                <1> 	add ebx, ecx
  1756 00001554 81FB[B01B0000]      <1> 	cmp ebx, errortypesend
  1757 0000155A 7205                <1> 	jb gooderrortype
  1758 0000155C BB[B01B0000]        <1> 	mov ebx, errortypesend
  1759                              <1> gooderrortype:
  1760 00001561 8B33                <1> 	mov esi, [ebx]
  1761 00001563 803D[AB8B0000]00    <1> 	cmp byte [guion], 0
  1762 0000156A 0F842D000000        <1> 	je near errortext
  1763 00001570 668B0D[CE170000]    <1> 	mov cx, [locunhandy]
  1764 00001577 668B15[D0170000]    <1> 	mov dx, [locunhandx]
  1765 0000157E 66B80100            <1> 	mov ax, 1
  1766 00001582 6631DB              <1> 	xor bx, bx
  1767 00001585 E8394C0000          <1> 	call showstring2
  1768 0000158A 66890D[CE170000]    <1> 	mov [locunhandy], cx
  1769 00001591 668915[D0170000]    <1> 	mov [locunhandx], dx
  1770 00001598 E905000000          <1> 	jmp errortextdone
  1771                              <1> errortext:
  1772 0000159D E8420D0000          <1> 	call print		;;get the error message and print it
  1773                              <1> errortextdone:
  1774 000015A2 31C9                <1> 	xor ecx, ecx
  1775 000015A4 8A0D[D4170000]      <1> 	mov cl, [intprob]
  1776 000015AA E8A8010000          <1> 	call expdump
  1777                              <1> dumpstack:
  1778 000015AF 8B35[BE170000]      <1> 	mov esi, [esploc]
  1779 000015B5 39E6                <1> 	cmp esi, esp
  1780 000015B7 7216                <1> 	jb donedump
  1781 000015B9 368B0E              <1> 	mov ecx, [ss:esi]
  1782 000015BC 81EE04000000        <1> 	sub esi, 4
  1783 000015C2 8935[BE170000]      <1> 	mov [esploc], esi
  1784 000015C8 E88A010000          <1> 	call expdump
  1785 000015CD EBE0                <1> 	jmp dumpstack
  1786                              <1> donedump:
  1787 000015CF 0F20C1              <1> 	mov ecx, cr0
  1788 000015D2 E880010000          <1> 	call expdump
  1789 000015D7 0F20D1              <1> 	mov ecx, cr2
  1790 000015DA E878010000          <1> 	call expdump
  1791 000015DF 0F20D9              <1> 	mov ecx, cr3
  1792 000015E2 E870010000          <1> 	call expdump
  1793 000015E7 0F20E1              <1> 	mov ecx, cr4
  1794 000015EA E868010000          <1> 	call expdump
  1795 000015EF 8B35[BE170000]      <1> 	mov esi, [esploc]
  1796 000015F5 368B7C2434          <1> 	mov edi, [ss:esp + 52]
  1797 000015FA 81C710000000        <1> 	add edi, 16
  1798 00001600 893D[D9170000]      <1> 	mov [codelocend], edi
  1799 00001606 81EF20000000        <1> 	sub edi, 32
  1800                              <1> dumpcodeloop:
  1801 0000160C 893D[D5170000]      <1> 	mov [codeloc], edi
  1802 00001612 8B0F                <1> 	mov ecx, [edi]
  1803 00001614 E83E010000          <1> 	call expdump
  1804 00001619 8B3D[D5170000]      <1> 	mov edi, [codeloc]
  1805 0000161F 81C704000000        <1> 	add edi, 4
  1806 00001625 3B3D[D9170000]      <1> 	cmp edi, [codelocend]
  1807 0000162B 72DF                <1> 	jb dumpcodeloop
  1808 0000162D BE[E8160000]        <1> 	mov esi, backtoosmsg
  1809 00001632 803D[AB8B0000]00    <1> 	cmp byte [guion], 0
  1810 00001639 750A                <1> 	jne guibacktomsg
  1811 0000163B E8A40C0000          <1> 	call print
  1812 00001640 E91A000000          <1> 	jmp backtomsgdone
  1813                              <1> guibacktomsg:
  1814 00001645 668B15[D0170000]    <1> 	mov dx, [locunhandx]
  1815 0000164C 668B0D[CE170000]    <1> 	mov cx, [locunhandy]
  1816 00001653 66B80100            <1> 	mov ax, 1
  1817 00001657 6631DB              <1> 	xor bx, bx
  1818 0000165A E8644B0000          <1> 	call showstring2
  1819                              <1> backtomsgdone:
  1820 0000165F 30C0                <1> 	xor al, al
  1821 00001661 E800110000          <1> 	call rdcharint
  1822 00001666 803D[D4170000]03    <1> 	cmp byte [intprob], 3
  1823 0000166D 753C                <1> 	jne nodebugint
  1824 0000166F 803D[AB8B0000]00    <1> 	cmp byte [guion], 0
  1825 00001676 7422                <1> 	je nodebuggui
  1826 00001678 668B1D[D2170000]    <1> 	mov bx, [backgroundcache]
  1827 0000167F 66891D[D0560000]    <1> 	mov [background], bx
  1828 00001686 6631DB              <1> 	xor bx, bx
  1829 00001689 C605[D94F0000]00    <1> 	mov byte [mousedisabled], 0
  1830 00001690 E8FE3F0000          <1> 	call guiclear
  1831 00001695 E8D0470000          <1> 	call reloadallgraphics
  1832                              <1> nodebuggui:
  1833 0000169A 8B35[C2170000]      <1> 	mov esi, [espfirst]
  1834 000016A0 89F4                <1> 	mov esp, esi
  1835 000016A2 61                  <1> 	popad
  1836 000016A3 17                  <1> 	pop ss
  1837 000016A4 0FA9                <1> 	pop gs
  1838 000016A6 0FA1                <1> 	pop fs
  1839 000016A8 07                  <1> 	pop es
  1840 000016A9 1F                  <1> 	pop ds
  1841 000016AA CF                  <1> 	iret
  1842                              <1> nodebugint:
  1843 000016AB 61                  <1> 	popad
  1844 000016AC 17                  <1> 	pop ss
  1845 000016AD 0FA9                <1> 	pop gs
  1846 000016AF 0FA1                <1> 	pop fs
  1847 000016B1 07                  <1> 	pop es
  1848 000016B2 1F                  <1> 	pop ds
  1849 000016B3 803D[AB8B0000]00    <1> 	cmp byte [guion], 0
  1850 000016BA 7427                <1> 	je returnunhandgui
  1851 000016BC 668B1D[D2170000]    <1> 	mov bx, [backgroundcache]
  1852 000016C3 66891D[D0560000]    <1> 	mov [background], bx
  1853 000016CA 6631DB              <1> 	xor bx, bx
  1854 000016CD C605[D94F0000]00    <1> 	mov byte [mousedisabled], 0
  1855 000016D4 E8BA3F0000          <1> 	call guiclear
  1856 000016D9 E88C470000          <1> 	call reloadallgraphics
  1857 000016DE E9EF3F0000          <1> 	jmp gui
  1858                              <1> returnunhandgui:
  1859 000016E3 E9B4160000          <1> 	jmp nwcmd
  1860 000016E8 506C6561736520706F- <1> backtoosmsg db "Please post any problems in the Issues section at solleros.googlecode.com",10
  1861 000016F1 737420616E79207072- <1>
  1862 000016FA 6F626C656D7320696E- <1>
  1863 00001703 207468652049737375- <1>
  1864 0000170C 65732073656374696F- <1>
  1865 00001715 6E20617420736F6C6C- <1>
  1866 0000171E 65726F732E676F6F67- <1>
  1867 00001727 6C65636F64652E636F- <1>
  1868 00001730 6D0A                <1>
  1869 00001732 507265737320616E79- <1> 			db "Press any key to return to SollerOS",10,0
  1870 0000173B 206B657920746F2072- <1>
  1871 00001744 657475726E20746F20- <1>
  1872 0000174D 536F6C6C65724F530A- <1>
  1873 00001756 00                  <1>
  1874                              <1> expdump:
  1875 00001757 8B35[C6170000]      <1> 	mov esi, [esiloc]
  1876 0000175D 89F7                <1> 	mov edi, esi
  1877 0000175F 81C70F000000        <1> 	add edi, 15
  1878 00001765 81C604000000        <1> 	add esi, 4
  1879 0000176B 893D[C6170000]      <1> 	mov [esiloc], edi
  1880 00001771 81EF03000000        <1> 	sub edi, 3
  1881 00001777 E8861A0000          <1> 	call converthex
  1882 0000177C 81EE04000000        <1> 	sub esi, 4
  1883 00001782 803D[AB8B0000]00    <1> 	cmp byte [guion], 0
  1884 00001789 0F8429000000        <1> 	je near expdumptext
  1885 0000178F 668B0D[CE170000]    <1> 	mov cx, [locunhandy]
  1886 00001796 668B15[D0170000]    <1> 	mov dx, [locunhandx]
  1887 0000179D 66B80100            <1> 	mov ax, 1
  1888 000017A1 6631DB              <1> 	xor bx, bx
  1889 000017A4 E81A4A0000          <1> 	call showstring2
  1890 000017A9 66890D[CE170000]    <1> 	mov [locunhandy], cx
  1891 000017B0 668915[D0170000]    <1> 	mov [locunhandx], dx
  1892 000017B7 C3                  <1> 	ret
  1893                              <1> expdumptext:
  1894 000017B8 E8270B0000          <1> 	call print
  1895 000017BD C3                  <1> 	ret
  1896 000017BE 00000000            <1> esploc dd 0
  1897 000017C2 00000000            <1> espfirst dd 0
  1898 000017C6 00000000            <1> esiloc dd 0
  1899 000017CA 00000000            <1> esiregbuf dd 0
  1900 000017CE 0100                <1> locunhandy dw 1
  1901 000017D0 0100                <1> locunhandx dw 1
  1902 000017D2 0000                <1> backgroundcache dw 0
  1903 000017D4 00                  <1> intprob db 0
  1904 000017D5 00000000            <1> codeloc dd 0
  1905 000017D9 00000000            <1> codelocend dd 0
  1906                              <1> 	unhandmsg:	
  1907 000017DD 494E543D3030303030- <1> 			db "INT=00000000 ",10,0
  1908 000017E6 303030200A00        <1>
  1909                              <1> unhndrg:
  1910 000017EC FFFFFFFF3030303030- <1> 	times 7 db 255,255,255,255,"00000000  ",0	;;this dumps the stack before the stack frame in question
  1911 000017F5 303030202000<rept>  <1>
  1912 00001855 FFFFFFFF3030303030- <1> 			db 255,255,255,255,"00000000 ",10,0
  1913 0000185E 303030200A00        <1>
  1914 00001864 FFFFFFFF3030303030- <1> 	times 7 db 255,255,255,255,"00000000  ",0	;;this dumps the stack before the stack frame in question
  1915 0000186D 303030202000<rept>  <1>
  1916 000018CD FFFFFFFF3030303030- <1> 			db 255,255,255,255,"00000000 ",10,0
  1917 000018D6 303030200A00        <1>
  1918 000018DC FFFFFFFF3030303030- <1> 	times 7 db 255,255,255,255,"00000000  ",0	;;this dumps the stack before the stack frame in question
  1919 000018E5 303030202000<rept>  <1>
  1920 00001945 FFFFFFFF3030303030- <1> 			db 255,255,255,255,"00000000 ",10,0
  1921 0000194E 303030200A00        <1>
  1922 00001954 FFFFFFFF3030303030- <1> 	times 7 db 255,255,255,255,"00000000  ",0	;;this dumps the stack before the stack frame in question
  1923 0000195D 303030202000<rept>  <1>
  1924 000019BD FFFFFFFF3030303030- <1> 			db 255,255,255,255,"00000000 ",10,0
  1925 000019C6 303030200A00        <1>
  1926                              <1> unhandregs:
  1927 000019CC 45464C3D3030303030- <1> 			db "EFL=00000000  ",0
  1928 000019D5 303030202000        <1>
  1929 000019DB 43533A3D3030303030- <1> 			db "CS:=00000000  ",0
  1930 000019E4 303030202000        <1>
  1931 000019EA 4549503D3030303030- <1> 			db "EIP=00000000 ",10,0
  1932 000019F3 303030200A00        <1>
  1933 000019F9 44533A3D3030303030- <1> 			db "DS:=00000000  ",0
  1934 00001A02 303030202000        <1>
  1935 00001A08 45533A3D3030303030- <1> 			db "ES:=00000000  ",0
  1936 00001A11 303030202000        <1>
  1937 00001A17 46533A3D3030303030- <1> 			db "FS:=00000000  ",0
  1938 00001A20 303030202000        <1>
  1939 00001A26 47533A3D3030303030- <1> 			db "GS:=00000000  ",0
  1940 00001A2F 303030202000        <1>
  1941 00001A35 53533A3D3030303030- <1> 			db "SS:=00000000 ",10,0
  1942 00001A3E 303030200A00        <1>
  1943 00001A44 4541583D3030303030- <1> 			db "EAX=00000000  ",0
  1944 00001A4D 303030202000        <1>
  1945 00001A53 4543583D3030303030- <1> 			db "ECX=00000000  ",0
  1946 00001A5C 303030202000        <1>
  1947 00001A62 4544583D3030303030- <1> 			db "EDX=00000000  ",0
  1948 00001A6B 303030202000        <1>
  1949 00001A71 4542583D3030303030- <1> 			db "EBX=00000000 ",10,0
  1950 00001A7A 303030200A00        <1>
  1951 00001A80 4553503D3030303030- <1> 			db "ESP=00000000  ",0
  1952 00001A89 303030202000        <1>
  1953 00001A8F 4542503D3030303030- <1> 			db "EBP=00000000  ",0
  1954 00001A98 303030202000        <1>
  1955 00001A9E 4553493D3030303030- <1> 			db "ESI=00000000  ",0
  1956 00001AA7 303030202000        <1>
  1957 00001AAD 4544493D3030303030- <1> unhndrgend:	db "EDI=00000000 ",10,0
  1958 00001AB6 303030200A00        <1>
  1959 00001ABC 4352303D3030303030- <1> 			db "CR0=00000000  ",0
  1960 00001AC5 303030202000        <1>
  1961 00001ACB 4352323D3030303030- <1> 			db "CR2=00000000  ",0
  1962 00001AD4 303030202000        <1>
  1963 00001ADA 4352333D3030303030- <1> 			db "CR3=00000000  ",0
  1964 00001AE3 303030202000        <1>
  1965 00001AE9 4352343D3030303030- <1> 			db "CR4=00000000 ",10,0
  1966 00001AF2 303030200A00        <1>
  1967 00001AF8 FFFFFFFF3030303030- <1> unhandcode: times 2 db 255,255,255,255,"00000000  ",0	;;this dumps the code before and after the interrupt in question
  1968 00001B01 303030202000<rept>  <1>
  1969 00001B16 FFFFFFFF3030303030- <1> 			db 255,255,255,255,"00000000 ",255,0
  1970 00001B1F 30303020FF00        <1>
  1971 00001B25 FFFFFF5B3030303030- <1> 			db 255,255,255,"[00000000] ",0
  1972 00001B2E 3030305D2000        <1>
  1973 00001B34 FFFFFFFF3030303030- <1> 			times 3 db 255,255,255,255,"00000000  ",0
  1974 00001B3D 303030202000<rept>  <1>
  1975 00001B61 FFFFFFFF3030303030- <1> 			db 255,255,255,255,"00000000",255,10,0
  1976 00001B6A 303030FF0A00        <1>
  1977                              <1> unhandmsgend:
  1978                              <1> 
  1979                              <1> errortypes:
  1980 00001B70 [B41B0000]          <1> 			dd err0
  1981 00001B74 [181C0000]          <1> 			dd err1
  1982 00001B78 [791C0000]          <1> 			dd err2
  1983 00001B7C [CE1C0000]          <1> 			dd err3
  1984 00001B80 [321D0000]          <1> 			dd err4
  1985 00001B84 [841D0000]          <1> 			dd err5
  1986 00001B88 [EE1D0000]          <1> 			dd err6
  1987 00001B8C [561E0000]          <1> 			dd err7
  1988 00001B90 [A01E0000]          <1> 			dd err8
  1989 00001B94 [FD1E0000]          <1> 			dd err9
  1990 00001B98 [561F0000]          <1> 			dd err10
  1991 00001B9C [A11F0000]          <1> 			dd err11
  1992 00001BA0 [F11F0000]          <1> 			dd err12
  1993 00001BA4 [4A200000]          <1> 			dd err13
  1994 00001BA8 [AD200000]          <1> 			dd err14
  1995 00001BAC [E9200000]          <1> 			dd err15
  1996                              <1> errortypesend:
  1997 00001BB0 [74210000]          <1> 			dd unknownerror
  1998                              <1> 			
  1999 00001BB4 4469766973696F6E20- <1> err0	db "Division by zero:",10
  2000 00001BBD 6279207A65726F3A0A  <1>
  2001 00001BC6 546563686E6963616C- <1> 		db "Technically lim a",246,"x = ",236," when a is any real number. Happy Easter!",10
  2002 00001BCF 6C79206C696D2061F6- <1>
  2003 00001BD8 78203D20EC20776865- <1>
  2004 00001BE1 6E206120697320616E- <1>
  2005 00001BEA 79207265616C206E75- <1>
  2006 00001BF3 6D6265722E20486170- <1>
  2007 00001BFC 707920456173746572- <1>
  2008 00001C05 210A                <1>
  2009 00001C07 202020202020202020- <1> 		db "            x",26,"0",10,0
  2010 00001C10 202020781A300A00    <1>
  2011                              <1> 		
  2012 00001C18 53696E676C652D7374- <1> err1	db "Single-step/Breakpoint:",10
  2013 00001C21 65702F427265616B70- <1>
  2014 00001C2A 6F696E743A0A        <1>
  2015 00001C30 4120627265616B706F- <1> 		db "A breakpoint fault, breakpoint trap, or single-step trap was triggered.",10,0
  2016 00001C39 696E74206661756C74- <1>
  2017 00001C42 2C20627265616B706F- <1>
  2018 00001C4B 696E7420747261702C- <1>
  2019 00001C54 206F722073696E676C- <1>
  2020 00001C5D 652D73746570207472- <1>
  2021 00001C66 617020776173207472- <1>
  2022 00001C6F 696767657265642E0A- <1>
  2023 00001C78 00                  <1>
  2024                              <1> 		
  2025 00001C79 4E6F6E6D61736B6162- <1> err2	db "Nonmaskable interrupt:",10
  2026 00001C82 6C6520696E74657272- <1>
  2027 00001C8B 7570743A0A          <1>
  2028 00001C90 412068617264776172- <1> 		db "A hardware interrupt was triggered that could not be masked.",10,0
  2029 00001C99 6520696E7465727275- <1>
  2030 00001CA2 707420776173207472- <1>
  2031 00001CAB 696767657265642074- <1>
  2032 00001CB4 68617420636F756C64- <1>
  2033 00001CBD 206E6F74206265206D- <1>
  2034 00001CC6 61736B65642E0A00    <1>
  2035                              <1> 		
  2036 00001CCE 427265616B706F696E- <1> err3	db "Breakpoint:",10
  2037 00001CD7 743A0A              <1>
  2038 00001CDA 5468697320696E7465- <1> 		db "This interrupt is used in programs to show the stack and registers and can be",10
  2039 00001CE3 727275707420697320- <1>
  2040 00001CEC 7573656420696E2070- <1>
  2041 00001CF5 726F6772616D732074- <1>
  2042 00001CFE 6F2073686F77207468- <1>
  2043 00001D07 6520737461636B2061- <1>
  2044 00001D10 6E6420726567697374- <1>
  2045 00001D19 65727320616E642063- <1>
  2046 00001D22 616E2062650A        <1>
  2047 00001D28 69676E6F7265642E0A- <1> 		db "ignored.",10,0
  2048 00001D31 00                  <1>
  2049                              <1> 		
  2050 00001D32 4F766572666C6F773A- <1> err4	db "Overflow:",10
  2051 00001D3B 0A                  <1>
  2052 00001D3C 5468652070726F6365- <1> 		db "The processor ran into an INTO instruction with the overflow flag set.",10,0
  2053 00001D45 73736F722072616E20- <1>
  2054 00001D4E 696E746F20616E2049- <1>
  2055 00001D57 4E544F20696E737472- <1>
  2056 00001D60 756374696F6E207769- <1>
  2057 00001D69 746820746865206F76- <1>
  2058 00001D72 6572666C6F7720666C- <1>
  2059 00001D7B 6167207365742E0A00  <1>
  2060                              <1> 		
  2061 00001D84 426F756E6473206368- <1> err5	db "Bounds check:",10
  2062 00001D8D 65636B3A0A          <1>
  2063 00001D92 5468652070726F6365- <1> 		db "The processor rebounded from a BOUND instruction run on an operand that was out",10
  2064 00001D9B 73736F72207265626F- <1>
  2065 00001DA4 756E6465642066726F- <1>
  2066 00001DAD 6D206120424F554E44- <1>
  2067 00001DB6 20696E737472756374- <1>
  2068 00001DBF 696F6E2072756E206F- <1>
  2069 00001DC8 6E20616E206F706572- <1>
  2070 00001DD1 616E64207468617420- <1>
  2071 00001DDA 776173206F75740A    <1>
  2072 00001DE2 6F6620626F756E6473- <1> 		db "of bounds.",10,0
  2073 00001DEB 2E0A00              <1>
  2074                              <1> 		
  2075 00001DEE 496E76616C6964206F- <1> err6	db "Invalid opcode:",10
  2076 00001DF7 70636F64653A0A      <1>
  2077 00001DFE 5468652070726F6365- <1> 		db "The processor has no idea what it was trying to execute. Don't run SSE4 code",10
  2078 00001E07 73736F722068617320- <1>
  2079 00001E10 6E6F20696465612077- <1>
  2080 00001E19 686174206974207761- <1>
  2081 00001E22 7320747279696E6720- <1>
  2082 00001E2B 746F20657865637574- <1>
  2083 00001E34 652E20446F6E277420- <1>
  2084 00001E3D 72756E205353453420- <1>
  2085 00001E46 636F64650A          <1>
  2086 00001E4B 6F6E20343836277321- <1> 		db "on 486's!",10,0
  2087 00001E54 0A00                <1>
  2088                              <1> 		
  2089 00001E56 436F70726F63657373- <1> err7	db "Coprocessor not available:",10
  2090 00001E5F 6F72206E6F74206176- <1>
  2091 00001E68 61696C61626C653A0A  <1>
  2092 00001E71 446F6E277420796F75- <1> 		db "Don't you know they don't make those anymore!",10,0
  2093 00001E7A 206B6E6F7720746865- <1>
  2094 00001E83 7920646F6E2774206D- <1>
  2095 00001E8C 616B652074686F7365- <1>
  2096 00001E95 20616E796D6F726521- <1>
  2097 00001E9E 0A00                <1>
  2098                              <1> 		
  2099 00001EA0 446F75626C65206661- <1> err8	db "Double fault:",10
  2100 00001EA9 756C743A0A          <1>
  2101 00001EAE 546865206578636570- <1> 		db "The exception handler could not handle that it could not handle an exception.",10,0
  2102 00001EB7 74696F6E2068616E64- <1>
  2103 00001EC0 6C657220636F756C64- <1>
  2104 00001EC9 206E6F742068616E64- <1>
  2105 00001ED2 6C6520746861742069- <1>
  2106 00001EDB 7420636F756C64206E- <1>
  2107 00001EE4 6F742068616E646C65- <1>
  2108 00001EED 20616E206578636570- <1>
  2109 00001EF6 74696F6E2E0A00      <1>
  2110                              <1> 		
  2111 00001EFD 436F70726F63657373- <1> err9	db "Coprocessor segment overrun:",10,0
  2112 00001F06 6F72207365676D656E- <1>
  2113 00001F0F 74206F76657272756E- <1>
  2114 00001F18 3A0A00              <1>
  2115 00001F1B 54686973206E657665- <1> 		db "This never happens in modern computers, and never should.",10,0
  2116 00001F24 722068617070656E73- <1>
  2117 00001F2D 20696E206D6F646572- <1>
  2118 00001F36 6E20636F6D70757465- <1>
  2119 00001F3F 72732C20616E64206E- <1>
  2120 00001F48 657665722073686F75- <1>
  2121 00001F51 6C642E0A00          <1>
  2122                              <1> 
  2123 00001F56 496E76616C69642054- <1> err10	db "Invalid TSS:",10
  2124 00001F5F 53533A0A            <1>
  2125 00001F63 546865205453532074- <1> 		db "The TSS that was switched to is invalid. Nothing funny here.",10,0
  2126 00001F6C 686174207761732073- <1>
  2127 00001F75 776974636865642074- <1>
  2128 00001F7E 6F20697320696E7661- <1>
  2129 00001F87 6C69642E204E6F7468- <1>
  2130 00001F90 696E672066756E6E79- <1>
  2131 00001F99 20686572652E0A00    <1>
  2132                              <1> 		
  2133 00001FA1 5365676D656E74206E- <1> err11	db "Segment not present:",10
  2134 00001FAA 6F742070726573656E- <1>
  2135 00001FB3 743A0A              <1>
  2136 00001FB6 546865207072657365- <1> 		db "The present bit of the segment descriptor is set to zero.",10,0
  2137 00001FBF 6E7420626974206F66- <1>
  2138 00001FC8 20746865207365676D- <1>
  2139 00001FD1 656E74206465736372- <1>
  2140 00001FDA 6970746F7220697320- <1>
  2141 00001FE3 73657420746F207A65- <1>
  2142 00001FEC 726F2E0A00          <1>
  2143                              <1> 		
  2144 00001FF1 537461636B20657863- <1> err12	db "Stack exception:",10
  2145 00001FFA 657074696F6E3A0A    <1>
  2146 00002002 546865205353206465- <1> 		db "The SS descriptor is invalid or not present or its limit is too small.",10,0
  2147 0000200B 7363726970746F7220- <1>
  2148 00002014 697320696E76616C69- <1>
  2149 0000201D 64206F72206E6F7420- <1>
  2150 00002026 70726573656E74206F- <1>
  2151 0000202F 7220697473206C696D- <1>
  2152 00002038 697420697320746F6F- <1>
  2153 00002041 20736D616C6C2E0A00  <1>
  2154                              <1> 		
  2155 0000204A 47656E6572616C2070- <1> err13	db "General protection violation:",10
  2156 00002053 726F74656374696F6E- <1>
  2157 0000205C 2076696F6C6174696F- <1>
  2158 00002065 6E3A0A              <1>
  2159 00002068 596F752076696F6C61- <1> 		db "You violated the computer. Step away slowly. The FBI is on its way.",10,0
  2160 00002071 746564207468652063- <1>
  2161 0000207A 6F6D70757465722E20- <1>
  2162 00002083 537465702061776179- <1>
  2163 0000208C 20736C6F776C792E20- <1>
  2164 00002095 546865204642492069- <1>
  2165 0000209E 73206F6E2069747320- <1>
  2166 000020A7 7761792E0A00        <1>
  2167                              <1> 		
  2168 000020AD 50616765206661756C- <1> err14	db "Page fault:",10
  2169 000020B6 743A0A              <1>
  2170 000020B9 546865207061676520- <1> 		db "The page that was requested was not available.",10,0
  2171 000020C2 746861742077617320- <1>
  2172 000020CB 726571756573746564- <1>
  2173 000020D4 20776173206E6F7420- <1>
  2174 000020DD 617661696C61626C65- <1>
  2175 000020E6 2E0A00              <1>
  2176                              <1> 		
  2177 000020E9 526573657276656420- <1> err15	db "Reserved for Plan R:",10
  2178 000020F2 666F7220506C616E20- <1>
  2179 000020FB 523A0A              <1>
  2180 000020FE 5468697320696E7465- <1> 		db "This interrupt is reserved for usage only by the military when it is necessary",10
  2181 00002107 727275707420697320- <1>
  2182 00002110 726573657276656420- <1>
  2183 00002119 666F72207573616765- <1>
  2184 00002122 206F6E6C7920627920- <1>
  2185 0000212B 746865206D696C6974- <1>
  2186 00002134 617279207768656E20- <1>
  2187 0000213D 6974206973206E6563- <1>
  2188 00002146 6573736172790A      <1>
  2189 0000214D 746F20696E69746961- <1> 		db "to initiate a full-scale coup d'",130,"tat.",10,0
  2190 00002156 746520612066756C6C- <1>
  2191 0000215F 2D7363616C6520636F- <1>
  2192 00002168 757020642782746174- <1>
  2193 00002171 2E0A00              <1>
  2194                              <1> 		
  2195 00002174 576861742074686520- <1> unknownerror db "What the hell just happened? Is everyone okay? Hard drive? Video card?",10
  2196 0000217D 68656C6C206A757374- <1>
  2197 00002186 2068617070656E6564- <1>
  2198 0000218F 3F2049732065766572- <1>
  2199 00002198 796F6E65206F6B6179- <1>
  2200 000021A1 3F2048617264206472- <1>
  2201 000021AA 6976653F2056696465- <1>
  2202 000021B3 6F20636172643F0A    <1>
  2203 000021BB 4D656D6F72793F2041- <1> 			db	"Memory? Are you there?",10,0
  2204 000021C4 726520796F75207468- <1>
  2205 000021CD 6572653F0A00        <1>
  2206                                      %include 'source/ints.asm'
  2207                              <1> newints:	;;for great justice
  2208 000021D3 80FC00              <1> 	cmp ah, 0		;;originally 0
  2209 000021D6 0F847F000000        <1> 	je near intx0   ;;0=kills app
  2210 000021DC 80FC01              <1> 	cmp ah, 1		;;originally 1
  2211 000021DF 0F84E3000000        <1> 	je near intx1   ;;3=print string
  2212 000021E5 80FC02              <1> 	cmp ah, 2		;;originally 2
  2213 000021E8 0F8435010000        <1> 	je near intx2	;;4=read string
  2214 000021EE 80FC03              <1> 	cmp ah, 3		;;originally 3
  2215 000021F1 0F8467010000        <1> 	je near intx3	;;6=clear screen
  2216 000021F7 80FC04              <1> 	cmp ah, 4		;;originally 4
  2217 000021FA 0F84DE010000        <1> 	je near intx4	;;5=read and print string
  2218 00002200 80FC05              <1> 	cmp ah, 5		;;originally 5		
  2219 00002203 0F8451050000        <1> 	je near intx5	;;2=get char
  2220 00002209 80FC06              <1> 	cmp ah, 6		;;originally 6
  2221 0000220C 0F849B050000        <1> 	je near intx6	;;1=print char
  2222 00002212 80FC07              <1> 	cmp ah, 7
  2223 00002215 0F8473070000        <1> 	je near intx7	;;read file
  2224                              <1> ;	cmp ah, 8		;;write file
  2225                              <1> ;	je near intx8
  2226 0000221B 80FC09              <1> 	cmp ah, 9
  2227 0000221E 0F8474070000        <1> 	je near intx9	;;convert number to string
  2228 00002224 80FC0A              <1> 	cmp ah, 10
  2229 00002227 0F8483070000        <1> 	je near intx10	;;convert string to number
  2230 0000222D 80FC0B              <1> 	cmp ah, 11
  2231 00002230 0F8480070000        <1> 	je near intx11	;;create thread
  2232 00002236 80FC0C              <1> 	cmp ah, 12		;;get time
  2233 00002239 0F847D070000        <1> 	je near intx12
  2234 0000223F 80FC0D              <1> 	cmp ah, 13		;;set time
  2235 00002242 0F8485070000        <1> 	je near intx13
  2236 00002248 80FC0E              <1> 	cmp ah, 14		;;run program
  2237 0000224B 0F8488070000        <1> 	je near intx14
  2238 00002251 80FC0F              <1> 	cmp ah, 15		;;get program info-location of name/options/number of options/environmental vars
  2239 00002254 0F8491070000        <1> 	je near intx15
  2240 0000225A C3                  <1> 	ret
  2241                              <1> 	
  2242                              <1> ;;the jmp timerinterrupt's ensure that task switches occur
  2243                              <1> intx0:
  2244                              <1> 	%include 'source/interrupts/0-exit.asm'
  2245                              <2> exitprog:
  2246 0000225B 66BB2800            <2> 	mov bx, NEW_DATA_SEL
  2247 0000225F 8EDB                <2> 	mov ds, bx
  2248 00002261 8EC3                <2> 	mov es, bx
  2249 00002263 8EE3                <2> 	mov fs, bx
  2250 00002265 66BB1800            <2> 	mov bx, SYS_DATA_SEL
  2251 00002269 8EEB                <2> 	mov gs, bx
  2252 0000226B 3C00                <2> 	cmp al, 0
  2253 0000226D 0F8505000000        <2> 	jne near warnexitstatus
  2254 00002273 E9240B0000          <2> 	jmp nwcmd
  2255                              <2> 	
  2256                              <2> warnexitstatus:
  2257 00002278 88C1                <2> 	mov cl, al
  2258 0000227A B000                <2> 	mov al, 0
  2259 0000227C A2[97320000]        <2> 	mov [firsthexshown], al
  2260 00002281 6651                <2> 	push cx
  2261 00002283 BE[A3220000]        <2> 	mov esi, exitstatus1msg
  2262 00002288 E857000000          <2> 	call print
  2263 0000228D 6659                <2> 	pop cx
  2264 0000228F E804100000          <2> 	call showhexsmall
  2265 00002294 BE[B8220000]        <2> 	mov esi, exitstatus2msg
  2266 00002299 E846000000          <2> 	call print
  2267 0000229E E9F90A0000          <2> 	jmp nwcmd
  2268                              <2> 	
  2269 000022A3 416E20657869742073- <2> exitstatus1msg db "An exit status of 0x",0
  2270 000022AC 7461747573206F6620- <2>
  2271 000022B5 307800              <2>
  2272 000022B8 087761732072657475- <2> exitstatus2msg db 8,"was returned.",10,0
  2273 000022C1 726E65642E0A00      <2>
  2274                              <1> intx1:
  2275                              <1> 	%include 'source/interrupts/1-prntstr.asm'
  2276 000022C8 E81E000000          <2> call printint
  2277 000022CD E9C0E3FFFF          <2> jmp timerinterrupt
  2278                              <2> 
  2279                              <2> 	printquiet:
  2280 000022D2 6631C0              <2> 		xor ax, ax
  2281 000022D5 A2[1E230000]        <2> 		mov [endkeyprint], al
  2282 000022DA 66BB0700            <2> 		mov bx, 7
  2283 000022DE E828000000          <2> 		call printintb
  2284 000022E3 C3                  <2> 		ret
  2285                              <2>     print:
  2286 000022E4 6631C0              <2> 		xor ax, ax
  2287 000022E7 66BB0700            <2> 		mov bx, 7
  2288                              <2> 	printint:	;;print line, al=last key,bl=modifier, esi=buffer
  2289 000022EB 8935[1F230000]      <2> 		mov [startesiprint], esi
  2290 000022F1 A2[1E230000]        <2> 		mov [endkeyprint], al
  2291 000022F6 E810000000          <2> 		call printintb
  2292 000022FB 89F1                <2> 		mov ecx, esi
  2293 000022FD 2B0D[1F230000]      <2> 		sub ecx, [startesiprint]
  2294 00002303 51                  <2> 		push ecx
  2295 00002304 E818070000          <2> 		call termcopy
  2296 00002309 59                  <2> 		pop ecx
  2297 0000230A C3                  <2> 		ret
  2298                              <2> 	printintb:
  2299 0000230B 8A06                <2> 		mov al, [esi]
  2300 0000230D 3A05[1E230000]      <2> 		cmp al, [endkeyprint]
  2301 00002313 7408                <2> 		je doneprintint
  2302 00002315 E8AE040000          <2> 		call prcharq
  2303 0000231A 46                  <2> 		inc esi
  2304 0000231B EBEE                <2> 		jmp printintb
  2305                              <2> 	doneprintint:
  2306 0000231D C3                  <2> 		ret
  2307                              <2> 
  2308 0000231E 00                  <2> endkeyprint db 0
  2309 0000231F 00000000            <2> startesiprint dd 0
  2310                              <1> intx2:
  2311                              <1> 	%include 'source/interrupts/2-readstr.asm'
  2312 00002323 E805000000          <2> call readint
  2313 00002328 E965E3FFFF          <2> jmp timerinterrupt
  2314                              <2> 
  2315                              <2> 	readint:	;;get line, al=last key, esi = buffer, edi = endbuffer
  2316 0000232D A2[59230000]        <2> 		mov [endkeyread], al
  2317 00002332 893D[5A230000]      <2> 		mov [endbufferread], edi
  2318                              <2> 	readintb:
  2319 00002338 56                  <2> 		push esi
  2320 00002339 30C0                <2> 		xor al, al
  2321 0000233B E826040000          <2> 		call rdcharint
  2322 00002340 5E                  <2> 		pop esi
  2323 00002341 8806                <2> 		mov [esi], al
  2324 00002343 46                  <2> 		inc esi
  2325 00002344 3B35[5A230000]      <2> 		cmp esi, [endbufferread]
  2326 0000234A 7308                <2> 		jae readdone
  2327 0000234C 3A05[59230000]      <2> 		cmp al, [endkeyread]
  2328 00002352 75E4                <2> 		jne readintb
  2329                              <2> 	readdone:
  2330 00002354 4E                  <2> 		dec esi
  2331 00002355 C60600              <2> 		mov byte [esi], 0
  2332 00002358 C3                  <2> 	ret
  2333 00002359 00                  <2> endkeyread db 0
  2334 0000235A 00000000            <2> endbufferread dd 0
  2335                              <1> intx3:
  2336                              <1> 	%include 'source/interrupts/3-clearscrn.asm'
  2337 0000235E E805000000          <2> call clear
  2338 00002363 E92AE3FFFF          <2> jmp timerinterrupt
  2339                              <2> clear:		
  2340 00002368 668B0D[8A290000]    <2> 		mov cx, [charxy]
  2341 0000236F BF[A4BC0000]        <2> 		mov edi, videobuf
  2342 00002374 6631C0              <2> 		xor ax, ax
  2343 00002377 66A3[84290000]      <2> 		mov [linebeginpos], ax
  2344 0000237D 66A3[86290000]      <2> 		mov [videobufpos], ax
  2345 00002383 6631D2              <2> 		xor dx, dx
  2346 00002386 66A3[88290000]      <2> 		mov [charpos], ax
  2347 0000238C B407                <2> 		mov ah, 7
  2348                              <2> 	clearb:
  2349 0000238E 8807                <2> 		mov [edi], al
  2350 00002390 886701              <2> 		mov [edi + 1], ah
  2351 00002393 81C702000000        <2> 		add edi, 2
  2352 00002399 FEC9                <2> 		dec cl
  2353 0000239B 80F900              <2> 		cmp cl, 0
  2354 0000239E 75EE                <2> 		jne clearb
  2355 000023A0 8A0D[8A290000]      <2> 		mov cl, [charxy]
  2356 000023A6 FECD                <2> 		dec ch
  2357 000023A8 80FD00              <2> 		cmp ch, 0
  2358 000023AB 75E1                <2> 		jne clearb
  2359                              <2> 	cleardouble:
  2360 000023AD BF[E40D0100]        <2> 		mov edi, videobuf2
  2361 000023B2 668B0D[8A290000]    <2> 		mov cx, [charxy]
  2362 000023B9 31C0                <2> 		xor eax, eax
  2363                              <2> 	clearc:
  2364 000023BB 668907              <2> 		mov [edi], ax
  2365 000023BE 81C702000000        <2> 		add edi, 2
  2366 000023C4 FEC9                <2> 		dec cl
  2367 000023C6 80F900              <2> 		cmp cl, 0
  2368 000023C9 75F0                <2> 		jne clearc
  2369 000023CB 8A0D[8A290000]      <2> 		mov cl, [charxy]
  2370 000023D1 FECD                <2> 		dec ch
  2371 000023D3 80FD00              <2> 		cmp ch, 0
  2372 000023D6 75E3                <2> 		jne clearc
  2373 000023D8 E844060000          <2> 		call termcopy
  2374 000023DD C3                  <2> 		ret
  2375                              <2> 		
  2376                              <1> intx4:
  2377                              <1> 	%include 'source/interrupts/4-prntreadstr.asm'
  2378 000023DE E809000000          <2> call rdprint
  2379 000023E3 E9AAE2FFFF          <2> jmp timerinterrupt
  2380                              <2> 
  2381                              <2> readline:
  2382 000023E8 B00A                <2>   mov al, 10
  2383 000023EA B307                <2>   mov bl, 7
  2384                              <2> 	rdprint:	;;print and get line, al=last key, bl=modifier, esi=buffer, edi=bufferend
  2385 000023EC 8935[4F270000]      <2> 		mov [buftxtloc], esi
  2386 000023F2 A2[47270000]        <2> 		mov [endkeyrdpr], al
  2387 000023F7 881D[48270000]      <2> 		mov [modkeyrdpr], bl
  2388 000023FD 8935[49270000]      <2> 		mov [firstesirdpr], esi
  2389 00002403 893D[53270000]      <2> 		mov [endbufferrdpr], edi
  2390                              <2> 	rdprintb:
  2391 00002409 56                  <2> 		push esi
  2392 0000240A B001                <2> 		mov al, 1
  2393 0000240C E855030000          <2> 		call rdcharint
  2394 00002411 5E                  <2> 		pop esi
  2395 00002412 803D[D2520000]E0    <2> 		cmp byte [specialkey], 0xE0
  2396 00002419 751B                <2> 		jne notspecialrdprnt
  2397 0000241B 80FC53              <2> 		cmp ah, 0x53
  2398 0000241E 0F84E8020000        <2> 		je near rdprdel
  2399 00002424 80FC47              <2> 		cmp ah, 0x47
  2400 00002427 0F8407010000        <2> 		je near rdprhome
  2401 0000242D 80FC4F              <2> 		cmp ah, 0x4F
  2402 00002430 0F841D010000        <2> 		je near rdprend
  2403                              <2> 	notspecialrdprnt:
  2404 00002436 80FC48              <2> 		cmp ah, 0x48
  2405 00002439 0F84D5010000        <2> 		je near rdprup
  2406 0000243F 80FC50              <2> 		cmp ah, 0x50
  2407 00002442 0F84AF010000        <2> 		je near rdprdown
  2408 00002448 80FC4D              <2> 		cmp ah, 0x4D
  2409 0000244B 0F845E010000        <2> 		je near rdprright
  2410 00002451 80FC4B              <2> 		cmp ah, 0x4B
  2411 00002454 0F8416010000        <2> 		je near rdprleft
  2412 0000245A 3C08                <2> 		cmp al, 8
  2413 0000245C 0F84C5020000        <2> 		je near rdprbscheck
  2414 00002462 3C00                <2> 		cmp al, 0
  2415 00002464 74A3                <2> 		je rdprintb
  2416 00002466 80FC00              <2> 		cmp ah, 0
  2417 00002469 749E                <2> 		je rdprintb
  2418 0000246B 8806                <2> 		mov [esi], al
  2419 0000246D 46                  <2> 		inc esi
  2420                              <2> 	bscheckequal:
  2421 0000246E 8A1D[48270000]      <2> 		mov bl, [modkeyrdpr]
  2422 00002474 8A3D[4E270000]      <2> 		mov bh, [txtmask]
  2423 0000247A 80FF00              <2> 		cmp bh, 0
  2424 0000247D 7404                <2> 		je nomasktxt
  2425 0000247F 88F8                <2> 		mov al, bh
  2426 00002481 30FF                <2> 		xor bh, bh
  2427                              <2> 	nomasktxt:
  2428 00002483 E82F030000          <2> 		call prcharint
  2429 00002488 56                  <2> 		push esi
  2430 00002489 66A3[45270000]      <2> 		mov [axcache], ax
  2431 0000248F 8A25[47270000]      <2> 		mov ah, [endkeyrdpr]
  2432 00002495 38E0                <2> 		cmp al, ah
  2433 00002497 7429                <2> 		je nobackprintbuftxt2
  2434 00002499 BE[85B40000]        <2> 		mov esi, buftxt2
  2435 0000249E E82FFEFFFF          <2> 		call printquiet
  2436 000024A3 B020                <2> 		mov al, " "
  2437 000024A5 E81E030000          <2> 		call prcharq
  2438 000024AA B008                <2> 		mov al, 8
  2439 000024AC 81FE[85B40000]      <2> 		cmp esi, buftxt2
  2440 000024B2 740E                <2> 		je nobackprintbuftxt2
  2441                              <2> 	backprintbuftxt2:
  2442 000024B4 E80F030000          <2> 		call prcharq
  2443 000024B9 4E                  <2> 		dec esi
  2444 000024BA 81FE[85B40000]      <2> 		cmp esi, buftxt2
  2445 000024C0 77F2                <2> 		ja backprintbuftxt2
  2446                              <2> 	nobackprintbuftxt2:
  2447 000024C2 3C0A                <2> 		cmp al, 10
  2448 000024C4 7405                <2> 		je nonobackprint
  2449 000024C6 E8EC020000          <2> 		call prcharint
  2450                              <2> 	nonobackprint:
  2451 000024CB 5E                  <2> 		pop esi
  2452 000024CC 3B35[53270000]      <2> 		cmp esi, [endbufferrdpr]
  2453 000024D2 0F8319000000        <2> 		jae near donerdprinc
  2454 000024D8 66A1[45270000]      <2> 		mov ax, [axcache]
  2455 000024DE 8A25[47270000]      <2> 		mov ah, [endkeyrdpr]
  2456 000024E4 38E0                <2> 		cmp al, ah
  2457 000024E6 0F851DFFFFFF        <2> 		jne rdprintb
  2458 000024EC E901000000          <2> 		jmp donerdprint
  2459                              <2> 	donerdprinc:
  2460 000024F1 46                  <2> 		inc esi
  2461                              <2> 	donerdprint:
  2462 000024F2 4E                  <2> 		dec esi
  2463 000024F3 BF[85B40000]        <2> 		mov edi, buftxt2
  2464                              <2> 	copylaterstuff:
  2465 000024F8 8A07                <2> 		mov al, [edi]
  2466 000024FA 3C00                <2> 		cmp al, 0
  2467 000024FC 7406                <2> 		je nocopylaterstuff
  2468 000024FE 8806                <2> 		mov [esi], al
  2469 00002500 47                  <2> 		inc edi
  2470 00002501 46                  <2> 		inc esi
  2471 00002502 EBF4                <2> 		jmp copylaterstuff
  2472                              <2> 	nocopylaterstuff:
  2473 00002504 C60600              <2> 		mov byte [esi], 0
  2474 00002507 E80B000000          <2> 		call clearbuftxt2
  2475 0000250C 89F1                <2> 		mov ecx, esi
  2476 0000250E 8B3D[49270000]      <2> 		mov edi, [firstesirdpr]
  2477 00002514 29F9                <2> 		sub ecx, edi
  2478 00002516 C3                  <2> 		ret
  2479                              <2> 	
  2480                              <2> 	clearbuftxt2:
  2481 00002517 30C0                <2> 		xor al, al
  2482 00002519 BF[85B40000]        <2> 		mov edi, buftxt2
  2483                              <2> 	clearbuftxt2lp:
  2484 0000251E 8807                <2> 		mov [edi], al
  2485 00002520 47                  <2> 		inc edi
  2486 00002521 81FF[8FB80000]      <2> 		cmp edi, buftxt
  2487 00002527 75F5                <2> 		jne clearbuftxt2lp
  2488 00002529 C3                  <2> 		ret
  2489                              <2> 	
  2490                              <2> 	rdprintb2:
  2491 0000252A E8F2040000          <2> 		call termcopy
  2492 0000252F E9D5FEFFFF          <2> 		jmp rdprintb
  2493                              <2> 		
  2494                              <2> 	rdprhome:
  2495 00002534 3B35[4F270000]      <2> 		cmp esi, [buftxtloc]
  2496 0000253A 0F84EAFFFFFF        <2> 		je near rdprintb2
  2497 00002540 BF[85B40000]        <2> 		mov edi, buftxt2
  2498 00002545 8A07                <2> 		mov al, [edi]
  2499 00002547 E846000000          <2> 		call shiftbuftxt2
  2500 0000254C E877020000          <2> 		call prcharq
  2501 00002551 EBE1                <2> 		jmp rdprhome
  2502                              <2> 		
  2503                              <2> 	rdprend:
  2504 00002553 BF[85B40000]        <2> 		mov edi, buftxt2
  2505 00002558 8A07                <2> 		mov al, [edi]
  2506 0000255A 3C00                <2> 		cmp al, 0
  2507 0000255C 0F84C8FFFFFF        <2> 		je near rdprintb2
  2508 00002562 8806                <2> 		mov [esi], al
  2509 00002564 E866000000          <2> 		call shiftbuftxt2lft
  2510 00002569 E85A020000          <2> 		call prcharq
  2511 0000256E EBE3                <2> 		jmp rdprend
  2512                              <2> 	
  2513                              <2> 	rdprleft:
  2514 00002570 3B35[4F270000]      <2> 		cmp esi, [buftxtloc]
  2515 00002576 0F848DFEFFFF        <2> 		je near rdprintb
  2516 0000257C BF[85B40000]        <2> 		mov edi, buftxt2
  2517 00002581 8A07                <2> 		mov al, [edi]
  2518 00002583 E80A000000          <2> 		call shiftbuftxt2
  2519 00002588 E82A020000          <2> 		call prcharint
  2520 0000258D E977FEFFFF          <2> 		jmp rdprintb
  2521                              <2> 	shiftbuftxt2:
  2522 00002592 3C00                <2> 		cmp al, 0
  2523 00002594 7409                <2> 		je noshiftbuftxt2
  2524 00002596 47                  <2> 		inc edi
  2525 00002597 8A27                <2> 		mov ah, [edi]
  2526 00002599 8807                <2> 		mov [edi], al
  2527 0000259B 88E0                <2> 		mov al, ah
  2528 0000259D EBF3                <2> 		jmp shiftbuftxt2
  2529                              <2> 	noshiftbuftxt2:
  2530 0000259F BF[85B40000]        <2> 		mov edi, buftxt2
  2531 000025A4 4E                  <2> 		dec esi
  2532 000025A5 8A06                <2> 		mov al, [esi]
  2533 000025A7 8807                <2> 		mov [edi], al
  2534 000025A9 C60600              <2> 		mov byte [esi], 0
  2535 000025AC B008                <2> 		mov al, 8
  2536 000025AE C3                  <2> 		ret
  2537                              <2> 		
  2538                              <2> 	rdprright:
  2539 000025AF BF[85B40000]        <2> 		mov edi, buftxt2
  2540 000025B4 8A07                <2> 		mov al, [edi]
  2541 000025B6 3C00                <2> 		cmp al, 0
  2542 000025B8 0F844BFEFFFF        <2> 		je near rdprintb
  2543 000025BE 8806                <2> 		mov [esi], al
  2544 000025C0 E80A000000          <2> 		call shiftbuftxt2lft
  2545 000025C5 E8ED010000          <2> 		call prcharint
  2546 000025CA E93AFEFFFF          <2> 		jmp rdprintb
  2547                              <2> 	shiftbuftxt2lft:
  2548 000025CF 3C00                <2> 		cmp al, 0
  2549 000025D1 7408                <2> 		je noshiftbuftxt2lft
  2550 000025D3 47                  <2> 		inc edi
  2551 000025D4 8A07                <2> 		mov al, [edi]
  2552 000025D6 8847FF              <2> 		mov [edi - 1], al
  2553 000025D9 EBF4                <2> 		jmp shiftbuftxt2lft
  2554                              <2> 	noshiftbuftxt2lft:
  2555 000025DB 8A06                <2> 		mov al, [esi]
  2556 000025DD 46                  <2> 		inc esi
  2557 000025DE 8A1D[48270000]      <2> 		mov bl, [modkeyrdpr]
  2558 000025E4 C3                  <2> 		ret
  2559                              <2> 		
  2560                              <2> 	rdprdownbck:
  2561 000025E5 FECC                <2> 		dec ah
  2562 000025E7 8825[4D270000]      <2> 		mov [commandedit], ah
  2563 000025ED E83A000000          <2> 		call rdprbckspc
  2564 000025F2 E912FEFFFF          <2> 		jmp rdprintb
  2565                              <2> 	
  2566                              <2> 	rdprdown:
  2567 000025F7 8A25[4D270000]      <2> 		mov ah, [commandedit]
  2568 000025FD 80FC01              <2> 		cmp ah, 1
  2569 00002600 0F8603FEFFFF        <2> 		jbe near rdprintb
  2570 00002606 80FC02              <2> 		cmp ah, 2
  2571 00002609 74DA                <2> 		je rdprdownbck
  2572 0000260B 80EC02              <2> 		sub ah, 2
  2573 0000260E 8825[4D270000]      <2> 		mov [commandedit], ah
  2574                              <2> 		
  2575                              <2> 	rdprup:
  2576 00002614 30C0                <2> 		xor al, al
  2577 00002616 3805[4D270000]      <2> 		cmp [commandedit], al
  2578 0000261C 0F84E7FDFFFF        <2> 		je near rdprintb
  2579 00002622 E805000000          <2> 		call rdprbckspc
  2580 00002627 E941000000          <2> 		jmp getcurrentcommandstr
  2581                              <2> 	rdprbckspc:
  2582 0000262C 3B35[4F270000]      <2> 		cmp esi, [buftxtloc]
  2583 00002632 742B                <2> 		je nordprupbck
  2584                              <2> 	rdprupbckspclp:
  2585 00002634 B008                <2> 		mov al, 8
  2586 00002636 8A1D[48270000]      <2> 		mov bl, [modkeyrdpr]
  2587 0000263C E887010000          <2> 		call prcharq
  2588 00002641 B020                <2> 		mov al, " "
  2589 00002643 E880010000          <2> 		call prcharq
  2590 00002648 B008                <2> 		mov al, 8
  2591 0000264A E879010000          <2> 		call prcharq
  2592 0000264F 4E                  <2> 		dec esi
  2593 00002650 3B35[4F270000]      <2> 		cmp esi, [buftxtloc]
  2594 00002656 7402                <2> 		je nordprupbck2
  2595 00002658 EBDA                <2> 		jmp rdprupbckspclp
  2596                              <2> 	nordprupbck2:
  2597 0000265A E8C2030000          <2> 		call termcopy
  2598                              <2> 	nordprupbck:
  2599 0000265F 8B3D[285F0100]      <2> 		mov edi, [currentcommandpos]
  2600 00002665 81C7[2C5F0100]      <2> 		add edi, commandbuf
  2601 0000266B 4F                  <2> 		dec edi
  2602 0000266C C3                  <2> 		ret
  2603                              <2> 	getcurrentcommandstr:
  2604 0000266D 8A25[4D270000]      <2> 		mov ah, [commandedit]
  2605 00002673 FE05[4D270000]      <2> 		inc byte [commandedit]
  2606                              <2> 	getccmdlp:
  2607 00002679 4F                  <2> 		dec edi
  2608 0000267A 8A07                <2> 		mov al, [edi]
  2609 0000267C 81FF[2C5F0100]      <2> 		cmp edi, commandbuf
  2610 00002682 7231                <2> 		jb getcmdresetcommandbuf
  2611 00002684 81EF[2C5F0100]      <2> 		sub edi, commandbuf
  2612 0000268A 3B3D[285F0100]      <2> 		cmp edi, [currentcommandpos]
  2613 00002690 0F8473FDFFFF        <2> 		je near rdprintb
  2614 00002696 81C7[2C5F0100]      <2> 		add edi, commandbuf
  2615 0000269C 3C00                <2> 		cmp al, 0
  2616 0000269E 75D9                <2> 		jne getccmdlp
  2617 000026A0 FECC                <2> 		dec ah
  2618 000026A2 80FC00              <2> 		cmp ah, 0
  2619 000026A5 77D2                <2> 		ja getccmdlp
  2620 000026A7 47                  <2> 		inc edi
  2621 000026A8 81FF[2C6F0100]      <2> 		cmp edi, commandbufend
  2622 000026AE 770D                <2> 		ja fixcmdbufb4morerdpr
  2623 000026B0 E915000000          <2> 		jmp morerdprup
  2624                              <2> 	getcmdresetcommandbuf:
  2625 000026B5 BF[2C6F0100]        <2> 		mov edi, commandbufend
  2626 000026BA 47                  <2> 		inc edi
  2627 000026BB EBBC                <2> 		jmp getccmdlp
  2628                              <2> 	fixcmdbufb4morerdpr:
  2629 000026BD 4F                  <2> 		dec edi
  2630 000026BE 81EF[2C6F0100]      <2> 		sub edi, commandbufend
  2631 000026C4 81C7[2C5F0100]      <2> 		add edi, commandbuf
  2632                              <2> 	morerdprup:
  2633 000026CA 8A07                <2> 		mov al, [edi]
  2634 000026CC 47                  <2> 		inc edi
  2635 000026CD 81EF[2C5F0100]      <2> 		sub edi, commandbuf
  2636 000026D3 3C00                <2> 		cmp al, 0
  2637 000026D5 0F844FFEFFFF        <2> 		je near rdprintb2
  2638 000026DB 3B3D[285F0100]      <2> 		cmp edi, [currentcommandpos]
  2639 000026E1 0F8343FEFFFF        <2> 		jae near rdprintb2
  2640 000026E7 81C7[2C5F0100]      <2> 		add edi, commandbuf
  2641 000026ED 8806                <2> 		mov [esi], al
  2642 000026EF 46                  <2> 		inc esi
  2643 000026F0 57                  <2> 		push edi
  2644 000026F1 8A1D[48270000]      <2> 		mov bl, [modkeyrdpr]
  2645 000026F7 E8CC000000          <2> 		call prcharq
  2646 000026FC 5F                  <2> 		pop edi
  2647 000026FD 81FF[2C6F0100]      <2> 		cmp edi, commandbufend
  2648 00002703 76C5                <2> 		jbe morerdprup
  2649 00002705 BF[2C5F0100]        <2> 		mov edi, commandbuf
  2650 0000270A EBBE                <2> 		jmp morerdprup
  2651                              <2> 		
  2652                              <2> 	rdprdel:
  2653 0000270C BF[85B40000]        <2> 		mov edi, buftxt2
  2654 00002711 8A07                <2> 		mov al, [edi]
  2655 00002713 3C00                <2> 		cmp al, 0
  2656 00002715 0F84EEFCFFFF        <2> 		je near rdprintb
  2657 0000271B 8806                <2> 		mov [esi], al
  2658 0000271D E8ADFEFFFF          <2> 		call shiftbuftxt2lft
  2659 00002722 E8A1000000          <2> 		call prcharq
  2660                              <2> 	rdprbscheck:
  2661 00002727 3B35[49270000]      <2> 		cmp esi, [firstesirdpr]
  2662 0000272D 7705                <2> 		ja goodbscheck
  2663 0000272F E9D5FCFFFF          <2> 		jmp rdprintb
  2664                              <2> 	goodbscheck:
  2665 00002734 4E                  <2> 		dec esi
  2666 00002735 C60600              <2> 		mov byte [esi], 0
  2667 00002738 8A1D[48270000]      <2> 		mov bl, [modkeyrdpr]
  2668 0000273E B008                <2> 		mov al, 8
  2669 00002740 E929FDFFFF          <2> 		jmp bscheckequal
  2670                              <2> 		
  2671 00002745 0000                <2> axcache dw 0
  2672 00002747 00                  <2> endkeyrdpr db 0
  2673 00002748 00                  <2> modkeyrdpr db 0
  2674 00002749 00000000            <2> firstesirdpr dd 0
  2675 0000274D 00                  <2> commandedit db 0
  2676 0000274E 00                  <2> txtmask db 0
  2677 0000274F 00000000            <2> buftxtloc dd 0
  2678 00002753 00000000            <2> endbufferrdpr dd 0
  2679 00002757 082000              <2> backcursor db 8," ",0
  2680                              <1> intx5:
  2681                              <1> 	%include 'source/interrupts/5-readchar.asm'
  2682 0000275A E807000000          <2> 	call rdcharint
  2683 0000275F E92EDFFFFF          <2> 	jmp timerinterrupt
  2684                              <2> 	
  2685                              <2> getchar:
  2686 00002764 30C0                <2> 	xor al, al
  2687                              <2> 	rdcharint:		;;get char, if al is 0, wait for key
  2688 00002766 C605[AC270000]01    <2> 		mov byte [trans], 1
  2689 0000276D 3C00                <2> 		cmp al, 0
  2690 0000276F 7507                <2> 		jne transcheck
  2691 00002771 C605[AC270000]00    <2> 		mov byte [trans], 0
  2692                              <2> 	transcheck:
  2693 00002778 E8752B0000          <2> 		call getkey
  2694 0000277D 8A3D[AC270000]      <2> 		mov bh, [trans]
  2695 00002783 66A1[AA270000]      <2> 		mov ax, [lastkey]
  2696 00002789 80FC1C              <2> 		cmp ah, 1Ch
  2697 0000278C 7419                <2> 		je rdenter
  2698 0000278E 803D[D2520000]E0    <2> 		cmp byte [specialkey], 0xE0
  2699 00002795 7504                <2> 		jne nospecialtrans
  2700 00002797 88C3                <2> 		mov bl, al
  2701 00002799 30C0                <2> 		xor al, al
  2702                              <2> 	nospecialtrans:
  2703 0000279B 08C7                <2> 		or bh, al
  2704 0000279D 80FF00              <2> 		cmp bh, 0
  2705 000027A0 74D6                <2> 		je transcheck
  2706 000027A2 E902000000          <2> 		jmp rdend
  2707                              <2> 	rdenter:
  2708 000027A7 B00A                <2> 		mov al, 10
  2709                              <2> 	rdend:
  2710 000027A9 C3                  <2> 		ret
  2711                              <2> 		
  2712 000027AA 0000                <2> lastkey db 0,0
  2713 000027AC 00                  <2> trans db 0
  2714                              <1> intx6:
  2715                              <1> 	%include 'source/interrupts/6-prntchar.asm'
  2716 000027AD E805000000          <2> call prcharint
  2717 000027B2 E9DBDEFFFF          <2> jmp timerinterrupt
  2718                              <2> 	
  2719                              <2> prcharint:	;;print char, char in al, modifier in bl, if bh = bl then termcopy will not happen, will run videobufcopy if called as is
  2720 000027B7 38FB                <2> 	cmp bl, bh
  2721 000027B9 740D                <2> 	je prcharq
  2722 000027BB E808000000          <2> 	call prcharq
  2723 000027C0 E85C020000          <2> 	call termcopy
  2724 000027C5 C3                  <2> 	ret
  2725 000027C6 00                  <2> termguion db 0
  2726 000027C7 00                  <2> termcopyon db 0
  2727                              <2> prcharq:
  2728 000027C8 88DC                <2> 	mov ah, bl
  2729 000027CA 66A3[8C290000]      <2> 	mov [charbuf], ax
  2730 000027D0 31DB                <2> 	xor ebx, ebx
  2731 000027D2 668B1D[86290000]    <2> 	mov bx, [videobufpos]
  2732 000027D9 BF[A4BC0000]        <2> 	mov edi, videobuf
  2733 000027DE 01DF                <2> 	add edi, ebx
  2734 000027E0 66A1[1F2A0000]      <2> 	mov ax, [removedvideo]
  2735 000027E6 668907              <2> 	mov [edi], ax
  2736 000027E9 66A1[8C290000]      <2> 	mov ax, [charbuf]
  2737 000027EF 31D2                <2> 	xor edx, edx
  2738 000027F1 668B15[88290000]    <2> 	mov dx, [charpos]
  2739 000027F8 31C9                <2> 	xor ecx, ecx
  2740 000027FA 668B0D[8A290000]    <2> 	mov cx, [charxy]
  2741 00002801 3C09                <2> 	cmp al, 9
  2742 00002803 0F8463000000        <2> 	je near prtab
  2743 00002809 3C0D                <2> 	cmp al, 13		;I am phasing this out-it is used by windows but not unix based systems
  2744 0000280B 0F848B000000        <2> 	je near prcr
  2745 00002811 3C0A                <2> 	cmp al, 10
  2746 00002813 0F84B7000000        <2> 	je near prnlcr
  2747 00002819 3C08                <2> 	cmp al, 8
  2748 0000281B 0F848F000000        <2> 	je near prbs
  2749 00002821 3CFF                <2> 	cmp al, 255		;;null character
  2750 00002823 0F841B000000        <2> 	je near donescr
  2751 00002829 668907              <2> 	mov [edi], ax
  2752 0000282C 81C702000000        <2> 	add edi, 2
  2753 00002832 FEC2                <2> 	inc dl
  2754                              <2> donecrnl:
  2755 00002834 38CA                <2> 	cmp dl, cl
  2756 00002836 0F83B9000000        <2> 	jae near preol
  2757                              <2> doneeol:
  2758 0000283C 38EE                <2> 	cmp dh, ch
  2759 0000283E 0F83CF000000        <2> 	jae near prscr	
  2760                              <2> donescr:
  2761 00002844 89FB                <2> 	mov ebx, edi
  2762 00002846 668B07              <2> 	mov ax, [edi]
  2763 00002849 66A3[1F2A0000]      <2> 	mov [removedvideo], ax
  2764 0000284F 81EB[A4BC0000]      <2> 	sub ebx, videobuf
  2765 00002855 66891D[86290000]    <2> 	mov [videobufpos], bx
  2766 0000285C 668915[88290000]    <2> 	mov [charpos], dx
  2767 00002863 66A1[8C290000]      <2> 	mov ax, [charbuf]
  2768 00002869 88E3                <2> 	mov bl, ah
  2769 0000286B C3                  <2> 	ret
  2770                              <2> 	
  2771                              <2> 	prtab:
  2772 0000286C 31DB                <2> 		xor ebx, ebx
  2773 0000286E 668B1D[84290000]    <2> 		mov bx, [linebeginpos]
  2774 00002875 81EF[A4BC0000]      <2> 		sub edi, videobuf
  2775 0000287B 29DF                <2> 		sub edi, ebx
  2776 0000287D C1EF04              <2> 		shr edi, 4
  2777 00002880 C1E704              <2> 		shl edi, 4
  2778 00002883 81C710000000        <2> 		add edi, 16
  2779 00002889 C0EA03              <2> 		shr dl, 3
  2780 0000288C C0E203              <2> 		shl dl, 3
  2781 0000288F 80C208              <2> 		add dl, 8
  2782 00002892 81C7[A4BC0000]      <2> 		add edi, videobuf
  2783 00002898 01DF                <2> 		add edi, ebx
  2784 0000289A EB98                <2> 		jmp donecrnl
  2785                              <2> 	
  2786                              <2> 	prcr:
  2787 0000289C 30D2                <2> 		xor dl, dl
  2788 0000289E 31DB                <2> 		xor ebx, ebx
  2789 000028A0 BF[A4BC0000]        <2> 		mov edi, videobuf
  2790 000028A5 668B1D[84290000]    <2> 		mov bx, [linebeginpos]
  2791 000028AC 01DF                <2> 		add edi, ebx
  2792 000028AE EB84                <2> 		jmp donecrnl
  2793                              <2> 			
  2794                              <2> 	prbs:
  2795 000028B0 80FA00              <2> 		cmp dl, 0
  2796 000028B3 7410                <2> 		je prbackline
  2797                              <2> 	prnobmr:
  2798 000028B5 FECA                <2> 		dec dl
  2799 000028B7 6631C0              <2> 		xor ax, ax
  2800 000028BA 81EF02000000        <2> 		sub edi, 2
  2801 000028C0 E96FFFFFFF          <2> 		jmp donecrnl
  2802                              <2> 	prbackline:
  2803 000028C5 88CA                <2> 		mov dl, cl
  2804 000028C7 80FE00              <2> 		cmp dh, 0
  2805 000028CA 74E9                <2> 		je prnobmr
  2806 000028CC FECE                <2> 		dec dh
  2807 000028CE EBE5                <2> 		jmp prnobmr
  2808                              <2> 		
  2809                              <2> 	prnlcr:
  2810 000028D0 FEC6                <2> 		inc dh
  2811 000028D2 31DB                <2> 		xor ebx, ebx
  2812 000028D4 30D2                <2> 		xor dl, dl
  2813 000028D6 88CB                <2> 		mov bl, cl
  2814 000028D8 66D1E3              <2> 		shl bx, 1
  2815 000028DB BF[A4BC0000]        <2> 		mov edi, videobuf
  2816 000028E0 66031D[84290000]    <2> 		add bx, [linebeginpos]
  2817 000028E7 66891D[84290000]    <2> 		mov [linebeginpos], bx
  2818 000028EE 01DF                <2> 		add edi, ebx
  2819 000028F0 E93FFFFFFF          <2> 		jmp donecrnl
  2820                              <2> 		
  2821                              <2> 	preol:
  2822 000028F5 30D2                <2> 		xor dl, dl
  2823 000028F7 FEC6                <2> 		inc dh
  2824 000028F9 31DB                <2> 		xor ebx, ebx
  2825 000028FB 88CB                <2> 		mov bl, cl
  2826 000028FD 66D1E3              <2> 		shl bx, 1
  2827 00002900 66031D[84290000]    <2> 		add bx, [linebeginpos]
  2828 00002907 66891D[84290000]    <2> 		mov [linebeginpos], bx
  2829 0000290E E929FFFFFF          <2> 		jmp doneeol
  2830                              <2> 	prscr:
  2831 00002913 FECE                <2> 		dec dh
  2832 00002915 BF[A4BC0000]        <2> 		mov edi, videobuf
  2833 0000291A 31DB                <2> 		xor ebx, ebx
  2834 0000291C 88CB                <2> 		mov bl, cl
  2835 0000291E 66D1E3              <2> 		shl bx, 1
  2836 00002921 01FB                <2> 		add ebx, edi
  2837                              <2> 	intscrollloop:
  2838 00002923 668B03              <2> 		mov ax, [ebx]
  2839 00002926 668907              <2> 		mov [edi], ax
  2840 00002929 81C702000000        <2> 		add edi, 2
  2841 0000292F 81C302000000        <2> 		add ebx, 2
  2842 00002935 FEC9                <2> 		dec cl
  2843 00002937 80F900              <2> 		cmp cl, 0
  2844 0000293A 75E7                <2> 		jne intscrollloop
  2845 0000293C 8A0D[8A290000]      <2> 		mov cl, [charxy]
  2846 00002942 FECD                <2> 		dec ch
  2847 00002944 80FD01              <2> 		cmp ch, 1
  2848 00002947 77DA                <2> 		ja intscrollloop
  2849 00002949 6631C0              <2> 		xor ax, ax
  2850 0000294C 81EF[A4BC0000]      <2> 		sub edi, videobuf
  2851 00002952 66893D[84290000]    <2> 		mov [linebeginpos], di
  2852 00002959 81C7[A4BC0000]      <2> 		add edi, videobuf
  2853 0000295F 89FB                <2> 		mov ebx, edi
  2854                              <2> 	intloopclear:
  2855 00002961 668903              <2> 		mov [ebx], ax
  2856 00002964 81C302000000        <2> 		add ebx, 2
  2857 0000296A FEC9                <2> 		dec cl
  2858 0000296C 80F900              <2> 		cmp cl, 0
  2859 0000296F 75F0                <2> 		jne intloopclear
  2860 00002971 FECD                <2> 		dec ch
  2861 00002973 80FD00              <2> 		cmp ch, 0
  2862 00002976 75E9                <2> 		jne intloopclear
  2863 00002978 668B0D[8A290000]    <2> 		mov cx, [charxy]
  2864 0000297F E9C0FEFFFF          <2> 		jmp donescr
  2865                              <2> 		
  2866 00002984 0000                <2> linebeginpos dw 0
  2867 00002986 0000                <2> videobufpos: dw 0
  2868 00002988 0000                <2> charpos db 0,0
  2869 0000298A 501E                <2> charxy db 80,30
  2870 0000298C 0000                <2> charbuf dw 0
  2871                              <1> intx7:
  2872                              <1> 	%include 'source/interrupts/7-openfile.asm'
  2873 0000298E E8A7470000          <2> 	call loadfile
  2874 00002993 E9FADCFFFF          <2> 	jmp timerinterrupt
  2875                              <1> intx9:
  2876                              <1> 	%include 'source/interrupts/9-num2str.asm'
  2877 00002998 3C00                <2> 	cmp al, 0
  2878 0000299A 750A                <2> 	jne num2strb
  2879 0000299C E8C2090000          <2> 	call showdec
  2880 000029A1 E9ECDCFFFF          <2> 	jmp timerinterrupt
  2881                              <2> num2strb:
  2882 000029A6 E801090000          <2> 	call showhex
  2883 000029AB E9E2DCFFFF          <2> 	jmp timerinterrupt
  2884                              <1> intx10:
  2885                              <1> 	%include 'source/interrupts/10-str2num.asm'
  2886 000029B0 E8820A0000          <2> 	call cnvrttxt	;the string goes into esi, number into ecx
  2887 000029B5 CF                  <2> 	iret
  2888                              <2> 	
  2889                              <1> intx11:
  2890                              <1> 	%include 'source/interrupts/11-forkthread.asm'
  2891 000029B6 E88A4C0000          <2> 	call threadfork
  2892 000029BB CF                  <2> 	iret
  2893                              <1> intx12:
  2894                              <1> 	%include 'source/interrupts/12-gettime.asm'
  2895 000029BC A1[32060000]        <2> 	mov eax, [timeseconds]
  2896 000029C1 8B1D[36060000]      <2> 	mov ebx, [timenanoseconds]
  2897 000029C7 89D9                <2> 	mov ecx, ebx
  2898 000029C9 C1E90A              <2> 	shr ecx, 10	;this is in microseconds
  2899 000029CC CF                  <2> 	iret
  2900                              <2> 	
  2901                              <1> intx13:
  2902                              <1> 	%include 'source/interrupts/13-settime.asm'
  2903 000029CD A3[32060000]        <2> 	mov [timeseconds], eax
  2904 000029D2 891D[36060000]      <2> 	mov [timenanoseconds], ebx
  2905 000029D8 CF                  <2> 	iret
  2906                              <2> 	
  2907                              <1> intx14:
  2908                              <1> 	%include 'source/interrupts/14-runcmd.asm'
  2909 000029D9 BF[8FB80000]        <2> 	mov edi, buftxt
  2910                              <2> cpccmd:
  2911 000029DE 8A06                <2> 	mov al, [esi]
  2912 000029E0 8807                <2> 	mov [edi], al
  2913 000029E2 46                  <2> 	inc esi
  2914 000029E3 47                  <2> 	inc edi
  2915 000029E4 E2F8                <2> 	loop cpccmd
  2916 000029E6 E97D050000          <2> 	jmp run
  2917                              <1> intx15:
  2918                              <1> 	%include 'source/interrupts/15-proginfo.asm'
  2919 000029EB BB[85A40000]        <2> 	mov ebx, variables
  2920 000029F0 8B35[46300000]      <2> 	mov esi, [currentcommandloc]
  2921 000029F6 89F7                <2> 	mov edi, esi
  2922 000029F8 31C9                <2> 	xor ecx, ecx
  2923                              <2> getcommandzeroes:
  2924 000029FA 8A07                <2> 	mov al, [edi]
  2925 000029FC 47                  <2> 	inc edi
  2926 000029FD 3C3B                <2> 	cmp al, ';'
  2927 000029FF 740B                <2> 	je nomorezeroes
  2928 00002A01 3C00                <2> 	cmp al, 0
  2929 00002A03 7407                <2> 	je nomorezeroes
  2930 00002A05 3C20                <2> 	cmp al, ' '
  2931 00002A07 75F1                <2> 	jne getcommandzeroes
  2932 00002A09 41                  <2> 	inc ecx
  2933 00002A0A EBEE                <2> 	jmp getcommandzeroes
  2934                              <2> nomorezeroes:
  2935 00002A0C 41                  <2> 	inc ecx
  2936 00002A0D 4F                  <2> 	dec edi
  2937 00002A0E 8B1D[12A40000]      <2> 	mov ebx, [uid]
  2938 00002A14 8B15[2D780000]      <2> 	mov edx, [currentthread]
  2939 00002A1A CF                  <2> 	iret
  2940                              <2> 	
  2941                              <1> 		
  2942 00002A1B 00000000            <1> 	termcursorpos dd 0
  2943 00002A1F 0000                <1> 	removedvideo dw 0
  2944                              <1> termcopy:	
  2945 00002A21 60                  <1> 	pusha
  2946 00002A22 BF[A4BC0000]        <1> 	mov edi, videobuf
  2947 00002A27 31DB                <1> 	xor ebx, ebx
  2948 00002A29 668B1D[86290000]    <1> 	mov bx, [videobufpos]
  2949 00002A30 01DF                <1> 	add edi, ebx
  2950 00002A32 893D[1B2A0000]      <1> 	mov [termcursorpos], edi
  2951 00002A38 E8CB000000          <1> 	call switchtermcursor
  2952 00002A3D C605[04580000]00    <1> 	mov byte [mouseselecton], 0
  2953 00002A44 C605[C7270000]01    <1> 	mov byte [termcopyon], 1
  2954 00002A4B 803D[AB8B0000]00    <1> 	cmp byte [guion], 0
  2955 00002A52 0F8412000000        <1> 	je near nowincopy
  2956 00002A58 803D[C6270000]01    <1> 	cmp byte [termguion], 1
  2957 00002A5F 0F84B8390000        <1> 	je near windowvideocopy
  2958 00002A65 E997000000          <1> 	jmp nocopytermatall
  2959                              <1> nowincopy:
  2960 00002A6A BE00000A00          <1> 	mov esi, 0xA0000
  2961 00002A6F A1[1F060000]        <1> 	mov eax, [basecache]
  2962 00002A74 C1E004              <1> 	shl eax, 4
  2963 00002A77 29C6                <1> 	sub esi, eax
  2964 00002A79 BF[A4BC0000]        <1> 	mov edi, videobuf
  2965 00002A7E 31C9                <1> 	xor ecx, ecx
  2966 00002A80 668B0D[8A290000]    <1> 	mov cx, [charxy]
  2967                              <1> nowincopy2:
  2968 00002A87 668B07              <1> 	mov ax, [edi]
  2969 00002A8A 81C740510000        <1> 	add edi, (videobuf2 - videobuf)
  2970 00002A90 668B1F              <1> 	mov bx, [edi]
  2971 00002A93 668907              <1> 	mov [edi], ax
  2972 00002A96 81EF40510000        <1> 	sub edi, (videobuf2 - videobuf)
  2973 00002A9C 47                  <1> 	inc edi
  2974 00002A9D 6639D8              <1> 	cmp ax, bx
  2975 00002AA0 743E                <1> 	je nopresentwinfont
  2976 00002AA2 4F                  <1> 	dec edi
  2977 00002AA3 BB[99780000]        <1> 	mov ebx, fonts
  2978 00002AA8 31C0                <1> 	xor eax, eax
  2979 00002AAA 8A07                <1> 	mov al, [edi]
  2980 00002AAC C1E004              <1> 	shl eax, 4
  2981 00002AAF 01C3                <1> 	add ebx, eax
  2982 00002AB1 47                  <1> 	inc edi
  2983 00002AB2 8A27                <1> 	mov ah, [edi]
  2984 00002AB4 31D2                <1> 	xor edx, edx
  2985 00002AB6 8A15[8A290000]      <1> 	mov dl, [charxy]
  2986 00002ABC C1C110              <1> 	rol ecx, 16
  2987 00002ABF B110                <1> 	mov cl, 16
  2988                              <1> nowinfont:
  2989 00002AC1 8A03                <1> 	mov al, [ebx]
  2990 00002AC3 D0C8                <1> 	ror al, 1
  2991 00002AC5 80FC07              <1> 	cmp ah, 7
  2992 00002AC8 7602                <1> 	jbe notnotfont
  2993 00002ACA F6D0                <1> 	not al
  2994                              <1> notnotfont:
  2995 00002ACC 8806                <1> 	mov [esi], al
  2996 00002ACE 01D6                <1> 	add esi, edx
  2997 00002AD0 43                  <1> 	inc ebx
  2998 00002AD1 FEC9                <1> 	dec cl
  2999 00002AD3 80F900              <1> 	cmp cl, 0
  3000 00002AD6 75E9                <1> 	jne nowinfont
  3001 00002AD8 C1E204              <1> 	shl edx, 4
  3002 00002ADB 29D6                <1> 	sub esi, edx
  3003 00002ADD C1C110              <1> 	rol ecx, 16
  3004                              <1> nopresentwinfont:
  3005 00002AE0 47                  <1> 	inc edi
  3006 00002AE1 46                  <1> 	inc esi
  3007 00002AE2 FEC9                <1> 	dec cl
  3008 00002AE4 80F900              <1> 	cmp cl, 0
  3009 00002AE7 759E                <1> 	jne nowincopy2
  3010 00002AE9 8A0D[8A290000]      <1> 	mov cl, [charxy]
  3011 00002AEF 31D2                <1> 	xor edx, edx
  3012 00002AF1 88CA                <1> 	mov dl, cl
  3013 00002AF3 29D6                <1> 	sub esi, edx
  3014 00002AF5 C1E204              <1> 	shl edx, 4
  3015 00002AF8 01D6                <1> 	add esi, edx
  3016 00002AFA FECD                <1> 	dec ch
  3017 00002AFC 80FD00              <1> 	cmp ch, 0
  3018 00002AFF 7586                <1> 	jne nowincopy2
  3019                              <1> nocopytermatall:
  3020 00002B01 E802000000          <1> 	call switchtermcursor
  3021 00002B06 61                  <1> 	popa
  3022 00002B07 C3                  <1> 	ret
  3023                              <1> 	
  3024                              <1> switchtermcursor:
  3025 00002B08 8B3D[1B2A0000]      <1> 	mov edi, [termcursorpos]
  3026 00002B0E 8A4701              <1> 	mov al, [edi + 1]
  3027 00002B11 8A27                <1> 	mov ah, [edi]
  3028 00002B13 3C07                <1> 	cmp al, 7
  3029 00002B15 7607                <1> 	jbe movlargecursorterm
  3030 00002B17 B007                <1> 	mov al, 7
  3031 00002B19 E902000000          <1> 	jmp movedcursorterm
  3032                              <1> movlargecursorterm:
  3033 00002B1E B0F0                <1> 	mov al, 0xF0
  3034                              <1> movedcursorterm:
  3035 00002B20 884701              <1> 	mov [edi + 1], al
  3036 00002B23 80FC00              <1> 	cmp ah, 0
  3037 00002B26 7504                <1> 	jne fixednocursorterm
  3038 00002B28 B420                <1> 	mov ah, " "
  3039 00002B2A 8827                <1> 	mov [edi], ah
  3040                              <1> fixednocursorterm:
  3041 00002B2C C3                  <1> 	ret
  3042                                      %include 'source/dosints.asm'
  3043                              <1> int20h:
  3044 00002B2D 66B8004C            <1> mov ax, 0x4C00
  3045                              <1> int21h:
  3046                              <1> dostosolleros:
  3047 00002B31 6650                <1> 	push ax
  3048 00002B33 66B82800            <1> 	mov ax, NEW_DATA_SEL
  3049 00002B37 8ED8                <1> 	mov ds, ax
  3050 00002B39 8EC0                <1> 	mov es, ax
  3051 00002B3B 8EE0                <1> 	mov fs, ax
  3052 00002B3D 66B81800            <1> 	mov ax, SYS_DATA_SEL
  3053 00002B41 8EE8                <1> 	mov gs, ax
  3054 00002B43 6658                <1> 	pop ax
  3055 00002B45 9C                  <1> 	pushf
  3056 00002B46 60                  <1> 	pusha
  3057 00002B47 80FC01              <1> 	cmp ah, 1
  3058 00002B4A 0F8449000000        <1> 	je near dosgchar
  3059 00002B50 80FC02              <1> 	cmp ah, 2
  3060 00002B53 0F8447000000        <1> 	je near doswchar
  3061 00002B59 80FC09              <1> 	cmp ah, 9
  3062 00002B5C 0F8449000000        <1> 	je near dosprintstr
  3063 00002B62 80FC0A              <1> 	cmp ah, 0xA
  3064 00002B65 0F8456000000        <1> 	je near dosgetstr
  3065 00002B6B 80FC2B              <1> 	cmp ah, 0x2B
  3066 00002B6E 0F8492000000        <1> 	je near dosgetdate
  3067 00002B74 80FC2C              <1> 	cmp ah, 0x2C
  3068 00002B77 0F84AC000000        <1> 	je near dosgettime
  3069 00002B7D 80FC4C              <1> 	cmp ah, 0x4C
  3070 00002B80 0F84C1000000        <1> 	je near dosexit
  3071                              <1> backtodos:
  3072 00002B86 61                  <1> 	popa
  3073 00002B87 9D                  <1> 	popf
  3074 00002B88 6650                <1> 	push ax
  3075 00002B8A 66B84800            <1> 	mov ax, DOS_DATA_SEL
  3076 00002B8E 8ED8                <1> 	mov ds, ax
  3077 00002B90 8EC0                <1> 	mov es, ax
  3078 00002B92 8EE0                <1> 	mov fs, ax
  3079 00002B94 8EE8                <1> 	mov gs, ax
  3080 00002B96 6658                <1> 	pop ax
  3081 00002B98 CF                  <1> 	iret
  3082                              <1> 
  3083                              <1> dosgchar:
  3084 00002B99 E8C6FBFFFF          <1> 	call getchar
  3085 00002B9E EBE6                <1> 	jmp backtodos
  3086                              <1> 	
  3087                              <1> doswchar:
  3088 00002BA0 88D0                <1> 	mov al, dl
  3089 00002BA2 B307                <1> 	mov bl, 7
  3090 00002BA4 E80EFCFFFF          <1> 	call prcharint
  3091 00002BA9 EBDB                <1> 	jmp backtodos
  3092                              <1> 	
  3093                              <1> dosprintstr:
  3094 00002BAB 31F6                <1> 	xor esi, esi
  3095 00002BAD 6689D6              <1> 	mov si, dx
  3096 00002BB0 81C600004000        <1> 	add esi, dosprogloc
  3097 00002BB6 B024                <1> 	mov al, "$"
  3098 00002BB8 B307                <1> 	mov bl, 7
  3099 00002BBA E82CF7FFFF          <1> 	call printint
  3100 00002BBF EBC5                <1> 	jmp backtodos
  3101                              <1> 	
  3102                              <1> dosgetstr:
  3103 00002BC1 31F6                <1> 	xor esi, esi
  3104 00002BC3 6689D6              <1> 	mov si, dx
  3105 00002BC6 81C600004000        <1> 	add esi, dosprogloc
  3106 00002BCC B900000000          <1> 	mov ecx, 0
  3107 00002BD1 8A0E                <1> 	mov cl, [esi]
  3108 00002BD3 81C603000000        <1> 	add esi, 3
  3109 00002BD9 89F7                <1> 	mov edi, esi
  3110 00002BDB 8935[022C0000]      <1> 	mov [stringstart], esi
  3111 00002BE1 01CF                <1> 	add edi, ecx
  3112 00002BE3 B00A                <1> 	mov al, 10
  3113 00002BE5 B307                <1> 	mov bl, 7
  3114 00002BE7 E800F8FFFF          <1> 	call rdprint
  3115 00002BEC 89F1                <1> 	mov ecx, esi
  3116 00002BEE 2B0D[022C0000]      <1> 	sub ecx, [stringstart]
  3117 00002BF4 8B35[022C0000]      <1> 	mov esi, [stringstart]
  3118 00002BFA 884EFF              <1> 	mov [esi - 1], cl
  3119 00002BFD 884EFE              <1> 	mov [esi - 2], cl
  3120 00002C00 EB84                <1> 	jmp backtodos
  3121 00002C02 00000000            <1> stringstart dd 0
  3122                              <1> 
  3123                              <1> dosgetdate:
  3124 00002C06 E8711C0000          <1> 	call time
  3125 00002C0B 8A0D[444A0000]      <1> 	mov cl, [RTCtimeYear]
  3126 00002C11 B500                <1> 	mov ch, 0
  3127 00002C13 6681C1D007          <1> 	add cx, 2000
  3128 00002C18 8A35[434A0000]      <1> 	mov dh, [RTCtimeMonth]
  3129 00002C1E 8A15[424A0000]      <1> 	mov dl, [RTCtimeDay]
  3130 00002C24 E95DFFFFFF          <1> 	jmp backtodos
  3131                              <1> 
  3132                              <1> dosgettime:
  3133 00002C29 E84E1C0000          <1> 	call time
  3134 00002C2E 8A2D[414A0000]      <1> 	mov ch, [RTCtimeHour]
  3135 00002C34 8A0D[404A0000]      <1> 	mov cl, [RTCtimeMinute]
  3136 00002C3A 8A35[3F4A0000]      <1> 	mov dh, [RTCtimeSecond]
  3137 00002C40 B200                <1> 	mov dl, 0
  3138 00002C42 E93FFFFFFF          <1> 	jmp backtodos
  3139                              <1> 	
  3140                              <1> dosexit:
  3141 00002C47 61                  <1> 	popa
  3142 00002C48 3C00                <1> 	cmp al, 0
  3143 00002C4A 0F8528F6FFFF        <1> 	jne near warnexitstatus
  3144 00002C50 E947010000          <1> 	jmp nwcmd
  3145                                      %include 'source/solleros.asm'
  3146                              <1> 	;SOLLEROS.ASM
  3147                              <1> os:
  3148                              <1> setdefenv:
  3149 00002C55 E80EF7FFFF          <1> 	call clear
  3150 00002C5A BE[00000000]        <1> 	mov esi, signature
  3151                              <1> .sigcopyloop	;this prevents an odd error
  3152 00002C5F 658A06              <1> 	mov al, [gs:esi]
  3153 00002C62 8806                <1> 	mov [esi], al
  3154 00002C64 46                  <1> 	inc esi
  3155 00002C65 81FE[1A000000]      <1> 	cmp esi, signatureend
  3156 00002C6B 72F2                <1> 	jb .sigcopyloop
  3157 00002C6D BE[00000000]        <1> 	mov esi, signature
  3158 00002C72 E86DF6FFFF          <1> 	call print
  3159 00002C77 8B0D[16000000]      <1> 	mov ecx, [signatureend - 4]
  3160 00002C7D E8E1060000          <1> 	call showdec
  3161 00002C82 BE[74780000]        <1> 	mov esi, line
  3162 00002C87 E858F6FFFF          <1> 	call print
  3163 00002C8C BE[4E780000]        <1> 	mov esi, userask
  3164 00002C91 E84EF6FFFF          <1> 	call print
  3165                              <1> usercheck:
  3166 00002C96 BE[8FB80000]        <1> 	mov esi, buftxt
  3167 00002C9B BF[8FBC0000]        <1> 	mov edi, buftxtend
  3168 00002CA0 B00A                <1> 	mov al, 10
  3169 00002CA2 E845F7FFFF          <1> 	call rdprint
  3170 00002CA7 56                  <1> 	push esi
  3171 00002CA8 BE[58780000]        <1> 	mov esi, pwdask
  3172 00002CAD E832F6FFFF          <1> 	call print
  3173 00002CB2 5E                  <1> 	pop esi
  3174 00002CB3 46                  <1> 	inc esi
  3175 00002CB4 8935[712D0000]      <1> 	mov [esipass], esi
  3176                              <1> passcheck:
  3177 00002CBA E8A5FAFFFF          <1> 	call getchar
  3178 00002CBF 3C0A                <1> 	cmp al, 10
  3179 00002CC1 0F8436000000        <1> 	je near gotpass
  3180 00002CC7 3C08                <1> 	cmp al, 8
  3181 00002CC9 0F8410000000        <1> 	je near backpass
  3182 00002CCF 8806                <1> 	mov [esi], al
  3183 00002CD1 46                  <1> 	inc esi
  3184 00002CD2 B02A                <1> 	mov al, '*'
  3185 00002CD4 E8DEFAFFFF          <1> 	call prcharint
  3186 00002CD9 EBDF                <1> 	jmp passcheck
  3187 00002CDB 08200800            <1> backcursor2 db 8," ",8,0
  3188                              <1> backpass:
  3189 00002CDF 3B35[712D0000]      <1> 	cmp esi, [esipass]
  3190 00002CE5 0F84CFFFFFFF        <1> 	je near passcheck
  3191 00002CEB 4E                  <1> 	dec esi
  3192 00002CEC C60600              <1> 	mov byte [esi], 0
  3193 00002CEF 56                  <1> 	push esi
  3194 00002CF0 BE[DB2C0000]        <1> 	mov esi, backcursor2
  3195 00002CF5 E8EAF5FFFF          <1> 	call print
  3196 00002CFA 5E                  <1> 	pop esi
  3197 00002CFB EBBD                <1> 	jmp passcheck
  3198                              <1> gotpass:
  3199 00002CFD 30C0                <1> 	xor al, al
  3200 00002CFF 31C9                <1> 	xor ecx, ecx
  3201 00002D01 8806                <1> 	mov [esi], al
  3202 00002D03 BB[76780000]        <1> 	mov ebx, userlst
  3203                              <1> userfind:
  3204 00002D08 BE[8FB80000]        <1> 	mov esi, buftxt
  3205 00002D0D 8A06                <1> 	mov al, [esi]
  3206 00002D0F 3C00                <1> 	cmp al, 0
  3207 00002D11 0F843EFFFFFF        <1> 	je near os
  3208 00002D17 891D[752D0000]      <1> 	mov [usercache], ebx
  3209 00002D1D E828030000          <1> 	call tester
  3210 00002D22 3C01                <1> 	cmp al, 1
  3211 00002D24 7416                <1> 	je pwdtest
  3212 00002D26 41                  <1> 	inc ecx
  3213                              <1> nxtuser:
  3214 00002D27 8A03                <1> 	mov al, [ebx]
  3215 00002D29 43                  <1> 	inc ebx
  3216 00002D2A 3C00                <1> 	cmp al, 0
  3217 00002D2C 75F9                <1> 	jne nxtuser
  3218 00002D2E 81FB[99780000]      <1> 	cmp ebx, userlstend
  3219 00002D34 0F831BFFFFFF        <1> 	jae near os
  3220 00002D3A EBCC                <1> 	jmp userfind
  3221                              <1> pwdtest:
  3222 00002D3C 46                  <1> 	inc esi
  3223 00002D3D 43                  <1> 	inc ebx
  3224 00002D3E E807030000          <1> 	call tester
  3225 00002D43 3C01                <1> 	cmp al, 1
  3226 00002D45 7402                <1> 	je pwdrgt
  3227 00002D47 EBDE                <1> 	jmp nxtuser
  3228                              <1> pwdrgt:
  3229 00002D49 D1E9                <1> 	shr ecx, 1
  3230 00002D4B 890D[12A40000]      <1> 	mov [uid], ecx
  3231 00002D51 E812F6FFFF          <1> 	call clear
  3232 00002D56 66B90002            <1> 	mov cx, 200h
  3233 00002D5A BE[8FB80000]        <1> 	mov esi, buftxt
  3234 00002D5F 8935[46300000]      <1> 	mov [currentcommandloc], esi
  3235 00002D65 30C0                <1> 	xor al, al
  3236 00002D67 8806                <1> bufclr:	mov [esi], al
  3237 00002D69 46                  <1> 	inc esi
  3238 00002D6A E2FB                <1> 	loop bufclr
  3239 00002D6C E92B000000          <1> 	jmp nwcmd
  3240                              <1> 
  3241 00002D71 00000000            <1> esipass dd 0
  3242 00002D75 [76780000]          <1> usercache dd userlst
  3243                              <1> 	
  3244                              <1> buftxtclear:
  3245 00002D79 30C0                <1> 	xor al, al
  3246 00002D7B BE[8FB80000]        <1> 	mov esi, buftxt
  3247 00002D80 81FE[8FBC0000]      <1> clearbuftxt: cmp esi, buf2
  3248 00002D86 730E                <1> 	jae retbufclr
  3249 00002D88 8806                <1> 	mov [esi], al
  3250 00002D8A 46                  <1> 	inc esi
  3251 00002D8B EBF3                <1> 	jmp clearbuftxt
  3252                              <1> 
  3253 00002D8D 39DE                <1> clearitbuf: cmp esi, ebx
  3254 00002D8F 7305                <1> 	jae retbufclr
  3255 00002D91 8806                <1> 	mov [esi], al
  3256 00002D93 46                  <1> 	inc esi
  3257 00002D94 EBF7                <1> 	jmp clearitbuf
  3258 00002D96 C3                  <1> retbufclr: ret
  3259                              <1> 
  3260 00002D97 E900000000          <1> full:	jmp nwcmd
  3261                              <1> 
  3262                              <1> shush:	;SollerOS Hardly Unix-compatible Shell
  3263                              <1> nwcmd:
  3264 00002D9C FB                  <1> 	sti
  3265 00002D9D 31C0                <1> 	xor eax, eax
  3266 00002D9F 3905[602F0000]      <1> 	cmp [nextcommandloc], eax
  3267 00002DA5 7411                <1> 	je nomultiplecommand
  3268 00002DA7 8B35[602F0000]      <1> 	mov esi, [nextcommandloc]
  3269 00002DAD 8935[642F0000]      <1> 	mov [thiscommandloc], esi
  3270 00002DB3 E9B5010000          <1> 	jmp fixvariables
  3271                              <1> nomultiplecommand:
  3272 00002DB8 A3[642F0000]        <1> 	mov [thiscommandloc], eax
  3273 00002DBD 3805[3C720000]      <1> 	cmp [threadson], al
  3274 00002DC3 7405                <1> 	je noclinwcmd
  3275 00002DC5 A2[3C720000]        <1> 	mov [threadson], al
  3276                              <1> noclinwcmd:
  3277 00002DCA B001                <1> 	mov al, 1
  3278 00002DCC 3805[7FA40000]      <1> 	cmp [BATCHISON], al
  3279 00002DD2 7501                <1> 	jne cancel
  3280 00002DD4 C3                  <1> 	ret
  3281 00002DD5 30C0                <1> cancel:	xor al, al
  3282 00002DD7 A2[16A40000]        <1> 	mov [IFON], al
  3283 00002DDC A2[7FA40000]        <1> 	mov [BATCHISON], al
  3284 00002DE1 B05B                <1> 	mov al, '['
  3285 00002DE3 B406                <1> 	mov ah, 6
  3286 00002DE5 66BB0700            <1> 	mov bx, 7
  3287 00002DE9 E8DAF9FFFF          <1> 	call prcharq
  3288 00002DEE 8B35[752D0000]      <1> 	mov esi, [usercache]
  3289 00002DF4 E8D9F4FFFF          <1> 	call printquiet
  3290 00002DF9 BE[62780000]        <1> 	mov esi, computer
  3291 00002DFE E8CFF4FFFF          <1> 	call printquiet
  3292 00002E03 BE[6C780000]        <1> 	mov esi, location
  3293 00002E08 E8C5F4FFFF          <1> 	call printquiet
  3294 00002E0D BE[6F780000]        <1> 	mov esi, endprompt
  3295 00002E12 E8CDF4FFFF          <1> 	call print
  3296 00002E17 E85DFFFFFF          <1> 	call buftxtclear
  3297 00002E1C BE[8FB80000]        <1> 	mov esi, buftxt
  3298 00002E21 C605[4D270000]01    <1> 	mov byte [commandedit], 1
  3299 00002E28 B00A                <1> 	mov al, 10
  3300 00002E2A 66BB0700            <1> 	mov bx, 7
  3301 00002E2E BF[8FBC0000]        <1> 	mov edi, buftxtend
  3302 00002E33 E8B4F5FFFF          <1> 	call rdprint
  3303 00002E38 C605[4D270000]00    <1> 	mov byte [commandedit], 0
  3304 00002E3F 803D[8FB80000]00    <1> 	cmp byte [buftxt], 0
  3305 00002E46 0F8450FFFFFF        <1> 	je near nwcmd
  3306 00002E4C 8B35[285F0100]      <1> gotcmd:	mov esi, [currentcommandpos]
  3307 00002E52 8935[245F0100]      <1> 	mov [lastcommandpos], esi
  3308 00002E58 BF[8FB80000]        <1> 	mov edi, buftxt
  3309 00002E5D 81C6[2C5F0100]      <1> 	add esi, commandbuf
  3310 00002E63 81FE[2C6F0100]      <1> 	cmp esi, commandbufend
  3311 00002E69 7605                <1> 	jbe copycommand
  3312 00002E6B BE[2C5F0100]        <1> 	mov esi, commandbuf
  3313                              <1> copycommand:
  3314 00002E70 8A07                <1> 	mov al, [edi]
  3315 00002E72 8806                <1> 	mov [esi], al
  3316 00002E74 47                  <1> 	inc edi
  3317 00002E75 46                  <1> 	inc esi
  3318 00002E76 3C00                <1> 	cmp al, 0
  3319 00002E78 740F                <1> 	je donecopy
  3320 00002E7A 81FE[2C6F0100]      <1> 	cmp esi, commandbufend
  3321 00002E80 76EE                <1> 	jbe copycommand
  3322 00002E82 BE[2C5F0100]        <1> 	mov esi, commandbuf
  3323 00002E87 EBE7                <1> 	jmp copycommand
  3324                              <1> donecopy:
  3325 00002E89 81EE[2C5F0100]      <1> 	sub esi, commandbuf
  3326 00002E8F 8935[285F0100]      <1> 	mov [currentcommandpos], esi
  3327 00002E95 E9CE000000          <1> 	jmp run
  3328                              <1> 
  3329 00002E9A E8DAFEFFFF          <1> input:	call buftxtclear
  3330 00002E9F BE[8FB80000]        <1> 	mov esi, buftxt		;puts input into buftxt AND onto screen
  3331 00002EA4 BF[8FBC0000]        <1> 	mov edi, buftxtend
  3332 00002EA9 B00A                <1> stdin:	mov al, 10
  3333 00002EAB B307                <1> 	mov bl, 7
  3334 00002EAD E83AF5FFFF          <1> 	call rdprint
  3335 00002EB2 C3                  <1> 	ret
  3336                              <1> 
  3337                              <1> replacevariable:
  3338 00002EB3 8A4601              <1> 	mov al, [esi + 1]
  3339 00002EB6 C64601FF            <1> 	mov byte [esi + 1], 255
  3340 00002EBA 3C24                <1> 	cmp al, "$"
  3341 00002EBC 0F84AB000000        <1> 	je near fixvariables
  3342 00002EC2 884601              <1> 	mov [esi + 1], al
  3343 00002EC5 56                  <1> 	push esi
  3344 00002EC6 81EE[8FB80000]      <1> 	sub esi, buftxt
  3345 00002ECC 89F7                <1> 	mov edi, esi
  3346 00002ECE 81C6[8FB80000]      <1> 	add esi, buftxt
  3347 00002ED4 47                  <1> 	inc edi
  3348 00002ED5 BB[85A40000]        <1> 	mov ebx, variables
  3349 00002EDA E86A100000          <1> 	call nxtvrech
  3350 00002EDF 89F7                <1> 	mov edi, esi
  3351 00002EE1 31DB                <1> 	xor ebx, ebx
  3352 00002EE3 4E                  <1> 	dec esi
  3353                              <1> findvarname:
  3354 00002EE4 4E                  <1> 	dec esi
  3355 00002EE5 8A06                <1> 	mov al, [esi]
  3356 00002EE7 43                  <1> 	inc ebx
  3357 00002EE8 3C04                <1> 	cmp al, 4
  3358 00002EEA 75F8                <1> 	jne findvarname
  3359 00002EEC 5E                  <1> 	pop esi
  3360                              <1> replacevarloop:
  3361 00002EED 8A07                <1> 	mov al, [edi]
  3362 00002EEF 81FB00000000        <1> 	cmp ebx, 0
  3363 00002EF5 0F841E000000        <1> 	je near expandbuftxt
  3364 00002EFB 3C00                <1> 	cmp al, 0
  3365 00002EFD 0F8407000000        <1> 	je near compressbuftxt
  3366 00002F03 8806                <1> 	mov [esi], al
  3367 00002F05 4B                  <1> 	dec ebx
  3368 00002F06 46                  <1> 	inc esi
  3369 00002F07 47                  <1> 	inc edi
  3370 00002F08 EBE3                <1> 	jmp replacevarloop
  3371                              <1> compressbuftxt:	
  3372 00002F0A 8A041E              <1> 	mov al, [esi + ebx]
  3373 00002F0D 8806                <1> 	mov [esi], al
  3374 00002F0F 46                  <1> 	inc esi
  3375 00002F10 3C00                <1> 	cmp al, 0
  3376 00002F12 75F6                <1> 	jne compressbuftxt
  3377 00002F14 E954000000          <1> 	jmp fixvariables
  3378                              <1> expandbuftxt:
  3379 00002F19 89F1                <1> 	mov ecx, esi
  3380 00002F1B 8A26                <1> 	mov ah, [esi]
  3381                              <1> expandbuftxtlp:
  3382 00002F1D 8A1E                <1> 	mov bl, [esi]
  3383 00002F1F 46                  <1> 	inc esi
  3384 00002F20 8A3E                <1> 	mov bh, [esi]
  3385 00002F22 8826                <1> 	mov [esi], ah
  3386 00002F24 88FC                <1> 	mov ah, bh
  3387 00002F26 80FB00              <1> 	cmp bl, 0
  3388 00002F29 75F2                <1> 	jne expandbuftxtlp
  3389 00002F2B 89CE                <1> 	mov esi, ecx
  3390 00002F2D 8806                <1> 	mov [esi], al
  3391 00002F2F 47                  <1> 	inc edi
  3392 00002F30 8A07                <1> 	mov al, [edi]
  3393 00002F32 3C00                <1> 	cmp al, 0
  3394 00002F34 0F8433000000        <1> 	je near fixvariables
  3395 00002F3A 46                  <1> 	inc esi
  3396 00002F3B EBDC                <1> 	jmp expandbuftxt
  3397                              <1> multipleprogline:
  3398 00002F3D 30E4                <1> 	xor ah, ah
  3399 00002F3F 8826                <1> 	mov [esi], ah
  3400 00002F41 46                  <1> 	inc esi
  3401 00002F42 8935[602F0000]      <1> 	mov [nextcommandloc], esi
  3402 00002F48 E93E000000          <1> 	jmp donefixvariables
  3403                              <1> inlinecomment:	;if the following char is #, include a #, otherwise end the line
  3404 00002F4D 46                  <1> 	inc esi
  3405 00002F4E 8A06                <1> 	mov al, [esi]
  3406 00002F50 C606FF              <1> 	mov byte [esi], 255
  3407 00002F53 3C23                <1> 	cmp al, '#'
  3408 00002F55 7416                <1> 	je fixvariables
  3409 00002F57 4E                  <1> 	dec esi
  3410 00002F58 C60600              <1> 	mov byte [esi], 0
  3411 00002F5B E90D000000          <1> 	jmp fixvariables
  3412                              <1> 	
  3413 00002F60 00000000            <1> nextcommandloc dd 0
  3414 00002F64 00000000            <1> thiscommandloc dd 0	
  3415                              <1> run:
  3416 00002F68 BE[8FB80000]        <1> 	mov esi, buftxt
  3417                              <1> fixvariables:
  3418 00002F6D 46                  <1> 	inc esi
  3419 00002F6E 8A06                <1> 	mov al, [esi]
  3420 00002F70 3C23                <1> 	cmp al, '#'	;inline comment
  3421 00002F72 74D9                <1> 	je inlinecomment
  3422 00002F74 3C24                <1> 	cmp al, '$' ;variable
  3423 00002F76 0F8437FFFFFF        <1> 	je near replacevariable
  3424 00002F7C 3C3B                <1> 	cmp al, ';' ;program list
  3425 00002F7E 74BD                <1> 	je multipleprogline
  3426 00002F80 3C00                <1> 	cmp al, 0
  3427 00002F82 75E9                <1> 	jne fixvariables
  3428 00002F84 31C0                <1> 	xor eax, eax
  3429 00002F86 A3[602F0000]        <1> 	mov [nextcommandloc], eax
  3430                              <1> donefixvariables:
  3431 00002F8B 803D[4F350000]00    <1> 	cmp byte [indexdone], 0
  3432 00002F92 7505                <1> 	jne progtest
  3433 00002F94 E821050000          <1> 	call indexfiles
  3434                              <1> progtest:
  3435 00002F99 31C0                <1> 	xor eax, eax
  3436 00002F9B BB[12A00000]        <1> 	mov ebx, fileindex
  3437 00002FA0 668B03              <1> prgnxt:	mov ax, [ebx]
  3438 00002FA3 B1FF                <1> 	mov cl, 255
  3439 00002FA5 B52C                <1> 	mov ch, 44
  3440 00002FA7 6639C8              <1> 	cmp ax, cx
  3441 00002FAA 740B                <1> 	je fndprg
  3442 00002FAC 43                  <1> 	inc ebx
  3443 00002FAD 81FB[12A40000]      <1> 	cmp ebx, fileindexend
  3444 00002FB3 7361                <1> 	jae prgnf
  3445 00002FB5 EBE9                <1> 	jmp prgnxt
  3446 00002FB7 81C302000000        <1> fndprg: add ebx, 2
  3447 00002FBD 31C9                <1> 	xor ecx, ecx
  3448 00002FBF BE[8FB80000]        <1> 	mov esi, buftxt
  3449 00002FC4 390D[642F0000]      <1> 	cmp [thiscommandloc], ecx
  3450 00002FCA 7406                <1> 	je noprgtstmultiple
  3451 00002FCC 8B35[642F0000]      <1> 	mov esi, [thiscommandloc]
  3452                              <1> noprgtstmultiple:
  3453 00002FD2 E8AE000000          <1> 	call cndtest
  3454 00002FD7 3C01                <1> 	cmp al, 1
  3455 00002FD9 7302                <1> 	jae prggood
  3456 00002FDB EBC3                <1> 	jmp prgnxt
  3457 00002FDD 81FB[12A40000]      <1> prggood: cmp ebx, fileindexend
  3458 00002FE3 735C                <1> 	jae prgdn
  3459 00002FE5 31C0                <1> 	xor eax, eax
  3460 00002FE7 BE[8FB80000]        <1> 	mov esi, buftxt
  3461 00002FEC 3905[642F0000]      <1> 	cmp [thiscommandloc], eax
  3462 00002FF2 7406                <1> 	je noprggoodmul
  3463 00002FF4 8B35[642F0000]      <1> 	mov esi, [thiscommandloc]
  3464                              <1> noprggoodmul:
  3465 00002FFA 8935[46300000]      <1> 	mov [currentcommandloc], esi
  3466 00003000 81C303000000        <1> 	add ebx, 3
  3467 00003006 8B3B                <1> 	mov edi, [ebx]
  3468 00003008 C605[3C720000]02    <1> 	mov byte [threadson], 2
  3469 0000300F FFD7                <1> 	call edi
  3470 00003011 E986FDFFFF          <1> 	jmp nwcmd
  3471                              <1> prgnf:	
  3472 00003016 8B35[46300000]      <1> 	mov esi, [currentcommandloc]
  3473 0000301C 8A06                <1> 	mov al, [esi]
  3474 0000301E 3C00                <1> 	cmp al, 0
  3475 00003020 741F                <1> 	je prgdn
  3476 00003022 BE[36780000]        <1> 	mov esi, notfound1
  3477 00003027 E8B8F2FFFF          <1> 	call print
  3478 0000302C 8B35[46300000]      <1> 	mov esi, [currentcommandloc]
  3479 00003032 E8ADF2FFFF          <1> 	call print
  3480 00003037 BE[40780000]        <1> 	mov esi, notfound2
  3481 0000303C E8A3F2FFFF          <1> 	call print
  3482 00003041 E956FDFFFF          <1> prgdn:	jmp nwcmd
  3483                              <1> 
  3484 00003046 00000000            <1> currentcommandloc dd 0
  3485                              <1> 
  3486                              <1> tester:			;si=user bx=prog returns 1 in al if true
  3487 0000304A 6631C0              <1> 	xor ax, ax
  3488 0000304D 8A06                <1> retest:	mov al, [esi]
  3489 0000304F 8A23                <1> 	mov ah, [ebx]
  3490 00003051 3C00                <1> 	cmp al, 0
  3491 00003053 7408                <1> 	je testtrue
  3492 00003055 38E0                <1> 	cmp al, ah
  3493 00003057 750C                <1> 	jne testfalse
  3494 00003059 43                  <1> 	inc ebx
  3495 0000305A 46                  <1> 	inc esi
  3496 0000305B EBF0                <1> 	jmp retest
  3497                              <1> testtrue:
  3498 0000305D 80FC00              <1> 	cmp ah, 0
  3499 00003060 7503                <1> 	jne testfalse
  3500 00003062 B001                <1> 	mov al, 1
  3501 00003064 C3                  <1> 	ret
  3502                              <1> testfalse:
  3503 00003065 30C0                <1> 	xor al, al
  3504 00003067 C3                  <1> 	ret
  3505                              <1> 
  3506                              <1> optest:			;si=user bx=prog returns 1 in al if true
  3507 00003068 30C0                <1> 	xor al, al
  3508                              <1> opretest:
  3509 0000306A 8A06                <1> 	mov al, [esi]
  3510 0000306C 8A23                <1> 	mov ah, [ebx]
  3511 0000306E 38E0                <1> 	cmp al, ah
  3512 00003070 7510                <1> 	jne optestfalse
  3513 00003072 80FC00              <1> 	cmp ah, 0
  3514 00003075 7404                <1> 	je optesttrue
  3515 00003077 43                  <1> 	inc ebx
  3516 00003078 46                  <1> 	inc esi
  3517 00003079 EBEF                <1> 	jmp opretest
  3518                              <1> optesttrue:
  3519 0000307B 3C00                <1> 	cmp al, 0
  3520 0000307D 7503                <1> 	jne optestfalse
  3521 0000307F B001                <1> 	mov al, 1
  3522 00003081 C3                  <1> 	ret
  3523                              <1> optestfalse:
  3524 00003082 30C0                <1> 	xor al, al
  3525 00003084 C3                  <1> 	ret
  3526                              <1> 
  3527                              <1> cndtest:			;si=user bx=prog cl=endchar returns 1 in al if true
  3528 00003085 30C0                <1> 	xor al, al
  3529 00003087 8A06                <1> cndretest:	mov al, [esi]
  3530 00003089 8A23                <1> 	mov ah, [ebx]
  3531 0000308B 38CC                <1> 	cmp ah, cl
  3532 0000308D 7408                <1> 	je cndtesttrue
  3533 0000308F 38E0                <1> 	cmp al, ah
  3534 00003091 750B                <1> 	jne cndtestfalse
  3535 00003093 43                  <1> 	inc ebx
  3536 00003094 46                  <1> 	inc esi
  3537 00003095 EBF0                <1> 	jmp cndretest
  3538                              <1> cndtesttrue:
  3539 00003097 38C8                <1> 	cmp al, cl
  3540 00003099 7506                <1> 	jne cndtestalmost
  3541 0000309B B001                <1> 	mov al, 1
  3542 0000309D C3                  <1> 	ret
  3543                              <1> cndtestfalse:
  3544 0000309E 30C0                <1> 	xor al, al
  3545 000030A0 C3                  <1> 	ret
  3546                              <1> cndtestalmost:
  3547 000030A1 B002                <1> 	mov al, 2
  3548 000030A3 C3                  <1> 	ret
  3549                              <1> 	
  3550                              <1> array:				;arraystart in si, arrayend in bx, arrayseperator in cx
  3551                              <1> 		                ;ends if array seperator is found backwards after 0
  3552                              <1> 	arnxt:	      
  3553 000030A4 88E8                <1> 		mov al, ch
  3554 000030A6 88CC                <1> 		mov ah, cl        
  3555 000030A8 663906              <1> 		cmp [esi], ax
  3556 000030AB 744D                <1> 		je ardn
  3557 000030AD 66390E              <1> 		cmp [esi], cx
  3558 000030B0 7407                <1> 		je arfnd
  3559 000030B2 46                  <1> 		inc esi
  3560 000030B3 39DE                <1> 		cmp esi, ebx
  3561 000030B5 7343                <1> 		jae ardn
  3562 000030B7 EBEB                <1> 		jmp arnxt
  3563 000030B9 81C602000000        <1> 	arfnd: add esi, 2
  3564 000030BF 891D[FB300000]      <1> 		mov [arbx], ebx
  3565 000030C5 890D[FF300000]      <1> 		mov [arcx], ecx
  3566 000030CB E814F2FFFF          <1> 		call print
  3567 000030D0 8935[01310000]      <1> 		mov [arsi], esi
  3568 000030D6 BE[74780000]        <1> 		mov esi, line
  3569 000030DB E804F2FFFF          <1> 		call print
  3570 000030E0 8B1D[FB300000]      <1> 		mov ebx, [arbx]
  3571 000030E6 668B0D[FF300000]    <1> 		mov cx, [arcx]
  3572 000030ED 8B35[01310000]      <1> 		mov esi, [arsi]
  3573 000030F3 46                  <1> 		inc esi
  3574 000030F4 39DE                <1> 		cmp esi, ebx
  3575 000030F6 7302                <1> 		jae ardn
  3576 000030F8 EBAA                <1> 		jmp arnxt
  3577 000030FA C3                  <1> 	ardn:	ret
  3578 000030FB 00000000            <1> arbx:	dw 0,0
  3579 000030FF 0000                <1> arcx:	db 0,0
  3580 00003101 00000000            <1> arsi:	dw 0,0
  3581                              <1> 
  3582                              <1> clearbuffer:
  3583 00003105 BE[8FBC0000]        <1> 	mov esi, buf2
  3584 0000310A B030                <1> 	mov al, '0'
  3585 0000310C 81FE[A3BC0000]      <1> clearbuf: cmp esi, numbuf
  3586 00003112 7305                <1> 	jae doneclearbuff
  3587 00003114 8806                <1> 	mov [esi], al
  3588 00003116 46                  <1> 	inc esi
  3589 00003117 EBF3                <1> 	jmp clearbuf
  3590                              <1> doneclearbuff: 
  3591 00003119 C3                  <1> 		ret
  3592                              <1> 
  3593                              <1> convert:
  3594 0000311A 4E                  <1> 	dec esi
  3595 0000311B 89F3                <1> 	mov ebx, esi		;place to convert into must be in esi, number to convert must be in ecx
  3596                              <1> cnvrt:
  3597 0000311D 89DE                <1> 	mov esi, ebx
  3598 0000311F 81EE09000000        <1> 	sub esi, 9
  3599 00003125 81F900CA9A3B        <1> 	cmp ecx, 1000000000
  3600 0000312B 720A                <1> 	jb ten8
  3601 0000312D 81E900CA9A3B        <1> 	sub ecx, 1000000000
  3602 00003133 FE06                <1> 	inc byte [esi]
  3603 00003135 EBE6                <1> 	jmp cnvrt
  3604 00003137 46                  <1> ten8:	inc esi
  3605 00003138 81F900E1F505        <1> 	cmp ecx, 100000000
  3606 0000313E 720A                <1> 	jb ten7
  3607 00003140 81E900E1F505        <1> 	sub ecx, 100000000
  3608 00003146 FE06                <1> 	inc byte [esi]
  3609 00003148 EBD3                <1> 	jmp cnvrt
  3610 0000314A 46                  <1> ten7:	inc esi
  3611 0000314B 81F980969800        <1> 	cmp ecx, 10000000
  3612 00003151 720A                <1> 	jb ten6
  3613 00003153 81E980969800        <1> 	sub ecx, 10000000
  3614 00003159 FE06                <1> 	inc byte [esi]
  3615 0000315B EBC0                <1> 	jmp cnvrt
  3616 0000315D 46                  <1> ten6:	inc esi
  3617 0000315E 81F940420F00        <1> 	cmp ecx, 1000000
  3618 00003164 720A                <1> 	jb ten5
  3619 00003166 81E940420F00        <1> 	sub ecx, 1000000
  3620 0000316C FE06                <1> 	inc byte [esi]
  3621 0000316E EBAD                <1> 	jmp cnvrt
  3622 00003170 46                  <1> ten5:	inc esi
  3623 00003171 81F9A0860100        <1> 	cmp ecx, 100000
  3624 00003177 720A                <1> 	jb ten4
  3625 00003179 81E9A0860100        <1> 	sub ecx, 100000
  3626 0000317F FE06                <1> 	inc byte [esi]
  3627 00003181 EB9A                <1> 	jmp cnvrt
  3628 00003183 46                  <1> ten4:	inc esi
  3629 00003184 81F910270000        <1> 	cmp ecx, 10000
  3630 0000318A 720A                <1> 	jb ten3
  3631 0000318C 81E910270000        <1> 	sub ecx, 10000
  3632 00003192 FE06                <1> 	inc byte [esi]
  3633 00003194 EB87                <1> 	jmp cnvrt
  3634 00003196 46                  <1> ten3:	inc esi
  3635 00003197 81F9E8030000        <1> 	cmp ecx, 1000
  3636 0000319D 720D                <1> 	jb ten2
  3637 0000319F 81E9E8030000        <1> 	sub ecx, 1000
  3638 000031A5 FE06                <1> 	inc byte [esi]
  3639 000031A7 E971FFFFFF          <1> 	jmp cnvrt
  3640 000031AC 46                  <1> ten2:	inc esi
  3641 000031AD 81F964000000        <1> 	cmp ecx, 100
  3642 000031B3 720D                <1> 	jb ten1
  3643 000031B5 81E964000000        <1> 	sub ecx, 100
  3644 000031BB FE06                <1> 	inc byte [esi]
  3645 000031BD E95BFFFFFF          <1> 	jmp cnvrt
  3646 000031C2 46                  <1> ten1:	inc esi
  3647 000031C3 81F90A000000        <1> 	cmp ecx, 10
  3648 000031C9 720D                <1> 	jb ten0
  3649 000031CB 81E90A000000        <1> 	sub ecx, 10
  3650 000031D1 FE06                <1> 	inc byte [esi]
  3651 000031D3 E945FFFFFF          <1> 	jmp cnvrt
  3652 000031D8 46                  <1> ten0:	inc esi
  3653 000031D9 81F901000000        <1> 	cmp ecx, 1
  3654 000031DF 720D                <1> 	jb tendn
  3655 000031E1 81E901000000        <1> 	sub ecx, 1
  3656 000031E7 FE06                <1> 	inc byte [esi]
  3657 000031E9 E92FFFFFFF          <1> 	jmp cnvrt
  3658                              <1> tendn:
  3659 000031EE C3                  <1> 	ret
  3660                              <1> 
  3661                              <1> 	
  3662                              <1> 
  3663 000031EF 00<rept>            <1> hexnumber times 8 db 0
  3664 000031F7 202000              <1> hexnumberend db "  ",0
  3665                              <1> 
  3666                              <1> 
  3667 000031FA 00000000            <1> sibuf dw 0,0
  3668 000031FE 00000000            <1> dibuf dw 0,0
  3669                              <1> 
  3670                              <1> converthex:
  3671                              <1> clearbufferhex:
  3672 00003202 B030                <1> 	mov al, '0'
  3673 00003204 8935[FA310000]      <1> 	mov [sibuf], esi
  3674 0000320A 893D[FE310000]      <1> 	mov [dibuf], edi
  3675 00003210 39FE                <1> clearbufhex: cmp esi, edi
  3676 00003212 7305                <1> 	jae doneclearbuffhex
  3677 00003214 8806                <1> 	mov [esi], al
  3678 00003216 46                  <1> 	inc esi
  3679 00003217 EBF7                <1> 	jmp clearbufhex
  3680                              <1> doneclearbuffhex:
  3681 00003219 8B35[FE310000]      <1> 	mov esi, [dibuf]
  3682 0000321F 89CA                <1> 	mov edx, ecx
  3683 00003221 81FA00000000        <1> 	cmp edx, 0
  3684 00003227 741F                <1> 	je donenxtephx
  3685                              <1> nxtexphx:	;0x10^x
  3686 00003229 4E                  <1> 	dec esi
  3687 0000322A 89F7                <1> 	mov edi, esi		;;location of 0x10^x
  3688 0000322C 89D1                <1> 	mov ecx, edx
  3689 0000322E 81E10F000000        <1> 	and ecx, 0xF		;;just this digit
  3690 00003234 E81C000000          <1> 	call cnvrtexphx		;;get this digit
  3691 00003239 89FE                <1> 	mov esi, edi
  3692 0000323B C1EA04              <1> 	shr edx, 4		;;next digit
  3693 0000323E 81FA00000000        <1> 	cmp edx, 0
  3694 00003244 7402                <1> 	je donenxtephx
  3695 00003246 EBE1                <1> 	jmp nxtexphx
  3696                              <1> donenxtephx:
  3697 00003248 8B35[FA310000]      <1> 	mov esi, [sibuf]
  3698 0000324E 8B3D[FE310000]      <1> 	mov edi, [dibuf]
  3699 00003254 C3                  <1> 	ret
  3700                              <1> cnvrtexphx:			;;convert this number
  3701 00003255 89F3                <1> 	mov ebx, esi		;place to convert to must be in si, number to convert must be in cx
  3702 00003257 81F900000000        <1> 	cmp ecx, 0
  3703 0000325D 7429                <1> 	je zerohx
  3704 0000325F 8A06                <1> cnvrthx:  mov al, [esi]
  3705 00003261 3C39                <1> 	cmp al, '9'
  3706 00003263 741B                <1> 	je lettershx
  3707 00003265 3C46                <1> lttrhxdn: cmp al, 'F'
  3708 00003267 741F                <1> 	je zerohx
  3709 00003269 8A06                <1> 	mov al, [esi]
  3710 0000326B FEC0                <1> 	inc al
  3711 0000326D 8806                <1> 	mov [esi], al
  3712 0000326F 89DE                <1> 	mov esi, ebx
  3713 00003271 81E901000000        <1> cnvrtlphx: sub ecx, 1
  3714 00003277 81F900000000        <1> 	cmp ecx, 0
  3715 0000327D 75E0                <1> 	jne cnvrthx
  3716 0000327F C3                  <1> 	ret
  3717                              <1> lettershx:
  3718 00003280 B041                <1> 	mov al, 'A'
  3719 00003282 2C01                <1> 	sub al, 1
  3720 00003284 8806                <1> 	mov [esi], al
  3721 00003286 EBDD                <1> 	jmp lttrhxdn
  3722 00003288 B030                <1> zerohx:	mov al, '0'
  3723 0000328A 8806                <1> 	mov [esi], al
  3724 0000328C 4E                  <1> 	dec esi
  3725 0000328D 8A06                <1> 	mov al, [esi]
  3726 0000328F 3C46                <1> 	cmp al, 'F'
  3727 00003291 74F5                <1> 	je zerohx
  3728 00003293 41                  <1> 	inc ecx
  3729 00003294 EBDB                <1> 	jmp cnvrtlphx
  3730 00003296 00                  <1> smallhex db 0
  3731 00003297 01                  <1> firsthexshown db 1
  3732                              <1> showhexsmall:
  3733 00003298 C605[96320000]01    <1> 	mov byte [smallhex], 1
  3734 0000329F E808000000          <1> 	call showhex
  3735 000032A4 C605[96320000]00    <1> 	mov byte [smallhex], 0
  3736 000032AB C3                  <1> 	ret
  3737                              <1> showhex:
  3738 000032AC 60                  <1> 	pusha
  3739 000032AD BE[EF310000]        <1> 	mov esi, hexnumber
  3740 000032B2 BF[F7310000]        <1> 	mov edi, hexnumberend
  3741 000032B7 E846FFFFFF          <1> 	call converthex
  3742 000032BC 803D[97320000]01    <1> 	cmp byte [firsthexshown], 1
  3743 000032C3 7503                <1> 	jne showthathex
  3744 000032C5 6631D2              <1> 	xor dx, dx
  3745                              <1> showthathex:
  3746 000032C8 803D[97320000]03    <1> 	cmp byte [firsthexshown], 3
  3747 000032CF 750A                <1> 	jne nonewhexline
  3748 000032D1 BE[74780000]        <1> 	mov esi, line
  3749 000032D6 E809F0FFFF          <1> 	call print
  3750                              <1> nonewhexline:
  3751 000032DB 803D[97320000]04    <1> 	cmp byte [firsthexshown], 4
  3752 000032E2 7527                <1> 	jne notabfixhex
  3753 000032E4 B1A0                <1> 	mov cl, 160
  3754 000032E6 28D1                <1> 	sub cl, dl
  3755 000032E8 C0E905              <1> 	shr cl, 5
  3756 000032EB C0E105              <1> 	shl cl, 5
  3757 000032EE 80F900              <1> 	cmp cl, 0
  3758 000032F1 750F                <1> 	jne nonewlinetabfixhex
  3759 000032F3 BE[74780000]        <1> 	mov esi, line
  3760 000032F8 E8E7EFFFFF          <1> 	call print
  3761 000032FD E909000000          <1> 	jmp notabfixhex
  3762                              <1> nonewlinetabfixhex:
  3763 00003302 80C20F              <1> 	add dl, 15
  3764 00003305 C0EA04              <1> 	shr dl, 4
  3765 00003308 C0E204              <1> 	shl dl, 4
  3766                              <1> notabfixhex:
  3767 0000330B BE[EF310000]        <1> 	mov esi, hexnumber
  3768 00003310 803D[96320000]01    <1> 	cmp byte [smallhex],1
  3769 00003317 7506                <1> 	jne printnosmallhex
  3770 00003319 81C606000000        <1> 	add esi, 6
  3771                              <1> printnosmallhex:
  3772 0000331F 803D[97320000]05    <1> 	cmp byte [firsthexshown], 5
  3773 00003326 750A                <1> 	jne noquietprinthex
  3774 00003328 E8A5EFFFFF          <1> 	call printquiet
  3775 0000332D E905000000          <1> 	jmp donequiethex
  3776                              <1> noquietprinthex:
  3777 00003332 E8ADEFFFFF          <1> 	call print
  3778                              <1> donequiethex:
  3779 00003337 803D[97320000]02    <1> 	cmp byte [firsthexshown], 2
  3780 0000333E 750A                <1> 	jne hexshown
  3781 00003340 BE[74780000]        <1> 	mov esi, line
  3782 00003345 E89AEFFFFF          <1> 	call print
  3783                              <1> hexshown:
  3784 0000334A C605[97320000]00    <1> 	mov byte [firsthexshown], 0
  3785 00003351 61                  <1> 	popa
  3786 00003352 C3                  <1> 	ret
  3787                              <1> 
  3788                              <1> 
  3789 00003353 303030303030303030- <1> decnumber db "00000000000000"
  3790 0000335C 3030303030          <1>
  3791 00003361 2000                <1> decnumberend: db " ",0
  3792                              <1> 
  3793                              <1> showdec: ;;same as showhex, just uses decimal conversion
  3794 00003363 60                  <1> 	pusha
  3795 00003364 BF[53330000]        <1> 	mov edi, decnumber
  3796 00003369 BE[61330000]        <1> 	mov esi, decnumberend
  3797                              <1> cleardecbuf:
  3798 0000336E C60730              <1> 	mov byte [edi], '0'
  3799 00003371 47                  <1> 	inc edi
  3800 00003372 39F7                <1> 	cmp edi, esi
  3801 00003374 72F8                <1> 	jb cleardecbuf
  3802 00003376 BF[53330000]        <1> 	mov edi, decnumber
  3803 0000337B E89AFDFFFF          <1> 	call convert
  3804 00003380 803D[97320000]01    <1> 	cmp byte [firsthexshown], 1
  3805 00003387 7503                <1> 	jne showthatdec
  3806 00003389 6631D2              <1> 	xor dx, dx
  3807                              <1> showthatdec:
  3808 0000338C 803D[97320000]03    <1> 	cmp byte [firsthexshown], 3
  3809 00003393 750A                <1> 	jne nonewdecline
  3810 00003395 BE[74780000]        <1> 	mov esi, line
  3811 0000339A E845EFFFFF          <1> 	call print
  3812                              <1> nonewdecline:
  3813 0000339F 803D[97320000]04    <1> 	cmp byte [firsthexshown], 4
  3814 000033A6 7527                <1> 	jne notabfixdec
  3815 000033A8 B1A0                <1> 	mov cl, 160
  3816 000033AA 28D1                <1> 	sub cl, dl
  3817 000033AC C0E905              <1> 	shr cl, 5
  3818 000033AF C0E105              <1> 	shl cl, 5
  3819 000033B2 80F900              <1> 	cmp cl, 0
  3820 000033B5 750F                <1> 	jne nonewlinetabfixdec
  3821 000033B7 BE[74780000]        <1> 	mov esi, line
  3822 000033BC E823EFFFFF          <1> 	call print
  3823 000033C1 E909000000          <1> 	jmp notabfixdec
  3824                              <1> nonewlinetabfixdec:
  3825 000033C6 80C20F              <1> 	add dl, 15
  3826 000033C9 C0EA04              <1> 	shr dl, 4
  3827 000033CC C0E204              <1> 	shl dl, 4
  3828                              <1> notabfixdec:
  3829 000033CF BE[53330000]        <1> 	mov esi, decnumber
  3830 000033D4 4E                  <1> 	dec esi
  3831                              <1> sifind:
  3832 000033D5 46                  <1> 	inc esi
  3833 000033D6 803E30              <1> 	cmp byte [esi], '0'
  3834 000033D9 74FA                <1> 	je sifind
  3835 000033DB E804EFFFFF          <1> 	call print
  3836 000033E0 803D[97320000]02    <1> 	cmp byte [firsthexshown], 2
  3837 000033E7 750A                <1> 	jne decshown
  3838 000033E9 BE[74780000]        <1> 	mov esi, line
  3839 000033EE E8F1EEFFFF          <1> 	call print
  3840                              <1> decshown:
  3841 000033F3 C605[97320000]00    <1> 	mov byte [firsthexshown], 0
  3842 000033FA 61                  <1> 	popa
  3843 000033FB C3                  <1> 	ret
  3844                              <1> 	
  3845                              <1> cnvrthextxt:
  3846 000033FC 31C9                <1> 	xor ecx, ecx
  3847 000033FE 31C0                <1> 	xor eax, eax
  3848 00003400 31D2                <1> 	xor edx, edx
  3849 00003402 31DB                <1> 	xor ebx, ebx
  3850 00003404 4E                  <1> 	dec esi
  3851                              <1> cnvrthexendtxt:
  3852 00003405 46                  <1> 	inc esi
  3853 00003406 8A06                <1> 	mov al, [esi]
  3854 00003408 3C00                <1> 	cmp al, 0
  3855 0000340A 75F9                <1> 	jne cnvrthexendtxt
  3856                              <1> cnvrthextxtlp:
  3857 0000340C 4E                  <1> 	dec esi
  3858 0000340D 8A06                <1> 	mov al, [esi]
  3859 0000340F 2C30                <1> 	sub al, 48
  3860 00003411 3C10                <1> 	cmp al, 16
  3861 00003413 7721                <1> 	ja donecnvrthx
  3862 00003415 81FA00000000        <1> 	cmp edx, 0
  3863 0000341B 740E                <1> 	je noshlhextxt
  3864 0000341D 89D3                <1> 	mov ebx, edx
  3865                              <1> shlhextxt:
  3866 0000341F C1E004              <1> 	shl eax, 4
  3867 00003422 4B                  <1> 	dec ebx
  3868 00003423 81FB00000000        <1> 	cmp ebx, 0
  3869 00003429 75F4                <1> 	jne shlhextxt
  3870                              <1> noshlhextxt:
  3871 0000342B 42                  <1> 	inc edx
  3872 0000342C 01C1                <1> 	add ecx, eax
  3873 0000342E 81FA08000000        <1> 	cmp edx, 8
  3874 00003434 72D6                <1> 	jb cnvrthextxtlp
  3875                              <1> donecnvrthx:
  3876 00003436 C3                  <1> 	ret
  3877                              <1> 	
  3878                              <1> 	
  3879                              <1> cnvrttxt: 
  3880 00003437 31C9                <1> 	xor ecx, ecx
  3881 00003439 31C0                <1> 	xor eax, eax
  3882 0000343B 31D2                <1> 	xor edx, edx
  3883 0000343D 31DB                <1> 	xor ebx, ebx
  3884 0000343F 4E                  <1> 	dec esi
  3885                              <1> cnvrtlptxt:
  3886 00003440 46                  <1> 	inc esi
  3887 00003441 8A06                <1> 	mov al, [esi]
  3888 00003443 3C00                <1> 	cmp al, 0
  3889 00003445 75F9                <1> 	jne cnvrtlptxt
  3890 00003447 4E                  <1> 	dec esi
  3891 00003448 8A06                <1> 	mov al, [esi]
  3892 0000344A 3C2E                <1> 	cmp al, '.'
  3893 0000344C 7503                <1> 	jne nocnvrtdot
  3894 0000344E 46                  <1> 	inc esi
  3895 0000344F EBEF                <1> 	jmp cnvrtlptxt
  3896                              <1> nocnvrtdot:
  3897 00003451 3C20                <1> 	cmp al, ' '
  3898 00003453 7404                <1> 	je zerotest
  3899 00003455 3C30                <1> 	cmp al, '0'
  3900 00003457 7504                <1> 	jne txtlp
  3901                              <1> zerotest: 
  3902 00003459 39FE                <1> 		cmp esi, edi
  3903 0000345B 7458                <1> 		je donecnvrt
  3904                              <1> txtlp:	
  3905 0000345D 31C0                <1> 	xor eax, eax
  3906 0000345F 8A06                <1> 	mov al, [esi]
  3907 00003461 3C3D                <1> 	cmp al, '='
  3908 00003463 7450                <1> 	je donecnvrt
  3909 00003465 3C30                <1> 	cmp al, 48
  3910 00003467 724C                <1> 	jb donecnvrt
  3911 00003469 3C23                <1> 	cmp al, '#'
  3912 0000346B 7448                <1> 	je donecnvrt
  3913 0000346D 39FE                <1> 	cmp esi, edi
  3914 0000346F 7244                <1> 	jb donecnvrt
  3915 00003471 81F900000000        <1> 	cmp ecx, 0
  3916 00003477 7708                <1> 	ja exp
  3917 00003479 2C30                <1> noexp:	sub al, 48
  3918 0000347B 01C2                <1> 	add edx, eax
  3919 0000347D 4E                  <1> 	dec esi
  3920 0000347E 41                  <1> 	inc ecx
  3921 0000347F EBDC                <1> 	jmp txtlp
  3922 00003481 81F900000000        <1> exp:	cmp ecx, 0
  3923 00003487 74F0                <1> 	je noexp
  3924 00003489 2C30                <1> 	sub al, 48
  3925 0000348B 51                  <1> 	push ecx
  3926 0000348C 89C3                <1> expmul:	mov ebx, eax
  3927 0000348E 01D8                <1> 	add eax, ebx
  3928 00003490 01D8                <1> 	add eax, ebx
  3929 00003492 01D8                <1> 	add eax, ebx
  3930 00003494 01D8                <1> 	add eax, ebx
  3931 00003496 01D8                <1> 	add eax, ebx
  3932 00003498 01D8                <1> 	add eax, ebx
  3933 0000349A 01D8                <1> 	add eax, ebx
  3934 0000349C 01D8                <1> 	add eax, ebx
  3935 0000349E 01D8                <1> 	add eax, ebx
  3936 000034A0 81E901000000        <1> 	sub ecx, 1
  3937 000034A6 81F900000000        <1> 	cmp ecx, 0
  3938 000034AC 77DE                <1> 	ja expmul
  3939 000034AE 01C2                <1> 	add edx, eax
  3940 000034B0 59                  <1> 	pop ecx
  3941 000034B1 4E                  <1> 	dec esi
  3942 000034B2 41                  <1> 	inc ecx
  3943 000034B3 EBA8                <1> 	jmp txtlp
  3944 000034B5 89D1                <1> donecnvrt: mov ecx, edx
  3945 000034B7 C3                  <1> 	ret
  3946                                      %include 'source/programs.asm'
  3947 000034B8 FF2C                <1> filetypes db 255,44
  3948                              <1> progstart:		;programs start here
  3949                              <1> indexfiles:
  3950 000034BA BE[BA340000]        <1> 	mov esi, progstart
  3951 000034BF BB[12A00000]        <1> 	mov ebx, fileindex
  3952 000034C4 BF[BA340000]        <1> 	mov edi, progstart
  3953 000034C9 81EF02000000        <1> 	sub edi, 2
  3954                              <1> indexloop:
  3955 000034CF 668B0E              <1> 	mov cx, [esi]
  3956                              <1> 	indexloop2:
  3957 000034D2 663B0F              <1> 		cmp cx, [edi]
  3958 000034D5 7424                <1> 		je indexloop2done
  3959 000034D7 81EF02000000        <1> 		sub edi, 2
  3960 000034DD 81FF[B8340000]      <1> 		cmp edi, filetypes
  3961 000034E3 73ED                <1> 		jae indexloop2
  3962 000034E5 BF[BA340000]        <1> 	mov edi, progstart
  3963 000034EA 81EF02000000        <1> 	sub edi, 2
  3964 000034F0 46                  <1> 	inc esi
  3965 000034F1 81FE[864B0000]      <1> 	cmp esi, batchprogend
  3966 000034F7 734E                <1> 	jae indexloopdone
  3967 000034F9 EBD4                <1> 	jmp indexloop
  3968                              <1> indexloop2done:
  3969 000034FB 66890B              <1> 	mov [ebx], cx
  3970 000034FE 81C302000000        <1> 	add ebx, 2
  3971 00003504 81C602000000        <1> 	add esi, 2
  3972                              <1> 	nameindex:
  3973 0000350A 8A0E                <1> 		mov cl, [esi]
  3974 0000350C 80F900              <1> 		cmp cl, 0
  3975 0000350F 7406                <1> 		je nameindexdone
  3976 00003511 880B                <1> 		mov [ebx], cl
  3977 00003513 46                  <1> 		inc esi
  3978 00003514 43                  <1> 		inc ebx
  3979 00003515 EBF3                <1> 		jmp nameindex
  3980                              <1> 	nameindexdone:
  3981 00003517 43                  <1> 		inc ebx
  3982 00003518 66C7030000          <1> 		mov word [ebx], 0
  3983 0000351D 81C302000000        <1> 		add ebx, 2
  3984 00003523 46                  <1> 		inc esi
  3985 00003524 8933                <1> 		mov [ebx], esi
  3986 00003526 81C304000000        <1> 		add ebx, 4
  3987 0000352C 66C7030000          <1> 		mov word [ebx], 0
  3988 00003531 81C302000000        <1> 		add ebx, 2
  3989 00003537 81FB[12A40000]      <1> 		cmp ebx, fileindexend
  3990 0000353D 7308                <1> 		jae indexloopdone
  3991 0000353F 81C601000000        <1> 		add esi, 1
  3992 00003545 EB88                <1> 		jmp indexloop
  3993 00003547 C605[4F350000]01    <1> indexloopdone: 	mov byte [indexdone], 1
  3994 0000354E C3                  <1> 		ret
  3995                              <1> 
  3996 0000354F 00                  <1> indexdone db 0
  3997                              <1> %include 'source/programs/_comment.asm' ;#
  3998 00003550 FF2C2300            <2> 	db 255,44,"#",0	;this lets you rem stuff
  3999 00003554 C3                  <2> 	ret 
  4000                              <1> %include 'source/programs/_math.asm' ;!
  4001 00003555 FF2C2100            <2> db 255,44,"!",0
  4002                              <2> 	num:	
  4003 00003559 E8A7FBFFFF          <2> 		call clearbuffer
  4004 0000355E C605[DF370000]00    <2> 		mov byte [decimal], 0
  4005 00003565 C605[E0370000]00    <2> 		mov byte [decimal2], 0
  4006 0000356C 8B35[46300000]      <2> 		mov esi, [currentcommandloc]
  4007 00003572 31C0                <2> 		xor eax, eax
  4008 00003574 31C9                <2> 		xor ecx, ecx
  4009 00003576 31DB                <2> 		xor ebx, ebx
  4010 00003578 8A06                <2> 	num2:	mov al, [esi]
  4011 0000357A 3C2B                <2> 		cmp al, '+'
  4012 0000357C 741B                <2> 		je operatorfound
  4013 0000357E 3C2D                <2> 		cmp al, '-'
  4014 00003580 7417                <2> 		je operatorfound
  4015 00003582 3C2A                <2> 		cmp al, '*'
  4016 00003584 7413                <2> 		je operatorfound
  4017 00003586 3C2F                <2> 		cmp al, '/'
  4018 00003588 740F                <2> 		je operatorfound
  4019 0000358A 3C5E                <2> 		cmp al, '^'
  4020 0000358C 740B                <2> 		je operatorfound
  4021 0000358E 46                  <2> 		inc esi
  4022 0000358F 3C00                <2> 		cmp al, 0
  4023 00003591 0F8405F8FFFF        <2> 		je near nwcmd
  4024 00003597 EBDF                <2> 		jmp num2
  4025 00003599 50                  <2> 	operatorfound: push eax
  4026 0000359A 30E4                <2> 		xor ah, ah
  4027 0000359C 8826                <2> 		mov [esi], ah
  4028 0000359E 89F7                <2> 		mov edi, esi
  4029 000035A0 46                  <2> 		inc esi
  4030 000035A1 8A06                <2> 		mov al, [esi]
  4031 000035A3 3C25                <2> 		cmp al, '%'
  4032 000035A5 0F8462000000        <2> 		je near resultnum1
  4033                              <2> 	varnum2: 
  4034 000035AB 57                  <2> 		push edi
  4035 000035AC E8A4000000          <2> 		call checkdecimal
  4036 000035B1 5F                  <2> 		pop edi
  4037 000035B2 E880FEFFFF          <2> 		call cnvrttxt
  4038                              <2> 	vrnm2:
  4039 000035B7 89CB                <2> 		mov ebx, ecx
  4040 000035B9 53                  <2> 		push ebx
  4041 000035BA E846FBFFFF          <2> 		call clearbuffer
  4042 000035BF 8B35[46300000]      <2> 		mov esi, [currentcommandloc]
  4043 000035C5 89F7                <2> 		mov edi, esi
  4044 000035C7 46                  <2> 		inc esi
  4045 000035C8 8A06                <2> 		mov al, [esi]
  4046 000035CA 3C25                <2> 		cmp al, '%'
  4047 000035CC 0F844F000000        <2> 		je near resultnum2
  4048                              <2> 	varnum4: 
  4049 000035D2 57                  <2> 		push edi
  4050 000035D3 E869000000          <2> 		call checkdecimal2
  4051 000035D8 5F                  <2> 		pop edi
  4052 000035D9 E859FEFFFF          <2> 		call cnvrttxt
  4053                              <2> 	vrnm4:
  4054 000035DE 5B                  <2> 		pop ebx
  4055 000035DF 58                  <2> 		pop eax
  4056 000035E0 3C2B                <2> 		cmp al, '+'
  4057 000035E2 0F849B000000        <2> 		je near plusnum
  4058 000035E8 3C2D                <2> 		cmp al, '-'
  4059 000035EA 0F849F000000        <2> 		je near subnum
  4060 000035F0 3C2A                <2> 		cmp al, '*'
  4061 000035F2 0F84A3000000        <2> 		je near mulnum
  4062 000035F8 3C2F                <2> 		cmp al, '/'
  4063 000035FA 0F84B1000000        <2> 		je near divnum
  4064 00003600 3C5E                <2> 		cmp al, '^'
  4065 00003602 0F84CE000000        <2> 		je near expnum
  4066 00003608 E98FF7FFFF          <2> 		jmp nwcmd
  4067                              <2> 	resultnum1:
  4068 0000360D 8A0D[E1370000]      <2> 		mov cl, [decimalresult]
  4069 00003613 880D[DF370000]      <2> 		mov [decimal], cl
  4070 00003619 8B0D[E2370000]      <2> 		mov ecx, [result]
  4071 0000361F EB96                <2> 		jmp vrnm2
  4072                              <2> 	resultnum2:
  4073 00003621 8A0D[DF370000]      <2> 		mov cl, [decimal]
  4074 00003627 880D[E0370000]      <2> 		mov [decimal2], cl
  4075 0000362D 8A0D[E1370000]      <2> 		mov cl, [decimalresult]
  4076 00003633 880D[DF370000]      <2> 		mov [decimal], cl
  4077 00003639 8B0D[E2370000]      <2> 		mov ecx, [result]
  4078 0000363F EB9D                <2> 		jmp vrnm4
  4079                              <2> 	checkdecimal2:
  4080 00003641 8A25[DF370000]      <2> 		mov ah, [decimal]
  4081 00003647 8825[E0370000]      <2> 		mov [decimal2], ah
  4082 0000364D 30E4                <2> 		xor ah, ah
  4083 0000364F 8825[DF370000]      <2> 		mov [decimal], ah
  4084                              <2> 	checkdecimal:
  4085 00003655 89F7                <2> 		mov edi, esi
  4086                              <2> 	chkdec1:
  4087 00003657 8A07                <2> 		mov al, [edi]
  4088 00003659 3C2E                <2> 		cmp al, '.'
  4089 0000365B 0F840B000000        <2> 		je near fnddec
  4090 00003661 3C00                <2> 		cmp al, 0
  4091 00003663 0F8419000000        <2> 		je near nodecimal
  4092 00003669 47                  <2> 		inc edi
  4093 0000366A EBEB                <2> 		jmp chkdec1
  4094                              <2> 	fnddec:
  4095 0000366C 8A4701              <2> 		mov al, [edi + 1]
  4096 0000366F 8807                <2> 		mov [edi], al
  4097 00003671 3C00                <2> 		cmp al, 0
  4098 00003673 0F8409000000        <2> 		je near nodecimal
  4099 00003679 FE05[DF370000]      <2> 		inc byte [decimal]
  4100 0000367F 47                  <2> 		inc edi
  4101 00003680 EBEA                <2> 		jmp fnddec
  4102                              <2> 	nodecimal:
  4103 00003682 C3                  <2> 		ret
  4104                              <2> 	plusnum:
  4105 00003683 E815010000          <2> 		call decaddfix
  4106 00003688 01D9                <2> 		add ecx, ebx
  4107 0000368A E98A000000          <2> 		jmp retnum
  4108                              <2> 	subnum:
  4109 0000368F E809010000          <2> 		call decaddfix
  4110 00003694 29D9                <2> 		sub ecx, ebx
  4111 00003696 E97E000000          <2> 		jmp retnum
  4112                              <2> 	mulnum:
  4113 0000369B A0[E0370000]        <2> 		mov al, [decimal2]
  4114 000036A0 0005[DF370000]      <2> 		add [decimal], al
  4115 000036A6 89C8                <2> 		mov eax, ecx
  4116 000036A8 F7E3                <2> 		mul ebx
  4117 000036AA 89C1                <2> 		mov ecx, eax
  4118 000036AC E968000000          <2> 		jmp retnum
  4119                              <2> 	divnum:
  4120 000036B1 E8E7000000          <2> 		call decaddfix
  4121 000036B6 30C0                <2> 		xor al, al
  4122 000036B8 A2[DF370000]        <2> 		mov [decimal], al
  4123 000036BD 31D2                <2> 		xor edx, edx
  4124 000036BF 89C8                <2> 		mov eax, ecx
  4125 000036C1 81FB00000000        <2> 		cmp ebx, 0
  4126 000036C7 0F844C000000        <2> 		je near retnum
  4127 000036CD F7F3                <2> 		div ebx
  4128 000036CF 89C1                <2> 		mov ecx, eax
  4129 000036D1 E943000000          <2> 		jmp retnum
  4130                              <2> 	expnum:
  4131 000036D6 8A15[DF370000]      <2> 		mov dl, [decimal]
  4132 000036DC 8815[E0370000]      <2> 		mov [decimal2], dl
  4133 000036E2 31D2                <2> 		xor edx, edx
  4134 000036E4 89C8                <2> 		mov eax, ecx
  4135 000036E6 89D9                <2> 		mov ecx, ebx
  4136 000036E8 89C3                <2> 		mov ebx, eax
  4137 000036EA 81F900000000        <2> 		cmp ecx, 0
  4138 000036F0 7422                <2> 		je noexpnum
  4139 000036F2 49                  <2> 		dec ecx
  4140 000036F3 81F900000000        <2> 		cmp ecx, 0
  4141 000036F9 7412                <2> 		je noexpnumlp
  4142 000036FB F7E3                <2> 	expnumlp: mul ebx
  4143 000036FD 8A15[E0370000]      <2> 		mov dl, [decimal2]
  4144 00003703 0015[DF370000]      <2> 		add [decimal], dl
  4145 00003709 31D2                <2> 		xor edx, edx
  4146 0000370B E2EE                <2> 		loop expnumlp
  4147                              <2> 	noexpnumlp:
  4148 0000370D 89C1                <2> 		mov ecx, eax
  4149 0000370F E905000000          <2> 		jmp retnum
  4150                              <2> 	noexpnum:
  4151 00003714 B901000000          <2> 		mov ecx, 1
  4152                              <2> 	retnum: 
  4153 00003719 BE[A3BC0000]        <2> 		mov esi, numbuf
  4154 0000371E 890D[E2370000]      <2> 		mov [result], ecx
  4155 00003724 E8F1F9FFFF          <2> 		call convert
  4156 00003729 BE[A3BC0000]        <2> 		mov esi, numbuf
  4157 0000372E 8A25[DF370000]      <2> 		mov ah, [decimal]
  4158 00003734 8825[E1370000]      <2> 		mov [decimalresult], ah
  4159 0000373A 80FC00              <2> 		cmp ah, 0
  4160 0000373D 0F8425000000        <2> 		je near noputdecimal
  4161                              <2> 	putdecimal:
  4162 00003743 4E                  <2> 		dec esi
  4163 00003744 FECC                <2> 		dec ah
  4164 00003746 80FC00              <2> 		cmp ah, 0
  4165 00003749 0F87F4FFFFFF        <2> 		ja near putdecimal
  4166 0000374F 4E                  <2> 		dec esi
  4167 00003750 8A06                <2> 		mov al, [esi]
  4168 00003752 C6062E              <2> 		mov byte [esi], '.'
  4169                              <2> 	decputloop:
  4170 00003755 4E                  <2> 		dec esi
  4171 00003756 8A26                <2> 		mov ah, [esi]
  4172 00003758 8806                <2> 		mov [esi], al
  4173 0000375A 88E0                <2> 		mov al, ah
  4174 0000375C 81FE[8FBC0000]      <2> 		cmp esi, buf2
  4175 00003762 0F87EDFFFFFF        <2> 		ja near decputloop
  4176                              <2> 	noputdecimal:
  4177 00003768 BE[8FBC0000]        <2> 		mov esi, buf2
  4178 0000376D E809000000          <2> 		call chkadd
  4179 00003772 E925F6FFFF          <2> 		jmp nwcmd
  4180 00003777 00000000            <2> edxnumbuf dw 0,0
  4181 0000377B 8A06                <2> 	chkadd: mov al, [esi]
  4182 0000377D 3C30                <2> 		cmp al, '0'
  4183 0000377F 750C                <2> 		jne dnadd
  4184 00003781 46                  <2> 		inc esi
  4185 00003782 81FE[A3BC0000]      <2> 		cmp esi, numbuf
  4186 00003788 7402                <2> 		je dnaddm1
  4187 0000378A EBEF                <2> 		jmp chkadd
  4188 0000378C 4E                  <2> 	dnaddm1: dec esi
  4189 0000378D E852EBFFFF          <2> 	dnadd:	call print
  4190 00003792 BE[74780000]        <2> 		mov esi, line
  4191 00003797 E848EBFFFF          <2> 		call print
  4192 0000379C C3                  <2> 		ret
  4193                              <2> 		
  4194                              <2> 	decaddfix:
  4195 0000379D A0[E0370000]        <2> 		mov al, [decimal2]
  4196 000037A2 8A25[DF370000]      <2> 		mov ah, [decimal]
  4197 000037A8 38E0                <2> 		cmp al, ah
  4198 000037AA 7432                <2> 		je gooddecadd
  4199 000037AC 38E0                <2> 		cmp al, ah
  4200 000037AE 721A                <2> 		jb lowdecadd
  4201                              <2> 	highdecadd:
  4202 000037B0 FEC4                <2> 		inc ah
  4203 000037B2 89CA                <2> 		mov edx, ecx
  4204 000037B4 C1E103              <2> 		shl ecx, 3
  4205 000037B7 01D1                <2> 		add ecx, edx
  4206 000037B9 01D1                <2> 		add ecx, edx
  4207 000037BB 38E0                <2> 		cmp al, ah
  4208 000037BD 77F1                <2> 		ja highdecadd
  4209 000037BF 8825[DF370000]      <2> 		mov [decimal], ah
  4210 000037C5 E914000000          <2> 		jmp gooddecadd
  4211                              <2> 	lowdecadd:
  4212 000037CA FEC0                <2> 		inc al
  4213 000037CC 89DA                <2> 		mov edx, ebx
  4214 000037CE C1E303              <2> 		shl ebx, 3
  4215 000037D1 01D3                <2> 		add ebx, edx
  4216 000037D3 01D3                <2> 		add ebx, edx
  4217 000037D5 38E0                <2> 		cmp al, ah
  4218 000037D7 72F1                <2> 		jb lowdecadd
  4219 000037D9 A2[DF370000]        <2> 		mov [decimal], al
  4220                              <2> 	gooddecadd:
  4221 000037DE C3                  <2> 		ret
  4222                              <2> 		
  4223 000037DF 00                  <2> decimal db 0
  4224 000037E0 00                  <2> decimal2 db 0
  4225 000037E1 00                  <2> decimalresult db 0
  4226 000037E2 00000000            <2> result dd 0
  4227                              <1> %include 'source/programs/_variables.asm' ;% and $
  4228 000037E6 FF2C2500            <2> db 255,44,"%",0
  4229                              <2> 	ans:
  4230 000037EA BE[8FBC0000]        <2> 		mov esi, buf2
  4231 000037EF E887FFFFFF          <2> 		call chkadd
  4232 000037F4 C3                  <2> 		ret
  4233                              <2> 		
  4234 000037F5 FF2C2400            <2> db 255,44,"$",0
  4235 000037F9 8B35[46300000]      <2> var: mov esi, [currentcommandloc]
  4236 000037FF BB[85A40000]        <2> 	mov ebx, variables
  4237 00003804 8A06                <2> lkeq:	mov al, [esi]
  4238 00003806 3C3D                <2> 	cmp al, '='
  4239 00003808 741B                <2> 	je eqfnd	;is there an '=' sign?
  4240 0000380A 3C00                <2> 	cmp al, 0
  4241 0000380C 7403                <2> 	je echovars
  4242 0000380E 46                  <2> 	inc esi
  4243 0000380F EBF3                <2> 	jmp lkeq
  4244 00003811 BE[85A40000]        <2> echovars: mov esi, variables
  4245 00003816 BB[85B40000]        <2> 	mov ebx, varend
  4246 0000381B B105                <2> 	mov cl, 5
  4247 0000381D B504                <2> 	mov ch, 4
  4248 0000381F E880F8FFFF          <2> 	call array
  4249 00003824 C3                  <2> 	ret
  4250 00003825 46                  <2> eqfnd:	inc esi
  4251 00003826 8A06                <2> 	mov al, [esi]
  4252 00003828 3C00                <2> 	cmp al, 0
  4253 0000382A 7410                <2> 	je readvar
  4254 0000382C 8B35[46300000]      <2> 	mov esi, [currentcommandloc]
  4255 00003832 BB[85A40000]        <2> 	mov ebx, variables
  4256 00003837 E919000000          <2> 	jmp seek
  4257                              <2> readvar:
  4258 0000383C B00A                <2> 	mov al, 10
  4259 0000383E 66BB0700            <2> 	mov bx, 7
  4260 00003842 C605[4D270000]00    <2> 	mov byte [commandedit], 0
  4261 00003849 BF[8FBC0000]        <2> 	mov edi, buftxtend
  4262 0000384E E899EBFFFF          <2> 	call rdprint
  4263 00003853 EBA4                <2> 	jmp var
  4264 00003855 668B03              <2> seek:	mov ax, [ebx]
  4265 00003858 B105                <2> 	mov cl, 5
  4266 0000385A B504                <2> 	mov ch, 4
  4267 0000385C 663D0000            <2> 	cmp ax, 0
  4268 00003860 0F845B000000        <2> 	je near save
  4269 00003866 6639C8              <2> 	cmp ax, cx
  4270 00003869 7403                <2> 	je skfnd
  4271 0000386B 43                  <2> 	inc ebx
  4272 0000386C EBE7                <2> 	jmp seek
  4273 0000386E 8B35[46300000]      <2> skfnd:	mov esi, [currentcommandloc]
  4274 00003874 46                  <2> 	inc esi
  4275 00003875 81C302000000        <2> 	add ebx, 2
  4276 0000387B 89DF                <2> 	mov edi, ebx
  4277 0000387D B13D                <2> 	mov cl, '='
  4278 0000387F E801F8FFFF          <2> 	call cndtest
  4279 00003884 3C01                <2> 	cmp al, 1	
  4280 00003886 7418                <2> 	je varfnd
  4281 00003888 89FB                <2> 	mov ebx, edi
  4282 0000388A 8B35[46300000]      <2> 	mov esi, [currentcommandloc]
  4283 00003890 668B03              <2> 	mov ax, [ebx]
  4284 00003893 663D0000            <2> 	cmp ax, 0
  4285 00003897 0F8424000000        <2> 	je near save
  4286 0000389D 43                  <2> 	inc ebx
  4287 0000389E EBB5                <2> 	jmp seek
  4288 000038A0 8A03                <2> varfnd:	mov al, [ebx]
  4289 000038A2 3C04                <2> 	cmp al, 4
  4290 000038A4 7404                <2> 	je save2
  4291 000038A6 4B                  <2> 	dec ebx
  4292 000038A7 4E                  <2> 	dec esi
  4293 000038A8 EBF6                <2> 	jmp varfnd
  4294 000038AA 4B                  <2> save2:	dec ebx
  4295 000038AB 4E                  <2> 	dec esi
  4296 000038AC 8A03                <2> 	mov al, [ebx]
  4297 000038AE 3C05                <2> 	cmp al, 5
  4298 000038B0 7402                <2> 	je remove
  4299 000038B2 EBEC                <2> 	jmp varfnd
  4300 000038B4 8A03                <2> remove: mov al, [ebx]
  4301 000038B6 3C00                <2> 	cmp al, 0
  4302 000038B8 749B                <2> 	je seek
  4303 000038BA 30C0                <2> 	xor al, al
  4304 000038BC 8803                <2> 	mov [ebx], al
  4305 000038BE 43                  <2> 	inc ebx
  4306 000038BF EBF3                <2> 	jmp remove	;do not need for now-need defragmentation
  4307 000038C1 8B35[46300000]      <2> save:	mov esi, [currentcommandloc]
  4308 000038C7 43                  <2> 	inc ebx
  4309 000038C8 B005                <2> 	mov al, 5
  4310 000038CA B404                <2> 	mov ah, 4
  4311 000038CC 668903              <2> 	mov [ebx], ax
  4312 000038CF 43                  <2> 	inc ebx
  4313 000038D0 43                  <2> svhere:	inc ebx
  4314 000038D1 46                  <2> 	inc esi
  4315 000038D2 8A06                <2> 	mov al, [esi]
  4316 000038D4 3C00                <2> 	cmp al, 0
  4317 000038D6 0F844A000000        <2> 	je near svdone
  4318 000038DC 3C25                <2> 	cmp al, '%'
  4319 000038DE 7404                <2> 	je ans2
  4320 000038E0 8803                <2> 	mov [ebx], al	
  4321 000038E2 EBEC                <2> 	jmp svhere
  4322 000038E4 56                  <2> ans2:	push esi
  4323 000038E5 BE[8FBC0000]        <2> 	mov esi, buf2
  4324 000038EA E823000000          <2> 	call ansfnd
  4325 000038EF E803000000          <2> 	call anscp
  4326 000038F4 5E                  <2> 	pop esi
  4327 000038F5 EBD9                <2> 	jmp svhere
  4328 000038F7 8A06                <2> anscp:	mov al, [esi]
  4329 000038F9 8803                <2> 	mov [ebx], al
  4330 000038FB 81FE[A3BC0000]      <2> 	cmp esi, numbuf
  4331 00003901 74CD                <2> 	je svhere
  4332 00003903 3C00                <2> 	cmp al, 0
  4333 00003905 74C9                <2> 	je svhere
  4334 00003907 43                  <2> 	inc ebx
  4335 00003908 46                  <2> 	inc esi
  4336 00003909 EBEC                <2> 	jmp anscp
  4337 0000390B 5E                  <2> ansnf:	pop esi
  4338 0000390C 8A06                <2> 	mov al, [esi]
  4339 0000390E 8803                <2> 	mov [ebx], al
  4340 00003910 EBBE                <2> 	jmp svhere
  4341 00003912 46                  <2> ansfnd:	inc esi
  4342 00003913 81FE[A2BC0000]      <2> 	cmp esi, numbuf - 1
  4343 00003919 740A                <2> 	je fndans
  4344 0000391B 8A06                <2> 	mov al, [esi]
  4345 0000391D 3C00                <2> 	cmp al, 0
  4346 0000391F 74EA                <2> 	je ansnf
  4347 00003921 3C30                <2> 	cmp al, '0'
  4348 00003923 74ED                <2> 	je ansfnd
  4349                              <2> fndans:
  4350 00003925 C3                  <2> 	ret
  4351 00003926 30C0                <2> svdone:	xor al, al
  4352 00003928 8803                <2> 	mov [ebx], al
  4353 0000392A C3                  <2> 	ret
  4354                              <1> %include 'source/programs/_run.asm' ;./
  4355                              <2> 
  4356 0000392B 7F454C46            <2> 	elfstart db 0x7F,"ELF"
  4357 0000392F FF2C2E2F00          <2> 	db 255,44,"./",0
  4358                              <2> rundiskprog:
  4359 00003934 8B3D[46300000]      <2> 	mov edi, [currentcommandloc]
  4360 0000393A 81C702000000        <2> 	add edi, 2
  4361 00003940 BE00004000          <2> 	mov esi, 0x400000
  4362 00003945 E8F0370000          <2> 	call loadfile
  4363 0000394A 81FA94010000        <2> 	cmp edx, 404
  4364 00003950 7452                <2> 	je noprogfound
  4365 00003952 BB00004000          <2> 	mov ebx, 0x400000
  4366 00003957 A1[2B390000]        <2> 	mov eax, [elfstart]
  4367 0000395C 3903                <2> 	cmp [ebx], eax
  4368 0000395E 0F842B000000        <2> 	je near runelf
  4369 00003964 66813B4558          <2> 	cmp word [ebx], "EX"
  4370 00003969 755F                <2> 	jne progbatchfound
  4371 0000396B 81C302000000        <2> 	add ebx, 2
  4372 00003971 8B3D[46300000]      <2> 	mov edi, [currentcommandloc]
  4373 00003977 81C702000000        <2> 	add edi, 2
  4374                              <2> findspaceprog:
  4375 0000397D 8A07                <2> 	mov al, [edi]
  4376 0000397F 47                  <2> 	inc edi
  4377 00003980 3C20                <2> 	cmp al, " "
  4378 00003982 75F9                <2> 	jne findspaceprog
  4379                              <2> findnonspaceprog:
  4380 00003984 8A07                <2> 	mov al, [edi]
  4381 00003986 47                  <2> 	inc edi
  4382 00003987 3C20                <2> 	cmp al, " "
  4383 00003989 74F9                <2> 	je findnonspaceprog
  4384 0000398B 4F                  <2> 	dec edi
  4385 0000398C FFD3                <2> 	call ebx
  4386 0000398E C3                  <2> 	ret
  4387                              <2> runelf:
  4388 0000398F 8B3D[46300000]      <2> 	mov edi, [currentcommandloc]
  4389 00003995 81C702000000        <2> 	add edi, 2
  4390 0000399B 81C380000000        <2> 	add ebx, 0x80
  4391 000039A1 FFD3                <2> 	call ebx
  4392 000039A3 C3                  <2> 	ret
  4393                              <2> noprogfound:
  4394 000039A4 BE[36780000]        <2> 	mov esi, notfound1
  4395 000039A9 E836E9FFFF          <2> 	call print
  4396 000039AE 8B35[46300000]      <2> 	mov esi, [currentcommandloc]
  4397 000039B4 81C602000000        <2> 	add esi, 2
  4398 000039BA E825E9FFFF          <2> 	call print
  4399 000039BF BE[40780000]        <2> 	mov esi, notfound2
  4400 000039C4 E81BE9FFFF          <2> 	call print
  4401 000039C9 C3                  <2> 	ret
  4402                              <2> progbatchfound:
  4403 000039CA BF00004000          <2> 		mov edi, 0x400000
  4404 000039CF C605[7FA40000]01    <2> 		mov byte [BATCHISON], 1
  4405                              <2> 	batchrunloop:
  4406 000039D6 E89EF3FFFF          <2> 		call buftxtclear
  4407 000039DB BE[8FB80000]        <2> 		mov esi, buftxt
  4408 000039E0 8935[46300000]      <2> 		mov [currentcommandloc], esi
  4409                              <2> 	batchrunloop2:
  4410 000039E6 B10A                <2> 		mov cl, 10
  4411 000039E8 B50D                <2> 		mov ch, 13
  4412 000039EA 380F                <2> 		cmp [edi], cl
  4413 000039EC 0F8419000000        <2> 		je near nxtbatchrunline
  4414 000039F2 382F                <2> 		cmp [edi], ch
  4415 000039F4 0F8411000000        <2> 		je near nxtbatchrunline
  4416 000039FA 803F00              <2> 		cmp byte [edi], 0
  4417 000039FD 0F8408000000        <2> 		je near nxtbatchrunline
  4418 00003A03 8A07                <2> 		mov al, [edi]
  4419 00003A05 8806                <2> 		mov [esi], al
  4420 00003A07 46                  <2> 		inc esi
  4421 00003A08 47                  <2> 		inc edi
  4422 00003A09 EBDB                <2> 		jmp batchrunloop2
  4423                              <2> 	nxtbatchrunline:
  4424 00003A0B 47                  <2> 		inc edi
  4425 00003A0C 380F                <2> 		cmp [edi], cl
  4426 00003A0E 74FB                <2> 		je nxtbatchrunline
  4427 00003A10 382F                <2> 		cmp [edi], ch
  4428 00003A12 74F7                <2> 		je nxtbatchrunline
  4429 00003A14 893D[723A0000]      <2> 		mov [batchedi], edi
  4430 00003A1A 893D[7BA40000]      <2> 		mov [BATCHPOS], edi
  4431 00003A20 C60600              <2> 		mov byte [esi], 0
  4432 00003A23 BE[8FB80000]        <2> 		mov esi, buftxt
  4433 00003A28 803E00              <2> 		cmp byte [esi], 0
  4434 00003A2B 0F8439000000        <2> 		je near nobatchfoundrun
  4435 00003A31 31DB                <2> 		xor ebx, ebx
  4436 00003A33 8A1D[16A40000]      <2> 		mov bl, [IFON]
  4437 00003A39 80FB00              <2> 		cmp bl, 0
  4438 00003A3C 0F8534000000        <2> 		jne near iftestbatch
  4439                              <2> 	doneiftest:
  4440 00003A42 803D[483B0000]00    <2> 		cmp byte [runnextline], 0
  4441 00003A49 0F8405000000        <2> 		je near noruniftest
  4442 00003A4F E814F5FFFF          <2> 		call run
  4443                              <2> 	noruniftest:
  4444 00003A54 C605[483B0000]01    <2> 		mov byte [runnextline], 1
  4445 00003A5B 8B3D[723A0000]      <2> 		mov edi, [batchedi]
  4446 00003A61 803F00              <2> 		cmp byte [edi], 0
  4447 00003A64 0F856CFFFFFF        <2> 		jne near batchrunloop
  4448                              <2> 	nobatchfoundrun:
  4449 00003A6A C605[7FA40000]00    <2> 		mov byte [BATCHISON], 0
  4450 00003A71 C3                  <2> 		ret
  4451                              <2> 	
  4452 00003A72 00000000            <2> batchedi dd 0	
  4453                              <2> 	
  4454                              <2> 	iftestbatch:
  4455 00003A76 BE[17A40000]        <2> 		mov esi, IFTRUE
  4456 00003A7B 01DE                <2> 		add esi, ebx
  4457 00003A7D 803E00              <2> 		cmp byte [esi], 0
  4458 00003A80 0F85BCFFFFFF        <2> 		jne near doneiftest
  4459 00003A86 881D[493B0000]      <2> 		mov [iffalsebuf], bl
  4460 00003A8C 803D[80A40000]01    <2> 		cmp byte [LOOPON], 1
  4461 00003A93 0F8513000000        <2> 		jne near fifindbatch
  4462 00003A99 E938FFFFFF          <2> 		jmp batchrunloop
  4463                              <2> 	elsetestbatch:
  4464 00003A9E C60601              <2> 		mov byte [esi], 1
  4465 00003AA1 81C705000000        <2> 		add edi, 5
  4466 00003AA7 E92AFFFFFF          <2> 		jmp batchrunloop
  4467                              <2> 	fifindbatch:
  4468 00003AAC 66B96966            <2> 		mov cx, "if"
  4469 00003AB0 66B86669            <2> 		mov ax, "fi"
  4470 00003AB4 663907              <2> 		cmp [edi], ax
  4471 00003AB7 0F8424000000        <2> 		je near fifoundbatch
  4472 00003ABD 66390F              <2> 		cmp [edi], cx
  4473 00003AC0 0F8465000000        <2> 		je near iffoundbatch
  4474 00003AC6 803F00              <2> 		cmp byte [edi], 0
  4475 00003AC9 0F8412000000        <2> 		je near fifoundbatch
  4476 00003ACF B8656C7365          <2> 		mov eax, "else"
  4477 00003AD4 3907                <2> 		cmp [edi], eax
  4478 00003AD6 0F84C2FFFFFF        <2> 		je near elsetestbatch
  4479 00003ADC E973FFFFFF          <2> 		jmp noruniftest
  4480                              <2> 	fifoundbatch:
  4481 00003AE1 81C702000000        <2> 		add edi, 2
  4482 00003AE7 B00A                <2> 		mov al, 10
  4483 00003AE9 3807                <2> 		cmp [edi], al
  4484 00003AEB 0F840B000000        <2> 		je near goodfibatch
  4485 00003AF1 803F00              <2> 		cmp byte [edi], 0
  4486 00003AF4 0F8470FFFFFF        <2> 		je near nobatchfoundrun
  4487 00003AFA EBB0                <2> 		jmp fifindbatch
  4488                              <2> 	goodfibatch:
  4489 00003AFC B001                <2> 		mov al, 1
  4490 00003AFE 2805[16A40000]      <2> 		sub [IFON], al 
  4491 00003B04 A0[16A40000]        <2> 		mov al, [IFON]
  4492 00003B09 8A1D[493B0000]      <2> 		mov bl, [iffalsebuf]
  4493 00003B0F 38D8                <2> 		cmp al, bl
  4494 00003B11 7799                <2> 		ja fifindbatch
  4495 00003B13 8B35[46300000]      <2> 		mov esi, [currentcommandloc]
  4496 00003B19 81EF02000000        <2> 		sub edi, 2
  4497 00003B1F C605[483B0000]00    <2> 		mov byte [runnextline], 0
  4498 00003B26 E9ABFEFFFF          <2> 		jmp batchrunloop
  4499                              <2> 	iffoundbatch:
  4500 00003B2B B020                <2> 		mov al, ' '
  4501 00003B2D 81C702000000        <2> 		add edi, 2
  4502 00003B33 3807                <2> 		cmp [edi], al
  4503 00003B35 0F8571FFFFFF        <2> 		jne near fifindbatch
  4504 00003B3B B001                <2> 		mov al, 1
  4505 00003B3D 0005[16A40000]      <2> 		add [IFON], al
  4506 00003B43 E964FFFFFF          <2> 		jmp fifindbatch
  4507                              <2> 		
  4508                              <2> 		
  4509 00003B48 01                  <2> runnextline db 1
  4510 00003B49 00                  <2> iffalsebuf db 0
  4511                              <2> 
  4512 00003B4A C3                  <2> notbatch: ret 
  4513                              <1> 
  4514                              <1> %include 'source/programs/arp.asm'
  4515 00003B4B FF2C61727000        <2> db 255,44,"arp",0	;if only this worked
  4516 00003B51 E872320000          <2> 	call arptest
  4517 00003B56 C3                  <2> 	ret
  4518                              <2> 	
  4519                              <1> %include 'source/programs/batch.asm'
  4520 00003B57 FF2C626174636800    <2> db 255,44,"batch",0
  4521                              <2> 	batchst: 
  4522 00003B5F 8B3D[46300000]      <2> 		mov edi, [currentcommandloc]
  4523 00003B65 81C706000000        <2> 		add edi, 6
  4524 00003B6B 803F00              <2> 		cmp byte [edi], 0
  4525 00003B6E 0F846D000000        <2> 		je near nonamefound
  4526 00003B74 BE00004000          <2> 		mov esi, 0x400000
  4527 00003B79 E8BC350000          <2> 		call loadfile
  4528 00003B7E 89D0                <2> 		mov eax, edx
  4529 00003B80 3D94010000          <2> 		cmp eax, 404
  4530 00003B85 7465                <2> 		je goodbatchname
  4531 00003B87 BE[923B0000]        <2> 		mov esi, badbatchname
  4532 00003B8C E853E7FFFF          <2> 		call print
  4533 00003B91 C3                  <2> 		ret
  4534 00003B92 546869732066696C65- <2> 		badbatchname db "This file already exists!",10,0
  4535 00003B9B 20616C726561647920- <2>
  4536 00003BA4 657869737473210A00  <2>
  4537 00003BAD 596F75206861766520- <2> 		namenotfoundbatch db "You have to type a name after the command.",10,0
  4538 00003BB6 746F20747970652061- <2>
  4539 00003BBF 206E616D6520616674- <2>
  4540 00003BC8 65722074686520636F- <2>
  4541 00003BD1 6D6D616E642E0A00    <2>
  4542 00003BD9 00000000            <2> 		esicache3 dd 0
  4543 00003BDD 00000000            <2> 		esicache2 dd 0
  4544                              <2> 	nonamefound:
  4545 00003BE1 BE[AD3B0000]        <2> 		mov esi, namenotfoundbatch
  4546 00003BE6 E8F9E6FFFF          <2> 		call print
  4547 00003BEB C3                  <2> 		ret
  4548                              <2> 	goodbatchname:
  4549 00003BEC BE00004000          <2> 		mov esi, 0x400000
  4550                              <2> 	batchcreate:
  4551 00003BF1 8935[D93B0000]      <2> 		mov [esicache3], esi
  4552 00003BF7 BF00008000          <2> 		mov edi, 0x800000
  4553 00003BFC B00A                <2> 		mov al, 10
  4554 00003BFE B307                <2> 		mov bl, 7
  4555 00003C00 B404                <2> 		mov ah, 4
  4556 00003C02 CD30                <2> 		int 30h
  4557 00003C04 8935[DD3B0000]      <2> 		mov [esicache2], esi
  4558 00003C0A 8A0E                <2> 		mov cl, [esi]
  4559 00003C0C 8B35[D93B0000]      <2> 		mov esi, [esicache3]
  4560 00003C12 BB[463C0000]        <2> 		mov ebx, exitword
  4561 00003C17 E869F4FFFF          <2> 		call cndtest
  4562 00003C1C 3C01                <2> 		cmp al, 1
  4563 00003C1E 7411                <2> 		je endbatchcreate
  4564 00003C20 3C02                <2> 		cmp al, 2
  4565 00003C22 740D                <2> 		je endbatchcreate
  4566 00003C24 8B35[DD3B0000]      <2> 		mov esi, [esicache2]
  4567 00003C2A B00A                <2> 		mov al, 10
  4568 00003C2C 8806                <2> 		mov [esi], al
  4569 00003C2E 46                  <2> 		inc esi
  4570 00003C2F EBC0                <2> 		jmp batchcreate
  4571                              <2> 	endbatchcreate:
  4572 00003C31 8B35[D93B0000]      <2> 		mov esi, [esicache3]
  4573 00003C37 31C0                <2> 		xor eax, eax
  4574 00003C39 8806                <2> 		mov [esi], al
  4575 00003C3B BE00004000          <2> 		mov esi, 0x400000
  4576 00003C40 E89FE6FFFF          <2> 		call print
  4577 00003C45 C3                  <2> 		ret
  4578                              <2> 	
  4579 00003C46 5C7800              <2> 	exitword db "\x",0
  4580 00003C49 54797065205C782074- <2> 	wordmsg db "Type \x to exit.",10,0
  4581 00003C52 6F20657869742E0A00  <2>
  4582                              <1> %include 'source/programs/beep.asm'
  4583 00003C5B FF2C6265657000      <2> 	db 255,44,"beep",0
  4584 00003C62 B8[873C0000]        <2> 	mov eax, beepstart
  4585 00003C67 A3[41060000]        <2> 	mov [soundpos], eax
  4586 00003C6C B8[8B3C0000]        <2> 	mov eax, beepend
  4587 00003C71 A3[45060000]        <2> 	mov [soundendpos], eax
  4588 00003C76 C605[3E060000]01    <2> 	mov byte [soundon], 1
  4589                              <2> waitforsoundendbeep:
  4590 00003C7D A0[3E060000]        <2> 	mov al, [soundon]
  4591 00003C82 3C00                <2> 	cmp al, 0
  4592 00003C84 75F7                <2> 	jne waitforsoundendbeep
  4593 00003C86 C3                  <2> 	ret
  4594                              <2> 	
  4595                              <2> beepstart:
  4596 00003C87 3200D111            <2> 	dw 50, 4561
  4597                              <2> beepend:
  4598                              <1> %include 'source/programs/charmap.asm'
  4599 00003C8B FF2C636861727300    <2> db 255,44,"chars",0
  4600 00003C93 66BB0700            <2> 	mov bx, 7
  4601 00003C97 B020                <2> 	mov al, " "
  4602 00003C99 E82AEBFFFF          <2> 	call prcharq
  4603 00003C9E E825EBFFFF          <2> 	call prcharq
  4604 00003CA3 E820EBFFFF          <2> 	call prcharq
  4605 00003CA8 E81BEBFFFF          <2> 	call prcharq
  4606 00003CAD B030                <2> 	mov al, "0"
  4607                              <2> charmapnumprnt:
  4608 00003CAF E814EBFFFF          <2> 	call prcharq
  4609 00003CB4 FEC0                <2> 	inc al
  4610 00003CB6 6650                <2> 	push ax
  4611 00003CB8 B020                <2> 	mov al, " "
  4612 00003CBA E809EBFFFF          <2> 	call prcharq
  4613 00003CBF 6658                <2> 	pop ax
  4614 00003CC1 3C39                <2> 	cmp al, "9"
  4615 00003CC3 76EA                <2> 	jbe charmapnumprnt
  4616 00003CC5 B041                <2> 	mov al, "A"
  4617                              <2> charmapnumprnt2:
  4618 00003CC7 E8FCEAFFFF          <2> 	call prcharq
  4619 00003CCC FEC0                <2> 	inc al
  4620 00003CCE 6650                <2> 	push ax
  4621 00003CD0 B020                <2> 	mov al, " "
  4622 00003CD2 E8F1EAFFFF          <2> 	call prcharq
  4623 00003CD7 6658                <2> 	pop ax
  4624 00003CD9 3C47                <2> 	cmp al, "G"
  4625 00003CDB 72EA                <2> 	jb charmapnumprnt2
  4626                              <2> 	
  4627 00003CDD BE[74780000]        <2> 	mov esi, line
  4628 00003CE2 E8EBE5FFFF          <2> 	call printquiet
  4629 00003CE7 6631C0              <2> 	xor ax, ax
  4630 00003CEA 88C1                <2> 	mov cl, al
  4631 00003CEC E8A7F5FFFF          <2> 	call showhexsmall
  4632 00003CF1 E951000000          <2> 	jmp charmapnocopy ;the first char is 0 which is unprintable
  4633                              <2> charmapcopy:
  4634 00003CF6 FEC0                <2> 	inc al
  4635 00003CF8 6650                <2> 	push ax
  4636 00003CFA 3C08                <2> 	cmp al, 8
  4637 00003CFC 7449                <2> 	je charmapnocopy
  4638 00003CFE 3C09                <2> 	cmp al, 9
  4639 00003D00 7445                <2> 	je charmapnocopy
  4640 00003D02 3C0A                <2> 	cmp al, 10
  4641 00003D04 7441                <2> 	je charmapnocopy
  4642 00003D06 3C0D                <2> 	cmp al, 13
  4643 00003D08 743D                <2> 	je charmapnocopy
  4644 00003D0A 3CFF                <2> 	cmp al, 255
  4645 00003D0C 7439                <2> 	je charmapnocopy
  4646 00003D0E 3C00                <2> 	cmp al, 0
  4647 00003D10 7434                <2> 	je nomorecharmap
  4648 00003D12 E8B1EAFFFF          <2> 	call prcharq
  4649 00003D17 B020                <2> 	mov al, " "
  4650 00003D19 E8AAEAFFFF          <2> 	call prcharq
  4651 00003D1E 6658                <2> 	pop ax
  4652                              <2> charmapcopycheck:
  4653 00003D20 FEC4                <2> 	inc ah
  4654 00003D22 80FC10              <2> 	cmp ah, 16
  4655 00003D25 72CF                <2> 	jb charmapcopy
  4656 00003D27 6650                <2> 	push ax
  4657 00003D29 BE[74780000]        <2> 	mov esi, line
  4658 00003D2E E89FE5FFFF          <2> 	call printquiet
  4659 00003D33 6658                <2> 	pop ax
  4660 00003D35 3CFF                <2> 	cmp al, 255
  4661 00003D37 740D                <2> 	je nomorecharmap
  4662 00003D39 88C1                <2> 	mov cl, al
  4663 00003D3B FEC1                <2> 	inc cl
  4664 00003D3D E856F5FFFF          <2> 	call showhexsmall
  4665 00003D42 30E4                <2> 	xor ah, ah
  4666 00003D44 EBB0                <2> 	jmp charmapcopy
  4667                              <2> nomorecharmap:
  4668 00003D46 C3                  <2> 	ret
  4669                              <2> charmapnocopy:
  4670 00003D47 6650                <2> 	push ax
  4671 00003D49 B020                <2> 	mov al, " "
  4672 00003D4B E878EAFFFF          <2> 	call prcharq
  4673 00003D50 E873EAFFFF          <2> 	call prcharq
  4674 00003D55 6658                <2> 	pop ax
  4675 00003D57 EBC7                <2> 	jmp charmapcopycheck
  4676                              <1> %include 'source/programs/clear.asm'
  4677 00003D59 FF2C636C65617200    <2> db 255,44,"clear",0
  4678 00003D61 E802E6FFFF          <2> 		call clear
  4679 00003D66 C3                  <2> 		ret 
  4680                              <1> %include 'source/programs/cpuid.asm'
  4681 00003D67 FF2C637075696400    <2> db 255,44,"cpuid",0
  4682 00003D6F 31C0                <2> 	xor eax, eax
  4683 00003D71 0FA2                <2> 	cpuid
  4684 00003D73 891D[C43D0000]      <2> 	mov [cpuidbuf], ebx
  4685 00003D79 8915[C83D0000]      <2> 	mov [cpuidbuf + 4], edx
  4686 00003D7F 890D[CC3D0000]      <2> 	mov [cpuidbuf + 8], ecx
  4687 00003D85 BE[C43D0000]        <2> 	mov esi, cpuidbuf
  4688 00003D8A E855E5FFFF          <2> 	call print
  4689 00003D8F BE[74780000]        <2> 	mov esi, line
  4690 00003D94 E84BE5FFFF          <2> 	call print
  4691 00003D99 B801000000          <2> 	mov eax, 1
  4692 00003D9E 0FA2                <2> 	cpuid
  4693 00003DA0 89C1                <2> 	mov ecx, eax
  4694 00003DA2 C605[97320000]02    <2> 	mov byte [firsthexshown], 2
  4695 00003DA9 E8FEF4FFFF          <2> 	call showhex
  4696 00003DAE B808000080          <2> 	mov eax, 0x80000008
  4697 00003DB3 0FA2                <2> 	cpuid
  4698 00003DB5 89C1                <2> 	mov ecx, eax
  4699 00003DB7 C605[97320000]02    <2> 	mov byte [firsthexshown], 2
  4700 00003DBE E8E9F4FFFF          <2> 	call showhex
  4701 00003DC3 C3                  <2> 	ret
  4702                              <2> 	
  4703 00003DC4 00<rept>            <2> cpuidbuf times 13 db 0
  4704                              <2> cpuidvendorend:
  4705                              <1> %include 'source/programs/dos.asm'
  4706 00003DD1 FF2C646F7300        <2> db 255,44,"dos",0
  4707                              <2> rundosprog:
  4708 00003DD7 8B3D[46300000]      <2> 	mov edi, [currentcommandloc]
  4709 00003DDD 81C704000000        <2> 	add edi, 4
  4710 00003DE3 BE00014000          <2> 	mov esi,  0x100 + dosprogloc	;this should be the beginning of memory
  4711 00003DE8 E84D330000          <2> 	call loadfile
  4712 00003DED BF[8FB80000]        <2> 	mov edi, buftxt
  4713 00003DF2 81C704000000        <2> 	add edi, 4
  4714 00003DF8 81FA94010000        <2> 	cmp edx, 404
  4715 00003DFE 0F844B000000        <2> 	je near dosnoprogfound
  4716 00003E04 BB81004000          <2> 	mov ebx, 0x81 + dosprogloc
  4717 00003E09 31C9                <2> 	xor ecx, ecx
  4718                              <2> finddosparams:
  4719 00003E0B 47                  <2> 	inc edi
  4720 00003E0C 8A07                <2> 	mov al, [edi]
  4721 00003E0E 3C20                <2> 	cmp al, " "
  4722 00003E10 75F9                <2> 	jne finddosparams
  4723                              <2> copydosparams:
  4724 00003E12 8A07                <2> 	mov al, [edi]
  4725 00003E14 8803                <2> 	mov [ebx], al
  4726 00003E16 43                  <2> 	inc ebx
  4727 00003E17 47                  <2> 	inc edi
  4728 00003E18 41                  <2> 	inc ecx
  4729 00003E19 81FB00014000        <2> 	cmp ebx, 0x100 + dosprogloc
  4730 00003E1F 7304                <2> 	jae nomoredosparams
  4731 00003E21 3C00                <2> 	cmp al, 0
  4732 00003E23 75ED                <2> 	jne copydosparams
  4733                              <2> nomoredosparams:
  4734 00003E25 880D80004000        <2> 	mov [0x80 + dosprogloc], cl
  4735 00003E2B 66B84800            <2> 	mov ax, DOS_DATA_SEL
  4736 00003E2F 8ED8                <2> 	mov ds, ax
  4737 00003E31 8EC0                <2> 	mov es, ax
  4738 00003E33 8EE0                <2> 	mov fs, ax
  4739 00003E35 8EE8                <2> 	mov gs, ax
  4740 00003E37 31C0                <2> 	xor eax, eax
  4741 00003E39 31DB                <2> 	xor ebx, ebx
  4742 00003E3B 31C9                <2> 	xor ecx, ecx
  4743 00003E3D 31D2                <2> 	xor edx, edx
  4744 00003E3F 31FF                <2> 	xor edi, edi
  4745 00003E41 31F6                <2> 	xor esi, esi
  4746 00003E43 9A000100004000      <2> 	call DOS_CODE_SEL:0x100
  4747 00003E4A E94DEFFFFF          <2> 	jmp nwcmd
  4748                              <2> dosnoprogfound:
  4749 00003E4F BE[36780000]        <2> 	mov esi, notfound1
  4750 00003E54 E88BE4FFFF          <2> 	call print
  4751 00003E59 8B35[46300000]      <2> 	mov esi, [currentcommandloc]
  4752 00003E5F 81C604000000        <2> 	add esi, 4
  4753 00003E65 E87AE4FFFF          <2> 	call print
  4754 00003E6A BE[40780000]        <2> 	mov esi, notfound2
  4755 00003E6F E870E4FFFF          <2> 	call print
  4756 00003E74 E923EFFFFF          <2> 	jmp nwcmd
  4757                              <1> %include 'source/programs/dump.asm'
  4758 00003E79 FF2C64756D7000      <2> db 255,44,"dump",0
  4759 00003E80 8B35[46300000]      <2> 	mov esi, [currentcommandloc]
  4760 00003E86 81C605000000        <2> 	add esi, 5
  4761 00003E8C 31C9                <2> 	xor ecx, ecx
  4762 00003E8E 66B83078            <2> 	mov ax, "0x"
  4763 00003E92 663906              <2> 	cmp [esi], ax
  4764 00003E95 740A                <2> 	je dumphexin
  4765 00003E97 E89BF5FFFF          <2> 	call cnvrttxt
  4766 00003E9C E910000000          <2> 	jmp dumphexnow
  4767                              <2> dumphexin:
  4768 00003EA1 81C602000000        <2> 	add esi, 2
  4769 00003EA7 E850F5FFFF          <2> 	call cnvrthextxt
  4770 00003EAC E900000000          <2> 	jmp dumphexnow
  4771                              <2> dumphexnow:
  4772 00003EB1 89CF                <2> 	mov edi, ecx
  4773 00003EB3 89FE                <2> 	mov esi, edi
  4774 00003EB5 81C680030000        <2> 	add esi, 896
  4775                              <2> dumphexloop:
  4776 00003EBB 8B0F                <2> 	mov ecx, [edi]
  4777 00003EBD C605[97320000]05    <2> 	mov byte [firsthexshown],5
  4778 00003EC4 E8E3F3FFFF          <2> 	call showhex
  4779 00003EC9 81C704000000        <2> 	add edi, 4
  4780 00003ECF 39F7                <2> 	cmp edi, esi
  4781 00003ED1 72E8                <2> 	jb dumphexloop
  4782 00003ED3 E849EBFFFF          <2> 	call termcopy
  4783 00003ED8 C3                  <2> 	ret 
  4784                              <1> %include 'source/programs/echo.asm'
  4785                              <2> 
  4786 00003ED9 FF2C6563686F00      <2> db 255,44,"echo",0
  4787                              <2> 	echoprog:
  4788 00003EE0 8B35[46300000]      <2> 		mov esi, [currentcommandloc]
  4789 00003EE6 81C605000000        <2> 		add esi, 5
  4790 00003EEC 8A06                <2> 		mov al, [esi]
  4791 00003EEE E8F1E3FFFF          <2> 		call print
  4792 00003EF3 BE[74780000]        <2> 		mov esi, line
  4793 00003EF8 E8E7E3FFFF          <2> 		call print
  4794 00003EFD C3                  <2> 		ret
  4795 00003EFE BB[85A40000]        <2> 	echovr:	mov ebx, variables
  4796 00003F03 BF06000000          <2> 		mov edi, 6
  4797 00003F08 E83C000000          <2> 		call nxtvrech
  4798 00003F0D E954000000          <2> 		jmp prntvr2
  4799 00003F12 B13D                <2> 	echvar:	mov cl, '='
  4800 00003F14 43                  <2> 		inc ebx
  4801 00003F15 8A03                <2> 		mov al, [ebx]
  4802 00003F17 3C00                <2> 		cmp al, 0
  4803 00003F19 742E                <2> 		je nxtvrech
  4804 00003F1B 3C3D                <2> 		cmp al, '='
  4805 00003F1D 7422                <2> 		je nxtvrechb1
  4806 00003F1F 8B35[46300000]      <2> 		mov esi, [currentcommandloc]
  4807 00003F25 01FE                <2> 		add esi, edi
  4808 00003F27 E859F1FFFF          <2> 		call cndtest
  4809 00003F2C 3C02                <2> 		cmp al, 2
  4810 00003F2E 7432                <2> 		je prntvr
  4811 00003F30 3C01                <2> 		cmp al, 1
  4812 00003F32 742E                <2> 		je prntvr
  4813 00003F34 8B35[46300000]      <2> 		mov esi, [currentcommandloc]
  4814 00003F3A 01FE                <2> 		add esi, edi
  4815 00003F3C E908000000          <2> 		jmp nxtvrech
  4816                              <2> 	nxtvrechb1:
  4817 00003F41 81EB02000000        <2> 		sub ebx, 2
  4818 00003F47 EBC9                <2> 		jmp echvar
  4819 00003F49 8A03                <2> 	nxtvrech: mov al, [ebx]
  4820 00003F4B 3C05                <2> 		cmp al, 5
  4821 00003F4D 740A                <2> 		je nxtvrec2
  4822 00003F4F 43                  <2> 		inc ebx
  4823 00003F50 81FB[85B40000]      <2> 		cmp ebx, varend
  4824 00003F56 72F1                <2> 		jb nxtvrech
  4825 00003F58 C3                  <2> 		ret
  4826 00003F59 43                  <2> 	nxtvrec2: inc ebx
  4827 00003F5A 8A03                <2> 		mov al, [ebx]
  4828 00003F5C 3C04                <2> 		cmp al, 4
  4829 00003F5E 74B2                <2> 		je echvar
  4830 00003F60 EBE7                <2> 		jmp nxtvrech
  4831 00003F62 43                  <2> 	prntvr: inc ebx
  4832 00003F63 89DE                <2> 		mov esi, ebx
  4833 00003F65 C3                  <2> 		ret
  4834 00003F66 E879E3FFFF          <2> 	prntvr2: call print
  4835 00003F6B BE[74780000]        <2> 		mov esi, line
  4836 00003F70 E86FE3FFFF          <2> 		call print
  4837 00003F75 C3                  <2> 		ret 
  4838                              <1> %include 'source/programs/else.asm'
  4839 00003F76 FF2C656C736500      <2> 	db 255,44,"else",0
  4840 00003F7D 31C0                <2> elsecmd:	xor eax, eax
  4841 00003F7F 3805[7FA40000]      <2> 	cmp [BATCHISON], al
  4842 00003F85 0F84BFFBFFFF        <2> 	je near notbatch
  4843 00003F8B A0[16A40000]        <2> 	mov al, [IFON]
  4844 00003F90 BE[17A40000]        <2> 	mov esi, IFTRUE
  4845 00003F95 01C6                <2> 	add esi, eax
  4846 00003F97 8A06                <2> 	mov al, [esi]
  4847 00003F99 3401                <2> 	xor al, 1
  4848 00003F9B 8806                <2> 	mov [esi], al
  4849 00003F9D C3                  <2> 	ret 
  4850                              <1> %include 'source/programs/fi.asm'
  4851 00003F9E FF2C666900          <2> 	db 255,44,"fi",0
  4852 00003FA3 30C0                <2> 	xor al, al
  4853 00003FA5 3805[7FA40000]      <2> 	cmp [BATCHISON], al
  4854 00003FAB 0F8499FBFFFF        <2> 	je near notbatch
  4855 00003FB1 B001                <2> fi:	mov al, 1
  4856 00003FB3 2805[16A40000]      <2> 	sub [IFON],al
  4857 00003FB9 C3                  <2> 	ret 
  4858                              <1> %include 'source/programs/gui.asm'
  4859 00003FBA FF2C67756900        <2> db 255,44,"gui",0
  4860                              <2> guiswitcher:
  4861 00003FC0 E8A3E3FFFF          <2> 	call clear
  4862 00003FC5 66BB[4300]          <2> 	mov bx, guiswitch
  4863 00003FC9 66891D[C5100000]    <2> 	mov [realmodeptr], bx
  4864 00003FD0 BB[E03F0000]        <2> 	mov ebx, guiswitchret
  4865 00003FD5 891D[C1100000]      <2> 	mov [realmodereturn], ebx
  4866 00003FDB E9E3CFFFFF          <2> 	jmp realmode
  4867                              <2> guiswitchret:
  4868 00003FE0 BF[A9880000]        <2> 	mov edi, VBEMODEBLOCK
  4869                              <2> .loop
  4870 00003FE5 658B07              <2> 	mov eax, [gs:edi]
  4871 00003FE8 8907                <2> 	mov [edi], eax
  4872 00003FEA 47                  <2> 	inc edi
  4873 00003FEB 81FF[AC8B0000]      <2> 	cmp edi, VBEEND
  4874 00003FF1 72F2                <2> 	jb .loop
  4875 00003FF3 A1[D18A0000]        <2> 	mov eax, [physbaseptr]
  4876 00003FF8 2D00001000          <2> 	sub eax, 0x100000
  4877 00003FFD A3[D18A0000]        <2> 	mov [physbaseptr], eax
  4878 00004002 C605[C6270000]00    <2> 	mov byte [termguion], 0
  4879 00004009 BE[129D0000]        <2> 	mov esi, graphicstable
  4880 0000400E 30C0                <2> 	xor al, al
  4881                              <2> .clear
  4882 00004010 8806                <2> 	mov [esi], al
  4883 00004012 46                  <2> 	inc esi
  4884 00004013 81FE[129F0000]      <2> 	cmp esi, graphicstableend
  4885 00004019 72F5                <2> 	jb .clear
  4886 0000401B E9B2160000          <2> 	jmp gui
  4887                              <1> %include 'source/programs/help.asm'
  4888 00004020 FF2C68656C7000      <2> db 255,44,"help",0
  4889                              <2> lscmd:	
  4890 00004027 B00D                <2> 		mov al, 13
  4891 00004029 E89AE7FFFF          <2> 		call prcharq
  4892 0000402E BE[BA340000]        <2> 		mov esi, progstart
  4893 00004033 BB[864B0000]        <2> 		mov ebx, progend
  4894 00004038 BE[12A00000]        <2> dir:	mov esi, fileindex
  4895 0000403D 8A06                <2> 	dirnxt:	mov al, [esi]
  4896 0000403F 30E4                <2> 		xor ah, ah
  4897 00004041 3CFF                <2> 		cmp al, 255
  4898 00004043 7415                <2> 		je dirfnd
  4899 00004045 46                  <2> 		inc esi
  4900 00004046 81FE[12A40000]      <2> 		cmp esi,  fileindexend
  4901 0000404C 7339                <2> 		jae dirdn
  4902 0000404E EBED                <2> 		jmp dirnxt
  4903                              <2> 	dirfnd3:
  4904 00004050 46                  <2> 		inc esi
  4905 00004051 81FE[12A40000]      <2> 		cmp esi, fileindexend
  4906 00004057 76E4                <2> 		jbe dirnxt
  4907 00004059 4E                  <2> 		dec esi
  4908 0000405A 46                  <2> 	dirfnd:	inc esi
  4909 0000405B 8A06                <2> 		mov al, [esi]
  4910 0000405D 30E4                <2> 		xor ah, ah
  4911 0000405F 3C2C                <2> 		cmp al, 44
  4912 00004061 740B                <2> 		je dirfnd2
  4913 00004063 46                  <2> 		inc esi
  4914 00004064 81FE[12A40000]      <2> 		cmp esi,  fileindexend
  4915 0000406A 731B                <2> 		jae dirdn
  4916 0000406C EBCF                <2> 		jmp dirnxt
  4917 0000406E 46                  <2> 	dirfnd2: inc esi
  4918 0000406F E85EE2FFFF          <2> 		call printquiet
  4919 00004074 56                  <2> 		push esi
  4920 00004075 B009                <2> 		mov al, 9
  4921 00004077 E84CE7FFFF          <2> 		call prcharq
  4922 0000407C 5E                  <2> 		pop esi
  4923 0000407D 81FE[12A40000]      <2> 		cmp esi,  fileindexend
  4924 00004083 7302                <2> 		jae dirdn
  4925 00004085 EBB6                <2> 		jmp dirnxt
  4926 00004087 BE[74780000]        <2> 	dirdn:	mov esi, line
  4927 0000408C E853E2FFFF          <2> 			call print
  4928 00004091 C3                  <2> 			ret
  4929 00004092 00                  <2> currentdir db 0
  4930                              <1> %include 'source/programs/if.asm'
  4931 00004093 FF2C696600          <2> 	db 255,44,"if",0
  4932 00004098 30C0                <2> ifcmd:	xor al, al
  4933 0000409A 3805[7FA40000]      <2> 	cmp [BATCHISON], al
  4934 000040A0 0F84A4FAFFFF        <2> 	je near notbatch
  4935 000040A6 8B1D[46300000]      <2> 	mov ebx, [currentcommandloc]
  4936 000040AC 81C303000000        <2> 	add ebx, 3
  4937 000040B2 89DE                <2> 	mov esi, ebx
  4938 000040B4 8A06                <2> chkeqsn: mov al, [esi]
  4939 000040B6 3C00                <2> 	cmp al, 0
  4940 000040B8 0F848CFAFFFF        <2> 	je near notbatch
  4941 000040BE 3C3D                <2> 	cmp al, '='
  4942 000040C0 0F8403000000        <2> 	je near chkeqdn
  4943 000040C6 46                  <2> 	inc esi
  4944 000040C7 EBEB                <2> 	jmp chkeqsn
  4945 000040C9 B000                <2> chkeqdn: mov al, 0 
  4946 000040CB 8806                <2> 	mov [esi], al
  4947 000040CD 46                  <2> 	inc esi
  4948 000040CE E877EFFFFF          <2> 	call tester
  4949 000040D3 3C01                <2> 	cmp al, 1
  4950 000040D5 0F8405000000        <2> 	je near trueif
  4951 000040DB E91C000000          <2> 	jmp falseif
  4952 000040E0 31C0                <2> trueif:	xor eax, eax
  4953 000040E2 A0[16A40000]        <2> 	mov al, [IFON]
  4954 000040E7 FEC0                <2> 	inc al
  4955 000040E9 A2[16A40000]        <2> 	mov [IFON], al
  4956 000040EE 30E4                <2> 	xor ah, ah
  4957 000040F0 BE[17A40000]        <2> 	mov esi, IFTRUE
  4958 000040F5 01C6                <2> 	add esi, eax
  4959 000040F7 B401                <2> 	mov ah, 1
  4960 000040F9 8826                <2> 	mov [esi], ah
  4961 000040FB C3                  <2> 	ret 
  4962 000040FC 31C0                <2> falseif: xor eax, eax
  4963 000040FE A0[16A40000]        <2> 	mov al, [IFON]
  4964 00004103 FEC0                <2> 	inc al
  4965 00004105 A2[16A40000]        <2> 	mov [IFON], al
  4966 0000410A 30E4                <2> 	xor ah, ah
  4967 0000410C BE[17A40000]        <2> 	mov esi, IFTRUE
  4968 00004111 01C6                <2> 	add esi, eax
  4969 00004113 30E4                <2> 	xor ah, ah
  4970 00004115 8826                <2> 	mov [esi], ah
  4971 00004117 C3                  <2> 	ret 
  4972                              <1> %include 'source/programs/keycode.asm'
  4973 00004118 FF2C6B65797300      <2> db 255,44,"keys",0
  4974                              <2> keycode:
  4975 0000411F C605[AC270000]00    <2> 	mov byte [trans], 0
  4976 00004126 C605[3C720000]00    <2> 	mov byte [threadson], 0
  4977 0000412D E8C0110000          <2> 	call getkey
  4978 00004132 31C0                <2> 	xor eax, eax
  4979 00004134 31C9                <2> 	xor ecx, ecx
  4980 00004136 8A0D[D2520000]      <2> 	mov cl, [specialkey]
  4981 0000413C 80F900              <2> 	cmp cl, 0
  4982 0000413F 0F8405000000        <2> 	je near nospecialkeycode
  4983 00004145 E84EF1FFFF          <2> 	call showhexsmall
  4984                              <2> nospecialkeycode:
  4985 0000414A 66A1[AA270000]      <2> 	mov ax, [lastkey]
  4986 00004150 88E1                <2> 	mov cl, ah
  4987 00004152 E841F1FFFF          <2> 	call showhexsmall
  4988 00004157 80FC01              <2> 	cmp ah, 1
  4989 0000415A 75C3                <2> 	jne keycode
  4990 0000415C C3                  <2> 	ret 
  4991                              <1> %include 'source/programs/logout.asm'
  4992 0000415D FF2C6C6F676F757400  <2> 	db 255,44,"logout",0
  4993 00004166 E9EAEAFFFF          <2> 	jmp os
  4994                              <1> %include 'source/programs/loop.asm'
  4995 0000416B FF2C6C6F6F7000      <2> 	db 255,44,"loop",0
  4996 00004172 803D[80A40000]00    <2> 	cmp byte [LOOPON], 0
  4997 00004179 0F8501000000        <2> 	jne near filoop
  4998 0000417F C3                  <2> 	ret
  4999 00004180 8B35[81A40000]      <2> filoop: mov esi, [LOOPPOS]
  5000 00004186 FE0D[16A40000]      <2> 	dec byte [IFON]
  5001 0000418C C605[80A40000]00    <2> 	mov byte [LOOPON], 0
  5002 00004193 8935[7BA40000]      <2> 	mov [BATCHPOS], esi
  5003 00004199 8935[723A0000]      <2> 	mov [batchedi], esi
  5004 0000419F C3                  <2> 	ret 
  5005                              <1> %include 'source/programs/ls.asm'
  5006 000041A0 FF2C6C7300          <2> db 255,44,"ls",0
  5007 000041A5 BE[AC8B0000]        <2> 		mov esi, diskfileindex
  5008                              <2> 	diskindexdir:
  5009 000041AA 803E5F              <2> 		cmp byte [esi], '_'
  5010 000041AD 7440                <2> 		je nextdiskindexdir
  5011 000041AF E81EE1FFFF          <2> 		call printquiet
  5012 000041B4 56                  <2> 		push esi
  5013 000041B5 BE[0F420000]        <2> 		mov esi, disktab
  5014 000041BA E813E1FFFF          <2> 		call printquiet
  5015 000041BF 5E                  <2> 		pop esi
  5016 000041C0 8B4E05              <2> 		mov ecx, [esi + 5]
  5017 000041C3 C605[97320000]05    <2> 		mov byte [firsthexshown], 5
  5018 000041CA E894F1FFFF          <2> 		call showdec
  5019 000041CF 56                  <2> 		push esi
  5020 000041D0 BE[74780000]        <2> 		mov esi, line
  5021 000041D5 E8F8E0FFFF          <2> 		call printquiet
  5022 000041DA 5E                  <2> 		pop esi
  5023 000041DB 81C609000000        <2> 		add esi, 9
  5024 000041E1 81FE[128D0000]      <2> 		cmp esi, enddiskfileindex
  5025 000041E7 72C1                <2> 		jb diskindexdir
  5026 000041E9 E833E8FFFF          <2> 		call termcopy
  5027 000041EE C3                  <2> 		ret
  5028                              <2> 	nextdiskindexdir:
  5029 000041EF 46                  <2> 		inc esi
  5030 000041F0 803E00              <2> 		cmp byte [esi], 0
  5031 000041F3 75FA                <2> 		jne nextdiskindexdir
  5032 000041F5 81C609000000        <2> 		add esi, 9
  5033 000041FB 81FE[128D0000]      <2> 		cmp esi, enddiskfileindex
  5034 00004201 72A7                <2> 		jb diskindexdir
  5035 00004203 E819E8FFFF          <2> 		call termcopy
  5036 00004208 C3                  <2> 		ret
  5037                              <2> 		
  5038 00004209 4469736B2000        <2> 		diskmsg db "Disk ",0
  5039 0000420F 0D09090900          <2> 		disktab db 13,9,9,9,0
  5040                              <1> %include 'source/programs/memory.asm'
  5041 00004214 FF2C6D656D6F727900  <2> db 255,44,"memory",0
  5042 0000421D BE[30020000]        <2> 	mov esi, memlistbuf
  5043 00004222 31FF                <2> 	xor edi, edi
  5044 00004224 668B3D[70040000]    <2> 	mov di, [memlistend]
  5045 0000422B 01F7                <2> 	add edi, esi
  5046                              <2> printmemmap:
  5047 0000422D 8B0E                <2> 	mov ecx, [esi]
  5048 0000422F E878F0FFFF          <2> 	call showhex
  5049 00004234 81C608000000        <2> 	add esi, 8
  5050 0000423A 8B0E                <2> 	mov ecx, [esi]
  5051 0000423C E86BF0FFFF          <2> 	call showhex
  5052 00004241 81C608000000        <2> 	add esi, 8
  5053 00004247 8B0E                <2> 	mov ecx, [esi]
  5054 00004249 E85EF0FFFF          <2> 	call showhex
  5055 0000424E 81C608000000        <2> 	add esi, 8
  5056 00004254 57                  <2> 	push edi
  5057 00004255 56                  <2> 	push esi
  5058 00004256 BE[74780000]        <2> 	mov esi, line
  5059 0000425B E884E0FFFF          <2> 	call print
  5060 00004260 5E                  <2> 	pop esi
  5061 00004261 5F                  <2> 	pop edi
  5062 00004262 39FE                <2> 	cmp esi, edi
  5063 00004264 72C7                <2> 	jb printmemmap
  5064 00004266 C3                  <2> 	ret
  5065                              <2> 	
  5066                              <1> %include 'source/programs/pci.asm'
  5067 00004267 FF2C70636900        <2> db 255,44,"pci",0
  5068 0000426D E85B2C0000          <2> 	call pcidump
  5069 00004272 C3                  <2> 	ret 
  5070                              <1> %include 'source/programs/play.asm'
  5071 00004273 FF2C706C617900      <2> db 255,44,"play",0
  5072 0000427A E801000000          <2> 	call playsync
  5073 0000427F C3                  <2> 	ret
  5074                              <2> playsync:
  5075 00004280 8B3D[46300000]      <2> 	mov edi, [currentcommandloc]
  5076 00004286 81C705000000        <2> 	add edi, 5
  5077 0000428C BE00004000          <2> 	mov esi, 0x400000
  5078 00004291 E8A42E0000          <2> 	call loadfile
  5079 00004296 81FA94010000        <2> 	cmp edx, 404
  5080 0000429C 7448                <2> 	je nosoundfound
  5081 0000429E BB00004000          <2> 	mov ebx, 0x400000
  5082 000042A3 817B0857415645      <2> 	cmp dword [ebx + 8], "WAVE"
  5083 000042AA 0F84B8000000        <2> 	je near wave_player
  5084 000042B0 66813B534E          <2> 	cmp word [ebx], "SN"
  5085 000042B5 752F                <2> 	jne nosoundfound
  5086 000042B7 81C306000000        <2> 	add ebx, 6
  5087 000042BD 891D[41060000]      <2> 	mov [soundpos], ebx
  5088 000042C3 035BFC              <2> 	add ebx, [ebx - 4]
  5089 000042C6 891D[45060000]      <2> 	mov [soundendpos], ebx
  5090 000042CC 66C705[3F060000]00- <2> 	mov word [soundrepititions], 0
  5091 000042D4 00                  <2>
  5092 000042D5 C605[3E060000]01    <2> 	mov byte [soundon], 1
  5093                              <2> waitforsoundendplay:
  5094 000042DC A0[3E060000]        <2> 	mov al, [soundon]
  5095 000042E1 3C00                <2> 	cmp al, 0
  5096 000042E3 75F7                <2> 	jne waitforsoundendplay
  5097 000042E5 C3                  <2> 	ret
  5098                              <2> nosoundfound:
  5099 000042E6 BE[0C430000]        <2> 	mov esi, notfoundsound
  5100 000042EB E8F4DFFFFF          <2> 	call print
  5101 000042F0 8B35[46300000]      <2> 	mov esi, [currentcommandloc]
  5102 000042F6 81C605000000        <2> 	add esi, 5
  5103 000042FC E8E3DFFFFF          <2> 	call print
  5104 00004301 BE[40780000]        <2> 	mov esi, notfound2
  5105 00004306 E8D9DFFFFF          <2> 	call print
  5106 0000430B C3                  <2> 	ret
  5107 0000430C 536F756E64202200    <2> notfoundsound db "Sound ",34,0
  5108                              <2> 
  5109                              <2> sbplay:
  5110 00004314 BE00004000          <2> 		mov esi, 0x400000
  5111 00004319 89F3                <2> 		mov ebx, esi
  5112 0000431B 81C62C000000        <2> 		add esi, 44
  5113 00004321 29F7                <2> 		sub edi, esi
  5114 00004323 66893D[024E0000]    <2> 		mov [Length1], di
  5115 0000432A C1EF10              <2> 		shr edi, 16
  5116 0000432D 66893D[004E0000]    <2> 		mov [Length0], di
  5117 00004334 8B4B18              <2> 		mov ecx, [ebx + 24]
  5118 00004337 890D[0D4E0000]      <2> 		mov [Freq], ecx
  5119 0000433D 31C0                <2> 		xor eax, eax
  5120 0000433F BA00004000          <2> 		mov	edx, 0x400000 ;location of sound
  5121 00004344 81C200080000        <2> 		add edx, 2048
  5122 0000434A 01D0                <2> 		add	eax,edx
  5123 0000434C 31DB                <2> 		xor ebx, ebx
  5124 0000434E 668B1D[024E0000]    <2> 		mov bx, [Length1]
  5125 00004355 01C3                <2> 		add ebx, eax
  5126 00004357 891D[044E0000]      <2> 		mov [NextMemLoc], ebx
  5127 0000435D A3[084E0000]        <2> 		mov	[MemLoc],eax
  5128 00004362 E873090000          <2> 		call DMAPlay
  5129 00004367 C3                  <2> 		ret
  5130                              <2> 
  5131                              <2> wave_player:
  5132 00004368 803D[124E0000]01    <2> 	cmp byte [SoundBlaster], 1
  5133 0000436F 0F849FFFFFFF        <2> 	je near sbplay
  5134 00004375 BE00004000          <2> 	mov esi, 0x400000
  5135 0000437A 8B4E18              <2> 	mov ecx, [esi + 24]
  5136 0000437D 66890D[49060000]    <2> 	mov [WAVSamplingRate], cx
  5137 00004384 29F7                <2> 	sub edi, esi
  5138 00004386 81EF2C000000        <2> 	sub edi, 44
  5139 0000438C 893D[4B060000]      <2> 	mov [WAVFileSize], edi
  5140                              <2> 	;MASK ALL INTS EXCEPT IRQ 0
  5141 00004392 B0FE                <2> 	mov al, 0xFE
  5142 00004394 E621                <2> 	out 0x21, al
  5143 00004396 FEC0                <2> 	inc al
  5144 00004398 E6A1                <2> 	out 0xA1, al
  5145 0000439A B020                <2> 	mov al, 0x20
  5146 0000439C E6A0                <2> 	out 0xA0, al
  5147 0000439E E620                <2> 	out 0x20, al
  5148                              <2> 	;SET PIT DIVISOR
  5149 000043A0 31D2                <2> 	xor edx, edx
  5150 000043A2 8B4E18              <2> 	mov ecx, [esi + 24]
  5151 000043A5 B8DE341200          <2> 	mov eax, 1193182
  5152 000043AA F7F1                <2> 	div ecx ;al should be the proper sample divisor
  5153 000043AC E640                <2> 	out 0x40, al
  5154 000043AE 66C1C008            <2> 	rol ax, 8
  5155 000043B2 E640                <2> 	out 0x40, al
  5156                              <2> 	;GET WAVEDIV
  5157 000043B4 668B1D[49060000]    <2> 	mov bx, [WAVSamplingRate]
  5158 000043BB 66B8DD34            <2> 	mov ax,0x34dd	; The sound lasts until NoSound is called
  5159 000043BF 66BA1200            <2> 	mov dx,0x0012             
  5160 000043C3 66F7F3              <2> 	div bx               
  5161 000043C6 66A3[4F4C0000]      <2> 	mov [WAVEDIV],ax
  5162                              <2> 	;PLAY WAVE
  5163 000043CC 81C62C000000        <2> 	add esi, 44
  5164 000043D2 0335[23060000]      <2> 	add esi, [newcodecache]
  5165 000043D8 E81D000000          <2> 	call PlayWAV
  5166                              <2> 	;UNMASK ALL INTS
  5167 000043DD 30C0                <2> 	xor al, al
  5168 000043DF E621                <2> 	out 0x21, al
  5169 000043E1 30C0                <2> 	xor al, al
  5170 000043E3 E6A1                <2> 	out 0xA1, al
  5171 000043E5 B020                <2> 	mov al, 0x20
  5172 000043E7 E6A0                <2> 	out 0xA0, al
  5173 000043E9 E620                <2> 	out 0x20, al
  5174                              <2> 	;RESET PIT DIVISOR
  5175 000043EB 66A1[30060000]      <2> 	mov ax, [pitdiv]
  5176 000043F1 E640                <2> 	out 0x40, al
  5177 000043F3 66C1C008            <2> 	rol ax, 8
  5178 000043F7 E640                <2> 	out 0x40, al
  5179 000043F9 C3                  <2> 	ret
  5180                              <2> 	
  5181                              <2> PlayWAV:
  5182 000043FA 8B0D[4B060000]      <2>    mov ecx,[WAVFileSize]                         ;Sets the loop point
  5183 00004400 C605[4F060000]01    <2>    mov byte [EnableDigitized],1	;Tells the irq0 handler to process the routines
  5184                              <2> Play_Repeat:
  5185 00004407 8A06                <2>    mov al, [esi]	;Loads a byte from ESI to AL
  5186 00004409 F4                  <2>    hlt	;Wait for IRQ to fire
  5187 0000440A E2FB                <2>    loop Play_Repeat	;and the whole procedure is looped ECX times
  5188 0000440C C605[4F060000]00    <2>    mov byte [EnableDigitized],0	;Tells the irq0 handler to disable the digitized functions
  5189 00004413 E857080000          <2>    call Sound_Off	;Turn the speaker off just in case
  5190 00004418 C3                  <2>    ret
  5191                              <2>    
  5192                              <1> %include 'source/programs/reboot.asm'
  5193 00004419 FF2C7265626F6F7400  <2> 	db 255,44,"reboot",0
  5194 00004422 0F011D[2C440000]    <2> 		lidt [idtreboot]
  5195 00004429 CD00                <2> 		int 0
  5196 0000442B F4                  <2> 		hlt
  5197                              <2> 	
  5198 0000442C 0000                <2> 	idtreboot dw 0
  5199 0000442E 00000000            <2> 			  dd 0
  5200                              <2> 
  5201                              <2> 	coldboot:
  5202 00004432 66B84000            <2> 		MOV AX, 0040h
  5203 00004436 8EC0                <2> 		MOV ES, AX
  5204 00004438 2666C7057200000000- <2> 		MOV WORD [ES:00072h], 0h
  5205 00004441 00                  <2>
  5206 00004442 EA00000000FFFF      <2> 		JMP 0FFFFh:0000h
  5207 00004449 CF                  <2> 		IRET
  5208                              <2> 
  5209                              <2> 	warmboot:
  5210 0000444A 66B84000            <2> 		MOV AX, 0040h
  5211 0000444E 8EC0                <2> 		MOV ES, AX
  5212 00004450 2666C7057200000034- <2> 		MOV WORD [ES:00072h], 01234h
  5213 00004459 12                  <2>
  5214 0000445A EA00000000FFFF      <2> 		JMP 0FFFFh:0000h
  5215 00004461 CF                  <2> 		IRET
  5216                              <2> 		
  5217                              <1> %include 'source/programs/reg.asm'
  5218 00004462 FF2C72656700        <2> db 255,44,"reg",0
  5219 00004468 CD03                <2> 	int 3
  5220 0000446A C3                  <2> 	ret 
  5221                              <1> %include 'source/programs/rmode.asm'
  5222 0000446B FF2C726D6F646500    <2> db 255,44,"rmode",0
  5223 00004473 66BB[8E44]          <2> 	mov bx, rmodetest
  5224 00004477 66891D[C5100000]    <2> 	mov [realmodeptr], bx
  5225 0000447E BB[264B0000]        <2> 	mov ebx, waitkey
  5226 00004483 891D[C1100000]      <2> 	mov [realmodereturn], ebx
  5227 00004489 E935CBFFFF          <2> 	jmp realmode
  5228                              <2> [BITS 16]
  5229                              <2> rmodetest:
  5230 0000448E BE[A044]            <2> 	mov si, rmodestr
  5231 00004491 31DB                <2> 	xor bx, bx
  5232                              <2> rmodeprnt:
  5233 00004493 AC                  <2> 	lodsb
  5234 00004494 08C0                <2> 	or al, al
  5235 00004496 7407                <2> 	jz .done
  5236 00004498 B40E                <2> 	mov ah, 0xE
  5237 0000449A 43                  <2> 	inc bx
  5238 0000449B CD10                <2> 	int 0x10
  5239 0000449D EBF4                <2> 	jmp rmodeprnt
  5240 0000449F C3                  <2> .done: ret
  5241                              <2> 
  5242 000044A0 48656C6C6F2066726F- <2> rmodestr db "Hello from real mode!",10,13,"Goodbye!",10,13,0
  5243 000044A9 6D207265616C206D6F- <2>
  5244 000044B2 6465210A0D476F6F64- <2>
  5245 000044BB 627965210A0D00      <2>
  5246                              <2> [BITS 32]
  5247                              <1> %include 'source/programs/show.asm'
  5248 000044C2 FF2C73686F7700      <2> db 255,44,"show",0
  5249 000044C9 8B3D[46300000]      <2> 		mov edi, [currentcommandloc]
  5250 000044CF 81C705000000        <2> 		add edi, 5
  5251 000044D5 BE00004000          <2> 		mov esi, 0x400000
  5252 000044DA E85B2C0000          <2> 		call loadfile
  5253 000044DF 81FA94010000        <2> 		cmp edx, 404
  5254 000044E5 0F849E000000        <2> 		je near filenotfound
  5255 000044EB BE00004000          <2> 		mov esi, 0x400000
  5256 000044F0 66813E424D          <2> 		cmp word [esi], "BM"
  5257 000044F5 7410                <2> 		je bmpfound
  5258 000044F7 E8E8DDFFFF          <2> 		call print
  5259 000044FC BE[74780000]        <2> 		mov esi, line
  5260 00004501 E8DEDDFFFF          <2> 		call print
  5261 00004506 C3                  <2> 		ret
  5262                              <2> bmpfound:
  5263 00004507 803D[AB8B0000]00    <2> 		cmp byte [guion], 0
  5264 0000450E 0F8443000000        <2> 		je near noguibmp
  5265 00004514 BE00004000          <2> 		mov esi, 0x400000
  5266 00004519 31C9                <2> 		xor ecx, ecx
  5267 0000451B 31D2                <2> 		xor edx, edx
  5268 0000451D 31C0                <2> 		xor eax, eax
  5269 0000451F 31DB                <2> 		xor ebx, ebx
  5270 00004521 E804240000          <2> 		call showbmp
  5271 00004526 30C0                <2> 		xor al, al
  5272 00004528 B405                <2> 		mov ah, 5
  5273 0000452A CD30                <2> 		int 30h
  5274 0000452C E862110000          <2> 		call guiclear
  5275 00004531 E8CF120000          <2> 		call clearmousecursor
  5276 00004536 E82F190000          <2> 		call reloadallgraphics
  5277 0000453B 8B35[46300000]      <2> 		mov esi, [currentcommandloc]
  5278 00004541 81C605000000        <2> 		add esi, 5
  5279 00004547 E898DDFFFF          <2> 		call print
  5280 0000454C BE[DE450000]        <2> 		mov esi, loadedbmpmsg
  5281 00004551 E88EDDFFFF          <2> 		call print
  5282 00004556 C3                  <2> 		ret
  5283                              <2> noguibmp:
  5284 00004557 BE[62450000]        <2> 		mov esi, warnguibmp
  5285 0000455C E883DDFFFF          <2> 		call print
  5286 00004561 C3                  <2> 		ret
  5287 00004562 546869732063616E20- <2> warnguibmp db "This can not be done without the gui.",10,0
  5288 0000456B 6E6F7420626520646F- <2>
  5289 00004574 6E6520776974686F75- <2>
  5290 0000457D 742074686520677569- <2>
  5291 00004586 2E0A00              <2>
  5292                              <2> 
  5293                              <2> filenotfound:
  5294 00004589 BE[BC450000]        <2> 		mov esi, filenf
  5295 0000458E E851DDFFFF          <2> 		call print
  5296 00004593 8B35[46300000]      <2> 		mov esi, [currentcommandloc]
  5297                              <2> findfilenotfoundzero:
  5298 00004599 8A06                <2> 		mov al, [esi]
  5299 0000459B 46                  <2> 		inc esi
  5300 0000459C 3C00                <2> 		cmp al, 0
  5301 0000459E 7411                <2> 		je nofilenamenotfound
  5302 000045A0 81FE[8FBC0000]      <2> 		cmp esi, buftxtend
  5303 000045A6 7309                <2> 		jae nofilenamenotfound
  5304 000045A8 3C20                <2> 		cmp al, " "
  5305 000045AA 75ED                <2> 		jne findfilenotfoundzero
  5306 000045AC E833DDFFFF          <2> 		call print
  5307                              <2> nofilenamenotfound:
  5308 000045B1 BE[C7450000]        <2> 		mov esi, filenf2
  5309 000045B6 E829DDFFFF          <2> 		call print
  5310 000045BB C3                  <2> 		ret
  5311 000045BC 5468652066696C6520- <2> filenf db "The file ",34,0
  5312 000045C5 2200                <2>
  5313 000045C7 2220636F756C64206E- <2> filenf2 db 34," could not be found.",10,0
  5314 000045D0 6F7420626520666F75- <2>
  5315 000045D9 6E642E0A00          <2>
  5316                              <2> 		
  5317 000045DE 206C6F616465642E0A- <2> loadedbmpmsg db " loaded.",10,0
  5318 000045E7 00                  <2>
  5319                              <1> %include 'source/programs/shush.asm'
  5320 000045E8 FF2C736875736800    <2> db 255,44,"shush",0
  5321 000045F0 BE[FB450000]        <2> 	mov esi, shushmsg
  5322 000045F5 E8EADCFFFF          <2> 	call print
  5323 000045FA C3                  <2> 	ret
  5324 000045FB 57656C636F6D652074- <2> 	shushmsg db "Welcome to the SollerOS Hardly Unix-Compatible Shell!",10,0
  5325 00004604 6F2074686520536F6C- <2>
  5326 0000460D 6C65724F5320486172- <2>
  5327 00004616 646C7920556E69782D- <2>
  5328 0000461F 436F6D70617469626C- <2>
  5329 00004628 65205368656C6C210A- <2>
  5330 00004631 00                  <2>
  5331                              <1> %include 'source/programs/stop.asm'
  5332 00004632 FF2C73746F7000      <2> 	db 255,44,"stop",0
  5333 00004639 30C0                <2> stop:	xor al, al
  5334 0000463B A2[7FA40000]        <2> 	mov [BATCHISON], al
  5335 00004640 A2[16A40000]        <2> 	mov [IFON], al
  5336 00004645 A2[17A40000]        <2> 	mov [IFTRUE], al
  5337 0000464A A2[80A40000]        <2> 	mov [LOOPON], al
  5338 0000464F C3                  <2> 	ret 
  5339                              <1> %include 'source/programs/system.asm'
  5340 00004650 FF2C73797374656D00  <2> 	db 255,44,"system",0
  5341 00004659 BE[13470000]        <2> 	mov esi, systeminfomsg
  5342 0000465E E86FDCFFFF          <2> 	call printquiet
  5343 00004663 B9[AC8B0000]        <2> 	mov ecx, osend
  5344 00004668 C1E90A              <2> 	shr ecx, 10
  5345 0000466B E8F3ECFFFF          <2> 	call showdec
  5346 00004670 BE[28470000]        <2> 	mov esi, diskbytemsg
  5347 00004675 E858DCFFFF          <2> 	call printquiet
  5348 0000467A B9[AC8B0000]        <2> 	mov ecx, osend
  5349 0000467F 81C1[2C6F0100]      <2> 	add ecx, commandbufend
  5350 00004685 81E9[128D0000]      <2> 	sub ecx, bssstart	;add the extra buffer space
  5351 0000468B C1E90A              <2> 	shr ecx, 10
  5352 0000468E E8D0ECFFFF          <2> 	call showdec
  5353 00004693 BE[3C470000]        <2> 	mov esi, membytemsg
  5354 00004698 E835DCFFFF          <2> 	call printquiet
  5355                              <2> getcpuspeed:
  5356 0000469D B8FE000000          <2> 	mov eax, 0xFE
  5357 000046A2 E621                <2> 	out 0x21, al ;mask off all but timer interrupt
  5358 000046A4 B020                <2> 	mov al, 0x20
  5359 000046A6 E620                <2> 	out 0x20, al
  5360 000046A8 31C0                <2> 	xor eax, eax
  5361 000046AA F4                  <2> 	hlt
  5362 000046AB C605[27060000]01    <2> 	mov byte [testingcpuspeed], 1
  5363                              <2> cpuspeedloop:	;wait until next timer interrupt, then inc eax until the next
  5364 000046B2 40                  <2> 	inc eax
  5365 000046B3 EBFD                <2> 	jmp cpuspeedloop
  5366                              <2> cpuspeedloopend:
  5367 000046B5 31C0                <2> 	xor eax, eax
  5368 000046B7 E621                <2> 	out 0x21, al
  5369 000046B9 B020                <2> 	mov al, 0x20
  5370 000046BB E620                <2> 	out 0x20, al
  5371 000046BD 31D2                <2> 	xor edx, edx
  5372 000046BF 31C0                <2> 	xor eax, eax
  5373 000046C1 A1[28060000]        <2> 	mov eax, [cpuspeedperint]
  5374 000046C6 8B1D[3A060000]      <2> 	mov ebx, [timeinterval]
  5375 000046CC C1EB0A              <2> 	shr ebx, 10 ;divide the interval by 1024
  5376 000046CF F7F3                <2> 	div ebx	;quotient in eax, remainder in edx
  5377 000046D1 89C1                <2> 	mov ecx, eax
  5378 000046D3 E88BECFFFF          <2> 	call showdec
  5379 000046D8 BE[7E470000]        <2> 	mov esi, cpuspeedmsg
  5380 000046DD E8F0DBFFFF          <2> 	call printquiet
  5381 000046E2 8B0D[2C060000]      <2> 	mov ecx, [memoryspace]
  5382 000046E8 C1E914              <2> 	shr ecx, 20
  5383 000046EB 41                  <2> 	inc ecx	;the reading is one MB behind
  5384 000046EC E872ECFFFF          <2> 	call showdec
  5385 000046F1 BE[84470000]        <2> 	mov esi, memoryspacemsg
  5386 000046F6 E8E9DBFFFF          <2> 	call print
  5387 000046FB 803D[124E0000]00    <2> 	cmp byte [SoundBlaster], 0
  5388 00004702 0F8494E6FFFF        <2> 	je near nwcmd
  5389 00004708 BE[66470000]        <2> 	mov esi, soundblastermsg
  5390 0000470D E8D2DBFFFF          <2> 	call print
  5391 00004712 C3                  <2> 	ret
  5392                              <2> 
  5393 00004713 4B65726E656C20496E- <2> systeminfomsg db "Kernel Information:",10,0
  5394 0000471C 666F726D6174696F6E- <2>
  5395 00004725 3A0A00              <2>
  5396 00004728 4B42204469736B2053- <2> diskbytemsg db "KB Disk Space Used",10,0
  5397 00004731 706163652055736564- <2>
  5398 0000473A 0A00                <2>
  5399 0000473C 4B42204D656D6F7279- <2> membytemsg db "KB Memory Space Used",10,"System Information:",10,0
  5400 00004745 205370616365205573- <2>
  5401 0000474E 65640A53797374656D- <2>
  5402 00004757 20496E666F726D6174- <2>
  5403 00004760 696F6E3A0A00        <2>
  5404 00004766 536F756E64626C6173- <2> soundblastermsg db "Soundblaster Detected.",10,0
  5405 0000476F 746572204465746563- <2>
  5406 00004778 7465642E0A00        <2>
  5407 0000477E 4D4950530A00        <2> cpuspeedmsg db "MIPS",10,0
  5408 00004784 4D42204D656D6F7279- <2> memoryspacemsg db "MB Memory Space Free",10,0
  5409 0000478D 205370616365204672- <2>
  5410 00004796 65650A00            <2>
  5411                              <1> %include 'source/programs/thread.asm'
  5412 0000479A FF2C74687265616400  <2> db 255,44,"thread",0
  5413 000047A3 E96D2A0000          <2> 	jmp threadstarttest
  5414                              <1> %include 'source/programs/time.asm'
  5415 000047A8 082E30303030303030- <2> timenscache db 8,".000000000"
  5416 000047B1 3030                <2>
  5417 000047B3 200A00              <2> timenscacheend: db " ",10,0
  5418 000047B6 00                  <2> istimeset db 0
  5419 000047B7 456E74657220746865- <2> settimemsg db "Enter the current UNIX time:",10,0
  5420 000047C0 2063757272656E7420- <2>
  5421 000047C9 554E49582074696D65- <2>
  5422 000047D2 3A0A00              <2>
  5423 000047D5 00<rept>            <2> timeinputbuffer times 12 db 0
  5424 000047E1 00                  <2> timeinputbend: db 0
  5425                              <2> 
  5426 000047E2 FF2C74696D6500      <2> db 255,44,"time",0
  5427 000047E9 803D[B6470000]00    <2> 	cmp byte [istimeset], 0
  5428 000047F0 753A                <2> 	jne timeisset
  5429 000047F2 BE[B7470000]        <2> 	mov esi, settimemsg
  5430 000047F7 E8E8DAFFFF          <2> 	call print
  5431 000047FC BE[D5470000]        <2> 	mov esi, timeinputbuffer
  5432 00004801 BF[E1470000]        <2> 	mov edi, timeinputbend
  5433 00004806 E8DDDBFFFF          <2> 	call readline
  5434 0000480B BE[D5470000]        <2> 	mov esi, timeinputbuffer
  5435 00004810 31FF                <2> 	xor edi, edi
  5436 00004812 E820ECFFFF          <2> 	call cnvrttxt
  5437 00004817 890D[32060000]      <2> 	mov [timeseconds], ecx
  5438 0000481D 31C9                <2> 	xor ecx, ecx
  5439 0000481F 890D[36060000]      <2> 	mov [timenanoseconds], ecx
  5440 00004825 C605[B6470000]01    <2> 	mov byte [istimeset], 1
  5441                              <2> timeisset:
  5442 0000482C 8B0D[32060000]      <2> 	mov ecx, [timeseconds]
  5443 00004832 E82CEBFFFF          <2> 	call showdec
  5444                              <2> 	
  5445 00004837 8B0D[36060000]      <2> 	mov ecx, [timenanoseconds]
  5446 0000483D BE[A8470000]        <2> 	mov esi, timenscache
  5447 00004842 C7460230303030      <2> 	mov dword [esi+ 2], "0000"
  5448 00004849 C7460630303030      <2> 	mov dword [esi + 6], "0000"
  5449 00004850 C6460A30            <2> 	mov byte [esi + 10], "0"
  5450 00004854 BE[B3470000]        <2> 	mov esi, timenscacheend
  5451 00004859 E8BCE8FFFF          <2> 	call convert
  5452 0000485E BE[A8470000]        <2> 	mov esi, timenscache
  5453 00004863 E87CDAFFFF          <2> 	call print
  5454                              <2> 	
  5455 00004868 E80F000000          <2> 	call time
  5456 0000486D BE[484A0000]        <2> 	mov esi, timeshow
  5457 00004872 E86DDAFFFF          <2> 	call print
  5458 00004877 E9BC000000          <2> 	jmp findday
  5459                              <2> time:
  5460 0000487C E84F010000          <2> 	call tstackput1
  5461 00004881 B00A                <2> 	mov al,10			;Get RTC register A
  5462 00004883 E879010000          <2> 	call tget1
  5463 00004888 A880                <2> 	test al,0x80			;Is update in progress?
  5464 0000488A 75F0                <2> 	jne time				; yes, wait
  5465                              <2> 
  5466 0000488C B000                <2> 	mov al,0			;Get seconds (00 to 59)
  5467 0000488E E86E010000          <2> 	call tget1
  5468 00004893 A2[3F4A0000]        <2> 	mov [RTCtimeSecond],al
  5469                              <2> 
  5470 00004898 B002                <2> 	mov al,0x02			;Get minutes (00 to 59)
  5471 0000489A E862010000          <2> 	call tget1
  5472 0000489F A2[404A0000]        <2> 	mov [RTCtimeMinute],al
  5473                              <2> 
  5474 000048A4 B004                <2> 	mov al,0x04			;Get hours (see notes)
  5475 000048A6 E856010000          <2> 	call tget1
  5476 000048AB A2[414A0000]        <2> 	mov [RTCtimeHour],al
  5477                              <2> 
  5478 000048B0 B007                <2> 	mov al,0x07			;Get day of month (01 to 31)
  5479 000048B2 E84A010000          <2> 	call tget1
  5480 000048B7 A2[424A0000]        <2> 	mov [RTCtimeDay],al
  5481                              <2> 
  5482 000048BC B008                <2> 	mov al,0x08			;Get month (01 to 12)
  5483 000048BE E83E010000          <2> 	call tget1
  5484 000048C3 A2[434A0000]        <2> 	mov [RTCtimeMonth],al
  5485                              <2> 
  5486 000048C8 B009                <2> 	mov al,0x09			;Get year (00 to 99)
  5487 000048CA E832010000          <2> 	call tget1
  5488 000048CF A2[444A0000]        <2> 	mov [RTCtimeYear],al
  5489                              <2> 	
  5490 000048D4 BE[484A0000]        <2> 	mov esi, timeshow
  5491 000048D9 8A2D[414A0000]      <2> 	mov ch, [RTCtimeHour]
  5492 000048DF E828010000          <2> 	call tput1
  5493 000048E4 8A2D[404A0000]      <2> 	mov ch, [RTCtimeMinute]
  5494 000048EA E81D010000          <2> 	call tput1
  5495 000048EF 8A2D[3F4A0000]      <2> 	mov ch, [RTCtimeSecond]
  5496 000048F5 E812010000          <2> 	call tput1
  5497 000048FA BE[514A0000]        <2> 	mov esi, dateshow
  5498 000048FF 8A2D[434A0000]      <2> 	mov ch, [RTCtimeMonth]
  5499 00004905 E802010000          <2> 	call tput1
  5500 0000490A 8A2D[424A0000]      <2> 	mov ch, [RTCtimeDay]
  5501 00004910 E8F7000000          <2> 	call tput1
  5502 00004915 B520                <2> 	mov ch, 0x20
  5503 00004917 E8F0000000          <2> 	call tput1
  5504 0000491C 4E                  <2> 	dec esi
  5505 0000491D 8A2D[444A0000]      <2> 	mov ch, [RTCtimeYear]
  5506 00004923 E8E4000000          <2> 	call tput1
  5507 00004928 E8BD000000          <2> 	call tstackget1
  5508 0000492D C3                  <2> 	ret
  5509 0000492E BE[484A0000]        <2> 	mov esi, timeshow
  5510 00004933 E8ACD9FFFF          <2> 	call print
  5511                              <2> ;;get day of week
  5512                              <2> ;;add these:
  5513                              <2> ;;century value
  5514                              <2> ;;last 2 digits of year
  5515                              <2> ;;last 2 digits of year right shifted twice
  5516                              <2> ;;month table value
  5517                              <2> ;;day of the month
  5518                              <2> ;;divide these by 7
  5519                              <2> ;;the remainder is the day
  5520                              <2> findday:
  5521 00004938 31C0                <2> 	xor eax, eax
  5522                              <2> ;;first convert the values from BCD to hex
  5523 0000493A A0[424A0000]        <2> 	mov al, [RTCtimeDay]
  5524 0000493F E873000000          <2> 	call converttohex
  5525 00004944 8825[454A0000]      <2> 	mov [dayhex], ah
  5526 0000494A A0[434A0000]        <2> 	mov al, [RTCtimeMonth]
  5527 0000494F E863000000          <2> 	call converttohex
  5528 00004954 8825[464A0000]      <2> 	mov [monthhex], ah
  5529 0000495A A0[444A0000]        <2> 	mov al, [RTCtimeYear]
  5530 0000495F E853000000          <2> 	call converttohex
  5531 00004964 8825[474A0000]      <2> 	mov [yearhex], ah
  5532 0000496A 31C0                <2> 	xor eax, eax
  5533 0000496C A0[474A0000]        <2> 	mov al, [yearhex]
  5534 00004971 C0E802              <2> 	shr al, 2
  5535 00004974 0205[474A0000]      <2> 	add al, [yearhex]
  5536 0000497A 0506000000          <2> 	add eax, 6
  5537 0000497F 31DB                <2> 	xor ebx, ebx
  5538 00004981 8A1D[464A0000]      <2> 	mov bl, [monthhex]
  5539 00004987 FECB                <2> 	dec bl
  5540 00004989 81C3[664A0000]      <2> 	add ebx, month
  5541 0000498F 31C9                <2> 	xor ecx, ecx
  5542 00004991 8A0B                <2> 	mov cl, [ebx]
  5543 00004993 01C8                <2> 	add eax, ecx
  5544 00004995 8A0D[454A0000]      <2> 	mov cl, [dayhex]
  5545 0000499B 01C8                <2> 	add eax, ecx
  5546 0000499D 66BB0700            <2> 	mov bx, 7
  5547 000049A1 31D2                <2> 	xor edx, edx
  5548 000049A3 66F7F3              <2> 	div bx
  5549 000049A6 C1E202              <2> 	shl edx, 2
  5550 000049A9 81C2[724A0000]      <2> 	add edx, day
  5551 000049AF 8B32                <2> 	mov esi, [edx]
  5552 000049B1 E82ED9FFFF          <2> 	call print
  5553 000049B6 C3                  <2> 	ret
  5554                              <2> 	
  5555                              <2> converttohex:
  5556 000049B7 88C4                <2> 	mov ah, al
  5557 000049B9 C0E804              <2> 	shr al, 4
  5558 000049BC C0E404              <2> 	shl ah, 4
  5559 000049BF C0EC04              <2> 	shr ah, 4
  5560 000049C2 3C00                <2> 	cmp al, 0
  5561 000049C4 7409                <2> 	je noconverttohex
  5562                              <2> converttohexlp:
  5563 000049C6 80C40A              <2> 	add ah, 10
  5564 000049C9 FEC8                <2> 	dec al
  5565 000049CB 3C00                <2> 	cmp al, 0
  5566 000049CD 75F7                <2> 	jne converttohexlp
  5567                              <2> noconverttohex:
  5568 000049CF C3                  <2> 	ret
  5569                              <2> 	
  5570                              <2> tstackput1:
  5571 000049D0 8935[3B4A0000]      <2> 	mov [tstack + 20], esi
  5572 000049D6 BE[274A0000]        <2> 	mov esi, tstack
  5573 000049DB 8906                <2> 	mov [esi], eax
  5574 000049DD 895E04              <2> 	mov [esi + 4], ebx
  5575 000049E0 894E08              <2> 	mov [esi + 8], ecx
  5576 000049E3 89560C              <2> 	mov [esi + 12], edx
  5577 000049E6 897E10              <2> 	mov [esi + 16], edi
  5578 000049E9 C3                  <2> 	ret
  5579                              <2> 	
  5580                              <2> tstackget1:
  5581 000049EA BE[274A0000]        <2> 	mov esi, tstack
  5582 000049EF 8B06                <2> 	mov eax, [esi]
  5583 000049F1 8B5E04              <2> 	mov ebx, [esi + 4]
  5584 000049F4 8B4E08              <2> 	mov ecx, [esi + 8]
  5585 000049F7 8B560C              <2> 	mov edx, [esi + 12]
  5586 000049FA 8B7E10              <2> 	mov edi, [esi + 16]
  5587 000049FD 8B7614              <2> 	mov esi, [esi + 20]
  5588 00004A00 C3                  <2> 	ret
  5589                              <2> 	
  5590                              <2> tget1:
  5591 00004A01 66BA7000            <2> 	mov dx, 0x70
  5592 00004A05 EE                  <2> 	out dx, al
  5593 00004A06 6642                <2> 	inc dx
  5594 00004A08 EC                  <2> 	in al, dx
  5595 00004A09 664A                <2> 	dec dx
  5596 00004A0B C3                  <2> 	ret
  5597                              <2> 	
  5598                              <2> tput1:
  5599 00004A0C 66C1E904            <2> 	shr cx, 4
  5600 00004A10 B030                <2> 	mov al, 48
  5601 00004A12 00E8                <2> 	add al, ch
  5602 00004A14 8806                <2> 	mov [esi], al
  5603 00004A16 46                  <2> 	inc esi
  5604 00004A17 B030                <2> 	mov al, 48
  5605 00004A19 C0E904              <2> 	shr cl, 4
  5606 00004A1C 00C8                <2> 	add al, cl
  5607 00004A1E 8806                <2> 	mov [esi], al
  5608 00004A20 81C602000000        <2> 	add esi, 2
  5609 00004A26 C3                  <2> 	ret
  5610                              <2> 		
  5611 00004A27 000000000000000000- <2> 	tstack dd 0,0,0,0,0,0
  5612 00004A30 000000000000000000- <2>
  5613 00004A39 000000000000        <2>
  5614 00004A3F 00                  <2> 	RTCtimeSecond db 0
  5615 00004A40 00                  <2> 	RTCtimeMinute db 0
  5616 00004A41 00                  <2> 	RTCtimeHour db 0
  5617 00004A42 00                  <2> 	RTCtimeDay db 0
  5618 00004A43 00                  <2> 	RTCtimeMonth db 0
  5619 00004A44 00                  <2> 	RTCtimeYear db 0
  5620 00004A45 00                  <2> 	dayhex db 0
  5621 00004A46 00                  <2> 	monthhex db 0
  5622 00004A47 00                  <2> 	yearhex db 0
  5623 00004A48 30303A30303A30300A  <2> 	timeshow db "00:00:00",10
  5624 00004A51 30302D30302D303030- <2> 	dateshow db "00-00-0000",10,0
  5625 00004A5A 300A00              <2>
  5626                              <2> 	oldcentury:	;;from 1700 to 1900
  5627 00004A5D 040200              <2> 	db 4,2,0
  5628                              <2> 	century:	;;from 2000 to 2500
  5629 00004A60 060402000604        <2> 	db 6,4,2,0,6,4
  5630                              <2> 	month:
  5631 00004A66 000303060104060205- <2> 	db 0,3,3,6,1,4,6,2,5,0,3,5
  5632 00004A6F 000305              <2>
  5633                              <2> 	day:
  5634 00004A72 [8E4A0000]          <2> 	dd sunday
  5635 00004A76 [964A0000]          <2> 	dd monday
  5636 00004A7A [9E4A0000]          <2> 	dd tuesday
  5637 00004A7E [A74A0000]          <2> 	dd wednesday
  5638 00004A82 [B24A0000]          <2> 	dd thursday
  5639 00004A86 [BC4A0000]          <2> 	dd friday
  5640 00004A8A [C44A0000]          <2> 	dd saturday
  5641                              <2> sunday:
  5642 00004A8E 53756E6461790A00    <2> 	db "Sunday",10,0
  5643                              <2> monday:
  5644 00004A96 4D6F6E6461790A00    <2> 	db "Monday",10,0
  5645                              <2> tuesday:
  5646 00004A9E 547565736461790A00  <2> 	db "Tuesday",10,0
  5647                              <2> wednesday:
  5648 00004AA7 5765646E6573646179- <2> 	db "Wednesday",10,0
  5649 00004AB0 0A00                <2>
  5650                              <2> thursday:
  5651 00004AB2 54687572736461790A- <2> 	db "Thursday",10,0
  5652 00004ABB 00                  <2>
  5653                              <2> friday:
  5654 00004ABC 4672696461790A00    <2> 	db "Friday",10,0
  5655                              <2> saturday:
  5656 00004AC4 53617475726461790A- <2> 	db "Saturday",10,0
  5657 00004ACD 00                  <2>
  5658                              <1> %include 'source/programs/turnoff.asm'
  5659 00004ACE FF2C7475726E6F6666- <2> 	db 255,44,"turnoff",0
  5660 00004AD7 00                  <2>
  5661 00004AD8 66BB[F34A]          <2> 			mov bx, shutdown
  5662 00004ADC 66891D[C5100000]    <2> 			mov [realmodeptr], bx
  5663 00004AE3 BB[1D4B0000]        <2> 			mov ebx, halt
  5664 00004AE8 891D[C1100000]      <2> 			mov [realmodereturn], ebx
  5665 00004AEE E9D0C4FFFF          <2> 			jmp realmode
  5666                              <2> 
  5667                              <2> [BITS 16]
  5668                              <2> 		shutdown:
  5669 00004AF3 B453                <2> 			mov ah, 0x53
  5670 00004AF5 B004                <2> 			mov al, 4
  5671 00004AF7 31DB                <2> 			xor bx, bx
  5672 00004AF9 CD15                <2> 			int 0x15
  5673                              <2> 			
  5674 00004AFB B453                <2> 			mov ah, 0x53
  5675 00004AFD B001                <2> 			mov al, 1
  5676 00004AFF 31DB                <2> 			xor bx, bx
  5677 00004B01 CD15                <2> 			int 0x15
  5678                              <2> 			
  5679 00004B03 B453                <2> 			mov ah, 0x53
  5680 00004B05 B008                <2> 			mov al, 8
  5681 00004B07 BB0100              <2> 			mov bx, 1
  5682 00004B0A B90100              <2> 			mov cx, 1
  5683 00004B0D CD15                <2> 			int 0x15
  5684                              <2> 			
  5685 00004B0F B453                <2> 			mov ah, 0x53
  5686 00004B11 B007                <2> 			mov al, 7
  5687 00004B13 BB0100              <2> 			mov bx, 1
  5688 00004B16 B90300              <2> 			mov cx, 3
  5689 00004B19 CD15                <2> 			int 0x15
  5690 00004B1B EBFE                <2> 			jmp $
  5691                              <2> 			[BITS 32]
  5692 00004B1D EBFE                <2> halt: jmp $
  5693                              <1> %include 'source/programs/wait.asm'
  5694 00004B1F FF2C7761697400      <2> db 255,44,"wait",0
  5695                              <2> waitkey:
  5696 00004B26 E839DCFFFF          <2> 		call getchar
  5697 00004B2B C3                  <2> 		ret
  5698                              <1> %include 'source/programs/while.asm'
  5699 00004B2C FF2C7768696C6500    <2> db 255,44,"while",0
  5700 00004B34 30C0                <2> whilecmd:  xor al, al
  5701 00004B36 3805[7FA40000]      <2> 	cmp [BATCHISON], al
  5702 00004B3C 0F8408F0FFFF        <2> 	je near notbatch
  5703 00004B42 8B35[7BA40000]      <2> 	mov esi, [BATCHPOS]
  5704 00004B48 81EE02000000        <2> 	sub esi, 2
  5705 00004B4E 4E                  <2> whilefnd: dec esi
  5706 00004B4F 8A06                <2> 	mov al, [esi]
  5707 00004B51 3C0A                <2> 	cmp al, 10
  5708 00004B53 0F840A000000        <2> 	je near whilefnd2
  5709 00004B59 3C00                <2> 	cmp al, 0
  5710 00004B5B 0F8402000000        <2> 	je near whilefnd2
  5711 00004B61 EBEB                <2> 	jmp whilefnd
  5712                              <2> whilefnd2:
  5713 00004B63 46                  <2> 	inc esi
  5714 00004B64 8935[81A40000]      <2> 	mov [LOOPPOS], esi
  5715 00004B6A C605[80A40000]01    <2> 	mov BYTE [LOOPON], 1
  5716 00004B71 BE[8FB80000]        <2> 	mov esi, buftxt
  5717 00004B76 BB[8FB80000]        <2> 	mov ebx, buftxt
  5718 00004B7B 81C306000000        <2> 	add ebx, 6
  5719 00004B81 E92EF5FFFF          <2> 	jmp chkeqsn
  5720                              <1> progend:		;programs end here	
  5721                              <1> batchprogend:
  5722                                  	%include 'source/hardware.asm'
  5723                              <1> %include "source/drivers/sound/pcspkr.asm"
  5724                              <2> ;PC Speaker Drivers
  5725                              <2> PCSpeakerPWM:
  5726 00004B86 3C90                <2> 	cmp al,0x90	;If the byte taken from the memory is less than 80h,
  5727                              <2> 				;turn off the speaker to prevent "unwanted" sounds,
  5728 00004B88 720A                <2> 	jb TurnOffBeeper	;like: ASCII strings (e.g. "WAVEfmt" signature etc).
  5729 00004B8A E8C2000000          <2> 	call Sound_On
  5730 00004B8F E905000000          <2> 	jmp Sound_Done
  5731                              <2> TurnOffBeeper:
  5732 00004B94 E8D6000000          <2> 	call Sound_Off
  5733                              <2> Sound_Done:
  5734 00004B99 46                  <2> 	inc esi	;Increment ESI to load the next byte
  5735 00004B9A E900BBFFFF          <2> 	jmp keyinterrupt
  5736                              <2> 
  5737                              <2> PCSpeakerRAW:
  5738 00004B9F 60                  <2> 	pusha
  5739                              <2> nosoundrep:
  5740 00004BA0 8B35[41060000]      <2> 	mov esi, [soundpos]
  5741 00004BA6 31C9                <2> 	xor ecx, ecx
  5742 00004BA8 668B0D[3F060000]    <2> 	mov cx, [soundrepititions]
  5743 00004BAF 6681F90000          <2> 	cmp cx, 0
  5744 00004BB4 0F8548000000        <2> 	jne near donesetpitch
  5745 00004BBA 668B0E              <2> 	mov cx, [esi]
  5746 00004BBD 668B5E02            <2> 	mov bx, [esi + 2]
  5747 00004BC1 66890D[3F060000]    <2> 	mov [soundrepititions], cx
  5748 00004BC8 81C604000000        <2> 	add esi, 4
  5749 00004BCE 8935[41060000]      <2> 	mov [soundpos], esi
  5750 00004BD4 3B35[45060000]      <2> 	cmp esi, [soundendpos]
  5751 00004BDA 7735                <2> 	ja stopsound
  5752 00004BDC 66813D[3F060000]00- <2> 	cmp word [soundrepititions], 0
  5753 00004BE4 00                  <2>
  5754 00004BE5 74B9                <2> 	je nosoundrep
  5755 00004BE7 6681FB0000          <2> 	cmp bx, 0
  5756 00004BEC 740F                <2> 	je nosoundplay
  5757 00004BEE E840000000          <2> 	call setpitch
  5758 00004BF3 E849000000          <2> 	call startsound
  5759 00004BF8 E905000000          <2> 	jmp donesetpitch
  5760                              <2> nosoundplay:
  5761 00004BFD E846000000          <2> 	call killsound
  5762                              <2> donesetpitch:
  5763 00004C02 6649                <2> 	dec cx
  5764 00004C04 66890D[3F060000]    <2> 	mov [soundrepititions], cx
  5765 00004C0B 61                  <2> 	popa
  5766 00004C0C E981BAFFFF          <2> 	jmp timerinterrupt
  5767                              <2> stopsound:
  5768 00004C11 31C0                <2> 	xor eax, eax
  5769 00004C13 66A3[3F060000]      <2> 	mov [soundrepititions], ax
  5770 00004C19 A2[3E060000]        <2> 	mov [soundon], al
  5771 00004C1E A3[41060000]        <2> 	mov [soundpos], eax
  5772 00004C23 A3[45060000]        <2> 	mov [soundendpos], eax
  5773 00004C28 E81B000000          <2> 	call killsound
  5774 00004C2D 61                  <2> 	popa
  5775 00004C2E E95FBAFFFF          <2> 	jmp timerinterrupt
  5776                              <2> 
  5777                              <2> 
  5778                              <2> setpitch:
  5779 00004C33 B0B6                <2> 	mov al, 0xB6
  5780 00004C35 E643                <2> 	out 0x43, al
  5781 00004C37 6689D8              <2> 	mov ax, bx
  5782 00004C3A E642                <2> 	out 0x42, al
  5783 00004C3C 88E0                <2> 	mov al, ah
  5784 00004C3E E642                <2> 	out 0x42, al
  5785 00004C40 C3                  <2> 	ret
  5786                              <2> startsound:
  5787 00004C41 E461                <2> 	in al, 0x61
  5788 00004C43 0C03                <2> 	or al, 3
  5789 00004C45 E661                <2> 	out 0x61, al
  5790 00004C47 C3                  <2> 	ret
  5791                              <2> killsound:
  5792 00004C48 E461                <2> 	in al, 0x61
  5793 00004C4A 24FC                <2> 	and al, 0xFC
  5794 00004C4C E661                <2> 	out 0x61, al
  5795 00004C4E C3                  <2> 	ret
  5796                              <2> 	
  5797                              <2> ;this is code that I got from
  5798                              <2> ;http://forum.osdev.org/viewtopic.php?f=13&t=17293
  5799                              <2> ;that plays wave files
  5800 00004C4F 0000                <2> WAVEDIV dw 0
  5801                              <2> 
  5802                              <2> Sound_On:	; A routine to make sounds with BX = frequency in Hz
  5803 00004C51 668B1D[4F4C0000]    <2>    mov bx, [WAVEDIV]
  5804 00004C58 E461                <2>    in al,0x61
  5805 00004C5A A803                <2>    test al,3
  5806 00004C5C 7508                <2>    jnz A99               
  5807 00004C5E 0C03                <2>    or al,3	;Turn on the speaker itself
  5808 00004C60 E661                <2>    out 0x61,al               
  5809 00004C62 B0B6                <2>    mov al,0xb6
  5810 00004C64 E643                <2>    out 0x43,al
  5811                              <2> A99:   
  5812 00004C66 88D8                <2>    mov al,bl
  5813 00004C68 E642                <2>    out 0x42,al             
  5814 00004C6A 88F8                <2>    mov al,bh
  5815 00004C6C E642                <2>    out 0x42,al
  5816                              <2> Done1:
  5817 00004C6E C3                  <2>    ret
  5818                              <2> 
  5819                              <2> Sound_Off:
  5820 00004C6F E461                <2>    in al,0x61                 
  5821 00004C71 24FC                <2>    and al,11111100b                               ;Turn off the speaker
  5822 00004C73 E661                <2>    out 0x61,al
  5823 00004C75 C3                  <2>    ret
  5824                              <1> %include "source/drivers/sound/sblaster.asm"
  5825                              <2> ;Sound Blaster Drivers
  5826                              <2> sblaster:
  5827                              <2> .init:
  5828 00004C76 E842010000          <2> 		call ResetDSP			;If the system is Sound Blaster 16 compatible, reset the DSP
  5829 00004C7B A2[124E0000]        <2> 		mov [SoundBlaster], al	;if the reset worked, show an available card
  5830 00004C80 3C00                <2> 		cmp al, 0
  5831 00004C82 740E                <2> 		je .noinit
  5832 00004C84 B0D1                <2> 		mov	al,0D1h 		; turn speaker(s) on
  5833 00004C86 E866010000          <2> 		call WriteDSP
  5834 00004C8B B088                <2> 		mov	al,088h 		; Left = 8, Right = 8 (15-highest)
  5835 00004C8D E81C010000          <2> 		call MstrVol 		; L = Hi Nibble, R = Lo Nibble
  5836                              <2> .noinit:
  5837 00004C92 C3                  <2> 		ret
  5838                              <2> sblastercont: ;this function goes to the next available portion of a sound, if necessary
  5839 00004C93 66813D[004E0000]00- <2> 	cmp word [Length0], 0
  5840 00004C9B 00                  <2>
  5841 00004C9C 0F84BCBAFFFF        <2> 	je near handled2
  5842 00004CA2 668B3D[004E0000]    <2> 	mov di, [Length0]
  5843 00004CA9 664F                <2> 	dec di
  5844 00004CAB 66893D[004E0000]    <2> 	mov [Length0], di
  5845 00004CB2 A1[044E0000]        <2> 	mov eax, [NextMemLoc]
  5846 00004CB7 A3[084E0000]        <2> 	mov [MemLoc], eax
  5847 00004CBC 31C9                <2> 	xor ecx, ecx
  5848 00004CBE 66B9FFFF            <2> 	mov cx, 0xFFFF
  5849 00004CC2 66890D[024E0000]    <2> 	mov [Length1], cx
  5850 00004CC9 01C8                <2> 	add eax, ecx
  5851 00004CCB A3[044E0000]        <2> 	mov [NextMemLoc], eax
  5852 00004CD0 E805000000          <2> 	call DMAPlay
  5853 00004CD5 E984BAFFFF          <2> 	jmp handled2 ;it is part of an interrupt routine
  5854                              <2> 
  5855                              <2> DMAPlay:    ;uses eax ebx edx
  5856 00004CDA 66FF0D[024E0000]    <2> 		dec	word [Length1]
  5857 00004CE1 C605[0C4E0000]00    <2> 		mov	byte [Page1],00h
  5858                              <2> 
  5859 00004CE8 B005                <2> 		mov	al,(Channel+4)
  5860 00004CEA 66BA0A00            <2> 		mov	dx,0Ah
  5861 00004CEE EE                  <2> 		out	dx,al
  5862 00004CEF 30C0                <2> 		xor	al,al
  5863 00004CF1 66BA0C00            <2> 		mov	dx,0Ch
  5864 00004CF5 EE                  <2> 		out	dx,al
  5865 00004CF6 B049                <2> 		mov	al,ModeReg
  5866 00004CF8 66BA0B00            <2> 		mov	dx,0Bh
  5867 00004CFC EE                  <2> 		out	dx,al
  5868 00004CFD A1[084E0000]        <2> 		mov	eax,[MemLoc]
  5869 00004D02 66BA0200            <2> 		mov	dx,AddPort
  5870 00004D06 EE                  <2> 		out	dx,al
  5871 00004D07 86C4                <2> 		xchg al,ah
  5872 00004D09 EE                  <2> 		out	dx,al
  5873 00004D0A A1[084E0000]        <2> 		mov	eax,[MemLoc]
  5874 00004D0F 89C2                <2> 		mov	edx,eax
  5875 00004D11 2500000100          <2> 		and	eax,65536
  5876 00004D16 7406                <2> 		jz	MemLocN1
  5877 00004D18 FE05[0C4E0000]      <2> 		inc	byte [Page1]
  5878                              <2> MemLocN1:
  5879 00004D1E 89D0                <2> 		mov	eax,edx
  5880 00004D20 2500000200          <2> 		and	eax,131072
  5881 00004D25 7407                <2> 		jz	MemLocN2
  5882 00004D27 8005[0C4E0000]02    <2> 		add	byte [Page1],02
  5883                              <2> MemLocN2:
  5884 00004D2E 89D0                <2> 		mov	eax,edx
  5885 00004D30 2500000400          <2> 		and	eax,262144
  5886 00004D35 7407                <2> 		jz	MemLocN3
  5887 00004D37 8005[0C4E0000]04    <2> 		add	byte [Page1],04
  5888                              <2> MemLocN3:
  5889 00004D3E 89D0                <2> 		mov	eax,edx
  5890 00004D40 2500000800          <2> 		and	eax,524288
  5891 00004D45 7407                <2> 		jz	MemLocN4
  5892 00004D47 8005[0C4E0000]08    <2> 		add	byte [Page1],08
  5893                              <2> MemLocN4:
  5894 00004D4E 66BA8300            <2> 		mov	dx,PgPort
  5895 00004D52 A0[0C4E0000]        <2> 		mov	al,[Page1]
  5896 00004D57 EE                  <2> 		out	dx,al
  5897 00004D58 66BA0300            <2> 		mov	dx,LenPort
  5898 00004D5C 66A1[024E0000]      <2> 		mov	ax,[Length1]
  5899 00004D62 EE                  <2> 		out	dx,al
  5900 00004D63 86C4                <2> 		xchg al,ah
  5901 00004D65 EE                  <2> 		out	dx,al
  5902 00004D66 66BA0A00            <2> 		mov	dx,0Ah
  5903 00004D6A B001                <2> 		mov	al,Channel
  5904 00004D6C EE                  <2> 		out	dx,al
  5905                              <2> 		
  5906 00004D6D B040                <2> 		mov	al,40h
  5907 00004D6F E87D000000          <2> 		call WriteDSP
  5908 00004D74 31D2                <2> 		xor	edx,edx
  5909 00004D76 B840420F00          <2> 		mov	eax,1000000
  5910 00004D7B 8B1D[0D4E0000]      <2> 		mov	ebx,[Freq]
  5911 00004D81 F7F3                <2> 		div	ebx
  5912 00004D83 89C3                <2> 		mov	ebx,eax
  5913 00004D85 B800010000          <2> 		mov	eax,256
  5914 00004D8A 29D8                <2> 		sub	eax,ebx
  5915 00004D8C E860000000          <2> 		call WriteDSP
  5916 00004D91 A0[114E0000]        <2> 		mov	al,[WAVEMode]	;write the mode
  5917 00004D96 E856000000          <2> 		call WriteDSP
  5918 00004D9B 66A1[024E0000]      <2> 		mov	ax,[Length1]
  5919 00004DA1 E84B000000          <2> 		call WriteDSP
  5920 00004DA6 86C4                <2> 		xchg al,ah
  5921 00004DA8 E844000000          <2> 		call WriteDSP
  5922 00004DAD C3                  <2> 		ret
  5923                              <2> 
  5924                              <2> MstrVol:    ;uses ax dx
  5925 00004DAE 6650                <2> 	   push ax
  5926 00004DB0 66BA2402            <2> 	   mov	dx,(BasePort+4)
  5927 00004DB4 B022                <2> 	   mov	al,22h
  5928 00004DB6 EE                  <2> 	   out	dx,al
  5929 00004DB7 6658                <2> 	   pop	ax
  5930 00004DB9 6642                <2> 	   inc	dx
  5931 00004DBB EE                  <2> 	   out	dx,al
  5932 00004DBC C3                  <2> 	   ret
  5933                              <2> 	   
  5934                              <2> ResetDSP:   ; uses cx dx
  5935 00004DBD 66BA2602            <2> 			mov	dx,(BasePort+6)
  5936 00004DC1 B001                <2> 			mov	al,01
  5937 00004DC3 EE                  <2> 			out	dx,al
  5938 00004DC4 66B93200            <2> 			mov	cx,50
  5939 00004DC8 EC                  <2> WaitIt1:	in	al,dx
  5940 00004DC9 E2FD                <2> 			loop WaitIt1
  5941 00004DCB 30C0                <2> 			xor	al,al
  5942 00004DCD EE                  <2> 			out	dx,al
  5943 00004DCE 66B93200            <2> 			mov	cx,50
  5944 00004DD2 EC                  <2> WaitIt2:	in	al,dx
  5945 00004DD3 E2FD                <2> 			loop WaitIt2
  5946 00004DD5 B4FF                <2> 			mov	ah,0FFh 		; part of Return Code
  5947 00004DD7 66BA2E02            <2> 			mov	dx,(BasePort+14)
  5948 00004DDB EC                  <2> 			in	al,dx
  5949 00004DDC 2480                <2> 			and	al,80h
  5950 00004DDE 3C80                <2> 			cmp	al,80h
  5951 00004DE0 750C                <2> 			jne	ResetErr
  5952 00004DE2 66BA2A02            <2> 			mov	dx,(BasePort+10)
  5953 00004DE6 EC                  <2> 			in	al,dx
  5954 00004DE7 3CAA                <2> 			cmp	al,0AAh
  5955 00004DE9 7503                <2> 			jne	ResetErr
  5956 00004DEB B001                <2> ResetOK:	mov al, 1		; return ax = 0 if reset ok
  5957 00004DED C3                  <2> 			ret
  5958 00004DEE 30C0                <2> ResetErr:	xor al, al
  5959 00004DF0 C3                  <2> 			ret
  5960                              <2> 
  5961                              <2> WriteDSP:   ;uses ax dx
  5962 00004DF1 6650                <2> 		push ax
  5963 00004DF3 66BA2C02            <2> 		mov	dx,(BasePort+12)
  5964 00004DF7 EC                  <2> WaitIt:	in	al,dx
  5965 00004DF8 2480                <2> 		and	al,80h
  5966 00004DFA 75FB                <2> 		jnz	WaitIt
  5967 00004DFC 6658                <2> 		pop	ax
  5968 00004DFE EE                  <2> 		out	dx,al
  5969 00004DFF C3                  <2> 		ret
  5970                              <2> 
  5971 00004E00 0000                <2> Length0 dw	0
  5972 00004E02 0000                <2> Length1	dw  0
  5973 00004E04 00000000            <2> NextMemLoc dd 0
  5974 00004E08 00000000            <2> MemLoc	dd  0
  5975 00004E0C 00                  <2> Page1	db  0
  5976 00004E0D 00000000            <2> Freq	dd	0
  5977 00004E11 14                  <2> WAVEMode db 14h
  5978                              <2> 
  5979                              <2> PgPort	equ 83h
  5980                              <2> AddPort	equ 02h
  5981                              <2> LenPort	equ 03h
  5982                              <2> ModeReg	equ 49h
  5983                              <2> Channel	equ 01h
  5984                              <2> BasePort	equ 220h
  5985 00004E12 00                  <2> SoundBlaster	db 0
  5986                              <1> %include "source/drivers/network/rtl8139.asm"
  5987                              <2> ;RTL8139 NIC DRIVER
  5988                              <2> rtl8139:
  5989                              <2> .RBSTART equ 0x30
  5990                              <2> .IMR equ 0x3C
  5991                              <2> .ISR equ 0x3E
  5992                              <2> .CMD equ 0x37
  5993                              <2> .RCR equ 0x44
  5994                              <2> .CONFIG1 equ 0x52
  5995                              <2> .TSD0 equ 0x10
  5996                              <2> .TSAD0 equ 0x20
  5997                              <2> .initcard:	;should find card, get mac, and initialize card
  5998 00004E13 31C0                <2> 	xor eax, eax
  5999 00004E15 A2[BE6E0000]        <2> 	mov [pcifunction], al
  6000 00004E1A A2[BC6E0000]        <2> 	mov [pcibus], al
  6001 00004E1F A2[BD6E0000]        <2> 	mov [pcidevice], al
  6002 00004E24 B002                <2> 	mov al, 0x02 ;;type code
  6003 00004E26 A2[396F0000]        <2> 	mov [pcitype], al
  6004 00004E2B E891200000          <2> 	call getpciport
  6005                              <2> .initnic:	;Here i tried the rtl8139 interface, fuck it
  6006 00004E30 8915[CB4F0000]      <2> 	mov [basenicaddr], edx
  6007 00004E36 89D1                <2> 	mov ecx, edx
  6008 00004E38 E86FE4FFFF          <2> 	call showhex	;for debugging, please remove
  6009 00004E3D BE[2C6F0100]        <2> 	mov esi, rbuffstart
  6010 00004E42 B900200000          <2> 	mov ecx, 8192
  6011 00004E47 31C0                <2> 	xor eax, eax
  6012                              <2> .clearrbuff:		;clear receive buffer which starts at rbuffstart
  6013 00004E49 8806                <2> 	mov [esi], al
  6014 00004E4B 46                  <2> 	inc esi
  6015 00004E4C 6649                <2> 	dec cx
  6016 00004E4E 6681F90000          <2> 	cmp cx, 0
  6017 00004E53 75F4                <2> 	jne .clearrbuff
  6018                              <2> .findmac:
  6019 00004E55 8B15[CB4F0000]      <2> 	mov edx, [basenicaddr]
  6020 00004E5B BF[D34F0000]        <2> 	mov edi, sysmac
  6021 00004E60 B906000000          <2> 	mov ecx, 6
  6022                              <2> .macputloop:
  6023 00004E65 EC                  <2> 	in al, dx
  6024 00004E66 8807                <2> 	mov [edi], al
  6025 00004E68 47                  <2> 	inc edi
  6026 00004E69 42                  <2> 	inc edx
  6027 00004E6A 49                  <2> 	dec ecx
  6028 00004E6B 75F8                <2> 	jnz .macputloop
  6029 00004E6D B9[D34F0000]        <2> 	mov ecx, sysmac
  6030 00004E72 E803010000          <2> 	call showmac
  6031                              <2> .resetnic:
  6032 00004E77 8B15[CB4F0000]      <2> 	mov edx, [basenicaddr]
  6033 00004E7D 81C252000000        <2> 	add edx, .CONFIG1
  6034 00004E83 30C0                <2> 	xor al, al
  6035 00004E85 EE                  <2> 	out dx, al	;WAKE UP!!!!
  6036 00004E86 8B15[CB4F0000]      <2> 	mov edx, [basenicaddr]
  6037 00004E8C 81C237000000        <2> 	add edx, .CMD
  6038 00004E92 B010                <2> 	mov al, 0x10
  6039 00004E94 EE                  <2> 	out dx, al	;Reset
  6040                              <2> .resetnicwait:
  6041 00004E95 8B15[CB4F0000]      <2> 	mov edx, [basenicaddr]
  6042 00004E9B 81C237000000        <2> 	add edx, .CMD
  6043 00004EA1 EC                  <2> 	in al, dx
  6044 00004EA2 2410                <2> 	and al, 0x10
  6045 00004EA4 3C10                <2> 	cmp al, 0x10
  6046 00004EA6 0F84E9FFFFFF        <2> 	je near .resetnicwait
  6047 00004EAC 8B15[CB4F0000]      <2> 	mov edx, [basenicaddr]
  6048 00004EB2 81C230000000        <2> 	add edx, .RBSTART
  6049 00004EB8 B8[2C6F0100]        <2> 	mov eax, rbuffstart
  6050 00004EBD 0500001000          <2> 	add eax, 0x100000 ;change virtual to physical address
  6051 00004EC2 EF                  <2> 	out dx, eax	;give nic receive buffer location
  6052 00004EC3 8B15[CB4F0000]      <2> 	mov edx, [basenicaddr]
  6053 00004EC9 81C23C000000        <2> 	add edx, .IMR
  6054 00004ECF 66ED                <2> 	in ax, dx
  6055 00004ED1 660D7FE0            <2> 	or ax, 0xE07F ;set all possible interrupts to enabled
  6056 00004ED5 66EF                <2> 	out dx, ax	;set TOK and ROK
  6057 00004ED7 8B15[CB4F0000]      <2> 	mov edx, [basenicaddr]
  6058 00004EDD 81C244000000        <2> 	add edx, .RCR
  6059 00004EE3 B80F000000          <2> 	mov eax, 0xf
  6060 00004EE8 0580000000          <2> 	add eax, 128 ;enable wrap option
  6061 00004EED EF                  <2> 	out dx, eax	;recieve packets from all matches
  6062 00004EEE 8B15[CB4F0000]      <2> 	mov edx, [basenicaddr]
  6063 00004EF4 81C237000000        <2> 	add edx, .CMD
  6064 00004EFA B00C                <2> 	mov al, 0x0C
  6065 00004EFC EE                  <2> 	out dx, al	;use transmit and receive
  6066 00004EFD C605[CA4F0000]01    <2> 	mov byte [nicconfig], 1
  6067 00004F04 C3                  <2> 	ret
  6068                              <2> 	
  6069                              <2> .sendpacket:	;packet with beginning in edi and end in esi
  6070 00004F05 56                  <2> 	push esi
  6071 00004F06 57                  <2> 	push edi
  6072                              <2> .nic2:		;here come the low level drivers :(
  6073                              <2> 			;frame begins at esi, ends at edi
  6074                              <2>  			;0x0200 is the class code for ethernet cards
  6075 00004F07 803D[CA4F0000]01    <2> 	cmp byte [nicconfig], 1
  6076 00004F0E 7405                <2> 	je .sendcachedata
  6077 00004F10 E8FEFEFFFF          <2> 	call .initcard
  6078                              <2> .sendcachedata:
  6079 00004F15 8B15[CB4F0000]      <2> 	mov edx, [basenicaddr]
  6080 00004F1B 81C220000000        <2> 	add edx, .TSAD0
  6081 00004F21 5F                  <2> 	pop edi
  6082 00004F22 89F8                <2> 	mov eax, edi
  6083 00004F24 0500001000          <2> 	add eax, 0x100000 ;base address
  6084 00004F29 EF                  <2> 	out dx, eax	;here's Johnny!
  6085 00004F2A 5E                  <2> 	pop esi
  6086 00004F2B 29FE                <2> 	sub esi, edi
  6087 00004F2D 8B15[CB4F0000]      <2> 	mov edx, [basenicaddr]
  6088 00004F33 81C210000000        <2> 	add edx, .TSD0
  6089 00004F39 ED                  <2> 	in eax, dx ;get tsd
  6090 00004F3A 2500E0FFFF          <2> 	and eax, 0xFFFFE000 ;clear off thirteen bits
  6091 00004F3F 01F0                <2> 	add eax, esi ;add length to tsd
  6092 00004F41 25FFDFFFFF          <2> 	and eax, 0xFFFFDFFF ;clear own bit
  6093 00004F46 EF                  <2> 	out dx, eax
  6094                              <2> .checknicownbit:
  6095 00004F47 8B15[CB4F0000]      <2> 	mov edx, [basenicaddr]
  6096 00004F4D 81C210000000        <2> 	add edx, .TSD0
  6097 00004F53 ED                  <2> 	in eax, dx
  6098 00004F54 2500200000          <2> 	and eax, 0x2000 ;check own bit
  6099 00004F59 3D00200000          <2> 	cmp eax, 0x2000
  6100 00004F5E 75E7                <2> 	jne .checknicownbit
  6101                              <2> .checknictokbit:
  6102 00004F60 8B15[CB4F0000]      <2> 	mov edx, [basenicaddr]
  6103 00004F66 81C210000000        <2> 	add edx, .TSD0
  6104 00004F6C ED                  <2> 	in eax, dx
  6105 00004F6D 2500800000          <2> 	and eax, 0x8000	;check tok bit
  6106 00004F72 3D00800000          <2> 	cmp eax, 0x8000
  6107 00004F77 75E7                <2> 	jne .checknictokbit
  6108 00004F79 C3                  <2> 	ret
  6109                              <2> 	
  6110                              <2> showmac:	;mac begins in [ecx]
  6111 00004F7A BE[B24F0000]        <2> 	mov esi, macprint
  6112 00004F7F 89CF                <2> 	mov edi, ecx
  6113 00004F81 81C106000000        <2> 	add ecx, 6
  6114                              <2> showmacloop:
  6115 00004F87 8A07                <2> 	mov al, [edi]
  6116 00004F89 8A27                <2> 	mov ah, [edi]
  6117 00004F8B C0E804              <2> 	shr al, 4
  6118 00004F8E C0E404              <2> 	shl ah, 4
  6119 00004F91 C0EC04              <2> 	shr ah, 4
  6120 00004F94 0430                <2> 	add al, 48
  6121 00004F96 80C430              <2> 	add ah, 48
  6122 00004F99 668906              <2> 	mov [esi], ax
  6123 00004F9C 81C603000000        <2> 	add esi, 3
  6124 00004FA2 47                  <2> 	inc edi
  6125 00004FA3 39CF                <2> 	cmp edi, ecx
  6126 00004FA5 72E0                <2> 	jb showmacloop
  6127 00004FA7 BE[B24F0000]        <2> 	mov esi, macprint
  6128 00004FAC E833D3FFFF          <2> 	call print
  6129 00004FB1 C3                  <2> 	ret
  6130                              <2> 	
  6131 00004FB2 30303A30303A30303A- <2> macprint db "00:00:00:00:00:00  ",0
  6132 00004FBB 30303A30303A303020- <2>
  6133 00004FC4 2000                <2>
  6134 00004FC6 00000000            <2> ethernetend dw 0,0
  6135 00004FCA 00                  <2> nicconfig db 0
  6136 00004FCB 00000000            <2> basenicaddr	db 0,0,0,0
  6137 00004FCF C0A80005            <2> sysip db 192,168,0,5
  6138 00004FD3 000000000000        <2> sysmac	db 0,0,0,0,0,0		;my mac address
  6139                              <1> %include "source/drivers/input/mouse.asm"
  6140 00004FD9 00                  <2> mousedisabled db 0
  6141                              <2> 	
  6142                              <2> 	cursorgui:
  6143 00004FDA 803D[C7690000]01    <2> 		cmp byte [mouseon], 1
  6144 00004FE1 0F8432000000        <2> 		je near moused
  6145 00004FE7 803D[AB8B0000]00    <2> 		cmp byte [guion], 0
  6146 00004FEE 0F841F040000        <2> 		je near entdown
  6147                              <2> 	initmouse:
  6148 00004FF4 803D[AB8B0000]00    <2> 		cmp byte [guion], 0
  6149 00004FFB 7405                <2> 		je noswmsposinit
  6150 00004FFD E8BD080000          <2> 		call switchmousepos2
  6151                              <2> 	noswmsposinit:
  6152 00005002 E84E020000          <2> 	  	call PS2SET
  6153 00005007 E877020000          <2> 		call ACTMOUS
  6154 0000500C C605[C7690000]01    <2> 		mov byte [mouseon],1
  6155 00005013 E890020000          <2> 		call GETB 	;;Get the responce byte of the mouse (like: Hey i am active)
  6156                              <2> 				;;If the bytes are mixed up,
  6157                              <2> 				;;remove this line or add another of this line.
  6158                              <2> 	nomouse:
  6159 00005018 C3                  <2> 		ret
  6160                              <2> 	moused:
  6161 00005019 803D[D94F0000]01    <2> 		cmp byte [mousedisabled], 1
  6162 00005020 74F6                <2> 		je nomouse
  6163 00005022 803D[C7690000]01    <2> 		  cmp byte [mouseon], 1
  6164 00005029 75C9                <2> 		  jne initmouse
  6165 0000502B E878020000          <2> 		  call GETB
  6166 00005030 88C3                <2> 		  mov  bl, al
  6167 00005032 80E301              <2> 		  and  bl, 1
  6168 00005035 881D[CD520000]      <2> 		  mov  BYTE [LBUTTON], bl
  6169 0000503B 88C3                <2> 		  mov  bl, al
  6170 0000503D 80E302              <2> 		  and  bl, 2
  6171 00005040 D0EB                <2> 		  shr  bl, 1
  6172 00005042 881D[CE520000]      <2> 		  mov  BYTE [RBUTTON], bl
  6173 00005048 88C3                <2> 		  mov  bl, al
  6174 0000504A 80E304              <2> 		  and  bl, 4
  6175 0000504D C0EB02              <2> 		  shr  bl, 2
  6176 00005050 881D[CF520000]      <2> 		  mov  BYTE [MBUTTON], bl
  6177 00005056 E84D020000          <2> 		  call GETB
  6178 0000505B A2[D0520000]        <2> 		  mov  BYTE [XCOORD], al
  6179 00005060 E843020000          <2> 		  call GETB
  6180 00005065 A2[D1520000]        <2> 		  mov  BYTE [YCOORD], al
  6181                              <2> 
  6182                              <2> 	showpixelcursor:
  6183 0000506A 668B15[BC510000]    <2> 		mov dx, [mousecursorposition]
  6184 00005071 668B0D[BE510000]    <2> 		mov cx, [mousecursorposition + 2]
  6185 00005078 668915[B8510000]    <2> 		mov [lastmouseposition], dx
  6186 0000507F 66890D[BA510000]    <2> 		mov [lastmouseposition + 2], cx
  6187 00005086 A0[D0520000]        <2> 		mov al, [XCOORD]
  6188 0000508B 3C80                <2> 		cmp al, 128
  6189 0000508D 730C                <2> 		jae subxcoord
  6190 0000508F 00C0                <2> 		add al, al
  6191 00005091 30E4                <2> 		xor ah, ah
  6192 00005093 6601C2              <2> 		add dx, ax
  6193 00005096 E90B000000          <2> 		jmp subxcoorddn
  6194                              <2> 	subxcoord:
  6195 0000509B 00C0                <2> 		add al, al
  6196 0000509D 30DB                <2> 		xor bl, bl
  6197 0000509F 28C3                <2> 		sub bl, al
  6198 000050A1 30FF                <2> 		xor bh, bh
  6199 000050A3 6629DA              <2> 		sub dx, bx
  6200                              <2> 	subxcoorddn:
  6201 000050A6 8A1D[D1520000]      <2> 		mov bl, [YCOORD]
  6202 000050AC 30C0                <2> 		xor al, al
  6203 000050AE 28D8                <2> 		sub al, bl
  6204 000050B0 3C80                <2> 		cmp al, 128
  6205 000050B2 730A                <2> 		jae subycoord
  6206 000050B4 30E4                <2> 		xor ah, ah
  6207 000050B6 6601C1              <2> 		add cx, ax
  6208 000050B9 E909000000          <2> 		jmp subycoorddn
  6209                              <2> 	subycoord:
  6210 000050BE 30DB                <2> 		xor bl, bl
  6211 000050C0 28C3                <2> 		sub bl, al
  6212 000050C2 30FF                <2> 		xor bh, bh
  6213 000050C4 6629D9              <2> 		sub cx, bx
  6214                              <2> 	subycoorddn:
  6215 000050C7 6681FA204E          <2> 		cmp dx, 20000
  6216 000050CC 7603                <2> 		jbe nooriginx2
  6217 000050CE 6631D2              <2> 		xor dx, dx
  6218                              <2> 	nooriginx2:
  6219 000050D1 6681F9204E          <2> 		cmp cx, 20000
  6220 000050D6 7603                <2> 		jbe nooriginy2
  6221 000050D8 6631C9              <2> 		xor cx, cx
  6222                              <2> 	nooriginy2:
  6223 000050DB 6681FA0000          <2> 		cmp dx, 0
  6224 000050E0 7415                <2> 		je nofixxcolumn2
  6225 000050E2 663B15[A98B0000]    <2> 		cmp dx, [resolutionx2]
  6226 000050E9 720C                <2> 		jb nofixxcolumn2
  6227 000050EB 668B15[A98B0000]    <2> 		mov dx, [resolutionx2]
  6228 000050F2 6681EA0200          <2> 		sub dx, 2
  6229                              <2> 	nofixxcolumn2:
  6230 000050F7 6681F90000          <2> 		cmp cx, 0
  6231 000050FC 7415                <2> 		je nofixyrow2
  6232 000050FE 663B0D[BD8A0000]    <2> 		cmp cx, [resolutiony]
  6233 00005105 720C                <2> 		jb nofixyrow2
  6234 00005107 668B0D[BD8A0000]    <2> 		mov cx, [resolutiony]
  6235 0000510E 6681E90100          <2> 		sub cx, 1
  6236                              <2> 	nofixyrow2:
  6237 00005113 668915[BC510000]    <2> 		mov [mousecursorposition], dx
  6238 0000511A 66890D[BE510000]    <2> 		mov [mousecursorposition + 2], cx
  6239 00005121 803D[AB8B0000]00    <2> 		cmp byte [guion], 0
  6240 00005128 0F8492000000        <2> 		je near termmouse
  6241 0000512E E82C070000          <2> 		call switchmousepos ;;use dragging code to ensure proper icon drag
  6242 00005133 803D[CD520000]01    <2> 		cmp byte [LBUTTON], 1
  6243 0000513A 0F84F3070000        <2> 		je near clickicon
  6244 00005140 803D[CE520000]01    <2> 		cmp byte [RBUTTON], 1
  6245 00005147 0F84E6070000        <2> 		je near clickicon
  6246 0000514D A0[20590000]        <2> 		mov al, [pbutton]
  6247 00005152 C705[23590000]0000- <2> 		mov dword [dragging], 0
  6248 0000515A 0000                <2>
  6249 0000515C 3C00                <2> 		cmp al, 0
  6250 0000515E 740F                <2> 		je nopreviousbutton
  6251 00005160 E8A0060000          <2> 		call clearmousecursor
  6252 00005165 E8000D0000          <2> 		call reloadallgraphics
  6253                              <2> 	windowtermcopyend:
  6254 0000516A E850070000          <2> 		call switchmousepos2
  6255                              <2> 	nopreviousbutton:
  6256 0000516F 30C0                <2> 		xor al, al
  6257 00005171 A2[20590000]        <2> 		mov [pbutton], al
  6258 00005176 A0[CD520000]        <2> 		mov al, [LBUTTON]
  6259 0000517B A2[21590000]        <2> 		mov [pLBUTTON], al
  6260 00005180 A0[CE520000]        <2> 		mov al, [RBUTTON]
  6261 00005185 A2[22590000]        <2> 		mov [pRBUTTON], al
  6262 0000518A 31C9                <2> 		xor ecx, ecx
  6263 0000518C 31D2                <2> 		xor edx, edx
  6264 0000518E 668B15[BC510000]    <2> 		mov dx, [mousecursorposition]
  6265 00005195 668B0D[BE510000]    <2> 		mov cx, [mousecursorposition + 2]
  6266 0000519C 66BB18C7            <2> 		mov bx, 1100011100011000b
  6267 000051A0 30E4                <2> 		xor ah, ah
  6268 000051A2 B0FE                <2> 		mov al, 254
  6269 000051A4 C605[02580000]01    <2> 		mov byte [showcursorfonton], 1
  6270 000051AB E884150000          <2> 		call showfontvesa
  6271 000051B0 C605[02580000]00    <2> 		mov byte [showcursorfonton], 0
  6272 000051B7 C3                  <2> 		ret
  6273                              <2> 
  6274 000051B8 84008400            <2> lastmouseposition dw 132,132
  6275 000051BC 84008400            <2> mousecursorposition dw 132,132	
  6276                              <2> 
  6277                              <2> termmouse:
  6278 000051C0 BE[A4BC0000]        <2> 		mov esi, videobuf
  6279 000051C5 31D2                <2> 		xor edx, edx
  6280 000051C7 668B15[B8510000]    <2> 		mov dx, [lastmouseposition]
  6281 000051CE 668B0D[BA510000]    <2> 		mov cx, [lastmouseposition + 2]
  6282 000051D5 66A1[53520000]      <2> 		mov ax, [cursorcache]
  6283 000051DB 663D0000            <2> 		cmp ax, 0
  6284 000051DF 7425                <2> 		je nocopycursorcache
  6285 000051E1 66C1E104            <2> 		shl cx, 4
  6286 000051E5 66C1E203            <2> 		shl dx, 3
  6287 000051E9 01D6                <2> 		add esi, edx
  6288 000051EB 6631D2              <2> 		xor dx, dx
  6289 000051EE 8A15[8A290000]      <2> 		mov dl, [charxy]
  6290 000051F4 6641                <2> 		inc cx
  6291                              <2> termmousecplp1:
  6292 000051F6 01D6                <2> 		add esi, edx
  6293 000051F8 6649                <2> 		dec cx
  6294 000051FA 6681F90000          <2> 		cmp cx, 0
  6295 000051FF 75F5                <2> 		jne termmousecplp1
  6296 00005201 29D6                <2> 		sub esi, edx
  6297 00005203 668906              <2> 		mov [esi], ax
  6298                              <2> nocopycursorcache:
  6299 00005206 BE[A4BC0000]        <2> 		mov esi, videobuf
  6300 0000520B 31D2                <2> 		xor edx, edx
  6301 0000520D 668B15[BC510000]    <2> 		mov dx, [mousecursorposition]
  6302 00005214 668B0D[BE510000]    <2> 		mov cx, [mousecursorposition + 2]
  6303 0000521B 66C1E104            <2> 		shl cx, 4
  6304 0000521F 66C1E203            <2> 		shl dx, 3
  6305 00005223 01D6                <2> 		add esi, edx
  6306 00005225 6631D2              <2> 		xor dx, dx
  6307 00005228 8A15[8A290000]      <2> 		mov dl, [charxy]
  6308 0000522E 6641                <2> 		inc cx
  6309                              <2> termmousecplp2:
  6310 00005230 01D6                <2> 		add esi, edx
  6311 00005232 6649                <2> 		dec cx
  6312 00005234 6681F90000          <2> 		cmp cx, 0
  6313 00005239 75F5                <2> 		jne termmousecplp2
  6314 0000523B 29D6                <2> 		sub esi, edx
  6315 0000523D 668B06              <2> 		mov ax, [esi]
  6316 00005240 66A3[53520000]      <2> 		mov [cursorcache], ax
  6317 00005246 B080                <2> 		mov al, 128
  6318 00005248 B407                <2> 		mov ah, 7
  6319 0000524A 668906              <2> 		mov [esi], ax
  6320 0000524D E8CFD7FFFF          <2> 		call termcopy
  6321 00005252 C3                  <2> 		ret
  6322 00005253 0000                <2> cursorcache db 0,0
  6323                              <2> 
  6324                              <2> PS2SET:
  6325 00005255 B0A8                <2>   mov  al, 0xa8		; enable mouse port
  6326 00005257 E664                <2>   out  0x64, al		; write to keyboardcontroller
  6327 00005259 E801000000          <2>   call CHKPRT		; check if command is progressed (demand!)
  6328 0000525E C3                  <2> ret
  6329                              <2> 
  6330                              <2> CHKPRT:
  6331 0000525F 66B96400            <2>   mov  cx, 100
  6332                              <2>  .again:
  6333 00005263 E464                <2>   in   al, 0x64		; read from keyboardcontroller
  6334 00005265 A802                <2>   test al, 2		; Check if input buffer is empty
  6335 00005267 7402                <2>   je .go
  6336 00005269 E2F8                <2>   loop .again
  6337                              <2>  .go:
  6338 0000526B C3                  <2> ret
  6339                              <2> 
  6340                              <2> WMOUS:
  6341 0000526C B0D4                <2>   mov  al, 0xd4		; write to mouse device instead of to keyboard
  6342 0000526E E664                <2>   out  0x64, al		; write to keyboardcontroller
  6343 00005270 E8EAFFFFFF          <2>   call CHKPRT		; check if command is progressed (demand!)
  6344 00005275 C3                  <2> ret
  6345                              <2> 
  6346                              <2> MBUFFUL:
  6347 00005276 66B96400            <2>   mov cx, 100
  6348                              <2>  .mn:
  6349 0000527A E464                <2>   in   al, 0x64		; read from keyboardcontroller
  6350 0000527C A820                <2>   test al, 0x20		; check if mouse output buffer is full
  6351 0000527E 7402                <2>   jz  .mnn
  6352 00005280 E2F8                <2>   loop .mn
  6353                              <2>  .mnn:
  6354 00005282 C3                  <2> ret
  6355                              <2> 
  6356                              <2> 
  6357                              <2> ACTMOUS:
  6358 00005283 E8E4FFFFFF          <2>   call WMOUS
  6359 00005288 B0F4                <2>   mov  al, 0xf4 	; Command to activate mouse itselve (Stream mode)
  6360 0000528A E660                <2>   out  0x60, al		; write ps/2 controller output port (activate mouse)
  6361 0000528C E8CEFFFFFF          <2>   call CHKPRT		; check if command is progressed (demand!)
  6362 00005291 E801000000          <2>   call CHKMOUS		; check if a byte is available
  6363 00005296 C3                  <2> ret
  6364                              <2> 
  6365                              <2> CHKMOUS:
  6366 00005297 B300                <2>   mov  bl, 0
  6367 00005299 66B96400            <2>   mov cx, 100
  6368                              <2>  .vrd:
  6369 0000529D E464                <2>   in   al, 0x64		; read from keyboardcontroller
  6370 0000529F A801                <2>   test al, 1		; check if controller buffer (60h) has data
  6371 000052A1 7504                <2>   jnz .yy
  6372 000052A3 E2F8                <2>   loop .vrd
  6373 000052A5 B301                <2>   mov  bl, 1
  6374                              <2>  .yy:
  6375 000052A7 C3                  <2> ret
  6376                              <2> 
  6377                              <2> GETB:
  6378                              <2>  .cagain:
  6379 000052A8 E8EAFFFFFF          <2>   call CHKMOUS		; check if a byte is available
  6380 000052AD 08DB                <2>   or bl, bl
  6381 000052AF 75F7                <2>   jnz .cagain
  6382 000052B1 B0AD                <2>   mov  al, 0xad		; Disable Keyboard
  6383 000052B3 E664                <2>   out  0x64, al		; write to keyboardcontroller
  6384 000052B5 E8A5FFFFFF          <2>   call CHKPRT		; check if command is progressed (demand!)
  6385 000052BA 6631C0              <2>   xor  ax, ax
  6386 000052BD E460                <2>   in   al, 0x60		; read ps/2 controller output port (mousebyte)
  6387 000052BF 88C2                <2>   mov  dl, al
  6388 000052C1 B0AE                <2>   mov  al, 0xae		; Enable Keyboard
  6389 000052C3 E664                <2>   out  0x64, al		; write to keyboardcontroller
  6390 000052C5 E895FFFFFF          <2>   call CHKPRT		; check if command is progressed (demand!)
  6391 000052CA 88D0                <2>   mov  al, dl
  6392 000052CC C3                  <2> ret
  6393                              <2> 
  6394 000052CD 00                  <2> LBUTTON db 0x00	;	Left   button status 1=PRESSED 0=RELEASED
  6395 000052CE 00                  <2> RBUTTON db 0x00	;	Right  button status 1=PRESSED 0=RELEASED
  6396 000052CF 00                  <2> MBUTTON db 0x00	;	Middle button status 1=PRESSED 0=RELEASED
  6397 000052D0 00                  <2> XCOORD  db 0x00	;	the moved distance  (horizontal)
  6398 000052D1 00                  <2> YCOORD  db 0x00	;	the moved distance  (vertical)
  6399                              <1> %include "source/drivers/input/keyboard.asm"
  6400 000052D2 00                  <2> specialkey db 0
  6401 000052D3 00                  <2> charregion db 0
  6402                              <2> waitforinput:		;;this is basically the idle process
  6403                              <2> 					;;this halts the cpu for a small amount of time and then sees if there was a keypress
  6404                              <2> 					;;this lets the cpu stay at close to 0% instead of 100%
  6405 000052D4 6631C0              <2> 	xor ax, ax
  6406 000052D7 A0[3C720000]        <2> 	mov al, [threadson]
  6407 000052DC 8825[3C720000]      <2> 	mov [threadson], ah
  6408 000052E2 FB                  <2> 	sti
  6409 000052E3 F4                  <2> 	hlt
  6410 000052E4 A2[3C720000]        <2> 	mov [threadson], al
  6411 000052E9 3A25[AC270000]      <2> 	cmp ah, [trans]
  6412 000052EF 7401                <2> 	je getkey
  6413 000052F1 C3                  <2> 	ret
  6414                              <2> getkey:
  6415 000052F2 31C0                <2> 		xor eax, eax
  6416 000052F4 A2[D2520000]        <2> 		mov [specialkey], al
  6417 000052F9 66A3[AA270000]      <2> 		mov [lastkey], ax
  6418 000052FF E464                <2> 		in al, 64h ; Status
  6419 00005301 A820                <2> 		test al, 20h ; PS2-Mouse?
  6420 00005303 0F8510FDFFFF        <2> 		jnz near moused
  6421 00005309 A801                <2> 		test al, 1 
  6422 0000530B 74C7                <2> 		jz waitforinput ; if output buffer full or no keypress, jump to idle process (only works when it is jz guistartin2, use jz guistartin to disable)
  6423                              <2> 	calckey:
  6424 0000530D E460                <2> 		in al, 60h
  6425 0000530F 88C4                <2> 		mov ah, al
  6426 00005311 30C0                <2> 		xor al, al
  6427 00005313 8825[AB270000]      <2> 		mov [lastkey + 1], ah
  6428 00005319 88E0                <2> 		mov al, ah
  6429 0000531B BF[B4540000]        <2> 		mov edi, scancode
  6430                              <2> 	searchscan: 
  6431 00005320 3C3A                <2> 		cmp al, 3Ah
  6432 00005322 731A                <2> 		jae scanother
  6433 00005324 30E4                <2> 		xor ah, ah
  6434 00005326 C0E002              <2> 		shl al, 2
  6435 00005329 01C7                <2> 		add edi, eax
  6436 0000532B D0E8                <2> 		shr al, 1
  6437 0000532D 01C7                <2> 		add edi, eax
  6438 0000532F D0E8                <2> 		shr al, 1
  6439 00005331 8A27                <2> 		mov ah, [edi]
  6440 00005333 80FC00              <2> 		cmp ah, 0
  6441 00005336 7406                <2> 		je scanother
  6442 00005338 E9D7000000          <2> 		jmp scanfound
  6443 0000533D 00                  <2> uppercase db 0
  6444                              <2> scanother:
  6445 0000533E 88C4                <2> 		mov ah, al
  6446 00005340 30C0                <2> 		xor al, al
  6447 00005342 66A3[AA270000]      <2> 		mov [lastkey], ax
  6448 00005348 80FCE0              <2> 		cmp ah, 0E0h
  6449 0000534B 0F847D000000        <2> 		je near getkeyspecial
  6450 00005351 803D[D2520000]E0    <2> 		cmp byte [specialkey], 0xE0
  6451 00005358 752B                <2> 		jne nospecialkey
  6452 0000535A 80FC38              <2> 		cmp ah, 38h
  6453 0000535D 0F84A0000000        <2> 		je near alton
  6454 00005363 80FCB8              <2> 		cmp ah, 0B8h
  6455 00005366 0F849F000000        <2> 		je near altoff
  6456 0000536C 80FC1D              <2> 		cmp ah, 1Dh
  6457 0000536F 0F847E000000        <2> 		je near ctron
  6458 00005375 80FC9D              <2> 		cmp ah, 9Dh
  6459 00005378 0F847D000000        <2> 		je near ctroff
  6460 0000537E 66A3[AA270000]      <2> 		mov [lastkey], ax
  6461 00005384 C3                  <2> 		ret
  6462                              <2> nospecialkey:
  6463 00005385 80FC2A              <2> 		cmp ah, 2Ah
  6464 00005388 0F8455000000        <2> 		je near shifton
  6465 0000538E 80FC36              <2> 		cmp ah, 36h
  6466 00005391 0F844C000000        <2> 		je near shifton
  6467 00005397 80FC1C              <2> 		cmp ah, 1Ch
  6468 0000539A 0F8473000000        <2> 		je near entdown
  6469 000053A0 80FCAA              <2> 		cmp ah, 0AAh
  6470 000053A3 0F8442000000        <2> 		je near shiftoff
  6471 000053A9 80FCB6              <2> 		cmp ah, 0B6h
  6472 000053AC 0F8439000000        <2> 		je near shiftoff
  6473 000053B2 80FC3A              <2> 		cmp ah, 3Ah
  6474 000053B5 0F84A5000000        <2> 		je near capslock
  6475 000053BB 80FC45              <2> 		cmp ah, 0x45
  6476 000053BE 0F84AD000000        <2> 		je near numlock
  6477 000053C4 80FC46              <2> 		cmp ah, 0x46
  6478 000053C7 0F84BC000000        <2> 		je near scrolllock
  6479 000053CD C3                  <2> 		ret
  6480                              <2> 	getkeyspecial:
  6481 000053CE C605[D2520000]E0    <2> 		mov byte [specialkey], 0xE0
  6482 000053D5 E933FFFFFF          <2> 		jmp calckey
  6483                              <2> 	shift:
  6484 000053DA A0[3D530000]        <2> 		mov al, [uppercase]
  6485 000053DF 3C01                <2> 		cmp al, 1
  6486 000053E1 7308                <2> 		jae shiftoff
  6487                              <2> 	shifton:
  6488 000053E3 C605[3D530000]01    <2> 		mov byte [uppercase], 1
  6489 000053EA C3                  <2> 		ret
  6490                              <2> 	shiftoff:
  6491 000053EB C605[3D530000]00    <2> 		mov byte [uppercase], 0
  6492 000053F2 C3                  <2> 		ret
  6493                              <2> 	ctron:
  6494 000053F3 C605[5F540000]01    <2> 		mov byte [ctrkey], 1
  6495 000053FA C3                  <2> 		ret
  6496                              <2> 	ctroff:
  6497 000053FB C605[5F540000]00    <2> 		mov byte [ctrkey], 0
  6498 00005402 C3                  <2> 		ret
  6499                              <2> 	alton:
  6500 00005403 C605[5E540000]01    <2> 		mov byte [altkey], 1
  6501 0000540A C3                  <2> 		ret
  6502                              <2> 	altoff:
  6503 0000540B C605[5E540000]00    <2> 		mov byte [altkey], 0
  6504 00005412 C3                  <2> 		ret
  6505                              <2> 	entdown:
  6506 00005413 C3                  <2> 		ret
  6507                              <2> 	scanfound:
  6508 00005414 81C704000000        <2> 		add edi, 4
  6509 0000541A 803D[5F540000]01    <2> 		cmp byte [ctrkey], 1
  6510 00005421 731B                <2> 		jae altin
  6511 00005423 81EF04000000        <2> 		sub edi, 4
  6512 00005429 81C702000000        <2> 		add edi, 2
  6513 0000542F 803D[5E540000]01    <2> 		cmp byte [altkey], 1
  6514 00005436 7306                <2> 		jae altin
  6515 00005438 81EF02000000        <2> 		sub edi, 2
  6516                              <2> altin:
  6517 0000543E 81C701000000        <2> 		add edi, 1
  6518 00005444 803D[3D530000]01    <2> 		cmp byte [uppercase], 1
  6519 0000544B 7306                <2> 		jae uppercaseon
  6520 0000544D 81EF01000000        <2> 		sub edi, 1
  6521                              <2> uppercaseon:
  6522 00005453 8A07                <2> 		mov al,[edi]
  6523 00005455 A2[AA270000]        <2> 		mov [lastkey], al
  6524 0000545A C3                  <2> 		ret
  6525                              <2> 		
  6526 0000545B 00                  <2> keyboardstatus db 0
  6527 0000545C 00                  <2> numlockstatus db 0
  6528 0000545D 00                  <2> scrolllockstatus db 0
  6529 0000545E 00                  <2> altkey db 0
  6530 0000545F 00                  <2> ctrkey db 0
  6531                              <2> 	capslock:
  6532 00005460 8035[5B540000]04    <2> 		xor byte [keyboardstatus], 00000100b
  6533 00005467 E835000000          <2> 		call updatekblights
  6534 0000546C E969FFFFFF          <2> 		jmp shift
  6535                              <2> 		
  6536                              <2> 	numlock:
  6537 00005471 8035[5B540000]02    <2> 		xor byte [keyboardstatus], 00000010b
  6538 00005478 8035[5C540000]01    <2> 		xor byte [numlockstatus], 1
  6539 0000547F E81D000000          <2> 		call updatekblights
  6540 00005484 E969FEFFFF          <2> 		jmp getkey
  6541                              <2> 	
  6542                              <2> 	scrolllock:
  6543 00005489 8035[5B540000]01    <2> 		xor byte [keyboardstatus], 00000001b
  6544 00005490 8035[5D540000]01    <2> 		xor byte [scrolllockstatus], 1
  6545 00005497 E805000000          <2> 		call updatekblights
  6546 0000549C E951FEFFFF          <2> 		jmp getkey
  6547                              <2> 		
  6548                              <2> 	updatekblights:
  6549 000054A1 B0ED                <2> 		mov al, 0xED
  6550 000054A3 66BA6000            <2> 		mov dx, 0x60
  6551 000054A7 EE                  <2> 		out dx, al
  6552                              <2> 	chkkbdack:
  6553 000054A8 EC                  <2> 		in al, dx
  6554 000054A9 3CFA                <2> 		cmp al, 0xFA
  6555 000054AB 75FB                <2> 		jne chkkbdack
  6556 000054AD A0[5B540000]        <2> 		mov al, [keyboardstatus]
  6557 000054B2 EE                  <2> 		out dx, al
  6558 000054B3 C3                  <2> 		ret
  6559                              <2> 		
  6560                              <2> scancode:
  6561 000054B4 000000000000        <2> 	db 0,0,0,0,0,0				;0h
  6562 000054BA 000000000000        <2> 	db 0,0,0,0,0,0				;1h
  6563 000054C0 3121AD000000        <2> 	db '1','!',0xAD,0,0,0		;2h
  6564 000054C6 3240FDFB0000        <2> 	db '2','@',0xFD,0xFB,0,0	;3h
  6565 000054CC 332300000000        <2> 	db '3','#',0,0,0,0			;4h
  6566 000054D2 34249B9C0000        <2> 	db '4','$',0x9B,0x9C,0,0	;5h
  6567 000054D8 3525EE000000        <2> 	db '5','%',0xEE,0,0,0		;6h
  6568 000054DE 365EAC000000        <2> 	db '6','^',0xAC,0,0,0		;7h
  6569 000054E4 3726AB000000        <2> 	db '7','&',0xAB,0,0,0		;8h
  6570 000054EA 382AEC000000        <2> 	db '8','*',0xEC,0,0,0		;9h
  6571 000054F0 392800000000        <2> 	db '9','(',0,0,0,0			;0Ah
  6572 000054F6 302900000000        <2> 	db '0',')',0,0,0,0			;0Bh
  6573 000054FC 2D5F9DF10000        <2> 	db '-','_',0x9D,0xF1,0,0	;0Ch
  6574 00005502 3D2BF7F60000        <2> 	db '=','+',0xF7,0xF6,0,0	;0Dh
  6575 00005508 080800000000        <2> 	db 8,8,0,0,0,0				;0Eh
  6576 0000550E 000000000000        <2> 	db 0,0,0,0,0,0				;0Fh
  6577 00005514 7151848E0000        <2> 	db 'q','Q',0x84,0x8E,0,0	;10h
  6578 0000551A 7757868F0000        <2> 	db 'w','W',0x86,0x8F,0,0	;11h
  6579 00005520 65458290EE45        <2> 	db 'e','E',0x82,0x90,0xEE,'E'	;12h
  6580 00005526 7252898A7050        <2> 	db 'r','R',0x89,0x8A,'p','P'	;13h
  6581 0000552C 7454819AE754        <2> 	db 't','T',0x81,0x9A,0xE7,'T'	;14h
  6582 00005532 795998007559        <2> 	db 'y','Y',0x98,0,'u','Y'	;15h
  6583 00005538 7555A3970000        <2> 	db 'u','U',0xA3,0x97,0,0		;16h
  6584 0000553E 6949A18D6949        <2> 	db 'i','I',0xA1,0x8D,'i','I'	;17h
  6585 00005544 6F4FA29577EA        <2> 	db 'o','O',0xA2,0x95,'w',0xEA	;18h
  6586 0000554A 70509499E3EF        <2> 	db 'p','P',0x94,0x99,0xE3,0xEF	;19h
  6587 00005550 5B7BF4000000        <2> 	db '[','{',0xF4,0,0,0		;1Ah
  6588 00005556 5D7DF5000000        <2> 	db ']','}',0xF5,0,0,0		;1Bh
  6589 0000555C 000000000000        <2> 	db 0,0,0,0,0,0				;1Ch
  6590 00005562 000000000000        <2> 	db 0,0,0,0,0,0				;1Dh
  6591 00005568 6141A085E041        <2> 	db 'a','A',0xA0,133,224,'A'	;1Eh
  6592 0000556E 73531500E5E4        <2> 	db 's','S',21,0,229,228		;1Fh
  6593 00005574 6444F800EB7F        <2> 	db 'd','D',0xF8,0,235,127	;20h
  6594 0000557A 66469F00EDE8        <2> 	db 'f','F',159,0,237,232	;21h
  6595 00005580 6747000079E2        <2> 	db 'g','G',0,0,'y',226		;22h
  6596 00005586 684800006E48        <2> 	db 'h','H',0,0,'n','H'		;23h
  6597 0000558C 6A4A00000000        <2> 	db 'j','J',0,0,0,0			;24h
  6598 00005592 6B4B00006B4B        <2> 	db 'k','K',0,0,'k','K'		;25h
  6599 00005598 6C4C0000E9E9        <2> 	db 'l','L',0,0,233,233		;26h
  6600 0000559E 3B3A14000000        <2> 	db ';',':',20,0,0,0			;27h
  6601 000055A4 272200000000        <2> 	db 27h,22h,0,0,0,0			;28h
  6602 000055AA 607E00000000        <2> 	db '`','~',0,0,0,0			;29h
  6603 000055B0 000000000000        <2> 	db 0,0,0,0,0,0				;2Ah
  6604 000055B6 5C7CAAB30000        <2> 	db 92,'|',170,179,0,0		;2Bh
  6605 000055BC 7A5A91927A5A        <2> 	db 'z','Z',145,146,'z','Z'	;2Ch
  6606 000055C2 7858000000F0        <2> 	db 'x','X',0,0,0,240		;2Dh
  6607 000055C8 634387800000        <2> 	db 'c','C',135,128,0,0		;2Eh
  6608 000055CE 765600000000        <2> 	db 'v','V',0,0,0,0			;2Fh
  6609 000055D4 62420000E142        <2> 	db 'b','B',0,0,225,'B'		;30h
  6610 000055DA 6E4EA4A5764E        <2> 	db 'n','N',0xA4,0xA5,'v','N'	;31h
  6611 000055E0 6D4D0000E64D        <2> 	db 'm','M',0,0,230,'M'		;32h
  6612 000055E6 2C3CF3AE0000        <2> 	db ',','<',0xF3,174,0,0		;33h
  6613 000055EC 2E3EF2AF0000        <2> 	db '.','>',0xF2,175,0,0		;34h
  6614 000055F2 2F3FA8000000        <2> 	db '/','?',0xA8,0,0,0		;35h
  6615 000055F8 000000000000        <2> 	db 0,0,0,0,0,0				;36h
  6616 000055FE 000000000000        <2> 	db 0,0,0,0,0,0				;37h
  6617 00005604 000000000000        <2> 	db 0,0,0,0,0,0				;38h
  6618 0000560A 202000000000        <2> 	db ' ',' ',0,0,0,0			;39h
  6619                              <2> noscan:
  6620                              <2> 
  6621                              <1> ;drivers will soon be handled intelligently
  6622                              <1> ;every driver's source will be scanned for a .init function
  6623                              <1> ;that will be called and if it returns 0
  6624                              <1> ;the hardware was found and the driver initialized properly
  6625                              <1> initialize:
  6626                              <1> ;Now I will initialise the interrupt controllers and remap irq's
  6627 00005610 E814000000          <1> 	call .pic
  6628 00005615 E83C000000          <1> 	call .pit
  6629 0000561A E85E000000          <1> 	call .fpu
  6630 0000561F 31C0                <1> 	xor eax, eax
  6631 00005621 31C9                <1> 	xor ecx, ecx
  6632 00005623 E84EF6FFFF          <1> 	call sblaster.init
  6633 00005628 C3                  <1> 	ret
  6634                              <1> 	
  6635                              <1> .pic:
  6636 00005629 B011                <1> 	mov al, 0x11
  6637 0000562B E620                <1> 	out 0x20, al
  6638 0000562D E6A0                <1> 	out 0xA0, al
  6639 0000562F B040                <1> 	mov al, 0x40	;interrupt for master
  6640 00005631 E621                <1> 	out 0x21, al
  6641 00005633 B048                <1> 	mov al, 0x48	;interrupt for slave
  6642 00005635 E6A1                <1> 	out 0xA1, al
  6643 00005637 B004                <1> 	mov al, 4
  6644 00005639 E621                <1> 	out 0x21, al
  6645 0000563B B002                <1> 	mov al, 2
  6646 0000563D E6A1                <1> 	out 0xA1, al
  6647 0000563F B001                <1> 	mov al, 0x1
  6648 00005641 E621                <1> 	out 0x21, al
  6649 00005643 B001                <1> 	mov al, 0x1
  6650 00005645 E6A1                <1> 	out 0xA1, al
  6651                              <1> 	;masks are set to zero so as not to mask
  6652 00005647 30C0                <1> 	xor al, al
  6653 00005649 E621                <1> 	out 0x21, al
  6654 0000564B 30C0                <1> 	xor al, al
  6655 0000564D E6A1                <1> 	out 0xA1, al
  6656 0000564F B020                <1> 	mov al, 0x20
  6657 00005651 E6A0                <1> 	out 0xA0, al
  6658 00005653 E620                <1> 	out 0x20, al
  6659 00005655 C3                  <1> 	ret
  6660                              <1> .pit:
  6661                              <1> 	;initialize the PIT
  6662 00005656 66A1[30060000]      <1> 	mov ax, [pitdiv] ;this is the divider for the PIT
  6663 0000565C E640                <1> 	out 0x40, al
  6664 0000565E 66C1C008            <1> 	rol ax, 8
  6665 00005662 E640                <1> 	out 0x40, al
  6666                              <1> 	;enable rtc interrupt
  6667 00005664 B00B                <1> 	mov al, 0xB
  6668 00005666 E670                <1> 	out 0x70, al
  6669 00005668 66C1C008            <1> 	rol ax, 8
  6670 0000566C E471                <1> 	in al, 0x71
  6671 0000566E 66C1C008            <1> 	rol ax, 8
  6672 00005672 E670                <1> 	out 0x70, al
  6673 00005674 66C1C008            <1> 	rol ax, 8
  6674 00005678 0C40                <1> 	or al, 0x40
  6675 0000567A E671                <1> 	out 0x71, al
  6676 0000567C C3                  <1> 	ret
  6677                              <1> .fpu:
  6678                              <1> 	;And now to initialize the fpu
  6679 0000567D 0F20E0              <1> 	mov eax, cr4
  6680 00005680 0D00020000          <1> 	or eax, 0x200
  6681 00005685 0F22E0              <1> 	mov cr4, eax
  6682 00005688 B87F0B0000          <1> 	mov eax, 0xB7F
  6683 0000568D 50                  <1> 	push eax
  6684 0000568E D92C24              <1> 	fldcw [esp]
  6685 00005691 58                  <1> 	pop eax
  6686 00005692 C3                  <1> 	ret
  6687                              <1> 	
  6688                                      %include 'source/gui.asm'
  6689                              <1> guiclear:
  6690 00005693 8B3D[D18A0000]      <1> 	mov edi, [physbaseptr]
  6691 00005699 668B15[BB8A0000]    <1> 	mov dx, [resolutionx]
  6692 000056A0 668B0D[BD8A0000]    <1> 	mov cx, [resolutiony]
  6693 000056A7 66A1[D0560000]      <1> 	mov ax, [background]
  6694                              <1> guiclearloop:
  6695 000056AD 668907              <1> 	mov [edi], ax
  6696 000056B0 81C702000000        <1> 	add edi, 2
  6697 000056B6 664A                <1> 	dec dx
  6698 000056B8 6681FA0000          <1> 	cmp dx, 0
  6699 000056BD 77EE                <1> 	ja guiclearloop
  6700 000056BF 6649                <1> 	dec cx
  6701 000056C1 668B15[BB8A0000]    <1> 	mov dx, [resolutionx]
  6702 000056C8 6681F90000          <1> 	cmp cx, 0
  6703 000056CD 77DE                <1> 	ja guiclearloop
  6704 000056CF C3                  <1> 	ret
  6705                              <1> 
  6706 000056D0 CF7B                <1> background dw 0111101111001111b
  6707                              <1> 
  6708                              <1> gui:	;Let's see what I can do, I am going to try to make this as freestanding as possible
  6709 000056D2 31C0                <1> 	xor eax, eax
  6710 000056D4 31DB                <1> 	xor ebx, ebx
  6711 000056D6 31C9                <1> 	xor ecx, ecx
  6712 000056D8 31D2                <1> 	xor edx, edx
  6713 000056DA 8B3D[D18A0000]      <1> 	mov edi, [physbaseptr]
  6714 000056E0 668B15[BB8A0000]    <1> 	mov dx, [resolutionx]
  6715 000056E7 668B0D[BD8A0000]    <1> 	mov cx, [resolutiony]
  6716 000056EE 668B1D[D0560000]    <1> 	mov bx, [background]
  6717                              <1> guiclearloop2:
  6718 000056F5 66891F              <1> 	mov [edi], bx
  6719 000056F8 81C702000000        <1> 	add edi, 2
  6720 000056FE 664A                <1> 	dec dx
  6721 00005700 6681FA0000          <1> 	cmp dx, 0
  6722 00005705 0F85EAFFFFFF        <1> 	jne near guiclearloop2
  6723 0000570B 6649                <1> 	dec cx
  6724 0000570D 668B15[BB8A0000]    <1> 	mov dx, [resolutionx]
  6725 00005714 6681F90000          <1> 	cmp cx, 0
  6726 00005719 0F85D6FFFFFF        <1> 	jne near guiclearloop2
  6727 0000571F C605[AB8B0000]01    <1> 	mov byte [guion], 1
  6728 00005726 C605[04580000]00    <1> 	mov byte [mouseselecton], 0
  6729 0000572D 31C0                <1> 	xor eax, eax
  6730 0000572F 31DB                <1> 	xor ebx, ebx
  6731 00005731 31C9                <1> 	xor ecx, ecx
  6732 00005733 31D2                <1> 	xor edx, edx
  6733                              <1> 	
  6734 00005735 BE[DC690000]        <1> 	mov esi, pacmsg
  6735 0000573A 6631C0              <1> 	xor ax, ax
  6736 0000573D 31DB                <1> 	xor ebx, ebx
  6737 0000573F 66B99000            <1> 	mov cx, 144
  6738 00005743 66BA0400            <1> 	mov dx, 4
  6739 00005747 E8640A0000          <1> 	call showstring
  6740                              <1> 	
  6741 0000574C BE[176B0000]        <1> 	mov esi, interneticon
  6742 00005751 6631C0              <1> 	xor ax, ax
  6743 00005754 BB[496A0000]        <1> 	mov ebx, noie
  6744 00005759 66B91800            <1> 	mov cx, 24
  6745 0000575D 66BA0400            <1> 	mov dx, 4
  6746 00005761 E8F40E0000          <1> 	call showicon
  6747                              <1> 	
  6748 00005766 BE[996B0000]        <1> 	mov esi, wordicon
  6749 0000576B 6631C0              <1> 	xor ax, ax
  6750 0000576E 31DB                <1> 	xor ebx, ebx
  6751 00005770 66B91800            <1> 	mov cx, 24
  6752 00005774 66BA3000            <1> 	mov dx, 48
  6753 00005778 E8DD0E0000          <1> 	call showicon
  6754                              <1> 	
  6755 0000577D BE[1B6C0000]        <1> 	mov esi, pacmanpellet
  6756 00005782 6631C0              <1> 	xor ax, ax
  6757 00005785 31DB                <1> 	xor ebx, ebx
  6758 00005787 66B94000            <1> 	mov cx, 64
  6759 0000578B 66BA0400            <1> 	mov dx, 4
  6760 0000578F E8C60E0000          <1> 	call showicon
  6761                              <1> 	
  6762 00005794 BE[1F6D0000]        <1> 	mov esi, pacman
  6763 00005799 6631C0              <1> 	xor ax, ax
  6764 0000579C BB[326A0000]        <1> 	mov ebx, pacmannomnom
  6765 000057A1 66B94000            <1> 	mov cx, 64
  6766 000057A5 66BA3000            <1> 	mov dx, 48
  6767 000057A9 E8AC0E0000          <1> 	call showicon
  6768                              <1> 	
  6769 000057AE BE[9D6C0000]        <1> 	mov esi, ghostie
  6770 000057B3 6631C0              <1> 	xor ax, ax
  6771 000057B6 BB[1B6A0000]        <1> 	mov ebx, boo
  6772 000057BB 66B96C00            <1> 	mov cx, 108
  6773 000057BF 66BA0400            <1> 	mov dx, 4
  6774 000057C3 E8920E0000          <1> 	call showicon
  6775                              <1> 
  6776 000057C8 BE[C8690000]        <1> 	mov esi, start
  6777 000057CD 668B0D[BD8A0000]    <1> 	mov cx, [resolutiony]
  6778 000057D4 6681E91000          <1> 	sub cx, 16
  6779 000057D9 66BA0200            <1> 	mov dx, 2
  6780 000057DD 30E4                <1> 	xor ah, ah
  6781 000057DF B010                <1> 	mov al, 00010000b
  6782 000057E1 BB[C46A0000]        <1> 	mov ebx, winblows
  6783 000057E6 E8C5090000          <1> 	call showstring
  6784                              <1> 	
  6785 000057EB E8EAF7FFFF          <1> 	call cursorgui
  6786                              <1> guistart:
  6787 000057F0 E8FDFAFFFF          <1> 	call getkey
  6788 000057F5 C605[FE570000]00    <1> 	mov byte [copygui], 0
  6789 000057FC EBF2                <1> 	jmp guistart
  6790                              <1> 	
  6791                              <1> ;guicopy:	;;for double buffering
  6792                              <1> ;	mov byte [copygui], 1
  6793                              <1> ;	mov edi, [offscreenmemoffset]
  6794                              <1> ;	xor edx, edx
  6795                              <1> ;	xor ecx, ecx
  6796                              <1> ;	mov dx, [mousecursorposition]
  6797                              <1> ;	mov cx, [mousecursorposition + 2]
  6798                              <1> ;	add edi, edx
  6799                              <1> ;	mov dx, [resolutionx2]
  6800                              <1> ;	inc cx
  6801                              <1> ;guicp2:
  6802                              <1> ;	add edi, edx
  6803                              <1> ;	dec cx
  6804                              <1> ;	cmp cx, 0
  6805                              <1> ;	jne guicp2
  6806                              <1> ;	sub edi, edx
  6807                              <1> ;	mov [cursorloc], edi
  6808                              <1> ;	mov ebx, cursorbmp
  6809                              <1> ;	mov cx, [resolutiony]
  6810                              <1> ;	rol ecx, 16
  6811                              <1> ;	mov cx, [resolutionx]
  6812                              <1> ;	mov esi, [physbaseptr]
  6813                              <1> ;	mov edi, [offscreenmemoffset]
  6814                              <1> ;guicp1:
  6815                              <1> ;	mov ax, [esi]
  6816                              <1> ;	mov [edi], ax
  6817                              <1> ;	add esi, 2
  6818                              <1> ;	add edi, 2
  6819                              <1> ;	cmp edi, [cursorloc]
  6820                              <1> ;	je copycursor
  6821                              <1> ;dncopycursor:
  6822                              <1> ;	dec cx
  6823                              <1> ;	cmp cx, 0
  6824                              <1> ;	jne guicp1
  6825                              <1> ;	mov cx, [resolutionx]
  6826                              <1> ;	rol ecx, 16
  6827                              <1> ;	dec cx
  6828                              <1> ;	cmp cx, 0
  6829                              <1> ;	rol ecx, 16
  6830                              <1> ;	jne guicp1
  6831                              <1> ;	mov byte [copygui], 0
  6832                              <1> ;	ret
  6833                              <1> ;copycursor:
  6834                              <1> ;	cmp ebx, cursorbmpend
  6835                              <1> ;	jae dncopycursor
  6836                              <1> ;	mov dx, [resolutionx2]
  6837                              <1> ;	add edi, edx
  6838                              <1> ;	mov [cursorloc], edi
  6839                              <1> ;	sub edi, edx
  6840                              <1> ;	dec ebx
  6841                              <1> ;	sub edi, 2
  6842                              <1> ;	sub esi, 2
  6843                              <1> ;	mov dx, 9
  6844                              <1> ;curscplp:
  6845                              <1> ;	inc ebx
  6846                              <1> ;	add esi, 2
  6847                              <1> ;	add edi, 2
  6848                              <1> ;	mov ax, [esi]
  6849                              <1> ;	mov [edi], ax
  6850                              <1> ;	mov al, [ebx]
  6851                              <1> ;	cmp al, 0
  6852                              <1> ;	je curscplp2
  6853                              <1> ;	mov word [edi], 1110011110011100b
  6854                              <1> ;curscplp2:
  6855                              <1> ;	dec cx
  6856                              <1> ;	cmp cx, 0
  6857                              <1> ;	je dncopycursor
  6858                              <1> ;	dec dx
  6859                              <1> ;	cmp dx, 0
  6860                              <1> ;	jne curscplp
  6861                              <1> ;	jmp dncopycursor
  6862                              <1> 	
  6863                              <1> 	
  6864                              <1> ;cursorloc: dd 0
  6865                              <1> 				
  6866 000057FE 00                  <1> copygui db 0
  6867 000057FF 00                  <1> graphicsset db 0
  6868 00005800 0000                <1> graphicspos db 0,0
  6869 00005802 00                  <1> showcursorfonton db 0
  6870 00005803 00                  <1> savefonton db 0
  6871 00005804 00                  <1> mouseselecton db 0
  6872                              <1> 
  6873                              <1> 		
  6874                              <1> clearmousecursor:
  6875 00005805 BE[D0560000]        <1> 		mov esi, background
  6876 0000580A 8B3D[D18A0000]      <1> 		mov edi, [physbaseptr]
  6877 00005810 31D2                <1> 		xor edx, edx
  6878 00005812 31C9                <1> 		xor ecx, ecx
  6879 00005814 668B15[B8510000]    <1> 		mov dx, [lastmouseposition]
  6880 0000581B 668B0D[BA510000]    <1> 		mov cx, [lastmouseposition + 2]
  6881 00005822 01D7                <1> 		add edi, edx
  6882 00005824 31D2                <1> 		xor edx, edx
  6883 00005826 668B15[A98B0000]    <1> 		mov dx, [resolutionx2]
  6884 0000582D 6681F90000          <1> 		cmp cx, 0
  6885 00005832 740B                <1> 		je noyclr
  6886 00005834 01D7                <1> yclr:	add edi, edx
  6887 00005836 6649                <1> 		dec cx
  6888 00005838 6681F90000          <1> 		cmp cx, 0
  6889 0000583D 75F5                <1> 		jne yclr
  6890 0000583F 668B06              <1> noyclr:	mov ax, [esi]
  6891 00005842 C1C010              <1> 		rol eax, 16
  6892 00005845 668B06              <1> 		mov ax, [esi]
  6893 00005848 8907                <1> 		mov [edi], eax
  6894 0000584A 894704              <1> 		mov [edi + 4], eax
  6895 0000584D 894708              <1> 		mov [edi + 8], eax
  6896 00005850 89470C              <1> 		mov [edi + 12], eax
  6897 00005853 01D7                <1> 		add edi, edx
  6898 00005855 6641                <1> 		inc cx
  6899 00005857 6681F91000          <1> 		cmp cx, 16
  6900 0000585C 72E1                <1> 		jb noyclr
  6901 0000585E C3                  <1> 		ret
  6902                              <1> 
  6903                              <1> switchmousepos:		;;switch were the mouse is located
  6904 0000585F BE[129F0000]        <1> 		mov esi, mousecolorbuf
  6905 00005864 8B3D[D18A0000]      <1> 		mov edi, [physbaseptr]
  6906 0000586A 31D2                <1> 		xor edx, edx
  6907 0000586C 31C9                <1> 		xor ecx, ecx
  6908 0000586E 668B15[B8510000]    <1> 		mov dx, [lastmouseposition]
  6909 00005875 668B0D[BA510000]    <1> 		mov cx, [lastmouseposition + 2]
  6910 0000587C 01D7                <1> 		add edi, edx
  6911 0000587E 31D2                <1> 		xor edx, edx
  6912 00005880 668B15[A98B0000]    <1> 		mov dx, [resolutionx2]
  6913 00005887 6681F90000          <1> 		cmp cx, 0
  6914 0000588C 740B                <1> 		je noswmsy
  6915 0000588E 01D7                <1> swmsy:		add edi, edx
  6916 00005890 6649                <1> 		dec cx
  6917 00005892 6681F90000          <1> 		cmp cx, 0
  6918 00005897 75F5                <1> 		jne swmsy
  6919 00005899 8B06                <1> noswmsy:	mov eax, [esi]
  6920 0000589B 8B5E04              <1> 		mov ebx, [esi + 4]
  6921 0000589E 8907                <1> 		mov [edi], eax
  6922 000058A0 895F04              <1> 		mov [edi + 4], ebx
  6923 000058A3 8B4608              <1> 		mov eax, [esi + 8]
  6924 000058A6 8B5E0C              <1> 		mov ebx, [esi + 12]
  6925 000058A9 894708              <1> 		mov [edi + 8], eax
  6926 000058AC 895F0C              <1> 		mov [edi + 12], ebx
  6927 000058AF 01D7                <1> 		add edi, edx
  6928 000058B1 81C610000000        <1> 		add esi, 16
  6929 000058B7 81FE[12A00000]      <1> 		cmp esi, mcolorend
  6930 000058BD 72DA                <1> 		jb noswmsy
  6931                              <1> 		
  6932                              <1> switchmousepos2:
  6933 000058BF BE[129F0000]        <1> 		mov esi, mousecolorbuf
  6934 000058C4 8B3D[D18A0000]      <1> 		mov edi, [physbaseptr]
  6935 000058CA 31D2                <1> 		xor edx, edx
  6936 000058CC 31C9                <1> 		xor ecx, ecx
  6937 000058CE 668B15[BC510000]    <1> 		mov dx, [mousecursorposition]
  6938 000058D5 668B0D[BE510000]    <1> 		mov cx, [mousecursorposition + 2]
  6939 000058DC 01D7                <1> 		add edi, edx
  6940 000058DE 31D2                <1> 		xor edx, edx
  6941 000058E0 668B15[A98B0000]    <1> 		mov dx, [resolutionx2]
  6942 000058E7 6681F90000          <1> 		cmp cx, 0
  6943 000058EC 740B                <1> 		je noswmsy2
  6944 000058EE 01D7                <1> swmsy2:		add edi, edx
  6945 000058F0 6649                <1> 		dec cx
  6946 000058F2 6681F90000          <1> 		cmp cx, 0
  6947 000058F7 75F5                <1> 		jne swmsy2
  6948 000058F9 8B07                <1> noswmsy2:	mov eax, [edi]
  6949 000058FB 8B5F04              <1> 		mov ebx, [edi + 4]
  6950 000058FE 8906                <1> 		mov [esi], eax
  6951 00005900 895E04              <1> 		mov [esi + 4], ebx
  6952 00005903 8B4708              <1> 		mov eax, [edi + 8]
  6953 00005906 8B5F0C              <1> 		mov ebx, [edi + 12]
  6954 00005909 894608              <1> 		mov [esi + 8], eax
  6955 0000590C 895E0C              <1> 		mov [esi + 12], ebx
  6956 0000590F 01D7                <1> 		add edi, edx
  6957 00005911 81C610000000        <1> 		add esi, 16
  6958 00005917 81FE[12A00000]      <1> 		cmp esi, mcolorend
  6959 0000591D 72DA                <1> 		jb noswmsy2
  6960 0000591F C3                  <1> 		ret
  6961                              <1> 
  6962 00005920 00                  <1> pbutton db 0
  6963 00005921 00                  <1> pLBUTTON db 0
  6964 00005922 00                  <1> pRBUTTON db 0
  6965 00005923 00000000            <1> dragging dw 0,0
  6966 00005927 0000000000000000    <1> lastpos dw 0,0,0,0
  6967 0000592F 00000000            <1> colorbuf dw 0,0
  6968                              <1> 	
  6969                              <1> 	clickicon:
  6970 00005933 B001                <1> 		mov al, 1
  6971 00005935 A2[20590000]        <1> 		mov [pbutton], al
  6972 0000593A A0[21590000]        <1> 		mov al, [pLBUTTON]
  6973 0000593F 2205[CD520000]      <1> 		and al, [LBUTTON]
  6974 00005945 8A25[22590000]      <1> 		mov ah, [pRBUTTON]
  6975 0000594B 2225[CE520000]      <1> 		and ah, [RBUTTON]
  6976 00005951 08E0                <1> 		or al, ah
  6977 00005953 3C00                <1> 		cmp al, 0
  6978 00005955 741B                <1> 		je nodragclick
  6979 00005957 813D[23590000]0100- <1> 		cmp dword [dragging], 1
  6980 0000595F 0000                <1>
  6981 00005961 732D                <1> 		jae dragclick
  6982 00005963 C705[23590000]0100- <1> 		mov dword [dragging], 1
  6983 0000596B 0000                <1>
  6984 0000596D E91E000000          <1> 		jmp dragclick
  6985                              <1> 	nodragclick:
  6986 00005972 C705[23590000]0000- <1> 		mov dword [dragging], 0
  6987 0000597A 0000                <1>
  6988 0000597C A0[CD520000]        <1> 		mov al, [LBUTTON]
  6989 00005981 A2[21590000]        <1> 		mov [pLBUTTON], al
  6990 00005986 A0[CE520000]        <1> 		mov al, [RBUTTON]
  6991 0000598B A2[22590000]        <1> 		mov [pRBUTTON], al
  6992                              <1> 	dragclick:
  6993 00005990 6631C0              <1> 		xor ax, ax
  6994 00005993 BE[129D0000]        <1> 		mov esi, graphicstable
  6995 00005998 C705[166A0000]0000- <1> 		mov dword [codepointer], 0
  6996 000059A0 0000                <1>
  6997                              <1> 	clicon2:
  6998 000059A2 31D2                <1> 		xor edx, edx
  6999 000059A4 31C9                <1> 		xor ecx, ecx
  7000 000059A6 66813E0100          <1> 		cmp word [esi], 1
  7001 000059AB 0F841B000000        <1> 		je near iconselect
  7002 000059B1 66813E0200          <1> 		cmp word [esi], 2
  7003 000059B6 0F8472010000        <1> 		je near textselected
  7004 000059BC 66813E0300          <1> 		cmp word [esi], 3
  7005 000059C1 0F84C7020000        <1> 		je near windowselect
  7006 000059C7 E901040000          <1> 		jmp nexticonsel
  7007                              <1> 	iconselect:
  7008 000059CC 668B5606            <1> 		mov dx, [esi + 6]
  7009 000059D0 6689D0              <1> 		mov ax, dx
  7010 000059D3 668B4E08            <1> 		mov cx, [esi + 8]
  7011 000059D7 6689CB              <1> 		mov bx, cx
  7012 000059DA 6681C32000          <1> 		add bx, 32
  7013 000059DF 6601D0              <1> 		add ax, dx
  7014 000059E2 813D[23590000]0100- <1> 		cmp dword [dragging], 1
  7015 000059EA 0000                <1>
  7016 000059EC 746F                <1> 		je dragicon
  7017 000059EE 813D[23590000]0000- <1> 		cmp dword [dragging], 0
  7018 000059F6 0000                <1>
  7019 000059F8 7411                <1> 		je nodragiconcheck
  7020 000059FA 3935[23590000]      <1> 		cmp dword [dragging], esi
  7021 00005A00 0F85C7030000        <1> 		jne near nexticonsel
  7022 00005A06 E952000000          <1> 		jmp dragicon
  7023                              <1> 	nodragiconcheck:
  7024 00005A0B 663905[BC510000]    <1> 		cmp [mousecursorposition], ax
  7025 00005A12 0F82B5030000        <1> 		jb near nexticonsel
  7026 00005A18 66054000            <1> 		add ax, 64
  7027 00005A1C 663905[BC510000]    <1> 		cmp [mousecursorposition], ax
  7028 00005A23 0F87A4030000        <1> 		ja near nexticonsel
  7029 00005A29 6629D0              <1> 		sub ax, dx
  7030 00005A2C 66390D[BE510000]    <1> 		cmp [mousecursorposition + 2], cx
  7031 00005A33 0F8294030000        <1> 		jb near nexticonsel
  7032 00005A39 66391D[BE510000]    <1> 		cmp [mousecursorposition + 2], bx
  7033 00005A40 0F8787030000        <1> 		ja near nexticonsel
  7034 00005A46 668B460A            <1> 		mov ax, [esi + 10]
  7035 00005A4A 66250100            <1> 		and ax, 1
  7036 00005A4E 663D0100            <1> 		cmp ax, 1
  7037 00005A52 0F84B6000000        <1> 		je near unselecticon
  7038 00005A58 E98D000000          <1> 		jmp nodragicon
  7039                              <1> 	dragicon:
  7040 00005A5D 663905[B8510000]    <1> 		cmp [lastmouseposition], ax
  7041 00005A64 0F8263030000        <1> 		jb near nexticonsel
  7042 00005A6A 66054000            <1> 		add ax, 64
  7043 00005A6E 663905[B8510000]    <1> 		cmp [lastmouseposition], ax
  7044 00005A75 0F8752030000        <1> 		ja near nexticonsel
  7045 00005A7B 6629D0              <1> 		sub ax, dx
  7046 00005A7E 66390D[BA510000]    <1> 		cmp [lastmouseposition + 2], cx
  7047 00005A85 0F8242030000        <1> 		jb near nexticonsel
  7048 00005A8B 66391D[BA510000]    <1> 		cmp [lastmouseposition + 2], bx
  7049 00005A92 0F8735030000        <1> 		ja near nexticonsel
  7050 00005A98 668B460A            <1> 		mov ax, [esi + 10]
  7051 00005A9C 2410                <1> 		and al, 00010000b
  7052 00005A9E 3C10                <1> 		cmp al, 00010000b
  7053 00005AA0 7448                <1> 		je nodragicon
  7054 00005AA2 8935[23590000]      <1> 		mov [dragging], esi
  7055 00005AA8 66D1E2              <1> 		shl dx, 1
  7056 00005AAB 662B15[B8510000]    <1> 		sub dx, [lastmouseposition]
  7057 00005AB2 660315[BC510000]    <1> 		add dx, [mousecursorposition]
  7058 00005AB9 66D1EA              <1> 		shr dx, 1
  7059 00005ABC 66030D[BE510000]    <1> 		add cx, [mousecursorposition + 2]
  7060 00005AC3 662B0D[BA510000]    <1> 		sub cx, [lastmouseposition + 2]
  7061 00005ACA 663B15[A98B0000]    <1> 		cmp dx, [resolutionx2]
  7062 00005AD1 7607                <1> 		jbe chkyresdrgicn
  7063 00005AD3 668B15[BC510000]    <1> 		mov dx, [mousecursorposition]
  7064                              <1> 	chkyresdrgicn:
  7065 00005ADA 663B0D[BD8A0000]    <1> 		cmp cx, [resolutiony]
  7066 00005AE1 7607                <1> 		jbe nodragicon
  7067 00005AE3 668B0D[BE510000]    <1> 		mov cx, [mousecursorposition + 2]
  7068                              <1> 	nodragicon:
  7069 00005AEA 66814E0A0100        <1> 		or word [esi + 10], 1
  7070 00005AF0 8B5E0C              <1> 		mov ebx, [esi + 12]
  7071 00005AF3 668B460A            <1> 		mov ax, [esi + 10]
  7072 00005AF7 8B7602              <1> 		mov esi, [esi + 2]
  7073 00005AFA C705[166A0000]0000- <1> 		mov dword [codepointer], 0
  7074 00005B02 0000                <1>
  7075 00005B04 E8510B0000          <1> 		call showicon
  7076 00005B09 E9D8020000          <1> 		jmp doneiconsel
  7077                              <1> 	unselecticon:
  7078 00005B0E 6681660AFEFF        <1> 		and word [esi + 10], 0xFFFE
  7079 00005B14 8B5E0C              <1> 		mov ebx, [esi + 12]
  7080 00005B17 668B460A            <1> 		mov ax, [esi + 10]
  7081 00005B1B 8B7602              <1> 		mov esi, [esi + 2]
  7082 00005B1E 891D[166A0000]      <1> 		mov [codepointer], ebx
  7083 00005B24 E8310B0000          <1> 		call showicon
  7084 00005B29 E9B8020000          <1> 		jmp doneiconsel
  7085                              <1> 	textselected:
  7086 00005B2E 8B5E02              <1> 		mov ebx, [esi + 2]
  7087 00005B31 668B5606            <1> 		mov dx, [esi + 6]
  7088 00005B35 6689D0              <1> 		mov ax, dx
  7089 00005B38 668B4E08            <1> 		mov cx, [esi + 8]
  7090                              <1> 	lengthtesttext:
  7091 00005B3C 803B00              <1> 		cmp byte [ebx], 0
  7092 00005B3F 7407                <1> 		je donetesttextlength
  7093 00005B41 43                  <1> 		inc ebx
  7094 00005B42 66051000            <1> 		add ax, 16
  7095 00005B46 EBF4                <1> 		jmp lengthtesttext
  7096                              <1> 	donetesttextlength:
  7097 00005B48 6689CB              <1> 		mov bx, cx
  7098 00005B4B 6681C30F00          <1> 		add bx, 15
  7099 00005B50 813D[23590000]0100- <1> 		cmp dword [dragging], 1
  7100 00005B58 0000                <1>
  7101 00005B5A 7468                <1> 		je dragtext
  7102 00005B5C 813D[23590000]0000- <1> 		cmp dword [dragging], 0
  7103 00005B64 0000                <1>
  7104 00005B66 7411                <1> 		je nodragtextcheck
  7105 00005B68 3935[23590000]      <1> 		cmp dword [dragging], esi
  7106 00005B6E 0F8559020000        <1> 		jne near nexticonsel
  7107 00005B74 E94B000000          <1> 		jmp dragtext
  7108                              <1> 	nodragtextcheck:
  7109 00005B79 663915[BC510000]    <1> 		cmp [mousecursorposition], dx
  7110 00005B80 0F8247020000        <1> 		jb near nexticonsel
  7111 00005B86 663905[BC510000]    <1> 		cmp [mousecursorposition], ax
  7112 00005B8D 0F873A020000        <1> 		ja near nexticonsel
  7113 00005B93 66390D[BE510000]    <1> 		cmp [mousecursorposition + 2], cx
  7114 00005B9A 0F822D020000        <1> 		jb near nexticonsel
  7115 00005BA0 66391D[BE510000]    <1> 		cmp [mousecursorposition + 2], bx
  7116 00005BA7 0F8720020000        <1> 		ja near nexticonsel
  7117 00005BAD 668B460A            <1> 		mov ax, [esi + 10]
  7118 00005BB1 66250100            <1> 		and ax, 1
  7119 00005BB5 663D0100            <1> 		cmp ax, 1
  7120 00005BB9 0F84AB000000        <1> 		je near unselecttext
  7121 00005BBF E986000000          <1> 		jmp nodragtext
  7122                              <1> 	dragtext:
  7123 00005BC4 663915[B8510000]    <1> 		cmp [lastmouseposition], dx
  7124 00005BCB 0F82FC010000        <1> 		jb near nexticonsel
  7125 00005BD1 663905[B8510000]    <1> 		cmp [lastmouseposition], ax
  7126 00005BD8 0F87EF010000        <1> 		ja near nexticonsel
  7127 00005BDE 66390D[BA510000]    <1> 		cmp [lastmouseposition + 2], cx
  7128 00005BE5 0F82E2010000        <1> 		jb near nexticonsel
  7129 00005BEB 66391D[BA510000]    <1> 		cmp [lastmouseposition + 2], bx
  7130 00005BF2 0F87D5010000        <1> 		ja near nexticonsel
  7131 00005BF8 668B460A            <1> 		mov ax, [esi + 10]
  7132 00005BFC 2410                <1> 		and al, 00010000b
  7133 00005BFE 663D1000            <1> 		cmp ax, 00010000b
  7134 00005C02 0F8442000000        <1> 		je near nodragtext
  7135 00005C08 8935[23590000]      <1> 		mov [dragging], esi
  7136 00005C0E 662B15[B8510000]    <1> 		sub dx, [lastmouseposition]
  7137 00005C15 660315[BC510000]    <1> 		add dx, [mousecursorposition]
  7138 00005C1C 66030D[BE510000]    <1> 		add cx, [mousecursorposition + 2]
  7139 00005C23 662B0D[BA510000]    <1> 		sub cx, [lastmouseposition + 2]
  7140 00005C2A 663B15[A98B0000]    <1> 		cmp dx, [resolutionx2]
  7141 00005C31 7607                <1> 		jbe chkyresdrgtxt
  7142 00005C33 668B15[BC510000]    <1> 		mov dx, [mousecursorposition]
  7143                              <1> 	chkyresdrgtxt:
  7144 00005C3A 663B0D[BD8A0000]    <1> 		cmp cx, [resolutiony]
  7145 00005C41 7607                <1> 		jbe nodragtext
  7146 00005C43 668B0D[BE510000]    <1> 		mov cx, [mousecursorposition + 2]
  7147                              <1> 	nodragtext:
  7148 00005C4A 66814E0A0100        <1> 		or word [esi + 10], 1
  7149 00005C50 8B5E0C              <1> 		mov ebx, [esi + 12]
  7150 00005C53 891D[166A0000]      <1> 		mov [codepointer], ebx
  7151 00005C59 668B460A            <1> 		mov ax, [esi + 10]
  7152 00005C5D 8B7602              <1> 		mov esi, [esi + 2]
  7153 00005C60 E84B050000          <1> 		call showstring
  7154 00005C65 E97C010000          <1> 		jmp doneiconsel
  7155                              <1> 	unselecttext:
  7156 00005C6A 6681660AFEFF        <1> 		and word [esi + 10], 0xFFFE
  7157 00005C70 8B5E0C              <1> 		mov ebx, [esi + 12]
  7158 00005C73 668B460A            <1> 		mov ax, [esi + 10]
  7159 00005C77 8B7602              <1> 		mov esi, [esi + 2]
  7160 00005C7A C705[166A0000]0000- <1> 		mov dword [codepointer], 0
  7161 00005C82 0000                <1>
  7162 00005C84 E827050000          <1> 		call showstring
  7163 00005C89 E958010000          <1> 		jmp doneiconsel
  7164                              <1> windowselect:
  7165 00005C8E 8B7E02              <1> 		mov edi, [esi + 2]
  7166 00005C91 668B5606            <1> 		mov dx, [esi + 6]
  7167 00005C95 6689D0              <1> 		mov ax, dx
  7168 00005C98 668B4E08            <1> 		mov cx, [esi + 8]
  7169 00005C9C 6689CB              <1> 		mov bx, cx
  7170 00005C9F 6681C31000          <1> 		add bx, 16
  7171 00005CA4 813D[23590000]0100- <1> 		cmp dword [dragging], 1
  7172 00005CAC 0000                <1>
  7173 00005CAE 746D                <1> 		je dragwin
  7174 00005CB0 813D[23590000]0000- <1> 		cmp dword [dragging], 0
  7175 00005CB8 0000                <1>
  7176 00005CBA 7411                <1> 		je nodragwincheck
  7177 00005CBC 3935[23590000]      <1> 		cmp dword [dragging], esi
  7178 00005CC2 0F8505010000        <1> 		jne near nexticonsel
  7179 00005CC8 E950000000          <1> 		jmp dragwin
  7180                              <1> 	nodragwincheck:
  7181 00005CCD 663905[BC510000]    <1> 		cmp [mousecursorposition], ax
  7182 00005CD4 0F82F3000000        <1> 		jb near nexticonsel
  7183 00005CDA 660307              <1> 		add ax, [edi]
  7184 00005CDD 660307              <1> 		add ax, [edi]
  7185 00005CE0 663905[BC510000]    <1> 		cmp [mousecursorposition], ax
  7186 00005CE7 0F87E0000000        <1> 		ja near nexticonsel
  7187 00005CED 66390D[BE510000]    <1> 		cmp [mousecursorposition + 2], cx
  7188 00005CF4 0F82D3000000        <1> 		jb near nexticonsel
  7189 00005CFA 66391D[BE510000]    <1> 		cmp [mousecursorposition + 2], bx
  7190 00005D01 0F87C6000000        <1> 		ja near nexticonsel
  7191 00005D07 662D1400            <1> 		sub ax, 20
  7192 00005D0B 663905[BC510000]    <1> 		cmp [mousecursorposition], ax
  7193 00005D12 0F8795000000        <1> 		ja near killwin
  7194 00005D18 E97C000000          <1> 		jmp nodragwin
  7195                              <1> 	dragwin:
  7196 00005D1D 663905[B8510000]    <1> 		cmp [lastmouseposition], ax
  7197 00005D24 0F82A3000000        <1> 		jb near nexticonsel
  7198 00005D2A 660307              <1> 		add ax, [edi]
  7199 00005D2D 660307              <1> 		add ax, [edi]
  7200 00005D30 663905[B8510000]    <1> 		cmp [lastmouseposition], ax
  7201 00005D37 0F8790000000        <1> 		ja near nexticonsel
  7202 00005D3D 66390D[BA510000]    <1> 		cmp [lastmouseposition + 2], cx
  7203 00005D44 0F8283000000        <1> 		jb near nexticonsel
  7204 00005D4A 66391D[BA510000]    <1> 		cmp [lastmouseposition + 2], bx
  7205 00005D51 0F8776000000        <1> 		ja near nexticonsel
  7206 00005D57 8935[23590000]      <1> 		mov [dragging], esi
  7207 00005D5D 662B15[B8510000]    <1> 		sub dx, [lastmouseposition]
  7208 00005D64 660315[BC510000]    <1> 		add dx, [mousecursorposition]
  7209 00005D6B 66030D[BE510000]    <1> 		add cx, [mousecursorposition + 2]
  7210 00005D72 662B0D[BA510000]    <1> 		sub cx, [lastmouseposition + 2]
  7211 00005D79 663B15[A98B0000]    <1> 		cmp dx, [resolutionx2]
  7212 00005D80 7607                <1> 		jbe chkyresdrgwin
  7213 00005D82 668B15[BC510000]    <1> 		mov dx, [mousecursorposition]
  7214                              <1> 	chkyresdrgwin:
  7215 00005D89 663B0D[BD8A0000]    <1> 		cmp cx, [resolutiony]
  7216 00005D90 7607                <1> 		jbe nodragwin
  7217 00005D92 668B0D[BE510000]    <1> 		mov cx, [mousecursorposition + 2]
  7218                              <1> 	nodragwin:
  7219 00005D99 8B5E0C              <1> 		mov ebx, [esi + 12]
  7220 00005D9C 668B460A            <1> 		mov ax, [esi + 10]
  7221 00005DA0 8B7602              <1> 		mov esi, [esi + 2]
  7222 00005DA3 E870040000          <1> 		call showwindow
  7223 00005DA8 E939000000          <1> 		jmp doneiconsel
  7224                              <1> 	killwin:
  7225 00005DAD 66C7060000          <1> 		mov word [esi], 0
  7226 00005DB2 C605[C6270000]00    <1> 		mov byte [termguion], 0
  7227 00005DB9 E8D5F8FFFF          <1> 		call guiclear
  7228 00005DBE E8A7000000          <1> 		call reloadallgraphics
  7229 00005DC3 E928FAFFFF          <1> 		jmp guistart
  7230 00005DC8 E93A000000          <1> 		jmp doneiconsel2
  7231                              <1> 	nexticonsel:
  7232 00005DCD 6681660AFEFF        <1> 		and word [esi + 10], 0xFFFE
  7233 00005DD3 81C610000000        <1> 		add esi, 16
  7234 00005DD9 81FE[129F0000]      <1> 		cmp esi, graphicstableend
  7235 00005DDF 7305                <1> 		jae doneiconsel
  7236 00005DE1 E9BCFBFFFF          <1> 		jmp clicon2
  7237                              <1> 	doneiconsel:
  7238 00005DE6 813D[23590000]0100- <1> 		cmp dword [dragging], 1
  7239 00005DEE 0000                <1>
  7240 00005DF0 7315                <1> 		jae doneiconsel2
  7241 00005DF2 813D[166A0000]0000- <1> 		cmp dword [codepointer], 0
  7242 00005DFA 0000                <1>
  7243 00005DFC 7409                <1> 		je doneiconsel2
  7244 00005DFE 8B1D[166A0000]      <1> 		mov ebx, [codepointer]
  7245 00005E04 FFD3                <1> 		call ebx 
  7246 00005E06 C3                  <1> 		ret
  7247                              <1> 	doneiconsel2:
  7248 00005E07 A0[CD520000]        <1> 		mov al, [LBUTTON]
  7249 00005E0C A2[21590000]        <1> 		mov [pLBUTTON], al
  7250 00005E11 A0[CE520000]        <1> 		mov al, [RBUTTON]
  7251 00005E16 A2[22590000]        <1> 		mov [pRBUTTON], al
  7252 00005E1B 66813D[23590000]01- <1> 		cmp word [dragging], 1
  7253 00005E23 00                  <1>
  7254 00005E24 0F860A000000        <1> 		jbe near noreloadgraphicsclick
  7255 00005E2A E8D6F9FFFF          <1> call clearmousecursor
  7256 00005E2F E836000000          <1> call reloadallgraphics
  7257                              <1> noreloadgraphicsclick:
  7258 00005E34 31C9                <1> 		xor ecx, ecx
  7259 00005E36 31D2                <1> 		xor edx, edx
  7260 00005E38 30E4                <1> 		xor ah, ah
  7261 00005E3A B0FE                <1> 		mov al, 254
  7262 00005E3C 668B15[BC510000]    <1> 		mov dx, [mousecursorposition]
  7263 00005E43 668B0D[BE510000]    <1> 		mov cx, [mousecursorposition + 2]
  7264 00005E4A 66BBE738            <1> 		mov bx, 0011100011100111b
  7265 00005E4E C605[02580000]01    <1> 		mov byte [showcursorfonton], 1
  7266 00005E55 E8DA080000          <1> 		call showfontvesa
  7267 00005E5A C605[02580000]00    <1> 		mov byte [showcursorfonton], 0
  7268 00005E61 C3                  <1> 		ret
  7269 00005E62 00000000            <1> lastdrag dw 0,0
  7270 00005E66 00000000            <1> grpctblpos dw 0,0
  7271                              <1> 
  7272                              <1> reloadallgraphics:
  7273 00005E6A BF[129D0000]        <1> 		mov edi, graphicstable
  7274                              <1> reloadgraphicsloop:
  7275 00005E6F 8B7702              <1> 		mov esi, [edi + 2]
  7276 00005E72 668B5706            <1> 		mov dx, [edi + 6]
  7277 00005E76 668B4F08            <1> 		mov cx, [edi + 8]
  7278 00005E7A 668B07              <1> 		mov ax, [edi]
  7279 00005E7D 668B5F0A            <1> 		mov bx, [edi + 10]
  7280 00005E81 893D[665E0000]      <1> 		mov [grpctblpos], edi
  7281 00005E87 3B3D[23590000]      <1> 		cmp edi, [dragging]
  7282 00005E8D 741E                <1> 		je loadedgraphic
  7283 00005E8F 663D0100            <1> 		cmp ax, 1
  7284 00005E93 0F8436000000        <1> 		je near icongraphic
  7285 00005E99 663D0200            <1> 		cmp ax, 2
  7286 00005E9D 0F843C000000        <1> 		je near stringgraphic
  7287 00005EA3 663D0300            <1> 		cmp ax, 3
  7288 00005EA7 0F8416000000        <1> 		je near windowgraphic
  7289 00005EAD 8B3D[665E0000]      <1> loadedgraphic:  mov edi, [grpctblpos]
  7290 00005EB3 81C710000000        <1> 		add edi, 16
  7291 00005EB9 81FF[129F0000]      <1> 		cmp edi, graphicstableend
  7292 00005EBF 732E                <1> 		jae donereloadgraphics
  7293 00005EC1 EBAC                <1> 		jmp reloadgraphicsloop
  7294 00005EC3 E8F8030000          <1> windowgraphic:	call showwindow2
  7295 00005EC8 E8E0C4FFFF          <1> 		call cleardouble
  7296 00005ECD EBDE                <1> 		jmp loadedgraphic
  7297 00005ECF 80E301              <1> icongraphic:	and bl, 1
  7298 00005ED2 881D[1A6A0000]      <1> 		mov [iconselected], bl
  7299 00005ED8 E890070000          <1> 		call showicon2
  7300 00005EDD EBCE                <1> 		jmp loadedgraphic
  7301 00005EDF 80E301              <1> stringgraphic:  and bl, 1
  7302 00005EE2 881D[04580000]      <1> 		mov [mouseselecton], bl
  7303 00005EE8 E8D6020000          <1> 		call showstring2
  7304 00005EED EBBE                <1> 		jmp loadedgraphic
  7305                              <1> donereloadgraphics:
  7306 00005EEF 8B3D[23590000]      <1> 		mov edi, [dragging]
  7307 00005EF5 81FF[129D0000]      <1> 		cmp edi, graphicstable
  7308 00005EFB 7226                <1> 		jb notcorrectdrag
  7309 00005EFD 668B07              <1> 		mov ax, [edi]
  7310 00005F00 8B7702              <1> 		mov esi, [edi + 2]
  7311 00005F03 668B5706            <1> 		mov dx, [edi + 6]
  7312 00005F07 668B4F08            <1> 		mov cx, [edi + 8]
  7313 00005F0B 668B5F0A            <1> 		mov bx, [edi + 10]
  7314 00005F0F 663D0100            <1> 		cmp ax, 1
  7315 00005F13 750F                <1> 		jne noticondragging
  7316 00005F15 80E301              <1> 		and bl, 1
  7317 00005F18 881D[1A6A0000]      <1> 		mov [iconselected], bl
  7318 00005F1E E84A070000          <1> 		call showicon2
  7319                              <1> notcorrectdrag:
  7320 00005F23 C3                  <1> 		ret
  7321                              <1> 
  7322                              <1> 	noticondragging:
  7323 00005F24 663D0200            <1> 		cmp ax, 2
  7324 00005F28 75F9                <1> 		jne notcorrectdrag
  7325 00005F2A 80E301              <1> 		and bl, 1
  7326 00005F2D 881D[04580000]      <1> 		mov [mouseselecton], bl
  7327 00005F33 E88B020000          <1> 		call showstring2
  7328 00005F38 EBE9                <1> 		jmp notcorrectdrag
  7329                              <1> 
  7330 00005F3A 00<rept>            <1> grphbuf times 16 db 0
  7331                              <1> 	graphicsadd:
  7332 00005F4A BF[129D0000]        <1> 		mov edi, graphicstable
  7333                              <1> 	shwgrph1:
  7334 00005F4F 397702              <1> 		cmp dword [edi + 2], esi
  7335 00005F52 7414                <1> 		je showgraphicsreplace2
  7336 00005F54 81C710000000        <1> 		add edi, 16
  7337 00005F5A 81FF[129F0000]      <1> 		cmp edi, graphicstableend
  7338 00005F60 0F832F020000        <1> 		jae near showgraphicsnew
  7339 00005F66 EBE7                <1> 		jmp shwgrph1
  7340                              <1> 	showgraphicsreplace2:
  7341 00005F68 8935[3C5F0000]      <1> 		mov [grphbuf + 2], esi
  7342 00005F6E 668915[405F0000]    <1> 		mov [grphbuf + 6], dx
  7343 00005F75 66890D[425F0000]    <1> 		mov [grphbuf + 8], cx
  7344 00005F7C 891D[465F0000]      <1> 		mov [grphbuf + 12], ebx
  7345 00005F82 30FF                <1> 		xor bh, bh
  7346 00005F84 88E3                <1> 		mov bl, ah
  7347 00005F86 30E4                <1> 		xor ah, ah
  7348 00005F88 66A3[445F0000]      <1> 		mov [grphbuf + 10], ax	
  7349 00005F8E 66891D[3A5F0000]    <1> 		mov [grphbuf], bx
  7350 00005F95 66A1[3A5F0000]      <1> 		mov ax, [grphbuf]
  7351 00005F9B 663D0100            <1> 		cmp ax, 1
  7352 00005F9F 0F8419000000        <1> 		je near replaceicon
  7353 00005FA5 663D0200            <1> 		cmp ax, 2
  7354 00005FA9 0F8493000000        <1> 		je near replacestring
  7355 00005FAF 663D0300            <1> 		cmp ax, 3
  7356 00005FB3 0F840F010000        <1> 		je near replacewindow
  7357 00005FB9 E9B4010000          <1> 		jmp showgraphicsreplace
  7358                              <1> 	replaceicon:
  7359 00005FBE 893D[27590000]      <1> 		mov [lastpos], edi
  7360 00005FC4 8935[2B590000]      <1> 		mov [lastpos + 4], esi
  7361 00005FCA 8B7702              <1> 		mov esi, [edi + 2]
  7362 00005FCD 668B5F0C            <1> 		mov bx, [edi + 12]
  7363 00005FD1 668B5706            <1> 		mov dx, [edi + 6]
  7364 00005FD5 668B4F08            <1> 		mov cx, [edi + 8]
  7365 00005FD9 668B06              <1> 		mov ax, [esi]
  7366 00005FDC 66A3[2F590000]      <1> 		mov [colorbuf], ax
  7367 00005FE2 66A1[D0560000]      <1> 		mov ax, [background]
  7368 00005FE8 668906              <1> 		mov [esi], ax
  7369 00005FEB 8B5F0C              <1> 		mov ebx, [edi + 12]
  7370 00005FEE 668B470A            <1> 		mov ax, [edi + 10]
  7371 00005FF2 2401                <1> 		and al, 1
  7372 00005FF4 A2[1A6A0000]        <1> 		mov [iconselected], al
  7373 00005FF9 668B470A            <1> 		mov ax, [edi + 10]
  7374 00005FFD E86B060000          <1> 		call showicon2
  7375 00006002 8B3D[27590000]      <1> 		mov edi, [lastpos]
  7376 00006008 8B7702              <1> 		mov esi, [edi + 2]
  7377 0000600B 66A1[2F590000]      <1> 		mov ax, [colorbuf]
  7378 00006011 668906              <1> 		mov [esi], ax
  7379 00006014 8B35[2B590000]      <1> 		mov esi, [lastpos + 4]
  7380 0000601A 668B15[405F0000]    <1> 		mov dx, [grphbuf + 6]
  7381 00006021 668B0D[425F0000]    <1> 		mov cx, [grphbuf + 8]
  7382 00006028 668B1D[3A5F0000]    <1> 		mov bx, [grphbuf]
  7383 0000602F 66A1[445F0000]      <1> 		mov ax, [grphbuf + 10]
  7384 00006035 88DC                <1> 		mov ah, bl
  7385 00006037 8B1D[465F0000]      <1> 		mov ebx, [grphbuf + 12]
  7386 0000603D E930010000          <1> 		jmp showgraphicsreplace
  7387                              <1> 	replacestring:
  7388 00006042 893D[27590000]      <1> 		mov [lastpos], edi
  7389 00006048 8935[2B590000]      <1> 		mov [lastpos + 4], esi
  7390 0000604E 8B5F0C              <1> 		mov ebx, [edi + 12]
  7391 00006051 8B7702              <1> 		mov esi, [edi + 2]
  7392 00006054 668B5706            <1> 		mov dx, [edi + 6]
  7393 00006058 668B4F08            <1> 		mov cx, [edi + 8]
  7394 0000605C 66A1[FB610000]      <1> 		mov ax, [colorfont2]
  7395 00006062 66A3[2F590000]      <1> 		mov [colorbuf], ax
  7396 00006068 66A1[D0560000]      <1> 		mov ax, [background]
  7397 0000606E 66A3[FB610000]      <1> 		mov [colorfont2], ax		
  7398 00006074 8B5F0C              <1> 		mov ebx, [edi + 12]
  7399 00006077 668B470A            <1> 		mov ax, [edi + 10]
  7400 0000607B 2401                <1> 		and al, 1
  7401 0000607D A2[04580000]        <1> 		mov [mouseselecton], al
  7402 00006082 668B470A            <1> 		mov ax, [edi + 10]
  7403 00006086 E838010000          <1> 		call showstring2
  7404 0000608B 66A1[2F590000]      <1> 		mov ax, [colorbuf]
  7405 00006091 66A3[FB610000]      <1> 		mov [colorfont2], ax
  7406 00006097 8B3D[27590000]      <1> 		mov edi, [lastpos]
  7407 0000609D 8B7702              <1> 		mov esi, [edi + 2]
  7408 000060A0 668B15[405F0000]    <1> 		mov dx, [grphbuf + 6]
  7409 000060A7 668B0D[425F0000]    <1> 		mov cx, [grphbuf + 8]
  7410 000060AE 668B1D[3A5F0000]    <1> 		mov bx, [grphbuf]
  7411 000060B5 66A1[445F0000]      <1> 		mov ax, [grphbuf + 10]
  7412 000060BB 88DC                <1> 		mov ah, bl
  7413 000060BD 8B1D[465F0000]      <1> 		mov ebx, [grphbuf + 12]
  7414 000060C3 E9AA000000          <1> 		jmp showgraphicsreplace
  7415                              <1> 	replacewindow:
  7416 000060C8 893D[27590000]      <1> 		mov [lastpos], edi
  7417 000060CE 8935[2B590000]      <1> 		mov [lastpos + 4], esi
  7418 000060D4 8B7702              <1> 		mov esi, [edi + 2]
  7419 000060D7 8B3D[0A620000]      <1> 		mov edi, [windowbufloc]
  7420 000060DD 31D2                <1> 		xor edx, edx
  7421 000060DF 668B15[A98B0000]    <1> 		mov dx, [resolutionx2]
  7422 000060E6 C1E204              <1> 		shl edx, 4
  7423 000060E9 29D7                <1> 		sub edi, edx
  7424 000060EB 31D2                <1> 		xor edx, edx
  7425 000060ED 668B16              <1> 		mov dx, [esi]
  7426 000060F0 660316              <1> 		add dx, [esi]
  7427 000060F3 668B4E02            <1> 		mov cx, [esi + 2]
  7428 000060F7 6681C11000          <1> 		add cx, 16
  7429 000060FC 66A1[D0560000]      <1> 		mov ax, [background]
  7430                              <1> 	clearwindow:
  7431 00006102 668907              <1> 		mov [edi], ax
  7432 00006105 81C702000000        <1> 		add edi, 2
  7433 0000610B 81EA02000000        <1> 		sub edx, 2
  7434 00006111 81FA00000000        <1> 		cmp edx, 0
  7435 00006117 75E9                <1> 		jne clearwindow
  7436 00006119 6649                <1> 		dec cx
  7437 0000611B 668B15[A98B0000]    <1> 		mov dx, [resolutionx2]
  7438 00006122 662B16              <1> 		sub dx, [esi]
  7439 00006125 662B16              <1> 		sub dx, [esi]
  7440 00006128 01D7                <1> 		add edi, edx
  7441 0000612A 668B16              <1> 		mov dx, [esi]
  7442 0000612D 660316              <1> 		add dx, [esi]
  7443 00006130 6681F90000          <1> 		cmp cx, 0
  7444 00006135 75CB                <1> 		jne clearwindow
  7445 00006137 C605[C7270000]00    <1> 		mov byte [termcopyon], 0
  7446 0000613E 8B3D[27590000]      <1> 		mov edi, [lastpos]
  7447 00006144 8B35[3C5F0000]      <1> 		mov esi, [grphbuf + 2]
  7448 0000614A 668B15[405F0000]    <1> 		mov dx, [grphbuf + 6]
  7449 00006151 668B0D[425F0000]    <1> 		mov cx, [grphbuf + 8]
  7450 00006158 668B1D[3A5F0000]    <1> 		mov bx, [grphbuf]
  7451 0000615F 66A1[445F0000]      <1> 		mov ax, [grphbuf + 10]
  7452 00006165 88DC                <1> 		mov ah, bl
  7453 00006167 8B1D[465F0000]      <1> 		mov ebx, [grphbuf + 12]
  7454 0000616D E900000000          <1> 		jmp showgraphicsreplace
  7455                              <1> 	showgraphicsreplace:
  7456 00006172 897702              <1> 		mov [edi + 2], esi
  7457 00006175 66895706            <1> 		mov [edi + 6], dx
  7458 00006179 66894F08            <1> 		mov [edi + 8], cx
  7459 0000617D 895F0C              <1> 		mov [edi + 12], ebx
  7460 00006180 30FF                <1> 		xor bh, bh
  7461 00006182 88E3                <1> 		mov bl, ah
  7462 00006184 30E4                <1> 		xor ah, ah
  7463 00006186 6689470A            <1> 		mov [edi + 10], ax
  7464 0000618A 66891F              <1> 		mov [edi], bx
  7465 0000618D 8B5F0C              <1> 		mov ebx, [edi + 12]
  7466 00006190 668B470A            <1> 		mov ax, [edi + 10]
  7467 00006194 C3                  <1> 		ret
  7468                              <1> 	showgraphicsnew:
  7469 00006195 BF[129D0000]        <1> 		mov edi, graphicstable
  7470                              <1> 	shwgrph2:
  7471 0000619A 66813F0000          <1> 		cmp word [edi], 0
  7472 0000619F 74D1                <1> 		je showgraphicsreplace
  7473 000061A1 81C710000000        <1> 		add edi, 16
  7474 000061A7 81FF[129F0000]      <1> 		cmp edi, graphicstableend
  7475 000061AD 72EB                <1> 		jb shwgrph2
  7476                              <1> 	showgraphicsdone:
  7477 000061AF C3                  <1> 		ret
  7478                              <1> 
  7479                              <1> 	showstring:
  7480 000061B0 A2[04580000]        <1> 		mov [mouseselecton], al
  7481 000061B5 8025[04580000]01    <1> 		and byte [mouseselecton], 1
  7482 000061BC B402                <1> 		mov ah, 2
  7483 000061BE E887FDFFFF          <1> 		call graphicsadd
  7484                              <1> 	showstring2:
  7485 000061C3 30E4                <1> 		xor ah, ah
  7486 000061C5 8A06                <1> 		mov al, [esi]
  7487 000061C7 3C00                <1> 		cmp al, 0
  7488 000061C9 7428                <1> 		je doneshowstring
  7489 000061CB 46                  <1> 		inc esi
  7490 000061CC 3CFF                <1> 		cmp al, 255
  7491 000061CE 74F3                <1> 		je showstring2
  7492 000061D0 8935[C3690000]      <1> 		mov [showstringesi], esi
  7493 000061D6 668B1D[FB610000]    <1> 		mov bx, [colorfont2]
  7494 000061DD E852050000          <1> 		call showfontvesa
  7495 000061E2 3C0A                <1> 		cmp al, 10
  7496 000061E4 7405                <1> 		je noproceedshst
  7497 000061E6 6681C20800          <1> 		add dx, 8
  7498                              <1> 	noproceedshst:
  7499 000061EB 8B35[C3690000]      <1> 		mov esi, [showstringesi]
  7500 000061F1 EBD0                <1> 		jmp showstring2
  7501                              <1> 	doneshowstring:
  7502 000061F3 C605[04580000]00    <1> 		mov byte [mouseselecton], 0
  7503 000061FA C3                  <1> 		ret
  7504                              <1> 
  7505 000061FB FFFF                <1> colorfont2 dw 0xFFFF
  7506 000061FD 00                  <1> colorcache db 0
  7507 000061FE 0000                <1> winvcopystx dw 0
  7508 00006200 0000                <1> winvcopysty dw 0
  7509 00006202 0000                <1> winvcopydx dw 0
  7510 00006204 0000                <1> winvcopycx dw 0
  7511 00006206 FFFF0000            <1> windowcolor dw 0xFFFF,0x0
  7512 0000620A 00000000            <1> windowbufloc: dw 0,0
  7513 0000620E 00000000            <1> windowinfobuf dd 0
  7514 00006212 0000                <1> termcol dw 0
  7515 00006214 00000000            <1> wincopyendpos dd 0
  7516                              <1> 
  7517                              <1> 	showwindow:	;;windowstuff in si, position in (dx, cx), nothing in ax, code in bx
  7518 00006218 C605[C6270000]01    <1> 		mov byte [termguion], 1
  7519 0000621F 6681C11000          <1> 		add cx, 16
  7520 00006224 668915[FE610000]    <1> 		mov [winvcopystx], dx
  7521 0000622B 66890D[00620000]    <1> 		mov [winvcopysty], cx
  7522 00006232 8935[0E620000]      <1> 		mov [windowinfobuf], esi
  7523 00006238 668B16              <1> 		mov dx, [esi]
  7524 0000623B 668B4E02            <1> 		mov cx, [esi + 2]
  7525 0000623F 31C0                <1> 		xor eax, eax
  7526 00006241 31DB                <1> 		xor ebx, ebx
  7527 00006243 6689D0              <1> 		mov ax, dx
  7528 00006246 6689CB              <1> 		mov bx, cx
  7529 00006249 66C1E803            <1> 		shr ax, 3
  7530 0000624D 66C1EB04            <1> 		shr bx, 4
  7531 00006251 66A3[12620000]      <1> 		mov [termcol], ax
  7532 00006257 A2[8A290000]        <1> 		mov [charxy], al
  7533 0000625C 881D[8B290000]      <1> 		mov [charxy + 1], bl
  7534 00006262 BF[A4BC0000]        <1> 		mov edi, videobuf
  7535 00006267 81FB00000000        <1> 		cmp ebx, 0
  7536 0000626D 0F84CD030000        <1> 		je near donewincopynow	;AAAAAAAAA!!!!!
  7537                              <1> 	findendposwin:
  7538 00006273 01C7                <1> 		add edi, eax
  7539 00006275 01C7                <1> 		add edi, eax
  7540 00006277 4B                  <1> 		dec ebx
  7541 00006278 81FB00000000        <1> 		cmp ebx, 0
  7542 0000627E 77F3                <1> 		ja findendposwin
  7543 00006280 893D[14620000]      <1> 		mov [wincopyendpos], edi
  7544 00006286 31FF                <1> 		xor edi, edi
  7545 00006288 6631C0              <1> 		xor ax, ax
  7546 0000628B 6631DB              <1> 		xor bx, bx
  7547 0000628E 6601D2              <1> 		add dx, dx
  7548 00006291 668915[02620000]    <1> 		mov [winvcopydx], dx
  7549 00006298 66890D[04620000]    <1> 		mov [winvcopycx], cx
  7550 0000629F 668B0D[00620000]    <1> 		mov cx, [winvcopysty]
  7551 000062A6 6681E91000          <1> 		sub cx, 16
  7552 000062AB 668B15[FE610000]    <1> 		mov dx, [winvcopystx]
  7553 000062B2 C605[C7270000]00    <1> 		mov byte [termcopyon], 0
  7554 000062B9 B403                <1> 		mov ah, 3
  7555 000062BB E88AFCFFFF          <1> 		call graphicsadd
  7556                              <1> 	showwindow2:
  7557 000062C0 6681C11000          <1> 		add cx, 16
  7558 000062C5 668915[FE610000]    <1> 		mov [winvcopystx], dx
  7559 000062CC 66890D[00620000]    <1> 		mov [winvcopysty], cx
  7560 000062D3 668B16              <1> 		mov dx, [esi]
  7561 000062D6 668B4E02            <1> 		mov cx, [esi + 2]
  7562 000062DA 6601D2              <1> 		add dx, dx
  7563 000062DD 668915[02620000]    <1> 		mov [winvcopydx], dx
  7564 000062E4 66890D[04620000]    <1> 		mov [winvcopycx], cx
  7565 000062EB 8B3D[0A620000]      <1> 		mov edi, [windowbufloc]
  7566 000062F1 31D2                <1> 		xor edx, edx
  7567 000062F3 668B15[A98B0000]    <1> 		mov dx, [resolutionx2]
  7568 000062FA C1E204              <1> 		shl edx, 4
  7569 000062FD 29D7                <1> 		sub edi, edx
  7570 000062FF 803D[C7270000]00    <1> 		cmp byte [termcopyon], 0
  7571 00006306 7538                <1> 		jne nocleartitlebarpos
  7572 00006308 8B3D[D18A0000]      <1> 		mov edi, [physbaseptr]
  7573 0000630E 31D2                <1> 		xor edx, edx
  7574 00006310 668B15[FE610000]    <1> 		mov dx, [winvcopystx]
  7575 00006317 01D7                <1> 		add edi, edx
  7576 00006319 668B0D[00620000]    <1> 		mov cx, [winvcopysty]
  7577 00006320 6681E91000          <1> 		sub cx, 16
  7578 00006325 6681F90000          <1> 		cmp cx, 0
  7579 0000632A 7414                <1> 		je nocleartitlebarpos
  7580                              <1> 	cleartitlebarpos:
  7581 0000632C 31D2                <1> 		xor edx, edx
  7582 0000632E 668B15[A98B0000]    <1> 		mov dx, [resolutionx2]
  7583 00006335 01D7                <1> 		add edi, edx
  7584 00006337 6649                <1> 		dec cx
  7585 00006339 6681F90000          <1> 		cmp cx, 0
  7586 0000633E 75EC                <1> 		jne cleartitlebarpos
  7587                              <1> 	nocleartitlebarpos:
  7588 00006340 66B91000            <1> 		mov cx, 16
  7589 00006344 668B15[02620000]    <1> 		mov dx, [winvcopydx]
  7590 0000634B 6681F90000          <1> 		cmp cx, 0
  7591 00006350 0F8448000000        <1> 		je near canceltitlebarput
  7592 00006356 6681FA0000          <1> 		cmp dx, 0
  7593 0000635B 0F843D000000        <1> 		je near canceltitlebarput
  7594                              <1> 	titlebarput:
  7595 00006361 66A1[06620000]      <1> 		mov ax, [windowcolor]
  7596 00006367 668907              <1> 		mov [edi], ax
  7597 0000636A 6681EA0200          <1> 		sub dx, 2
  7598 0000636F 81C702000000        <1> 		add edi, 2
  7599 00006375 6681FA0000          <1> 		cmp dx, 0
  7600 0000637A 75E5                <1> 		jne titlebarput
  7601 0000637C 31D2                <1> 		xor edx, edx
  7602 0000637E 668B15[A98B0000]    <1> 		mov dx, [resolutionx2]
  7603 00006385 6649                <1> 		dec cx
  7604 00006387 662B15[02620000]    <1> 		sub dx, [winvcopydx]
  7605 0000638E 01D7                <1> 		add edi, edx
  7606 00006390 668B15[02620000]    <1> 		mov dx, [winvcopydx]
  7607 00006397 6681F90000          <1> 		cmp cx, 0
  7608 0000639C 75C3                <1> 		jne titlebarput
  7609                              <1> 	canceltitlebarput:
  7610 0000639E 893D[0A620000]      <1> 		mov [windowbufloc], edi
  7611 000063A4 803D[C7270000]02    <1> 		cmp byte [termcopyon], 2
  7612 000063AB 0F8461000000        <1> 		je near winvcpst
  7613 000063B1 6631C0              <1> 		xor ax, ax
  7614 000063B4 81C604000000        <1> 		add esi, 4
  7615 000063BA 668B15[FE610000]    <1> 		mov dx, [winvcopystx]
  7616 000063C1 668B0D[00620000]    <1> 		mov cx, [winvcopysty]
  7617 000063C8 6681E91000          <1> 		sub cx, 16
  7618 000063CD 6631DB              <1> 		xor bx, bx
  7619 000063D0 C605[04580000]01    <1> 		mov byte [mouseselecton], 1
  7620 000063D7 E8E7FDFFFF          <1> 		call showstring2
  7621 000063DC B058                <1> 		mov al, "X"
  7622 000063DE 30E4                <1> 		xor ah, ah
  7623 000063E0 668B1D[FB610000]    <1> 		mov bx, [colorfont2]
  7624 000063E7 668B15[FE610000]    <1> 		mov dx, [winvcopystx]
  7625 000063EE 668B0D[00620000]    <1> 		mov cx, [winvcopysty]
  7626 000063F5 6681E91000          <1> 		sub cx, 16
  7627 000063FA 6681EA1400          <1> 		sub dx, 20
  7628 000063FF 660315[02620000]    <1> 		add dx, [winvcopydx]
  7629 00006406 C605[04580000]01    <1> 		mov byte [mouseselecton], 1
  7630 0000640D E822030000          <1> 		call showfontvesa
  7631                              <1> 	winvcpst:
  7632 00006412 8B3D[0A620000]      <1> 		mov edi, [windowbufloc]
  7633 00006418 E97E000000          <1> 		jmp windowvideocopyset
  7634                              <1> 
  7635                              <1> 	windowvideocopy:
  7636 0000641D 8B35[0E620000]      <1> 		mov esi, [windowinfobuf]
  7637 00006423 668B16              <1> 		mov dx, [esi]
  7638 00006426 668B4E02            <1> 		mov cx, [esi + 2]
  7639 0000642A 31C0                <1> 		xor eax, eax
  7640 0000642C 31DB                <1> 		xor ebx, ebx
  7641 0000642E 6689D0              <1> 		mov ax, dx
  7642 00006431 6689CB              <1> 		mov bx, cx
  7643 00006434 66C1E803            <1> 		shr ax, 3
  7644 00006438 66C1EB04            <1> 		shr bx, 4
  7645 0000643C 66A3[12620000]      <1> 		mov [termcol], ax
  7646 00006442 A2[8A290000]        <1> 		mov [charxy], al
  7647 00006447 881D[8B290000]      <1> 		mov [charxy + 1], bl
  7648 0000644D 8B3D[0A620000]      <1> 		mov edi, [windowbufloc]
  7649 00006453 3B3D[D18A0000]      <1> 		cmp edi, [physbaseptr]
  7650 00006459 0F833C000000        <1> 		jae near windowvideocopyset
  7651 0000645F 31C9                <1> 		xor ecx, ecx
  7652 00006461 31D2                <1> 		xor edx, edx
  7653 00006463 668B15[FE610000]    <1> 		mov dx, [winvcopystx]
  7654 0000646A 668B0D[00620000]    <1> 		mov cx, [winvcopysty]
  7655 00006471 8B3D[D18A0000]      <1> 		mov edi, [physbaseptr]
  7656 00006477 01D7                <1> 		add edi, edx
  7657 00006479 81F900000000        <1> 		cmp ecx, 0
  7658 0000647F 741A                <1> 		je windowvideocopyset
  7659                              <1> 	yrescopylp:
  7660 00006481 31D2                <1> 		xor edx, edx
  7661 00006483 668B15[A98B0000]    <1> 		mov dx, [resolutionx2]
  7662 0000648A 01D7                <1> 		add edi, edx
  7663 0000648C 6649                <1> 		dec cx
  7664 0000648E 6681F90000          <1> 		cmp cx, 0
  7665 00006493 75EC                <1> 		jne yrescopylp
  7666 00006495 893D[0A620000]      <1> 		mov [windowbufloc], edi
  7667                              <1> 	windowvideocopyset:
  7668 0000649B 6631C9              <1> 		xor cx, cx
  7669 0000649E 6649                <1> 		dec cx
  7670 000064A0 66890D[52660000]    <1> 		mov [charposline], cx
  7671 000064A7 89FE                <1> 		mov esi, edi
  7672 000064A9 81EE10000000        <1> 		sub esi, 16
  7673 000064AF 31D2                <1> 		xor edx, edx
  7674 000064B1 668B15[A98B0000]    <1> 		mov dx, [resolutionx2]
  7675 000064B8 C1E204              <1> 		shl edx, 4
  7676 000064BB 01D6                <1> 		add esi, edx
  7677 000064BD BF[A4BC0000]        <1> 		mov edi, videobuf
  7678 000064C2 81EF02000000        <1> 		sub edi, 2
  7679 000064C8 893D[54660000]      <1> 		mov [charposvbuf], edi
  7680 000064CE E96E000000          <1> 		jmp nextcharwin
  7681                              <1> 	copywindow:
  7682 000064D3 B201                <1> 		mov dl, 1
  7683 000064D5 D0C6                <1> 		rol dh, 1
  7684 000064D7 20F2                <1> 		and dl, dh
  7685 000064D9 803D[FD610000]10    <1> 		cmp byte [colorcache], 0x10
  7686 000064E0 731C                <1> 		jae switchwincolors
  7687 000064E2 66A1[08620000]      <1> 		mov ax, [windowcolor + 2]
  7688 000064E8 668907              <1> 		mov [edi], ax
  7689 000064EB 80FA00              <1> 		cmp dl, 0
  7690 000064EE 7425                <1> 		je nowritewin
  7691 000064F0 66A1[06620000]      <1> 		mov ax, [windowcolor]
  7692 000064F6 668907              <1> 		mov [edi], ax
  7693 000064F9 E917000000          <1> 		jmp nowritewin
  7694                              <1> 	switchwincolors:
  7695 000064FE 66A1[06620000]      <1> 		mov ax, [windowcolor]
  7696 00006504 668907              <1> 		mov [edi], ax
  7697 00006507 80FA00              <1> 		cmp dl, 0
  7698 0000650A 7409                <1> 		je nowritewin
  7699 0000650C 66A1[08620000]      <1> 		mov ax, [windowcolor + 2]
  7700 00006512 668907              <1> 		mov [edi], ax
  7701                              <1> 	nowritewin:
  7702 00006515 81C702000000        <1> 		add edi, 2
  7703 0000651B FEC1                <1> 		inc cl
  7704 0000651D 80F908              <1> 		cmp cl, 8
  7705 00006520 75B1                <1> 		jne copywindow
  7706 00006522 6643                <1> 		inc bx
  7707 00006524 30C9                <1> 		xor cl, cl
  7708 00006526 31D2                <1> 		xor edx, edx
  7709 00006528 668B15[A98B0000]    <1> 		mov dx, [resolutionx2]
  7710 0000652F 01D6                <1> 		add esi, edx
  7711 00006531 89F7                <1> 		mov edi, esi
  7712 00006533 678AB7[9978]        <1> 		mov dh, [fonts + bx]
  7713 00006538 D0CE                <1> 		ror dh, 1
  7714 0000653A FEC5                <1> 		inc ch
  7715 0000653C 80FD10              <1> 		cmp ch, 16
  7716 0000653F 7592                <1> 		jne copywindow
  7717                              <1> 	nextcharwin:
  7718 00006541 6631C9              <1> 		xor cx, cx
  7719 00006544 8B3D[54660000]      <1> 		mov edi, [charposvbuf]
  7720 0000654A 81C702000000        <1> 		add edi, 2
  7721 00006550 3B3D[14620000]      <1> 		cmp edi, [wincopyendpos]
  7722 00006556 0F83E4000000        <1> 		jae near donewincopynow
  7723 0000655C 8A7F01              <1> 		mov bh, [edi + 1]
  7724 0000655F 80FF00              <1> 		cmp bh, 0
  7725 00006562 7505                <1> 		jne nofixcolorwin
  7726 00006564 B707                <1> 		mov bh, 7
  7727 00006566 887F01              <1> 		mov [edi + 1], bh
  7728                              <1> 	nofixcolorwin:
  7729 00006569 883D[FD610000]      <1> 		mov [colorcache], bh
  7730 0000656F 8A1F                <1> 		mov bl, [edi]
  7731 00006571 893D[54660000]      <1> 		mov [charposvbuf], edi
  7732 00006577 81EF[A4BC0000]      <1> 		sub edi, videobuf
  7733 0000657D 81C7[E40D0100]      <1> 		add edi, videobuf2
  7734 00006583 8A6701              <1> 		mov ah, [edi + 1]
  7735 00006586 8A07                <1> 		mov al, [edi]
  7736 00006588 6639D8              <1> 		cmp ax, bx
  7737 0000658B 7543                <1> 		jne noskipcharcopy
  7738                              <1> 	skipcharcopy:
  7739 0000658D 81C610000000        <1> 		add esi, 16
  7740 00006593 668B0D[52660000]    <1> 		mov cx, [charposline]
  7741 0000659A 6641                <1> 		inc cx
  7742 0000659C 66890D[52660000]    <1> 		mov [charposline], cx
  7743 000065A3 663B0D[12620000]    <1> 		cmp cx, [termcol]
  7744 000065AA 7295                <1> 		jb nextcharwin
  7745 000065AC 6631C9              <1> 		xor cx, cx
  7746 000065AF 66890D[52660000]    <1> 		mov [charposline], cx
  7747 000065B6 31D2                <1> 		xor edx, edx
  7748 000065B8 668B15[A98B0000]    <1> 		mov dx, [resolutionx2]
  7749 000065BF C1E204              <1> 		shl edx, 4
  7750 000065C2 662B15[02620000]    <1> 		sub dx, [winvcopydx]
  7751 000065C9 01D6                <1> 		add esi, edx
  7752 000065CB E971FFFFFF          <1> 		jmp nextcharwin
  7753                              <1> 	noskipcharcopy:
  7754 000065D0 881F                <1> 		mov [edi], bl
  7755 000065D2 887F01              <1> 		mov [edi + 1], bh
  7756 000065D5 8B3D[54660000]      <1> 		mov edi, [charposvbuf]
  7757 000065DB 30FF                <1> 		xor bh, bh
  7758 000065DD 66C1E304            <1> 		shl bx, 4
  7759 000065E1 31D2                <1> 		xor edx, edx
  7760 000065E3 668B15[A98B0000]    <1> 		mov dx, [resolutionx2]
  7761 000065EA C1E204              <1> 		shl edx, 4
  7762 000065ED 29D6                <1> 		sub esi, edx
  7763 000065EF 81C610000000        <1> 		add esi, 16
  7764 000065F5 89F7                <1> 		mov edi, esi
  7765 000065F7 668B0D[52660000]    <1> 		mov cx, [charposline]
  7766 000065FE 6641                <1> 		inc cx
  7767 00006600 663B0D[12620000]    <1> 		cmp cx, [termcol]
  7768 00006607 7316                <1> 		jae fixwindowcopy
  7769 00006609 66890D[52660000]    <1> 		mov [charposline], cx
  7770 00006610 6631C9              <1> 		xor cx, cx
  7771 00006613 678AB7[9978]        <1> 		mov dh, [fonts + bx]
  7772 00006618 D0CE                <1> 		ror dh, 1
  7773 0000661A E9B4FEFFFF          <1> 		jmp copywindow
  7774                              <1> fixwindowcopy:
  7775 0000661F 6631C9              <1> 		xor cx, cx
  7776 00006622 66890D[52660000]    <1> 		mov [charposline], cx
  7777 00006629 662B15[02620000]    <1> 		sub dx, [winvcopydx]
  7778 00006630 01D6                <1> 		add esi, edx
  7779 00006632 89F7                <1> 		mov edi, esi
  7780 00006634 678AB7[9978]        <1> 		mov dh, [fonts + bx]
  7781 00006639 D0CE                <1> 		ror dh, 1
  7782 0000663B E993FEFFFF          <1> 		jmp copywindow
  7783                              <1> donewincopynow:
  7784 00006640 803D[C7270000]01    <1> 		cmp byte [termcopyon], 1
  7785 00006647 7501                <1> 		jne forgetresetstuff
  7786 00006649 61                  <1> 		popa
  7787                              <1> forgetresetstuff:
  7788 0000664A C605[C7270000]00    <1> 		mov byte [termcopyon], 0
  7789 00006651 C3                  <1> 		ret
  7790                              <1> 		
  7791 00006652 0000                <1> charposline dw 0
  7792 00006654 00000000            <1> charposvbuf dw 0,0
  7793 00006658 0000                <1> iconcolor dw 0
  7794                              <1> 	showicon:	;;icon in si, position in (dx,cx), selected in ax, code in bx
  7795 0000665A A2[1A6A0000]        <1> 		mov [iconselected], al
  7796 0000665F 8025[1A6A0000]01    <1> 		and byte [iconselected], 1
  7797 00006666 B401                <1> 		mov ah, 1
  7798 00006668 E8DDF8FFFF          <1> 		call graphicsadd
  7799                              <1> 	showicon2:
  7800 0000666D 8B3D[D18A0000]      <1> 		mov edi, [physbaseptr]
  7801 00006673 6601D2              <1> 		add dx, dx
  7802 00006676 663B15[A98B0000]    <1> 		cmp dx, [resolutionx2]
  7803 0000667D 720C                <1> 		jb screenxgood
  7804 0000667F 668B15[A98B0000]    <1> 		mov dx, [resolutionx2]
  7805 00006686 6681EA4000          <1> 		sub dx, 64
  7806                              <1> 	screenxgood:
  7807 0000668B 6681F90000          <1> 		cmp cx, 0
  7808 00006690 7422                <1> 		je noscreenygoodchk
  7809 00006692 663B0D[BD8A0000]    <1> 		cmp cx, [resolutiony]
  7810 00006699 720C                <1> 		jb screenygood
  7811 0000669B 668B0D[BD8A0000]    <1> 		mov cx, [resolutiony]
  7812 000066A2 6681E92000          <1> 		sub cx, 32
  7813                              <1> 	screenygood:
  7814 000066A7 31DB                <1> 		xor ebx, ebx
  7815 000066A9 668B1D[A98B0000]    <1> 		mov bx, [resolutionx2]
  7816 000066B0 01DF                <1> 		add edi, ebx
  7817 000066B2 E2F3                <1> 		loop screenygood
  7818                              <1> 	noscreenygoodchk:
  7819 000066B4 31DB                <1> 		xor ebx, ebx
  7820 000066B6 6689D3              <1> 		mov bx, dx
  7821 000066B9 01DF                <1> 		add edi, ebx
  7822 000066BB 6631C9              <1> 		xor cx, cx
  7823 000066BE 668B06              <1> 		mov ax, [esi]
  7824 000066C1 81C602000000        <1> 		add esi, 2
  7825 000066C7 66A3[58660000]      <1> 		mov [iconcolor], ax
  7826                              <1> 	writeicon:
  7827 000066CD 8B06                <1> 		mov eax, [esi]
  7828 000066CF D1C0                <1> 		rol eax, 1
  7829 000066D1 30C9                <1> 		xor cl, cl
  7830                              <1> 	writeiconline:
  7831 000066D3 B201                <1> 		mov dl, 1
  7832 000066D5 20C2                <1> 		and dl, al
  7833 000066D7 3215[1A6A0000]      <1> 		xor dl, [iconselected]
  7834 000066DD 668B1D[D0560000]    <1> 		mov bx, [background]
  7835 000066E4 66891F              <1> 		mov [edi], bx
  7836 000066E7 80FA00              <1> 		cmp dl, 0
  7837 000066EA 740A                <1> 		je noiconline
  7838 000066EC 668B15[58660000]    <1> 		mov dx, [iconcolor]
  7839 000066F3 668917              <1> 		mov [edi], dx
  7840                              <1> 	noiconline:
  7841 000066F6 81C702000000        <1> 		add edi, 2
  7842 000066FC D1C0                <1> 		rol eax, 1
  7843 000066FE FEC1                <1> 		inc cl
  7844 00006700 80F920              <1> 		cmp cl, 32
  7845 00006703 72CE                <1> 		jb writeiconline
  7846 00006705 81C604000000        <1> 		add esi, 4
  7847 0000670B FEC5                <1> 		inc ch
  7848 0000670D 31D2                <1> 		xor edx, edx
  7849 0000670F 668B15[A98B0000]    <1> 		mov dx, [resolutionx2]
  7850 00006716 01D7                <1> 		add edi, edx
  7851 00006718 81EF40000000        <1> 		sub edi, 64
  7852 0000671E 80FD20              <1> 		cmp ch, 32
  7853 00006721 72AA                <1> 		jb writeicon
  7854 00006723 31C0                <1> 		xor eax, eax
  7855 00006725 C3                  <1> 		ret
  7856                              <1> 
  7857 00006726 02                  <1> resolutionbytes db 2
  7858 00006727 0000                <1> posxvesa dw 0
  7859 00006729 0000                <1> posyvesa dw 0
  7860 0000672B FFFF                <1> colorfont dw 0xFFFF
  7861                              <1> savefontvesa:		;;same rules as showfontvesa
  7862 0000672D C605[03580000]01    <1> 	mov byte [savefonton], 1
  7863                              <1> showfontvesa:		;;position in (dx,cx), color in bx, char in al
  7864 00006734 3CFF                <1> 	cmp al, 255
  7865 00006736 7501                <1> 	jne nostopshowfont
  7866 00006738 C3                  <1> 	ret
  7867                              <1> nostopshowfont:
  7868 00006739 66890D[29670000]    <1> 	mov [posyvesa], cx
  7869 00006740 3C0A                <1> 	cmp al, 10
  7870 00006742 0F8424000000        <1> 	je near goodvesafontx
  7871 00006748 31C9                <1> 	xor ecx, ecx
  7872 0000674A 668B0D[A98B0000]    <1> 	mov cx, [resolutionx2]
  7873 00006751 6639CA              <1> 	cmp dx, cx
  7874 00006754 7616                <1> 	jbe goodvesafontx
  7875 00006756 6631D2              <1> 	xor dx, dx
  7876 00006759 668B0D[29670000]    <1> 	mov cx, [posyvesa]
  7877 00006760 6681C11000          <1> 	add cx, 16
  7878 00006765 66890D[29670000]    <1> 	mov [posyvesa], cx
  7879                              <1> goodvesafontx:
  7880 0000676C 668B0D[29670000]    <1> 	mov cx, [posyvesa]
  7881 00006773 668915[27670000]    <1> 	mov [posxvesa], dx
  7882 0000677A 8B3D[D18A0000]      <1> 	mov edi, [physbaseptr]
  7883 00006780 66891D[2B670000]    <1> 	mov [colorfont], bx
  7884 00006787 31DB                <1> 	xor ebx, ebx
  7885 00006789 88C3                <1> 	mov bl, al
  7886 0000678B 31C0                <1> 	xor eax, eax
  7887 0000678D 88D8                <1> 	mov al, bl
  7888 0000678F 6689D3              <1> 	mov bx, dx
  7889 00006792 89DA                <1> 	mov edx, ebx
  7890 00006794 31DB                <1> 	xor ebx, ebx
  7891 00006796 6681F90000          <1> 	cmp cx, 0
  7892 0000679B 7415                <1> 	je vesaposloopdn
  7893 0000679D 668B1D[A98B0000]    <1> 	mov bx, [resolutionx2]
  7894                              <1> vesaposloop:
  7895 000067A4 01DA                <1> 	add edx, ebx
  7896 000067A6 6681E90100          <1> 	sub cx, 1
  7897 000067AB 6681F90000          <1> 	cmp cx, 0
  7898 000067B0 75F2                <1> 	jne vesaposloop
  7899                              <1> vesaposloopdn:
  7900 000067B2 01D7                <1> 	add edi, edx
  7901 000067B4 BE[99780000]        <1> 	mov esi, fonts
  7902                              <1> findfontvesa:
  7903 000067B9 30E4                <1> 	xor ah, ah
  7904 000067BB 3C0A                <1> 	cmp al, 10
  7905 000067BD 0F84FE000000        <1> 	je near nwlinevesa
  7906 000067C3 C1E004              <1> 	shl eax, 4
  7907 000067C6 01C6                <1> 	add esi, eax
  7908 000067C8 C1E804              <1> 	shr eax, 4
  7909 000067CB 81FE[99880000]      <1> 	cmp esi, fontend
  7910 000067D1 0F83B9000000        <1> 	jae near donefontvesa
  7911 000067D7 4E                  <1> 	dec esi
  7912                              <1> foundfontvesa:
  7913 000067D8 46                  <1> 	inc esi
  7914 000067D9 803D[03580000]01    <1> 	cmp byte [savefonton], 1
  7915 000067E0 0F8401010000        <1> 	je near vesafontsaver
  7916 000067E6 30C9                <1> 	xor cl, cl
  7917 000067E8 8A06                <1> 	mov al, [esi]
  7918 000067EA 668B15[A98B0000]    <1> 	mov dx, [resolutionx2]
  7919 000067F1 662B15[27670000]    <1> 	sub dx, [posxvesa]
  7920 000067F8 6681FA1000          <1> 	cmp dx, 16
  7921 000067FD 7708                <1> 	ja paintfontvesa
  7922 000067FF D0EA                <1> 	shr dl, 1
  7923 00006801 8815[C0680000]      <1> 	mov [charwidth], dl
  7924                              <1> paintfontvesa:
  7925 00006807 B201                <1> 	mov dl, 1
  7926 00006809 20C2                <1> 	and dl, al
  7927 0000680B 803D[02580000]01    <1> 	cmp byte [showcursorfonton], 1
  7928 00006812 0F8435000000        <1> 	je near nodelpaintedfont
  7929 00006818 803D[02580000]02    <1> 	cmp byte [showcursorfonton], 2
  7930 0000681F 0F8518000000        <1> 	jne near noswitchcursorfonton
  7931 00006825 80FA00              <1> 	cmp dl, 0
  7932 00006828 0F842E000000        <1> 	je near nopixelset
  7933 0000682E 668B1D[2B670000]    <1> 	mov bx, [colorfont]
  7934 00006835 66891F              <1> 	mov [edi], bx
  7935 00006838 E91F000000          <1> 	jmp nopixelset
  7936                              <1> noswitchcursorfonton:
  7937 0000683D 3215[04580000]      <1> 	xor dl, [mouseselecton]
  7938 00006843 668B1D[D0560000]    <1> 	mov bx, [background]
  7939 0000684A 66891F              <1> 	mov [edi], bx
  7940                              <1> nodelpaintedfont:
  7941 0000684D 80FA00              <1> 	cmp dl, 0
  7942 00006850 740A                <1> 	je nopixelset
  7943 00006852 668B15[2B670000]    <1> 	mov dx, [colorfont]
  7944 00006859 668917              <1> 	mov [edi], dx
  7945                              <1> nopixelset:
  7946 0000685C 81C702000000        <1> 	add edi, 2
  7947 00006862 D0C0                <1> 	rol al, 1
  7948 00006864 FEC1                <1> 	inc cl
  7949 00006866 3A0D[C0680000]      <1> 	cmp cl, [charwidth]
  7950 0000686C 7299                <1> 	jb paintfontvesa
  7951 0000686E FEC5                <1> 	inc ch
  7952 00006870 31D2                <1> 	xor edx, edx
  7953 00006872 668B15[A98B0000]    <1> 	mov dx, [resolutionx2]
  7954 00006879 01D7                <1> 	add edi, edx
  7955 0000687B 31D2                <1> 	xor edx, edx
  7956 0000687D 8A15[C0680000]      <1> 	mov dl, [charwidth]
  7957 00006883 00D2                <1> 	add dl, dl
  7958 00006885 29D7                <1> 	sub edi, edx
  7959 00006887 80FD10              <1> 	cmp ch, 16
  7960 0000688A 0F8248FFFFFF        <1> 	jb foundfontvesa
  7961                              <1> donefontvesa:
  7962 00006890 B208                <1> 	mov dl, 8
  7963 00006892 8815[C0680000]      <1> 	mov [charwidth], dl
  7964 00006898 668B15[27670000]    <1> 	mov dx, [posxvesa]
  7965 0000689F 8A1D[C0680000]      <1> 	mov bl, [charwidth]
  7966 000068A5 30FF                <1> 	xor bh, bh
  7967 000068A7 6601DA              <1> 	add dx, bx
  7968 000068AA 668B1D[2B670000]    <1> 	mov bx, [colorfont]
  7969 000068B1 668B0D[29670000]    <1> 	mov cx, [posyvesa]
  7970 000068B8 C605[03580000]00    <1> 	mov byte [savefonton], 0
  7971 000068BF C3                  <1> 	ret
  7972 000068C0 08                  <1> charwidth db 8
  7973                              <1> nwlinevesa:
  7974 000068C1 668B15[27670000]    <1> 	mov dx, [posxvesa]
  7975 000068C8 6631D2              <1> 	xor dx, dx
  7976 000068CB 668915[27670000]    <1> 	mov [posxvesa], dx
  7977 000068D2 668B0D[29670000]    <1> 	mov cx, [posyvesa]
  7978 000068D9 6681C11000          <1> 	add cx, 16
  7979 000068DE 66890D[29670000]    <1> 	mov [posyvesa], cx
  7980 000068E5 EBA9                <1> 	jmp donefontvesa
  7981                              <1> vesafontsaver:
  7982 000068E7 30C0                <1> 	xor al, al
  7983 000068E9 30C9                <1> 	xor cl, cl
  7984                              <1> vesafontsaver2:
  7985 000068EB 668B17              <1> 	mov dx, [edi]
  7986 000068EE 663B15[2B670000]    <1> 	cmp dx, [colorfont]
  7987 000068F5 742F                <1> 	je colorfontmatch
  7988                              <1> donecolormatch:
  7989 000068F7 81C702000000        <1> 	add edi, 2
  7990 000068FD D0C0                <1> 	rol al, 1
  7991 000068FF FEC1                <1> 	inc cl
  7992 00006901 80F908              <1> 	cmp cl, 8
  7993 00006904 72E5                <1> 	jb vesafontsaver2
  7994 00006906 8806                <1> 	mov [esi], al
  7995 00006908 46                  <1> 	inc esi
  7996 00006909 FEC5                <1> 	inc ch
  7997 0000690B 31D2                <1> 	xor edx, edx
  7998 0000690D 668B15[A98B0000]    <1> 	mov dx, [resolutionx2]
  7999 00006914 01D7                <1> 	add edi, edx
  8000 00006916 81EF10000000        <1> 	sub edi, 16
  8001 0000691C 80FD10              <1> 	cmp ch, 16
  8002 0000691F 72C6                <1> 	jb vesafontsaver
  8003 00006921 E96AFFFFFF          <1> 	jmp donefontvesa
  8004                              <1> colorfontmatch:
  8005 00006926 0401                <1> 	add al, 1
  8006 00006928 EBCD                <1> 	jmp donecolormatch
  8007                              <1> 	
  8008                              <1> showbmp:
  8009 0000692A 668B06              <1> 	mov ax, [esi]
  8010 0000692D 663D424D            <1> 	cmp ax, "BM"
  8011 00006931 0F8582000000        <1> 	jne near endedbmp
  8012 00006937 8B3D[D18A0000]      <1> 	mov edi, [physbaseptr]
  8013 0000693D 6689D0              <1> 	mov ax, dx
  8014 00006940 6689CB              <1> 	mov bx, cx
  8015 00006943 31C9                <1> 	xor ecx, ecx
  8016 00006945 31D2                <1> 	xor edx, edx
  8017 00006947 6689D9              <1> 	mov cx, bx
  8018 0000694A 6689C2              <1> 	mov dx, ax
  8019 0000694D 01D7                <1> 	add edi, edx
  8020 0000694F 01D7                <1> 	add edi, edx
  8021 00006951 31D2                <1> 	xor edx, edx
  8022 00006953 668B15[A98B0000]    <1> 	mov dx, [resolutionx2]
  8023 0000695A 41                  <1> 	inc ecx
  8024 0000695B 034E16              <1> 	add ecx, [esi + 22]
  8025                              <1> bmplocloop:
  8026 0000695E 01D7                <1> 	add edi, edx
  8027 00006960 E2FC                <1> 	loop bmplocloop
  8028 00006962 29D7                <1> 	sub edi, edx
  8029 00006964 8B5612              <1> 	mov edx, [esi + 18]
  8030 00006967 8B4E16              <1> 	mov ecx, [esi + 22]
  8031 0000696A 8B460A              <1> 	mov eax, [esi + 10]
  8032 0000696D 8B5E02              <1> 	mov ebx, [esi + 2]
  8033 00006970 01F3                <1> 	add ebx, esi
  8034 00006972 891D[BF690000]      <1> 	mov [bmpend], ebx
  8035 00006978 89D3                <1> 	mov ebx, edx
  8036 0000697A 01C6                <1> 	add esi, eax
  8037                              <1> ldxbmp:
  8038 0000697C 668B06              <1> 	mov ax, [esi]
  8039 0000697F 668907              <1> 	mov [edi], ax
  8040 00006982 81C702000000        <1> 	add edi, 2
  8041 00006988 81C602000000        <1> 	add esi, 2
  8042 0000698E 3B35[BF690000]      <1> 	cmp esi, [bmpend]
  8043 00006994 7723                <1> 	ja endedbmp
  8044 00006996 4A                  <1> 	dec edx
  8045 00006997 81FA00000000        <1> 	cmp edx, 0
  8046 0000699D 77DD                <1> 	ja ldxbmp
  8047 0000699F 31D2                <1> 	xor edx, edx
  8048 000069A1 668B15[A98B0000]    <1> 	mov dx, [resolutionx2]
  8049 000069A8 29DF                <1> 	sub edi, ebx
  8050 000069AA 29DF                <1> 	sub edi, ebx
  8051 000069AC 29D7                <1> 	sub edi, edx
  8052 000069AE 49                  <1> 	dec ecx
  8053 000069AF 89DA                <1> 	mov edx, ebx
  8054 000069B1 81F900000000        <1> 	cmp ecx, 0
  8055 000069B7 77C3                <1> 	ja ldxbmp
  8056                              <1> endedbmp:
  8057 000069B9 E801EFFFFF          <1> 	call switchmousepos2
  8058 000069BE C3                  <1> 	ret
  8059                              <1> 	
  8060 000069BF 00000000            <1> 	bmpend dd 0
  8061                              <1> 
  8062                              <1> ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;Here are some vars;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
  8063 000069C3 00000000            <1> 	showstringesi dw 0,0
  8064 000069C7 00                  <1> 	mouseon db 0
  8065 000069C8 737461727400        <1> 	start	db "start",0
  8066 000069CE 536F6C6C65724F5300  <1> 	gotomenu db "SollerOS",0
  8067 000069D7 426F6F2100          <1> 	boomsg db "Boo!",0
  8068 000069DC 5061636D616E207761- <1> 	pacmsg	db "Pacman was easy to draw.",0
  8069 000069E5 73206561737920746F- <1>
  8070 000069EE 20647261772E00      <1>
  8071 000069F5 4F6D206E6F6D206E6F- <1> 	pacnom  db "Om nom nom nom",0
  8072 000069FE 6D206E6F6D00        <1>
  8073 00006A04 77696E646F77732073- <1> 	winmsg	db "windows sucks",0
  8074 00006A0D 75636B7300          <1>
  8075 00006A12 5800                <1> 	xmsg db "X",0
  8076 00006A14 0000                <1> 	icon dw 0	;pointer to icon
  8077 00006A16 00000000            <1> 	codepointer dw 0,0 ;pointer to code
  8078 00006A1A 00                  <1> 	iconselected db 0
  8079                              <1> 	
  8080                              <1> 	boo:
  8081 00006A1B BE[D7690000]        <1> 		mov esi, boomsg
  8082 00006A20 66BA6400            <1> 		mov dx, 100
  8083 00006A24 66B94001            <1> 		mov cx, 320
  8084 00006A28 31DB                <1> 		xor ebx, ebx
  8085 00006A2A 6631C0              <1> 		xor ax, ax
  8086 00006A2D E97EF7FFFF          <1> 		jmp showstring
  8087                              <1> 
  8088                              <1> 	pacmannomnom:
  8089 00006A32 BE[F5690000]        <1> 		mov esi, pacnom
  8090 00006A37 66BA8200            <1> 		mov dx, 130
  8091 00006A3B 66B93C00            <1> 		mov cx, 60
  8092 00006A3F 31DB                <1> 		xor ebx, ebx
  8093 00006A41 6631C0              <1> 		xor ax, ax
  8094 00006A44 E967F7FFFF          <1> 		jmp showstring	
  8095                              <1> 	
  8096                              <1> 	noie:
  8097 00006A49 66C705[056B0000]80- <1> 		mov word [termwindow], 640
  8098 00006A51 02                  <1>
  8099 00006A52 66C705[076B0000]E0- <1> 		mov word [termwindow + 2], 480	;the previous lines of code make a large terminal window that is 4 characters smaller than the screen
  8100 00006A5A 01                  <1>
  8101 00006A5B BE[056B0000]        <1> 		mov esi, termwindow
  8102 00006A60 66BA1000            <1> 		mov dx, 16
  8103 00006A64 66B91000            <1> 		mov cx, 16
  8104 00006A68 BB[552C0000]        <1> 		mov ebx, os
  8105 00006A6D 6631C0              <1> 		xor ax, ax
  8106 00006A70 E8A3F7FFFF          <1> 		call showwindow
  8107 00006A75 E9DBC1FFFF          <1> 		jmp os
  8108                              <1> 
  8109                              <1> 	gotomenuboot:
  8110 00006A7A 31D2                <1> 		xor edx, edx
  8111 00006A7C 31C9                <1> 		xor ecx, ecx
  8112 00006A7E 668B15[BB8A0000]    <1> 		mov dx, [resolutionx]
  8113 00006A85 668B0D[BD8A0000]    <1> 		mov cx, [resolutiony]
  8114 00006A8C 66C1E904            <1> 		shr cx, 4
  8115 00006A90 6681E90100          <1> 		sub cx, 1
  8116 00006A95 66C1E104            <1> 		shl cx, 4
  8117 00006A99 668915[056B0000]    <1> 		mov [termwindow], dx
  8118 00006AA0 66890D[076B0000]    <1> 		mov [termwindow + 2], cx	;the previous lines of code make a large terminal window that is fullscreen
  8119 00006AA7 BE[056B0000]        <1> 		mov esi, termwindow
  8120 00006AAC 6631D2              <1> 		xor dx, dx
  8121 00006AAF 6631C9              <1> 		xor cx, cx
  8122 00006AB2 BB[552C0000]        <1> 		mov ebx, os
  8123 00006AB7 6631C0              <1> 		xor ax, ax
  8124 00006ABA E859F7FFFF          <1> 		call showwindow
  8125 00006ABF E991C1FFFF          <1> 		jmp os
  8126                              <1> 		;ret
  8127                              <1> 
  8128                              <1> 	winblows:
  8129 00006AC4 BE[046A0000]        <1> 		mov esi, winmsg
  8130 00006AC9 6631D2              <1> 		xor dx, dx
  8131 00006ACC 668B0D[BD8A0000]    <1> 		mov cx, [resolutiony]
  8132 00006AD3 6681E92000          <1> 		sub cx, 32
  8133 00006AD8 31DB                <1> 		xor ebx, ebx
  8134 00006ADA 30E4                <1> 		xor ah, ah
  8135 00006ADC B011                <1> 		mov al, 00010001b
  8136 00006ADE E8CDF6FFFF          <1> 		call showstring
  8137 00006AE3 BE[CE690000]        <1> 		mov esi, gotomenu
  8138 00006AE8 668B0D[BD8A0000]    <1> 		mov cx, [resolutiony]
  8139 00006AEF 6681E93000          <1> 		sub cx, 48
  8140 00006AF4 6631D2              <1> 		xor dx, dx
  8141 00006AF7 30E4                <1> 		xor ah, ah
  8142 00006AF9 B010                <1> 		mov al, 00010000b
  8143 00006AFB BB[7A6A0000]        <1> 		mov ebx, gotomenuboot
  8144 00006B00 E9ABF6FFFF          <1> 		jmp showstring
  8145                              <1> 
  8146 00006B05 20035802            <1> 	termwindow:	dw 800,600	;;window size
  8147 00006B09 53757065725465726D- <1> 	termmsg:	db "SuperTerminal",0	;;window title
  8148 00006B12 696E616C00          <1>
  8149                              <1> 	
  8150 00006B12 <incbin>            <1> interneticon: 	incbin 'source/precompiled/interneticon.pak'
  8151 00006B12 <incbin>            <1> wordicon: 	incbin 'source/precompiled/wordicon.pak'
  8152 00006B12 <incbin>            <1> pacmanpellet: incbin 'source/precompiled/pacmanpellet.pak'
  8153 00006B12 <incbin>            <1> ghostie	incbin 'source/precompiled/ghostie.pak'
  8154 00006B12 <incbin>            <1> pacman	incbin 'source/precompiled/pacman.pak'
  8155                                      %include 'source/arp.asm'
  8156                              <1> ;ARP TESTING
  8157                              <1> arpinit:
  8158 00006DA1 BE[586E0000]        <1> 	mov esi, arptable
  8159 00006DA6 BF[D34F0000]        <1> 	mov edi, sysmac
  8160 00006DAB BB[CF4F0000]        <1> 	mov ebx, sysip
  8161 00006DB0 8B0F                <1> 	mov ecx, [edi]
  8162 00006DB2 890E                <1> 	mov [esi], ecx
  8163 00006DB4 668B4F04            <1> 	mov cx, [edi + 4]
  8164 00006DB8 894E04              <1> 	mov [esi + 4], ecx
  8165 00006DBB 8B0B                <1> 	mov ecx, [ebx]
  8166 00006DBD 894E06              <1> 	mov [esi + 6], ecx
  8167 00006DC0 C605[576E0000]01    <1> 	mov byte [arpconfig], 1
  8168 00006DC7 C3                  <1> 	ret
  8169                              <1> arptest:
  8170 00006DC8 803D[576E0000]01    <1> 	cmp byte [arpconfig], 1
  8171 00006DCF 7405                <1> 	je arptest2
  8172 00006DD1 E8CBFFFFFF          <1> 	call arpinit
  8173                              <1> arptest2:	;try to reach 192.168.0.1
  8174 00006DD6 8B0D[D34F0000]      <1> 	mov ecx, [sysmac]
  8175 00006DDC 668B1D[D74F0000]    <1> 	mov bx, [sysmac + 4]
  8176 00006DE3 890D[1D6E0000]      <1> 	mov [sourcemac], ecx
  8177 00006DE9 66891D[216E0000]    <1> 	mov [sourcemac + 4],bx
  8178 00006DF0 890D[2D6E0000]      <1> 	mov [arpsenderinfo], ecx
  8179 00006DF6 66891D[316E0000]    <1> 	mov [arpsenderinfo + 4], bx
  8180 00006DFD BF[176E0000]        <1> 	mov edi, frame
  8181 00006E02 BE[576E0000]        <1> 	mov esi, framend
  8182 00006E07 E8F9E0FFFF          <1> 	call rtl8139.sendpacket
  8183 00006E0C BE[74780000]        <1> 	mov esi, line
  8184 00006E11 E8CEB4FFFF          <1> 	call print
  8185 00006E16 C3                  <1> 	ret
  8186                              <1> 	
  8187                              <1> ;example frame
  8188                              <1> frame:
  8189 00006E17 FFFFFFFFFFFF        <1> destinationmac:	db 0xFF,0xFF,0xFF,0xFF,0xFF,0xFF
  8190 00006E1D 000000000000        <1> sourcemac:		db 0,0,0,0,0,0
  8191 00006E23 0608                <1> ethertype:		dw 0x0806			;;arp
  8192                              <1> 	;;example packet
  8193 00006E25 0100                <1> 	arppacket: 		dw 1				;;ethernet is 1
  8194 00006E27 0008                <1> 	arpprotocol: 	dw 0x0800			;;ip is 0x800
  8195 00006E29 0604                <1> 					db 6,4				;;length of mac, length of ip
  8196 00006E2B 0100                <1> 	arpoperation: 	dw 1				;;one for arp request
  8197 00006E2D 000000000000        <1> 	arpsenderinfo:	db 0x00,0x00,0x00,0x00,0x00,0x00	;;mac
  8198 00006E33 C0A80005            <1> 					db 192,168,0,5			;;ip
  8199 00006E37 000000000000        <1> 	arptargetinfo:	db 0x00,0x00,0x00,0x00,0x00,0x00	;;ignored in requests
  8200 00006E3D C0A80001            <1> 					db 192,168,0,1			;;ip
  8201 00006E41 00<rept>            <1> padding:		times (64-($-frame)) db 0
  8202                              <1> framend:
  8203                              <1> 
  8204 00006E57 00                  <1> arpconfig db 0
  8205                              <1> arptable:	;;mac,ip
  8206 00006E58 000000000000000000- <1> 	times 10 db 0,0,0,0,0,0,0,0,0,0
  8207 00006E61 00<rept>            <1>
  8208                              <1> arptableend:
  8209                                      %include 'source/pci.asm'
  8210 00006EBC 00                  <1> pcibus		db 0
  8211 00006EBD 00                  <1> pcidevice	db 0
  8212 00006EBE 00                  <1> pcifunction	db 0
  8213 00006EBF 00                  <1> pciregister	db 0
  8214 00006EC0 00                  <1> pcireqtype db 0
  8215                              <1> 
  8216                              <1> getpciport:
  8217 00006EC1 B001                <1> 	mov al, 1
  8218 00006EC3 A2[C06E0000]        <1> 	mov [pcireqtype], al
  8219 00006EC8 E916000000          <1> 	jmp searchpci
  8220                              <1> pcidump:
  8221 00006ECD 31C0                <1> 	xor eax, eax
  8222 00006ECF A2[BE6E0000]        <1> 	mov [pcifunction], al
  8223 00006ED4 A2[BC6E0000]        <1> 	mov [pcibus], al
  8224 00006ED9 A2[BD6E0000]        <1> 	mov [pcidevice], al
  8225 00006EDE A2[C06E0000]        <1> 	mov [pcireqtype], al
  8226                              <1> searchpci:		;;return in ebx, start X in pciX
  8227 00006EE3 30C0                <1> 	xor al, al
  8228 00006EE5 A2[BF6E0000]        <1> 	mov [pciregister], al
  8229 00006EEA E855010000          <1> 	call getpciaddr
  8230 00006EEF BAF80C0000          <1> 	mov edx, 0xCF8
  8231 00006EF4 EF                  <1> 	out dx, eax	;;request pci config
  8232 00006EF5 BAFC0C0000          <1> 	mov edx, 0xCFC
  8233 00006EFA ED                  <1> 	in eax, dx 	;;read in pci config
  8234 00006EFB 3D0000FFFF          <1> 	cmp eax, 0xFFFF0000
  8235 00006F00 0F8237000000        <1> 	jb near checkpcidevice
  8236                              <1> searchpciret:
  8237                              <1> nextpcidevice:
  8238 00006F06 30C0                <1> 	xor al, al
  8239 00006F08 A2[BE6E0000]        <1> 	mov [pcifunction], al
  8240 00006F0D A0[BD6E0000]        <1> 	mov al, [pcidevice]
  8241 00006F12 3C1F                <1> 	cmp al, 11111b
  8242 00006F14 0F83C1000000        <1> 	jae near nextpcibus
  8243 00006F1A FEC0                <1> 	inc al
  8244 00006F1C A2[BD6E0000]        <1> 	mov [pcidevice], al
  8245 00006F21 EBC0                <1> 	jmp searchpci
  8246 00006F23 A0[BE6E0000]        <1> 	mov al, [pcifunction]
  8247 00006F28 3C07                <1> 	cmp al, 111b
  8248 00006F2A 0F83D6FFFFFF        <1> 	jae near nextpcidevice
  8249 00006F30 FEC0                <1> 	inc al
  8250 00006F32 A2[BE6E0000]        <1> 	mov [pcifunction], al
  8251 00006F37 EBAA                <1> 	jmp searchpci
  8252 00006F39 00000000            <1> pcitype: db 0,0,0,0
  8253                              <1> checkpcidevice:
  8254 00006F3D 30C0                <1> 	xor al, al
  8255 00006F3F 3805[C06E0000]      <1> 	cmp [pcireqtype], al
  8256 00006F45 0F842B000000        <1> 	je near dumppcidevice
  8257 00006F4B B008                <1> 	mov al, 0x08
  8258 00006F4D A2[BF6E0000]        <1> 	mov [pciregister], al	;;class code, subclass, revision id
  8259 00006F52 E8ED000000          <1> 	call getpciaddr
  8260 00006F57 BAF80C0000          <1> 	mov edx, 0xCF8
  8261 00006F5C EF                  <1> 	out dx, eax
  8262 00006F5D BAFC0C0000          <1> 	mov edx, 0xCFC
  8263 00006F62 ED                  <1> 	in eax, dx
  8264 00006F63 C1C008              <1> 	rol eax, 8
  8265 00006F66 8A1D[396F0000]      <1> 	mov bl, [pcitype]
  8266 00006F6C 38D8                <1> 	cmp al, bl
  8267 00006F6E 0F8486000000        <1> 	je near foundpciaddr
  8268 00006F74 EB90                <1> 	jmp searchpciret
  8269                              <1> dumppcidevice:
  8270 00006F76 30C0                <1> 	xor al, al
  8271 00006F78 A2[BF6E0000]        <1> 	mov [pciregister], al
  8272 00006F7D E8C2000000          <1> 	call getpciaddr
  8273 00006F82 89C1                <1> 	mov ecx, eax
  8274 00006F84 C605[97320000]05    <1> 	mov byte [firsthexshown], 5
  8275 00006F8B E81CC3FFFF          <1> 	call showhex
  8276                              <1> dumppcidevicelp:
  8277 00006F90 A2[BF6E0000]        <1> 	mov [pciregister], al
  8278 00006F95 E8AA000000          <1> 	call getpciaddr
  8279 00006F9A BAF80C0000          <1> 	mov edx, 0xCF8
  8280 00006F9F EF                  <1> 	out dx, eax
  8281 00006FA0 BAFC0C0000          <1> 	mov edx, 0xCFC
  8282 00006FA5 ED                  <1> 	in eax, dx
  8283 00006FA6 89C1                <1> 	mov ecx, eax
  8284 00006FA8 A0[BF6E0000]        <1> 	mov al, [pciregister]
  8285 00006FAD 0404                <1> 	add al, 4
  8286 00006FAF C605[97320000]05    <1> 	mov byte [firsthexshown], 5
  8287 00006FB6 E8F1C2FFFF          <1> 	call showhex
  8288 00006FBB 3C3C                <1> 	cmp al, 0x3C
  8289 00006FBD 72D1                <1> 	jb dumppcidevicelp
  8290                              <1> dumppcidn:
  8291 00006FBF 803D[88290000]00    <1> 	cmp byte [charpos], 0
  8292 00006FC6 0F843AFFFFFF        <1> 	je near searchpciret
  8293 00006FCC BE[74780000]        <1> 	mov esi, line
  8294 00006FD1 E80EB3FFFF          <1> 	call print
  8295 00006FD6 E92BFFFFFF          <1> 	jmp searchpciret
  8296                              <1> nextpcibus:
  8297 00006FDB 30C0                <1> 	xor al, al
  8298 00006FDD A2[BD6E0000]        <1> 	mov [pcidevice], al
  8299 00006FE2 A0[BC6E0000]        <1> 	mov al, [pcibus]
  8300 00006FE7 3C7F                <1> 	cmp al, 1111111b
  8301 00006FE9 730C                <1> 	jae donesearchpci
  8302 00006FEB FEC0                <1> 	inc al
  8303 00006FED A2[BC6E0000]        <1> 	mov [pcibus], al
  8304 00006FF2 E9ECFEFFFF          <1> 	jmp searchpci
  8305                              <1> donesearchpci:
  8306 00006FF7 31D2                <1> 	xor edx, edx
  8307 00006FF9 C3                  <1> 	ret
  8308                              <1> foundpciaddr:
  8309 00006FFA B010                <1> 	mov al, 0x10
  8310 00006FFC A2[BF6E0000]        <1> 	mov [pciregister], al
  8311                              <1> findpciioaddr:
  8312 00007001 E83E000000          <1> 	call getpciaddr
  8313 00007006 BAF80C0000          <1> 	mov edx, 0xCF8
  8314 0000700B EF                  <1> 	out dx, eax
  8315 0000700C BAFC0C0000          <1> 	mov edx, 0xCFC
  8316 00007011 ED                  <1> 	in eax, dx
  8317 00007012 89C3                <1> 	mov ebx, eax
  8318 00007014 81E301000000        <1> 	and ebx, 1
  8319 0000701A 81FB00000000        <1> 	cmp ebx, 0
  8320 00007020 0F8408000000        <1> 	je near notpciioaddr
  8321 00007026 2D01000000          <1> 	sub eax, 1
  8322 0000702B 89C2                <1> 	mov edx, eax
  8323 0000702D C3                  <1> 	ret
  8324                              <1> notpciioaddr:
  8325 0000702E A0[BF6E0000]        <1> 	mov al, [pciregister]
  8326 00007033 0404                <1> 	add al, 4
  8327 00007035 3C28                <1> 	cmp al, 0x28
  8328 00007037 0F87C9FEFFFF        <1> 	ja near searchpciret
  8329 0000703D A2[BF6E0000]        <1> 	mov [pciregister], al
  8330 00007042 EBBD                <1> 	jmp findpciioaddr
  8331                              <1> getpciaddr:		;;puts it in eax and ebx
  8332 00007044 31C0                <1> 			xor eax, eax
  8333 00007046 BB00000080          <1> 			mov ebx, 0x80000000
  8334 0000704B A0[BC6E0000]        <1> 			mov al, [pcibus]
  8335 00007050 C1E010              <1> 			shl eax, 16
  8336 00007053 01C3                <1> 			add ebx, eax
  8337 00007055 31C0                <1> 			xor eax, eax
  8338 00007057 A0[BD6E0000]        <1> 			mov al, [pcidevice]
  8339 0000705C C1E00B              <1> 			shl eax, 11
  8340 0000705F 01C3                <1> 			add ebx, eax
  8341 00007061 31C0                <1> 			xor eax, eax
  8342 00007063 A0[BE6E0000]        <1> 			mov al, [pcifunction]
  8343 00007068 C1E008              <1> 			shl eax, 8
  8344 0000706B 01C3                <1> 			add ebx, eax
  8345 0000706D 31C0                <1> 			xor eax, eax
  8346 0000706F A0[BF6E0000]        <1> 			mov al, [pciregister]
  8347 00007074 01C3                <1> 			add ebx, eax
  8348 00007076 89D8                <1> 			mov eax, ebx
  8349 00007078 C3                  <1> 			ret
  8350                                      %include 'source/disk.asm'
  8351                              <1> ;This loads files using the methods in the loaded driver
  8352                              <1> %include "source/drivers/disk/realmode.asm"
  8353                              <2> diskrreal:
  8354                              <2> 			;read from disk using real mode-it does not work with large files
  8355                              <2> 			;sector count in cl
  8356                              <2> 			;disk number in ch
  8357                              <2> 			;48 bit address with last 32 bits in ebx
  8358                              <2> 			;buffer in esi
  8359                              <2> 			;puts end of buffer in edi and end lba address in edx
  8360 00007079 880D[A6700000]      <2> 	mov [sdlength], cl
  8361 0000707F 891D[A7700000]      <2> 	mov [sdaddress], ebx
  8362 00007085 8935[05720000]      <2> 	mov [oldesireal], esi
  8363 0000708B 66BE[AB70]          <2> 	mov si, readdiskreal
  8364 0000708F 668935[C5100000]    <2> 	mov [realmodeptr], si
  8365 00007096 BE[E7700000]        <2> 	mov esi, backfromrealread
  8366 0000709B 8935[C1100000]      <2> 	mov [realmodereturn], esi
  8367 000070A1 E91D9FFFFF          <2> 	jmp realmode
  8368 000070A6 00                  <2> sdlength db 0
  8369 000070A7 00000000            <2> sdaddress dd 0
  8370                              <2> 
  8371                              <2> [BITS 16]
  8372                              <2> readdiskreal:
  8373 000070AB C706[D770]1000      <2> 	mov word [dlen], 0x10
  8374 000070B1 C706[DB70]0000      <2> 	mov word [daddress], 0
  8375 000070B7 C706[DD70]0001      <2> 	mov word [dsegm], 0x100
  8376 000070BD 66891E[DF70]        <2> 	mov [dlbaad], ebx
  8377 000070C2 880E[D970]          <2> 	mov [dreadlen], cl
  8378                              <2> ReadHardDisk:
  8379 000070C6 BE[D770]            <2> 	mov si, diskaddresspacket
  8380 000070C9 31C0                <2> 	xor ax, ax
  8381 000070CB B442                <2> 	mov ah, 0x42
  8382 000070CD 8A16[D670]          <2> 	mov dl, [dnumber]
  8383 000070D1 CD13                <2> 	int 0x13
  8384 000070D3 72F1                <2> 	jc ReadHardDisk
  8385 000070D5 C3                  <2> 	ret
  8386                              <2> 
  8387 000070D6 80                  <2> dnumber db 0x80
  8388                              <2> diskaddresspacket:
  8389 000070D7 10                  <2> dlen:	db 0x10 ;size of packet
  8390 000070D8 00                  <2> 		db 0
  8391 000070D9 7F00                <2> dreadlen:	dw 0x7F	;blocks to read=maximum
  8392 000070DB 0000                <2> daddress:	dw 0x0	;address 0
  8393 000070DD 0001                <2> dsegm:		dw 0x100	;segment
  8394                              <2> 		;start with known value for hd
  8395                              <2> dlbaad:
  8396 000070DF 00000000            <2> 	dd 0	;lba address
  8397 000070E3 00000000            <2> 	dd 0
  8398                              <2> [BITS 32]
  8399                              <2> backfromrealread:
  8400 000070E7 8B35[05720000]      <2> 	mov esi, [oldesireal]
  8401 000070ED 8B1D[A7700000]      <2> 	mov ebx, [sdaddress]
  8402 000070F3 31C9                <2> 	xor ecx, ecx
  8403 000070F5 8A0D[A6700000]      <2> 	mov cl, [sdlength]
  8404 000070FB 01CB                <2> 	add ebx, ecx
  8405 000070FD 66B80800            <2> 	mov ax, LINEAR_SEL
  8406 00007101 8EE0                <2> 	mov fs, ax
  8407 00007103 BF00100000          <2> 	mov edi, 0x1000
  8408 00007108 B200                <2> 	mov dl, 0
  8409 0000710A D0E1                <2> 	shl cl, 1
  8410                              <2> copyfromrmodedisk:
  8411 0000710C 648A07              <2> 	mov al, [fs:edi]
  8412 0000710F 8806                <2> 	mov [esi], al
  8413 00007111 47                  <2> 	inc edi
  8414 00007112 46                  <2> 	inc esi
  8415 00007113 FECA                <2> 	dec dl
  8416 00007115 80FA00              <2> 	cmp dl, 0
  8417 00007118 75F2                <2> 	jne copyfromrmodedisk
  8418 0000711A FEC9                <2> 	dec cl
  8419 0000711C B200                <2> 	mov dl, 0
  8420 0000711E 80F900              <2> 	cmp cl, 0
  8421 00007121 75E9                <2> 	jne copyfromrmodedisk
  8422 00007123 66B82800            <2> 	mov ax, NEW_DATA_SEL
  8423 00007127 8EE0                <2> 	mov fs, ax
  8424 00007129 89F7                <2> 	mov edi, esi
  8425 0000712B 8B35[05720000]      <2> 	mov esi, [oldesireal]
  8426 00007131 89DA                <2> 	mov edx, ebx
  8427 00007133 8B1D[A7700000]      <2> 	mov ebx, [sdaddress]
  8428 00007139 C3                  <2> 	ret
  8429                              <2> 	
  8430                              <1> loadfile:	;loads a file with the name buffer's location in edi into location in esi
  8431 0000713A 803F00              <1> 	cmp byte [edi], 0
  8432 0000713D 0F8448000000        <1> 	je near nofileload
  8433 00007143 89FA                <1> 	mov edx, edi
  8434 00007145 BB[AC8B0000]        <1> 	mov ebx, diskfileindex
  8435                              <1> nextnamechar:
  8436 0000714A 8A07                <1> 	mov al, [edi]
  8437 0000714C 3C26                <1> 	cmp al, '&'
  8438 0000714E 7440                <1> 	je nullfile
  8439 00007150 8A23                <1> 	mov ah, [ebx]
  8440 00007152 47                  <1> 	inc edi
  8441 00007153 43                  <1> 	inc ebx
  8442 00007154 88C1                <1> 	mov cl, al
  8443 00007156 08E1                <1> 	or cl, ah
  8444 00007158 80F900              <1> 	cmp cl, 0
  8445 0000715B 744E                <1> 	je equalfilenames
  8446 0000715D 80F920              <1> 	cmp cl, ' '
  8447 00007160 7449                <1> 	je equalfilenames
  8448 00007162 3C2A                <1> 	cmp al, '*'
  8449 00007164 742B                <1> 	je equalfilenames2
  8450 00007166 80FC00              <1> 	cmp ah, 0
  8451 00007169 7410                <1> 	je nextfilename
  8452 0000716B 3C00                <1> 	cmp al, 0
  8453 0000716D 7404                <1> 	je getebxzero
  8454 0000716F 38E0                <1> 	cmp al, ah
  8455 00007171 74D7                <1> 	je nextnamechar
  8456                              <1> getebxzero:
  8457 00007173 8A23                <1> 	mov ah, [ebx]
  8458 00007175 43                  <1> 	inc ebx
  8459 00007176 80FC00              <1> 	cmp ah, 0
  8460 00007179 75F8                <1> 	jne getebxzero
  8461                              <1> nextfilename:
  8462 0000717B 81C308000000        <1> 	add ebx, 8		;next descriptor
  8463 00007181 89D7                <1> 	mov edi, edx
  8464 00007183 81FB[128D0000]      <1> 	cmp ebx, enddiskfileindex
  8465 00007189 72BF                <1> 	jb nextnamechar
  8466                              <1> nofileload:
  8467 0000718B BA94010000          <1> 	mov edx, 404	;indicate not found error
  8468                              <1> nullfile:
  8469 00007190 C3                  <1> 	ret
  8470                              <1> equalfilenames2:
  8471 00007191 81EB02000000        <1> 	sub ebx, 2
  8472                              <1> eqfilefind:
  8473 00007197 43                  <1> 	inc ebx
  8474 00007198 81FB[128D0000]      <1> 	cmp ebx, enddiskfileindex
  8475 0000719E 0F83E7FFFFFF        <1> 	jae near nofileload
  8476 000071A4 8A03                <1> 	mov al, [ebx]
  8477 000071A6 3C00                <1> 	cmp al, 0
  8478 000071A8 75ED                <1> 	jne eqfilefind
  8479 000071AA 43                  <1> 	inc ebx
  8480                              <1> equalfilenames:
  8481 000071AB 8B4304              <1> 	mov eax, [ebx + 4] 	;put file size in eax
  8482 000071AE 8B1B                <1> 	mov ebx, [ebx]		;put file beginning in ebx
  8483 000071B0 031D[55010000]      <1> 	add ebx, [lbaad]	;add offset to solleros
  8484 000071B6 31C9                <1> 	xor ecx, ecx
  8485 000071B8 88C1                <1> 	mov cl, al			;get excess number of sectors
  8486 000071BA C0E102              <1> 	shl cl, 2
  8487 000071BD C0E902              <1> 	shr cl, 2			;cut off at 64
  8488 000071C0 29C8                <1> 	sub eax, ecx		;get rid of excess sectors
  8489 000071C2 B500                <1> 	mov ch, 0			;drive 0
  8490 000071C4 C1E806              <1> 	shr eax, 6			;get number of 64 sector tracks
  8491                              <1> loaddiskfile:			;tracks in eax, excess sectors in cl, drive in ch, buffer in esi, address in ebx
  8492 000071C7 A3[09720000]        <1> 	mov [filetracks], eax
  8493 000071CC 89F7                <1> 	mov edi, esi		;just in case cl is 0
  8494 000071CE 89DA                <1> 	mov edx, ebx
  8495 000071D0 80F900              <1> 	cmp cl, 0
  8496 000071D3 7405                <1> 	je copytracksforfile
  8497 000071D5 E89FFEFFFF          <1> 	call diskrreal	;take care of excess sectors
  8498                              <1> copytracksforfile:
  8499 000071DA A1[09720000]        <1> 	mov eax, [filetracks]
  8500 000071DF 3D00000000          <1> 	cmp eax, 0
  8501 000071E4 7419                <1> 	je donecopyfile
  8502 000071E6 48                  <1> 	dec eax
  8503 000071E7 A3[09720000]        <1> 	mov [filetracks], eax
  8504 000071EC 89D3                <1> 	mov ebx, edx	;get end lba
  8505 000071EE B140                <1> 	mov cl, 0x40 ;for compatability with BIOS it uses 64 instead of 128
  8506 000071F0 8A2D[54010000]      <1> 	mov ch, [DriveNumber]
  8507 000071F6 89FE                <1> 	mov esi, edi	;reset buffer
  8508 000071F8 E87CFEFFFF          <1> 	call diskrreal
  8509 000071FD EBDB                <1> 	jmp copytracksforfile
  8510                              <1> donecopyfile:
  8511 000071FF BA00000000          <1> 	mov edx, 0	;no error
  8512 00007204 C3                  <1> 	ret
  8513                              <1> 
  8514 00007205 00000000            <1> oldesireal dd 0
  8515 00007209 00000000            <1> filetracks dd 0
  8516 0000720D 00                  <1> lbad1 db 0
  8517 0000720E 00                  <1> lbad2 db 0
  8518 0000720F 00                  <1> lbad3 db 0
  8519 00007210 00                  <1> lbad4 db 0
  8520 00007211 00                  <1> lbad5 db 0
  8521 00007212 00                  <1> lbad6 db 0
  8522 00007213 6400                <1> segments dw 100
  8523                              <1> 
  8524                              <1> 
  8525                              <1> 	
  8526                                      %include 'source/threads.asm'
  8527                              <1> ;;THIS IS MY FIRST ATTEMPT AT IMPLEMENTING THREADS
  8528                              <1> threadstarttest:
  8529 00007215 E9B2040000          <1>     jmp startthreads
  8530                              <1> mainthread:
  8531 0000721A F4                  <1> 	hlt		;;this does not work properly
  8532 0000721B EBFD                <1> 	jmp mainthread
  8533                              <1> 	
  8534                              <1> nwcmdst:
  8535 0000721D C605[3C720000]00    <1> 	mov byte [threadson], 0
  8536 00007224 E973BBFFFF          <1> 	jmp nwcmd
  8537                              <1> 	
  8538                              <1> modelthread:
  8539 00007229 B001                <1> 	mov al, 1
  8540 0000722B B409                <1> 	mov ah, 9
  8541 0000722D 8B0D[2D780000]      <1> 	mov ecx, [currentthread]
  8542 00007233 CD30                <1> 	int 0x30
  8543 00007235 E85894FFFF          <1> 	call timerinterrupt
  8544 0000723A EBE1                <1> 	jmp nwcmdst
  8545                              <1> 	
  8546                              <1> 	
  8547 0000723C 00                  <1> threadson db 0
  8548 0000723D 04000000            <1> lastthread dd 4
  8549                              <1> 
  8550                              <1> thrdtst:
  8551 00007241 [29720000]<rept>    <1> times 256 dd modelthread	;;could go up to 2048, but that takes too long
  8552                              <1> thrdtstend:
  8553                              <1> 
  8554 00007641 00000000            <1> 	espold dd 0
  8555                              <1> 
  8556                              <1> threadfork:
  8557 00007645 C605[3C720000]01    <1> 	mov byte [threadson], 1
  8558 0000764C 60                  <1> 	pushad
  8559                              <1> 	
  8560 0000764D 8CC8                <1> 	mov eax, cs
  8561 0000764F 89C2                <1> 	mov edx, eax
  8562 00007651 8B4C2428            <1> 	mov ecx, [esp + 40]
  8563 00007655 81C900020000        <1> 	or ecx, 0x200
  8564 0000765B 89E3                <1> 	mov ebx, esp
  8565 0000765D BC[48B30100]        <1> 	mov esp, stackdummy
  8566                              <1> 	
  8567 00007662 60                  <1> 	pushad
  8568 00007663 B8[1A720000]        <1> 	mov eax, mainthread
  8569 00007668 89442420            <1> 	mov [esp + 32], eax
  8570 0000766C 89542424            <1> 	mov [esp + 36], edx
  8571 00007670 894C2428            <1> 	mov [esp + 40], ecx
  8572 00007674 8925[408F0100]      <1> 	mov [threadlist], esp
  8573                              <1> 	
  8574 0000767A 891D[41760000]      <1> 	mov [espold], ebx
  8575 00007680 89F0                <1> 	mov eax, esi
  8576 00007682 BC[48B70100]        <1> 	mov esp, stack1
  8577 00007687 8B1D[3D720000]      <1> 	mov ebx, [lastthread]
  8578 0000768D C1E30A              <1> 	shl ebx, 10
  8579 00007690 01DC                <1> 	add esp, ebx
  8580 00007692 C1EB0A              <1> 	shr ebx, 10
  8581 00007695 60                  <1> 	pushad
  8582 00007696 89442420            <1> 	mov [esp + 32], eax
  8583 0000769A 89542424            <1> 	mov [esp + 36], edx
  8584 0000769E 894C2428            <1> 	mov [esp + 40], ecx
  8585 000076A2 89A3[408F0100]      <1> 	mov [threadlist + ebx], esp
  8586 000076A8 8B25[41760000]      <1> 	mov esp, [espold]
  8587 000076AE 81C304000000        <1> 	add ebx, 4
  8588 000076B4 89A3[408F0100]      <1> 	mov [threadlist + ebx], esp
  8589 000076BA 81C304000000        <1> 	add ebx, 4
  8590 000076C0 891D[3D720000]      <1> 	mov [lastthread], ebx
  8591 000076C6 B020                <1> 	mov al, 0x20
  8592 000076C8 E620                <1> 	out 0x20, al
  8593 000076CA 61                  <1> 	popad
  8594 000076CB C3                  <1> 	ret
  8595                              <1> 
  8596                              <1> startthreads:
  8597 000076CC C605[3C720000]01    <1> 	mov byte [threadson], 1
  8598 000076D3 60                  <1> 	pushad
  8599                              <1> 	
  8600 000076D4 8CC8                <1> 	mov eax, cs
  8601 000076D6 89C2                <1> 	mov edx, eax
  8602 000076D8 8B4C2428            <1> 	mov ecx, [esp + 40]
  8603 000076DC 81C900020000        <1> 	or ecx, 0x200
  8604 000076E2 89E3                <1> 	mov ebx, esp
  8605 000076E4 BC[48B30100]        <1> 	mov esp, stackdummy
  8606                              <1> 	
  8607 000076E9 60                  <1> 	pushad
  8608 000076EA B8[1A720000]        <1> 	mov eax, mainthread
  8609 000076EF 89442420            <1> 	mov [esp + 32], eax	;used to be 32
  8610 000076F3 89542424            <1> 	mov [esp + 36], edx ;used to be 36
  8611 000076F7 894C2428            <1> 	mov [esp + 40], ecx
  8612 000076FB 8925[408F0100]      <1> 	mov [threadlist], esp
  8613                              <1> 
  8614                              <1> 			;;that above setup the dummy thread which for some reason does not run
  8615                              <1> 			;;this below will setup the threads found in thrdtst
  8616                              <1> 
  8617                              <1> testthreads:
  8618 00007701 BE[41720000]        <1> 	mov esi, thrdtst
  8619 00007706 BC[48B70100]        <1> 	mov esp, stack1
  8620 0000770B BF[408F0100]        <1> 	mov edi, threadlist
  8621 00007710 81C704000000        <1> 	add edi, 4
  8622                              <1> nxtthreadld:
  8623 00007716 60                  <1> 	pushad
  8624 00007717 8B06                <1> 	mov eax, [esi]
  8625 00007719 89442420            <1> 	mov [esp + 32], eax
  8626 0000771D 89542424            <1> 	mov [esp + 36], edx
  8627 00007721 894C2428            <1> 	mov [esp + 40], ecx
  8628 00007725 8927                <1> 	mov [edi], esp
  8629 00007727 81C400040000        <1> 	add esp, 1024
  8630 0000772D 81C604000000        <1> 	add esi, 4
  8631 00007733 81C704000000        <1> 	add edi, 4
  8632 00007739 81FF[48AF0100]      <1> 	cmp edi, threadlistend
  8633 0000773F 0F831A000000        <1> 	jae near nomorethreadspace
  8634 00007745 81FC[48BF2100]      <1> 	cmp esp, bssend
  8635 0000774B 0F8347000000        <1> 	jae near nomorestackspace
  8636 00007751 81FE[41760000]      <1> 	cmp esi, thrdtstend
  8637 00007757 72BD                <1> 	jb nxtthreadld
  8638 00007759 89DC                <1> 	mov esp, ebx
  8639 0000775B 61                  <1> 	popad
  8640 0000775C FB                  <1> 	sti
  8641 0000775D EBFE                <1> 	jmp $	;;wait for the irq to hook
  8642                              <1> 	
  8643                              <1> nomorethreadspace:
  8644 0000775F BE[75770000]        <1> 	mov esi, nmts
  8645 00007764 E87BABFFFF          <1> 	call print
  8646 00007769 C605[3C720000]00    <1> 	mov byte [threadson], 0
  8647 00007770 E927B6FFFF          <1> 	jmp nwcmd
  8648 00007775 74656820636F6C6F6E- <1> nmts	db "teh colonel no can haz moar treds",10,0
  8649 0000777E 656C206E6F2063616E- <1>
  8650 00007787 2068617A206D6F6172- <1>
  8651 00007790 2074726564730A00    <1>
  8652                              <1> 
  8653                              <1> nomorestackspace:
  8654 00007798 BE[AE770000]        <1> 	mov esi, nmss
  8655 0000779D E842ABFFFF          <1> 	call print
  8656 000077A2 C605[3C720000]00    <1> 	mov byte [threadson], 0
  8657 000077A9 E9EEB5FFFF          <1> 	jmp nwcmd
  8658 000077AE 74656820636F6C6F6E- <1> nmss	db "teh colonel no can haz moar staqz",10,0
  8659 000077B7 656C206E6F2063616E- <1>
  8660 000077C0 2068617A206D6F6172- <1>
  8661 000077C9 20737461717A0A00    <1>
  8662                              <1> 	
  8663                              <1> threadswitch:
  8664 000077D1 FA                  <1> 	cli
  8665 000077D2 60                  <1> 	pushad
  8666 000077D3 BF[408F0100]        <1> 	mov edi, threadlist
  8667 000077D8 A1[2D780000]        <1> 	mov eax, [currentthread]
  8668 000077DD 40                  <1> 	inc eax
  8669 000077DE A3[2D780000]        <1> 	mov [currentthread], eax
  8670 000077E3 6648                <1> 	dec ax
  8671 000077E5 C1E002              <1> 	shl eax, 2
  8672 000077E8 01C7                <1> 	add edi, eax
  8673 000077EA 8927                <1> 	mov [edi], esp
  8674 000077EC 81C704000000        <1> 	add edi, 4
  8675 000077F2 81FF[48AF0100]      <1> 	cmp edi, threadlistend
  8676 000077F8 0F830D000000        <1> 	jae near nookespthread
  8677 000077FE 8B07                <1> 	mov eax, [edi]
  8678 00007800 3D00000000          <1> 	cmp eax, 0
  8679 00007805 0F8519000000        <1> 	jne near okespthread
  8680                              <1> nookespthread:
  8681 0000780B BF[408F0100]        <1> 	mov edi, threadlist
  8682 00007810 31C0                <1> 	xor eax, eax
  8683 00007812 A3[2D780000]        <1> 	mov [currentthread], eax
  8684 00007817 8B07                <1> 	mov eax, [edi]
  8685 00007819 3D00000000          <1> 	cmp eax, 0
  8686 0000781E 0F84F9F9FFFF        <1> 	je near nwcmdst
  8687                              <1> okespthread:
  8688 00007824 89C4                <1> 	mov esp, eax
  8689 00007826 B020                <1> 	mov al, 0x20
  8690 00007828 E620                <1> 	out 0x20, al
  8691 0000782A 61                  <1> 	popad
  8692 0000782B FB                  <1> 	sti
  8693 0000782C C3                  <1> 	ret
  8694                              <1> 	
  8695 0000782D 00000000            <1> currentthread dd 0
  8696                                      %include 'source/data.asm'
  8697 00007831 6578697400          <1> 	exitmsg db	"exit",0
  8698 00007836 50726F6772616D2022- <1> 	notfound1 db "Program ",34,0
  8699 0000783F 00                  <1>
  8700 00007840 22206E6F7420666F75- <1> 	notfound2 db  34," not found.",10,0
  8701 00007849 6E642E0A00          <1>
  8702 0000784E 757365726E616D653A- <1> 	userask db "username:",0
  8703 00007857 00                  <1>
  8704 00007858 70617373776F72643A- <1> 	pwdask	db	"password:",0
  8705 00007861 00                  <1>
  8706 00007862 40                  <1> 	computer db "@"
  8707 00007863 536F6C6C65724F5300  <1> 	computername	db	"SollerOS",0
  8708 0000786C 20                  <1> 	location db " "
  8709 0000786D 2F00                <1> 	locationname db "/",0
  8710 0000786F 5D242000            <1> 	endprompt db "]$ ",0
  8711 00007873 0D                  <1> 	crlf 	db  13
  8712 00007874 0A00                <1> 	line	db	10,0
  8713                              <1> 	userlst:
  8714 00007876 726F6F7400          <1> 			db "root",0
  8715 0000787B 617765736F6D65706F- <1> 			db "awesomepower",0
  8716 00007884 77657200            <1>
  8717 00007888 7573657200          <1> 			db "user",0
  8718 0000788D 70617373776F726400  <1> 			db "password",0
  8719 00007896 6E00                <1> 			db "n",0	;;abuse for quick entry-a quick double n followed by a double enter will get you in
  8720 00007898 00                  <1> 			db 0
  8721                              <1> 	userlstend:
  8722                              <1> 	
  8723 00007898 <incbin>            <1> fonts:	incbin 'source/precompiled/fonts.pak'
  8724                              <1> fontend:
  8725                              <1> 
  8726                              <1> mcursor:
  8727 00008899 01                  <1> 	db	00000001b
  8728 0000889A 81                  <1> 	db	10000001b
  8729 0000889B C1                  <1> 	db	11000001b
  8730 0000889C E1                  <1> 	db	11100001b
  8731 0000889D F1                  <1> 	db	11110001b
  8732 0000889E F9                  <1> 	db	11111001b
  8733 0000889F FD                  <1> 	db	11111101b
  8734 000088A0 FF                  <1> 	db	11111111b
  8735 000088A1 F9                  <1> 	db	11111001b
  8736 000088A2 B9                  <1> 	db	10111001b
  8737 000088A3 39                  <1> 	db	00111001b
  8738 000088A4 1C                  <1> 	db	00011100b
  8739 000088A5 1C                  <1> 	db	00011100b
  8740 000088A6 0E                  <1> 	db	00001110b
  8741 000088A7 0E                  <1> 	db	00001110b
  8742 000088A8 0C                  <1> 	db	00001100b
  8743                              <1> 	
  8744                              <1> VBEMODEBLOCK:
  8745 000088A9 00<rept>            <1> vbesignature 		times  4 db 0 	;VBE Signature
  8746 000088AD 00<rept>            <1> vbeversion  		times  2 db 0	;VBE Version
  8747 000088AF 00<rept>            <1> oemstringptr  		times  4 db 0	;Pointer to OEM String
  8748 000088B3 00<rept>            <1> capabilities 		times  4 db 0	;Capabilities of graphics cont.
  8749 000088B7 00<rept>            <1> videomodeptr 		times  4 db 0	;Pointer to Video Mode List
  8750 000088BB 00<rept>            <1> totalmemory   		times  2 db 0	;number of 64Kb memory blocks
  8751 000088BD 00<rept>            <1> oemsoftwarerev  	times  2 db 0	;VBE implementation Software revision
  8752 000088BF 00<rept>            <1> oemvendornameptr 	times  4 db 0	;Pointer to Vendor Name String
  8753 000088C3 00<rept>            <1> oemproductnameptr 	times  4 db 0	;Pointer to Product Name String
  8754 000088C7 00<rept>            <1> oemproductrevptr 	times  4 db 0	;Pointer to Product Revision String
  8755 000088CB 00<rept>            <1> reserved			times  222 db 0	;Reserved for VBE implementation scratch area
  8756 000089A9 00<rept>            <1> oemdata 			times  256 db 0	;Data Area for OEM Strings
  8757                              <1> 
  8758                              <1> VBEMODEINFOBLOCK:
  8759                              <1> ;Mandatory information for all VBE revision
  8760 00008AA9 00<rept>            <1> modeattributes   	times  2 db 0	;Mode attributes
  8761 00008AAB 00                  <1> winaattributes   	times  1 db 0	;Window A attributes
  8762 00008AAC 00                  <1> winbattributes   	times  1 db 0	;Window B attributes
  8763 00008AAD 00<rept>            <1> wingranularity   	times  2 db 0	;Window granularity
  8764 00008AAF 00<rept>            <1> winsize          	times  2 db 0	;Window size
  8765 00008AB1 00<rept>            <1> winasegment      	times  2 db 0	;Window A start segment
  8766 00008AB3 00<rept>            <1> winbsegment      	times  2 db 0	;Window B start segment
  8767 00008AB5 00<rept>            <1> winfuncptr       	times  4 db 0	;pointer to window function
  8768 00008AB9 00<rept>            <1> bytesperscanline 	times  2 db 0	;Bytes per scan line
  8769                              <1> 
  8770                              <1> ;Mandatory information for VBE 1.2 and above
  8771 00008ABB 00<rept>            <1> resolutionx     	times  2 db 0	;Horizontal resolution in pixel or chars
  8772 00008ABD 00<rept>            <1> resolutiony	    	times  2 db 0	;Vertical resolution in pixel or chars
  8773 00008ABF 00                  <1> xcharsize       	times  1 db 0	;Character cell width in pixel
  8774 00008AC0 00                  <1> ycharsize       	times  1 db 0	;Character cell height in pixel
  8775 00008AC1 00                  <1> numberofplanes  	times  1 db 0	;Number of memory planes
  8776 00008AC2 00                  <1> bitsperpixel    	times  1 db 0	;Bits per pixel
  8777 00008AC3 00                  <1> numberofbanks   	times  1 db 0	;Number of banks
  8778 00008AC4 00                  <1> memorymodel     	times  1 db 0	;Memory model type
  8779 00008AC5 00                  <1> banksize        	times  1 db 0	;Bank size in KB
  8780 00008AC6 00                  <1> numberofimagepages	times  1 db 0	;Number of images
  8781 00008AC7 00                  <1> reserved1       	times  1 db 0	;Reserved for page function
  8782                              <1> 
  8783                              <1> ;Direct Color fields (required for direct/6 and YUV/7 memory models)
  8784 00008AC8 00                  <1> redmasksize			times  1 db 0	;Size of direct color red mask in bits
  8785 00008AC9 00                  <1> redfieldposition	times  1 db 0	;Bit position of lsb of red bask
  8786 00008ACA 00                  <1> greenmasksize   	times  1 db 0	;Size of direct color green mask in bits
  8787 00008ACB 00                  <1> greenfieldposition	times  1 db 0	;Bit position of lsb of green bask
  8788 00008ACC 00                  <1> bluemasksize		times  1 db 0	;Size of direct color blue mask in bits
  8789 00008ACD 00                  <1> bluefieldposition	times  1 db 0	;Bit position of lsb of blue bask
  8790 00008ACE 00                  <1> rsvdmasksize        times  1 db 0		;Size of direct color reserved mask in bits
  8791 00008ACF 00                  <1> rsvdfieldposition	times  1 db 0		;Bit position of lsb of reserved bask
  8792 00008AD0 00                  <1> directcolormodeinfo	times  1 db 0	;Direct color mode attributes
  8793                              <1> 
  8794                              <1> ;Mandatory information for VBE 2.0 and above
  8795 00008AD1 00<rept>            <1> physbaseptr 		times  4 db 0	;Physical address for flat frame buffer
  8796 00008AD5 00<rept>            <1> offscreenmemoffset 	times  4 db 0	;Pointer to start of off screen memory
  8797 00008AD9 00<rept>            <1> offscreenmemsize 	times  2 db 0    ;Amount of off screen memory in 1Kb units
  8798 00008ADB 00<rept>            <1> reserved2 			times  206 db 0  ;Remainder of ModeInfoBlock
  8799                              <1> 
  8800 00008BA9 0000                <1> resolutionx2 dw 0	;this is not part of the VBE but is necessary GUI info
  8801 00008BAB 00                  <1> guion db 0
  8802                              <1> VBEEND:
  8803                              <1> osend:	;this is the end of the operating system's space on disk
  8804                                      %include 'fileindex.asm'
  8805                              <1> diskfileindex:
  8806 00008BAC 617267746573742E65- <1> db "argtest.elf",0
  8807 00008BB5 6C6600              <1>
  8808 00008BB8 47000000            <1> dd (f0-$$)/512
  8809 00008BBC 08010000            <1> dd (f1-f0)/512
  8810 00008BC0 626300              <1> db "bc",0
  8811 00008BC3 4F010000            <1> dd (f1-$$)/512
  8812 00008BC7 D4020000            <1> dd (f2-f1)/512
  8813 00008BCB 63686172746573742E- <1> db "chartest.elf",0
  8814 00008BD4 656C6600            <1>
  8815 00008BD8 23040000            <1> dd (f2-$$)/512
  8816 00008BDC 28010000            <1> dd (f3-f2)/512
  8817 00008BE0 646F73746573742E63- <1> db "dostest.com",0
  8818 00008BE9 6F6D00              <1>
  8819 00008BEC 4B050000            <1> dd (f3-$$)/512
  8820 00008BF0 01000000            <1> dd (f4-f3)/512
  8821 00008BF4 66696E616C636F756E- <1> db "finalcount.snd",0
  8822 00008BFD 742E736E6400        <1>
  8823 00008C03 4C050000            <1> dd (f4-$$)/512
  8824 00008C07 01000000            <1> dd (f5-f4)/512
  8825 00008C0B 68656C6C6F776F726C- <1> db "helloworld.elf",0
  8826 00008C14 642E656C6600        <1>
  8827 00008C1A 4D050000            <1> dd (f5-$$)/512
  8828 00008C1E DA010000            <1> dd (f6-f5)/512
  8829 00008C22 696E7400            <1> db "int",0
  8830 00008C26 27070000            <1> dd (f6-$$)/512
  8831 00008C2A 01000000            <1> dd (f7-f6)/512
  8832 00008C2E 6C6F7374776F6F6473- <1> db "lostwoods.snd",0
  8833 00008C37 2E736E6400          <1>
  8834 00008C3C 28070000            <1> dd (f7-$$)/512
  8835 00008C40 01000000            <1> dd (f8-f7)/512
  8836 00008C44 6D6172696F2E736E64- <1> db "mario.snd",0
  8837 00008C4D 00                  <1>
  8838 00008C4E 29070000            <1> dd (f8-$$)/512
  8839 00008C52 01000000            <1> dd (f9-f8)/512
  8840 00008C56 736F6C6C65726F732E- <1> db "solleros.bmp",0
  8841 00008C5F 626D7000            <1>
  8842 00008C63 2A070000            <1> dd (f9-$$)/512
  8843 00008C67 B0020000            <1> dd (f10-f9)/512
  8844 00008C6B 736F6C6C65726F732E- <1> db "solleros.txt",0
  8845 00008C74 74787400            <1>
  8846 00008C78 DA090000            <1> dd (f10-$$)/512
  8847 00008C7C 01000000            <1> dd (f11-f10)/512
  8848 00008C80 736F6E676F74696D65- <1> db "songotime.snd",0
  8849 00008C89 2E736E6400          <1>
  8850 00008C8E DB090000            <1> dd (f11-$$)/512
  8851 00008C92 01000000            <1> dd (f12-f11)/512
  8852 00008C96 737464696F74657374- <1> db "stdiotest.elf",0
  8853 00008C9F 2E656C6600          <1>
  8854 00008CA4 DC090000            <1> dd (f12-$$)/512
  8855 00008CA8 26010000            <1> dd (f13-f12)/512
  8856 00008CAC 74656C7900          <1> db "tely",0
  8857 00008CB1 020B0000            <1> dd (f13-$$)/512
  8858 00008CB5 01000000            <1> dd (f14-f13)/512
  8859 00008CB9 7475746F7269616C2E- <1> db "tutorial.sh",0
  8860 00008CC2 736800              <1>
  8861 00008CC5 030B0000            <1> dd (f14-$$)/512
  8862 00008CC9 03000000            <1> dd (f15-f14)/512
  8863 00008CCD 756E667300          <1> db "unfs",0
  8864 00008CD2 060B0000            <1> dd (f15-$$)/512
  8865 00008CD6 02000000            <1> dd (f16-f15)/512
  8866 00008CDA 766963746F72792E77- <1> db "victory.wav",0
  8867 00008CE3 617600              <1>
  8868 00008CE6 080B0000            <1> dd (f16-$$)/512
  8869 00008CEA 16000000            <1> dd (f17-f16)/512
  8870 00008CEE 5F696D672E62696E00  <1> db "_img.bin",0
  8871 00008CF7 1E0B0000            <1> dd (f17-$$)/512
  8872 00008CFB D7020000            <1> dd (f18-f17)/512
  8873 00008CFF 5F756E66732D64656D- <1> db "_unfs-demo",0
  8874 00008D08 6F00                <1>
  8875 00008D0A F50D0000            <1> dd (f18-$$)/512
  8876 00008D0E 05000000            <1> dd (f19-f18)/512
  8877                              <1> enddiskfileindex:
  8878                              <1> 
  8879                                      %include 'source/bss.asm'
  8880                              <1> bssstart: equ $
  8881                              <1> stack: equ bssstart
  8882                              <1> stackend: equ stack + 4096
  8883                              <1> graphicstable equ stackend;w type, dw datalocation, w locationx, w locationy, w selected, dw code
  8884                              <1> 	graphicstableend equ graphicstable + 200h
  8885                              <1> mousecolorbuf equ graphicstableend ;where the gui under the mouse is stored
  8886                              <1> mcolorend equ mousecolorbuf + 256
  8887                              <1> fileindex: equ mcolorend
  8888                              <1> fileindexend: equ fileindex + 1024
  8889                              <1> uid equ fileindexend
  8890                              <1> IFON equ uid + 4
  8891                              <1> IFTRUE equ IFON + 1
  8892                              <1> BATCHPOS equ IFTRUE + 100
  8893                              <1> BATCHISON equ BATCHPOS + 4
  8894                              <1> LOOPON equ BATCHISON + 1
  8895                              <1> LOOPPOS	equ LOOPON + 1
  8896                              <1> variables: equ LOOPPOS + 4
  8897                              <1> varend: equ variables + 4096
  8898                              <1> buftxt2: equ varend
  8899                              <1> buftxt: equ buftxt2 + 1024 + 10
  8900                              <1> buftxtend: equ buftxt + 1024
  8901                              <1> buf2: equ buftxtend
  8902                              <1> numbuf: equ buf2 + 20
  8903                              <1> videobuf equ numbuf + 1	;1280x1024pixels in characters
  8904                              <1> videobufend	equ videobuf + 160*64*2
  8905                              <1> videobuf2 equ videobufend + 160*2
  8906                              <1> videobuf2end equ videobuf2 + 160*64*2
  8907                              <1> lastcommandpos: equ videobuf2end + 160*2
  8908                              <1> currentcommandpos: equ lastcommandpos + 4
  8909                              <1> commandbuf: equ currentcommandpos + 4
  8910                              <1> commandbufend: equ commandbuf + 4096 ;this is where kernel space only ends, the rest is for threading
  8911                              <1> rbuffstart: equ commandbufend ;for use with networking
  8912                              <1> threadlist: equ rbuffstart + 8212 ;this buffer will hold the stack locations of all of the threads, up to 2048
  8913                              <1> threadlistend: equ threadlist + 2050*4
  8914                              <1> stacks:	equ threadlistend ;the stacks will go on forever until end of memory
  8915                              <1> stackdummy: equ stacks + 1024
  8916                              <1> stack1: equ stackdummy + 1024  ;woah, thats a lot of space for stacks
  8917                              <1> bssend:	equ stack1 + 1024*2050	;from here on, it is not kernel space so apps can be loaded here.
  8918                              <1> dosprogloc equ 0x400000
  8919                                      %include 'files.asm'
  8920 00008D12 00<rept>            <1> align 512,db 0
  8921                              <1> f0:
  8922 00008D12 <incbin>            <1> incbin "included/argtest.elf"
  8923 00029C23 00<rept>            <1> align 512,db 0
  8924                              <1> f1:
  8925 00029C23 <incbin>            <1> incbin "included/bc"
  8926 000845E9 00<rept>            <1> align 512,db 0
  8927                              <1> f2:
  8928 000845E9 <incbin>            <1> incbin "included/chartest.elf"
  8929 000A94D4 00<rept>            <1> align 512,db 0
  8930                              <1> f3:
  8931 000A94D4 <incbin>            <1> incbin "included/dostest.com"
  8932 000A972B 00<rept>            <1> align 512,db 0
  8933                              <1> f4:
  8934 000A972B <incbin>            <1> incbin "included/finalcount.snd"
  8935 000A9902 00<rept>            <1> align 512,db 0
  8936                              <1> f5:
  8937 000A9902 <incbin>            <1> incbin "included/helloworld.elf"
  8938 000E4C10 00<rept>            <1> align 512,db 0
  8939                              <1> f6:
  8940 000E4C10 <incbin>            <1> incbin "included/int"
  8941 000E4F74 00<rept>            <1> align 512,db 0
  8942                              <1> f7:
  8943 000E4F74 <incbin>            <1> incbin "included/lostwoods.snd"
  8944 000E5056 00<rept>            <1> align 512,db 0
  8945                              <1> f8:
  8946 000E5056 <incbin>            <1> incbin "included/mario.snd"
  8947 000E523A 00<rept>            <1> align 512,db 0
  8948                              <1> f9:
  8949 000E523A <incbin>            <1> incbin "included/solleros.bmp"
  8950 0013B3E6 00<rept>            <1> align 512,db 0
  8951                              <1> f10:
  8952 0013B3E6 <incbin>            <1> incbin "included/solleros.txt"
  8953 0013B576 00<rept>            <1> align 512,db 0
  8954                              <1> f11:
  8955 0013B576 <incbin>            <1> incbin "included/songotime.snd"
  8956 0013B64A 00<rept>            <1> align 512,db 0
  8957                              <1> f12:
  8958 0013B64A <incbin>            <1> incbin "included/stdiotest.elf"
  8959 00160370 00<rept>            <1> align 512,db 0
  8960                              <1> f13:
  8961 00160370 <incbin>            <1> incbin "included/tely"
  8962 0016059F 00<rept>            <1> align 512,db 0
  8963                              <1> f14:
  8964 0016059F <incbin>            <1> incbin "included/tutorial.sh"
  8965 00160B45 00<rept>            <1> align 512,db 0
  8966                              <1> f15:
  8967 00160B45 <incbin>            <1> incbin "included/unfs"
  8968                              <1> align 512,db 0
  8969                              <1> f16:
  8970 00160B45 <incbin>            <1> incbin "included/victory.wav"
  8971 00163B48 00<rept>            <1> align 512,db 0
  8972                              <1> f17:
  8973 00163B48 <incbin>            <1> incbin "included/_img.bin"
  8974                              <1> align 512,db 0
  8975                              <1> f18:
  8976 00163B48 <incbin>            <1> incbin "included/_unfs-demo"
  8977                              <1> align 512,db 0
  8978                              <1> f19:
