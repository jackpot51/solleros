     1                                  [BITS 16]
     2                                      %include 'source/menu.asm'
     3                              <1>     ; MENU.ASM
     4                              <1> prog:	
     5 00000000 8CC8                <1> 	    mov ax, cs
     6 00000002 E90400              <1> 	    jmp mainindex	;;this command gives the solleros user the location of mainindex
     7 00000005 4A525300            <1> 	    db "JRS",0	;;this gives the bootloader a key to look for
     8                              <1> mainindex:
     9 00000009 E90000              <1> 	    jmp mainindexdn	;;this gives the size of the index
    10                              <1> 	    ;not needed;dw 0405h,progstart,batchprogend,fileindex,fileindexend,variables,varend,nwcmd,int30h,physbaseptr,0
    11                              <1> mainindexdn:
    12 0000000C 8ED8                <1> 	mov ds, ax
    13 0000000E 8EC0                <1> 	mov es, ax
    14 00000010 8ED0                <1> 	mov ss, ax
    15 00000012 880E[4200]          <1> 	mov [DriveNumber], cl
    16 00000016 668916[4300]        <1> 	mov [lbaad], edx
    17 0000001B B800A0              <1> 	mov ax, 0xA000
    18 0000001E 8EE8                <1> 	mov gs, ax
    19 00000020 B81200              <1> 	mov ax, 12h
    20 00000023 BB0000              <1> 	mov bx, 0
    21 00000026 CD10                <1> 	int 10h
    22 00000028 BE[0000]            <1> 	mov si, graphicstable
    23 0000002B BF[0D23]            <1> 	mov di, endbss
    24 0000002E 66B800000000        <1> 	mov eax, 0
    25                              <1> initmemory:
    26 00000034 668904              <1> 	mov [si], eax
    27 00000037 81C60400            <1> 	add si, 4
    28 0000003B 39FE                <1> 	cmp si, di
    29 0000003D 76F5                <1> 	jbe initmemory
    30 0000003F E90900              <1> 	jmp guiload
    31                              <1> 
    32 00000042 00                  <1> DriveNumber db 0
    33 00000043 00000000            <1> lbaad dd 0
    34                              <1> 	
    35 00000047 0000                <1> vesamode dw 0
    36 00000049 0000                <1> videomodecache dw 0
    37                              <1> 
    38                              <1> guiload:
    39 0000004B B8004F              <1> 	mov ax, 04F00h
    40 0000004E BF[0D20]            <1> 	mov di, VBEMODEBLOCK
    41 00000051 CD10                <1> 	int 10h
    42 00000053 BE[2F20]            <1> 	mov si, reserved
    43 00000056 81EE0200            <1> 	sub si, 2
    44                              <1> findvideomodes:
    45 0000005A 81C60200            <1> 	add si, 2
    46 0000005E 8B0C                <1> 	mov cx, [si]
    47 00000060 81F9FFFF            <1> 	cmp cx, 0xFFFF
    48 00000064 0F840A00            <1> 	je near nextvmode
    49 00000068 81FE[0D21]          <1> 	cmp si, oemdata
    50 0000006C 0F83E300            <1> 	jae near guiload2	;;kill if no valid list is found
    51 00000070 EBE8                <1> 	jmp findvideomodes 	
    52                              <1> ;;debug,shows vmodes available
    53                              <1> nextvmode:
    54 00000072 81EE0200            <1> 	sub si, 2
    55 00000076 81FE[2F20]          <1> 	cmp si, reserved
    56 0000007A 0F82D500            <1> 	jb near guiload2
    57 0000007E 8B0C                <1> 	mov cx, [si]
    58 00000080 81F9FFFF            <1> 	cmp cx, 0xFFFF
    59 00000084 0F84CB00            <1> 	je near guiload2
    60 00000088 81C10040            <1> 	add cx, 0x4000 		;;Linear Frame Buffer
    61 0000008C B8014F              <1> 	mov ax, 04F01h
    62 0000008F BF[0D22]            <1> 	mov di, VBEMODEINFOBLOCK
    63 00000092 890E[4700]          <1> 	mov [vesamode], cx
    64 00000096 CD10                <1> 	int 10h
    65 00000098 A0[2622]            <1> 	mov al, [bitsperpixel]
    66 0000009B 3C10                <1> 	cmp al, 16
    67 0000009D 75D3                <1> 	jne nextvmode
    68 0000009F 8936[4900]          <1> 	mov [videomodecache], si
    69 000000A3 80FC00              <1> 	cmp ah, 0
    70 000000A6 0F842200            <1> 	je near setvesamode
    71 000000AA EBC6                <1> 	jmp nextvmode
    72 000000AC 0A0D49732074686973- <1> isthisvideook db 10,13,"Is this video mode OK?(y/n)",13,10,0
    73 000000B5 20766964656F206D6F- <1>
    74 000000BE 6465204F4B3F28792F- <1>
    75 000000C7 6E290D0A00          <1>
    76                              <1> setvesamode:
    77 000000CC 8B0E[1F22]          <1> 	mov cx, [xresolution]
    78 000000D0 E8CC00              <1> 	call decshow
    79 000000D3 B078                <1> 	mov al, "x"
    80 000000D5 E83401              <1> 	call char
    81 000000D8 8B0E[2122]          <1> 	mov cx, [yresolution]
    82 000000DC E8C000              <1> 	call decshow
    83 000000DF B040                <1> 	mov al, "@"
    84 000000E1 E82801              <1> 	call char
    85 000000E4 8A0E[2622]          <1> 	mov cl, [bitsperpixel]
    86 000000E8 E8B400              <1> 	call decshow
    87 000000EB BE[AC00]            <1> 	mov si, isthisvideook
    88 000000EE E89600              <1> 	call printrm
    89 000000F1 B80000              <1> 	mov ax, 0
    90 000000F4 CD16                <1> 	int 16h
    91 000000F6 8B36[4900]          <1> 	mov si, [videomodecache]
    92 000000FA 3C79                <1> 	cmp al, "y"
    93 000000FC 0F8572FF            <1> 	jne nextvmode
    94 00000100 8B16[1F22]          <1> 	mov dx, [xresolution]
    95 00000104 8B0E[2122]          <1> 	mov cx, [yresolution]
    96 00000108 8916[C336]          <1> 	mov [resolutionx], dx
    97 0000010C 890E[C136]          <1> 	mov [resolutiony], cx
    98 00000110 01D2                <1> 	add dx, dx
    99 00000112 8916[C536]          <1> 	mov [resolutionx2], dx
   100 00000116 BA0000              <1> 	mov dx, 0
   101 00000119 B90000              <1> 	mov cx, 0
   102 0000011C B8024F              <1> 	mov ax, 04F02h
   103 0000011F 8B1E[4700]          <1> 	mov bx, [vesamode]
   104 00000123 CD10                <1> 	int 10h		;;enter VESA mode
   105 00000125 668B3E[3522]        <1> 	mov edi, [physbaseptr]
   106 0000012A 66B800000000        <1> 	mov eax, 0
   107 00000130 8CD8                <1> 	mov ax, ds
   108 00000132 66C1E004            <1> 	shl eax, 4
   109 00000136 6629C7              <1> 	sub edi, eax
   110 00000139 66893E[3522]        <1> 	mov [physbaseptr], edi	;;fix lfb base, is over by 0x20000 or 0x2000:0 where OS starts
   111 0000013E 6631C0              <1> 	xor eax, eax
   112 00000141 6631DB              <1> 	xor ebx, ebx
   113 00000144 6631C9              <1> 	xor ecx, ecx
   114 00000147 6631D2              <1> 	xor edx, edx
   115 0000014A 6631F6              <1> 	xor esi, esi
   116 0000014D 6631FF              <1> 	xor edi, edi	;;reset registers
   117 00000150 E91F01              <1> 	jmp pmode
   118                              <1> guiload2:
   119 00000153 B9E001              <1> 	mov cx, 480
   120 00000156 BA8002              <1> 	mov dx, 640
   121 00000159 8916[C336]          <1> 	mov [resolutionx], dx
   122 0000015D 01D2                <1> 	add dx, dx
   123 0000015F 8916[C536]          <1> 	mov [resolutionx2], dx
   124 00000163 890E[C136]          <1> 	mov [resolutiony], cx
   125 00000167 B81200              <1> 	mov ax, 12h
   126 0000016A BB0000              <1> 	mov bx, 0
   127 0000016D CD10                <1> 	int 10h
   128 0000016F C606[8601]01        <1> 	mov byte [guinodo], 1
   129 00000174 6631DB              <1> 	xor ebx, ebx
   130 00000177 6631C9              <1> 	xor ecx, ecx
   131 0000017A 6631D2              <1> 	xor edx, edx
   132 0000017D 6631F6              <1> 	xor esi, esi
   133 00000180 6631FF              <1> 	xor edi, edi
   134 00000183 E9EC00              <1> 	jmp pmode
   135                              <1> ;;	jmp gui ;;test vesa
   136                              <1> 
   137 00000186 00                  <1> guinodo db 0
   138                              <1> 
   139                              <1>     printrm:			; 'si' comes in with string address
   140 00000187 BB0700              <1> 	    mov bx,07		; write to display
   141 0000018A B40E                <1> 	    mov ah,0Eh		; screen function
   142 0000018C 8A04                <1>     prs2:    mov al,[si]         ; get next character
   143 0000018E 3C00                <1> 	    cmp al,0		; look for terminator 
   144 00000190 7405                <1>             je finpr2		; zero byte at end of string
   145 00000192 CD10                <1> 	    int 10h		; write character to screen.    
   146 00000194 46                  <1>      	    inc si	     	; move to next character
   147 00000195 EBF5                <1> 	    jmp prs2		; loop
   148 00000197 C3                  <1>     finpr2: ret
   149                              <1> 
   150 00000198 0000000000          <1> dcnm db 0,0,0,0,0
   151 0000019D 0000                <1> dcnmend db 0,0
   152                              <1> 
   153                              <1> 
   154                              <1> decshow:
   155 0000019F BE[9801]            <1> 	mov si, dcnm
   156                              <1> decclear:
   157 000001A2 B030                <1> 	mov al, "0"
   158 000001A4 8804                <1> 	mov [si], al
   159 000001A6 46                  <1> 	inc si
   160 000001A7 81FE[9D01]          <1> 	cmp si, dcnmend
   161 000001AB 76F5                <1> 	jbe decclear
   162 000001AD 4E                  <1> 	dec si
   163 000001AE E81500              <1> 	call convertrm
   164 000001B1 BE[9801]            <1> 	mov si, dcnm
   165                              <1> dectst:
   166 000001B4 8A04                <1> 	mov al, [si]
   167 000001B6 46                  <1> 	inc si
   168 000001B7 81FE[9D01]          <1> 	cmp si, dcnmend
   169 000001BB 7704                <1> 	ja dectstend
   170 000001BD 3C30                <1> 	cmp al, "0"
   171 000001BF 76F3                <1> 	jbe dectst
   172                              <1> dectstend:
   173 000001C1 4E                  <1> 	dec si
   174 000001C2 E8C2FF              <1> 	call printrm
   175 000001C5 C3                  <1> 	ret
   176                              <1> 	
   177                              <1> 	
   178                              <1> convertrm:
   179 000001C6 4E                  <1> 	dec si
   180 000001C7 89F3                <1> 	mov bx, si		;place to convert into must be in si, number to convert must be in cx
   181                              <1> cnvrtrm:
   182 000001C9 89DE                <1> 	mov si, bx
   183 000001CB 81EE0300            <1> 	sub si, 3
   184 000001CF 46                  <1> ten3rm:	inc si
   185 000001D0 81F9E803            <1> 	cmp cx, 1000
   186 000001D4 7208                <1> 	jb ten2rm
   187 000001D6 81E9E803            <1> 	sub cx, 1000
   188 000001DA FE04                <1> 	inc byte [si]
   189 000001DC EBEB                <1> 	jmp cnvrtrm
   190 000001DE 46                  <1> ten2rm:	inc si
   191 000001DF 81F96400            <1> 	cmp cx, 100
   192 000001E3 7208                <1> 	jb ten1rm
   193 000001E5 81E96400            <1> 	sub cx, 100
   194 000001E9 FE04                <1> 	inc byte [si]
   195 000001EB EBDC                <1> 	jmp cnvrtrm
   196 000001ED 46                  <1> ten1rm:	inc si
   197 000001EE 81F90A00            <1> 	cmp cx, 10
   198 000001F2 7208                <1> 	jb ten0rm
   199 000001F4 81E90A00            <1> 	sub cx, 10
   200 000001F8 FE04                <1> 	inc byte [si]
   201 000001FA EBCD                <1> 	jmp cnvrtrm
   202 000001FC 46                  <1> ten0rm:	inc si
   203 000001FD 81F90100            <1> 	cmp cx, 1
   204 00000201 7208                <1> 	jb tendnrm
   205 00000203 81E90100            <1> 	sub cx, 1
   206 00000207 FE04                <1> 	inc byte [si]
   207 00000209 EBBE                <1> 	jmp cnvrtrm
   208                              <1> tendnrm:
   209 0000020B C3                  <1> 	ret
   210                              <1> 
   211                              <1> 
   212                              <1> 
   213                              <1> 
   214                              <1>     char: 		    ;char must be in al
   215 0000020C BB0700              <1>            mov bx, 07
   216 0000020F B40E                <1> 	   mov ah, 0Eh
   217 00000211 CD10                <1> 	   int 10h
   218 00000213 C3                  <1> 	    ret
   219                              <1> 
   220                              <1> 		shutdown:
   221 00000214 E84B00              <1> 			call realmode	
   222 00000217 B80053              <1> 			MOV AX, 5300h	; Shuts down APM-Machines.
   223 0000021A 31DB                <1> 			XOR BX, BX	; Newer machines automatically
   224 0000021C CD15                <1> 			INT 15h		; shut down
   225 0000021E B80453              <1> 			MOV AX, 5304h
   226 00000221 31DB                <1> 			XOR BX, BX
   227 00000223 CD15                <1> 			INT 15h		; Interrupt 15h originally was
   228 00000225 B80153              <1> 			MOV AX, 5301h	; used for Cartridges (cassettes)
   229 00000228 31DB                <1> 			XOR BX, BX	; but is still in use for
   230 0000022A CD15                <1> 			INT 15h		; diverse things
   231 0000022C B80753              <1> 			MOV AX, 5307h
   232 0000022F BB0100              <1> 			MOV BX, 1
   233 00000232 B90300              <1> 			MOV CX, 3
   234 00000235 CD15                <1> 			INT 15h
   235 00000237 CF                  <1> 			IRET
   236                              <1> 
   237                              <1> 	coldboot:
   238 00000238 E82700              <1> 			call realmode
   239 0000023B B84000              <1> 			MOV AX, 0040h
   240 0000023E 8EC0                <1> 			MOV ES, AX
   241 00000240 26C70672000000      <1> 			MOV WORD [ES:00072h], 0h
   242 00000247 EA0000FFFF          <1> 			JMP 0FFFFh:0000h
   243 0000024C CF                  <1> 			IRET
   244                              <1> 
   245                              <1> 		warmboot:
   246 0000024D E81200              <1> 			call realmode
   247 00000250 B84000              <1> 			MOV AX, 0040h
   248 00000253 8EC0                <1> 			MOV ES, AX
   249 00000255 26C70672003412      <1> 			MOV WORD [ES:00072h], 01234h
   250 0000025C EA0000FFFF          <1> 			JMP 0FFFFh:0000h
   251 00000261 CF                  <1> 			IRET
   252                              <1> 
   253                              <1> 
   254                              <1> realmode:
   255 00000262 0F20C0              <1>    mov eax, cr0
   256 00000265 24FE                <1>    and al,0xFE     ; back to realmode
   257 00000267 0F22C0              <1>    mov  cr0, eax   ; by toggling bit again
   258 0000026A FB                  <1>    sti
   259                              <1> 
   260 0000026B 66B800000000        <1>    mov eax, 0
   261 00000271 C3                  <1>    ret
   262                                      %include 'source/pmode.asm'
   263                              <1> ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
   264                              <1> ;	16-bit real mode
   265                              <1> ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
   266                              <1> [BITS 16]
   267                              <1> pmode:
   268 00000272 BA9200              <1> 	mov dx, 0x92
   269 00000275 EC                  <1> 	in al, dx	;;A20
   270 00000276 0C02                <1> 	or al, 2
   271 00000278 EE                  <1> 	out dx, al
   272 00000279 6631DB              <1> 	xor ebx,ebx
   273 0000027C 8CCB                <1> 	mov bx,cs		; EBX=segment
   274 0000027E 66C1E304            <1> 	shl ebx,4		;	<< 4
   275 00000282 67668D03            <1> 	lea eax,[ebx]		; EAX=linear address of segment base
   276 00000286 A3[D206]            <1> 	mov [gdt2 + 2],ax
   277 00000289 A3[DA06]            <1> 	mov [gdt3 + 2],ax
   278 0000028C 66C1E810            <1> 	shr eax,16
   279 00000290 A2[D406]            <1> 	mov [gdt2 + 4],al
   280 00000293 A2[DC06]            <1> 	mov [gdt3 + 4],al
   281 00000296 8826[D706]          <1> 	mov [gdt2 + 7],ah
   282 0000029A 8826[DF06]          <1> 	mov [gdt3 + 7],ah
   283 0000029E 67668D83[C0060000]  <1> 	lea eax,[ebx + gdt]	; EAX=linear address of gdt
   284 000002A6 66A3[B606]          <1> 	mov [gdtr + 2],eax
   285 000002AA 67668D83[E5060000]  <1> 	lea eax,[ebx + idt]	; EAX=linear address of idt
   286 000002B2 66A3[BC06]          <1> 	mov [idtr + 2],eax
   287 000002B6 FA                  <1> 	cli
   288 000002B7 0F0116[B406]        <1> 	lgdt [gdtr]
   289 000002BC 0F011E[BA06]        <1> 	lidt [idtr]
   290 000002C1 0F20C0              <1> 	mov eax,cr0
   291 000002C4 0C01                <1> 	or al,1
   292 000002C6 0F22C0              <1> 	mov cr0,eax
   293 000002C9 EA[CE02]1000        <1> 	jmp SYS_CODE_SEL:do_pm
   294                              <1> [BITS 32]
   295                              <1> do_pm:
   296 000002CE 66B81800            <1> 	mov ax, SYS_DATA_SEL
   297 000002D2 8ED8                <1> 	mov ds,ax
   298 000002D4 8ED0                <1> 	mov ss,ax
   299 000002D6 BC00000000          <1> 	mov esp, 0
   300 000002DB 90                  <1> 	nop
   301 000002DC 8EC0                <1> 	mov es,ax
   302 000002DE 8EE0                <1> 	mov fs,ax
   303 000002E0 8EE8                <1> 	mov gs,ax
   304 000002E2 803D[86010000]01    <1> 	cmp byte [guinodo], 1
   305 000002E9 750A                <1> 	jne user1b
   306 000002EB E8AB0F0000          <1> 	call indexfiles
   307 000002F0 E965090000          <1> 	jmp os
   308                              <1> user1b:
   309 000002F5 E93D230000          <1> 	jmp gui
   310                              <1> 	
   311 000002FA 0000                <1> user2codepoint dw 0
   312                              <1> 
   313                              <1> unhand:	
   314                              <1> 	%assign i 0
   315                              <1> 	%rep 40
   316                              <1> 	cli
   317                              <1> 	mov byte [intprob], i
   318                              <1> 	jmp unhand2
   319                              <1> 	%assign i i+1
   320                              <1> 	%endrep
   321 000002FC FA                  <2>  cli
   322 000002FD C605[FD050000]00    <2>  mov byte [intprob], i
   323 00000304 E9FB010000          <2>  jmp unhand2
   324                              <2>  %assign i i+1
   325 00000309 FA                  <2>  cli
   326 0000030A C605[FD050000]01    <2>  mov byte [intprob], i
   327 00000311 E9EE010000          <2>  jmp unhand2
   328                              <2>  %assign i i+1
   329 00000316 FA                  <2>  cli
   330 00000317 C605[FD050000]02    <2>  mov byte [intprob], i
   331 0000031E E9E1010000          <2>  jmp unhand2
   332                              <2>  %assign i i+1
   333 00000323 FA                  <2>  cli
   334 00000324 C605[FD050000]03    <2>  mov byte [intprob], i
   335 0000032B E9D4010000          <2>  jmp unhand2
   336                              <2>  %assign i i+1
   337 00000330 FA                  <2>  cli
   338 00000331 C605[FD050000]04    <2>  mov byte [intprob], i
   339 00000338 E9C7010000          <2>  jmp unhand2
   340                              <2>  %assign i i+1
   341 0000033D FA                  <2>  cli
   342 0000033E C605[FD050000]05    <2>  mov byte [intprob], i
   343 00000345 E9BA010000          <2>  jmp unhand2
   344                              <2>  %assign i i+1
   345 0000034A FA                  <2>  cli
   346 0000034B C605[FD050000]06    <2>  mov byte [intprob], i
   347 00000352 E9AD010000          <2>  jmp unhand2
   348                              <2>  %assign i i+1
   349 00000357 FA                  <2>  cli
   350 00000358 C605[FD050000]07    <2>  mov byte [intprob], i
   351 0000035F E9A0010000          <2>  jmp unhand2
   352                              <2>  %assign i i+1
   353 00000364 FA                  <2>  cli
   354 00000365 C605[FD050000]08    <2>  mov byte [intprob], i
   355 0000036C E993010000          <2>  jmp unhand2
   356                              <2>  %assign i i+1
   357 00000371 FA                  <2>  cli
   358 00000372 C605[FD050000]09    <2>  mov byte [intprob], i
   359 00000379 E986010000          <2>  jmp unhand2
   360                              <2>  %assign i i+1
   361 0000037E FA                  <2>  cli
   362 0000037F C605[FD050000]0A    <2>  mov byte [intprob], i
   363 00000386 E979010000          <2>  jmp unhand2
   364                              <2>  %assign i i+1
   365 0000038B FA                  <2>  cli
   366 0000038C C605[FD050000]0B    <2>  mov byte [intprob], i
   367 00000393 E96C010000          <2>  jmp unhand2
   368                              <2>  %assign i i+1
   369 00000398 FA                  <2>  cli
   370 00000399 C605[FD050000]0C    <2>  mov byte [intprob], i
   371 000003A0 E95F010000          <2>  jmp unhand2
   372                              <2>  %assign i i+1
   373 000003A5 FA                  <2>  cli
   374 000003A6 C605[FD050000]0D    <2>  mov byte [intprob], i
   375 000003AD E952010000          <2>  jmp unhand2
   376                              <2>  %assign i i+1
   377 000003B2 FA                  <2>  cli
   378 000003B3 C605[FD050000]0E    <2>  mov byte [intprob], i
   379 000003BA E945010000          <2>  jmp unhand2
   380                              <2>  %assign i i+1
   381 000003BF FA                  <2>  cli
   382 000003C0 C605[FD050000]0F    <2>  mov byte [intprob], i
   383 000003C7 E938010000          <2>  jmp unhand2
   384                              <2>  %assign i i+1
   385 000003CC FA                  <2>  cli
   386 000003CD C605[FD050000]10    <2>  mov byte [intprob], i
   387 000003D4 E92B010000          <2>  jmp unhand2
   388                              <2>  %assign i i+1
   389 000003D9 FA                  <2>  cli
   390 000003DA C605[FD050000]11    <2>  mov byte [intprob], i
   391 000003E1 E91E010000          <2>  jmp unhand2
   392                              <2>  %assign i i+1
   393 000003E6 FA                  <2>  cli
   394 000003E7 C605[FD050000]12    <2>  mov byte [intprob], i
   395 000003EE E911010000          <2>  jmp unhand2
   396                              <2>  %assign i i+1
   397 000003F3 FA                  <2>  cli
   398 000003F4 C605[FD050000]13    <2>  mov byte [intprob], i
   399 000003FB E904010000          <2>  jmp unhand2
   400                              <2>  %assign i i+1
   401 00000400 FA                  <2>  cli
   402 00000401 C605[FD050000]14    <2>  mov byte [intprob], i
   403 00000408 E9F7000000          <2>  jmp unhand2
   404                              <2>  %assign i i+1
   405 0000040D FA                  <2>  cli
   406 0000040E C605[FD050000]15    <2>  mov byte [intprob], i
   407 00000415 E9EA000000          <2>  jmp unhand2
   408                              <2>  %assign i i+1
   409 0000041A FA                  <2>  cli
   410 0000041B C605[FD050000]16    <2>  mov byte [intprob], i
   411 00000422 E9DD000000          <2>  jmp unhand2
   412                              <2>  %assign i i+1
   413 00000427 FA                  <2>  cli
   414 00000428 C605[FD050000]17    <2>  mov byte [intprob], i
   415 0000042F E9D0000000          <2>  jmp unhand2
   416                              <2>  %assign i i+1
   417 00000434 FA                  <2>  cli
   418 00000435 C605[FD050000]18    <2>  mov byte [intprob], i
   419 0000043C E9C3000000          <2>  jmp unhand2
   420                              <2>  %assign i i+1
   421 00000441 FA                  <2>  cli
   422 00000442 C605[FD050000]19    <2>  mov byte [intprob], i
   423 00000449 E9B6000000          <2>  jmp unhand2
   424                              <2>  %assign i i+1
   425 0000044E FA                  <2>  cli
   426 0000044F C605[FD050000]1A    <2>  mov byte [intprob], i
   427 00000456 E9A9000000          <2>  jmp unhand2
   428                              <2>  %assign i i+1
   429 0000045B FA                  <2>  cli
   430 0000045C C605[FD050000]1B    <2>  mov byte [intprob], i
   431 00000463 E99C000000          <2>  jmp unhand2
   432                              <2>  %assign i i+1
   433 00000468 FA                  <2>  cli
   434 00000469 C605[FD050000]1C    <2>  mov byte [intprob], i
   435 00000470 E98F000000          <2>  jmp unhand2
   436                              <2>  %assign i i+1
   437 00000475 FA                  <2>  cli
   438 00000476 C605[FD050000]1D    <2>  mov byte [intprob], i
   439 0000047D E982000000          <2>  jmp unhand2
   440                              <2>  %assign i i+1
   441 00000482 FA                  <2>  cli
   442 00000483 C605[FD050000]1E    <2>  mov byte [intprob], i
   443 0000048A E975000000          <2>  jmp unhand2
   444                              <2>  %assign i i+1
   445 0000048F FA                  <2>  cli
   446 00000490 C605[FD050000]1F    <2>  mov byte [intprob], i
   447 00000497 E968000000          <2>  jmp unhand2
   448                              <2>  %assign i i+1
   449 0000049C FA                  <2>  cli
   450 0000049D C605[FD050000]20    <2>  mov byte [intprob], i
   451 000004A4 E95B000000          <2>  jmp unhand2
   452                              <2>  %assign i i+1
   453 000004A9 FA                  <2>  cli
   454 000004AA C605[FD050000]21    <2>  mov byte [intprob], i
   455 000004B1 E94E000000          <2>  jmp unhand2
   456                              <2>  %assign i i+1
   457 000004B6 FA                  <2>  cli
   458 000004B7 C605[FD050000]22    <2>  mov byte [intprob], i
   459 000004BE E941000000          <2>  jmp unhand2
   460                              <2>  %assign i i+1
   461 000004C3 FA                  <2>  cli
   462 000004C4 C605[FD050000]23    <2>  mov byte [intprob], i
   463 000004CB E934000000          <2>  jmp unhand2
   464                              <2>  %assign i i+1
   465 000004D0 FA                  <2>  cli
   466 000004D1 C605[FD050000]24    <2>  mov byte [intprob], i
   467 000004D8 E927000000          <2>  jmp unhand2
   468                              <2>  %assign i i+1
   469 000004DD FA                  <2>  cli
   470 000004DE C605[FD050000]25    <2>  mov byte [intprob], i
   471 000004E5 E91A000000          <2>  jmp unhand2
   472                              <2>  %assign i i+1
   473 000004EA FA                  <2>  cli
   474 000004EB C605[FD050000]26    <2>  mov byte [intprob], i
   475 000004F2 E90D000000          <2>  jmp unhand2
   476                              <2>  %assign i i+1
   477 000004F7 FA                  <2>  cli
   478 000004F8 C605[FD050000]27    <2>  mov byte [intprob], i
   479 000004FF E900000000          <2>  jmp unhand2
   480                              <2>  %assign i i+1
   481                              <1> unhand2:
   482 00000504 60                  <1> 	pushad
   483 00000505 C705[FA020000]0000- <1> 	mov dword [user2codepoint], 0
   484 0000050D 0000                <1>
   485 0000050F 89E6                <1> 	mov esi, esp
   486 00000511 81C624000000        <1> 	add esi, 36
   487 00000517 8935[F3050000]      <1> 	mov [esploc], esi
   488 0000051D BE[FE050000]        <1> 	mov esi, unhandmsg
   489 00000522 8935[F7050000]      <1> 	mov [esiloc], esi
   490 00000528 B900000000          <1> 	mov ecx, 0
   491 0000052D 8A0D[FD050000]      <1> 	mov cl, [intprob]
   492 00000533 E856000000          <1> 	call expdump
   493                              <1> dumpstack:
   494 00000538 8B35[F3050000]      <1> 	mov esi, [esploc]
   495 0000053E 39E6                <1> 	cmp esi, esp
   496 00000540 7215                <1> 	jb donedump
   497 00000542 8B0E                <1> 	mov ecx, [esi]
   498 00000544 81EE04000000        <1> 	sub esi, 4
   499 0000054A 8935[F3050000]      <1> 	mov [esploc], esi
   500 00000550 E839000000          <1> 	call expdump
   501 00000555 EBE1                <1> 	jmp dumpstack
   502                              <1> donedump:
   503 00000557 8B35[F3050000]      <1> 	mov esi, [esploc]
   504 0000055D 8B7C2420            <1> 	mov edi, [esp + 32]
   505 00000561 8B4FFC              <1> 	mov ecx, [edi - 4]
   506 00000564 E825000000          <1> 	call expdump
   507 00000569 8B35[F3050000]      <1> 	mov esi, [esploc]
   508 0000056F 8B7C2420            <1> 	mov edi, [esp + 32]
   509 00000573 8B0F                <1> 	mov ecx, [edi]
   510 00000575 E814000000          <1> 	call expdump
   511 0000057A 8B35[F3050000]      <1> 	mov esi, [esploc]
   512 00000580 8B7C2420            <1> 	mov edi, [esp + 32]
   513 00000584 8B4F04              <1> 	mov ecx, [edi + 4]
   514 00000587 E802000000          <1> 	call expdump
   515 0000058C EBFE                <1> 	jmp $
   516                              <1> expdump:
   517 0000058E 8B35[F7050000]      <1> 	mov esi, [esiloc]
   518 00000594 89F7                <1> 	mov edi, esi
   519 00000596 81C70D000000        <1> 	add edi, 13
   520 0000059C 81C604000000        <1> 	add esi, 4
   521 000005A2 893D[F7050000]      <1> 	mov [esiloc], edi
   522 000005A8 4F                  <1> 	dec edi
   523 000005A9 E88B0A0000          <1> 	call converthex
   524 000005AE 81EE04000000        <1> 	sub esi, 4
   525 000005B4 803D[A5280000]00    <1> 	cmp byte [guion], 0
   526 000005BB 0F8422000000        <1> 	je near expdumptext
   527 000005C1 668B0D[FB050000]    <1> 	mov cx, [locunhand]
   528 000005C8 668105[FB050000]10- <1> 	add word [locunhand], 16
   529 000005D0 00                  <1>
   530 000005D1 66BA0200            <1> 	mov dx, 2
   531 000005D5 66B80100            <1> 	mov ax, 1
   532 000005D9 66BB0000            <1> 	mov bx, 0
   533 000005DD E8872C0000          <1> 	call showstring
   534 000005E2 C3                  <1> 	ret
   535                              <1> expdumptext:
   536 000005E3 E8CF040000          <1> 	call print
   537 000005E8 BE[88400000]        <1> 	mov esi, line
   538 000005ED E8C5040000          <1> 	call print
   539 000005F2 C3                  <1> 	ret
   540 000005F3 00000000            <1> esploc dd 0
   541 000005F7 00000000            <1> esiloc dd 0
   542 000005FB 0100                <1> locunhand dw 1
   543 000005FD 00                  <1> intprob db 0
   544 000005FE 494E54203030303030- <1> 	unhandmsg	db "INT 00000000",0
   545 00000607 30303000            <1>
   546 0000060B 43533A3D3030303030- <1> 			db "CS:=00000000",0
   547 00000614 30303000            <1>
   548 00000618 4549503D3030303030- <1> 			db "EIP=00000000",0
   549 00000621 30303000            <1>
   550 00000625 4541583D3030303030- <1> 			db "EAX=00000000",0
   551 0000062E 30303000            <1>
   552 00000632 4543583D3030303030- <1> 			db "ECX=00000000",0
   553 0000063B 30303000            <1>
   554 0000063F 4544583D3030303030- <1> 			db "EDX=00000000",0
   555 00000648 30303000            <1>
   556 0000064C 4542583D3030303030- <1> 			db "EBX=00000000",0
   557 00000655 30303000            <1>
   558 00000659 4553503D3030303030- <1> 			db "ESP=00000000",0
   559 00000662 30303000            <1>
   560 00000666 4542503D3030303030- <1> 			db "EBP=00000000",0
   561 0000066F 30303000            <1>
   562 00000673 4553493D3030303030- <1> 			db "ESI=00000000",0
   563 0000067C 30303000            <1>
   564 00000680 4544493D3030303030- <1> 			db "EDI=00000000",0
   565 00000689 30303000            <1>
   566 0000068D 434D443D3030303030- <1> 			db "CMD=00000000",0
   567 00000696 30303000            <1>
   568 0000069A 434D443D3030303030- <1> 			db "CMD=00000000",0
   569 000006A3 30303000            <1>
   570 000006A7 434D443D3030303030- <1> 			db "CMD=00000000",0
   571 000006B0 30303000            <1>
   572                              <1> unhandmsgend:
   573                              <1> 
   574                              <1> [BITS 16]
   575                              <1> ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
   576                              <1> ;	16-bit limit/32-bit linear base address of GDT and IDT
   577                              <1> ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
   578 000006B4 1F00                <1> gdtr:	dw gdt_end - gdt - 1	; GDT limit
   579 000006B6 [C0060000]          <1> 	dd gdt			; linear, physical address of GDT
   580                              <1> 
   581 000006BA 8701                <1> idtr:	dw idt_end - idt - 1	; IDT limit
   582 000006BC [E5060000]          <1> 	dd idt			; linear, physical address of IDT
   583                              <1> 
   584                              <1> 
   585 000006C0 0000                <1> gdt:	dw 0			; limit 15:0
   586 000006C2 0000                <1> 	dw 0			; base 15:0
   587 000006C4 00                  <1> 	db 0			; base 23:16
   588 000006C5 00                  <1> 	db 0			; type
   589 000006C6 00                  <1> 	db 0			; limit 19:16, flags
   590 000006C7 00                  <1> 	db 0			; base 31:24
   591                              <1> ; linear data segment descriptor
   592                              <1> LINEAR_SEL	equ	$-gdt
   593 000006C8 FFFF                <1> 	dw 0xFFFF		; limit 0xFFFFF
   594 000006CA 0000                <1> 	dw 0			; base for this one is always 0
   595 000006CC 00                  <1> 	db 0
   596 000006CD 92                  <1> 	db 0x92			; present, ring 0, data, expand-up, writable
   597 000006CE CF                  <1> 	db 0xCF			; page-granular, 32-bit
   598 000006CF 00                  <1> 	db 0
   599                              <1> ; code segment descriptor
   600                              <1> SYS_CODE_SEL	equ	$-gdt
   601 000006D0 FFFF                <1> gdt2:	dw 0xFFFF
   602 000006D2 0000                <1> 	dw 0			; (base gets set above)
   603 000006D4 00                  <1> 	db 0
   604 000006D5 9A                  <1> 	db 0x9A			; present, ring 0, code, non-conforming, readable
   605 000006D6 CF                  <1> 	db 0xCF
   606 000006D7 00                  <1> 	db 0
   607                              <1> ; data segment descriptor
   608                              <1> SYS_DATA_SEL	equ	$-gdt
   609 000006D8 FFFF                <1> gdt3:	dw 0xFFFF
   610 000006DA 0000                <1> 	dw 0			; (base gets set above)
   611 000006DC 00                  <1> 	db 0
   612 000006DD 92                  <1> 	db 0x92			; present, ring 0, data, expand-up, writable
   613 000006DE CF                  <1> 	db 0xCF
   614 000006DF 00                  <1> 	db 0
   615                              <1> gdt_end:
   616                              <1> ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
   617                              <1> ;	interrupt descriptor table (IDT)
   618                              <1> ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
   619                              <1> ; 32 reserved interrupts:
   620 000006E0 494454              <1> db "IDT"
   621 000006E3 [FC02]              <1> dw unhand
   622                              <1> idt:	
   623                              <1> %assign i 0 
   624                              <1> %rep    9	;;change to 8
   625                              <1>         dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   626                              <1> %assign i i+1 
   627                              <1> %endrep
   628 000006E5 [FC02]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   629                              <2> %assign i i+1
   630 000006ED [0903]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   631                              <2> %assign i i+1
   632 000006F5 [1603]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   633                              <2> %assign i i+1
   634 000006FD [2303]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   635                              <2> %assign i i+1
   636 00000705 [3003]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   637                              <2> %assign i i+1
   638 0000070D [3D03]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   639                              <2> %assign i i+1
   640 00000715 [4A03]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   641                              <2> %assign i i+1
   642 0000071D [5703]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   643                              <2> %assign i i+1
   644 00000725 [6403]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   645                              <2> %assign i i+1
   646                              <1> ;;FILL IN 8th
   647                              <1> %assign i 9
   648                              <1> %rep    39
   649                              <1>         dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   650                              <1> %assign i i+1 
   651                              <1> %endrep
   652 0000072D [7103]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   653                              <2> %assign i i+1
   654 00000735 [7E03]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   655                              <2> %assign i i+1
   656 0000073D [8B03]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   657                              <2> %assign i i+1
   658 00000745 [9803]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   659                              <2> %assign i i+1
   660 0000074D [A503]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   661                              <2> %assign i i+1
   662 00000755 [B203]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   663                              <2> %assign i i+1
   664 0000075D [BF03]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   665                              <2> %assign i i+1
   666 00000765 [CC03]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   667                              <2> %assign i i+1
   668 0000076D [D903]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   669                              <2> %assign i i+1
   670 00000775 [E603]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   671                              <2> %assign i i+1
   672 0000077D [F303]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   673                              <2> %assign i i+1
   674 00000785 [0004]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   675                              <2> %assign i i+1
   676 0000078D [0D04]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   677                              <2> %assign i i+1
   678 00000795 [1A04]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   679                              <2> %assign i i+1
   680 0000079D [2704]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   681                              <2> %assign i i+1
   682 000007A5 [3404]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   683                              <2> %assign i i+1
   684 000007AD [4104]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   685                              <2> %assign i i+1
   686 000007B5 [4E04]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   687                              <2> %assign i i+1
   688 000007BD [5B04]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   689                              <2> %assign i i+1
   690 000007C5 [6804]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   691                              <2> %assign i i+1
   692 000007CD [7504]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   693                              <2> %assign i i+1
   694 000007D5 [8204]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   695                              <2> %assign i i+1
   696 000007DD [8F04]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   697                              <2> %assign i i+1
   698 000007E5 [9C04]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   699                              <2> %assign i i+1
   700 000007ED [A904]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   701                              <2> %assign i i+1
   702 000007F5 [B604]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   703                              <2> %assign i i+1
   704 000007FD [C304]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   705                              <2> %assign i i+1
   706 00000805 [D004]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   707                              <2> %assign i i+1
   708 0000080D [DD04]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   709                              <2> %assign i i+1
   710 00000815 [EA04]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   711                              <2> %assign i i+1
   712 0000081D [F704]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   713                              <2> %assign i i+1
   714 00000825 [0405]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   715                              <2> %assign i i+1
   716 0000082D [1105]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   717                              <2> %assign i i+1
   718 00000835 [1E05]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   719                              <2> %assign i i+1
   720 0000083D [2B05]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   721                              <2> %assign i i+1
   722 00000845 [3805]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   723                              <2> %assign i i+1
   724 0000084D [4505]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   725                              <2> %assign i i+1
   726 00000855 [5205]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   727                              <2> %assign i i+1
   728 0000085D [5F05]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   729                              <2> %assign i i+1
   730                              <1> 
   731                              <1> ;;INT 30h for os use and 3rd party use:
   732 00000865 [6D08]1000008E0000  <1> 	dw newints,SYS_CODE_SEL,0x8E00,0
   733                              <1> idt_end:
   734                                  [BITS 32]
   735                                      %include 'source/ints.asm'
   736                              <1> newints:	;;for great justice
   737 0000086D 80FC00              <1> 	cmp ah, 0		;;originally 0
   738 00000870 0F8449000000        <1> 	je near intx0   ;;0=kills app
   739 00000876 80FC01              <1> 	cmp ah, 1		;;originally 1
   740 00000879 0F8445000000        <1> 	je near intx1   ;;3=print string
   741 0000087F 80FC02              <1> 	cmp ah, 2		;;originally 2
   742 00000882 0F8442000000        <1> 	je near intx2	;;4=read string
   743 00000888 80FC03              <1> 	cmp ah, 3		;;originally 3
   744 0000088B 0F843F000000        <1> 	je near intx3	;;6=clear screen
   745 00000891 80FC04              <1> 	cmp ah, 4		;;originally 4
   746 00000894 0F843C000000        <1> 	je near intx4	;;5=read and print string
   747 0000089A 80FC05              <1> 	cmp ah, 5		;;originally 5		
   748 0000089D 0F8439000000        <1> 	je near intx5	;;2=get char
   749 000008A3 80FC06              <1> 	cmp ah, 6		;;originally 6
   750 000008A6 0F8436000000        <1> 	je near intx6	;;1=print char
   751 000008AC 80FC07              <1> 	cmp ah, 7
   752 000008AF 0F8433000000        <1> 	je near intx7	;;read file
   753 000008B5 80FC0A              <1> 	cmp ah, 10
   754 000008B8 0F8430000000        <1> 	je near intx10	;;create thread
   755 000008BE C3                  <1> 	ret
   756                              <1> 	
   757                              <1> intx0:
   758 000008BF E950040000          <1> 	jmp nwcmd
   759                              <1> intx1:
   760 000008C4 E8F6010000          <1> 	call int303
   761 000008C9 C3                  <1> 	ret
   762                              <1> intx2:
   763 000008CA E80D020000          <1> 	call int304
   764 000008CF C3                  <1> 	ret
   765                              <1> intx3:
   766 000008D0 E88E020000          <1> 	call int306
   767 000008D5 C3                  <1> 	ret
   768                              <1> intx4:
   769 000008D6 E825020000          <1> 	call int305
   770 000008DB C3                  <1> 	ret
   771                              <1> intx5:
   772 000008DC E8A6010000          <1> 	call int302
   773 000008E1 C3                  <1> 	ret
   774                              <1> intx6:
   775 000008E2 E812000000          <1> 	call int301
   776 000008E7 C3                  <1> 	ret
   777                              <1> intx7:
   778 000008E8 E8A7350000          <1> 	call loadfile
   779 000008ED C3                  <1> 	ret
   780                              <1> intx10:
   781                              <1> ;	call thread
   782 000008EE C3                  <1> 	ret
   783                              <1> 	
   784 000008EF 0000                <1> linebeginpos dw 0
   785 000008F1 0000                <1> videobufpos: dw 0
   786 000008F3 0000                <1> charpos db 0,0
   787 000008F5 A01E                <1> charxy db 160,30
   788 000008F7 0000                <1> charbuf dw 0
   789                              <1> 
   790                              <1> int301:	;;print char, char in al, modifier in bl, will run videobuf2copy if called as is
   791 000008F9 E807000000          <1> 	call int301prnt
   792 000008FE E9A4020000          <1> 	jmp termcopy
   793 00000903 00                  <1> termguion db 0
   794 00000904 00                  <1> termcopyon db 0
   795                              <1> int301prnt:
   796 00000905 88DC                <1> 	mov ah, bl
   797 00000907 66A3[F7080000]      <1> 	mov [charbuf], ax
   798 0000090D BB00000000          <1> 	mov ebx, 0
   799 00000912 668B1D[F1080000]    <1> 	mov bx, [videobufpos]
   800 00000919 BF[850C0000]        <1> 	mov edi, videobuf2
   801 0000091E 01DF                <1> 	add edi, ebx
   802 00000920 BA00000000          <1> 	mov edx, 0
   803 00000925 668B15[F3080000]    <1> 	mov dx, [charpos]
   804 0000092C B900000000          <1> 	mov ecx, 0
   805 00000931 668B0D[F5080000]    <1> 	mov cx, [charxy]
   806 00000938 3C0D                <1> 	cmp al, 13
   807 0000093A 0F844B000000        <1> 	je near int301cr
   808 00000940 3C0A                <1> 	cmp al, 10
   809 00000942 0F8479000000        <1> 	je near int301nl
   810 00000948 3C08                <1> 	cmp al, 8
   811 0000094A 0F8452000000        <1> 	je near int301bs
   812 00000950 668907              <1> 	mov [edi], ax
   813 00000953 81C702000000        <1> 	add edi, 2
   814 00000959 80C202              <1> 	add dl, 2
   815                              <1> donecrnl:
   816 0000095C 38CA                <1> 	cmp dl, cl
   817 0000095E 0F838E000000        <1> 	jae near int301eol
   818                              <1> doneeol:
   819 00000964 38EE                <1> 	cmp dh, ch
   820 00000966 0F83A4000000        <1> 	jae near int301scr	
   821                              <1> donescr:
   822 0000096C 89FB                <1> 	mov ebx, edi
   823 0000096E 81EB[850C0000]      <1> 	sub ebx, videobuf2
   824 00000974 66891D[F1080000]    <1> 	mov [videobufpos], bx
   825 0000097B 668915[F3080000]    <1> 	mov [charpos], dx
   826 00000982 66A1[F7080000]      <1> 	mov ax, [charbuf]
   827 00000988 88E3                <1> 	mov bl, ah
   828 0000098A C3                  <1> 	ret
   829                              <1> 	
   830                              <1> 	int301cr:
   831 0000098B B200                <1> 		mov dl, 0
   832 0000098D BB00000000          <1> 		mov ebx, 0
   833 00000992 BF[850C0000]        <1> 		mov edi, videobuf2
   834 00000997 668B1D[EF080000]    <1> 		mov bx, [linebeginpos]
   835 0000099E 01DF                <1> 		add edi, ebx
   836 000009A0 EBBA                <1> 		jmp donecrnl
   837                              <1> 			
   838                              <1> 	int301bs:
   839 000009A2 80FA00              <1> 		cmp dl, 0
   840 000009A5 740F                <1> 		je int301backline
   841                              <1> 	int301nobmr:
   842 000009A7 80EA02              <1> 		sub dl, 2
   843 000009AA 66B80000            <1> 		mov ax, 0
   844 000009AE 81EF02000000        <1> 		sub edi, 2
   845 000009B4 EBA6                <1> 		jmp donecrnl
   846                              <1> 	int301backline:
   847 000009B6 88CA                <1> 		mov dl, cl
   848 000009B8 80FE00              <1> 		cmp dh, 0
   849 000009BB 74EA                <1> 		je int301nobmr
   850 000009BD FECE                <1> 		dec dh
   851 000009BF EBE6                <1> 		jmp int301nobmr
   852                              <1> 		
   853                              <1> 	int301nl:
   854 000009C1 FEC6                <1> 		inc dh
   855 000009C3 BB00000000          <1> 		mov ebx, 0
   856 000009C8 88CB                <1> 		mov bl, cl
   857 000009CA BF[850C0000]        <1> 		mov edi, videobuf2
   858 000009CF 66031D[F1080000]    <1> 		add bx, [videobufpos]
   859 000009D6 01DF                <1> 		add edi, ebx
   860 000009D8 BB00000000          <1> 		mov ebx, 0
   861 000009DD 88CB                <1> 		mov bl, cl
   862 000009DF 66031D[EF080000]    <1> 		add bx, [linebeginpos]
   863 000009E6 66891D[EF080000]    <1> 		mov [linebeginpos], bx
   864 000009ED E96AFFFFFF          <1> 		jmp donecrnl
   865                              <1> 		
   866                              <1> 	int301eol:
   867 000009F2 B200                <1> 		mov dl, 0
   868 000009F4 FEC6                <1> 		inc dh
   869 000009F6 BB00000000          <1> 		mov ebx, 0
   870 000009FB 88CB                <1> 		mov bl, cl
   871 000009FD 66031D[EF080000]    <1> 		add bx, [linebeginpos]
   872 00000A04 66891D[EF080000]    <1> 		mov [linebeginpos], bx
   873 00000A0B E954FFFFFF          <1> 		jmp doneeol
   874                              <1> 		
   875                              <1> 	int301scr:
   876 00000A10 FECE                <1> 		dec dh
   877 00000A12 BF[850C0000]        <1> 		mov edi, videobuf2
   878 00000A17 BB00000000          <1> 		mov ebx, 0
   879 00000A1C 88CB                <1> 		mov bl, cl
   880 00000A1E 01FB                <1> 		add ebx, edi
   881                              <1> 	intscrollloop:
   882 00000A20 668B03              <1> 		mov ax, [ebx]
   883 00000A23 668907              <1> 		mov [edi], ax
   884 00000A26 81C702000000        <1> 		add edi, 2
   885 00000A2C 81C302000000        <1> 		add ebx, 2
   886 00000A32 80E902              <1> 		sub cl, 2
   887 00000A35 80F900              <1> 		cmp cl, 0
   888 00000A38 75E6                <1> 		jne intscrollloop
   889 00000A3A 8A0D[F5080000]      <1> 		mov cl, [charxy]
   890 00000A40 FECD                <1> 		dec ch
   891 00000A42 80FD01              <1> 		cmp ch, 1
   892 00000A45 77D9                <1> 		ja intscrollloop
   893 00000A47 66B80000            <1> 		mov ax, 0
   894 00000A4B 81EF[850C0000]      <1> 		sub edi, videobuf2
   895 00000A51 66893D[EF080000]    <1> 		mov [linebeginpos], di
   896 00000A58 81C7[850C0000]      <1> 		add edi, videobuf2
   897 00000A5E 89FB                <1> 		mov ebx, edi
   898                              <1> 	intloopclear:
   899 00000A60 668903              <1> 		mov [ebx], ax
   900 00000A63 81C302000000        <1> 		add ebx, 2
   901 00000A69 80E902              <1> 		sub cl, 2
   902 00000A6C 80F900              <1> 		cmp cl, 0
   903 00000A6F 75EF                <1> 		jne intloopclear
   904 00000A71 FECD                <1> 		dec ch
   905 00000A73 80FD00              <1> 		cmp ch, 0
   906 00000A76 75E8                <1> 		jne intloopclear
   907 00000A78 668B0D[F5080000]    <1> 		mov cx, [charxy]
   908 00000A7F E9E8FEFFFF          <1> 		jmp donescr
   909                              <1> 		
   910                              <1> 		
   911 00000A84 0000                <1> lastkey db 0,0
   912 00000A86 00                  <1> trans db 0
   913                              <1> 
   914                              <1> 	int302:		;;get char, if al is 0, wait for key
   915 00000A87 A2[860A0000]        <1> 		mov [trans], al
   916                              <1> 	transcheck:
   917 00000A8C E8B8170000          <1> 		call guistartin
   918 00000A91 8A3D[860A0000]      <1> 		mov bh, [trans]
   919 00000A97 66A1[840A0000]      <1> 		mov ax, [lastkey]
   920 00000A9D 80FC1C              <1> 		cmp ah, 1Ch
   921 00000AA0 740C                <1> 		je int302enter
   922 00000AA2 08C7                <1> 		or bh, al
   923 00000AA4 80FF00              <1> 		cmp bh, 0
   924 00000AA7 74E3                <1> 		je transcheck
   925 00000AA9 E907000000          <1> 		jmp int302end
   926                              <1> 	int302enter:
   927 00000AAE B00D                <1> 		mov al, 13
   928 00000AB0 E900000000          <1> 		jmp int302end
   929                              <1> 	int302end:
   930 00000AB5 C3                  <1> 		ret
   931                              <1> 	
   932 00000AB6 00                  <1> endkey303 db 0
   933                              <1>     print:
   934 00000AB7 66B80000            <1> 		mov ax, 0
   935 00000ABB 66BB0700            <1> 		mov bx, 7
   936                              <1> 	int303:	;;print line, al=last key,bl=modifier, esi=buffer
   937 00000ABF A2[B60A0000]        <1> 		mov [endkey303], al
   938                              <1> 	int303b:
   939 00000AC4 8A06                <1> 		mov al, [esi]
   940 00000AC6 3A05[B60A0000]      <1> 		cmp al, [endkey303]
   941 00000ACC 7408                <1> 		je doneint303
   942 00000ACE E832FEFFFF          <1> 		call int301prnt
   943 00000AD3 46                  <1> 		inc esi
   944 00000AD4 EBEE                <1> 		jmp int303b
   945                              <1> 	doneint303:
   946 00000AD6 E9CC000000          <1> 		jmp termcopy
   947                              <1> 	
   948 00000ADB 00                  <1> endkey304 db 0
   949                              <1> 	int304:	;;get line, al=last key, esi = buffer
   950 00000ADC A2[DB0A0000]        <1> 		mov [endkey304], al
   951                              <1> 	int304b:
   952 00000AE1 56                  <1> 		push esi
   953 00000AE2 B000                <1> 		mov al, 0
   954 00000AE4 E89EFFFFFF          <1> 		call int302
   955 00000AE9 5E                  <1> 		pop esi
   956 00000AEA 8806                <1> 		mov [esi], al
   957 00000AEC 46                  <1> 		inc esi
   958 00000AED 3A05[DB0A0000]      <1> 		cmp al, [endkey304]
   959 00000AF3 75EC                <1> 		jne int304b
   960 00000AF5 4E                  <1> 		dec esi
   961 00000AF6 C60600              <1> 		mov byte [esi], 0
   962 00000AF9 C3                  <1> 	ret
   963                              <1> 	
   964 00000AFA 00                  <1> endkey305 db 0
   965 00000AFB 00                  <1> modkey305 db 0
   966 00000AFC 00000000            <1> firstesi305 dd 0
   967                              <1> 	int305:	;;print and get line, al=last key, bl=modifier, esi=buffer
   968 00000B00 A2[FA0A0000]        <1> 		mov [endkey305], al
   969 00000B05 881D[FB0A0000]      <1> 		mov [modkey305], bl
   970 00000B0B 8935[FC0A0000]      <1> 		mov [firstesi305], esi
   971                              <1> 	int305b:
   972 00000B11 56                  <1> 		push esi
   973 00000B12 B000                <1> 		mov al, 0
   974 00000B14 E86EFFFFFF          <1> 		call int302
   975 00000B19 5E                  <1> 		pop esi
   976 00000B1A 3C08                <1> 		cmp al, 8
   977 00000B1C 0F841D000000        <1> 		je near int305bscheck
   978 00000B22 8806                <1> 		mov [esi], al
   979 00000B24 46                  <1> 		inc esi
   980                              <1> 	bscheckequal:
   981 00000B25 8A1D[FB0A0000]      <1> 		mov bl, [modkey305]
   982 00000B2B E8C9FDFFFF          <1> 		call int301
   983 00000B30 8A25[FA0A0000]      <1> 		mov ah, [endkey305]
   984 00000B36 38E0                <1> 		cmp al, ah
   985 00000B38 75D7                <1> 		jne int305b
   986 00000B3A 4E                  <1> 		dec esi
   987 00000B3B C60600              <1> 		mov byte [esi], 0
   988 00000B3E C3                  <1> 		ret
   989                              <1> 	
   990                              <1> 	int305bscheck:
   991 00000B3F 3B35[FC0A0000]      <1> 		cmp esi, [firstesi305]
   992 00000B45 7702                <1> 		ja goodbscheck
   993 00000B47 EBC8                <1> 		jmp int305b
   994                              <1> 	goodbscheck:
   995 00000B49 4E                  <1> 		dec esi
   996 00000B4A C60600              <1> 		mov byte [esi], 0
   997 00000B4D 8A1D[FB0A0000]      <1> 		mov bl, [modkey305]
   998 00000B53 E8A1FDFFFF          <1> 		call int301
   999 00000B58 B020                <1> 		mov al, " "
  1000 00000B5A E89AFDFFFF          <1> 		call int301
  1001 00000B5F B008                <1> 		mov al, 8
  1002 00000B61 EBC2                <1> 		jmp bscheckequal
  1003                              <1> 		
  1004                              <1> 	clear:		
  1005                              <1> 	
  1006                              <1> 	int306:	;;clear screen
  1007 00000B63 668B0D[F5080000]    <1> 		mov cx, [charxy]
  1008 00000B6A BF[850C0000]        <1> 		mov edi, videobuf2
  1009 00000B6F 66B80000            <1> 		mov ax, 0
  1010 00000B73 66A3[EF080000]      <1> 		mov [linebeginpos], ax
  1011 00000B79 66A3[F1080000]      <1> 		mov [videobufpos], ax
  1012 00000B7F 66BA0000            <1> 		mov dx, 0
  1013 00000B83 66A3[F3080000]      <1> 		mov [charpos], ax
  1014                              <1> 	int306b:
  1015 00000B89 668907              <1> 		mov [edi], ax
  1016 00000B8C 81C702000000        <1> 		add edi, 2
  1017 00000B92 80E902              <1> 		sub cl, 2
  1018 00000B95 80F900              <1> 		cmp cl, 0
  1019 00000B98 75EF                <1> 		jne int306b
  1020 00000B9A 8A0D[F5080000]      <1> 		mov cl, [charxy]
  1021 00000BA0 FECD                <1> 		dec ch
  1022 00000BA2 80FD00              <1> 		cmp ch, 0
  1023 00000BA5 75E2                <1> 		jne int306b
  1024                              <1> 	
  1025                              <1> termcopy:	
  1026 00000BA7 60                  <1> 	pusha
  1027 00000BA8 C605[A4280000]00    <1> 	mov byte [mouseselecton], 0
  1028 00000BAF C605[04090000]01    <1> 	mov byte [termcopyon], 1
  1029 00000BB6 803D[A5280000]00    <1> 	cmp byte [guion], 0
  1030 00000BBD 0F840D000000        <1> 	je near nowincopy
  1031 00000BC3 803D[03090000]01    <1> 	cmp byte [termguion], 1
  1032 00000BCA 0F84AC280000        <1> 	je near windowvideocopy
  1033                              <1> nowincopy:
  1034 00000BD0 BE00000A00          <1> 	mov esi, 0xA0000
  1035 00000BD5 81EE00000200        <1> 	sub esi, 0x20000
  1036 00000BDB BF[850C0000]        <1> 	mov edi, videobuf2
  1037 00000BE0 B900000000          <1> 	mov ecx, 0
  1038 00000BE5 668B0D[F5080000]    <1> 	mov cx, [charxy]
  1039                              <1> nowincopy2:
  1040 00000BEC BB[31410000]        <1> 	mov ebx, fonts
  1041 00000BF1 B800000000          <1> 	mov eax, 0
  1042 00000BF6 8A07                <1> 	mov al, [edi]
  1043 00000BF8 C1E004              <1> 	shl eax, 4
  1044 00000BFB 01C3                <1> 	add ebx, eax
  1045 00000BFD 47                  <1> 	inc edi
  1046 00000BFE 8A27                <1> 	mov ah, [edi]
  1047 00000C00 BA00000000          <1> 	mov edx, 0
  1048 00000C05 8A15[F5080000]      <1> 	mov dl, [charxy]
  1049 00000C0B D1EA                <1> 	shr edx, 1
  1050 00000C0D C1C110              <1> 	rol ecx, 16
  1051 00000C10 B110                <1> 	mov cl, 16
  1052                              <1> nowinfont
  1053 00000C12 8A03                <1> 	mov al, [ebx]
  1054 00000C14 D0C8                <1> 	ror al, 1
  1055 00000C16 80FC07              <1> 	cmp ah, 7
  1056 00000C19 7602                <1> 	jbe notnotfont
  1057 00000C1B F6D0                <1> 	not al
  1058                              <1> notnotfont:
  1059 00000C1D 8806                <1> 	mov [esi], al
  1060 00000C1F 01D6                <1> 	add esi, edx
  1061 00000C21 43                  <1> 	inc ebx
  1062 00000C22 FEC9                <1> 	dec cl
  1063 00000C24 80F900              <1> 	cmp cl, 0
  1064 00000C27 75E9                <1> 	jne nowinfont
  1065 00000C29 C1E204              <1> 	shl edx, 4
  1066 00000C2C 29D6                <1> 	sub esi, edx
  1067 00000C2E C1C110              <1> 	rol ecx, 16
  1068                              <1> nopresentwinfont:
  1069 00000C31 47                  <1> 	inc edi
  1070 00000C32 46                  <1> 	inc esi
  1071 00000C33 80E902              <1> 	sub cl, 2
  1072 00000C36 80F900              <1> 	cmp cl, 0
  1073 00000C39 75B1                <1> 	jne nowincopy2
  1074 00000C3B 8A0D[F5080000]      <1> 	mov cl, [charxy]
  1075 00000C41 BA00000000          <1> 	mov edx, 0
  1076 00000C46 88CA                <1> 	mov dl, cl
  1077 00000C48 D1EA                <1> 	shr edx, 1
  1078 00000C4A 29D6                <1> 	sub esi, edx
  1079 00000C4C C1E204              <1> 	shl edx, 4
  1080 00000C4F 01D6                <1> 	add esi, edx
  1081 00000C51 FECD                <1> 	dec ch
  1082 00000C53 80FD00              <1> 	cmp ch, 0
  1083 00000C56 7594                <1> 	jne nowincopy2
  1084 00000C58 61                  <1> 	popa
  1085 00000C59 C3                  <1> 	ret
  1086                                      %include 'source/solleros.asm'
  1087                              <1> 	;SOLLEROS.ASM
  1088                              <1> os:
  1089 00000C5A B403                <1> 	mov ah, 3
  1090 00000C5C CD30                <1> 	int 30h
  1091 00000C5E BE[57400000]        <1> 	mov esi, pwdask
  1092 00000C63 E84FFEFFFF          <1> 	call print
  1093 00000C68 E8A1160000          <1> 	call cursorgui
  1094                              <1> passcheck:
  1095 00000C6D BE[700A0000]        <1> 	mov esi, buftxt
  1096                              <1> passcheck2:
  1097 00000C72 B000                <1> 	mov al, 0
  1098 00000C74 B405                <1> 	mov ah, 5
  1099 00000C76 CD30                <1> 	int 30h
  1100 00000C78 3C0D                <1> 	cmp al, 13
  1101 00000C7A 0F8434000000        <1> 	je near gotpass
  1102 00000C80 3C08                <1> 	cmp al, 8
  1103 00000C82 0F840B000000        <1> 	je near backpass
  1104 00000C88 8806                <1> 	mov [esi], al
  1105 00000C8A 46                  <1> 	inc esi
  1106 00000C8B B02A                <1> 	mov al, '*'
  1107 00000C8D B406                <1> 	mov ah, 6
  1108 00000C8F CD30                <1> 	int 30h
  1109 00000C91 EBDF                <1> 	jmp passcheck2
  1110                              <1> backpass:
  1111 00000C93 81FE[700A0000]      <1> 	cmp esi, buftxt
  1112 00000C99 0F84D3FFFFFF        <1> 	je near passcheck2
  1113 00000C9F 4E                  <1> 	dec esi
  1114 00000CA0 B008                <1> 	mov al, 8
  1115 00000CA2 B406                <1> 	mov ah, 6
  1116 00000CA4 CD30                <1> 	int 30h
  1117 00000CA6 B020                <1> 	mov al, " "
  1118 00000CA8 B406                <1> 	mov ah, 6
  1119 00000CAA CD30                <1> 	int 30h
  1120 00000CAC B008                <1> 	mov al, 8
  1121 00000CAE B406                <1> 	mov ah, 6
  1122 00000CB0 CD30                <1> 	int 30h
  1123 00000CB2 EBBE                <1> 	jmp passcheck2
  1124                              <1> gotpass:
  1125 00000CB4 B000                <1> 	mov al,0
  1126 00000CB6 8806                <1> 	mov [esi], al
  1127 00000CB8 BE[88400000]        <1> 	mov esi, line
  1128 00000CBD E8F5FDFFFF          <1> 	call print
  1129 00000CC2 BE[700A0000]        <1> 	mov esi, buftxt
  1130 00000CC7 BB[67400000]        <1> 	mov ebx, pwd
  1131 00000CCC E80E010000          <1> 	call tester
  1132 00000CD1 3C01                <1> 	cmp al, 1
  1133 00000CD3 7402                <1> 	je pwdrgt
  1134 00000CD5 EB83                <1> 	jmp os
  1135 00000CD7 E887FEFFFF          <1> pwdrgt:	call clear
  1136 00000CDC 66B90002            <1> 	mov cx, 200h
  1137 00000CE0 BE[700A0000]        <1> 	mov esi, buftxt
  1138 00000CE5 B000                <1> 	mov al, 0
  1139 00000CE7 8806                <1> bufclr:	mov [esi], al
  1140 00000CE9 46                  <1> 	inc esi
  1141 00000CEA E2FB                <1> 	loop bufclr
  1142 00000CEC E923000000          <1> 	jmp nwcmd
  1143                              <1> 
  1144                              <1> buftxtclear:
  1145 00000CF1 B000                <1> 	mov al, 0
  1146 00000CF3 BE[700A0000]        <1> 	mov esi, buftxt
  1147 00000CF8 81FE[700C0000]      <1> clearbuftxt: cmp esi, buf2
  1148 00000CFE 730E                <1> 	jae retbufclr
  1149 00000D00 8806                <1> 	mov [esi], al
  1150 00000D02 46                  <1> 	inc esi
  1151 00000D03 EBF3                <1> 	jmp clearbuftxt
  1152                              <1> 
  1153 00000D05 39DE                <1> clearitbuf: cmp esi, ebx
  1154 00000D07 7305                <1> 	jae retbufclr
  1155 00000D09 8806                <1> 	mov [esi], al
  1156 00000D0B 46                  <1> 	inc esi
  1157 00000D0C EBF7                <1> 	jmp clearitbuf
  1158 00000D0E C3                  <1> retbufclr: ret
  1159                              <1> 
  1160 00000D0F E900000000          <1> full:	jmp nwcmd
  1161                              <1> 
  1162                              <1> 
  1163 00000D14 B001                <1> nwcmd:	mov al, 1
  1164 00000D16 3805[69030000]      <1> 	cmp [BATCHISON], al
  1165 00000D1C 0F832D000000        <1> 	jae near batchran
  1166 00000D22 B000                <1> cancel:	mov al, 0
  1167 00000D24 A2[00030000]        <1> 	mov [IFON], al
  1168 00000D29 A2[69030000]        <1> 	mov [BATCHISON], al
  1169 00000D2E BE[70400000]        <1> 	mov esi, cmd
  1170 00000D33 E87FFDFFFF          <1> 	call print
  1171 00000D38 E8B4FFFFFF          <1> 	call buftxtclear
  1172 00000D3D BE[700A0000]        <1> 	mov esi, buftxt
  1173 00000D42 B00D                <1> 	mov al, 13
  1174 00000D44 B307                <1> 	mov bl, 7
  1175 00000D46 B404                <1> 	mov ah, 4
  1176 00000D48 CD30                <1> 	int 30h
  1177                              <1> gotcmd:	
  1178 00000D4A E914000000          <1> 	jmp run
  1179                              <1> 	
  1180                              <1> batchran:
  1181 00000D4F C3                  <1> 	ret
  1182                              <1> 
  1183 00000D50 E89CFFFFFF          <1> input:	call buftxtclear
  1184 00000D55 BE[700A0000]        <1> 	mov esi, buftxt		;puts input into buftxt AND onto screen
  1185 00000D5A B00D                <1> stdin:	mov al, 13
  1186 00000D5C B307                <1> 	mov bl, 7
  1187 00000D5E B404                <1> 	mov ah, 4
  1188 00000D60 CD30                <1> 	int 30h
  1189 00000D62 C3                  <1> 	ret
  1190                              <1> 
  1191 00000D63 BE[88400000]        <1> run:	mov esi, line
  1192 00000D68 E84AFDFFFF          <1> 		call print
  1193                              <1> progtest:
  1194 00000D6D BE[700A0000]        <1> 	mov esi, buftxt
  1195 00000D72 BB[6F030000]        <1> 	mov ebx, fileindex
  1196 00000D77 668B03              <1> prgnxt:	mov ax, [ebx]
  1197 00000D7A B105                <1> 	mov cl, 5
  1198 00000D7C B504                <1> 	mov ch, 4
  1199 00000D7E 6639C8              <1> 	cmp ax, cx
  1200 00000D81 740B                <1> 	je fndprg
  1201 00000D83 43                  <1> 	inc ebx
  1202 00000D84 81FB[6F050000]      <1> 	cmp ebx, fileindexend
  1203 00000D8A 7330                <1> 	jae prgnf
  1204 00000D8C EBE9                <1> 	jmp prgnxt
  1205 00000D8E 81C302000000        <1> fndprg: add ebx, 2
  1206 00000D94 BE[700A0000]        <1> 	mov esi, buftxt
  1207 00000D99 66B90000            <1> 	mov cx, 0
  1208 00000D9D E877000000          <1> 	call cndtest
  1209 00000DA2 3C01                <1> 	cmp al, 1
  1210 00000DA4 7302                <1> 	jae prggood
  1211 00000DA6 EBCF                <1> 	jmp prgnxt
  1212 00000DA8 81FB[6F050000]      <1> prggood: cmp ebx, fileindexend
  1213 00000DAE 732A                <1> 	jae prgdn
  1214 00000DB0 81C303000000        <1> 	add ebx, 3
  1215 00000DB6 8B3B                <1> 	mov edi, [ebx]
  1216 00000DB8 90                  <1> 	nop
  1217 00000DB9 90                  <1> 	nop
  1218 00000DBA FFE7                <1> 	jmp edi
  1219 00000DBC BE[3E400000]        <1> prgnf:	mov esi, notfound1
  1220 00000DC1 E8F1FCFFFF          <1> 	call print
  1221 00000DC6 BE[700A0000]        <1> 	mov esi, buftxt
  1222 00000DCB E8E7FCFFFF          <1> 	call print
  1223 00000DD0 BE[48400000]        <1> 	mov esi, notfound2
  1224 00000DD5 E8DDFCFFFF          <1> 	call print
  1225 00000DDA E935FFFFFF          <1> prgdn:	jmp nwcmd
  1226                              <1> 
  1227                              <1> 
  1228                              <1> tester:			;si=user bx=prog returns 1 in al if true
  1229 00000DDF B000                <1> 	mov al, 0
  1230 00000DE1 8A06                <1> retest:	mov al, [esi]
  1231 00000DE3 8A23                <1> 	mov ah, [ebx]
  1232 00000DE5 3C00                <1> 	cmp al, 0
  1233 00000DE7 7408                <1> 	je testtrue
  1234 00000DE9 38E0                <1> 	cmp al, ah
  1235 00000DEB 750C                <1> 	jne testfalse
  1236 00000DED 43                  <1> 	inc ebx
  1237 00000DEE 46                  <1> 	inc esi
  1238 00000DEF EBF0                <1> 	jmp retest
  1239                              <1> testtrue:
  1240 00000DF1 80FC00              <1> 	cmp ah, 0
  1241 00000DF4 7503                <1> 	jne testfalse
  1242 00000DF6 B001                <1> 	mov al, 1
  1243 00000DF8 C3                  <1> 	ret
  1244                              <1> testfalse:
  1245 00000DF9 B000                <1> 	mov al, 0
  1246 00000DFB C3                  <1> 	ret
  1247                              <1> 
  1248                              <1> optest:			;si=user bx=prog returns 1 in al if true
  1249 00000DFC B000                <1> 	mov al, 0
  1250                              <1> opretest:
  1251 00000DFE 8A06                <1> 	mov al, [esi]
  1252 00000E00 8A23                <1> 	mov ah, [ebx]
  1253 00000E02 38E0                <1> 	cmp al, ah
  1254 00000E04 7510                <1> 	jne optestfalse
  1255 00000E06 80FC00              <1> 	cmp ah, 0
  1256 00000E09 7404                <1> 	je optesttrue
  1257 00000E0B 43                  <1> 	inc ebx
  1258 00000E0C 46                  <1> 	inc esi
  1259 00000E0D EBEF                <1> 	jmp opretest
  1260                              <1> optesttrue:
  1261 00000E0F 3C00                <1> 	cmp al, 0
  1262 00000E11 7503                <1> 	jne optestfalse
  1263 00000E13 B001                <1> 	mov al, 1
  1264 00000E15 C3                  <1> 	ret
  1265                              <1> optestfalse:
  1266 00000E16 B000                <1> 	mov al, 0
  1267 00000E18 C3                  <1> 	ret
  1268                              <1> 
  1269                              <1> cndtest:			;si=user bx=prog cl=endchar returns 1 in al if true
  1270 00000E19 B000                <1> 	mov al, 0
  1271 00000E1B 8A06                <1> cndretest:	mov al, [esi]
  1272 00000E1D 8A23                <1> 	mov ah, [ebx]
  1273 00000E1F 38CC                <1> 	cmp ah, cl
  1274 00000E21 7408                <1> 	je cndtesttrue
  1275 00000E23 38E0                <1> 	cmp al, ah
  1276 00000E25 750B                <1> 	jne cndtestfalse
  1277 00000E27 43                  <1> 	inc ebx
  1278 00000E28 46                  <1> 	inc esi
  1279 00000E29 EBF0                <1> 	jmp cndretest
  1280                              <1> cndtesttrue:
  1281 00000E2B 38C8                <1> 	cmp al, cl
  1282 00000E2D 7506                <1> 	jne cndtestalmost
  1283 00000E2F B001                <1> 	mov al, 1
  1284 00000E31 C3                  <1> 	ret
  1285                              <1> cndtestfalse:
  1286 00000E32 B000                <1> 	mov al, 0
  1287 00000E34 C3                  <1> 	ret
  1288                              <1> cndtestalmost:
  1289 00000E35 B002                <1> 	mov al, 2
  1290 00000E37 C3                  <1> 	ret
  1291 00000E38 00                  <1> currentdir db 0
  1292 00000E39 BE[6F030000]        <1> dir:	mov esi, fileindex
  1293 00000E3E 8A06                <1> 	dirnxt:	mov al, [esi]
  1294 00000E40 B400                <1> 		mov ah, 0
  1295 00000E42 3C05                <1> 		cmp al, 5
  1296 00000E44 744A                <1> 		je dirfnd
  1297 00000E46 3C07                <1> 		cmp al, 7
  1298 00000E48 743C                <1> 		je dirfnd3
  1299 00000E4A 3C06                <1> 		cmp al, 6
  1300 00000E4C 7438                <1> 		je dirfnd3
  1301 00000E4E 46                  <1> 		inc esi
  1302 00000E4F 81FE[6F050000]      <1> 		cmp esi,  fileindexend
  1303 00000E55 737B                <1> 		jae dirdn
  1304 00000E57 EBE5                <1> 		jmp dirnxt
  1305 00000E59 060400626174636800- <1> 	typetable db 6,4,0,"batch",0,7,4,0,"document",0,10,4,0,"folder",0,5,4,0,"executable",0
  1306 00000E62 070400646F63756D65- <1>
  1307 00000E6B 6E74000A0400666F6C- <1>
  1308 00000E74 646572000504006578- <1>
  1309 00000E7D 6563757461626C6500  <1>
  1310                              <1> 	dirfnd3:
  1311 00000E86 46                  <1> 		inc esi
  1312 00000E87 81FE[6F050000]      <1> 		cmp esi, fileindexend
  1313 00000E8D 76AF                <1> 		jbe dirnxt
  1314 00000E8F 4E                  <1> 		dec esi
  1315 00000E90 46                  <1> 	dirfnd:	inc esi
  1316 00000E91 8A06                <1> 		mov al, [esi]
  1317 00000E93 B400                <1> 		mov ah, 0
  1318 00000E95 3C04                <1> 		cmp al, 4
  1319 00000E97 740B                <1> 		je dirfnd2
  1320 00000E99 46                  <1> 		inc esi
  1321 00000E9A 81FE[6F050000]      <1> 		cmp esi,  fileindexend
  1322 00000EA0 7330                <1> 		jae dirdn
  1323 00000EA2 EB9A                <1> 		jmp dirnxt
  1324 00000EA4 81C601000000        <1> 	dirfnd2: add esi, 1
  1325 00000EAA E808FCFFFF          <1> 		call print
  1326 00000EAF 8935[D70E0000]      <1> 		mov [esidir], esi
  1327 00000EB5 BE[88400000]        <1> 		mov esi, line
  1328 00000EBA E8F8FBFFFF          <1> 		call print
  1329 00000EBF 8B35[D70E0000]      <1> 		mov esi, [esidir]
  1330 00000EC5 81FE[6F050000]      <1> 		cmp esi,  fileindexend
  1331 00000ECB 7305                <1> 		jae dirdn
  1332 00000ECD E96CFFFFFF          <1> 		jmp dirnxt
  1333 00000ED2 E93DFEFFFF          <1> 	dirdn:	jmp nwcmd
  1334 00000ED7 00000000            <1> esidir dd 0
  1335                              <1> 
  1336                              <1> array:				;arraystart in si, arrayend in bx, arrayseperator in cx
  1337                              <1> 		                ;ends if array seperator is found backwards after 0
  1338                              <1> 	arnxt:	      
  1339 00000EDB 88E8                <1> 		mov al, ch
  1340 00000EDD 88CC                <1> 		mov ah, cl        
  1341 00000EDF 663906              <1> 		cmp [esi], ax
  1342 00000EE2 744D                <1> 		je ardn
  1343 00000EE4 66390E              <1> 		cmp [esi], cx
  1344 00000EE7 7407                <1> 		je arfnd
  1345 00000EE9 46                  <1> 		inc esi
  1346 00000EEA 39DE                <1> 		cmp esi, ebx
  1347 00000EEC 7343                <1> 		jae ardn
  1348 00000EEE EBEB                <1> 		jmp arnxt
  1349 00000EF0 81C602000000        <1> 	arfnd: add esi, 2
  1350 00000EF6 891D[320F0000]      <1> 		mov [arbx], ebx
  1351 00000EFC 890D[360F0000]      <1> 		mov [arcx], ecx
  1352 00000F02 E8B0FBFFFF          <1> 		call print
  1353 00000F07 8935[380F0000]      <1> 		mov [arsi], esi
  1354 00000F0D BE[88400000]        <1> 		mov esi, line
  1355 00000F12 E8A0FBFFFF          <1> 		call print
  1356 00000F17 8B1D[320F0000]      <1> 		mov ebx, [arbx]
  1357 00000F1D 668B0D[360F0000]    <1> 		mov cx, [arcx]
  1358 00000F24 8B35[380F0000]      <1> 		mov esi, [arsi]
  1359 00000F2A 46                  <1> 		inc esi
  1360 00000F2B 39DE                <1> 		cmp esi, ebx
  1361 00000F2D 7302                <1> 		jae ardn
  1362 00000F2F EBAA                <1> 		jmp arnxt
  1363 00000F31 C3                  <1> 	ardn:	ret
  1364 00000F32 00000000            <1> arbx:	dw 0,0
  1365 00000F36 0000                <1> arcx:	db 0,0
  1366 00000F38 00000000            <1> arsi:	dw 0,0
  1367                              <1> 
  1368                              <1> clearbuffer:
  1369 00000F3C BE[700C0000]        <1> 	mov esi, buf2
  1370 00000F41 B030                <1> 	mov al, '0'
  1371 00000F43 81FE[840C0000]      <1> clearbuf: cmp esi, numbuf
  1372 00000F49 7305                <1> 	jae doneclearbuff
  1373 00000F4B 8806                <1> 	mov [esi], al
  1374 00000F4D 46                  <1> 	inc esi
  1375 00000F4E EBF3                <1> 	jmp clearbuf
  1376                              <1> doneclearbuff: 
  1377 00000F50 C3                  <1> 		ret
  1378                              <1> 
  1379                              <1> convert:
  1380 00000F51 4E                  <1> 	dec esi
  1381 00000F52 89F3                <1> 	mov ebx, esi		;place to convert into must be in si, number to convert must be in cx
  1382                              <1> cnvrt:
  1383 00000F54 89DE                <1> 	mov esi, ebx
  1384 00000F56 81EE09000000        <1> 	sub esi, 9
  1385 00000F5C 81F900CA9A3B        <1> 	cmp ecx, 1000000000
  1386 00000F62 720A                <1> 	jb ten8
  1387 00000F64 81E900CA9A3B        <1> 	sub ecx, 1000000000
  1388 00000F6A FE06                <1> 	inc byte [esi]
  1389 00000F6C EBE6                <1> 	jmp cnvrt
  1390 00000F6E 46                  <1> ten8:	inc esi
  1391 00000F6F 81F900E1F505        <1> 	cmp ecx, 100000000
  1392 00000F75 720A                <1> 	jb ten7
  1393 00000F77 81E900E1F505        <1> 	sub ecx, 100000000
  1394 00000F7D FE06                <1> 	inc byte [esi]
  1395 00000F7F EBD3                <1> 	jmp cnvrt
  1396 00000F81 46                  <1> ten7:	inc esi
  1397 00000F82 81F980969800        <1> 	cmp ecx, 10000000
  1398 00000F88 720A                <1> 	jb ten6
  1399 00000F8A 81E980969800        <1> 	sub ecx, 10000000
  1400 00000F90 FE06                <1> 	inc byte [esi]
  1401 00000F92 EBC0                <1> 	jmp cnvrt
  1402 00000F94 46                  <1> ten6:	inc esi
  1403 00000F95 81F940420F00        <1> 	cmp ecx, 1000000
  1404 00000F9B 720A                <1> 	jb ten5
  1405 00000F9D 81E940420F00        <1> 	sub ecx, 1000000
  1406 00000FA3 FE06                <1> 	inc byte [esi]
  1407 00000FA5 EBAD                <1> 	jmp cnvrt
  1408 00000FA7 46                  <1> ten5:	inc esi
  1409 00000FA8 81F9A0860100        <1> 	cmp ecx, 100000
  1410 00000FAE 720A                <1> 	jb ten4
  1411 00000FB0 81E9A0860100        <1> 	sub ecx, 100000
  1412 00000FB6 FE06                <1> 	inc byte [esi]
  1413 00000FB8 EB9A                <1> 	jmp cnvrt
  1414 00000FBA 46                  <1> ten4:	inc esi
  1415 00000FBB 81F910270000        <1> 	cmp ecx, 10000
  1416 00000FC1 720A                <1> 	jb ten3
  1417 00000FC3 81E910270000        <1> 	sub ecx, 10000
  1418 00000FC9 FE06                <1> 	inc byte [esi]
  1419 00000FCB EB87                <1> 	jmp cnvrt
  1420 00000FCD 46                  <1> ten3:	inc esi
  1421 00000FCE 81F9E8030000        <1> 	cmp ecx, 1000
  1422 00000FD4 720D                <1> 	jb ten2
  1423 00000FD6 81E9E8030000        <1> 	sub ecx, 1000
  1424 00000FDC FE06                <1> 	inc byte [esi]
  1425 00000FDE E971FFFFFF          <1> 	jmp cnvrt
  1426 00000FE3 46                  <1> ten2:	inc esi
  1427 00000FE4 81F964000000        <1> 	cmp ecx, 100
  1428 00000FEA 720D                <1> 	jb ten1
  1429 00000FEC 81E964000000        <1> 	sub ecx, 100
  1430 00000FF2 FE06                <1> 	inc byte [esi]
  1431 00000FF4 E95BFFFFFF          <1> 	jmp cnvrt
  1432 00000FF9 46                  <1> ten1:	inc esi
  1433 00000FFA 81F90A000000        <1> 	cmp ecx, 10
  1434 00001000 720D                <1> 	jb ten0
  1435 00001002 81E90A000000        <1> 	sub ecx, 10
  1436 00001008 FE06                <1> 	inc byte [esi]
  1437 0000100A E945FFFFFF          <1> 	jmp cnvrt
  1438 0000100F 46                  <1> ten0:	inc esi
  1439 00001010 81F901000000        <1> 	cmp ecx, 1
  1440 00001016 720D                <1> 	jb tendn
  1441 00001018 81E901000000        <1> 	sub ecx, 1
  1442 0000101E FE06                <1> 	inc byte [esi]
  1443 00001020 E92FFFFFFF          <1> 	jmp cnvrt
  1444                              <1> tendn:
  1445 00001025 C3                  <1> 	ret
  1446                              <1> 
  1447                              <1> 	
  1448                              <1> 
  1449 00001026 00<rept>            <1> hexnumber times 8 db 0
  1450 0000102E 202000              <1> hexnumberend db "  ",0
  1451                              <1> 
  1452                              <1> 
  1453 00001031 00000000            <1> sibuf dw 0,0
  1454 00001035 00000000            <1> dibuf dw 0,0
  1455                              <1> 
  1456                              <1> converthex:
  1457                              <1> clearbufferhex:
  1458 00001039 B030                <1> 	mov al, '0'
  1459 0000103B 8935[31100000]      <1> 	mov [sibuf], esi
  1460 00001041 893D[35100000]      <1> 	mov [dibuf], edi
  1461 00001047 39FE                <1> clearbufhex: cmp esi, edi
  1462 00001049 7305                <1> 	jae doneclearbuffhex
  1463 0000104B 8806                <1> 	mov [esi], al
  1464 0000104D 46                  <1> 	inc esi
  1465 0000104E EBF7                <1> 	jmp clearbufhex
  1466                              <1> doneclearbuffhex:
  1467 00001050 8B35[35100000]      <1> 	mov esi, [dibuf]
  1468 00001056 89CA                <1> 	mov edx, ecx
  1469 00001058 81FA00000000        <1> 	cmp edx, 0
  1470 0000105E 741F                <1> 	je donenxtephx
  1471                              <1> nxtexphx:	;0x10^x
  1472 00001060 4E                  <1> 	dec esi
  1473 00001061 89F7                <1> 	mov edi, esi		;;location of 0x10^x
  1474 00001063 89D1                <1> 	mov ecx, edx
  1475 00001065 81E10F000000        <1> 	and ecx, 0xF		;;just this digit
  1476 0000106B E81C000000          <1> 	call cnvrtexphx		;;get this digit
  1477 00001070 89FE                <1> 	mov esi, edi
  1478 00001072 C1EA04              <1> 	shr edx, 4		;;next digit
  1479 00001075 81FA00000000        <1> 	cmp edx, 0
  1480 0000107B 7402                <1> 	je donenxtephx
  1481 0000107D EBE1                <1> 	jmp nxtexphx
  1482                              <1> donenxtephx:
  1483 0000107F 8B35[31100000]      <1> 	mov esi, [sibuf]
  1484 00001085 8B3D[35100000]      <1> 	mov edi, [dibuf]
  1485 0000108B C3                  <1> 	ret
  1486                              <1> cnvrtexphx:			;;convert this number
  1487 0000108C 89F3                <1> 	mov ebx, esi		;place to convert to must be in si, number to convert must be in cx
  1488 0000108E 81F900000000        <1> 	cmp ecx, 0
  1489 00001094 7429                <1> 	je zerohx
  1490 00001096 8A06                <1> cnvrthx:  mov al, [esi]
  1491 00001098 3C39                <1> 	cmp al, '9'
  1492 0000109A 741B                <1> 	je lettershx
  1493 0000109C 3C46                <1> lttrhxdn: cmp al, 'F'
  1494 0000109E 741F                <1> 	je zerohx
  1495 000010A0 8A06                <1> 	mov al, [esi]
  1496 000010A2 FEC0                <1> 	inc al
  1497 000010A4 8806                <1> 	mov [esi], al
  1498 000010A6 89DE                <1> 	mov esi, ebx
  1499 000010A8 81E901000000        <1> cnvrtlphx: sub ecx, 1
  1500 000010AE 81F900000000        <1> 	cmp ecx, 0
  1501 000010B4 75E0                <1> 	jne cnvrthx
  1502 000010B6 C3                  <1> 	ret
  1503                              <1> lettershx:
  1504 000010B7 B041                <1> 	mov al, 'A'
  1505 000010B9 2C01                <1> 	sub al, 1
  1506 000010BB 8806                <1> 	mov [esi], al
  1507 000010BD EBDD                <1> 	jmp lttrhxdn
  1508 000010BF B030                <1> zerohx:	mov al, '0'
  1509 000010C1 8806                <1> 	mov [esi], al
  1510 000010C3 4E                  <1> 	dec esi
  1511 000010C4 8A06                <1> 	mov al, [esi]
  1512 000010C6 3C46                <1> 	cmp al, 'F'
  1513 000010C8 74F5                <1> 	je zerohx
  1514 000010CA 41                  <1> 	inc ecx
  1515 000010CB EBDB                <1> 	jmp cnvrtlphx
  1516                              <1> 
  1517 000010CD 01                  <1> firsthexshown db 1
  1518                              <1> showhex:
  1519 000010CE 60                  <1> 	pusha
  1520 000010CF BE[26100000]        <1> 	mov esi, hexnumber
  1521 000010D4 BF[2E100000]        <1> 	mov edi, hexnumberend
  1522 000010D9 E85BFFFFFF          <1> 	call converthex
  1523 000010DE 803D[CD100000]01    <1> 	cmp byte [firsthexshown], 1
  1524 000010E5 7504                <1> 	jne showthathex
  1525 000010E7 66BA0000            <1> 	mov dx, 0
  1526                              <1> showthathex:
  1527 000010EB 803D[CD100000]03    <1> 	cmp byte [firsthexshown], 3
  1528 000010F2 750A                <1> 	jne nonewhexline
  1529 000010F4 BE[88400000]        <1> 	mov esi, line
  1530 000010F9 E8B9F9FFFF          <1> 	call print
  1531                              <1> nonewhexline:
  1532 000010FE 803D[CD100000]04    <1> 	cmp byte [firsthexshown], 4
  1533 00001105 7527                <1> 	jne notabfixhex
  1534 00001107 B1A0                <1> 	mov cl, 160
  1535 00001109 28D1                <1> 	sub cl, dl
  1536 0000110B C0E905              <1> 	shr cl, 5
  1537 0000110E C0E105              <1> 	shl cl, 5
  1538 00001111 80F900              <1> 	cmp cl, 0
  1539 00001114 750F                <1> 	jne nonewlinetabfixhex
  1540 00001116 BE[88400000]        <1> 	mov esi, line
  1541 0000111B E897F9FFFF          <1> 	call print
  1542 00001120 E909000000          <1> 	jmp notabfixhex
  1543                              <1> nonewlinetabfixhex:
  1544 00001125 80C20F              <1> 	add dl, 15
  1545 00001128 C0EA04              <1> 	shr dl, 4
  1546 0000112B C0E204              <1> 	shl dl, 4
  1547                              <1> notabfixhex:
  1548 0000112E BE[26100000]        <1> 	mov esi, hexnumber
  1549 00001133 E87FF9FFFF          <1> 	call print
  1550 00001138 803D[CD100000]02    <1> 	cmp byte [firsthexshown], 2
  1551 0000113F 750A                <1> 	jne hexshown
  1552 00001141 BE[88400000]        <1> 	mov esi, line
  1553 00001146 E86CF9FFFF          <1> 	call print
  1554                              <1> hexshown:
  1555 0000114B C605[CD100000]00    <1> 	mov byte [firsthexshown], 0
  1556 00001152 61                  <1> 	popa
  1557 00001153 C3                  <1> 	ret
  1558                              <1> 
  1559                              <1> 
  1560 00001154 303030303030303030- <1> decnumber db "00000000000000"
  1561 0000115D 3030303030          <1>
  1562 00001162 2000                <1> decnumberend: db " ",0
  1563                              <1> 
  1564                              <1> showdec: ;;same as showhex, just uses decimal conversion
  1565 00001164 60                  <1> 	pusha
  1566 00001165 BF[54110000]        <1> 	mov edi, decnumber
  1567 0000116A BE[62110000]        <1> 	mov esi, decnumberend
  1568                              <1> cleardecbuf:
  1569 0000116F C60730              <1> 	mov byte [edi], '0'
  1570 00001172 47                  <1> 	inc edi
  1571 00001173 39F7                <1> 	cmp edi, esi
  1572 00001175 72F8                <1> 	jb cleardecbuf
  1573 00001177 BF[54110000]        <1> 	mov edi, decnumber
  1574 0000117C E8D0FDFFFF          <1> 	call convert
  1575 00001181 803D[CD100000]01    <1> 	cmp byte [firsthexshown], 1
  1576 00001188 7504                <1> 	jne showthatdec
  1577 0000118A 66BA0000            <1> 	mov dx, 0
  1578                              <1> showthatdec:
  1579 0000118E 803D[CD100000]03    <1> 	cmp byte [firsthexshown], 3
  1580 00001195 750A                <1> 	jne nonewdecline
  1581 00001197 BE[88400000]        <1> 	mov esi, line
  1582 0000119C E816F9FFFF          <1> 	call print
  1583                              <1> nonewdecline:
  1584 000011A1 803D[CD100000]04    <1> 	cmp byte [firsthexshown], 4
  1585 000011A8 7527                <1> 	jne notabfixdec
  1586 000011AA B1A0                <1> 	mov cl, 160
  1587 000011AC 28D1                <1> 	sub cl, dl
  1588 000011AE C0E905              <1> 	shr cl, 5
  1589 000011B1 C0E105              <1> 	shl cl, 5
  1590 000011B4 80F900              <1> 	cmp cl, 0
  1591 000011B7 750F                <1> 	jne nonewlinetabfixdec
  1592 000011B9 BE[88400000]        <1> 	mov esi, line
  1593 000011BE E8F4F8FFFF          <1> 	call print
  1594 000011C3 E909000000          <1> 	jmp notabfixdec
  1595                              <1> nonewlinetabfixdec:
  1596 000011C8 80C20F              <1> 	add dl, 15
  1597 000011CB C0EA04              <1> 	shr dl, 4
  1598 000011CE C0E204              <1> 	shl dl, 4
  1599                              <1> notabfixdec:
  1600 000011D1 BE[54110000]        <1> 	mov esi, decnumber
  1601 000011D6 4E                  <1> 	dec esi
  1602                              <1> sifind:
  1603 000011D7 46                  <1> 	inc esi
  1604 000011D8 803E30              <1> 	cmp byte [esi], '0'
  1605 000011DB 74FA                <1> 	je sifind
  1606 000011DD E8D5F8FFFF          <1> 	call print
  1607 000011E2 803D[CD100000]02    <1> 	cmp byte [firsthexshown], 2
  1608 000011E9 750A                <1> 	jne decshown
  1609 000011EB BE[88400000]        <1> 	mov esi, line
  1610 000011F0 E8C2F8FFFF          <1> 	call print
  1611                              <1> decshown:
  1612 000011F5 C605[CD100000]00    <1> 	mov byte [firsthexshown], 0
  1613 000011FC 61                  <1> 	popa
  1614 000011FD C3                  <1> 	ret
  1615                              <1> 	
  1616                              <1> cnvrttxt: 
  1617 000011FE B900000000          <1> 	mov ecx, 0
  1618 00001203 B800000000          <1> 	mov eax, 0
  1619 00001208 BA00000000          <1> 	mov edx, 0
  1620 0000120D BB00000000          <1> 	mov ebx, 0
  1621 00001212 4E                  <1> 	dec esi
  1622                              <1> cnvrtlptxt:
  1623 00001213 46                  <1> 	inc esi
  1624 00001214 8A06                <1> 	mov al, [esi]
  1625 00001216 3C00                <1> 	cmp al, 0
  1626 00001218 75F9                <1> 	jne cnvrtlptxt
  1627 0000121A 4E                  <1> 	dec esi
  1628 0000121B 8A06                <1> 	mov al, [esi]
  1629 0000121D 3C30                <1> 	cmp al, '0'
  1630 0000121F 7504                <1> 	jne txtlp
  1631 00001221 39FE                <1> zerotest: cmp esi, edi
  1632 00001223 745B                <1> 	je donecnvrt
  1633                              <1> txtlp:	
  1634 00001225 B800000000          <1> 	mov eax, 0
  1635 0000122A 8A06                <1> 	mov al, [esi]
  1636 0000122C 3C3D                <1> 	cmp al, '='
  1637 0000122E 7450                <1> 	je donecnvrt
  1638 00001230 3C30                <1> 	cmp al, 48
  1639 00001232 724C                <1> 	jb donecnvrt
  1640 00001234 3C23                <1> 	cmp al, '#'
  1641 00001236 7448                <1> 	je donecnvrt
  1642 00001238 39FE                <1> 	cmp esi, edi
  1643 0000123A 7244                <1> 	jb donecnvrt
  1644 0000123C 81F900000000        <1> 	cmp ecx, 0
  1645 00001242 7708                <1> 	ja exp
  1646 00001244 2C30                <1> noexp:	sub al, 48
  1647 00001246 01C2                <1> 	add edx, eax
  1648 00001248 4E                  <1> 	dec esi
  1649 00001249 41                  <1> 	inc ecx
  1650 0000124A EBD9                <1> 	jmp txtlp
  1651 0000124C 81F900000000        <1> exp:	cmp ecx, 0
  1652 00001252 74F0                <1> 	je noexp
  1653 00001254 2C30                <1> 	sub al, 48
  1654 00001256 51                  <1> 	push ecx
  1655 00001257 89C3                <1> expmul:	mov ebx, eax
  1656 00001259 01D8                <1> 	add eax, ebx
  1657 0000125B 01D8                <1> 	add eax, ebx
  1658 0000125D 01D8                <1> 	add eax, ebx
  1659 0000125F 01D8                <1> 	add eax, ebx
  1660 00001261 01D8                <1> 	add eax, ebx
  1661 00001263 01D8                <1> 	add eax, ebx
  1662 00001265 01D8                <1> 	add eax, ebx
  1663 00001267 01D8                <1> 	add eax, ebx
  1664 00001269 01D8                <1> 	add eax, ebx
  1665 0000126B 81E901000000        <1> 	sub ecx, 1
  1666 00001271 81F900000000        <1> 	cmp ecx, 0
  1667 00001277 77DE                <1> 	ja expmul
  1668 00001279 01C2                <1> 	add edx, eax
  1669 0000127B 59                  <1> 	pop ecx
  1670 0000127C 4E                  <1> 	dec esi
  1671 0000127D 41                  <1> 	inc ecx
  1672 0000127E EBA5                <1> 	jmp txtlp
  1673 00001280 89D1                <1> donecnvrt: mov ecx, edx
  1674 00001282 C3                  <1> 	ret
  1675                                      %include 'source/builtinprogs.asm'
  1676 00001283 050406040704        <1> filetypes db 5,4,6,4,7,4
  1677                              <1> progstart:		;programs start here
  1678 00001289 0504696E64657800    <1> db 5,4,"index",0
  1679 00001291 E805000000          <1> 	call indexfiles
  1680 00001296 E979FAFFFF          <1> 	jmp nwcmd
  1681                              <1> indexfiles:
  1682 0000129B BE[89120000]        <1> 	mov esi, progstart
  1683 000012A0 BB[6F030000]        <1> 	mov ebx, fileindex
  1684 000012A5 BF[89120000]        <1> 	mov edi, progstart
  1685 000012AA 81EF02000000        <1> 	sub edi, 2
  1686                              <1> indexloop:
  1687 000012B0 668B0E              <1> 	mov cx, [esi]
  1688                              <1> 	indexloop2:
  1689 000012B3 663B0F              <1> 		cmp cx, [edi]
  1690 000012B6 7424                <1> 		je indexloop2done
  1691 000012B8 81EF02000000        <1> 		sub edi, 2
  1692 000012BE 81FF[83120000]      <1> 		cmp edi, filetypes
  1693 000012C4 73ED                <1> 		jae indexloop2
  1694 000012C6 BF[89120000]        <1> 	mov edi, progstart
  1695 000012CB 81EF02000000        <1> 	sub edi, 2
  1696 000012D1 46                  <1> 	inc esi
  1697 000012D2 81FE[CC210000]      <1> 	cmp esi, batchprogend
  1698 000012D8 734E                <1> 	jae indexloopdone
  1699 000012DA EBD4                <1> 	jmp indexloop
  1700                              <1> indexloop2done:
  1701 000012DC 66890B              <1> 	mov [ebx], cx
  1702 000012DF 81C302000000        <1> 	add ebx, 2
  1703 000012E5 81C602000000        <1> 	add esi, 2
  1704                              <1> 	nameindex:
  1705 000012EB 8A0E                <1> 		mov cl, [esi]
  1706 000012ED 80F900              <1> 		cmp cl, 0
  1707 000012F0 7406                <1> 		je nameindexdone
  1708 000012F2 880B                <1> 		mov [ebx], cl
  1709 000012F4 46                  <1> 		inc esi
  1710 000012F5 43                  <1> 		inc ebx
  1711 000012F6 EBF3                <1> 		jmp nameindex
  1712                              <1> 	nameindexdone:
  1713 000012F8 43                  <1> 		inc ebx
  1714 000012F9 66C7030000          <1> 		mov word [ebx], 0
  1715 000012FE 81C302000000        <1> 		add ebx, 2
  1716 00001304 46                  <1> 		inc esi
  1717 00001305 8933                <1> 		mov [ebx], esi
  1718 00001307 81C304000000        <1> 		add ebx, 4
  1719 0000130D 66C7030000          <1> 		mov word [ebx], 0
  1720 00001312 81C302000000        <1> 		add ebx, 2
  1721 00001318 81FB[6F050000]      <1> 		cmp ebx, fileindexend
  1722 0000131E 7308                <1> 		jae indexloopdone
  1723 00001320 81C601000000        <1> 		add esi, 1
  1724 00001326 EB88                <1> 		jmp indexloop
  1725 00001328 C3                  <1> indexloopdone: 	ret
  1726                              <1> 
  1727                              <1> 
  1728 00001329 050473686F77696E64- <1> db 5,4,"showindex",0
  1729 00001332 657800              <1>
  1730 00001335 BE[6F030000]        <1> 	mov esi, fileindex
  1731 0000133A BB[6F050000]        <1> 	mov ebx, fileindexend
  1732 0000133F B105                <1> 	mov cl, 5
  1733 00001341 B504                <1> 	mov ch, 4
  1734 00001343 E893FBFFFF          <1> 	call array
  1735 00001348 BE[6F030000]        <1> 	mov esi, fileindex
  1736 0000134D BB[6F050000]        <1> 	mov ebx, fileindexend
  1737 00001352 B106                <1> 	mov cl, 6
  1738 00001354 B504                <1> 	mov ch, 4
  1739 00001356 E880FBFFFF          <1> 	call array
  1740 0000135B BE[6F030000]        <1> 	mov esi, fileindex
  1741 00001360 BB[6F050000]        <1> 	mov ebx, fileindexend
  1742 00001365 B107                <1> 	mov cl, 7
  1743 00001367 B504                <1> 	mov ch, 4
  1744 00001369 E86DFBFFFF          <1> 	call array
  1745 0000136E E9A1F9FFFF          <1> 	jmp nwcmd
  1746                              <1> 
  1747 00001373 05046C7300          <1> db 5,4,"ls",0
  1748 00001378 BE[89120000]        <1> 	lscmd:	mov esi, progstart
  1749 0000137D BB[CC210000]        <1> 		mov ebx, progend
  1750 00001382 E9B2FAFFFF          <1> 		jmp dir
  1751                              <1> 		
  1752 00001387 05046469736B00      <1> db 5,4,"disk",0
  1753 0000138E B900000000          <1> 		mov ecx, 0
  1754 00001393 8A0D[42000000]      <1> 		mov cl, [DriveNumber]
  1755 00001399 C605[CD100000]00    <1> 		mov byte [firsthexshown], 0
  1756 000013A0 E829FDFFFF          <1> 		call showhex
  1757 000013A5 BE[88400000]        <1> 		mov esi, line
  1758 000013AA E808F7FFFF          <1> 		call print
  1759 000013AF BE[E03F0000]        <1> 		mov esi, diskfileindex
  1760                              <1> 	diskindexdir:
  1761 000013B4 E8FEF6FFFF          <1> 		call print
  1762 000013B9 8B4E05              <1> 		mov ecx, [esi + 5]
  1763 000013BC C605[CD100000]03    <1> 		mov byte [firsthexshown], 3
  1764 000013C3 E89CFDFFFF          <1> 		call showdec
  1765 000013C8 56                  <1> 		push esi
  1766 000013C9 BE[88400000]        <1> 		mov esi, line
  1767 000013CE E8E4F6FFFF          <1> 		call print
  1768 000013D3 5E                  <1> 		pop esi
  1769 000013D4 81C609000000        <1> 		add esi, 9
  1770 000013DA 81FE[39400000]      <1> 		cmp esi, enddiskfileindex
  1771 000013E0 72D2                <1> 		jb diskindexdir
  1772 000013E2 E92DF9FFFF          <1> 		jmp nwcmd
  1773                              <1> 
  1774 000013E7 0504636C65617200    <1> db 5,4,"clear",0
  1775 000013EF E86FF7FFFF          <1> 	cls:	call clear
  1776 000013F4 E91BF9FFFF          <1> 		jmp nwcmd
  1777                              <1> 		
  1778 000013F9 05047761697400      <1> db 5,4,"wait",0
  1779 00001400 B000                <1> 		mov al, 0
  1780 00001402 E880F6FFFF          <1> 		call int302
  1781 00001407 E908F9FFFF          <1> 		jmp nwcmd
  1782                              <1> 
  1783 0000140C 05046563686F00      <1> db 5,4,"echo",0
  1784 00001413 BE[700A0000]        <1> 	echo:	mov esi, buftxt
  1785 00001418 81C605000000        <1> 		add esi, 5
  1786 0000141E 8A06                <1> 		mov al, [esi]
  1787 00001420 3C24                <1> 		cmp al, '$'
  1788 00001422 7414                <1> 		je echovr
  1789 00001424 E88EF6FFFF          <1> 		call print
  1790 00001429 BE[88400000]        <1> 		mov esi, line
  1791 0000142E E884F6FFFF          <1> 		call print
  1792 00001433 E9DCF8FFFF          <1> 		jmp nwcmd
  1793 00001438 BB[6F050000]        <1> 	echovr:	mov ebx, variables
  1794 0000143D BF06000000          <1> 		mov edi, 6
  1795 00001442 E83A000000          <1> 		call nxtvrech
  1796 00001447 E957000000          <1> 		jmp prntvr2
  1797 0000144C B13D                <1> 	echvar:	mov cl, '='
  1798 0000144E 43                  <1> 		inc ebx
  1799 0000144F 8A03                <1> 		mov al, [ebx]
  1800 00001451 3C00                <1> 		cmp al, 0
  1801 00001453 742C                <1> 		je nxtvrech
  1802 00001455 3C3D                <1> 		cmp al, '='
  1803 00001457 7420                <1> 		je nxtvrechb1
  1804 00001459 BE[700A0000]        <1> 		mov esi, buftxt
  1805 0000145E 01FE                <1> 		add esi, edi
  1806 00001460 E8B4F9FFFF          <1> 		call cndtest
  1807 00001465 3C02                <1> 		cmp al, 2
  1808 00001467 7436                <1> 		je prntvr
  1809 00001469 3C01                <1> 		cmp al, 1
  1810 0000146B 7432                <1> 		je prntvr
  1811 0000146D BE[700A0000]        <1> 		mov esi, buftxt
  1812 00001472 01FE                <1> 		add esi, edi
  1813 00001474 E908000000          <1> 		jmp nxtvrech
  1814                              <1> 	nxtvrechb1:
  1815 00001479 81EB02000000        <1> 		sub ebx, 2
  1816 0000147F EBCB                <1> 		jmp echvar
  1817 00001481 8A03                <1> 	nxtvrech: mov al, [ebx]
  1818 00001483 3C05                <1> 		cmp al, 5
  1819 00001485 740F                <1> 		je nxtvrec2
  1820 00001487 43                  <1> 		inc ebx
  1821 00001488 81FB[6F0A0000]      <1> 		cmp ebx, varend
  1822 0000148E 0F8380F8FFFF        <1> 		jae nwcmd
  1823 00001494 EBEB                <1> 		jmp nxtvrech
  1824 00001496 43                  <1> 	nxtvrec2: inc ebx
  1825 00001497 8A03                <1> 		mov al, [ebx]
  1826 00001499 3C04                <1> 		cmp al, 4
  1827 0000149B 74AF                <1> 		je echvar
  1828 0000149D EBE2                <1> 		jmp nxtvrech
  1829 0000149F 43                  <1> 	prntvr: inc ebx
  1830 000014A0 89DE                <1> 		mov esi, ebx
  1831 000014A2 C3                  <1> 		ret
  1832 000014A3 E80FF6FFFF          <1> 	prntvr2: call print
  1833 000014A8 BE[88400000]        <1> 		mov esi, line
  1834 000014AD E805F6FFFF          <1> 		call print
  1835 000014B2 E95DF8FFFF          <1> 		jmp nwcmd
  1836                              <1> 		
  1837                              <1> 
  1838 000014B7 05042300            <1> db 5,4,"#",0
  1839                              <1> 	num:	
  1840 000014BB E87CFAFFFF          <1> 		call clearbuffer
  1841 000014C0 C605[77170000]00    <1> 		mov byte [decimal], 0
  1842 000014C7 C605[78170000]00    <1> 		mov byte [decimal2], 0
  1843 000014CE BE[700A0000]        <1> 		mov esi, buftxt
  1844 000014D3 B800000000          <1> 		mov eax, 0
  1845 000014D8 B900000000          <1> 		mov ecx, 0
  1846 000014DD BB00000000          <1> 		mov ebx, 0
  1847 000014E2 8A06                <1> 	num2:	mov al, [esi]
  1848 000014E4 3C2B                <1> 		cmp al, '+'
  1849 000014E6 741B                <1> 		je operatorfound
  1850 000014E8 3C2D                <1> 		cmp al, '-'
  1851 000014EA 7417                <1> 		je operatorfound
  1852 000014EC 3C2A                <1> 		cmp al, '*'
  1853 000014EE 7413                <1> 		je operatorfound
  1854 000014F0 3C2F                <1> 		cmp al, '/'
  1855 000014F2 740F                <1> 		je operatorfound
  1856 000014F4 3C5E                <1> 		cmp al, '^'
  1857 000014F6 740B                <1> 		je operatorfound
  1858 000014F8 46                  <1> 		inc esi
  1859 000014F9 3C00                <1> 		cmp al, 0
  1860 000014FB 0F8413F8FFFF        <1> 		je near nwcmd
  1861 00001501 EBDF                <1> 		jmp num2
  1862 00001503 50                  <1> 	operatorfound: push eax
  1863 00001504 B400                <1> 		mov ah, 0
  1864 00001506 8826                <1> 		mov [esi], ah
  1865 00001508 89F7                <1> 		mov edi, esi
  1866 0000150A 46                  <1> 		inc esi
  1867 0000150B 8A06                <1> 		mov al, [esi]
  1868 0000150D 3C24                <1> 		cmp al, '$'
  1869 0000150F 0F8481000000        <1> 		je near varnum1
  1870 00001515 3C25                <1> 		cmp al, '%'
  1871 00001517 0F8469000000        <1> 		je near resultnum1
  1872                              <1> 	varnum2: 
  1873 0000151D 57                  <1> 		push edi
  1874 0000151E E8C9000000          <1> 		call checkdecimal
  1875 00001523 5F                  <1> 		pop edi
  1876 00001524 E8D5FCFFFF          <1> 		call cnvrttxt
  1877                              <1> 	vrnm2:
  1878 00001529 89CB                <1> 		mov ebx, ecx
  1879 0000152B 53                  <1> 		push ebx
  1880 0000152C E80BFAFFFF          <1> 		call clearbuffer
  1881 00001531 BE[700A0000]        <1> 		mov esi, buftxt
  1882 00001536 89F7                <1> 		mov edi, esi
  1883 00001538 46                  <1> 		inc esi
  1884 00001539 8A06                <1> 		mov al, [esi]
  1885 0000153B 3C24                <1> 		cmp al, '$'
  1886 0000153D 0F8474000000        <1> 		je near varnum3
  1887 00001543 3C25                <1> 		cmp al, '%'
  1888 00001545 0F8443000000        <1> 		je near resultnum2
  1889                              <1> 	varnum4: 
  1890 0000154B 57                  <1> 		push edi
  1891 0000154C E887000000          <1> 		call checkdecimal2
  1892 00001551 5F                  <1> 		pop edi
  1893 00001552 E8A7FCFFFF          <1> 		call cnvrttxt
  1894                              <1> 	vrnm4:
  1895 00001557 5B                  <1> 		pop ebx
  1896 00001558 58                  <1> 		pop eax
  1897 00001559 3C2B                <1> 		cmp al, '+'
  1898 0000155B 0F84B9000000        <1> 		je near plusnum
  1899 00001561 3C2D                <1> 		cmp al, '-'
  1900 00001563 0F84BD000000        <1> 		je near subnum
  1901 00001569 3C2A                <1> 		cmp al, '*'
  1902 0000156B 0F84C1000000        <1> 		je near mulnum
  1903 00001571 3C2F                <1> 		cmp al, '/'
  1904 00001573 0F84CF000000        <1> 		je near divnum
  1905 00001579 3C5E                <1> 		cmp al, '^'
  1906 0000157B 0F84ED000000        <1> 		je near expnum
  1907 00001581 E98EF7FFFF          <1> 		jmp nwcmd
  1908                              <1> 	resultnum1:
  1909 00001586 8B0D[79170000]      <1> 		mov ecx, [result]
  1910 0000158C EB9B                <1> 		jmp vrnm2
  1911                              <1> 	resultnum2:
  1912 0000158E 8B0D[79170000]      <1> 		mov ecx, [result]
  1913 00001594 EBC1                <1> 		jmp vrnm4
  1914 00001596 81EE[700A0000]      <1> 	varnum1: sub esi, buftxt
  1915 0000159C 89F7                <1> 		mov edi, esi
  1916 0000159E 81C6[700A0000]      <1> 		add esi, buftxt
  1917 000015A4 47                  <1> 		inc edi
  1918 000015A5 BB[6F050000]        <1> 		mov ebx, variables
  1919 000015AA E8D2FEFFFF          <1> 		call nxtvrech
  1920 000015AF 89F7                <1> 		mov edi, esi
  1921 000015B1 4F                  <1> 		dec edi
  1922 000015B2 E966FFFFFF          <1> 		jmp varnum2
  1923 000015B7 81EE[700A0000]      <1> 	varnum3: sub esi, buftxt
  1924 000015BD 89F7                <1> 		mov edi, esi
  1925 000015BF 81C6[700A0000]      <1> 		add esi, buftxt
  1926 000015C5 47                  <1> 		inc edi
  1927 000015C6 BB[6F050000]        <1> 		mov ebx, variables
  1928 000015CB E8B1FEFFFF          <1> 		call nxtvrech
  1929 000015D0 89F7                <1> 		mov edi, esi
  1930 000015D2 4F                  <1> 		dec edi
  1931 000015D3 E973FFFFFF          <1> 		jmp varnum4
  1932                              <1> 	checkdecimal2:
  1933 000015D8 8A25[77170000]      <1> 		mov ah, [decimal]
  1934 000015DE 8825[78170000]      <1> 		mov [decimal2], ah
  1935 000015E4 B400                <1> 		mov ah, 0
  1936 000015E6 8825[77170000]      <1> 		mov [decimal], ah
  1937                              <1> 	checkdecimal:
  1938 000015EC 89F7                <1> 		mov edi, esi
  1939                              <1> 	chkdec1:
  1940 000015EE 8A07                <1> 		mov al, [edi]
  1941 000015F0 3C2E                <1> 		cmp al, '.'
  1942 000015F2 0F840B000000        <1> 		je near fnddec
  1943 000015F8 3C00                <1> 		cmp al, 0
  1944 000015FA 0F8419000000        <1> 		je near nodecimal
  1945 00001600 47                  <1> 		inc edi
  1946 00001601 EBEB                <1> 		jmp chkdec1
  1947                              <1> 	fnddec:
  1948 00001603 8A4701              <1> 		mov al, [edi + 1]
  1949 00001606 8807                <1> 		mov [edi], al
  1950 00001608 3C00                <1> 		cmp al, 0
  1951 0000160A 0F8409000000        <1> 		je near nodecimal
  1952 00001610 FE05[77170000]      <1> 		inc byte [decimal]
  1953 00001616 47                  <1> 		inc edi
  1954 00001617 EBEA                <1> 		jmp fnddec
  1955                              <1> 	nodecimal:
  1956 00001619 C3                  <1> 		ret
  1957                              <1> 	plusnum:
  1958 0000161A E816010000          <1> 		call decaddfix
  1959 0000161F 01D9                <1> 		add ecx, ebx
  1960 00001621 E991000000          <1> 		jmp retnum
  1961                              <1> 	subnum:
  1962 00001626 E80A010000          <1> 		call decaddfix
  1963 0000162B 29D9                <1> 		sub ecx, ebx
  1964 0000162D E985000000          <1> 		jmp retnum
  1965                              <1> 	mulnum:
  1966 00001632 A0[78170000]        <1> 		mov al, [decimal2]
  1967 00001637 0005[77170000]      <1> 		add [decimal], al
  1968 0000163D 89C8                <1> 		mov eax, ecx
  1969 0000163F F7E3                <1> 		mul ebx
  1970 00001641 89C1                <1> 		mov ecx, eax
  1971 00001643 E96F000000          <1> 		jmp retnum
  1972                              <1> 	divnum:
  1973 00001648 E8E8000000          <1> 		call decaddfix
  1974 0000164D B000                <1> 		mov al, 0
  1975 0000164F A2[77170000]        <1> 		mov [decimal], al
  1976 00001654 6689C8              <1> 		mov ax, cx
  1977 00001657 80FB00              <1> 		cmp bl, 0
  1978 0000165A 0F8457000000        <1> 		je near retnum
  1979 00001660 F6F3                <1> 		div bl
  1980 00001662 B900000000          <1> 		mov ecx, 0
  1981 00001667 88C1                <1> 		mov cl, al
  1982 00001669 E949000000          <1> 		jmp retnum
  1983                              <1> 	expnum:
  1984 0000166E 8A15[77170000]      <1> 		mov dl, [decimal]
  1985 00001674 8815[78170000]      <1> 		mov [decimal2], dl
  1986 0000167A BA00000000          <1> 		mov edx, 0
  1987 0000167F 89C8                <1> 		mov eax, ecx
  1988 00001681 89D9                <1> 		mov ecx, ebx
  1989 00001683 89C3                <1> 		mov ebx, eax
  1990 00001685 81F900000000        <1> 		cmp ecx, 0
  1991 0000168B 7425                <1> 		je noexpnum
  1992 0000168D 49                  <1> 		dec ecx
  1993 0000168E 81F900000000        <1> 		cmp ecx, 0
  1994 00001694 7415                <1> 		je noexpnumlp
  1995 00001696 F7E3                <1> 	expnumlp: mul ebx
  1996 00001698 8A15[78170000]      <1> 		mov dl, [decimal2]
  1997 0000169E 0015[77170000]      <1> 		add [decimal], dl
  1998 000016A4 BA00000000          <1> 		mov edx, 0
  1999 000016A9 E2EB                <1> 		loop expnumlp
  2000                              <1> 	noexpnumlp:
  2001 000016AB 89C1                <1> 		mov ecx, eax
  2002 000016AD E905000000          <1> 		jmp retnum
  2003                              <1> 	noexpnum:
  2004 000016B2 B901000000          <1> 		mov ecx, 1
  2005                              <1> 	retnum: 
  2006 000016B7 BE[840C0000]        <1> 		mov esi, numbuf
  2007 000016BC 890D[79170000]      <1> 		mov [result], ecx
  2008 000016C2 E88AF8FFFF          <1> 		call convert
  2009 000016C7 BE[840C0000]        <1> 		mov esi, numbuf
  2010 000016CC 8A25[77170000]      <1> 		mov ah, [decimal]
  2011 000016D2 80FC00              <1> 		cmp ah, 0
  2012 000016D5 0F8425000000        <1> 		je near noputdecimal
  2013                              <1> 	putdecimal:
  2014 000016DB 4E                  <1> 		dec esi
  2015 000016DC FECC                <1> 		dec ah
  2016 000016DE 80FC00              <1> 		cmp ah, 0
  2017 000016E1 0F87F4FFFFFF        <1> 		ja near putdecimal
  2018 000016E7 4E                  <1> 		dec esi
  2019 000016E8 8A06                <1> 		mov al, [esi]
  2020 000016EA C6062E              <1> 		mov byte [esi], '.'
  2021                              <1> 	decputloop:
  2022 000016ED 4E                  <1> 		dec esi
  2023 000016EE 8A26                <1> 		mov ah, [esi]
  2024 000016F0 8806                <1> 		mov [esi], al
  2025 000016F2 88E0                <1> 		mov al, ah
  2026 000016F4 81FE[700C0000]      <1> 		cmp esi, buf2
  2027 000016FA 0F87EDFFFFFF        <1> 		ja near decputloop
  2028                              <1> 	noputdecimal:
  2029 00001700 BE[700C0000]        <1> 		mov esi, buf2
  2030 00001705 E809000000          <1> 		call chkadd
  2031 0000170A E905F6FFFF          <1> 		jmp nwcmd
  2032 0000170F 00000000            <1> edxnumbuf dw 0,0
  2033 00001713 8A06                <1> 	chkadd: mov al, [esi]
  2034 00001715 3C30                <1> 		cmp al, '0'
  2035 00001717 750C                <1> 		jne dnadd
  2036 00001719 46                  <1> 		inc esi
  2037 0000171A 81FE[840C0000]      <1> 		cmp esi, numbuf
  2038 00001720 7402                <1> 		je dnaddm1
  2039 00001722 EBEF                <1> 		jmp chkadd
  2040 00001724 4E                  <1> 	dnaddm1: dec esi
  2041 00001725 E88DF3FFFF          <1> 	dnadd:	call print
  2042 0000172A BE[88400000]        <1> 		mov esi, line
  2043 0000172F E883F3FFFF          <1> 		call print
  2044 00001734 C3                  <1> 		ret
  2045                              <1> 		
  2046                              <1> 	decaddfix:
  2047 00001735 A0[78170000]        <1> 		mov al, [decimal2]
  2048 0000173A 8A25[77170000]      <1> 		mov ah, [decimal]
  2049 00001740 38E0                <1> 		cmp al, ah
  2050 00001742 7432                <1> 		je gooddecadd
  2051 00001744 38E0                <1> 		cmp al, ah
  2052 00001746 721A                <1> 		jb lowdecadd
  2053                              <1> 	highdecadd:
  2054 00001748 FEC4                <1> 		inc ah
  2055 0000174A 89CA                <1> 		mov edx, ecx
  2056 0000174C C1E103              <1> 		shl ecx, 3
  2057 0000174F 01D1                <1> 		add ecx, edx
  2058 00001751 01D1                <1> 		add ecx, edx
  2059 00001753 38E0                <1> 		cmp al, ah
  2060 00001755 77F1                <1> 		ja highdecadd
  2061 00001757 8825[77170000]      <1> 		mov [decimal], ah
  2062 0000175D E914000000          <1> 		jmp gooddecadd
  2063                              <1> 	lowdecadd:
  2064 00001762 FEC0                <1> 		inc al
  2065 00001764 89DA                <1> 		mov edx, ebx
  2066 00001766 C1E303              <1> 		shl ebx, 3
  2067 00001769 01D3                <1> 		add ebx, edx
  2068 0000176B 01D3                <1> 		add ebx, edx
  2069 0000176D 38E0                <1> 		cmp al, ah
  2070 0000176F 72F1                <1> 		jb lowdecadd
  2071 00001771 A2[77170000]        <1> 		mov [decimal], al
  2072                              <1> 	gooddecadd:
  2073 00001776 C3                  <1> 		ret
  2074                              <1> 		
  2075 00001777 00                  <1> decimal db 0
  2076 00001778 00                  <1> decimal2 db 0
  2077 00001779 00000000            <1> result db 0,0,0,0
  2078                              <1> 	
  2079 0000177D 05042500            <1> db 5,4,"%",0
  2080 00001781 E8B6F7FFFF          <1> 	ans:	call clearbuffer
  2081 00001786 8B0D[79170000]      <1> 		mov ecx, [result]
  2082 0000178C BE[700C0000]        <1> 		mov esi, buf2
  2083 00001791 E8BBF7FFFF          <1> 		call convert
  2084 00001796 BE[700C0000]        <1> 		mov esi, buf2
  2085 0000179B E873FFFFFF          <1> 		call chkadd
  2086 000017A0 E96FF5FFFF          <1> 		jmp nwcmd
  2087                              <1> 
  2088 000017A5 05042400            <1> db 5,4,"$",0
  2089 000017A9 BE[700A0000]        <1> var:	mov esi, buftxt
  2090 000017AE BB[6F050000]        <1> 	mov ebx, variables
  2091 000017B3 8A06                <1> lkeq:	mov al, [esi]
  2092 000017B5 3C3D                <1> 	cmp al, '='
  2093 000017B7 741F                <1> 	je eqfnd	;is there an '=' sign?
  2094 000017B9 3C00                <1> 	cmp al, 0
  2095 000017BB 7403                <1> 	je echovars
  2096 000017BD 46                  <1> 	inc esi
  2097 000017BE EBF3                <1> 	jmp lkeq
  2098 000017C0 BE[6F050000]        <1> echovars: mov esi, variables
  2099 000017C5 BB[6F0A0000]        <1> 	mov ebx, varend
  2100 000017CA B105                <1> 	mov cl, 5
  2101 000017CC B504                <1> 	mov ch, 4
  2102 000017CE E808F7FFFF          <1> 	call array
  2103 000017D3 E93CF5FFFF          <1> 	jmp nwcmd
  2104 000017D8 46                  <1> eqfnd:	inc esi
  2105 000017D9 8A06                <1> 	mov al, [esi]
  2106 000017DB 3C00                <1> 	cmp al, 0
  2107 000017DD 740F                <1> 	je readvar
  2108 000017DF BE[700A0000]        <1> 	mov esi, buftxt
  2109 000017E4 BB[6F050000]        <1> 	mov ebx, variables
  2110 000017E9 E917000000          <1> 	jmp seek
  2111                              <1> readvar: 
  2112 000017EE B00D                <1> 	mov al, 13
  2113 000017F0 B404                <1> 	mov ah, 4
  2114 000017F2 B307                <1> 	mov bl, 7
  2115 000017F4 E8DDF0FFFF          <1> 	call intx4
  2116 000017F9 BE[88400000]        <1> 	mov esi, line
  2117 000017FE E8B4F2FFFF          <1> 	call print
  2118 00001803 EBA4                <1> 	jmp var
  2119 00001805 668B03              <1> seek:	mov ax, [ebx]
  2120 00001808 B105                <1> 	mov cl, 5
  2121 0000180A B504                <1> 	mov ch, 4
  2122 0000180C 663D0000            <1> 	cmp ax, 0
  2123 00001810 0F8459000000        <1> 	je near save
  2124 00001816 6639C8              <1> 	cmp ax, cx
  2125 00001819 7403                <1> 	je skfnd
  2126 0000181B 43                  <1> 	inc ebx
  2127 0000181C EBE7                <1> 	jmp seek
  2128 0000181E BE[700A0000]        <1> skfnd:	mov esi, buftxt
  2129 00001823 46                  <1> 	inc esi
  2130 00001824 81C302000000        <1> 	add ebx, 2
  2131 0000182A 89DF                <1> 	mov edi, ebx
  2132 0000182C B13D                <1> 	mov cl, '='
  2133 0000182E E8E6F5FFFF          <1> 	call cndtest
  2134 00001833 3C01                <1> 	cmp al, 1	
  2135 00001835 7417                <1> 	je varfnd
  2136 00001837 89FB                <1> 	mov ebx, edi
  2137 00001839 BE[700A0000]        <1> 	mov esi, buftxt
  2138 0000183E 668B03              <1> 	mov ax, [ebx]
  2139 00001841 663D0000            <1> 	cmp ax, 0
  2140 00001845 0F8424000000        <1> 	je near save
  2141 0000184B 43                  <1> 	inc ebx
  2142 0000184C EBB7                <1> 	jmp seek
  2143 0000184E 8A03                <1> varfnd:	mov al, [ebx]
  2144 00001850 3C04                <1> 	cmp al, 4
  2145 00001852 7404                <1> 	je save2
  2146 00001854 4B                  <1> 	dec ebx
  2147 00001855 4E                  <1> 	dec esi
  2148 00001856 EBF6                <1> 	jmp varfnd
  2149 00001858 4B                  <1> save2:	dec ebx
  2150 00001859 4E                  <1> 	dec esi
  2151 0000185A 8A03                <1> 	mov al, [ebx]
  2152 0000185C 3C05                <1> 	cmp al, 5
  2153 0000185E 7402                <1> 	je remove
  2154 00001860 EBEC                <1> 	jmp varfnd
  2155 00001862 8A03                <1> remove: mov al, [ebx]
  2156 00001864 3C00                <1> 	cmp al, 0
  2157 00001866 749D                <1> 	je seek
  2158 00001868 B000                <1> 	mov al, 0
  2159 0000186A 8803                <1> 	mov [ebx], al
  2160 0000186C 43                  <1> 	inc ebx
  2161 0000186D EBF3                <1> 	jmp remove	;do not need for now-need defragmentation
  2162 0000186F BE[700A0000]        <1> save:	mov esi, buftxt
  2163 00001874 43                  <1> 	inc ebx
  2164 00001875 B005                <1> 	mov al, 5
  2165 00001877 B404                <1> 	mov ah, 4
  2166 00001879 668903              <1> 	mov [ebx], ax
  2167 0000187C 43                  <1> 	inc ebx
  2168 0000187D 43                  <1> svhere:	inc ebx
  2169 0000187E 46                  <1> 	inc esi
  2170 0000187F 8A06                <1> 	mov al, [esi]
  2171 00001881 3C00                <1> 	cmp al, 0
  2172 00001883 0F8442000000        <1> 	je near svdone
  2173 00001889 3C25                <1> 	cmp al, '%'
  2174 0000188B 7404                <1> 	je ans2
  2175 0000188D 8803                <1> 	mov [ebx], al	
  2176 0000188F EBEC                <1> 	jmp svhere
  2177 00001891 56                  <1> ans2:	push esi
  2178 00001892 BE[700C0000]        <1> 	mov esi, buf2
  2179 00001897 E823000000          <1> 	call ansfnd
  2180 0000189C E803000000          <1> 	call anscp
  2181 000018A1 5E                  <1> 	pop esi
  2182 000018A2 EBD9                <1> 	jmp svhere
  2183 000018A4 8A06                <1> anscp:	mov al, [esi]
  2184 000018A6 8803                <1> 	mov [ebx], al
  2185 000018A8 81FE[840C0000]      <1> 	cmp esi, numbuf
  2186 000018AE 74CD                <1> 	je svhere
  2187 000018B0 3C00                <1> 	cmp al, 0
  2188 000018B2 74C9                <1> 	je svhere
  2189 000018B4 43                  <1> 	inc ebx
  2190 000018B5 46                  <1> 	inc esi
  2191 000018B6 EBEC                <1> 	jmp anscp
  2192 000018B8 5E                  <1> ansnf:	pop esi
  2193 000018B9 8A06                <1> 	mov al, [esi]
  2194 000018BB 8803                <1> 	mov [ebx], al
  2195 000018BD EBBE                <1> 	jmp svhere
  2196 000018BF 46                  <1> ansfnd:	inc esi
  2197 000018C0 8A06                <1> 	mov al, [esi]
  2198 000018C2 3C00                <1> 	cmp al, 0
  2199 000018C4 74F2                <1> 	je ansnf
  2200 000018C6 3C30                <1> 	cmp al, '0'
  2201 000018C8 74F5                <1> 	je ansfnd
  2202 000018CA C3                  <1> 	ret
  2203 000018CB B000                <1> svdone:	mov al, 0
  2204 000018CD 8803                <1> 	mov [ebx], al
  2205 000018CF E940F4FFFF          <1> 	jmp nwcmd
  2206                              <1> 	
  2207                              <1> 	
  2208 000018D4 05042E2F00          <1> 	db 5,4,"./",0
  2209                              <1> rundiskprog:
  2210 000018D9 BF[700A0000]        <1> 	mov edi, buftxt
  2211 000018DE 81C702000000        <1> 	add edi, 2
  2212 000018E4 BE00001000          <1> 	mov esi, 0x100000
  2213 000018E9 E8A6250000          <1> 	call loadfile
  2214 000018EE 81FA94010000        <1> 	cmp edx, 404
  2215 000018F4 7414                <1> 	je noprogfound
  2216 000018F6 BB00001000          <1> 	mov ebx, 0x100000
  2217 000018FB 66813B4558          <1> 	cmp word [ebx], "EX"
  2218 00001900 7508                <1> 	jne noprogfound
  2219 00001902 81C302000000        <1> 	add ebx, 2
  2220 00001908 FFE3                <1> 	jmp ebx
  2221                              <1> noprogfound:
  2222 0000190A BE[3E400000]        <1> 	mov esi, notfound1
  2223 0000190F E8A3F1FFFF          <1> 	call print
  2224 00001914 BE[700A0000]        <1> 	mov esi, buftxt
  2225 00001919 81C602000000        <1> 	add esi, 2
  2226 0000191F E893F1FFFF          <1> 	call print
  2227 00001924 BE[48400000]        <1> 	mov esi, notfound2
  2228 00001929 E889F1FFFF          <1> 	call print
  2229 0000192E E9E1F3FFFF          <1> 	jmp nwcmd
  2230                              <1> 
  2231 00001933 E9DCF3FFFF          <1> notbatch: jmp nwcmd
  2232                              <1> 
  2233 00001938 05047768696C6500    <1> 	db 5,4,"while",0
  2234 00001940 B000                <1> while:  mov al, 0
  2235 00001942 3805[69030000]      <1> 	cmp [BATCHISON], al
  2236 00001948 0F84E5FFFFFF        <1> 	je near notbatch
  2237 0000194E 8B35[65030000]      <1> 	MOV esi, [BATCHPOS]
  2238 00001954 4E                  <1> whilefnd: dec esi
  2239 00001955 8A06                <1> 	mov al, [esi]
  2240 00001957 3C0A                <1> 	cmp al, 10
  2241 00001959 0F8412000000        <1> 	je near whilefnd2
  2242 0000195F 3C0D                <1> 	cmp al, 13
  2243 00001961 0F840A000000        <1> 	je near whilefnd2
  2244 00001967 3C00                <1> 	cmp al, 0
  2245 00001969 0F8402000000        <1> 	je near whilefnd2
  2246 0000196F EBE3                <1> 	jmp whilefnd
  2247                              <1> whilefnd2:
  2248 00001971 8935[6B030000]      <1> 	mov [LOOPPOS], esi
  2249 00001977 C605[6A030000]01    <1> 	mov BYTE [LOOPON], 1
  2250 0000197E 0005[00030000]      <1> 	add [IFON], al
  2251 00001984 BE[700A0000]        <1> 	mov esi, buftxt
  2252 00001989 BB[700A0000]        <1> 	mov ebx, buftxt
  2253 0000198E 81C306000000        <1> 	add ebx, 6
  2254 00001994 E923000000          <1> 	jmp chkeqsn
  2255                              <1> 
  2256                              <1> 
  2257 00001999 0504696600          <1> 	db 5,4,"if",0
  2258 0000199E B000                <1> if:	mov al, 0
  2259 000019A0 3805[69030000]      <1> 	cmp [BATCHISON], al
  2260 000019A6 0F8487FFFFFF        <1> 	je near notbatch
  2261 000019AC BE[700A0000]        <1> 	mov esi, buftxt
  2262 000019B1 BB[700A0000]        <1> 	mov ebx, buftxt
  2263 000019B6 81C303000000        <1> 	add ebx, 3
  2264 000019BC 8A06                <1> chkeqsn: mov al, [esi]
  2265 000019BE 3C00                <1> 	cmp al, 0
  2266 000019C0 0F846DFFFFFF        <1> 	je near notbatch
  2267 000019C6 3C3D                <1> 	cmp al, '='
  2268 000019C8 0F8403000000        <1> 	je near chkeqdn
  2269 000019CE 46                  <1> 	inc esi
  2270 000019CF EBEB                <1> 	jmp chkeqsn
  2271 000019D1 B000                <1> chkeqdn: mov al, 0 
  2272 000019D3 8806                <1> 	mov [esi], al
  2273 000019D5 46                  <1> 	inc esi
  2274 000019D6 8A06                <1> 	mov al, [esi]
  2275 000019D8 3C24                <1> 	cmp al, '$'
  2276 000019DA 0F8462000000        <1> 	je near ifvar1
  2277 000019E0 8A03                <1> ifvar2: mov al, [ebx]
  2278 000019E2 3C24                <1> 	cmp al, '$'
  2279 000019E4 0F847B000000        <1> 	je near ifvar3
  2280 000019EA E8F0F3FFFF          <1> ifvar4:	call tester
  2281 000019EF 3C01                <1> 	cmp al, 1
  2282 000019F1 0F8405000000        <1> 	je near trueif
  2283 000019F7 E923000000          <1> 	jmp falseif
  2284 000019FC B800000000          <1> trueif:	mov eax, 0
  2285 00001A01 A0[00030000]        <1> 	mov al, [IFON]
  2286 00001A06 FEC0                <1> 	inc al
  2287 00001A08 A2[00030000]        <1> 	mov [IFON], al
  2288 00001A0D B400                <1> 	mov ah, 0
  2289 00001A0F BE[01030000]        <1> 	mov esi, IFTRUE
  2290 00001A14 01C6                <1> 	add esi, eax
  2291 00001A16 B401                <1> 	mov ah, 1
  2292 00001A18 8826                <1> 	mov [esi], ah
  2293 00001A1A E9F5F2FFFF          <1> 	jmp nwcmd
  2294 00001A1F B800000000          <1> falseif: mov eax, 0
  2295 00001A24 A0[00030000]        <1> 	mov al, [IFON]
  2296 00001A29 FEC0                <1> 	inc al
  2297 00001A2B A2[00030000]        <1> 	mov [IFON], al
  2298 00001A30 B400                <1> 	mov ah, 0
  2299 00001A32 BE[01030000]        <1> 	mov esi, IFTRUE
  2300 00001A37 01C6                <1> 	add esi, eax
  2301 00001A39 B400                <1> 	mov ah, 0
  2302 00001A3B 8826                <1> 	mov [esi], ah
  2303 00001A3D E9D2F2FFFF          <1> 	jmp nwcmd
  2304 00001A42 89F7                <1> ifvar1: mov edi, esi
  2305 00001A44 81EF[700A0000]      <1> 	sub edi, buftxt
  2306 00001A4A 47                  <1> 	inc edi
  2307 00001A4B BB[6F050000]        <1> 	mov ebx, variables
  2308 00001A50 E82CFAFFFF          <1> 	call nxtvrech
  2309 00001A55 BB[700A0000]        <1> 	mov ebx, buftxt
  2310 00001A5A 81C303000000        <1> 	add ebx, 3
  2311 00001A60 E97BFFFFFF          <1> 	jmp ifvar2
  2312 00001A65 8935[851A0000]      <1> ifvar3: mov [esiif], esi
  2313 00001A6B BF04000000          <1> 	mov edi, 4
  2314 00001A70 BB[6F050000]        <1> 	mov ebx, variables
  2315 00001A75 E807FAFFFF          <1> 	call nxtvrech
  2316 00001A7A 8B35[851A0000]      <1> 	mov esi, [esiif]
  2317 00001A80 E965FFFFFF          <1> 	jmp ifvar4
  2318                              <1> 
  2319 00001A85 00000000            <1> esiif dd 0
  2320                              <1> 	
  2321 00001A89 0504656C736500      <1> 	db 5,4,"else",0
  2322 00001A90 B800000000          <1> else:	mov eax, 0
  2323 00001A95 A0[00030000]        <1> 	mov al, [IFON]
  2324 00001A9A BE[01030000]        <1> 	mov esi, IFTRUE
  2325 00001A9F 01C6                <1> 	add esi, eax
  2326 00001AA1 8A06                <1> 	mov al, [esi]
  2327 00001AA3 3C00                <1> 	cmp al, 0		
  2328 00001AA5 7409                <1> 	je else1
  2329 00001AA7 3C01                <1> 	cmp al, 1
  2330 00001AA9 740E                <1> 	je else2
  2331 00001AAB E964F2FFFF          <1> 	jmp nwcmd
  2332 00001AB0 B001                <1> else1:  mov al, 1
  2333 00001AB2 8806                <1> 	mov [esi], al
  2334 00001AB4 E95BF2FFFF          <1> 	jmp nwcmd
  2335 00001AB9 B000                <1> else2:	mov al, 0
  2336 00001ABB 8806                <1> 	mov [esi], al
  2337 00001ABD E952F2FFFF          <1> 	jmp nwcmd
  2338                              <1> 
  2339 00001AC2 05046C6F6F7000      <1> 	db 5,4,"loop",0
  2340 00001AC9 3805[6A030000]      <1> 	cmp [LOOPON], al
  2341 00001ACF 0F8405000000        <1> 	je near filoop
  2342 00001AD5 E93AF2FFFF          <1> 	jmp nwcmd
  2343 00001ADA 8B35[6B030000]      <1> filoop: mov esi, [LOOPPOS]
  2344 00001AE0 8935[65030000]      <1> 	mov [BATCHPOS], esi
  2345 00001AE6 E929F2FFFF          <1> 	jmp nwcmd
  2346                              <1> 	
  2347                              <1> 
  2348 00001AEB 0504666900          <1> 	db 5,4,"fi",0
  2349 00001AF0 B000                <1> 	mov al, 0
  2350 00001AF2 3805[69030000]      <1> 	cmp [BATCHISON], al
  2351 00001AF8 0F8435FEFFFF        <1> 	je near notbatch
  2352 00001AFE B001                <1> fi:	mov al, 1
  2353 00001B00 2805[00030000]      <1> 	sub [IFON],al
  2354 00001B06 E909F2FFFF          <1> 	jmp nwcmd
  2355                              <1> 
  2356 00001B0B 050473746F7000      <1> 	db 5,4,"stop",0
  2357 00001B12 B000                <1> stop:	mov al, 0
  2358 00001B14 A2[69030000]        <1> 	mov [BATCHISON], al
  2359 00001B19 A2[00030000]        <1> 	mov [IFON], al
  2360 00001B1E A2[01030000]        <1> 	mov [IFTRUE], al
  2361 00001B23 A2[6A030000]        <1> 	mov [LOOPON], al
  2362 00001B28 E9E7F1FFFF          <1> 	jmp nwcmd
  2363                                      %include 'source/programs.asm'
  2364                              <1> 
  2365 00001B2D 0504696E7465726E65- <1> db 5,4,"internet",0
  2366 00001B36 7400                <1>
  2367                              <1> 	internettest: 			;;initialize network card, lets hope this is right
  2368                              <1> 							;;^^used to^^, now tests int 30h functions		
  2369 00001B38 B403                <1> 		mov ah, 3
  2370 00001B3A CD30                <1> 		int 30h
  2371 00001B3C B401                <1> 		mov ah, 1
  2372 00001B3E BE[501B0000]        <1> 		mov esi, datmsg
  2373 00001B43 66BB0700            <1> 		mov bx, 7
  2374 00001B47 B000                <1> 		mov al, 0
  2375 00001B49 CD30                <1> 		int 30h
  2376                              <1> 	;jmp packettest
  2377 00001B4B E9C4F1FFFF          <1> 		jmp nwcmd
  2378 00001B50 496E7465726E657420- <1> datmsg: db "Internet has not been implemented yet.",10,13,0
  2379 00001B59 686173206E6F742062- <1>
  2380 00001B62 65656E20696D706C65- <1>
  2381 00001B6B 6D656E746564207965- <1>
  2382 00001B74 742E0A0D00          <1>
  2383                              <1> 		
  2384 00001B79 050470636900        <1> db 5,4,"pci",0
  2385                              <1> 	pcishow:
  2386 00001B7F E856210000          <1> 	call pcidump
  2387 00001B84 E98BF1FFFF          <1> 	jmp nwcmd
  2388 00001B89 050472756E62617463- <1> db 5,4,"runbatch",0
  2389 00001B92 6800                <1>
  2390                              <1> 	runbatch2:
  2391 00001B94 BE[88400000]        <1> 		mov esi, line
  2392 00001B99 E819EFFFFF          <1> 		call print
  2393 00001B9E BF[700A0000]        <1> 		mov edi, buftxt
  2394 00001BA3 81C709000000        <1> 		add edi, 9
  2395 00001BA9 BE00001000          <1> 		mov esi, 0x100000
  2396 00001BAE E8E1220000          <1> 		call loadfile
  2397 00001BB3 BF00001000          <1> 		mov edi, 0x100000
  2398 00001BB8 C605[69030000]01    <1> 		mov byte [BATCHISON], 1
  2399                              <1> 	batchrunloop:
  2400 00001BBF E82DF1FFFF          <1> 		call buftxtclear
  2401 00001BC4 BE[700A0000]        <1> 		mov esi, buftxt
  2402                              <1> 	batchrunloop2:
  2403 00001BC9 B10D                <1> 		mov cl, 13
  2404 00001BCB B50A                <1> 		mov ch, 10
  2405 00001BCD 66390F              <1> 		cmp [edi], cx
  2406 00001BD0 0F841E000000        <1> 		je near nxtbatchrunline
  2407 00001BD6 66C1C108            <1> 		rol cx, 8
  2408 00001BDA 66390F              <1> 		cmp [edi], cx
  2409 00001BDD 0F8411000000        <1> 		je near nxtbatchrunline
  2410 00001BE3 803F00              <1> 		cmp byte [edi], 0
  2411 00001BE6 0F8408000000        <1> 		je near nxtbatchrunline
  2412 00001BEC 8A07                <1> 		mov al, [edi]
  2413 00001BEE 8806                <1> 		mov [esi], al
  2414 00001BF0 46                  <1> 		inc esi
  2415 00001BF1 47                  <1> 		inc edi
  2416 00001BF2 EBD5                <1> 		jmp batchrunloop2
  2417                              <1> 	nxtbatchrunline:
  2418 00001BF4 81C702000000        <1> 		add edi, 2
  2419 00001BFA 893D[591C0000]      <1> 		mov [batchedi], edi
  2420 00001C00 C60600              <1> 		mov byte [esi], 0
  2421 00001C03 BE[700A0000]        <1> 		mov esi, buftxt
  2422 00001C08 803E00              <1> 		cmp byte [esi], 0
  2423 00001C0B 0F843C000000        <1> 		je near nobatchfoundrun
  2424 00001C11 BB00000000          <1> 		mov ebx, 0
  2425 00001C16 8A1D[00030000]      <1> 		mov bl, [IFON]
  2426 00001C1C 80FB01              <1> 		cmp bl, 1
  2427 00001C1F 0F8338000000        <1> 		jae near iftestbatch
  2428                              <1> 	doneiftest:
  2429 00001C25 803D[201D0000]00    <1> 		cmp byte [runnextline], 0
  2430 00001C2C 0F8405000000        <1> 		je near noruniftest
  2431 00001C32 E836F1FFFF          <1> 		call progtest
  2432                              <1> 	noruniftest:
  2433 00001C37 C605[201D0000]01    <1> 		mov byte [runnextline], 1
  2434 00001C3E 8B3D[591C0000]      <1> 		mov edi, [batchedi]
  2435 00001C44 803F00              <1> 		cmp byte [edi], 0
  2436 00001C47 0F8572FFFFFF        <1> 		jne near batchrunloop
  2437                              <1> 	nobatchfoundrun:
  2438 00001C4D C605[69030000]00    <1> 		mov byte [BATCHISON], 0
  2439 00001C54 E9BBF0FFFF          <1> 		jmp nwcmd
  2440                              <1> 	
  2441 00001C59 00000000            <1> batchedi dd 0	
  2442                              <1> 	
  2443                              <1> 	iftestbatch:
  2444 00001C5D BE[01030000]        <1> 		mov esi, IFTRUE
  2445 00001C62 01DE                <1> 		add esi, ebx
  2446 00001C64 803E00              <1> 		cmp byte [esi], 0
  2447 00001C67 0F85B8FFFFFF        <1> 		jne near doneiftest
  2448 00001C6D 881D[211D0000]      <1> 		mov [iffalsebuf], bl
  2449 00001C73 803D[6A030000]01    <1> 		cmp byte [LOOPON], 1
  2450 00001C7A 750B                <1> 		jne fifindbatch
  2451 00001C7C 8B3D[6B030000]      <1> 		mov edi, [LOOPPOS]
  2452 00001C82 E938FFFFFF          <1> 		jmp batchrunloop
  2453                              <1> 	fifindbatch:
  2454 00001C87 66B96966            <1> 		mov cx, "if"
  2455 00001C8B 66B86669            <1> 		mov ax, "fi"
  2456 00001C8F 663907              <1> 		cmp [edi], ax
  2457 00001C92 0F841A000000        <1> 		je near fifoundbatch
  2458 00001C98 66390F              <1> 		cmp [edi], cx
  2459 00001C9B 0F8462000000        <1> 		je near iffoundbatch
  2460 00001CA1 803F00              <1> 		cmp byte [edi], 0
  2461 00001CA4 0F8408000000        <1> 		je near fifoundbatch
  2462 00001CAA 81C702000000        <1> 		add edi, 2
  2463 00001CB0 EBD5                <1> 		jmp fifindbatch
  2464                              <1> 	fifoundbatch:
  2465 00001CB2 81C702000000        <1> 		add edi, 2
  2466 00001CB8 B00D                <1> 		mov al, 13
  2467 00001CBA B40A                <1> 		mov ah, 10
  2468 00001CBC 663907              <1> 		cmp [edi], ax
  2469 00001CBF 7414                <1> 		je goodfibatch
  2470 00001CC1 66C1C008            <1> 		rol ax, 8
  2471 00001CC5 663907              <1> 		cmp [edi], ax
  2472 00001CC8 740B                <1> 		je goodfibatch
  2473 00001CCA 803F00              <1> 		cmp byte [edi], 0
  2474 00001CCD 0F847AFFFFFF        <1> 		je near nobatchfoundrun
  2475 00001CD3 EBB2                <1> 		jmp fifindbatch
  2476                              <1> 	goodfibatch:
  2477 00001CD5 B001                <1> 		mov al, 1
  2478 00001CD7 2805[00030000]      <1> 		sub [IFON], al 
  2479 00001CDD A0[00030000]        <1> 		mov al, [IFON]
  2480 00001CE2 8A1D[211D0000]      <1> 		mov bl, [iffalsebuf]
  2481 00001CE8 38D8                <1> 		cmp al, bl
  2482 00001CEA 779B                <1> 		ja fifindbatch
  2483 00001CEC BE[700A0000]        <1> 		mov esi, buftxt
  2484 00001CF1 81EF02000000        <1> 		sub edi, 2
  2485 00001CF7 C605[201D0000]00    <1> 		mov byte [runnextline], 0
  2486 00001CFE E9BCFEFFFF          <1> 		jmp batchrunloop
  2487                              <1> 	iffoundbatch:
  2488 00001D03 B020                <1> 		mov al, ' '
  2489 00001D05 81C702000000        <1> 		add edi, 2
  2490 00001D0B 3807                <1> 		cmp [edi], al
  2491 00001D0D 0F8574FFFFFF        <1> 		jne near fifindbatch
  2492 00001D13 B001                <1> 		mov al, 1
  2493 00001D15 0005[00030000]      <1> 		add [IFON], al
  2494 00001D1B E967FFFFFF          <1> 		jmp fifindbatch
  2495                              <1> 		
  2496                              <1> 		
  2497 00001D20 01                  <1> runnextline db 1
  2498 00001D21 00                  <1> iffalsebuf db 0
  2499                              <1> 
  2500 00001D22 0504626174636800    <1> db 5,4,"batch",0
  2501                              <1> 	batchst: 
  2502 00001D2A BF[700A0000]        <1> 		mov edi, buftxt
  2503 00001D2F 81C706000000        <1> 		add edi, 6
  2504 00001D35 803F00              <1> 		cmp byte [edi], 0
  2505 00001D38 0F8473000000        <1> 		je near nonamefound
  2506 00001D3E BE00001000          <1> 		mov esi, 0x100000
  2507 00001D43 E84C210000          <1> 		call loadfile
  2508 00001D48 89D0                <1> 		mov eax, edx
  2509 00001D4A 3D94010000          <1> 		cmp eax, 404
  2510 00001D4F 746F                <1> 		je goodbatchname
  2511 00001D51 BE[601D0000]        <1> 		mov esi, badbatchname
  2512 00001D56 E85CEDFFFF          <1> 		call print
  2513 00001D5B E9B4EFFFFF          <1> 		jmp nwcmd
  2514 00001D60 546869732066696C65- <1> 		badbatchname db "This file already exists!",10,13,0
  2515 00001D69 20616C726561647920- <1>
  2516 00001D72 657869737473210A0D- <1>
  2517 00001D7B 00                  <1>
  2518 00001D7C 596F75206861766520- <1> 		namenotfoundbatch db "You have to type a name after the command.",10,13,0
  2519 00001D85 746F20747970652061- <1>
  2520 00001D8E 206E616D6520616674- <1>
  2521 00001D97 65722074686520636F- <1>
  2522 00001DA0 6D6D616E642E0A0D00  <1>
  2523 00001DA9 00000000            <1> 		esicache3 dd 0
  2524 00001DAD 00000000            <1> 		esicache2 dd 0
  2525                              <1> 	nonamefound:
  2526 00001DB1 BE[7C1D0000]        <1> 		mov esi, namenotfoundbatch
  2527 00001DB6 E8FCECFFFF          <1> 		call print
  2528 00001DBB E954EFFFFF          <1> 		jmp nwcmd
  2529                              <1> 	goodbatchname:
  2530 00001DC0 BE00001000          <1> 		mov esi, 0x100000
  2531                              <1> 	batchcreate:
  2532 00001DC5 8935[A91D0000]      <1> 		mov [esicache3], esi
  2533 00001DCB B00D                <1> 		mov al, 13
  2534 00001DCD B307                <1> 		mov bl, 7
  2535 00001DCF B404                <1> 		mov ah, 4
  2536 00001DD1 CD30                <1> 		int 30h
  2537 00001DD3 8935[AD1D0000]      <1> 		mov [esicache2], esi
  2538 00001DD9 8A0E                <1> 		mov cl, [esi]
  2539 00001DDB 8B35[A91D0000]      <1> 		mov esi, [esicache3]
  2540 00001DE1 BB[381E0000]        <1> 		mov ebx, exitword
  2541 00001DE6 E82EF0FFFF          <1> 		call cndtest
  2542 00001DEB 3C01                <1> 		cmp al, 1
  2543 00001DED 7423                <1> 		je endbatchcreate
  2544 00001DEF 3C02                <1> 		cmp al, 2
  2545 00001DF1 741F                <1> 		je endbatchcreate
  2546 00001DF3 BE[88400000]        <1> 		mov esi, line
  2547 00001DF8 E8BAECFFFF          <1> 		call print
  2548 00001DFD 8B35[AD1D0000]      <1> 		mov esi, [esicache2]
  2549 00001E03 B00D                <1> 		mov al, 13
  2550 00001E05 B40A                <1> 		mov ah, 10
  2551 00001E07 668906              <1> 		mov [esi], ax
  2552 00001E0A 81C602000000        <1> 		add esi, 2
  2553 00001E10 EBB3                <1> 		jmp batchcreate
  2554                              <1> 	endbatchcreate:
  2555 00001E12 8B35[A91D0000]      <1> 		mov esi, [esicache3]
  2556 00001E18 B800000000          <1> 		mov eax, 0
  2557 00001E1D 8806                <1> 		mov [esi], al
  2558 00001E1F BE[88400000]        <1> 		mov esi, line
  2559 00001E24 E88EECFFFF          <1> 		call print
  2560 00001E29 BE00001000          <1> 		mov esi, 0x100000
  2561 00001E2E E884ECFFFF          <1> 		call print
  2562 00001E33 E9DCEEFFFF          <1> 		jmp nwcmd
  2563                              <1> 	
  2564 00001E38 5C7800              <1> 	exitword db "\x",0
  2565 00001E3B 54797065205C782074- <1> 	wordmsg db "Type \x to exit.",10,13,0
  2566 00001E44 6F20657869742E0A0D- <1>
  2567 00001E4D 00                  <1>
  2568                              <1> 		
  2569 00001E4E 050473686F77626D70- <1> db 5,4,"showbmp",0
  2570 00001E57 00                  <1>
  2571 00001E58 803D[A5280000]00    <1> 		cmp byte [guion], 0
  2572 00001E5F 0F8458000000        <1> 		je near noguibmp
  2573 00001E65 BF[700A0000]        <1> 		mov edi, buftxt
  2574 00001E6A 81C708000000        <1> 		add edi, 8
  2575 00001E70 BE00001000          <1> 		mov esi, 0x100000
  2576 00001E75 E81A200000          <1> 		call loadfile
  2577 00001E7A BE00001000          <1> 		mov esi, 0x100000
  2578 00001E7F B900000000          <1> 		mov ecx, 0
  2579 00001E84 BA00000000          <1> 		mov edx, 0
  2580 00001E89 B800000000          <1> 		mov eax, 0
  2581 00001E8E BB00000000          <1> 		mov ebx, 0
  2582 00001E93 E8D8190000          <1> 		call showbmp
  2583 00001E98 B000                <1> 		mov al, 0
  2584 00001E9A B405                <1> 		mov ah, 5
  2585 00001E9C CD30                <1> 		int 30h
  2586 00001E9E BE[700A0000]        <1> 		mov esi, buftxt
  2587 00001EA3 81C608000000        <1> 		add esi, 8
  2588 00001EA9 E809ECFFFF          <1> 		call print
  2589 00001EAE BE[841F0000]        <1> 		mov esi, loadedbmpmsg
  2590 00001EB3 E8FFEBFFFF          <1> 		call print
  2591 00001EB8 E957EEFFFF          <1> 		jmp nwcmd
  2592                              <1> noguibmp:
  2593 00001EBD BE[CC1E0000]        <1> 		mov esi, warnguibmp
  2594 00001EC2 E8F0EBFFFF          <1> 		call print
  2595 00001EC7 E948EEFFFF          <1> 		jmp nwcmd
  2596 00001ECC 546869732063616E20- <1> warnguibmp db "This can not be done without the gui.",10,13,0
  2597 00001ED5 6E6F7420626520646F- <1>
  2598 00001EDE 6E6520776974686F75- <1>
  2599 00001EE7 742074686520677569- <1>
  2600 00001EF0 2E0A0D00            <1>
  2601                              <1> 
  2602 00001EF4 050473686F77747874- <1> db 5,4,"showtxt",0
  2603 00001EFD 00                  <1>
  2604 00001EFE BF[700A0000]        <1> 		mov edi, buftxt
  2605 00001F03 81C708000000        <1> 		add edi, 8
  2606 00001F09 BE00001000          <1> 		mov esi, 0x100000
  2607 00001F0E E8811F0000          <1> 		call loadfile
  2608 00001F13 81FA94010000        <1> 		cmp edx, 404
  2609 00001F19 0F8419000000        <1> 		je near filenotfound
  2610 00001F1F BE00001000          <1> 		mov esi, 0x100000
  2611 00001F24 E88EEBFFFF          <1> 		call print
  2612 00001F29 BE[88400000]        <1> 		mov esi, line
  2613 00001F2E E884EBFFFF          <1> 		call print
  2614 00001F33 E9DCEDFFFF          <1> 		jmp nwcmd
  2615                              <1> 		
  2616                              <1> filenotfound:
  2617 00001F38 BE[611F0000]        <1> 		mov esi, filenf
  2618 00001F3D E875EBFFFF          <1> 		call print
  2619 00001F42 BE[700A0000]        <1> 		mov esi, buftxt
  2620 00001F47 81C608000000        <1> 		add esi, 8
  2621 00001F4D E865EBFFFF          <1> 		call print
  2622 00001F52 BE[6C1F0000]        <1> 		mov esi, filenf2
  2623 00001F57 E85BEBFFFF          <1> 		call print
  2624 00001F5C E9B3EDFFFF          <1> 		jmp nwcmd
  2625 00001F61 5468652066696C6520- <1> filenf db "The file ",34,0
  2626 00001F6A 2200                <1>
  2627 00001F6C 2220636F756C64206E- <1> filenf2 db 34," could not be found.",13,10,0
  2628 00001F75 6F7420626520666F75- <1>
  2629 00001F7E 6E642E0D0A00        <1>
  2630                              <1> 		
  2631 00001F84 206C6F616465642E0D- <1> loadedbmpmsg db " loaded.",13,10,0
  2632 00001F8D 0A00                <1>
  2633                              <1> 
  2634 00001F8F 050464756D7000      <1> 	db 5,4,"dump",0
  2635 00001F96 BE[700A0000]        <1> 	mov esi, buftxt
  2636 00001F9B 81C605000000        <1> 	add esi, 5
  2637 00001FA1 B900000000          <1> 	mov ecx, 0
  2638 00001FA6 E853F2FFFF          <1> 	call cnvrttxt
  2639 00001FAB 89CF                <1> 	mov edi, ecx
  2640 00001FAD 89FE                <1> 	mov esi, edi
  2641 00001FAF 81C680030000        <1> 	add esi, 896
  2642 00001FB5 C605[CD100000]00    <1> 	mov byte [firsthexshown],0
  2643                              <1> dumphexloop:
  2644 00001FBC 8B0F                <1> 	mov ecx, [edi]
  2645 00001FBE E80BF1FFFF          <1> 	call showhex
  2646 00001FC3 81C704000000        <1> 	add edi, 4
  2647 00001FC9 39F7                <1> 	cmp edi, esi
  2648 00001FCB 72EF                <1> 	jb dumphexloop
  2649 00001FCD E942EDFFFF          <1> 	jmp nwcmd
  2650                              <1> 	
  2651 00001FD2 050465787000        <1> 	db 5,4,"exp",0
  2652 00001FD8 B878563412          <1> 	mov eax, 0x12345678
  2653 00001FDD BBEFCDAB90          <1> 	mov ebx, 0x90ABCDEF
  2654 00001FE2 B945584345          <1> 	mov ecx, "EXCE"
  2655 00001FE7 BA5054494F          <1> 	mov edx, "PTIO"
  2656 00001FEC BE4E203133          <1> 	mov esi, "N 13"
  2657 00001FF1 BF[140D0000]        <1> 	mov edi, nwcmd
  2658 00001FF6 CD0D                <1> exception1:	int 13
  2659                              <1> 
  2660 00001FF8 050474696D6500      <1> db 5,4,"time",0
  2661 00001FFF E805000000          <1> 	call time
  2662 00002004 E90BEDFFFF          <1> 	jmp nwcmd
  2663                              <1> time:
  2664 00002009 E8C1000000          <1> 	call tstackput1
  2665 0000200E B00A                <1> 	mov al,10			;Get RTC register A
  2666 00002010 E8EB000000          <1> 	call tget1
  2667 00002015 A880                <1> 	test al,0x80			;Is update in progress?
  2668 00002017 75F0                <1> 	jne time				; yes, wait
  2669                              <1> 
  2670 00002019 B000                <1> 	mov al,0			;Get seconds (00 to 59)
  2671 0000201B E8E0000000          <1> 	call tget1
  2672 00002020 A2[3E210000]        <1> 	mov [RTCtimeSecond],al
  2673                              <1> 
  2674 00002025 B002                <1> 	mov al,0x02			;Get minutes (00 to 59)
  2675 00002027 E8D4000000          <1> 	call tget1
  2676 0000202C A2[3F210000]        <1> 	mov [RTCtimeMinute],al
  2677                              <1> 
  2678 00002031 B004                <1> 	mov al,0x04			;Get hours (see notes)
  2679 00002033 E8C8000000          <1> 	call tget1
  2680 00002038 A2[40210000]        <1> 	mov [RTCtimeHour],al
  2681                              <1> 
  2682 0000203D B007                <1> 	mov al,0x07			;Get day of month (01 to 31)
  2683 0000203F E8BC000000          <1> 	call tget1
  2684 00002044 A2[41210000]        <1> 	mov [RTCtimeDay],al
  2685                              <1> 
  2686 00002049 B008                <1> 	mov al,0x08			;Get month (01 to 12)
  2687 0000204B E8B0000000          <1> 	call tget1
  2688 00002050 A2[42210000]        <1> 	mov [RTCtimeMonth],al
  2689                              <1> 
  2690 00002055 B009                <1> 	mov al,0x09			;Get year (00 to 99)
  2691 00002057 E8A4000000          <1> 	call tget1
  2692 0000205C A2[43210000]        <1> 	mov [RTCtimeYear],al
  2693                              <1> 	
  2694 00002061 BE[44210000]        <1> 	mov esi, timeshow
  2695 00002066 8A2D[40210000]      <1> 	mov ch, [RTCtimeHour]
  2696 0000206C E89A000000          <1> 	call tput1
  2697 00002071 8A2D[3F210000]      <1> 	mov ch, [RTCtimeMinute]
  2698 00002077 E88F000000          <1> 	call tput1
  2699 0000207C 8A2D[3E210000]      <1> 	mov ch, [RTCtimeSecond]
  2700 00002082 E884000000          <1> 	call tput1
  2701 00002087 BE[4E210000]        <1> 	mov esi, dateshow
  2702 0000208C 8A2D[42210000]      <1> 	mov ch, [RTCtimeMonth]
  2703 00002092 E874000000          <1> 	call tput1
  2704 00002097 8A2D[41210000]      <1> 	mov ch, [RTCtimeDay]
  2705 0000209D E869000000          <1> 	call tput1
  2706 000020A2 B520                <1> 	mov ch, 0x20
  2707 000020A4 E862000000          <1> 	call tput1
  2708 000020A9 4E                  <1> 	dec esi
  2709 000020AA 8A2D[43210000]      <1> 	mov ch, [RTCtimeYear]
  2710 000020B0 E856000000          <1> 	call tput1
  2711 000020B5 E82F000000          <1> 	call tstackget1
  2712 000020BA BE[44210000]        <1> 	mov esi, timeshow
  2713 000020BF 66BB0700            <1> 	mov bx, 7
  2714 000020C3 B401                <1> 	mov ah, 1
  2715 000020C5 B000                <1> 	mov al, 0
  2716 000020C7 CD30                <1> 	int 30h
  2717 000020C9 66B80000            <1> 	mov ax, 0
  2718 000020CD CD30                <1> 	int 30h
  2719                              <1> 	
  2720                              <1> tstackput1:
  2721 000020CF 8935[3A210000]      <1> 	mov [tstack + 20], esi
  2722 000020D5 BE[26210000]        <1> 	mov esi, tstack
  2723 000020DA 8906                <1> 	mov [esi], eax
  2724 000020DC 895E04              <1> 	mov [esi + 4], ebx
  2725 000020DF 894E08              <1> 	mov [esi + 8], ecx
  2726 000020E2 89560C              <1> 	mov [esi + 12], edx
  2727 000020E5 897E10              <1> 	mov [esi + 16], edi
  2728 000020E8 C3                  <1> 	ret
  2729                              <1> 	
  2730                              <1> tstackget1:
  2731 000020E9 BE[26210000]        <1> 	mov esi, tstack
  2732 000020EE 8B06                <1> 	mov eax, [esi]
  2733 000020F0 8B5E04              <1> 	mov ebx, [esi + 4]
  2734 000020F3 8B4E08              <1> 	mov ecx, [esi + 8]
  2735 000020F6 8B560C              <1> 	mov edx, [esi + 12]
  2736 000020F9 8B7E10              <1> 	mov edi, [esi + 16]
  2737 000020FC 8B7614              <1> 	mov esi, [esi + 20]
  2738 000020FF C3                  <1> 	ret
  2739                              <1> 	
  2740                              <1> tget1:
  2741 00002100 66BA7000            <1> 	mov dx, 0x70
  2742 00002104 EE                  <1> 	out dx, al
  2743 00002105 6642                <1> 	inc dx
  2744 00002107 EC                  <1> 	in al, dx
  2745 00002108 664A                <1> 	dec dx
  2746 0000210A C3                  <1> 	ret
  2747                              <1> 	
  2748                              <1> tput1:
  2749 0000210B 66C1E904            <1> 	shr cx, 4
  2750 0000210F B030                <1> 	mov al, 48
  2751 00002111 00E8                <1> 	add al, ch
  2752 00002113 8806                <1> 	mov [esi], al
  2753 00002115 46                  <1> 	inc esi
  2754 00002116 B030                <1> 	mov al, 48
  2755 00002118 C0E904              <1> 	shr cl, 4
  2756 0000211B 00C8                <1> 	add al, cl
  2757 0000211D 8806                <1> 	mov [esi], al
  2758 0000211F 81C602000000        <1> 	add esi, 2
  2759 00002125 C3                  <1> 	ret
  2760                              <1> 		
  2761 00002126 000000000000000000- <1> 	tstack dd 0,0,0,0,0,0
  2762 0000212F 000000000000000000- <1>
  2763 00002138 000000000000        <1>
  2764 0000213E 00                  <1> 	RTCtimeSecond db 0
  2765 0000213F 00                  <1> 	RTCtimeMinute db 0
  2766 00002140 00                  <1> 	RTCtimeHour db 0
  2767 00002141 00                  <1> 	RTCtimeDay db 0
  2768 00002142 00                  <1> 	RTCtimeMonth db 0
  2769 00002143 00                  <1> 	RTCtimeYear db 0
  2770 00002144 30303A30303A30300D- <1> 	timeshow db "00:00:00",13,10
  2771 0000214D 0A                  <1>
  2772 0000214E 30302D30302D303030- <1> 	dateshow db "00-00-0000",13,10,0
  2773 00002157 300D0A00            <1>
  2774                              <1> 
  2775 0000215B 0504637075696400    <1> db 5,4,"cpuid",0
  2776 00002163 B800000000          <1> 	mov eax, 0
  2777 00002168 0FA2                <1> 	cpuid
  2778 0000216A 891D[BF210000]      <1> 	mov [cpuidbuf], ebx
  2779 00002170 8915[C3210000]      <1> 	mov [cpuidbuf + 4], edx
  2780 00002176 890D[C7210000]      <1> 	mov [cpuidbuf + 8], ecx
  2781 0000217C BE[BF210000]        <1> 	mov esi, cpuidbuf
  2782 00002181 E831E9FFFF          <1> 	call print
  2783 00002186 BE[88400000]        <1> 	mov esi, line
  2784 0000218B E827E9FFFF          <1> 	call print
  2785 00002190 B801000000          <1> 	mov eax, 1
  2786 00002195 0FA2                <1> 	cpuid
  2787 00002197 89C1                <1> 	mov ecx, eax
  2788 00002199 C605[CD100000]02    <1> 	mov byte [firsthexshown], 2
  2789 000021A0 E829EFFFFF          <1> 	call showhex
  2790 000021A5 B808000080          <1> 	mov eax, 0x80000008
  2791 000021AA 0FA2                <1> 	cpuid
  2792 000021AC 89C1                <1> 	mov ecx, eax
  2793 000021AE C605[CD100000]02    <1> 	mov byte [firsthexshown], 2
  2794 000021B5 E814EFFFFF          <1> 	call showhex
  2795 000021BA E955EBFFFF          <1> 	jmp nwcmd
  2796                              <1> 	
  2797 000021BF 00<rept>            <1> cpuidbuf times 13 db 0
  2798                              <1> cpuidvendorend:
  2799                              <1> progend:		;programs end here	
  2800                              <1> batchprogend:
  2801                                      %include 'source/input.asm'
  2802                              <1> PS2SET:
  2803 000021CC B0A8                <1>   mov  al, 0xa8		; enable mouse port
  2804 000021CE E664                <1>   out  0x64, al		; write to keyboardcontroller
  2805 000021D0 E801000000          <1>   call CHKPRT		; check if command is progressed (demand!)
  2806 000021D5 C3                  <1> ret
  2807                              <1> 
  2808                              <1> ;***********************************************************************
  2809                              <1> ;Check if command is accepted. (not got stuck in inputbuffer)
  2810                              <1> ;***********************************************************************
  2811                              <1> CHKPRT:
  2812 000021D6 66B96400            <1>   mov  cx, 100
  2813                              <1>  .again:
  2814 000021DA E464                <1>   in   al, 0x64		; read from keyboardcontroller
  2815 000021DC A802                <1>   test al, 2		; Check if input buffer is empty
  2816 000021DE 7402                <1>   je .go
  2817 000021E0 E2F8                <1>   loop .again
  2818                              <1>  .go:
  2819 000021E2 C3                  <1> ret
  2820                              <1> 
  2821                              <1> ;***********************************************************************
  2822                              <1> ;Write to mouse
  2823                              <1> ;***********************************************************************
  2824                              <1> WMOUS:
  2825 000021E3 B0D4                <1>   mov  al, 0xd4		; write to mouse device instead of to keyboard
  2826 000021E5 E664                <1>   out  0x64, al		; write to keyboardcontroller
  2827 000021E7 E8EAFFFFFF          <1>   call CHKPRT		; check if command is progressed (demand!)
  2828 000021EC C3                  <1> ret
  2829                              <1> 
  2830                              <1> 
  2831                              <1> 
  2832                              <1> ;***********************************************************************
  2833                              <1> ;mouse output buffer full
  2834                              <1> ;***********************************************************************
  2835                              <1> MBUFFUL:
  2836 000021ED 66B96400            <1>   mov cx, 100
  2837                              <1>  .mn:
  2838 000021F1 E464                <1>   in   al, 0x64		; read from keyboardcontroller
  2839 000021F3 A820                <1>   test al, 0x20		; check if mouse output buffer is full
  2840 000021F5 7402                <1>   jz  .mnn
  2841 000021F7 E2F8                <1>   loop .mn
  2842                              <1>  .mnn:
  2843 000021F9 C3                  <1> ret
  2844                              <1> 
  2845                              <1> 
  2846                              <1> ;***********************************************************************
  2847                              <1> ;Write activate Mouse HardWare
  2848                              <1> ;***********************************************************************
  2849                              <1> ACTMOUS:
  2850 000021FA E8E4FFFFFF          <1>   call WMOUS
  2851 000021FF B0F4                <1>   mov  al, 0xf4 	; Command to activate mouse itselve (Stream mode)
  2852 00002201 E660                <1>   out  0x60, al		; write ps/2 controller output port (activate mouse)
  2853 00002203 E8CEFFFFFF          <1>   call CHKPRT		; check if command is progressed (demand!)
  2854 00002208 E801000000          <1>   call CHKMOUS		; check if a byte is available
  2855 0000220D C3                  <1> ret
  2856                              <1> 
  2857                              <1> ;***********************************************************************
  2858                              <1> ;Check if mouse has info for us
  2859                              <1> ;***********************************************************************
  2860                              <1> CHKMOUS:
  2861 0000220E B300                <1>   mov  bl, 0
  2862 00002210 66B96400            <1>   mov cx, 100
  2863                              <1>  .vrd:
  2864 00002214 E464                <1>   in   al, 0x64		; read from keyboardcontroller
  2865 00002216 A801                <1>   test al, 1		; check if controller buffer (60h) has data
  2866 00002218 7504                <1>   jnz .yy
  2867 0000221A E2F8                <1>   loop .vrd
  2868 0000221C B301                <1>   mov  bl, 1
  2869                              <1>  .yy:
  2870 0000221E C3                  <1> ret
  2871                              <1> 
  2872                              <1> ;***********************************************************************
  2873                              <1> ;Get Mouse Byte
  2874                              <1> ;***********************************************************************
  2875                              <1> GETB:
  2876                              <1>  .cagain:
  2877 0000221F E8EAFFFFFF          <1>   call CHKMOUS		; check if a byte is available
  2878 00002224 08DB                <1>   or bl, bl
  2879 00002226 75F7                <1>   jnz .cagain
  2880 00002228 B0AD                <1>   mov  al, 0xad		; Disable Keyboard
  2881 0000222A E664                <1>   out  0x64, al		; write to keyboardcontroller
  2882 0000222C E8A5FFFFFF          <1>   call CHKPRT		; check if command is progressed (demand!)
  2883 00002231 6631C0              <1>   xor  ax, ax
  2884 00002234 E460                <1>   in   al, 0x60		; read ps/2 controller output port (mousebyte)
  2885 00002236 88C2                <1>   mov  dl, al
  2886 00002238 B0AE                <1>   mov  al, 0xae		; Enable Keyboard
  2887 0000223A E664                <1>   out  0x64, al		; write to keyboardcontroller
  2888 0000223C E895FFFFFF          <1>   call CHKPRT		; check if command is progressed (demand!)
  2889 00002241 88D0                <1>   mov  al, dl
  2890 00002243 C3                  <1> ret
  2891                              <1> 
  2892 00002244 00                  <1> LBUTTON db 0x00	;	Left   button status 1=PRESSED 0=RELEASED
  2893 00002245 00                  <1> RBUTTON db 0x00	;	Right  button status 1=PRESSED 0=RELEASED
  2894 00002246 00                  <1> MBUTTON db 0x00	;	Middle button status 1=PRESSED 0=RELEASED
  2895 00002247 00                  <1> XCOORD  db 0x00	;	the moved distance  (horizontal)
  2896 00002248 00                  <1> YCOORD  db 0x00	;	the moved distance  (vertical)
  2897                              <1> 
  2898                              <1> 
  2899                              <1> 	guistartin:
  2900 00002249 B800000000          <1> 		mov eax, 0
  2901 0000224E 66A3[840A0000]      <1> 		mov [lastkey], ax
  2902 00002254 E464                <1> 		in al, 64h ; Status
  2903 00002256 A801                <1> 		test al, 1 ; output buffer full?
  2904 00002258 74EF                <1> 		jz guistartin
  2905 0000225A A820                <1> 		test al, 20h ; PS2-Mouse?
  2906 0000225C 0F85DE000000        <1> 		jnz near maincall2
  2907 00002262 E460                <1> 		in al, 60h
  2908 00002264 88C4                <1> 		mov ah, al
  2909 00002266 B000                <1> 		mov al, 0
  2910 00002268 8825[850A0000]      <1> 		mov [lastkey + 1], ah
  2911 0000226E 88E0                <1> 		mov al, ah
  2912 00002270 BF[84250000]        <1> 		mov edi, scancode
  2913                              <1> 	guisearchscan: 
  2914 00002275 3C40                <1> 		cmp al, 40h
  2915 00002277 7315                <1> 		jae guiscanother
  2916 00002279 B400                <1> 		mov ah, 0
  2917 0000227B D0E0                <1> 		shl al, 1
  2918 0000227D 01C7                <1> 		add edi, eax
  2919 0000227F D0E8                <1> 		shr al, 1
  2920 00002281 8A27                <1> 		mov ah, [edi]
  2921 00002283 80FC00              <1> 		cmp ah, 0
  2922 00002286 7406                <1> 		je guiscanother
  2923 00002288 E964000000          <1> 		jmp guiscanfound
  2924 0000228D 00                  <1> guiupper db 0
  2925                              <1> guiscanother:
  2926 0000228E 88C4                <1> 		mov ah, al
  2927 00002290 B000                <1> 		mov al, 0
  2928 00002292 66A3[840A0000]      <1> 		mov [lastkey], ax
  2929                              <1> 		;cmp ah, 4Dh
  2930                              <1> 		;je near nextimage
  2931 00002298 80FC2A              <1> 		cmp ah, 2Ah
  2932 0000229B 0F8437000000        <1> 		je near guishifton
  2933 000022A1 80FC36              <1> 		cmp ah, 36h
  2934 000022A4 0F842E000000        <1> 		je near guishifton
  2935 000022AA 80FC1C              <1> 		cmp ah, 1Ch
  2936 000022AD 0F843D000000        <1> 		je near guientdown
  2937 000022B3 80FCAA              <1> 		cmp ah, 0AAh
  2938 000022B6 0F8428000000        <1> 		je near guishiftoff
  2939 000022BC 80FCB6              <1> 		cmp ah, 0B6h
  2940 000022BF 0F841F000000        <1> 		je near guishiftoff
  2941 000022C5 80FC3A              <1> 		cmp ah, 3Ah
  2942 000022C8 0F8401000000        <1> 		je near guishift
  2943 000022CE C3                  <1> 		ret
  2944                              <1> 	guishift:
  2945 000022CF A0[8D220000]        <1> 		mov al, [guiupper]
  2946 000022D4 3C01                <1> 		cmp al, 1
  2947 000022D6 730C                <1> 		jae guishiftoff
  2948                              <1> 	guishifton:
  2949 000022D8 C605[8D220000]01    <1> 		mov byte [guiupper], 1
  2950 000022DF E965FFFFFF          <1> 		jmp guistartin
  2951                              <1> 	guishiftoff:
  2952 000022E4 C605[8D220000]00    <1> 		mov byte [guiupper], 0
  2953 000022EB E959FFFFFF          <1> 		jmp guistartin
  2954                              <1> 	guientdown:
  2955 000022F0 C3                  <1> 		ret
  2956                              <1> 	guiscanfound:
  2957 000022F1 81C701000000        <1> 		add edi, 1
  2958 000022F7 803D[8D220000]01    <1> 		cmp byte [guiupper], 1
  2959 000022FE 7306                <1> 		jae uppercasegui
  2960 00002300 81EF01000000        <1> 		sub edi, 1
  2961                              <1> uppercasegui:
  2962 00002306 8A07                <1> 		mov al,[edi]
  2963 00002308 A2[840A0000]        <1> 		mov [lastkey], al
  2964 0000230D C3                  <1> 		ret
  2965                              <1> 		
  2966                              <1> 		
  2967                              <1> 	cursorgui:
  2968 0000230E 803D[14390000]01    <1> 		cmp byte [mouseon], 1
  2969 00002315 0F8425000000        <1> 		je near maincall2
  2970                              <1> 
  2971                              <1> 	initmouse:
  2972 0000231B 803D[A5280000]00    <1> 		cmp byte [guion], 0
  2973 00002322 7405                <1> 		je initmouseterm
  2974 00002324 E849060000          <1> 		call switchmousepos2
  2975                              <1> 	initmouseterm:
  2976 00002329 E89EFEFFFF          <1> 	  	call PS2SET
  2977 0000232E E8C7FEFFFF          <1> 		call ACTMOUS
  2978 00002333 C605[14390000]01    <1> 		mov byte [mouseon],1
  2979 0000233A E8E0FEFFFF          <1> 		call GETB 	;;Get the responce byte of the mouse (like: Hey i am active)
  2980                              <1> 				;;If the bytes are mixed up,
  2981                              <1> 				;;remove this line or add another of this line.
  2982                              <1> 		;call GETB
  2983 0000233F C3                  <1> 	ret
  2984                              <1> 	maincall2:
  2985 00002340 803D[14390000]01    <1> 		  cmp byte [mouseon], 1
  2986 00002347 75D2                <1> 		  jne initmouse
  2987 00002349 E8D1FEFFFF          <1> 		  call GETB
  2988 0000234E 88C3                <1> 		  mov  bl, al
  2989 00002350 80E301              <1> 		  and  bl, 1
  2990 00002353 881D[44220000]      <1> 		  mov  BYTE [LBUTTON], bl
  2991 00002359 88C3                <1> 		  mov  bl, al
  2992 0000235B 80E302              <1> 		  and  bl, 2
  2993 0000235E D0EB                <1> 		  shr  bl, 1
  2994 00002360 881D[45220000]      <1> 		  mov  BYTE [RBUTTON], bl
  2995 00002366 88C3                <1> 		  mov  bl, al
  2996 00002368 80E304              <1> 		  and  bl, 4
  2997 0000236B C0EB02              <1> 		  shr  bl, 2
  2998 0000236E 881D[46220000]      <1> 		  mov  BYTE [MBUTTON], bl
  2999 00002374 E8A6FEFFFF          <1> 		  call GETB
  3000 00002379 A2[47220000]        <1> 		  mov  BYTE [XCOORD], al
  3001 0000237E E89CFEFFFF          <1> 		  call GETB
  3002 00002383 A2[48220000]        <1> 		  mov  BYTE [YCOORD], al
  3003                              <1> 
  3004                              <1> 	showpixelcursor:
  3005 00002388 668B15[E2240000]    <1> 		mov dx, [mousecursorposition]
  3006 0000238F 668B0D[E4240000]    <1> 		mov cx, [mousecursorposition + 2]
  3007 00002396 668915[DE240000]    <1> 		mov [lastmouseposition], dx
  3008 0000239D 66890D[E0240000]    <1> 		mov [lastmouseposition + 2], cx
  3009 000023A4 A0[47220000]        <1> 		mov al, [XCOORD]
  3010 000023A9 3C80                <1> 		cmp al, 128
  3011 000023AB 730C                <1> 		jae subxcoord
  3012 000023AD 00C0                <1> 		add al, al
  3013 000023AF B400                <1> 		mov ah, 0
  3014 000023B1 6601C2              <1> 		add dx, ax
  3015 000023B4 E90B000000          <1> 		jmp subxcoorddn
  3016                              <1> 	subxcoord:
  3017 000023B9 00C0                <1> 		add al, al
  3018 000023BB B300                <1> 		mov bl, 0
  3019 000023BD 28C3                <1> 		sub bl, al
  3020 000023BF B700                <1> 		mov bh, 0
  3021 000023C1 6629DA              <1> 		sub dx, bx
  3022                              <1> 	subxcoorddn:
  3023 000023C4 8A1D[48220000]      <1> 		mov bl, [YCOORD]
  3024 000023CA B000                <1> 		mov al, 0
  3025 000023CC 28D8                <1> 		sub al, bl
  3026 000023CE 3C80                <1> 		cmp al, 128
  3027 000023D0 730A                <1> 		jae subycoord
  3028 000023D2 B400                <1> 		mov ah, 0
  3029 000023D4 6601C1              <1> 		add cx, ax
  3030 000023D7 E909000000          <1> 		jmp subycoorddn
  3031                              <1> 	subycoord:
  3032 000023DC B300                <1> 		mov bl, 0
  3033 000023DE 28C3                <1> 		sub bl, al
  3034 000023E0 B700                <1> 		mov bh, 0
  3035 000023E2 6629D9              <1> 		sub cx, bx
  3036                              <1> 	subycoorddn:
  3037 000023E5 6681FA204E          <1> 		cmp dx, 20000
  3038 000023EA 7604                <1> 		jbe nooriginx2
  3039 000023EC 66BA0000            <1> 		mov dx, 0
  3040                              <1> 	nooriginx2:
  3041 000023F0 6681F9204E          <1> 		cmp cx, 20000
  3042 000023F5 7604                <1> 		jbe nooriginy2
  3043 000023F7 66B90000            <1> 		mov cx, 0
  3044                              <1> 	nooriginy2:
  3045 000023FB 6681FA0000          <1> 		cmp dx, 0
  3046 00002400 7415                <1> 		je nofixxcolumn2
  3047 00002402 663B15[C5360000]    <1> 		cmp dx, [resolutionx2]
  3048 00002409 720C                <1> 		jb nofixxcolumn2
  3049 0000240B 668B15[C5360000]    <1> 		mov dx, [resolutionx2]
  3050 00002412 6681EA0200          <1> 		sub dx, 2
  3051                              <1> 	nofixxcolumn2:
  3052 00002417 6681F90000          <1> 		cmp cx, 0
  3053 0000241C 7415                <1> 		je nofixyrow2
  3054 0000241E 663B0D[C1360000]    <1> 		cmp cx, [resolutiony]
  3055 00002425 720C                <1> 		jb nofixyrow2
  3056 00002427 668B0D[C1360000]    <1> 		mov cx, [resolutiony]
  3057 0000242E 6681E90100          <1> 		sub cx, 1
  3058                              <1> 	nofixyrow2:
  3059 00002433 668915[E2240000]    <1> 		mov [mousecursorposition], dx
  3060 0000243A 66890D[E4240000]    <1> 		mov [mousecursorposition + 2], cx
  3061 00002441 803D[A5280000]00    <1> 		cmp byte [guion], 0
  3062 00002448 0F8498000000        <1> 		je near termmouse
  3063 0000244E E8B6040000          <1> 		call switchmousepos ;;use dragging code to ensure proper icon drag
  3064 00002453 803D[44220000]01    <1> 		cmp byte [LBUTTON], 1
  3065 0000245A 0F848F050000        <1> 		je near clickicon
  3066 00002460 803D[45220000]01    <1> 		cmp byte [RBUTTON], 1
  3067 00002467 0F8482050000        <1> 		je near clickicon
  3068 0000246D A0[DC290000]        <1> 		mov al, [pbutton]
  3069 00002472 C705[DF290000]0000- <1> 		mov dword [dragging], 0
  3070 0000247A 0000                <1>
  3071 0000247C 3C00                <1> 		cmp al, 0
  3072 0000247E 740F                <1> 		je nopreviousbutton
  3073 00002480 E821040000          <1> 		call clearmousecursor
  3074 00002485 E8990A0000          <1> 		call reloadallgraphics
  3075 0000248A E8E3040000          <1> 		call switchmousepos2
  3076                              <1> 	nopreviousbutton:
  3077 0000248F B000                <1> 		mov al, 0
  3078 00002491 A2[DC290000]        <1> 		mov [pbutton], al
  3079 00002496 A0[44220000]        <1> 		mov al, [LBUTTON]
  3080 0000249B A2[DD290000]        <1> 		mov [pLBUTTON], al
  3081 000024A0 A0[45220000]        <1> 		mov al, [RBUTTON]
  3082 000024A5 A2[DE290000]        <1> 		mov [pRBUTTON], al
  3083 000024AA B900000000          <1> 		mov ecx, 0
  3084 000024AF BA00000000          <1> 		mov edx, 0
  3085 000024B4 668B15[E2240000]    <1> 		mov dx, [mousecursorposition]
  3086 000024BB 668B0D[E4240000]    <1> 		mov cx, [mousecursorposition + 2]
  3087 000024C2 66BB9CE7            <1> 		mov bx, 1110011110011100b
  3088 000024C6 B400                <1> 		mov ah, 0
  3089 000024C8 B080                <1> 		mov al, 128
  3090 000024CA C605[A2280000]01    <1> 		mov byte [showcursorfonton], 1
  3091 000024D1 E8FF110000          <1> 		call showfontvesa
  3092 000024D6 C605[A2280000]00    <1> 		mov byte [showcursorfonton], 0
  3093 000024DD C3                  <1> 		ret
  3094                              <1> 
  3095 000024DE 84008400            <1> lastmouseposition dw 132,132
  3096 000024E2 84008400            <1> mousecursorposition dw 132,132	
  3097                              <1> 
  3098                              <1> termmouse:
  3099 000024E6 C3                  <1> 	ret	;;lets try this later
  3100 000024E7 BE[850C0000]        <1> 		mov esi, videobuf2
  3101 000024EC BA00000000          <1> 		mov edx, 0
  3102 000024F1 668B15[DE240000]    <1> 		mov dx, [lastmouseposition]
  3103 000024F8 668B0D[E0240000]    <1> 		mov cx, [lastmouseposition + 2]
  3104 000024FF 66A1[82250000]      <1> 		mov ax, [cursorcache]
  3105 00002505 663D0000            <1> 		cmp ax, 0
  3106 00002509 7426                <1> 		je nocopycursorcache
  3107 0000250B 66C1E104            <1> 		shl cx, 4
  3108 0000250F 66C1E203            <1> 		shl dx, 3
  3109 00002513 01D6                <1> 		add esi, edx
  3110 00002515 66BA0000            <1> 		mov dx, 0
  3111 00002519 8A15[F5080000]      <1> 		mov dl, [charxy]
  3112 0000251F 6641                <1> 		inc cx
  3113                              <1> termmousecplp1:
  3114 00002521 01D6                <1> 		add esi, edx
  3115 00002523 6649                <1> 		dec cx
  3116 00002525 6681F90000          <1> 		cmp cx, 0
  3117 0000252A 75F5                <1> 		jne termmousecplp1
  3118 0000252C 29D6                <1> 		sub esi, edx
  3119 0000252E 668906              <1> 		mov [esi], ax
  3120                              <1> nocopycursorcache:
  3121 00002531 BE[850C0000]        <1> 		mov esi, videobuf2
  3122 00002536 BA00000000          <1> 		mov edx, 0
  3123 0000253B 668B15[E2240000]    <1> 		mov dx, [mousecursorposition]
  3124 00002542 668B0D[E4240000]    <1> 		mov cx, [mousecursorposition + 2]
  3125 00002549 66C1E104            <1> 		shl cx, 4
  3126 0000254D 66C1E203            <1> 		shl dx, 3
  3127 00002551 01D6                <1> 		add esi, edx
  3128 00002553 66BA0000            <1> 		mov dx, 0
  3129 00002557 8A15[F5080000]      <1> 		mov dl, [charxy]
  3130 0000255D 6641                <1> 		inc cx
  3131                              <1> termmousecplp2:
  3132 0000255F 01D6                <1> 		add esi, edx
  3133 00002561 6649                <1> 		dec cx
  3134 00002563 6681F90000          <1> 		cmp cx, 0
  3135 00002568 75F5                <1> 		jne termmousecplp2
  3136 0000256A 29D6                <1> 		sub esi, edx
  3137 0000256C 668B06              <1> 		mov ax, [esi]
  3138 0000256F 66A3[82250000]      <1> 		mov [cursorcache], ax
  3139 00002575 B080                <1> 		mov al, 128
  3140 00002577 B407                <1> 		mov ah, 7
  3141 00002579 668906              <1> 		mov [esi], ax
  3142 0000257C E826E6FFFF          <1> 		call termcopy
  3143 00002581 C3                  <1> 		ret
  3144 00002582 0000                <1> cursorcache db 0,0
  3145                              <1> 	
  3146                              <1> scancode:
  3147 00002584 0000                <1> 	db 0,0		;,0h
  3148 00002586 0000                <1> 	db 0,0		;,1h
  3149 00002588 3121                <1> 	db '1','!'	;,2h
  3150 0000258A 3240                <1> 	db '2','@'	;,3h
  3151 0000258C 3323                <1> 	db '3','#'	;,4h
  3152 0000258E 3424                <1> 	db '4','$'	;,5h
  3153 00002590 3525                <1> 	db '5','%'	;,6h
  3154 00002592 365E                <1> 	db '6','^'	;,7h
  3155 00002594 3726                <1> 	db '7','&'	;,8h
  3156 00002596 382A                <1> 	db '8','*'	;,9h
  3157 00002598 3928                <1> 	db '9','('	;,0Ah
  3158 0000259A 3029                <1> 	db '0',')'	;,0Bh
  3159 0000259C 2D5F                <1> 	db '-','_'	;,0Ch
  3160 0000259E 3D2B                <1> 	db '=','+'	;,0Dh
  3161 000025A0 0808                <1> 	db 8,8		;,0Eh
  3162 000025A2 0000                <1> 	db 0,0		;,0Fh
  3163 000025A4 7151                <1> 	db 'q','Q'	;,10h
  3164 000025A6 7757                <1> 	db 'w','W'	;,11h
  3165 000025A8 6545                <1> 	db 'e','E'	;,12h
  3166 000025AA 7252                <1> 	db 'r','R'	;,13h
  3167 000025AC 7454                <1> 	db 't','T'	;,14h
  3168 000025AE 7959                <1> 	db 'y','Y'	;,15h
  3169 000025B0 7555                <1> 	db 'u','U'	;,16h
  3170 000025B2 6949                <1> 	db 'i','I'	;,17h
  3171 000025B4 6F4F                <1> 	db 'o','O'	;,18h
  3172 000025B6 7050                <1> 	db 'p','P'	;,19h
  3173 000025B8 5B7B                <1> 	db '[','{'	;,1Ah
  3174 000025BA 5D7D                <1> 	db ']','}'	;,1Bh
  3175 000025BC 0000                <1> 	db 0,0		;,1Ch
  3176 000025BE 0000                <1> 	db 0,0		;,1Dh
  3177 000025C0 6141                <1> 	db 'a','A'	;,1Eh
  3178 000025C2 7353                <1> 	db 's','S'	;,1Fh
  3179 000025C4 6444                <1> 	db 'd','D'	;,20h
  3180 000025C6 6646                <1> 	db 'f','F'	;,21h
  3181 000025C8 6747                <1> 	db 'g','G'	;,22h
  3182 000025CA 6848                <1> 	db 'h','H'	;,23h
  3183 000025CC 6A4A                <1> 	db 'j','J'	;,24h
  3184 000025CE 6B4B                <1> 	db 'k','K'	;,25h
  3185 000025D0 6C4C                <1> 	db 'l','L'	;,26h
  3186 000025D2 3B3A                <1> 	db ';',':'	;,27h
  3187 000025D4 2722                <1> 	db 27h,22h	;,28h
  3188 000025D6 607E                <1> 	db '`','~'	;,29h
  3189 000025D8 0000                <1> 	db 0,0		;,2Ah
  3190 000025DA 5C7C                <1> 	db '\','|'	;,2Bh
  3191 000025DC 7A5A                <1> 	db 'z','Z'	;,2Ch
  3192 000025DE 7858                <1> 	db 'x','X'	;,2Dh
  3193 000025E0 6343                <1> 	db 'c','C'	;,2Eh
  3194 000025E2 7656                <1> 	db 'v','V'	;,2Fh
  3195 000025E4 6242                <1> 	db 'b','B'	;,30h
  3196 000025E6 6E4E                <1> 	db 'n','N'	;,31h
  3197 000025E8 6D4D                <1> 	db 'm','M'	;,32h
  3198 000025EA 2C3C                <1> 	db ',','<'	;,33h
  3199 000025EC 2E3E                <1> 	db '.','>'	;,34h
  3200 000025EE 2F3F                <1> 	db '/','?'	;,35h
  3201 000025F0 0000                <1> 	db 0,0		;,36h
  3202 000025F2 0000                <1> 	db 0,0		;,37h
  3203 000025F4 0000                <1> 	db 0,0		;,38h
  3204 000025F6 2020                <1> 	db ' ',' '	;,39h
  3205                              <1> noscan:
  3206                                      %include 'source/gui.asm'
  3207                              <1> guiclear:
  3208 000025F8 8B3D[35220000]      <1> 	mov edi, [physbaseptr]
  3209 000025FE 668B15[C3360000]    <1> 	mov dx, [resolutionx]
  3210 00002605 668B0D[C1360000]    <1> 	mov cx, [resolutiony]
  3211 0000260C 66A1[35260000]      <1> 	mov ax, [background]
  3212                              <1> guiclearloop:
  3213 00002612 668907              <1> 	mov [edi], ax
  3214 00002615 81C702000000        <1> 	add edi, 2
  3215 0000261B 664A                <1> 	dec dx
  3216 0000261D 6681FA0000          <1> 	cmp dx, 0
  3217 00002622 77EE                <1> 	ja guiclearloop
  3218 00002624 6649                <1> 	dec cx
  3219 00002626 668B15[C3360000]    <1> 	mov dx, [resolutionx]
  3220 0000262D 6681F90000          <1> 	cmp cx, 0
  3221 00002632 77DE                <1> 	ja guiclearloop
  3222 00002634 C3                  <1> 	ret
  3223                              <1> 
  3224 00002635 CF7B                <1> background dw 0111101111001111b
  3225                              <1> 
  3226                              <1> gui:	;Let's see what I can do
  3227                              <1> 	;I am going to try to make this as freestanding as possible
  3228 00002637 E85FECFFFF          <1> 	call indexfiles
  3229 0000263C 8B3D[35220000]      <1> 	mov edi, [physbaseptr]
  3230 00002642 668B15[C3360000]    <1> 	mov dx, [resolutionx]
  3231 00002649 668B0D[C1360000]    <1> 	mov cx, [resolutiony]
  3232 00002650 668B1D[35260000]    <1> 	mov bx, [background]
  3233                              <1> guiclearloop2:
  3234 00002657 66891F              <1> 	mov [edi], bx
  3235 0000265A 81C702000000        <1> 	add edi, 2
  3236 00002660 664A                <1> 	dec dx
  3237 00002662 6681FA0000          <1> 	cmp dx, 0
  3238 00002667 77EE                <1> 	ja guiclearloop2
  3239 00002669 6649                <1> 	dec cx
  3240 0000266B 668B15[C3360000]    <1> 	mov dx, [resolutionx]
  3241 00002672 6681F90000          <1> 	cmp cx, 0
  3242 00002677 77DE                <1> 	ja guiclearloop2
  3243 00002679 C605[A5280000]01    <1> 	mov byte [guion], 1
  3244 00002680 B800000000          <1> 	mov eax, 0
  3245 00002685 BB00000000          <1> 	mov ebx, 0
  3246 0000268A B900000000          <1> 	mov ecx, 0
  3247 0000268F BA00000000          <1> 	mov edx, 0
  3248                              <1> 	
  3249 00002694 BE[29390000]        <1> 	mov esi, pacmsg
  3250 00002699 66B80000            <1> 	mov ax, 0
  3251 0000269D BB00000000          <1> 	mov ebx, 0
  3252 000026A2 66B90200            <1> 	mov cx, 2
  3253 000026A6 66BA0400            <1> 	mov dx, 4
  3254 000026AA E8BA0B0000          <1> 	call showstring
  3255                              <1> 	
  3256 000026AF BE[3F3A0000]        <1> 	mov esi, interneticon
  3257 000026B4 66B80000            <1> 	mov ax, 0
  3258 000026B8 BB[9E390000]        <1> 	mov ebx, noie
  3259 000026BD 66B91800            <1> 	mov cx, 24
  3260 000026C1 66BA0400            <1> 	mov dx, 4
  3261 000026C5 E81E0F0000          <1> 	call showicon
  3262                              <1> 	
  3263 000026CA BE[C13A0000]        <1> 	mov esi, wordicon
  3264 000026CF 66B80000            <1> 	mov ax, 0
  3265 000026D3 BB00000000          <1> 	mov ebx, 0
  3266 000026D8 66B91800            <1> 	mov cx, 24
  3267 000026DC 66BA3000            <1> 	mov dx, 48
  3268 000026E0 E8030F0000          <1> 	call showicon
  3269                              <1> 	
  3270 000026E5 BE[433B0000]        <1> 	mov esi, pacmanpellet
  3271 000026EA 66B80000            <1> 	mov ax, 0
  3272 000026EE BB00000000          <1> 	mov ebx, 0
  3273 000026F3 66B94000            <1> 	mov cx, 64
  3274 000026F7 66BA0400            <1> 	mov dx, 4
  3275 000026FB E8E80E0000          <1> 	call showicon
  3276                              <1> 	
  3277 00002700 BE[473C0000]        <1> 	mov esi, pacman
  3278 00002705 66B80000            <1> 	mov ax, 0
  3279 00002709 BB[83390000]        <1> 	mov ebx, pacmannomnom
  3280 0000270E 66B94000            <1> 	mov cx, 64
  3281 00002712 66BA3000            <1> 	mov dx, 48
  3282 00002716 E8CD0E0000          <1> 	call showicon
  3283                              <1> 	
  3284 0000271B BE[C53B0000]        <1> 	mov esi, ghostie
  3285 00002720 66B80000            <1> 	mov ax, 0
  3286 00002724 BB[68390000]        <1> 	mov ebx, boo
  3287 00002729 66B96C00            <1> 	mov cx, 108
  3288 0000272D 66BA0400            <1> 	mov dx, 4
  3289 00002731 E8B20E0000          <1> 	call showicon
  3290                              <1> 
  3291 00002736 BE[15390000]        <1> 	mov esi, start
  3292 0000273B 668B0D[C1360000]    <1> 	mov cx, [resolutiony]
  3293 00002742 6681E91000          <1> 	sub cx, 16
  3294 00002747 66BA0200            <1> 	mov dx, 2
  3295 0000274B B400                <1> 	mov ah, 0
  3296 0000274D B010                <1> 	mov al, 00010000b
  3297 0000274F BB[EC390000]        <1> 	mov ebx, winblows
  3298 00002754 E8100B0000          <1> 	call showstring
  3299                              <1> 	
  3300 00002759 E8B0FBFFFF          <1> 	call cursorgui
  3301                              <1> guistart:
  3302 0000275E E8E6FAFFFF          <1> 	call guistartin
  3303 00002763 C605[9E280000]00    <1> 	mov byte [copygui], 0
  3304 0000276A EBF2                <1> 	jmp guistart
  3305                              <1> 	
  3306                              <1> guicopy:	;;for double buffering
  3307 0000276C C605[9E280000]01    <1> 	mov byte [copygui], 1
  3308 00002773 8B3D[39220000]      <1> 	mov edi, [offscreenmemoffset]
  3309 00002779 BA00000000          <1> 	mov edx, 0
  3310 0000277E B900000000          <1> 	mov ecx, 0
  3311 00002783 668B15[E2240000]    <1> 	mov dx, [mousecursorposition]
  3312 0000278A 668B0D[E4240000]    <1> 	mov cx, [mousecursorposition + 2]
  3313 00002791 01D7                <1> 	add edi, edx
  3314 00002793 668B15[C5360000]    <1> 	mov dx, [resolutionx2]
  3315 0000279A 6641                <1> 	inc cx
  3316                              <1> guicp2:
  3317 0000279C 01D7                <1> 	add edi, edx
  3318 0000279E 6649                <1> 	dec cx
  3319 000027A0 6681F90000          <1> 	cmp cx, 0
  3320 000027A5 75F5                <1> 	jne guicp2
  3321 000027A7 29D7                <1> 	sub edi, edx
  3322 000027A9 893D[71280000]      <1> 	mov [cursorloc], edi
  3323 000027AF BB[51490000]        <1> 	mov ebx, cursorbmp
  3324 000027B4 668B0D[C1360000]    <1> 	mov cx, [resolutiony]
  3325 000027BB C1C110              <1> 	rol ecx, 16
  3326 000027BE 668B0D[C3360000]    <1> 	mov cx, [resolutionx]
  3327 000027C5 8B35[35220000]      <1> 	mov esi, [physbaseptr]
  3328 000027CB 8B3D[39220000]      <1> 	mov edi, [offscreenmemoffset]
  3329                              <1> guicp1:
  3330 000027D1 668B06              <1> 	mov ax, [esi]
  3331 000027D4 668907              <1> 	mov [edi], ax
  3332 000027D7 81C602000000        <1> 	add esi, 2
  3333 000027DD 81C702000000        <1> 	add edi, 2
  3334 000027E3 3B3D[71280000]      <1> 	cmp edi, [cursorloc]
  3335 000027E9 7427                <1> 	je copycursor
  3336                              <1> dncopycursor:
  3337 000027EB 6649                <1> 	dec cx
  3338 000027ED 6681F90000          <1> 	cmp cx, 0
  3339 000027F2 75DD                <1> 	jne guicp1
  3340 000027F4 668B0D[C3360000]    <1> 	mov cx, [resolutionx]
  3341 000027FB C1C110              <1> 	rol ecx, 16
  3342 000027FE 6649                <1> 	dec cx
  3343 00002800 6681F90000          <1> 	cmp cx, 0
  3344 00002805 C1C110              <1> 	rol ecx, 16
  3345 00002808 75C7                <1> 	jne guicp1
  3346 0000280A C605[9E280000]00    <1> 	mov byte [copygui], 0
  3347 00002811 C3                  <1> 	ret
  3348                              <1> copycursor:
  3349 00002812 81FB[D1490000]      <1> 	cmp ebx, cursorbmpend
  3350 00002818 73D1                <1> 	jae dncopycursor
  3351 0000281A 668B15[C5360000]    <1> 	mov dx, [resolutionx2]
  3352 00002821 01D7                <1> 	add edi, edx
  3353 00002823 893D[71280000]      <1> 	mov [cursorloc], edi
  3354 00002829 29D7                <1> 	sub edi, edx
  3355 0000282B 4B                  <1> 	dec ebx
  3356 0000282C 81EF02000000        <1> 	sub edi, 2
  3357 00002832 81EE02000000        <1> 	sub esi, 2
  3358 00002838 66BA0900            <1> 	mov dx, 9
  3359                              <1> curscplp:
  3360 0000283C 43                  <1> 	inc ebx
  3361 0000283D 81C602000000        <1> 	add esi, 2
  3362 00002843 81C702000000        <1> 	add edi, 2
  3363 00002849 668B06              <1> 	mov ax, [esi]
  3364 0000284C 668907              <1> 	mov [edi], ax
  3365 0000284F 8A03                <1> 	mov al, [ebx]
  3366 00002851 3C00                <1> 	cmp al, 0
  3367 00002853 7405                <1> 	je curscplp2
  3368 00002855 66C7079CE7          <1> 	mov word [edi], 1110011110011100b
  3369                              <1> curscplp2:
  3370 0000285A 6649                <1> 	dec cx
  3371 0000285C 6681F90000          <1> 	cmp cx, 0
  3372 00002861 7488                <1> 	je dncopycursor
  3373 00002863 664A                <1> 	dec dx
  3374 00002865 6681FA0000          <1> 	cmp dx, 0
  3375 0000286A 75D0                <1> 	jne curscplp
  3376 0000286C E97AFFFFFF          <1> 	jmp dncopycursor
  3377                              <1> 	
  3378                              <1> 	
  3379 00002871 00000000            <1> cursorloc: dd 0
  3380                              <1> 		
  3381                              <1> nextimage:	
  3382 00002875 E87EFDFFFF          <1> 	call guiclear
  3383 0000287A 8B35[0C390000]      <1> 	mov esi, [bmpend]
  3384 00002880 B800000000          <1> 	mov eax, 0
  3385 00002885 BB00000000          <1> 	mov ebx, 0
  3386 0000288A B900000000          <1> 	mov ecx, 0
  3387 0000288F BA00000000          <1> 	mov edx, 0
  3388 00002894 E8D70F0000          <1> 	call showbmp
  3389 00002899 E9ABF9FFFF          <1> 	jmp guistartin
  3390                              <1> 		
  3391 0000289E 00                  <1> copygui db 0
  3392 0000289F 00                  <1> graphicsset db 0
  3393 000028A0 0000                <1> graphicspos db 0,0
  3394 000028A2 00                  <1> showcursorfonton db 0
  3395 000028A3 00                  <1> savefonton db 0
  3396 000028A4 00                  <1> mouseselecton db 0
  3397 000028A5 00                  <1> guion db 0
  3398                              <1> 
  3399                              <1> 		
  3400                              <1> clearmousecursor:
  3401 000028A6 BE[35260000]        <1> 		mov esi, background
  3402 000028AB 8B3D[35220000]      <1> 		mov edi, [physbaseptr]
  3403 000028B1 BA00000000          <1> 		mov edx, 0
  3404 000028B6 B900000000          <1> 		mov ecx, 0
  3405 000028BB 668B15[DE240000]    <1> 		mov dx, [lastmouseposition]
  3406 000028C2 668B0D[E0240000]    <1> 		mov cx, [lastmouseposition + 2]
  3407 000028C9 01D7                <1> 		add edi, edx
  3408 000028CB BA00000000          <1> 		mov edx, 0
  3409 000028D0 668B15[C5360000]    <1> 		mov dx, [resolutionx2]
  3410 000028D7 6681F90000          <1> 		cmp cx, 0
  3411 000028DC 740B                <1> 		je noyclr
  3412 000028DE 01D7                <1> yclr:	add edi, edx
  3413 000028E0 6649                <1> 		dec cx
  3414 000028E2 6681F90000          <1> 		cmp cx, 0
  3415 000028E7 75F5                <1> 		jne yclr
  3416 000028E9 668B06              <1> noyclr:	mov ax, [esi]
  3417 000028EC C1C010              <1> 		rol eax, 16
  3418 000028EF 668B06              <1> 		mov ax, [esi]
  3419 000028F2 8907                <1> 		mov [edi], eax
  3420 000028F4 894704              <1> 		mov [edi + 4], eax
  3421 000028F7 894708              <1> 		mov [edi + 8], eax
  3422 000028FA 89470C              <1> 		mov [edi + 12], eax
  3423 000028FD 01D7                <1> 		add edi, edx
  3424 000028FF 6641                <1> 		inc cx
  3425 00002901 6681F91000          <1> 		cmp cx, 16
  3426 00002906 72E1                <1> 		jb noyclr
  3427 00002908 C3                  <1> 		ret
  3428                              <1> 
  3429                              <1> switchmousepos:		;;switch were the mouse is located
  3430 00002909 BE[00020000]        <1> 		mov esi, mousecolorbuf
  3431 0000290E 8B3D[35220000]      <1> 		mov edi, [physbaseptr]
  3432 00002914 BA00000000          <1> 		mov edx, 0
  3433 00002919 B900000000          <1> 		mov ecx, 0
  3434 0000291E 668B15[DE240000]    <1> 		mov dx, [lastmouseposition]
  3435 00002925 668B0D[E0240000]    <1> 		mov cx, [lastmouseposition + 2]
  3436 0000292C 01D7                <1> 		add edi, edx
  3437 0000292E BA00000000          <1> 		mov edx, 0
  3438 00002933 668B15[C5360000]    <1> 		mov dx, [resolutionx2]
  3439 0000293A 6681F90000          <1> 		cmp cx, 0
  3440 0000293F 740B                <1> 		je noswmsy
  3441 00002941 01D7                <1> swmsy:		add edi, edx
  3442 00002943 6649                <1> 		dec cx
  3443 00002945 6681F90000          <1> 		cmp cx, 0
  3444 0000294A 75F5                <1> 		jne swmsy
  3445 0000294C 8B06                <1> noswmsy:	mov eax, [esi]
  3446 0000294E 8B5E04              <1> 		mov ebx, [esi + 4]
  3447 00002951 8907                <1> 		mov [edi], eax
  3448 00002953 895F04              <1> 		mov [edi + 4], ebx
  3449 00002956 8B4608              <1> 		mov eax, [esi + 8]
  3450 00002959 8B5E0C              <1> 		mov ebx, [esi + 12]
  3451 0000295C 894708              <1> 		mov [edi + 8], eax
  3452 0000295F 895F0C              <1> 		mov [edi + 12], ebx
  3453 00002962 01D7                <1> 		add edi, edx
  3454 00002964 81C610000000        <1> 		add esi, 16
  3455 0000296A 81FE[00030000]      <1> 		cmp esi, mcolorend
  3456 00002970 72DA                <1> 		jb noswmsy
  3457                              <1> 		
  3458                              <1> switchmousepos2:
  3459 00002972 BE[00020000]        <1> 		mov esi, mousecolorbuf
  3460 00002977 8B3D[35220000]      <1> 		mov edi, [physbaseptr]
  3461 0000297D BA00000000          <1> 		mov edx, 0
  3462 00002982 B900000000          <1> 		mov ecx, 0
  3463 00002987 668B15[E2240000]    <1> 		mov dx, [mousecursorposition]
  3464 0000298E 668B0D[E4240000]    <1> 		mov cx, [mousecursorposition + 2]
  3465 00002995 01D7                <1> 		add edi, edx
  3466 00002997 BA00000000          <1> 		mov edx, 0
  3467 0000299C 668B15[C5360000]    <1> 		mov dx, [resolutionx2]
  3468 000029A3 6681F90000          <1> 		cmp cx, 0
  3469 000029A8 740B                <1> 		je noswmsy2
  3470 000029AA 01D7                <1> swmsy2:		add edi, edx
  3471 000029AC 6649                <1> 		dec cx
  3472 000029AE 6681F90000          <1> 		cmp cx, 0
  3473 000029B3 75F5                <1> 		jne swmsy2
  3474 000029B5 8B07                <1> noswmsy2:	mov eax, [edi]
  3475 000029B7 8B5F04              <1> 		mov ebx, [edi + 4]
  3476 000029BA 8906                <1> 		mov [esi], eax
  3477 000029BC 895E04              <1> 		mov [esi + 4], ebx
  3478 000029BF 8B4708              <1> 		mov eax, [edi + 8]
  3479 000029C2 8B5F0C              <1> 		mov ebx, [edi + 12]
  3480 000029C5 894608              <1> 		mov [esi + 8], eax
  3481 000029C8 895E0C              <1> 		mov [esi + 12], ebx
  3482 000029CB 01D7                <1> 		add edi, edx
  3483 000029CD 81C610000000        <1> 		add esi, 16
  3484 000029D3 81FE[00030000]      <1> 		cmp esi, mcolorend
  3485 000029D9 72DA                <1> 		jb noswmsy2
  3486 000029DB C3                  <1> 		ret
  3487                              <1> 
  3488 000029DC 00                  <1> pbutton db 0
  3489 000029DD 00                  <1> pLBUTTON db 0
  3490 000029DE 00                  <1> pRBUTTON db 0
  3491 000029DF 00000000            <1> dragging dw 0,0
  3492 000029E3 0000000000000000    <1> lastpos dw 0,0,0,0
  3493 000029EB 00000000            <1> colorbuf dw 0,0
  3494                              <1> 	
  3495                              <1> 	clickicon:
  3496 000029EF B001                <1> 		mov al, 1
  3497 000029F1 A2[DC290000]        <1> 		mov [pbutton], al
  3498 000029F6 A0[DD290000]        <1> 		mov al, [pLBUTTON]
  3499 000029FB 2205[44220000]      <1> 		and al, [LBUTTON]
  3500 00002A01 8A25[DE290000]      <1> 		mov ah, [pRBUTTON]
  3501 00002A07 2225[45220000]      <1> 		and ah, [RBUTTON]
  3502 00002A0D 08E0                <1> 		or al, ah
  3503 00002A0F 3C00                <1> 		cmp al, 0
  3504 00002A11 741B                <1> 		je nodragclick
  3505 00002A13 813D[DF290000]0100- <1> 		cmp dword [dragging], 1
  3506 00002A1B 0000                <1>
  3507 00002A1D 732D                <1> 		jae dragclick
  3508 00002A1F C705[DF290000]0100- <1> 		mov dword [dragging], 1
  3509 00002A27 0000                <1>
  3510 00002A29 E91E000000          <1> 		jmp dragclick
  3511                              <1> 	nodragclick:
  3512 00002A2E C705[DF290000]0000- <1> 		mov dword [dragging], 0
  3513 00002A36 0000                <1>
  3514 00002A38 A0[44220000]        <1> 		mov al, [LBUTTON]
  3515 00002A3D A2[DD290000]        <1> 		mov [pLBUTTON], al
  3516 00002A42 A0[45220000]        <1> 		mov al, [RBUTTON]
  3517 00002A47 A2[DE290000]        <1> 		mov [pRBUTTON], al
  3518                              <1> 	dragclick:
  3519 00002A4C 66B80000            <1> 		mov ax, 0
  3520 00002A50 BE[00000000]        <1> 		mov esi, graphicstable
  3521 00002A55 C705[63390000]0000- <1> 		mov dword [codepointer], 0
  3522 00002A5D 0000                <1>
  3523                              <1> 	clicon2:
  3524 00002A5F BA00000000          <1> 		mov edx, 0
  3525 00002A64 B900000000          <1> 		mov ecx, 0
  3526 00002A69 66813E0100          <1> 		cmp word [esi], 1
  3527 00002A6E 0F841B000000        <1> 		je near iconselect
  3528 00002A74 66813E0200          <1> 		cmp word [esi], 2
  3529 00002A79 0F8472010000        <1> 		je near textselected
  3530 00002A7F 66813E0300          <1> 		cmp word [esi], 3
  3531 00002A84 0F84C7020000        <1> 		je near windowselect
  3532 00002A8A E901040000          <1> 		jmp nexticonsel
  3533                              <1> 	iconselect:
  3534 00002A8F 668B5606            <1> 		mov dx, [esi + 6]
  3535 00002A93 6689D0              <1> 		mov ax, dx
  3536 00002A96 668B4E08            <1> 		mov cx, [esi + 8]
  3537 00002A9A 6689CB              <1> 		mov bx, cx
  3538 00002A9D 6681C32000          <1> 		add bx, 32
  3539 00002AA2 6601D0              <1> 		add ax, dx
  3540 00002AA5 813D[DF290000]0100- <1> 		cmp dword [dragging], 1
  3541 00002AAD 0000                <1>
  3542 00002AAF 746F                <1> 		je dragicon
  3543 00002AB1 813D[DF290000]0000- <1> 		cmp dword [dragging], 0
  3544 00002AB9 0000                <1>
  3545 00002ABB 7411                <1> 		je nodragiconcheck
  3546 00002ABD 3935[DF290000]      <1> 		cmp dword [dragging], esi
  3547 00002AC3 0F85C7030000        <1> 		jne near nexticonsel
  3548 00002AC9 E952000000          <1> 		jmp dragicon
  3549                              <1> 	nodragiconcheck:
  3550 00002ACE 663905[E2240000]    <1> 		cmp [mousecursorposition], ax
  3551 00002AD5 0F82B5030000        <1> 		jb near nexticonsel
  3552 00002ADB 66054000            <1> 		add ax, 64
  3553 00002ADF 663905[E2240000]    <1> 		cmp [mousecursorposition], ax
  3554 00002AE6 0F87A4030000        <1> 		ja near nexticonsel
  3555 00002AEC 6629D0              <1> 		sub ax, dx
  3556 00002AEF 66390D[E4240000]    <1> 		cmp [mousecursorposition + 2], cx
  3557 00002AF6 0F8294030000        <1> 		jb near nexticonsel
  3558 00002AFC 66391D[E4240000]    <1> 		cmp [mousecursorposition + 2], bx
  3559 00002B03 0F8787030000        <1> 		ja near nexticonsel
  3560 00002B09 668B460A            <1> 		mov ax, [esi + 10]
  3561 00002B0D 66250100            <1> 		and ax, 1
  3562 00002B11 663D0100            <1> 		cmp ax, 1
  3563 00002B15 0F84B6000000        <1> 		je near unselecticon
  3564 00002B1B E98D000000          <1> 		jmp nodragicon
  3565                              <1> 	dragicon:
  3566 00002B20 663905[DE240000]    <1> 		cmp [lastmouseposition], ax
  3567 00002B27 0F8263030000        <1> 		jb near nexticonsel
  3568 00002B2D 66054000            <1> 		add ax, 64
  3569 00002B31 663905[DE240000]    <1> 		cmp [lastmouseposition], ax
  3570 00002B38 0F8752030000        <1> 		ja near nexticonsel
  3571 00002B3E 6629D0              <1> 		sub ax, dx
  3572 00002B41 66390D[E0240000]    <1> 		cmp [lastmouseposition + 2], cx
  3573 00002B48 0F8242030000        <1> 		jb near nexticonsel
  3574 00002B4E 66391D[E0240000]    <1> 		cmp [lastmouseposition + 2], bx
  3575 00002B55 0F8735030000        <1> 		ja near nexticonsel
  3576 00002B5B 668B460A            <1> 		mov ax, [esi + 10]
  3577 00002B5F 2410                <1> 		and al, 00010000b
  3578 00002B61 3C10                <1> 		cmp al, 00010000b
  3579 00002B63 7448                <1> 		je nodragicon
  3580 00002B65 8935[DF290000]      <1> 		mov [dragging], esi
  3581 00002B6B 66D1E2              <1> 		shl dx, 1
  3582 00002B6E 662B15[DE240000]    <1> 		sub dx, [lastmouseposition]
  3583 00002B75 660315[E2240000]    <1> 		add dx, [mousecursorposition]
  3584 00002B7C 66D1EA              <1> 		shr dx, 1
  3585 00002B7F 66030D[E4240000]    <1> 		add cx, [mousecursorposition + 2]
  3586 00002B86 662B0D[E0240000]    <1> 		sub cx, [lastmouseposition + 2]
  3587 00002B8D 663B15[C5360000]    <1> 		cmp dx, [resolutionx2]
  3588 00002B94 7607                <1> 		jbe chkyresdrgicn
  3589 00002B96 668B15[E2240000]    <1> 		mov dx, [mousecursorposition]
  3590                              <1> 	chkyresdrgicn:
  3591 00002B9D 663B0D[C1360000]    <1> 		cmp cx, [resolutiony]
  3592 00002BA4 7607                <1> 		jbe nodragicon
  3593 00002BA6 668B0D[E4240000]    <1> 		mov cx, [mousecursorposition + 2]
  3594                              <1> 	nodragicon:
  3595 00002BAD 66814E0A0100        <1> 		or word [esi + 10], 1
  3596 00002BB3 8B5E0C              <1> 		mov ebx, [esi + 12]
  3597 00002BB6 668B460A            <1> 		mov ax, [esi + 10]
  3598 00002BBA 8B7602              <1> 		mov esi, [esi + 2]
  3599 00002BBD C705[63390000]0000- <1> 		mov dword [codepointer], 0
  3600 00002BC5 0000                <1>
  3601 00002BC7 E81C0A0000          <1> 		call showicon
  3602 00002BCC E9D8020000          <1> 		jmp doneiconsel
  3603                              <1> 	unselecticon:
  3604 00002BD1 6681660AFEFF        <1> 		and word [esi + 10], 0xFFFE
  3605 00002BD7 8B5E0C              <1> 		mov ebx, [esi + 12]
  3606 00002BDA 668B460A            <1> 		mov ax, [esi + 10]
  3607 00002BDE 8B7602              <1> 		mov esi, [esi + 2]
  3608 00002BE1 891D[63390000]      <1> 		mov [codepointer], ebx
  3609 00002BE7 E8FC090000          <1> 		call showicon
  3610 00002BEC E9B8020000          <1> 		jmp doneiconsel
  3611                              <1> 	textselected:
  3612 00002BF1 8B5E02              <1> 		mov ebx, [esi + 2]
  3613 00002BF4 668B5606            <1> 		mov dx, [esi + 6]
  3614 00002BF8 6689D0              <1> 		mov ax, dx
  3615 00002BFB 668B4E08            <1> 		mov cx, [esi + 8]
  3616                              <1> 	lengthtesttext:
  3617 00002BFF 803B00              <1> 		cmp byte [ebx], 0
  3618 00002C02 7407                <1> 		je donetesttextlength
  3619 00002C04 43                  <1> 		inc ebx
  3620 00002C05 66051000            <1> 		add ax, 16
  3621 00002C09 EBF4                <1> 		jmp lengthtesttext
  3622                              <1> 	donetesttextlength:
  3623 00002C0B 6689CB              <1> 		mov bx, cx
  3624 00002C0E 6681C30F00          <1> 		add bx, 15
  3625 00002C13 813D[DF290000]0100- <1> 		cmp dword [dragging], 1
  3626 00002C1B 0000                <1>
  3627 00002C1D 7468                <1> 		je dragtext
  3628 00002C1F 813D[DF290000]0000- <1> 		cmp dword [dragging], 0
  3629 00002C27 0000                <1>
  3630 00002C29 7411                <1> 		je nodragtextcheck
  3631 00002C2B 3935[DF290000]      <1> 		cmp dword [dragging], esi
  3632 00002C31 0F8559020000        <1> 		jne near nexticonsel
  3633 00002C37 E94B000000          <1> 		jmp dragtext
  3634                              <1> 	nodragtextcheck:
  3635 00002C3C 663915[E2240000]    <1> 		cmp [mousecursorposition], dx
  3636 00002C43 0F8247020000        <1> 		jb near nexticonsel
  3637 00002C49 663905[E2240000]    <1> 		cmp [mousecursorposition], ax
  3638 00002C50 0F873A020000        <1> 		ja near nexticonsel
  3639 00002C56 66390D[E4240000]    <1> 		cmp [mousecursorposition + 2], cx
  3640 00002C5D 0F822D020000        <1> 		jb near nexticonsel
  3641 00002C63 66391D[E4240000]    <1> 		cmp [mousecursorposition + 2], bx
  3642 00002C6A 0F8720020000        <1> 		ja near nexticonsel
  3643 00002C70 668B460A            <1> 		mov ax, [esi + 10]
  3644 00002C74 66250100            <1> 		and ax, 1
  3645 00002C78 663D0100            <1> 		cmp ax, 1
  3646 00002C7C 0F84AB000000        <1> 		je near unselecttext
  3647 00002C82 E986000000          <1> 		jmp nodragtext
  3648                              <1> 	dragtext:
  3649 00002C87 663915[DE240000]    <1> 		cmp [lastmouseposition], dx
  3650 00002C8E 0F82FC010000        <1> 		jb near nexticonsel
  3651 00002C94 663905[DE240000]    <1> 		cmp [lastmouseposition], ax
  3652 00002C9B 0F87EF010000        <1> 		ja near nexticonsel
  3653 00002CA1 66390D[E0240000]    <1> 		cmp [lastmouseposition + 2], cx
  3654 00002CA8 0F82E2010000        <1> 		jb near nexticonsel
  3655 00002CAE 66391D[E0240000]    <1> 		cmp [lastmouseposition + 2], bx
  3656 00002CB5 0F87D5010000        <1> 		ja near nexticonsel
  3657 00002CBB 668B460A            <1> 		mov ax, [esi + 10]
  3658 00002CBF 2410                <1> 		and al, 00010000b
  3659 00002CC1 663D1000            <1> 		cmp ax, 00010000b
  3660 00002CC5 0F8442000000        <1> 		je near nodragtext
  3661 00002CCB 8935[DF290000]      <1> 		mov [dragging], esi
  3662 00002CD1 662B15[DE240000]    <1> 		sub dx, [lastmouseposition]
  3663 00002CD8 660315[E2240000]    <1> 		add dx, [mousecursorposition]
  3664 00002CDF 66030D[E4240000]    <1> 		add cx, [mousecursorposition + 2]
  3665 00002CE6 662B0D[E0240000]    <1> 		sub cx, [lastmouseposition + 2]
  3666 00002CED 663B15[C5360000]    <1> 		cmp dx, [resolutionx2]
  3667 00002CF4 7607                <1> 		jbe chkyresdrgtxt
  3668 00002CF6 668B15[E2240000]    <1> 		mov dx, [mousecursorposition]
  3669                              <1> 	chkyresdrgtxt:
  3670 00002CFD 663B0D[C1360000]    <1> 		cmp cx, [resolutiony]
  3671 00002D04 7607                <1> 		jbe nodragtext
  3672 00002D06 668B0D[E4240000]    <1> 		mov cx, [mousecursorposition + 2]
  3673                              <1> 	nodragtext:
  3674 00002D0D 66814E0A0100        <1> 		or word [esi + 10], 1
  3675 00002D13 8B5E0C              <1> 		mov ebx, [esi + 12]
  3676 00002D16 891D[63390000]      <1> 		mov [codepointer], ebx
  3677 00002D1C 668B460A            <1> 		mov ax, [esi + 10]
  3678 00002D20 8B7602              <1> 		mov esi, [esi + 2]
  3679 00002D23 E841050000          <1> 		call showstring
  3680 00002D28 E97C010000          <1> 		jmp doneiconsel
  3681                              <1> 	unselecttext:
  3682 00002D2D 6681660AFEFF        <1> 		and word [esi + 10], 0xFFFE
  3683 00002D33 8B5E0C              <1> 		mov ebx, [esi + 12]
  3684 00002D36 668B460A            <1> 		mov ax, [esi + 10]
  3685 00002D3A 8B7602              <1> 		mov esi, [esi + 2]
  3686 00002D3D C705[63390000]0000- <1> 		mov dword [codepointer], 0
  3687 00002D45 0000                <1>
  3688 00002D47 E81D050000          <1> 		call showstring
  3689 00002D4C E958010000          <1> 		jmp doneiconsel
  3690                              <1> windowselect:
  3691 00002D51 8B7E02              <1> 		mov edi, [esi + 2]
  3692 00002D54 668B5606            <1> 		mov dx, [esi + 6]
  3693 00002D58 6689D0              <1> 		mov ax, dx
  3694 00002D5B 668B4E08            <1> 		mov cx, [esi + 8]
  3695 00002D5F 6689CB              <1> 		mov bx, cx
  3696 00002D62 6681C31000          <1> 		add bx, 16
  3697 00002D67 813D[DF290000]0100- <1> 		cmp dword [dragging], 1
  3698 00002D6F 0000                <1>
  3699 00002D71 746D                <1> 		je dragwin
  3700 00002D73 813D[DF290000]0000- <1> 		cmp dword [dragging], 0
  3701 00002D7B 0000                <1>
  3702 00002D7D 7411                <1> 		je nodragwincheck
  3703 00002D7F 3935[DF290000]      <1> 		cmp dword [dragging], esi
  3704 00002D85 0F8505010000        <1> 		jne near nexticonsel
  3705 00002D8B E950000000          <1> 		jmp dragwin
  3706                              <1> 	nodragwincheck:
  3707 00002D90 663905[E2240000]    <1> 		cmp [mousecursorposition], ax
  3708 00002D97 0F82F3000000        <1> 		jb near nexticonsel
  3709 00002D9D 660307              <1> 		add ax, [edi]
  3710 00002DA0 660307              <1> 		add ax, [edi]
  3711 00002DA3 663905[E2240000]    <1> 		cmp [mousecursorposition], ax
  3712 00002DAA 0F87E0000000        <1> 		ja near nexticonsel
  3713 00002DB0 66390D[E4240000]    <1> 		cmp [mousecursorposition + 2], cx
  3714 00002DB7 0F82D3000000        <1> 		jb near nexticonsel
  3715 00002DBD 66391D[E4240000]    <1> 		cmp [mousecursorposition + 2], bx
  3716 00002DC4 0F87C6000000        <1> 		ja near nexticonsel
  3717 00002DCA 662D1400            <1> 		sub ax, 20
  3718 00002DCE 663905[E2240000]    <1> 		cmp [mousecursorposition], ax
  3719 00002DD5 0F8795000000        <1> 		ja near killwin
  3720 00002DDB E97C000000          <1> 		jmp nodragwin
  3721                              <1> 	dragwin:
  3722 00002DE0 663905[DE240000]    <1> 		cmp [lastmouseposition], ax
  3723 00002DE7 0F82A3000000        <1> 		jb near nexticonsel
  3724 00002DED 660307              <1> 		add ax, [edi]
  3725 00002DF0 660307              <1> 		add ax, [edi]
  3726 00002DF3 663905[DE240000]    <1> 		cmp [lastmouseposition], ax
  3727 00002DFA 0F8790000000        <1> 		ja near nexticonsel
  3728 00002E00 66390D[E0240000]    <1> 		cmp [lastmouseposition + 2], cx
  3729 00002E07 0F8283000000        <1> 		jb near nexticonsel
  3730 00002E0D 66391D[E0240000]    <1> 		cmp [lastmouseposition + 2], bx
  3731 00002E14 0F8776000000        <1> 		ja near nexticonsel
  3732 00002E1A 8935[DF290000]      <1> 		mov [dragging], esi
  3733 00002E20 662B15[DE240000]    <1> 		sub dx, [lastmouseposition]
  3734 00002E27 660315[E2240000]    <1> 		add dx, [mousecursorposition]
  3735 00002E2E 66030D[E4240000]    <1> 		add cx, [mousecursorposition + 2]
  3736 00002E35 662B0D[E0240000]    <1> 		sub cx, [lastmouseposition + 2]
  3737 00002E3C 663B15[C5360000]    <1> 		cmp dx, [resolutionx2]
  3738 00002E43 7607                <1> 		jbe chkyresdrgwin
  3739 00002E45 668B15[E2240000]    <1> 		mov dx, [mousecursorposition]
  3740                              <1> 	chkyresdrgwin:
  3741 00002E4C 663B0D[C1360000]    <1> 		cmp cx, [resolutiony]
  3742 00002E53 7607                <1> 		jbe nodragwin
  3743 00002E55 668B0D[E4240000]    <1> 		mov cx, [mousecursorposition + 2]
  3744                              <1> 	nodragwin:
  3745 00002E5C 8B5E0C              <1> 		mov ebx, [esi + 12]
  3746 00002E5F 668B460A            <1> 		mov ax, [esi + 10]
  3747 00002E63 8B7602              <1> 		mov esi, [esi + 2]
  3748 00002E66 E853040000          <1> 		call showwindow
  3749 00002E6B E939000000          <1> 		jmp doneiconsel
  3750                              <1> 	killwin:
  3751 00002E70 66C7060000          <1> 		mov word [esi], 0
  3752 00002E75 C705[FA020000]0000- <1> 		mov dword [user2codepoint], 0
  3753 00002E7D 0000                <1>
  3754 00002E7F C605[03090000]00    <1> 		mov byte [termguion], 0
  3755 00002E86 E86DF7FFFF          <1> 		call guiclear
  3756 00002E8B E939000000          <1> 		jmp doneiconsel2
  3757                              <1> 	nexticonsel:
  3758 00002E90 6681660AFEFF        <1> 		and word [esi + 10], 0xFFFE
  3759 00002E96 81C610000000        <1> 		add esi, 16
  3760 00002E9C 81FE[00020000]      <1> 		cmp esi, graphicstableend
  3761 00002EA2 7305                <1> 		jae doneiconsel
  3762 00002EA4 E9B6FBFFFF          <1> 		jmp clicon2
  3763                              <1> 	doneiconsel:
  3764 00002EA9 813D[DF290000]0100- <1> 		cmp dword [dragging], 1
  3765 00002EB1 0000                <1>
  3766 00002EB3 7314                <1> 		jae doneiconsel2
  3767 00002EB5 813D[63390000]0000- <1> 		cmp dword [codepointer], 0
  3768 00002EBD 0000                <1>
  3769 00002EBF 7408                <1> 		je doneiconsel2
  3770 00002EC1 8B1D[63390000]      <1> 		mov ebx, [codepointer]
  3771 00002EC7 FFE3                <1> 		jmp ebx 
  3772                              <1> 	doneiconsel2:
  3773 00002EC9 A0[44220000]        <1> 		mov al, [LBUTTON]
  3774 00002ECE A2[DD290000]        <1> 		mov [pLBUTTON], al
  3775 00002ED3 A0[45220000]        <1> 		mov al, [RBUTTON]
  3776 00002ED8 A2[DE290000]        <1> 		mov [pRBUTTON], al
  3777 00002EDD E8C4F9FFFF          <1> call clearmousecursor
  3778 00002EE2 E83C000000          <1> call reloadallgraphics
  3779 00002EE7 B900000000          <1> 		mov ecx, 0
  3780 00002EEC BA00000000          <1> 		mov edx, 0
  3781 00002EF1 B400                <1> 		mov ah, 0
  3782 00002EF3 B080                <1> 		mov al, 128
  3783 00002EF5 668B15[E2240000]    <1> 		mov dx, [mousecursorposition]
  3784 00002EFC 668B0D[E4240000]    <1> 		mov cx, [mousecursorposition + 2]
  3785 00002F03 66BBE738            <1> 		mov bx, 0011100011100111b
  3786 00002F07 C605[A2280000]01    <1> 		mov byte [showcursorfonton], 1
  3787 00002F0E E8C2070000          <1> 		call showfontvesa
  3788 00002F13 C605[A2280000]00    <1> 		mov byte [showcursorfonton], 0
  3789 00002F1A C3                  <1> 		ret
  3790 00002F1B 00000000            <1> lastdrag dw 0,0
  3791 00002F1F 00000000            <1> grpctblpos dw 0,0
  3792                              <1> 
  3793                              <1> reloadallgraphics:
  3794 00002F23 BF[00000000]        <1> 		mov edi, graphicstable
  3795                              <1> reloadgraphicsloop:
  3796 00002F28 8B7702              <1> 		mov esi, [edi + 2]
  3797 00002F2B 668B5706            <1> 		mov dx, [edi + 6]
  3798 00002F2F 668B4F08            <1> 		mov cx, [edi + 8]
  3799 00002F33 668B07              <1> 		mov ax, [edi]
  3800 00002F36 668B5F0A            <1> 		mov bx, [edi + 10]
  3801 00002F3A 893D[1F2F0000]      <1> 		mov [grpctblpos], edi
  3802 00002F40 3B3D[DF290000]      <1> 		cmp edi, [dragging]
  3803 00002F46 741E                <1> 		je loadedgraphic
  3804 00002F48 663D0100            <1> 		cmp ax, 1
  3805 00002F4C 0F8431000000        <1> 		je near icongraphic
  3806 00002F52 663D0200            <1> 		cmp ax, 2
  3807 00002F56 0F8437000000        <1> 		je near stringgraphic
  3808 00002F5C 663D0300            <1> 		cmp ax, 3
  3809 00002F60 0F8416000000        <1> 		je near windowgraphic
  3810 00002F66 8B3D[1F2F0000]      <1> loadedgraphic:  mov edi, [grpctblpos]
  3811 00002F6C 81C710000000        <1> 		add edi, 16
  3812 00002F72 81FF[00020000]      <1> 		cmp edi, graphicstableend
  3813 00002F78 7329                <1> 		jae donereloadgraphics
  3814 00002F7A EBAC                <1> 		jmp reloadgraphicsloop
  3815 00002F7C E890030000          <1> windowgraphic:	call showwindow2
  3816 00002F81 EBE3                <1> 		jmp loadedgraphic
  3817 00002F83 80E301              <1> icongraphic:	and bl, 1
  3818 00002F86 881D[67390000]      <1> 		mov [iconselected], bl
  3819 00002F8C E86A060000          <1> 		call showicon2
  3820 00002F91 EBD3                <1> 		jmp loadedgraphic
  3821 00002F93 80E301              <1> stringgraphic:  and bl, 1
  3822 00002F96 881D[A4280000]      <1> 		mov [mouseselecton], bl
  3823 00002F9C E8DB020000          <1> 		call showstring2
  3824 00002FA1 EBC3                <1> 		jmp loadedgraphic
  3825                              <1> donereloadgraphics:
  3826 00002FA3 8B3D[DF290000]      <1> 		mov edi, [dragging]
  3827 00002FA9 81FF[00000000]      <1> 		cmp edi, graphicstable
  3828 00002FAF 723B                <1> 		jb notcorrectdrag
  3829 00002FB1 668B07              <1> 		mov ax, [edi]
  3830 00002FB4 8B7702              <1> 		mov esi, [edi + 2]
  3831 00002FB7 668B5706            <1> 		mov dx, [edi + 6]
  3832 00002FBB 668B4F08            <1> 		mov cx, [edi + 8]
  3833 00002FBF 668B5F0A            <1> 		mov bx, [edi + 10]
  3834 00002FC3 663D0100            <1> 		cmp ax, 1
  3835 00002FC7 750F                <1> 		jne noticondragging
  3836 00002FC9 80E301              <1> 		and bl, 1
  3837 00002FCC 881D[67390000]      <1> 		mov [iconselected], bl
  3838 00002FD2 E824060000          <1> 		call showicon2
  3839 00002FD7 C3                  <1> 		ret
  3840                              <1> 
  3841                              <1> 	noticondragging:
  3842 00002FD8 663D0200            <1> 		cmp ax, 2
  3843 00002FDC 750E                <1> 		jne notcorrectdrag
  3844 00002FDE 80E301              <1> 		and bl, 1
  3845 00002FE1 881D[A4280000]      <1> 		mov [mouseselecton], bl
  3846 00002FE7 E890020000          <1> 		call showstring2
  3847                              <1> 	notcorrectdrag:
  3848 00002FEC C3                  <1> 		ret
  3849                              <1> 
  3850 00002FED 00<rept>            <1> grphbuf times 16 db 0
  3851                              <1> 	graphicsadd:
  3852 00002FFD BF[00000000]        <1> 		mov edi, graphicstable
  3853                              <1> 	shwgrph1:
  3854 00003002 397702              <1> 		cmp dword [edi + 2], esi
  3855 00003005 7414                <1> 		je showgraphicsreplace2
  3856 00003007 81C710000000        <1> 		add edi, 16
  3857 0000300D 81FF[00020000]      <1> 		cmp edi, graphicstableend
  3858 00003013 0F8335020000        <1> 		jae near showgraphicsnew
  3859 00003019 EBE7                <1> 		jmp shwgrph1
  3860                              <1> 	showgraphicsreplace2:
  3861 0000301B 8935[EF2F0000]      <1> 		mov [grphbuf + 2], esi
  3862 00003021 668915[F32F0000]    <1> 		mov [grphbuf + 6], dx
  3863 00003028 66890D[F52F0000]    <1> 		mov [grphbuf + 8], cx
  3864 0000302F 891D[F92F0000]      <1> 		mov [grphbuf + 12], ebx
  3865 00003035 B700                <1> 		mov bh, 0
  3866 00003037 88E3                <1> 		mov bl, ah
  3867 00003039 B400                <1> 		mov ah, 0
  3868 0000303B 66A3[F72F0000]      <1> 		mov [grphbuf + 10], ax	
  3869 00003041 66891D[ED2F0000]    <1> 		mov [grphbuf], bx
  3870 00003048 66A1[ED2F0000]      <1> 		mov ax, [grphbuf]
  3871 0000304E 663D0100            <1> 		cmp ax, 1
  3872 00003052 0F8419000000        <1> 		je near replaceicon
  3873 00003058 663D0200            <1> 		cmp ax, 2
  3874 0000305C 0F8493000000        <1> 		je near replacestring
  3875 00003062 663D0300            <1> 		cmp ax, 3
  3876 00003066 0F840F010000        <1> 		je near replacewindow
  3877 0000306C E9BA010000          <1> 		jmp showgraphicsreplace
  3878                              <1> 	replaceicon:
  3879 00003071 893D[E3290000]      <1> 		mov [lastpos], edi
  3880 00003077 8935[E7290000]      <1> 		mov [lastpos + 4], esi
  3881 0000307D 8B7702              <1> 		mov esi, [edi + 2]
  3882 00003080 668B5F0C            <1> 		mov bx, [edi + 12]
  3883 00003084 668B5706            <1> 		mov dx, [edi + 6]
  3884 00003088 668B4F08            <1> 		mov cx, [edi + 8]
  3885 0000308C 668B06              <1> 		mov ax, [esi]
  3886 0000308F 66A3[EB290000]      <1> 		mov [colorbuf], ax
  3887 00003095 66A1[35260000]      <1> 		mov ax, [background]
  3888 0000309B 668906              <1> 		mov [esi], ax
  3889 0000309E 8B5F0C              <1> 		mov ebx, [edi + 12]
  3890 000030A1 668B470A            <1> 		mov ax, [edi + 10]
  3891 000030A5 2401                <1> 		and al, 1
  3892 000030A7 A2[67390000]        <1> 		mov [iconselected], al
  3893 000030AC 668B470A            <1> 		mov ax, [edi + 10]
  3894 000030B0 E846050000          <1> 		call showicon2
  3895 000030B5 8B3D[E3290000]      <1> 		mov edi, [lastpos]
  3896 000030BB 8B7702              <1> 		mov esi, [edi + 2]
  3897 000030BE 66A1[EB290000]      <1> 		mov ax, [colorbuf]
  3898 000030C4 668906              <1> 		mov [esi], ax
  3899 000030C7 8B35[E7290000]      <1> 		mov esi, [lastpos + 4]
  3900 000030CD 668B15[F32F0000]    <1> 		mov dx, [grphbuf + 6]
  3901 000030D4 668B0D[F52F0000]    <1> 		mov cx, [grphbuf + 8]
  3902 000030DB 668B1D[ED2F0000]    <1> 		mov bx, [grphbuf]
  3903 000030E2 66A1[F72F0000]      <1> 		mov ax, [grphbuf + 10]
  3904 000030E8 88DC                <1> 		mov ah, bl
  3905 000030EA 8B1D[F92F0000]      <1> 		mov ebx, [grphbuf + 12]
  3906 000030F0 E936010000          <1> 		jmp showgraphicsreplace
  3907                              <1> 	replacestring:
  3908 000030F5 893D[E3290000]      <1> 		mov [lastpos], edi
  3909 000030FB 8935[E7290000]      <1> 		mov [lastpos + 4], esi
  3910 00003101 8B5F0C              <1> 		mov ebx, [edi + 12]
  3911 00003104 8B7702              <1> 		mov esi, [edi + 2]
  3912 00003107 668B5706            <1> 		mov dx, [edi + 6]
  3913 0000310B 668B4F08            <1> 		mov cx, [edi + 8]
  3914 0000310F 66A1[AC320000]      <1> 		mov ax, [colorfont2]
  3915 00003115 66A3[EB290000]      <1> 		mov [colorbuf], ax
  3916 0000311B 66A1[35260000]      <1> 		mov ax, [background]
  3917 00003121 66A3[AC320000]      <1> 		mov [colorfont2], ax		
  3918 00003127 8B5F0C              <1> 		mov ebx, [edi + 12]
  3919 0000312A 668B470A            <1> 		mov ax, [edi + 10]
  3920 0000312E 2401                <1> 		and al, 1
  3921 00003130 A2[A4280000]        <1> 		mov [mouseselecton], al
  3922 00003135 668B470A            <1> 		mov ax, [edi + 10]
  3923 00003139 E83E010000          <1> 		call showstring2
  3924 0000313E 66A1[EB290000]      <1> 		mov ax, [colorbuf]
  3925 00003144 66A3[AC320000]      <1> 		mov [colorfont2], ax
  3926 0000314A 8B3D[E3290000]      <1> 		mov edi, [lastpos]
  3927 00003150 8B7702              <1> 		mov esi, [edi + 2]
  3928 00003153 668B15[F32F0000]    <1> 		mov dx, [grphbuf + 6]
  3929 0000315A 668B0D[F52F0000]    <1> 		mov cx, [grphbuf + 8]
  3930 00003161 668B1D[ED2F0000]    <1> 		mov bx, [grphbuf]
  3931 00003168 66A1[F72F0000]      <1> 		mov ax, [grphbuf + 10]
  3932 0000316E 88DC                <1> 		mov ah, bl
  3933 00003170 8B1D[F92F0000]      <1> 		mov ebx, [grphbuf + 12]
  3934 00003176 E9B0000000          <1> 		jmp showgraphicsreplace
  3935                              <1> 	replacewindow:
  3936 0000317B 893D[E3290000]      <1> 		mov [lastpos], edi
  3937 00003181 8935[E7290000]      <1> 		mov [lastpos + 4], esi
  3938 00003187 8B7702              <1> 		mov esi, [edi + 2]
  3939 0000318A 8B3D[BA320000]      <1> 		mov edi, [windowbufloc]
  3940 00003190 BA00000000          <1> 		mov edx, 0
  3941 00003195 668B15[C5360000]    <1> 		mov dx, [resolutionx2]
  3942 0000319C C1E204              <1> 		shl edx, 4
  3943 0000319F 29D7                <1> 		sub edi, edx
  3944 000031A1 BA00000000          <1> 		mov edx, 0
  3945 000031A6 668B16              <1> 		mov dx, [esi]
  3946 000031A9 660316              <1> 		add dx, [esi]
  3947 000031AC 668B4E02            <1> 		mov cx, [esi + 2]
  3948 000031B0 6681C11000          <1> 		add cx, 16
  3949 000031B5 66A1[35260000]      <1> 		mov ax, [background]
  3950                              <1> 	clearwindow:
  3951 000031BB 668907              <1> 		mov [edi], ax
  3952 000031BE 81C702000000        <1> 		add edi, 2
  3953 000031C4 81EA02000000        <1> 		sub edx, 2
  3954 000031CA 81FA00000000        <1> 		cmp edx, 0
  3955 000031D0 75E9                <1> 		jne clearwindow
  3956 000031D2 6649                <1> 		dec cx
  3957 000031D4 668B15[C5360000]    <1> 		mov dx, [resolutionx2]
  3958 000031DB 662B16              <1> 		sub dx, [esi]
  3959 000031DE 662B16              <1> 		sub dx, [esi]
  3960 000031E1 01D7                <1> 		add edi, edx
  3961 000031E3 668B16              <1> 		mov dx, [esi]
  3962 000031E6 660316              <1> 		add dx, [esi]
  3963 000031E9 6681F90000          <1> 		cmp cx, 0
  3964 000031EE 75CB                <1> 		jne clearwindow
  3965 000031F0 C605[04090000]00    <1> 		mov byte [termcopyon], 0
  3966 000031F7 8B3D[E3290000]      <1> 		mov edi, [lastpos]
  3967 000031FD 8B35[EF2F0000]      <1> 		mov esi, [grphbuf + 2]
  3968 00003203 668B15[F32F0000]    <1> 		mov dx, [grphbuf + 6]
  3969 0000320A 668B0D[F52F0000]    <1> 		mov cx, [grphbuf + 8]
  3970 00003211 668B1D[ED2F0000]    <1> 		mov bx, [grphbuf]
  3971 00003218 66A1[F72F0000]      <1> 		mov ax, [grphbuf + 10]
  3972 0000321E 88DC                <1> 		mov ah, bl
  3973 00003220 8B1D[F92F0000]      <1> 		mov ebx, [grphbuf + 12]
  3974 00003226 E900000000          <1> 		jmp showgraphicsreplace
  3975                              <1> 	showgraphicsreplace:
  3976 0000322B 897702              <1> 		mov [edi + 2], esi
  3977 0000322E 66895706            <1> 		mov [edi + 6], dx
  3978 00003232 66894F08            <1> 		mov [edi + 8], cx
  3979 00003236 895F0C              <1> 		mov [edi + 12], ebx
  3980 00003239 B700                <1> 		mov bh, 0
  3981 0000323B 88E3                <1> 		mov bl, ah
  3982 0000323D B400                <1> 		mov ah, 0
  3983 0000323F 6689470A            <1> 		mov [edi + 10], ax
  3984 00003243 66891F              <1> 		mov [edi], bx
  3985 00003246 8B5F0C              <1> 		mov ebx, [edi + 12]
  3986 00003249 668B470A            <1> 		mov ax, [edi + 10]
  3987 0000324D C3                  <1> 		ret
  3988                              <1> 	showgraphicsnew:
  3989 0000324E BF[00000000]        <1> 		mov edi, graphicstable
  3990                              <1> 	shwgrph2:
  3991 00003253 66813F0000          <1> 		cmp word [edi], 0
  3992 00003258 74D1                <1> 		je showgraphicsreplace
  3993 0000325A 81C710000000        <1> 		add edi, 16
  3994 00003260 81FF[00020000]      <1> 		cmp edi, graphicstableend
  3995 00003266 72EB                <1> 		jb shwgrph2
  3996                              <1> 	showgraphicsdone:
  3997 00003268 C3                  <1> 		ret
  3998                              <1> 
  3999                              <1> 	showstring:
  4000 00003269 A2[A4280000]        <1> 		mov [mouseselecton], al
  4001 0000326E 8025[A4280000]01    <1> 		and byte [mouseselecton], 1
  4002 00003275 B402                <1> 		mov ah, 2
  4003 00003277 E881FDFFFF          <1> 		call graphicsadd
  4004                              <1> 	showstring2:
  4005 0000327C B400                <1> 		mov ah, 0
  4006 0000327E 8A06                <1> 		mov al, [esi]
  4007 00003280 3C00                <1> 		cmp al, 0
  4008 00003282 7420                <1> 		je doneshowstring
  4009 00003284 46                  <1> 		inc esi
  4010 00003285 8935[10390000]      <1> 		mov [showstringesi], esi
  4011 0000328B 668B1D[AC320000]    <1> 		mov bx, [colorfont2]
  4012 00003292 E83E040000          <1> 		call showfontvesa
  4013 00003297 6681C20800          <1> 		add dx, 8
  4014 0000329C 8B35[10390000]      <1> 		mov esi, [showstringesi]
  4015 000032A2 EBD8                <1> 		jmp showstring2
  4016                              <1> 	doneshowstring:
  4017 000032A4 C605[A4280000]00    <1> 		mov byte [mouseselecton], 0
  4018 000032AB C3                  <1> 		ret
  4019                              <1> 
  4020 000032AC FFFF                <1> colorfont2 dw 0xFFFF
  4021 000032AE 0000                <1> winvcopystx dw 0
  4022 000032B0 0000                <1> winvcopysty dw 0
  4023 000032B2 0000                <1> winvcopydx dw 0
  4024 000032B4 0000                <1> winvcopycx dw 0
  4025 000032B6 FFFF0000            <1> windowcolor dw 0xFFFF,0x0
  4026 000032BA 00000000            <1> windowbufloc: dw 0,0
  4027                              <1> 
  4028                              <1> 	showwindow:	;;windowstuff in si, position in (dx, cx), nothing in ax, code in bx
  4029 000032BE C605[03090000]01    <1> 		mov byte [termguion], 1
  4030 000032C5 6681C11000          <1> 		add cx, 16
  4031 000032CA 668915[AE320000]    <1> 		mov [winvcopystx], dx
  4032 000032D1 66890D[B0320000]    <1> 		mov [winvcopysty], cx
  4033 000032D8 668B16              <1> 		mov dx, [esi]
  4034 000032DB 668B4E02            <1> 		mov cx, [esi + 2]
  4035 000032DF 6601D2              <1> 		add dx, dx
  4036 000032E2 668915[B2320000]    <1> 		mov [winvcopydx], dx
  4037 000032E9 66890D[B4320000]    <1> 		mov [winvcopycx], cx
  4038 000032F0 668B0D[B0320000]    <1> 		mov cx, [winvcopysty]
  4039 000032F7 6681E91000          <1> 		sub cx, 16
  4040 000032FC 668B15[AE320000]    <1> 		mov dx, [winvcopystx]
  4041 00003303 C605[04090000]00    <1> 		mov byte [termcopyon], 0
  4042 0000330A B403                <1> 		mov ah, 3
  4043 0000330C E8ECFCFFFF          <1> 		call graphicsadd
  4044                              <1> 	showwindow2:
  4045 00003311 6681C11000          <1> 		add cx, 16
  4046 00003316 668915[AE320000]    <1> 		mov [winvcopystx], dx
  4047 0000331D 66890D[B0320000]    <1> 		mov [winvcopysty], cx
  4048 00003324 668B16              <1> 		mov dx, [esi]
  4049 00003327 668B4E02            <1> 		mov cx, [esi + 2]
  4050 0000332B 6601D2              <1> 		add dx, dx
  4051 0000332E 668915[B2320000]    <1> 		mov [winvcopydx], dx
  4052 00003335 66890D[B4320000]    <1> 		mov [winvcopycx], cx
  4053 0000333C 8B3D[BA320000]      <1> 		mov edi, [windowbufloc]
  4054 00003342 BA00000000          <1> 		mov edx, 0
  4055 00003347 668B15[C5360000]    <1> 		mov dx, [resolutionx2]
  4056 0000334E C1E204              <1> 		shl edx, 4
  4057 00003351 29D7                <1> 		sub edi, edx
  4058 00003353 803D[04090000]00    <1> 		cmp byte [termcopyon], 0
  4059 0000335A 753E                <1> 		jne nocleartitlebarpos
  4060 0000335C 8B3D[35220000]      <1> 		mov edi, [physbaseptr]
  4061 00003362 BA00000000          <1> 		mov edx, 0
  4062 00003367 668B15[AE320000]    <1> 		mov dx, [winvcopystx]
  4063 0000336E 01D7                <1> 		add edi, edx
  4064 00003370 668B0D[B0320000]    <1> 		mov cx, [winvcopysty]
  4065 00003377 6681E91000          <1> 		sub cx, 16
  4066 0000337C 6681F90000          <1> 		cmp cx, 0
  4067 00003381 7417                <1> 		je nocleartitlebarpos
  4068                              <1> 	cleartitlebarpos:
  4069 00003383 BA00000000          <1> 		mov edx, 0
  4070 00003388 668B15[C5360000]    <1> 		mov dx, [resolutionx2]
  4071 0000338F 01D7                <1> 		add edi, edx
  4072 00003391 6649                <1> 		dec cx
  4073 00003393 6681F90000          <1> 		cmp cx, 0
  4074 00003398 75E9                <1> 		jne cleartitlebarpos
  4075                              <1> 	nocleartitlebarpos:
  4076 0000339A 66B91000            <1> 		mov cx, 16
  4077 0000339E 668B15[B2320000]    <1> 		mov dx, [winvcopydx]
  4078 000033A5 6681F90000          <1> 		cmp cx, 0
  4079 000033AA 0F844B000000        <1> 		je near canceltitlebarput
  4080 000033B0 6681FA0000          <1> 		cmp dx, 0
  4081 000033B5 0F8440000000        <1> 		je near canceltitlebarput
  4082                              <1> 	titlebarput:
  4083 000033BB 66A1[B6320000]      <1> 		mov ax, [windowcolor]
  4084 000033C1 668907              <1> 		mov [edi], ax
  4085 000033C4 6681EA0200          <1> 		sub dx, 2
  4086 000033C9 81C702000000        <1> 		add edi, 2
  4087 000033CF 6681FA0000          <1> 		cmp dx, 0
  4088 000033D4 75E5                <1> 		jne titlebarput
  4089 000033D6 BA00000000          <1> 		mov edx, 0
  4090 000033DB 668B15[C5360000]    <1> 		mov dx, [resolutionx2]
  4091 000033E2 6649                <1> 		dec cx
  4092 000033E4 662B15[B2320000]    <1> 		sub dx, [winvcopydx]
  4093 000033EB 01D7                <1> 		add edi, edx
  4094 000033ED 668B15[B2320000]    <1> 		mov dx, [winvcopydx]
  4095 000033F4 6681F90000          <1> 		cmp cx, 0
  4096 000033F9 75C0                <1> 		jne titlebarput
  4097                              <1> 	canceltitlebarput:
  4098 000033FB 893D[BA320000]      <1> 		mov [windowbufloc], edi
  4099 00003401 803D[04090000]02    <1> 		cmp byte [termcopyon], 2
  4100 00003408 0F8463000000        <1> 		je near winvcpst
  4101 0000340E 66B80000            <1> 		mov ax, 0
  4102 00003412 81C604000000        <1> 		add esi, 4
  4103 00003418 668B15[AE320000]    <1> 		mov dx, [winvcopystx]
  4104 0000341F 668B0D[B0320000]    <1> 		mov cx, [winvcopysty]
  4105 00003426 6681E91000          <1> 		sub cx, 16
  4106 0000342B 66BB0000            <1> 		mov bx, 0
  4107 0000342F C605[A4280000]01    <1> 		mov byte [mouseselecton], 1
  4108 00003436 E841FEFFFF          <1> 		call showstring2
  4109 0000343B B058                <1> 		mov al, "X"
  4110 0000343D B400                <1> 		mov ah, 0
  4111 0000343F 668B1D[AC320000]    <1> 		mov bx, [colorfont2]
  4112 00003446 668B15[AE320000]    <1> 		mov dx, [winvcopystx]
  4113 0000344D 668B0D[B0320000]    <1> 		mov cx, [winvcopysty]
  4114 00003454 6681E91000          <1> 		sub cx, 16
  4115 00003459 6681EA1400          <1> 		sub dx, 20
  4116 0000345E 660315[B2320000]    <1> 		add dx, [winvcopydx]
  4117 00003465 C605[A4280000]01    <1> 		mov byte [mouseselecton], 1
  4118 0000346C E864020000          <1> 		call showfontvesa
  4119                              <1> 	winvcpst:
  4120 00003471 8B3D[BA320000]      <1> 		mov edi, [windowbufloc]
  4121 00003477 E957000000          <1> 		jmp windowvideocopyset
  4122                              <1> 
  4123                              <1> 	windowvideocopy:
  4124 0000347C 8B3D[BA320000]      <1> 		mov edi, [windowbufloc]
  4125 00003482 3B3D[35220000]      <1> 		cmp edi, [physbaseptr]
  4126 00003488 0F8345000000        <1> 		jae near windowvideocopyset
  4127 0000348E B900000000          <1> 		mov ecx, 0
  4128 00003493 BA00000000          <1> 		mov edx, 0
  4129 00003498 668B15[AE320000]    <1> 		mov dx, [winvcopystx]
  4130 0000349F 668B0D[B0320000]    <1> 		mov cx, [winvcopysty]
  4131 000034A6 8B3D[35220000]      <1> 		mov edi, [physbaseptr]
  4132 000034AC 01D7                <1> 		add edi, edx
  4133 000034AE 81F900000000        <1> 		cmp ecx, 0
  4134 000034B4 741D                <1> 		je windowvideocopyset
  4135                              <1> 	yrescopylp:
  4136 000034B6 BA00000000          <1> 		mov edx, 0
  4137 000034BB 668B15[C5360000]    <1> 		mov dx, [resolutionx2]
  4138 000034C2 01D7                <1> 		add edi, edx
  4139 000034C4 6649                <1> 		dec cx
  4140 000034C6 6681F90000          <1> 		cmp cx, 0
  4141 000034CB 75E9                <1> 		jne yrescopylp
  4142 000034CD 893D[BA320000]      <1> 		mov [windowbufloc], edi
  4143                              <1> 	windowvideocopyset:
  4144 000034D3 66B90000            <1> 		mov cx, 0
  4145 000034D7 66890D[E0350000]    <1> 		mov [charposline], cx
  4146 000034DE BE[850C0000]        <1> 		mov esi, videobuf2
  4147 000034E3 8935[E2350000]      <1> 		mov [charposvbuf], esi
  4148 000034E9 8A1E                <1> 		mov bl, [esi]
  4149 000034EB B700                <1> 		mov bh, 0
  4150 000034ED 66C1E304            <1> 		shl bx, 4
  4151 000034F1 678AB7[3141]        <1> 		mov dh, [fonts + bx]
  4152 000034F6 D0CE                <1> 		ror dh, 1
  4153 000034F8 89FE                <1> 		mov esi, edi
  4154                              <1> 	copywindow:
  4155 000034FA B201                <1> 		mov dl, 1
  4156 000034FC D0C6                <1> 		rol dh, 1
  4157 000034FE 20F2                <1> 		and dl, dh
  4158 00003500 66A1[B8320000]      <1> 		mov ax, [windowcolor + 2]
  4159 00003506 668907              <1> 		mov [edi], ax
  4160 00003509 80FA00              <1> 		cmp dl, 0
  4161 0000350C 7409                <1> 		je nowritewin
  4162 0000350E 66A1[B6320000]      <1> 		mov ax, [windowcolor]
  4163 00003514 668907              <1> 		mov [edi], ax
  4164                              <1> 	nowritewin:
  4165 00003517 81C702000000        <1> 		add edi, 2
  4166 0000351D FEC1                <1> 		inc cl
  4167 0000351F 80F908              <1> 		cmp cl, 8
  4168 00003522 75D6                <1> 		jne copywindow
  4169 00003524 6643                <1> 		inc bx
  4170 00003526 B100                <1> 		mov cl, 0
  4171 00003528 BA00000000          <1> 		mov edx, 0
  4172 0000352D 668B15[C5360000]    <1> 		mov dx, [resolutionx2]
  4173 00003534 01D6                <1> 		add esi, edx
  4174 00003536 89F7                <1> 		mov edi, esi
  4175 00003538 678AB7[3141]        <1> 		mov dh, [fonts + bx]
  4176 0000353D D0CE                <1> 		ror dh, 1
  4177 0000353F FEC5                <1> 		inc ch
  4178 00003541 80FD10              <1> 		cmp ch, 16
  4179 00003544 75B4                <1> 		jne copywindow
  4180 00003546 66B90000            <1> 		mov cx, 0
  4181 0000354A 8B3D[E2350000]      <1> 		mov edi, [charposvbuf]
  4182 00003550 81C702000000        <1> 		add edi, 2
  4183 00003556 81FF[451F0000]      <1> 		cmp edi, videobufend
  4184 0000355C 7370                <1> 		jae donewincopynow
  4185 0000355E 8A1F                <1> 		mov bl, [edi]
  4186 00003560 B700                <1> 		mov bh, 0
  4187 00003562 66C1E304            <1> 		shl bx, 4
  4188 00003566 893D[E2350000]      <1> 		mov [charposvbuf], edi
  4189 0000356C BA00000000          <1> 		mov edx, 0
  4190 00003571 668B15[C5360000]    <1> 		mov dx, [resolutionx2]
  4191 00003578 C1E204              <1> 		shl edx, 4
  4192 0000357B 29D6                <1> 		sub esi, edx
  4193 0000357D 81C610000000        <1> 		add esi, 16
  4194 00003583 89F7                <1> 		mov edi, esi
  4195 00003585 668B0D[E0350000]    <1> 		mov cx, [charposline]
  4196 0000358C 6641                <1> 		inc cx
  4197 0000358E 6681F95000          <1> 		cmp cx, 80
  4198 00003593 7317                <1> 		jae fixwindowcopy
  4199 00003595 66890D[E0350000]    <1> 		mov [charposline], cx
  4200 0000359C 66B90000            <1> 		mov cx, 0
  4201 000035A0 678AB7[3141]        <1> 		mov dh, [fonts + bx]
  4202 000035A5 D0CE                <1> 		ror dh, 1
  4203 000035A7 E94EFFFFFF          <1> 		jmp copywindow
  4204                              <1> fixwindowcopy:
  4205 000035AC 66B90000            <1> 		mov cx, 0
  4206 000035B0 66890D[E0350000]    <1> 		mov [charposline], cx
  4207 000035B7 662B15[B2320000]    <1> 		sub dx, [winvcopydx]
  4208 000035BE 01D6                <1> 		add esi, edx
  4209 000035C0 89F7                <1> 		mov edi, esi
  4210 000035C2 678AB7[3141]        <1> 		mov dh, [fonts + bx]
  4211 000035C7 D0CE                <1> 		ror dh, 1
  4212 000035C9 E92CFFFFFF          <1> 		jmp copywindow
  4213                              <1> donewincopynow:
  4214 000035CE 803D[04090000]01    <1> 		cmp byte [termcopyon], 1
  4215 000035D5 7501                <1> 		jne forgetresetstuff
  4216 000035D7 61                  <1> 		popa
  4217                              <1> forgetresetstuff:
  4218 000035D8 C605[04090000]00    <1> 		mov byte [termcopyon], 0
  4219 000035DF C3                  <1> 		ret
  4220                              <1> 
  4221 000035E0 0000                <1> charposline dw 0
  4222 000035E2 00000000            <1> charposvbuf dw 0,0
  4223 000035E6 0000                <1> iconcolor dw 0
  4224                              <1> 	showicon:	;;icon in si, position in (dx,cx), selected in ax, code in bx
  4225 000035E8 A2[67390000]        <1> 		mov [iconselected], al
  4226 000035ED 8025[67390000]01    <1> 		and byte [iconselected], 1
  4227 000035F4 B401                <1> 		mov ah, 1
  4228 000035F6 E802FAFFFF          <1> 		call graphicsadd
  4229                              <1> 	showicon2:
  4230 000035FB 8B3D[35220000]      <1> 		mov edi, [physbaseptr]
  4231 00003601 6601D2              <1> 		add dx, dx
  4232 00003604 663B15[C5360000]    <1> 		cmp dx, [resolutionx2]
  4233 0000360B 720C                <1> 		jb screenxgood
  4234 0000360D 668B15[C5360000]    <1> 		mov dx, [resolutionx2]
  4235 00003614 6681EA4000          <1> 		sub dx, 64
  4236                              <1> 	screenxgood:
  4237 00003619 6681F90000          <1> 		cmp cx, 0
  4238 0000361E 7425                <1> 		je noscreenygoodchk
  4239 00003620 663B0D[C1360000]    <1> 		cmp cx, [resolutiony]
  4240 00003627 720C                <1> 		jb screenygood
  4241 00003629 668B0D[C1360000]    <1> 		mov cx, [resolutiony]
  4242 00003630 6681E92000          <1> 		sub cx, 32
  4243                              <1> 	screenygood:
  4244 00003635 BB00000000          <1> 		mov ebx, 0
  4245 0000363A 668B1D[C5360000]    <1> 		mov bx, [resolutionx2]
  4246 00003641 01DF                <1> 		add edi, ebx
  4247 00003643 E2F0                <1> 		loop screenygood
  4248                              <1> 	noscreenygoodchk:
  4249 00003645 BB00000000          <1> 		mov ebx, 0
  4250 0000364A 6689D3              <1> 		mov bx, dx
  4251 0000364D 01DF                <1> 		add edi, ebx
  4252 0000364F 66B90000            <1> 		mov cx, 0
  4253 00003653 668B06              <1> 		mov ax, [esi]
  4254 00003656 81C602000000        <1> 		add esi, 2
  4255 0000365C 66A3[E6350000]      <1> 		mov [iconcolor], ax
  4256                              <1> 	writeicon:
  4257 00003662 8B06                <1> 		mov eax, [esi]
  4258 00003664 D1C0                <1> 		rol eax, 1
  4259 00003666 B100                <1> 		mov cl, 0
  4260                              <1> 	writeiconline:
  4261 00003668 B201                <1> 		mov dl, 1
  4262 0000366A 20C2                <1> 		and dl, al
  4263 0000366C 3215[67390000]      <1> 		xor dl, [iconselected]
  4264 00003672 668B1D[35260000]    <1> 		mov bx, [background]
  4265 00003679 66891F              <1> 		mov [edi], bx
  4266 0000367C 80FA00              <1> 		cmp dl, 0
  4267 0000367F 740A                <1> 		je noiconline
  4268 00003681 668B15[E6350000]    <1> 		mov dx, [iconcolor]
  4269 00003688 668917              <1> 		mov [edi], dx
  4270                              <1> 	noiconline:
  4271 0000368B 81C702000000        <1> 		add edi, 2
  4272 00003691 D1C0                <1> 		rol eax, 1
  4273 00003693 FEC1                <1> 		inc cl
  4274 00003695 80F920              <1> 		cmp cl, 32
  4275 00003698 72CE                <1> 		jb writeiconline
  4276 0000369A 81C604000000        <1> 		add esi, 4
  4277 000036A0 FEC5                <1> 		inc ch
  4278 000036A2 BA00000000          <1> 		mov edx, 0
  4279 000036A7 668B15[C5360000]    <1> 		mov dx, [resolutionx2]
  4280 000036AE 01D7                <1> 		add edi, edx
  4281 000036B0 81EF40000000        <1> 		sub edi, 64
  4282 000036B6 80FD20              <1> 		cmp ch, 32
  4283 000036B9 72A7                <1> 		jb writeicon
  4284 000036BB B800000000          <1> 		mov eax, 0
  4285 000036C0 C3                  <1> 		ret
  4286                              <1> 
  4287 000036C1 0000                <1> resolutiony dw 0
  4288 000036C3 0000                <1> resolutionx dw 0
  4289 000036C5 0000                <1> resolutionx2 dw 0
  4290 000036C7 02                  <1> resolutionbytes db 2
  4291 000036C8 0000                <1> posxvesa dw 0
  4292 000036CA 0000                <1> posyvesa dw 0
  4293 000036CC FFFF                <1> colorfont dw 0xFFFF
  4294                              <1> savefontvesa:		;;same rules as showfontvesa
  4295 000036CE C605[A3280000]01    <1> 	mov byte [savefonton], 1
  4296                              <1> showfontvesa:		;;position in (dx,cx), color in bx, char in al
  4297 000036D5 25FF000000          <1> 	and eax, 0xFF
  4298 000036DA 66890D[CA360000]    <1> 	mov [posyvesa], cx
  4299 000036E1 668915[C8360000]    <1> 	mov [posxvesa], dx
  4300 000036E8 8B3D[35220000]      <1> 	mov edi, [physbaseptr]
  4301 000036EE 66891D[CC360000]    <1> 	mov [colorfont], bx
  4302 000036F5 BB00000000          <1> 	mov ebx, 0
  4303 000036FA 6689D3              <1> 	mov bx, dx
  4304 000036FD 89DA                <1> 	mov edx, ebx
  4305 000036FF BB00000000          <1> 	mov ebx, 0
  4306 00003704 6681F90000          <1> 	cmp cx, 0
  4307 00003709 7415                <1> 	je vesaposloopdn
  4308 0000370B 668B1D[C5360000]    <1> 	mov bx, [resolutionx2]
  4309                              <1> vesaposloop:
  4310 00003712 01DA                <1> 	add edx, ebx
  4311 00003714 6681E90100          <1> 	sub cx, 1
  4312 00003719 6681F90000          <1> 	cmp cx, 0
  4313 0000371E 75F2                <1> 	jne vesaposloop
  4314                              <1> vesaposloopdn:
  4315 00003720 01D7                <1> 	add edi, edx
  4316 00003722 BE[31410000]        <1> 	mov esi, fonts
  4317                              <1> findfontvesa:
  4318 00003727 B400                <1> 	mov ah, 0
  4319 00003729 C1E004              <1> 	shl eax, 4
  4320 0000372C 01C6                <1> 	add esi, eax
  4321 0000372E C1E804              <1> 	shr eax, 4
  4322 00003731 81FE[51490000]      <1> 	cmp esi, fontend
  4323 00003737 0F83BF000000        <1> 	jae near donefontvesa
  4324 0000373D 4E                  <1> 	dec esi
  4325                              <1> foundfontvesa:
  4326 0000373E 46                  <1> 	inc esi
  4327 0000373F 803D[A3280000]01    <1> 	cmp byte [savefonton], 1
  4328 00003746 0F84E1000000        <1> 	je near vesafontsaver
  4329 0000374C B100                <1> 	mov cl, 0
  4330 0000374E 8A06                <1> 	mov al, [esi]
  4331 00003750 668B15[C5360000]    <1> 	mov dx, [resolutionx2]
  4332 00003757 662B15[C8360000]    <1> 	sub dx, [posxvesa]
  4333 0000375E 6681FA1000          <1> 	cmp dx, 16
  4334 00003763 7708                <1> 	ja paintfontvesa
  4335 00003765 D0EA                <1> 	shr dl, 1
  4336 00003767 8815[2C380000]      <1> 	mov [charwidth], dl
  4337                              <1> paintfontvesa:
  4338 0000376D B201                <1> 	mov dl, 1
  4339 0000376F 20C2                <1> 	and dl, al
  4340 00003771 803D[A2280000]01    <1> 	cmp byte [showcursorfonton], 1
  4341 00003778 0F8435000000        <1> 	je near nodelpaintedfont
  4342 0000377E 803D[A2280000]02    <1> 	cmp byte [showcursorfonton], 2
  4343 00003785 0F8518000000        <1> 	jne near noswitchcursorfonton
  4344 0000378B 80FA00              <1> 	cmp dl, 0
  4345 0000378E 0F842E000000        <1> 	je near nopixelset
  4346 00003794 668B1D[CC360000]    <1> 	mov bx, [colorfont]
  4347 0000379B 66891F              <1> 	mov [edi], bx
  4348 0000379E E91F000000          <1> 	jmp nopixelset
  4349                              <1> noswitchcursorfonton:
  4350 000037A3 3215[A4280000]      <1> 	xor dl, [mouseselecton]
  4351 000037A9 668B1D[35260000]    <1> 	mov bx, [background]
  4352 000037B0 66891F              <1> 	mov [edi], bx
  4353                              <1> nodelpaintedfont:
  4354 000037B3 80FA00              <1> 	cmp dl, 0
  4355 000037B6 740A                <1> 	je nopixelset
  4356 000037B8 668B15[CC360000]    <1> 	mov dx, [colorfont]
  4357 000037BF 668917              <1> 	mov [edi], dx
  4358                              <1> nopixelset:
  4359 000037C2 81C702000000        <1> 	add edi, 2
  4360 000037C8 D0C0                <1> 	rol al, 1
  4361 000037CA FEC1                <1> 	inc cl
  4362 000037CC 3A0D[2C380000]      <1> 	cmp cl, [charwidth]
  4363 000037D2 7299                <1> 	jb paintfontvesa
  4364 000037D4 FEC5                <1> 	inc ch
  4365 000037D6 BA00000000          <1> 	mov edx, 0
  4366 000037DB 668B15[C5360000]    <1> 	mov dx, [resolutionx2]
  4367 000037E2 01D7                <1> 	add edi, edx
  4368 000037E4 BA00000000          <1> 	mov edx, 0
  4369 000037E9 8A15[2C380000]      <1> 	mov dl, [charwidth]
  4370 000037EF 00D2                <1> 	add dl, dl
  4371 000037F1 29D7                <1> 	sub edi, edx
  4372 000037F3 80FD10              <1> 	cmp ch, 16
  4373 000037F6 0F8242FFFFFF        <1> 	jb foundfontvesa
  4374                              <1> donefontvesa:
  4375 000037FC B208                <1> 	mov dl, 8
  4376 000037FE 8815[2C380000]      <1> 	mov [charwidth], dl
  4377 00003804 668B15[C8360000]    <1> 	mov dx, [posxvesa]
  4378 0000380B 8A1D[2C380000]      <1> 	mov bl, [charwidth]
  4379 00003811 B700                <1> 	mov bh, 0
  4380 00003813 6601DA              <1> 	add dx, bx
  4381 00003816 668B1D[CC360000]    <1> 	mov bx, [colorfont]
  4382 0000381D 668B0D[CA360000]    <1> 	mov cx, [posyvesa]
  4383 00003824 C605[A3280000]00    <1> 	mov byte [savefonton], 0
  4384 0000382B C3                  <1> 	ret
  4385 0000382C 08                  <1> charwidth db 8
  4386                              <1> vesafontsaver:
  4387 0000382D B000                <1> 	mov al, 0
  4388 0000382F B100                <1> 	mov cl, 0
  4389                              <1> vesafontsaver2:
  4390 00003831 668B17              <1> 	mov dx, [edi]
  4391 00003834 663B15[CC360000]    <1> 	cmp dx, [colorfont]
  4392 0000383B 742F                <1> 	je colorfontmatch
  4393                              <1> donecolormatch:
  4394 0000383D 81C702000000        <1> 	add edi, 2
  4395 00003843 D0C0                <1> 	rol al, 1
  4396 00003845 FEC1                <1> 	inc cl
  4397 00003847 80F908              <1> 	cmp cl, 8
  4398 0000384A 72E5                <1> 	jb vesafontsaver2
  4399 0000384C 8806                <1> 	mov [esi], al
  4400 0000384E 46                  <1> 	inc esi
  4401 0000384F FEC5                <1> 	inc ch
  4402 00003851 BA00000000          <1> 	mov edx, 0
  4403 00003856 668B15[C5360000]    <1> 	mov dx, [resolutionx2]
  4404 0000385D 01D7                <1> 	add edi, edx
  4405 0000385F 81EF10000000        <1> 	sub edi, 16
  4406 00003865 80FD10              <1> 	cmp ch, 16
  4407 00003868 72C3                <1> 	jb vesafontsaver
  4408 0000386A EB90                <1> 	jmp donefontvesa
  4409                              <1> colorfontmatch:
  4410 0000386C 0401                <1> 	add al, 1
  4411 0000386E EBCD                <1> 	jmp donecolormatch
  4412                              <1> 	
  4413                              <1> showbmp:
  4414 00003870 668B06              <1> 	mov ax, [esi]
  4415 00003873 663D424D            <1> 	cmp ax, "BM"
  4416 00003877 0F858E000000        <1> 	jne near endedbmp
  4417 0000387D 8B3D[35220000]      <1> 	mov edi, [physbaseptr]
  4418 00003883 6689D0              <1> 	mov ax, dx
  4419 00003886 6689CB              <1> 	mov bx, cx
  4420 00003889 B900000000          <1> 	mov ecx, 0
  4421 0000388E BA00000000          <1> 	mov edx, 0
  4422 00003893 6689D9              <1> 	mov cx, bx
  4423 00003896 6689C2              <1> 	mov dx, ax
  4424 00003899 01D7                <1> 	add edi, edx
  4425 0000389B 01D7                <1> 	add edi, edx
  4426 0000389D BA00000000          <1> 	mov edx, 0
  4427 000038A2 668B15[C5360000]    <1> 	mov dx, [resolutionx2]
  4428 000038A9 41                  <1> 	inc ecx
  4429 000038AA 034E16              <1> 	add ecx, [esi + 22]
  4430                              <1> bmplocloop:
  4431 000038AD 01D7                <1> 	add edi, edx
  4432 000038AF E2FC                <1> 	loop bmplocloop
  4433 000038B1 29D7                <1> 	sub edi, edx
  4434 000038B3 8B5612              <1> 	mov edx, [esi + 18]
  4435 000038B6 8B4E16              <1> 	mov ecx, [esi + 22]
  4436 000038B9 8B460A              <1> 	mov eax, [esi + 10]
  4437 000038BC 8B5E02              <1> 	mov ebx, [esi + 2]
  4438 000038BF 01F3                <1> 	add ebx, esi
  4439 000038C1 891D[0C390000]      <1> 	mov [bmpend], ebx
  4440 000038C7 89D3                <1> 	mov ebx, edx
  4441 000038C9 01C6                <1> 	add esi, eax
  4442                              <1> ldxbmp:
  4443 000038CB 668B06              <1> 	mov ax, [esi]
  4444 000038CE 668907              <1> 	mov [edi], ax
  4445 000038D1 81C702000000        <1> 	add edi, 2
  4446 000038D7 81C602000000        <1> 	add esi, 2
  4447 000038DD 3B35[0C390000]      <1> 	cmp esi, [bmpend]
  4448 000038E3 7726                <1> 	ja endedbmp
  4449 000038E5 4A                  <1> 	dec edx
  4450 000038E6 81FA00000000        <1> 	cmp edx, 0
  4451 000038EC 77DD                <1> 	ja ldxbmp
  4452 000038EE BA00000000          <1> 	mov edx, 0
  4453 000038F3 668B15[C5360000]    <1> 	mov dx, [resolutionx2]
  4454 000038FA 29DF                <1> 	sub edi, ebx
  4455 000038FC 29DF                <1> 	sub edi, ebx
  4456 000038FE 29D7                <1> 	sub edi, edx
  4457 00003900 49                  <1> 	dec ecx
  4458 00003901 89DA                <1> 	mov edx, ebx
  4459 00003903 81F900000000        <1> 	cmp ecx, 0
  4460 00003909 77C0                <1> 	ja ldxbmp
  4461                              <1> endedbmp:
  4462 0000390B C3                  <1> 	ret
  4463                              <1> 	
  4464 0000390C 00000000            <1> 	bmpend dd 0
  4465                              <1> 
  4466                              <1> ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;Here are some vars;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
  4467 00003910 00000000            <1> 	showstringesi dw 0,0
  4468 00003914 00                  <1> 	mouseon db 0
  4469 00003915 737461727400        <1> 	start	db "start",0
  4470 0000391B 536F6C6C65724F5300  <1> 	gotomenu db "SollerOS",0
  4471 00003924 426F6F2100          <1> 	boomsg db "Boo!",0
  4472 00003929 5061636D616E207761- <1> 	pacmsg	db "Pacman was easy to draw.",0
  4473 00003932 73206561737920746F- <1>
  4474 0000393B 20647261772E00      <1>
  4475 00003942 4F6D206E6F6D206E6F- <1> 	pacnom  db "Om nom nom nom",0
  4476 0000394B 6D206E6F6D00        <1>
  4477 00003951 77696E646F77732073- <1> 	winmsg	db "windows sucks",0
  4478 0000395A 75636B7300          <1>
  4479 0000395F 5800                <1> 	xmsg db "X",0
  4480 00003961 0000                <1> 	icon dw 0	;pointer to icon
  4481 00003963 00000000            <1> 	codepointer dw 0,0 ;pointer to code
  4482 00003967 00                  <1> 	iconselected db 0
  4483                              <1> 	
  4484                              <1> 	boo:
  4485 00003968 BE[24390000]        <1> 		mov esi, boomsg
  4486 0000396D 66BA6400            <1> 		mov dx, 100
  4487 00003971 66B94001            <1> 		mov cx, 320
  4488 00003975 BB00000000          <1> 		mov ebx, 0
  4489 0000397A 66B80000            <1> 		mov ax, 0
  4490 0000397E E9E6F8FFFF          <1> 		jmp showstring
  4491                              <1> 
  4492                              <1> 	pacmannomnom:
  4493 00003983 BE[42390000]        <1> 		mov esi, pacnom
  4494 00003988 66BA8200            <1> 		mov dx, 130
  4495 0000398C 66B93C00            <1> 		mov cx, 60
  4496 00003990 BB00000000          <1> 		mov ebx, 0
  4497 00003995 66B80000            <1> 		mov ax, 0
  4498 00003999 E9CBF8FFFF          <1> 		jmp showstring	
  4499                              <1> 	
  4500                              <1> 	noie:
  4501 0000399E BE[323A0000]        <1> 		mov esi, termwindow
  4502 000039A3 66BA0000            <1> 		mov dx, 0
  4503 000039A7 66B90000            <1> 		mov cx, 0
  4504 000039AB BB[140D0000]        <1> 		mov ebx, nwcmd
  4505                              <1> ;;		mov ebx, internettest
  4506 000039B0 891D[FA020000]      <1> 		mov [user2codepoint], ebx
  4507 000039B6 66B80000            <1> 		mov ax, 0
  4508 000039BA E8FFF8FFFF          <1> 		call showwindow
  4509                              <1> ;;		jmp internettest
  4510 000039BF E950D3FFFF          <1> 		jmp nwcmd
  4511 000039C4 C3                  <1> 		ret
  4512                              <1> 
  4513                              <1> 	gotomenuboot:
  4514 000039C5 BE[323A0000]        <1> 		mov esi, termwindow
  4515 000039CA 66BA0000            <1> 		mov dx, 0
  4516 000039CE 66B90000            <1> 		mov cx, 0
  4517 000039D2 BB[5A0C0000]        <1> 		mov ebx, os
  4518 000039D7 891D[FA020000]      <1> 		mov [user2codepoint], ebx
  4519 000039DD 66B80000            <1> 		mov ax, 0
  4520 000039E1 E8D8F8FFFF          <1> 		call showwindow
  4521 000039E6 E96FD2FFFF          <1> jmp os
  4522 000039EB C3                  <1> 		ret
  4523                              <1> 
  4524                              <1> 	winblows:
  4525 000039EC BE[51390000]        <1> 		mov esi, winmsg
  4526 000039F1 66BA0000            <1> 		mov dx, 0
  4527 000039F5 668B0D[C1360000]    <1> 		mov cx, [resolutiony]
  4528 000039FC 6681E92000          <1> 		sub cx, 32
  4529 00003A01 BB00000000          <1> 		mov ebx, 0
  4530 00003A06 B400                <1> 		mov ah, 0
  4531 00003A08 B011                <1> 		mov al, 00010001b
  4532 00003A0A E85AF8FFFF          <1> 		call showstring
  4533 00003A0F BE[1B390000]        <1> 		mov esi, gotomenu
  4534 00003A14 668B0D[C1360000]    <1> 		mov cx, [resolutiony]
  4535 00003A1B 6681E93000          <1> 		sub cx, 48
  4536 00003A20 66BA0000            <1> 		mov dx, 0
  4537 00003A24 B400                <1> 		mov ah, 0
  4538 00003A26 B010                <1> 		mov al, 00010000b
  4539 00003A28 BB[C5390000]        <1> 		mov ebx, gotomenuboot
  4540 00003A2D E937F8FFFF          <1> 		jmp showstring
  4541                              <1> 
  4542 00003A32 8002E001            <1> 	termwindow:	dw 640,480	;;window size
  4543 00003A36 5445524D494E414C00  <1> 	termmsg:	db "TERMINAL",0	;;window title
  4544 00003A36 <incbin>            <1> interneticon: 	incbin 'source/precompiled/interneticon.pak'
  4545 00003A36 <incbin>            <1> wordicon: 	incbin 'source/precompiled/wordicon.pak'
  4546 00003A36 <incbin>            <1> pacmanpellet: incbin 'source/precompiled/pacmanpellet.pak'
  4547 00003A36 <incbin>            <1> ghostie	incbin 'source/precompiled/ghostie.pak'
  4548 00003A36 <incbin>            <1> pacman	incbin 'source/precompiled/pacman.pak'
  4549                                      ;%include 'source/network.asm'
  4550                                  	%include 'source/pci.asm'
  4551 00003CC9 00                  <1> pcibus		db 0
  4552 00003CCA 00                  <1> pcidevice	db 0
  4553 00003CCB 00                  <1> pcifunction	db 0
  4554 00003CCC 00                  <1> pciregister	db 0
  4555 00003CCD 00                  <1> pcireqtype db 0
  4556                              <1> 
  4557                              <1> getpciport:
  4558 00003CCE B001                <1> 	mov al, 1
  4559 00003CD0 A2[CD3C0000]        <1> 	mov [pcireqtype], al
  4560 00003CD5 E91E000000          <1> 	jmp searchpci
  4561                              <1> pcidump:
  4562 00003CDA B800000000          <1> 	mov eax, 0
  4563 00003CDF A2[CB3C0000]        <1> 	mov [pcifunction], al
  4564 00003CE4 A2[C93C0000]        <1> 	mov [pcibus], al
  4565 00003CE9 A2[CA3C0000]        <1> 	mov [pcidevice], al
  4566 00003CEE A2[CD3C0000]        <1> 	mov [pcireqtype], al
  4567 00003CF3 E900000000          <1> 	jmp searchpci
  4568                              <1> searchpci:		;;return in ebx, start X in pciX
  4569 00003CF8 B000                <1> 	mov al, 0
  4570 00003CFA A2[CC3C0000]        <1> 	mov [pciregister], al
  4571 00003CFF E84F010000          <1> 	call getpciaddr
  4572 00003D04 BAF80C0000          <1> 	mov edx, 0xCF8
  4573 00003D09 EF                  <1> 	out dx, eax	;;request pci config
  4574 00003D0A BAFC0C0000          <1> 	mov edx, 0xCFC
  4575 00003D0F ED                  <1> 	in eax, dx 	;;read in pci config
  4576 00003D10 3D0000FFFF          <1> 	cmp eax, 0xFFFF0000
  4577 00003D15 0F8237000000        <1> 	jb near checkpcidevice
  4578                              <1> searchpciret:
  4579                              <1> nextpcidevice:
  4580 00003D1B B000                <1> 	mov al, 0
  4581 00003D1D A2[CB3C0000]        <1> 	mov [pcifunction], al
  4582 00003D22 A0[CA3C0000]        <1> 	mov al, [pcidevice]
  4583 00003D27 3C1F                <1> 	cmp al, 11111b
  4584 00003D29 0F83B8000000        <1> 	jae near nextpcibus
  4585 00003D2F FEC0                <1> 	inc al
  4586 00003D31 A2[CA3C0000]        <1> 	mov [pcidevice], al
  4587 00003D36 EBC0                <1> 	jmp searchpci
  4588 00003D38 A0[CB3C0000]        <1> 	mov al, [pcifunction]
  4589 00003D3D 3C07                <1> 	cmp al, 111b
  4590 00003D3F 0F83D6FFFFFF        <1> 	jae near nextpcidevice
  4591 00003D45 FEC0                <1> 	inc al
  4592 00003D47 A2[CB3C0000]        <1> 	mov [pcifunction], al
  4593 00003D4C EBAA                <1> 	jmp searchpci
  4594 00003D4E 00000000            <1> pcitype: db 0,0,0,0
  4595                              <1> checkpcidevice:
  4596 00003D52 B000                <1> 	mov al, 0
  4597 00003D54 3805[CD3C0000]      <1> 	cmp [pcireqtype], al
  4598 00003D5A 0F842B000000        <1> 	je near dumppcidevice
  4599 00003D60 B008                <1> 	mov al, 0x08
  4600 00003D62 A2[CC3C0000]        <1> 	mov [pciregister], al	;;class code, subclass, revision id
  4601 00003D67 E8E7000000          <1> 	call getpciaddr
  4602 00003D6C BAF80C0000          <1> 	mov edx, 0xCF8
  4603 00003D71 EF                  <1> 	out dx, eax
  4604 00003D72 BAFC0C0000          <1> 	mov edx, 0xCFC
  4605 00003D77 ED                  <1> 	in eax, dx
  4606 00003D78 C1C008              <1> 	rol eax, 8
  4607 00003D7B 8A1D[4E3D0000]      <1> 	mov bl, [pcitype]
  4608 00003D81 38D8                <1> 	cmp al, bl
  4609 00003D83 0F8480000000        <1> 	je near foundpciaddr
  4610 00003D89 EB90                <1> 	jmp searchpciret
  4611                              <1> dumppcidevice:
  4612 00003D8B B000                <1> 	mov al, 0
  4613 00003D8D A2[CC3C0000]        <1> 	mov [pciregister], al
  4614 00003D92 E8BC000000          <1> 	call getpciaddr
  4615 00003D97 89C1                <1> 	mov ecx, eax
  4616 00003D99 C605[CD100000]03    <1> 	mov byte [firsthexshown],3
  4617 00003DA0 E829D3FFFF          <1> 	call showhex
  4618                              <1> dumppcidevicelp:
  4619 00003DA5 A2[CC3C0000]        <1> 	mov [pciregister], al
  4620 00003DAA E8A4000000          <1> 	call getpciaddr
  4621 00003DAF BAF80C0000          <1> 	mov edx, 0xCF8
  4622 00003DB4 EF                  <1> 	out dx, eax
  4623 00003DB5 BAFC0C0000          <1> 	mov edx, 0xCFC
  4624 00003DBA ED                  <1> 	in eax, dx
  4625 00003DBB 89C1                <1> 	mov ecx, eax
  4626 00003DBD A0[CC3C0000]        <1> 	mov al, [pciregister]
  4627 00003DC2 0404                <1> 	add al, 4
  4628 00003DC4 3C3C                <1> 	cmp al, 0x3C
  4629 00003DC6 730E                <1> 	jae dumppcidn
  4630 00003DC8 C605[CD100000]00    <1> 	mov byte [firsthexshown],0
  4631 00003DCF E8FAD2FFFF          <1> 	call showhex
  4632 00003DD4 EBCF                <1> 	jmp dumppcidevicelp
  4633                              <1> dumppcidn:
  4634 00003DD6 C605[CD100000]02    <1> 	mov byte [firsthexshown],2
  4635 00003DDD E8ECD2FFFF          <1> 	call showhex
  4636 00003DE2 E934FFFFFF          <1> 	jmp searchpciret
  4637                              <1> nextpcibus:
  4638 00003DE7 B000                <1> 	mov al, 0
  4639 00003DE9 A2[CA3C0000]        <1> 	mov [pcidevice], al
  4640 00003DEE A0[C93C0000]        <1> 	mov al, [pcibus]
  4641 00003DF3 3C7F                <1> 	cmp al, 1111111b
  4642 00003DF5 730C                <1> 	jae donesearchpci
  4643 00003DF7 FEC0                <1> 	inc al
  4644 00003DF9 A2[C93C0000]        <1> 	mov [pcibus], al
  4645 00003DFE E9F5FEFFFF          <1> 	jmp searchpci
  4646                              <1> donesearchpci:
  4647 00003E03 BA00000000          <1> 	mov edx, 0
  4648 00003E08 C3                  <1> 	ret
  4649                              <1> foundpciaddr:
  4650 00003E09 B010                <1> 	mov al, 0x10
  4651 00003E0B A2[CC3C0000]        <1> 	mov [pciregister], al
  4652                              <1> findpciioaddr:
  4653 00003E10 E83E000000          <1> 	call getpciaddr
  4654 00003E15 BAF80C0000          <1> 	mov edx, 0xCF8
  4655 00003E1A EF                  <1> 	out dx, eax
  4656 00003E1B BAFC0C0000          <1> 	mov edx, 0xCFC
  4657 00003E20 ED                  <1> 	in eax, dx
  4658 00003E21 89C3                <1> 	mov ebx, eax
  4659 00003E23 81E301000000        <1> 	and ebx, 1
  4660 00003E29 81FB00000000        <1> 	cmp ebx, 0
  4661 00003E2F 0F8408000000        <1> 	je near notpciioaddr
  4662 00003E35 2D01000000          <1> 	sub eax, 1
  4663 00003E3A 89C2                <1> 	mov edx, eax
  4664 00003E3C C3                  <1> 	ret
  4665                              <1> notpciioaddr:
  4666 00003E3D A0[CC3C0000]        <1> 	mov al, [pciregister]
  4667 00003E42 0404                <1> 	add al, 4
  4668 00003E44 3C28                <1> 	cmp al, 0x28
  4669 00003E46 0F87CFFEFFFF        <1> 	ja near searchpciret
  4670 00003E4C A2[CC3C0000]        <1> 	mov [pciregister], al
  4671 00003E51 EBBD                <1> 	jmp findpciioaddr
  4672                              <1> getpciaddr:		;;puts it in eax and ebx
  4673 00003E53 B800000000          <1> 			mov eax, 0
  4674 00003E58 BB00000080          <1> 			mov ebx, 0x80000000
  4675 00003E5D A0[C93C0000]        <1> 			mov al, [pcibus]
  4676 00003E62 C1E010              <1> 			shl eax, 16
  4677 00003E65 01C3                <1> 			add ebx, eax
  4678 00003E67 B800000000          <1> 			mov eax, 0
  4679 00003E6C A0[CA3C0000]        <1> 			mov al, [pcidevice]
  4680 00003E71 C1E00B              <1> 			shl eax, 11
  4681 00003E74 01C3                <1> 			add ebx, eax
  4682 00003E76 B800000000          <1> 			mov eax, 0
  4683 00003E7B A0[CB3C0000]        <1> 			mov al, [pcifunction]
  4684 00003E80 C1E008              <1> 			shl eax, 8
  4685 00003E83 01C3                <1> 			add ebx, eax
  4686 00003E85 B800000000          <1> 			mov eax, 0
  4687 00003E8A A0[CC3C0000]        <1> 			mov al, [pciregister]
  4688 00003E8F 01C3                <1> 			add ebx, eax
  4689 00003E91 89D8                <1> 			mov eax, ebx
  4690 00003E93 C3                  <1> 			ret
  4691                                  	;%include 'source/process.asm'
  4692                                      %include 'source/disk.asm'
  4693                              <1> ;;disk.asm - new - using lba
  4694                              <1> loadfile:	;;loads a file with the name buffer's location in edi into location in esi
  4695 00003E94 803F00              <1> 	cmp byte [edi], 0
  4696 00003E97 0F8440000000        <1> 	je near nofileload
  4697 00003E9D 89FA                <1> 	mov edx, edi
  4698 00003E9F BB[E03F0000]        <1> 	mov ebx, diskfileindex
  4699                              <1> nextnamechar:
  4700 00003EA4 8A07                <1> 	mov al, [edi]
  4701 00003EA6 8A23                <1> 	mov ah, [ebx]
  4702 00003EA8 47                  <1> 	inc edi
  4703 00003EA9 43                  <1> 	inc ebx
  4704 00003EAA 88C1                <1> 	mov cl, al
  4705 00003EAC 08E1                <1> 	or cl, ah
  4706 00003EAE 80F900              <1> 	cmp cl, 0
  4707 00003EB1 7430                <1> 	je equalfilenames
  4708 00003EB3 80F920              <1> 	cmp cl, ' '
  4709 00003EB6 742B                <1> 	je equalfilenames
  4710 00003EB8 80FC00              <1> 	cmp ah, 0
  4711 00003EBB 7410                <1> 	je nextfilename
  4712 00003EBD 3C00                <1> 	cmp al, 0
  4713 00003EBF 740C                <1> 	je nextfilename
  4714 00003EC1 38E0                <1> 	cmp al, ah
  4715 00003EC3 74DF                <1> 	je nextnamechar
  4716                              <1> getebxzero:
  4717 00003EC5 8A23                <1> 	mov ah, [ebx]
  4718 00003EC7 43                  <1> 	inc ebx
  4719 00003EC8 80FC00              <1> 	cmp ah, 0
  4720 00003ECB 75F8                <1> 	jne getebxzero
  4721                              <1> nextfilename:
  4722 00003ECD 81C308000000        <1> 	add ebx, 8		;;next descriptor
  4723 00003ED3 89D7                <1> 	mov edi, edx
  4724 00003ED5 81FB[39400000]      <1> 	cmp ebx, enddiskfileindex
  4725 00003EDB 72C7                <1> 	jb nextnamechar
  4726                              <1> nofileload:
  4727 00003EDD BA94010000          <1> 	mov edx, 404	;;indicate not found error
  4728 00003EE2 C3                  <1> 	ret
  4729                              <1> equalfilenames:
  4730 00003EE3 8B4304              <1> 	mov eax, [ebx + 4] 	;;put file size in eax
  4731 00003EE6 8B1B                <1> 	mov ebx, [ebx]		;;put file beginning in ebx
  4732 00003EE8 031D[43000000]      <1> 	add ebx, [lbaad]	;;add offset to solleros
  4733 00003EEE B900000000          <1> 	mov ecx, 0
  4734 00003EF3 88C1                <1> 	mov cl, al			;;get excess number of sectors
  4735 00003EF5 D0E1                <1> 	shl cl, 1
  4736 00003EF7 D0E9                <1> 	shr cl, 1			;;cut off at 128
  4737 00003EF9 29C8                <1> 	sub eax, ecx		;;get rid of excess sectors
  4738 00003EFB B500                <1> 	mov ch, 0			;;drive 0
  4739 00003EFD C1E807              <1> 	shr eax, 7			;;get number of 128 sector tracks
  4740                              <1> loaddiskfile:		;;tracks in eax, excess sectors in cl, drive in ch, buffer in esi, address in ebx
  4741 00003F00 A3[3E3F0000]        <1> 	mov [filetracks], eax
  4742 00003F05 89F7                <1> 	mov edi, esi		;;just in case cl is 0
  4743 00003F07 89DA                <1> 	mov edx, ebx
  4744 00003F09 80F900              <1> 	cmp cl, 0
  4745 00003F0C 7405                <1> 	je copytracksforfile
  4746 00003F0E E831000000          <1> 	call diskr		;;take care of excess sectors
  4747                              <1> copytracksforfile:
  4748 00003F13 A1[3E3F0000]        <1> 	mov eax, [filetracks]
  4749 00003F18 3D00000000          <1> 	cmp eax, 0
  4750 00003F1D 7419                <1> 	je donecopyfile
  4751 00003F1F 48                  <1> 	dec eax
  4752 00003F20 A3[3E3F0000]        <1> 	mov [filetracks], eax
  4753 00003F25 89D3                <1> 	mov ebx, edx	;;get end lba
  4754 00003F27 B180                <1> 	mov cl, 0x80
  4755 00003F29 8A2D[42000000]      <1> 	mov ch, [DriveNumber]
  4756 00003F2F 89FE                <1> 	mov esi, edi	;;reset buffer
  4757 00003F31 E80E000000          <1> 	call diskr
  4758 00003F36 EBDB                <1> 	jmp copytracksforfile
  4759                              <1> donecopyfile:
  4760 00003F38 BA00000000          <1> 	mov edx, 0	;;no error
  4761 00003F3D C3                  <1> 	ret
  4762                              <1> 	
  4763 00003F3E 00000000            <1> filetracks dd 0
  4764                              <1> 	
  4765 00003F42 6400                <1> segments dw 100
  4766                              <1> 
  4767                              <1> diskr:		;;sector count in cl, disk number in ch, 28 bit address in first 28 bits of ebx, buffer in esi, puts end buffer in edi and end lba in edx
  4768 00003F44 8935[DC3F0000]      <1> 	mov [bufferstartesi], esi
  4769 00003F4A 891D[D83F0000]      <1> 	mov [lbaadstartebx], ebx
  4770 00003F50 BA00000000          <1> 	mov edx, 0
  4771 00003F55 88CA                <1> 	mov dl, cl
  4772 00003F57 01DA                <1> 	add edx, ebx
  4773 00003F59 8915[D43F0000]      <1> 	mov [lbaadend], edx
  4774 00003F5F 66B80000            <1> 	mov ax, 0
  4775 00003F63 66BAF101            <1> 	mov dx, 0x1F1
  4776 00003F67 EE                  <1> 	out dx, al	;;send null byte to port
  4777 00003F68 6642                <1> 	inc dx	;;0x1F2
  4778 00003F6A 88C8                <1> 	mov al, cl	;;get sector count
  4779 00003F6C EE                  <1> 	out dx, al	;;send sector count
  4780 00003F6D 6642                <1> 	inc dx	;;0x1F3
  4781 00003F6F 88D8                <1> 	mov al, bl	;;get first 8 bits of address
  4782 00003F71 EE                  <1> 	out dx, al	;;send them
  4783 00003F72 6642                <1> 	inc dx	;;0x1F4
  4784 00003F74 C1CB08              <1> 	ror ebx, 8	;;get next 8 bits
  4785 00003F77 88D8                <1> 	mov al, bl
  4786 00003F79 EE                  <1> 	out dx, al
  4787 00003F7A 6642                <1> 	inc dx	;;0x1F5
  4788 00003F7C C1CB08              <1> 	ror ebx, 8	;;again
  4789 00003F7F 88D8                <1> 	mov al, bl
  4790 00003F81 EE                  <1> 	out dx, al
  4791 00003F82 6642                <1> 	inc dx	;;0x1F6
  4792 00003F84 C1CB08              <1> 	ror ebx, 8
  4793 00003F87 88D8                <1> 	mov al, bl
  4794 00003F89 240F                <1> 	and al, 00001111b	;;last 4 bits of address
  4795 00003F8B 0CE0                <1> 	or al, 0xE0			;;majic number
  4796 00003F8D C0E504              <1> 	shl ch, 4
  4797 00003F90 08E8                <1> 	or al, ch
  4798 00003F92 EE                  <1> 	out dx, al			;;send drive indicator, magic bits, and highest 4 bits of address
  4799 00003F93 6642                <1> 	inc dx	;;0x1F7
  4800 00003F95 B020                <1> 	mov al, 0x20
  4801 00003F97 EE                  <1> 	out dx, al			;;execute read command
  4802                              <1> diskrwait:
  4803 00003F98 66BAF701            <1> 	mov dx, 0x1F7
  4804 00003F9C EC                  <1> 	in al, dx
  4805 00003F9D 2408                <1> 	and al, 0x08
  4806 00003F9F 3C08                <1> 	cmp al, 0x08
  4807 00003FA1 75F5                <1> 	jne diskrwait
  4808 00003FA3 88CD                <1> 	mov ch, cl	;;move sector data into ch, multiplying it by 256
  4809 00003FA5 B100                <1> 	mov cl, 0
  4810                              <1> diskdataread:
  4811 00003FA7 66BAF001            <1> 	mov dx, 0x1F0
  4812 00003FAB 66ED                <1> 	in ax, dx
  4813 00003FAD 668906              <1> 	mov [esi], ax
  4814 00003FB0 81C602000000        <1> 	add esi, 2
  4815 00003FB6 6649                <1> 	dec cx
  4816 00003FB8 6681F90000          <1> 	cmp cx, 0
  4817 00003FBD 75E8                <1> 	jne diskdataread		;;read all sectors
  4818 00003FBF 89F7                <1> 	mov edi, esi
  4819 00003FC1 8B15[D43F0000]      <1> 	mov edx, [lbaadend]
  4820 00003FC7 8B35[DC3F0000]      <1> 	mov esi, [bufferstartesi]
  4821 00003FCD 8B1D[D83F0000]      <1> 	mov ebx, [lbaadstartebx]
  4822 00003FD3 C3                  <1> 	ret
  4823                              <1> 	
  4824 00003FD4 00000000            <1> lbaadend dd 0
  4825 00003FD8 00000000            <1> lbaadstartebx dd 0
  4826 00003FDC 00000000            <1> bufferstartesi dd 0
  4827                                      %include 'fileindex.asm'
  4828                              <1> diskfileindex:
  4829 00003FE0 736F6C6C65726F732E- <1> db "solleros.bmp",0
  4830 00003FE9 626D7000            <1>
  4831 00003FED 25000000            <1> dd (f0-$$)/512
  4832 00003FF1 B0020000            <1> dd (f1-f0)/512
  4833 00003FF5 736F6C6C65726F732E- <1> db "solleros.txt",0
  4834 00003FFE 74787400            <1>
  4835 00004002 D5020000            <1> dd (f1-$$)/512
  4836 00004006 01000000            <1> dd (f2-f1)/512
  4837 0000400A 74656C7900          <1> db "tely",0
  4838 0000400F D6020000            <1> dd (f2-$$)/512
  4839 00004013 01000000            <1> dd (f3-f2)/512
  4840 00004017 74696D6500          <1> db "time",0
  4841 0000401C D7020000            <1> dd (f3-$$)/512
  4842 00004020 01000000            <1> dd (f4-f3)/512
  4843 00004024 7475746F7269616C2E- <1> db "tutorial.bat",0
  4844 0000402D 62617400            <1>
  4845 00004031 D8020000            <1> dd (f4-$$)/512
  4846 00004035 02000000            <1> dd (f5-f4)/512
  4847                              <1> enddiskfileindex:
  4848                              <1> 
  4849                                      %include 'source/msg.asm'
  4850 00004039 6578697400          <1> 	exitmsg db	"exit",0
  4851 0000403E 50726F6772616D2022- <1> 	notfound1 db "Program ",34,0
  4852 00004047 00                  <1>
  4853 00004048 22206E6F7420666F75- <1> 	notfound2 db  34," not found.",13,10,0
  4854 00004051 6E642E0D0A00        <1>
  4855 00004057 456E74657220506173- <1> 	pwdask	db	"Enter Password:",0
  4856 00004060 73776F72643A00      <1>
  4857 00004067 70617373776F726400  <1> 	pwd	db	"password",0
  4858 00004070 5B7573657240536F6C- <1> 	cmd	db	"[user@SollerOS-v0.9.0$]",0
  4859 00004079 6C65724F532D76302E- <1>
  4860 00004082 392E30245D00        <1>
  4861 00004088 0D0A00              <1> 	line	db	13,10,0
  4862 0000408B 536F6C6C65724F5320- <1>     msg:       db "SollerOS Beta version 0.9.0 - compiled by Jeremy Soller.",13,10,0
  4863 00004094 426574612076657273- <1>
  4864 0000409D 696F6E20302E392E30- <1>
  4865 000040A6 202D20636F6D70696C- <1>
  4866 000040AF 6564206279204A6572- <1>
  4867 000040B8 656D7920536F6C6C65- <1>
  4868 000040C1 722E0D0A00          <1>
  4869 000040C6 506C65617365207365- <1>     wrongmsg:  db "Please select one of the options above.",13,10,"You selected: ",0
  4870 000040CF 6C656374206F6E6520- <1>
  4871 000040D8 6F6620746865206F70- <1>
  4872 000040E1 74696F6E732061626F- <1>
  4873 000040EA 76652E0D0A596F7520- <1>
  4874 000040F3 73656C65637465643A- <1>
  4875 000040FC 2000                <1>
  4876 000040FE 546F2072756E207468- <1> 	batchmsg db "To run this batch type runbatch and press enter.",10,13,0
  4877 00004107 697320626174636820- <1>
  4878 00004110 747970652072756E62- <1>
  4879 00004119 6174636820616E6420- <1>
  4880 00004122 707265737320656E74- <1>
  4881 0000412B 65722E0A0D00        <1>
  4882                              <1> 	
  4883 0000412B <incbin>            <1> fonts:	incbin 'source/precompiled/fonts.pak'
  4884                              <1> fontend2:
  4885                              <1> mcursor:
  4886 00004941 01                  <1> 	db	00000001b
  4887 00004942 81                  <1> 	db	10000001b
  4888 00004943 C1                  <1> 	db	11000001b
  4889 00004944 E1                  <1> 	db	11100001b
  4890 00004945 F1                  <1> 	db	11110001b
  4891 00004946 F9                  <1> 	db	11111001b
  4892 00004947 FD                  <1> 	db	11111101b
  4893 00004948 FF                  <1> 	db	11111111b
  4894 00004949 F9                  <1> 	db	11111001b
  4895 0000494A B9                  <1> 	db	10111001b
  4896 0000494B 39                  <1> 	db	00111001b
  4897 0000494C 1C                  <1> 	db	00011100b
  4898 0000494D 1C                  <1> 	db	00011100b
  4899 0000494E 0E                  <1> 	db	00001110b
  4900 0000494F 0E                  <1> 	db	00001110b
  4901 00004950 0C                  <1> 	db	00001100b
  4902                              <1> fontend:
  4903                              <1> 
  4904                              <1> cursorbmp:
  4905 00004951 0100000000000000    <1> 	db	1,0,0,0,0,0,0,0
  4906 00004959 0101000000000000    <1> 	db	1,1,0,0,0,0,0,0
  4907 00004961 0101010000000000    <1> 	db	1,1,1,0,0,0,0,0
  4908 00004969 0101010100000000    <1> 	db	1,1,1,1,0,0,0,0
  4909 00004971 0101010101000000    <1> 	db	1,1,1,1,1,0,0,0
  4910 00004979 0101010101010000    <1> 	db	1,1,1,1,1,1,0,0
  4911 00004981 0101010101010100    <1> 	db	1,1,1,1,1,1,1,0
  4912 00004989 0101010101010101    <1> 	db	1,1,1,1,1,1,1,1
  4913 00004991 0101010101010000    <1> 	db	1,1,1,1,1,1,0,0
  4914 00004999 0101000101010000    <1> 	db	1,1,0,1,1,1,0,0
  4915 000049A1 0100000101010000    <1> 	db	1,0,0,1,1,1,0,0
  4916 000049A9 0000000001010100    <1> 	db	0,0,0,0,1,1,1,0
  4917 000049B1 0000000001010100    <1> 	db	0,0,0,0,1,1,1,0
  4918 000049B9 0000000000010101    <1> 	db	0,0,0,0,0,1,1,1
  4919 000049C1 0000000000010101    <1> 	db	0,0,0,0,0,1,1,1
  4920 000049C9 0000000000010100    <1> 	db	0,0,0,0,0,1,1,0
  4921                              <1> cursorbmpend:
  4922                              <1> ;;; ZEROS-THESE DO NOT NEED TO BE COMPILED BUT ADDRESSES SHOULD BE USED
  4923                              <1> [section .bss]
  4924                              <1> 
  4925                              <1> graphicstable: ;w type, dw datalocation, w locationx, w locationy, w selected, dw code
  4926 00000000 <res 00000200>      <1> 	resb 200h
  4927                              <1> 	graphicstableend:
  4928                              <1> mousecolorbuf: ;where the gui under the mouse is stored
  4929 00000200 <res 00000100>      <1> 	resb 256
  4930                              <1> mcolorend:
  4931 00000300 <res 00000001>      <1> IFON resb 1
  4932 00000301 <res 00000064>      <1> IFTRUE resb 100
  4933 00000365 <res 00000004>      <1> BATCHPOS resb 4
  4934 00000369 <res 00000001>      <1> BATCHISON resb 1
  4935 0000036A <res 00000001>      <1> LOOPON resb 1
  4936 0000036B <res 00000004>      <1> LOOPPOS	resb 4
  4937 0000036F <res 00000200>      <1> fileindex: resb 200h
  4938                              <1> fileindexend:
  4939 0000056F <res 00000500>      <1> variables: 	resb 500h
  4940 00000A6F <res 00000001>      <1> varend: resb 1
  4941 00000A70 <res 00000200>      <1> buftxt: resb 200h
  4942 00000C70 <res 00000014>      <1> buf2:	resb 20
  4943 00000C84 <res 00000001>      <1> numbuf: resb 1
  4944 00000C85 <res 000012C0>      <1> videobuf2 	resb 0x12C0
  4945                              <1> videobufend:
  4946 00001F45 <res 000000C8>      <1> 	resb 200
  4947                              <1> 
  4948                              <1> VBEMODEBLOCK:
  4949 0000200D <res 00000004>      <1> vbesignature 	resb 4 	;VBE Signature
  4950 00002011 <res 00000002>      <1> vbeversion  		resb 2    ;VBE Version
  4951 00002013 <res 00000004>      <1> oemstringptr  		resb 4  ;Pointer to OEM String
  4952 00002017 <res 00000004>      <1> capabilities 	resb 4   	;Capabilities of graphics cont.
  4953 0000201B <res 00000004>      <1> videomodeptr 		resb 4 	;Pointer to Video Mode List
  4954 0000201F <res 00000002>      <1> totalmemory   		resb 2     ;number of 64Kb memory blocks
  4955 00002021 <res 00000002>      <1> oemsoftwarerev  	resb 2		;VBE implementation Software revision
  4956 00002023 <res 00000004>      <1> oemvendornameptr 	resb 4 	;Pointer to Vendor Name String
  4957 00002027 <res 00000004>      <1> oemproductnameptr 	resb 4 	;Pointer to Product Name String
  4958 0000202B <res 00000004>      <1> oemproductrevptr 	resb 4  	;Pointer to Product Revision String
  4959 0000202F <res 000000DE>      <1> reserved	resb 222 	;Reserved for VBE implementation scratch area
  4960 0000210D <res 00000100>      <1> oemdata 	resb 256 	;Data Area for OEM Strings
  4961                              <1> 
  4962                              <1> 
  4963                              <1> VBEMODEINFOBLOCK:
  4964                              <1> ;Mandatory information for all VBE revision
  4965 0000220D <res 00000002>      <1> modeattributes   resb 2  ;Mode attributes
  4966 0000220F <res 00000001>      <1> winaattributes   resb 1  ;Window A attributes
  4967 00002210 <res 00000001>      <1> winbattributes   resb 1  ;Window B attributes
  4968 00002211 <res 00000002>      <1> wingranularity   resb 2  ;Window granularity
  4969 00002213 <res 00000002>      <1> winsize          resb 2  ;Window size
  4970 00002215 <res 00000002>      <1> winasegment      resb 2  ;Window A start segment
  4971 00002217 <res 00000002>      <1> winbsegment      resb 2  ;Window B start segment
  4972 00002219 <res 00000004>      <1> winfuncptr       resb 4  ;pointer to window function
  4973 0000221D <res 00000002>      <1> bytesperscanline resb 2  ;Bytes per scan line
  4974                              <1> 
  4975                              <1> ;Mandatory information for VBE 1.2 and above
  4976 0000221F <res 00000002>      <1> xresolution     resb 2	    ;Horizontal resolution in pixel or chars
  4977 00002221 <res 00000002>      <1> yresolution	resb 2        ;Vertical resolution in pixel or chars
  4978 00002223 <res 00000001>      <1> xcharsize       resb 1	    ;Character cell width in pixel
  4979 00002224 <res 00000001>      <1> ycharsize       resb 1	    ;Character cell height in pixel
  4980 00002225 <res 00000001>      <1> numberofplanes  resb 1	    ;Number of memory planes
  4981 00002226 <res 00000001>      <1> bitsperpixel    resb 1	    ;Bits per pixel
  4982 00002227 <res 00000001>      <1> numberofbanks   resb 1	    ;Number of banks
  4983 00002228 <res 00000001>      <1> memorymodel     resb 1	    ;Memory model type
  4984 00002229 <res 00000001>      <1> banksize        resb 1 	    ;Bank size in KB
  4985 0000222A <res 00000001>      <1> numberofimagepages    resb 1  ;Number of images
  4986 0000222B <res 00000001>      <1> reserved1       resb 1	    ;Reserved for page function
  4987                              <1> 
  4988                              <1> ;Direct Color fields (required for direct/6 and YUV/7 memory models)
  4989 0000222C <res 00000001>      <1> redmasksize		resb 1        ;Size of direct color red mask in bits
  4990 0000222D <res 00000001>      <1> redfieldposition	resb 1	    ;Bit position of lsb of red bask
  4991 0000222E <res 00000001>      <1> greenmasksize   	resb 1	    ;Size of direct color green mask in bits
  4992 0000222F <res 00000001>      <1> greenfieldposition	resb 1	    ;Bit position of lsb of green bask
  4993 00002230 <res 00000001>      <1> bluemasksize		resb 1      ;Size of direct color blue mask in bits
  4994 00002231 <res 00000001>      <1> bluefieldposition	resb 1	    ;Bit position of lsb of blue bask
  4995 00002232 <res 00000001>      <1> rsvdmasksize        resb 1	    ;Size of direct color reserved mask in bits
  4996 00002233 <res 00000001>      <1> rsvdfieldposition	resb 1	    ;Bit position of lsb of reserved bask
  4997 00002234 <res 00000001>      <1> directcolormodeinfo	resb 1	    ;Direct color mode attributes
  4998                              <1> 
  4999                              <1> ;Mandatory information for VBE 2.0 and above
  5000 00002235 <res 00000004>      <1> physbaseptr resb 4         ;Physical address for flat frame buffer
  5001 00002239 <res 00000004>      <1> offscreenmemoffset resb 4  ;Pointer to start of off screen memory
  5002 0000223D <res 00000002>      <1> offscreenmemsize resb 2      ;Amount of off screen memory in 1Kb units
  5003 0000223F <res 000000CE>      <1> reserved2 resb 206   ;Remainder of ModeInfoBlock
  5004                              <1> endbss:
  5005                              <1> [section .text]
  5006                                      %include 'files.asm'
  5007 000049D1 00<rept>            <1> align 512,db 0
  5008                              <1> f0:
  5009 000049D1 <incbin>            <1> incbin "included/solleros.bmp"
  5010 0005A9E6 00<rept>            <1> align 512,db 0
  5011                              <1> f1:
  5012 0005A9E6 <incbin>            <1> incbin "included/solleros.txt"
  5013 0005AB97 00<rept>            <1> align 512,db 0
  5014                              <1> f2:
  5015 0005AB97 <incbin>            <1> incbin "included/tely"
  5016 0005ADBD 00<rept>            <1> align 512,db 0
  5017                              <1> f3:
  5018 0005ADBD <incbin>            <1> incbin "included/time"
  5019 0005AF54 00<rept>            <1> align 512,db 0
  5020                              <1> f4:
  5021 0005AF54 <incbin>            <1> incbin "included/tutorial.bat"
  5022 0005B378 00<rept>            <1> align 512,db 0
  5023                              <1> f5:
