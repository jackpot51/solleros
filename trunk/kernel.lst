     1                                  [BITS 16]
     2                                      %include 'source/menu.asm'
     3                              <1>     ; MENU.ASM
     4 00000000 4A534F53            <1> db "JSOS"
     5 00000004 01000000            <1> dd 1
     6                              <1> menustart:	
     7 00000008 8CC8                <1> 	mov ax, cs
     8 0000000A 8ED8                <1> 	mov ds, ax
     9 0000000C 8EC0                <1> 	mov es, ax
    10 0000000E 8ED0                <1> 	mov ss, ax
    11 00000010 880E[2900]          <1> 	mov [DriveNumber], cl
    12 00000014 668916[2A00]        <1> 	mov [lbaad], edx
    13 00000019 B800A0              <1> 	mov ax, 0xA000
    14 0000001C 8EE8                <1> 	mov gs, ax
    15 0000001E B81200              <1> 	mov ax, 12h
    16 00000021 BB0000              <1> 	mov bx, 0
    17 00000024 CD10                <1> 	int 10h
    18 00000026 E90900              <1> 	jmp guiload
    19                              <1> 
    20 00000029 00                  <1> DriveNumber db 0
    21 0000002A 00000000            <1> lbaad dd 0
    22                              <1> 	
    23 0000002E 0000                <1> vesamode dw 0
    24 00000030 0000                <1> videomodecache dw 0
    25                              <1> 
    26                              <1> guiload:
    27 00000032 BE[6202]            <1> 	mov si, bootmsg
    28 00000035 E83301              <1> 	call printrm
    29 00000038 B80000              <1> 	mov ax, 0
    30 0000003B CD16                <1> 	int 16h
    31 0000003D 3C79                <1> 	cmp al, "y"
    32 0000003F 0F85F400            <1> 	jne near guiload2
    33                              <1> guiloadagain:
    34 00000043 B8004F              <1> 	mov ax, 04F00h
    35 00000046 BF[9050]            <1> 	mov di, VBEMODEBLOCK
    36 00000049 CD10                <1> 	int 10h
    37 0000004B BE[B250]            <1> 	mov si, reserved
    38 0000004E 81EE0200            <1> 	sub si, 2
    39                              <1> findvideomodes:
    40 00000052 81C60200            <1> 	add si, 2
    41 00000056 8B0C                <1> 	mov cx, [si]
    42 00000058 81F9FFFF            <1> 	cmp cx, 0xFFFF
    43 0000005C 0F840A00            <1> 	je near nextvmode
    44 00000060 81FE[9051]          <1> 	cmp si, oemdata
    45 00000064 0F83CF00            <1> 	jae near guiload2	;;kill if no valid list is found
    46 00000068 EBE8                <1> 	jmp findvideomodes 	
    47                              <1> ;;debug,shows vmodes available
    48                              <1> nextvmode:
    49 0000006A 81EE0200            <1> 	sub si, 2
    50 0000006E 81FE[B250]          <1> 	cmp si, reserved
    51 00000072 0F82CDFF            <1> 	jb near guiloadagain
    52 00000076 8B0C                <1> 	mov cx, [si]
    53 00000078 81F9FFFF            <1> 	cmp cx, 0xFFFF
    54 0000007C 0F84EAFF            <1> 	je near nextvmode
    55 00000080 81C10040            <1> 	add cx, 0x4000 		;;Linear Frame Buffer
    56 00000084 B8014F              <1> 	mov ax, 04F01h
    57 00000087 BF[9052]            <1> 	mov di, VBEMODEINFOBLOCK
    58 0000008A 890E[2E00]          <1> 	mov [vesamode], cx
    59 0000008E CD10                <1> 	int 10h
    60 00000090 A0[A952]            <1> 	mov al, [bitsperpixel]
    61 00000093 3C10                <1> 	cmp al, 16
    62 00000095 75D3                <1> 	jne nextvmode
    63 00000097 8936[3000]          <1> 	mov [videomodecache], si
    64 0000009B 80FC00              <1> 	cmp ah, 0
    65 0000009E 0F842200            <1> 	je near setvesamode
    66 000000A2 EBC6                <1> 	jmp nextvmode
    67 000000A4 0A0D49732074686973- <1> isthisvideook db 10,13,"Is this video mode OK?(y/n)",13,10,0
    68 000000AD 20766964656F206D6F- <1>
    69 000000B6 6465204F4B3F28792F- <1>
    70 000000BF 6E290D0A00          <1>
    71                              <1> setvesamode:
    72 000000C4 8B0E[A252]          <1> 	mov cx, [xresolution]
    73 000000C8 E8B800              <1> 	call decshow
    74 000000CB B078                <1> 	mov al, "x"
    75 000000CD E82001              <1> 	call char
    76 000000D0 8B0E[A452]          <1> 	mov cx, [yresolution]
    77 000000D4 E8AC00              <1> 	call decshow
    78 000000D7 B040                <1> 	mov al, "@"
    79 000000D9 E81401              <1> 	call char
    80 000000DC 8A0E[A952]          <1> 	mov cl, [bitsperpixel]
    81 000000E0 E8A000              <1> 	call decshow
    82 000000E3 BE[A400]            <1> 	mov si, isthisvideook
    83 000000E6 E88200              <1> 	call printrm
    84 000000E9 B80000              <1> 	mov ax, 0
    85 000000EC CD16                <1> 	int 16h
    86 000000EE 8B36[3000]          <1> 	mov si, [videomodecache]
    87 000000F2 3C79                <1> 	cmp al, "y"
    88 000000F4 0F8572FF            <1> 	jne near nextvmode
    89 000000F8 8B16[A252]          <1> 	mov dx, [xresolution]
    90 000000FC 8B0E[A452]          <1> 	mov cx, [yresolution]
    91 00000100 8916[D53A]          <1> 	mov [resolutionx], dx
    92 00000104 890E[D33A]          <1> 	mov [resolutiony], cx
    93 00000108 01D2                <1> 	add dx, dx
    94 0000010A 8916[D73A]          <1> 	mov [resolutionx2], dx
    95 0000010E BA0000              <1> 	mov dx, 0
    96 00000111 B90000              <1> 	mov cx, 0
    97 00000114 B8024F              <1> 	mov ax, 04F02h
    98 00000117 8B1E[2E00]          <1> 	mov bx, [vesamode]
    99 0000011B CD10                <1> 	int 10h		;;enter VESA mode
   100 0000011D C606[6A01]00        <1> 	mov byte [guinodo], 0
   101 00000122 6631C0              <1> 	xor eax, eax
   102 00000125 6631DB              <1> 	xor ebx, ebx
   103 00000128 6631C9              <1> 	xor ecx, ecx
   104 0000012B 6631D2              <1> 	xor edx, edx
   105 0000012E 6631F6              <1> 	xor esi, esi
   106 00000131 6631FF              <1> 	xor edi, edi	;;reset registers
   107 00000134 E94501              <1> 	jmp pmode
   108                              <1> guiload2:
   109 00000137 B9E001              <1> 	mov cx, 480
   110 0000013A BA8002              <1> 	mov dx, 640
   111 0000013D 8916[D53A]          <1> 	mov [resolutionx], dx
   112 00000141 01D2                <1> 	add dx, dx
   113 00000143 8916[D73A]          <1> 	mov [resolutionx2], dx
   114 00000147 890E[D33A]          <1> 	mov [resolutiony], cx
   115 0000014B B81200              <1> 	mov ax, 12h
   116 0000014E BB0000              <1> 	mov bx, 0
   117 00000151 CD10                <1> 	int 10h
   118 00000153 C606[6A01]01        <1> 	mov byte [guinodo], 1
   119 00000158 6631DB              <1> 	xor ebx, ebx
   120 0000015B 6631C9              <1> 	xor ecx, ecx
   121 0000015E 6631D2              <1> 	xor edx, edx
   122 00000161 6631F6              <1> 	xor esi, esi
   123 00000164 6631FF              <1> 	xor edi, edi
   124 00000167 E91201              <1> 	jmp pmode
   125                              <1> ;;	jmp gui ;;test vesa
   126                              <1> 
   127 0000016A 00                  <1> guinodo db 0
   128                              <1> 
   129                              <1>     printrm:			; 'si' comes in with string address
   130 0000016B BB0700              <1> 	    mov bx,07		; write to display
   131 0000016E B40E                <1> 	    mov ah,0Eh		; screen function
   132 00000170 8A04                <1>     prs2:    mov al,[si]         ; get next character
   133 00000172 3C00                <1> 	    cmp al,0		; look for terminator 
   134 00000174 7405                <1>             je finpr2		; zero byte at end of string
   135 00000176 CD10                <1> 	    int 10h		; write character to screen.    
   136 00000178 46                  <1>      	    inc si	     	; move to next character
   137 00000179 EBF5                <1> 	    jmp prs2		; loop
   138 0000017B C3                  <1>     finpr2: ret
   139                              <1> 
   140 0000017C 0000000000          <1> dcnm db 0,0,0,0,0
   141 00000181 0000                <1> dcnmend db 0,0
   142                              <1> 
   143                              <1> 
   144                              <1> decshow:
   145 00000183 BE[7C01]            <1> 	mov si, dcnm
   146                              <1> decclear:
   147 00000186 B030                <1> 	mov al, "0"
   148 00000188 8804                <1> 	mov [si], al
   149 0000018A 46                  <1> 	inc si
   150 0000018B 81FE[8101]          <1> 	cmp si, dcnmend
   151 0000018F 76F5                <1> 	jbe decclear
   152 00000191 4E                  <1> 	dec si
   153 00000192 E81500              <1> 	call convertrm
   154 00000195 BE[7C01]            <1> 	mov si, dcnm
   155                              <1> dectst:
   156 00000198 8A04                <1> 	mov al, [si]
   157 0000019A 46                  <1> 	inc si
   158 0000019B 81FE[8101]          <1> 	cmp si, dcnmend
   159 0000019F 7704                <1> 	ja dectstend
   160 000001A1 3C30                <1> 	cmp al, "0"
   161 000001A3 76F3                <1> 	jbe dectst
   162                              <1> dectstend:
   163 000001A5 4E                  <1> 	dec si
   164 000001A6 E8C2FF              <1> 	call printrm
   165 000001A9 C3                  <1> 	ret
   166                              <1> 	
   167                              <1> 	
   168                              <1> convertrm:
   169 000001AA 4E                  <1> 	dec si
   170 000001AB 89F3                <1> 	mov bx, si		;place to convert into must be in si, number to convert must be in cx
   171                              <1> cnvrtrm:
   172 000001AD 89DE                <1> 	mov si, bx
   173 000001AF 81EE0300            <1> 	sub si, 3
   174 000001B3 46                  <1> ten3rm:	inc si
   175 000001B4 81F9E803            <1> 	cmp cx, 1000
   176 000001B8 7208                <1> 	jb ten2rm
   177 000001BA 81E9E803            <1> 	sub cx, 1000
   178 000001BE FE04                <1> 	inc byte [si]
   179 000001C0 EBEB                <1> 	jmp cnvrtrm
   180 000001C2 46                  <1> ten2rm:	inc si
   181 000001C3 81F96400            <1> 	cmp cx, 100
   182 000001C7 7208                <1> 	jb ten1rm
   183 000001C9 81E96400            <1> 	sub cx, 100
   184 000001CD FE04                <1> 	inc byte [si]
   185 000001CF EBDC                <1> 	jmp cnvrtrm
   186 000001D1 46                  <1> ten1rm:	inc si
   187 000001D2 81F90A00            <1> 	cmp cx, 10
   188 000001D6 7208                <1> 	jb ten0rm
   189 000001D8 81E90A00            <1> 	sub cx, 10
   190 000001DC FE04                <1> 	inc byte [si]
   191 000001DE EBCD                <1> 	jmp cnvrtrm
   192 000001E0 46                  <1> ten0rm:	inc si
   193 000001E1 81F90100            <1> 	cmp cx, 1
   194 000001E5 7208                <1> 	jb tendnrm
   195 000001E7 81E90100            <1> 	sub cx, 1
   196 000001EB FE04                <1> 	inc byte [si]
   197 000001ED EBBE                <1> 	jmp cnvrtrm
   198                              <1> tendnrm:
   199 000001EF C3                  <1> 	ret
   200                              <1> 
   201                              <1> 
   202                              <1> 
   203                              <1> 
   204                              <1>     char: 		    ;char must be in al
   205 000001F0 BB0700              <1>            mov bx, 07
   206 000001F3 B40E                <1> 	   mov ah, 0Eh
   207 000001F5 CD10                <1> 	   int 10h
   208 000001F7 C3                  <1> 	    ret
   209                              <1> 
   210                              <1> 		shutdown:
   211 000001F8 0F20C0              <1> 			   mov eax, cr0
   212 000001FB 24FE                <1> 			   and al,0xFE     ; back to realmode
   213 000001FD 0F22C0              <1> 			   mov  cr0, eax   ; by toggling bit again
   214 00000200 FB                  <1> 			   sti
   215 00000201 B80053              <1> 			MOV AX, 5300h	; Shuts down APM-Machines.
   216 00000204 31DB                <1> 			XOR BX, BX	; Newer machines automatically
   217 00000206 CD15                <1> 			INT 15h		; shut down
   218 00000208 B80453              <1> 			MOV AX, 5304h
   219 0000020B 31DB                <1> 			XOR BX, BX
   220 0000020D CD15                <1> 			INT 15h		; Interrupt 15h originally was
   221 0000020F B80153              <1> 			MOV AX, 5301h	; used for Cartridges (cassettes)
   222 00000212 31DB                <1> 			XOR BX, BX	; but is still in use for
   223 00000214 CD15                <1> 			INT 15h		; diverse things
   224 00000216 B80753              <1> 			MOV AX, 5307h
   225 00000219 BB0100              <1> 			MOV BX, 1
   226 0000021C B90300              <1> 			MOV CX, 3
   227 0000021F CD15                <1> 			INT 15h
   228 00000221 CF                  <1> 			IRET
   229                              <1> 
   230                              <1> 	coldboot:
   231 00000222 0F20C0              <1> 			   mov eax, cr0
   232 00000225 24FE                <1> 			   and al,0xFE     ; back to realmode
   233 00000227 0F22C0              <1> 			   mov  cr0, eax   ; by toggling bit again
   234 0000022A FB                  <1> 			   sti
   235 0000022B B84000              <1> 			MOV AX, 0040h
   236 0000022E 8EC0                <1> 			MOV ES, AX
   237 00000230 26C70672000000      <1> 			MOV WORD [ES:00072h], 0h
   238 00000237 EA0000FFFF          <1> 			JMP 0FFFFh:0000h
   239 0000023C CF                  <1> 			IRET
   240                              <1> 
   241                              <1> 		warmboot:
   242 0000023D E81200              <1> 			call realmode
   243 00000240 B84000              <1> 			MOV AX, 0040h
   244 00000243 8EC0                <1> 			MOV ES, AX
   245 00000245 26C70672003412      <1> 			MOV WORD [ES:00072h], 01234h
   246 0000024C EA0000FFFF          <1> 			JMP 0FFFFh:0000h
   247 00000251 CF                  <1> 			IRET
   248                              <1> 
   249                              <1> 
   250                              <1> realmode:
   251 00000252 0F20C0              <1>    mov eax, cr0
   252 00000255 24FE                <1>    and al,0xFE     ; back to realmode
   253 00000257 0F22C0              <1>    mov  cr0, eax   ; by toggling bit again
   254 0000025A FB                  <1>    sti
   255 0000025B 66B800000000        <1>    mov eax, 0
   256 00000261 C3                  <1>    ret
   257                              <1>    
   258 00000262 426F6F7420696E746F- <1> bootmsg:	db "Boot into the GUI?(y/n)",10,13,0
   259 0000026B 20746865204755493F- <1>
   260 00000274 28792F6E290A0D00    <1>
   261                                      %include 'source/pmode.asm'
   262                              <1> [BITS 16]
   263                              <1> ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
   264                              <1> ;	16-bit real mode
   265                              <1> ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
   266                              <1> 
   267                              <1> pmode:
   268 0000027C BA9200              <1> 	mov dx, 0x92
   269 0000027F EC                  <1> 	in al, dx	;;A20
   270 00000280 0C02                <1> 	or al, 2
   271 00000282 EE                  <1> 	out dx, al
   272 00000283 6631DB              <1> 	xor ebx,ebx
   273 00000286 8CCB                <1> 	mov bx,cs		; EBX=segment
   274 00000288 66C1E304            <1> 	shl ebx,4		;	<< 4
   275 0000028C 67668D03            <1> 	lea eax,[ebx]		; EAX=linear address of segment base
   276 00000290 A3[5107]            <1> 	mov [gdt2 + 2],ax
   277 00000293 A3[5907]            <1> 	mov [gdt3 + 2],ax
   278 00000296 66C1E810            <1> 	shr eax,16
   279 0000029A A2[5307]            <1> 	mov [gdt2 + 4],al
   280 0000029D A2[5B07]            <1> 	mov [gdt3 + 4],al
   281 000002A0 8826[5607]          <1> 	mov [gdt2 + 7],ah
   282 000002A4 8826[5E07]          <1> 	mov [gdt3 + 7],ah
   283 000002A8 66B8[00000000]      <1> 	mov eax, stack
   284 000002AE A3[6107]            <1> 	mov [gdts + 2],ax
   285 000002B1 66C1E810            <1> 	shr eax,16
   286 000002B5 A2[6307]            <1> 	mov [gdts + 4],al
   287 000002B8 8826[6607]          <1> 	mov [gdts + 7],ah
   288                              <1> ; fix up gdt and idt
   289 000002BC 67668D83[3F070000]  <1> 	lea eax,[ebx + gdt]	; EAX=linear address of gdt
   290 000002C4 66A3[3507]          <1> 	mov [gdtr + 2],eax
   291 000002C8 67668D83[6C070000]  <1> 	lea eax,[ebx + idt]	; EAX=linear address of idt
   292 000002D0 66A3[3B07]          <1> 	mov [idtr + 2],eax
   293 000002D4 FA                  <1> 	cli
   294 000002D5 0F0116[3307]        <1> 	lgdt [gdtr]
   295 000002DA 0F011E[3907]        <1> 	lidt [idtr]
   296 000002DF 66BB00000000        <1> 	mov ebx, 0
   297 000002E5 8CDB                <1> 	mov bx, ds
   298 000002E7 66891E[6603]        <1> 	mov [basecache], ebx
   299 000002EC 0F20C0              <1> 	mov eax,cr0
   300 000002EF 0C01                <1> 	or al,1
   301 000002F1 0F22C0              <1> 	mov cr0,eax
   302 000002F4 EA[F902]1000        <1> 	jmp SYS_CODE_SEL:do_pm
   303                              <1> [BITS 32]
   304                              <1> do_pm:
   305 000002F9 66B81800            <1> 	mov ax, SYS_DATA_SEL
   306 000002FD 8ED8                <1> 	mov ds,ax
   307 000002FF 66B82000            <1> 	mov ax, STACK_SEL
   308 00000303 8ED0                <1> 	mov ss, ax
   309 00000305 BC00100000          <1> 	mov esp, 4096
   310 0000030A 90                  <1> 	nop
   311 0000030B 90                  <1> 	nop
   312 0000030C 66B81800            <1> 	mov ax, SYS_DATA_SEL
   313 00000310 8EC0                <1> 	mov es,ax
   314 00000312 8EE0                <1> 	mov fs,ax
   315 00000314 8EE8                <1> 	mov gs,ax
   316 00000316 B800000000          <1> 	mov eax, 0
   317 0000031B BE[00000000]        <1> 	mov esi, bssstart
   318                              <1> clearkernelbuffers:
   319 00000320 8906                <1> 	mov [esi], eax
   320 00000322 81C604000000        <1> 	add esi, 4
   321 00000328 81FE[29560000]      <1> 	cmp esi, bssend
   322 0000032E 72F0                <1> 	jb clearkernelbuffers
   323                              <1> user1:
   324 00000330 8B3D[B8520000]      <1> 	mov edi, [physbaseptr]
   325 00000336 A1[66030000]        <1> 	mov eax, [basecache]
   326 0000033B C1E004              <1> 	shl eax, 4
   327 0000033E 29C7                <1> 	sub edi, eax
   328 00000340 893D[B8520000]      <1> 	mov [physbaseptr], edi
   329 00000346 E874130000          <1> 	call indexfiles
   330 0000034B 803D[6A010000]00    <1> 	cmp byte [guinodo], 0
   331 00000352 0F8405000000        <1> 	je near guido
   332 00000358 E92E0C0000          <1> 	jmp os
   333                              <1> 	
   334                              <1> guido:
   335 0000035D E9ED270000          <1> 	jmp gui
   336                              <1> 	
   337 00000362 00000000            <1> user2codepoint dw 0,0
   338 00000366 00000000            <1> basecache dd 0
   339                              <1> 
   340                              <1> unhand:	
   341                              <1> 	%assign i 0
   342                              <1> 	%rep 40
   343                              <1> 	cli
   344                              <1> 	mov byte [intprob], i
   345                              <1> 	jmp unhand2
   346                              <1> 	%assign i i+1
   347                              <1> 	%endrep
   348 0000036A FA                  <2>  cli
   349 0000036B C605[6F060000]00    <2>  mov byte [intprob], i
   350 00000372 E9FB010000          <2>  jmp unhand2
   351                              <2>  %assign i i+1
   352 00000377 FA                  <2>  cli
   353 00000378 C605[6F060000]01    <2>  mov byte [intprob], i
   354 0000037F E9EE010000          <2>  jmp unhand2
   355                              <2>  %assign i i+1
   356 00000384 FA                  <2>  cli
   357 00000385 C605[6F060000]02    <2>  mov byte [intprob], i
   358 0000038C E9E1010000          <2>  jmp unhand2
   359                              <2>  %assign i i+1
   360 00000391 FA                  <2>  cli
   361 00000392 C605[6F060000]03    <2>  mov byte [intprob], i
   362 00000399 E9D4010000          <2>  jmp unhand2
   363                              <2>  %assign i i+1
   364 0000039E FA                  <2>  cli
   365 0000039F C605[6F060000]04    <2>  mov byte [intprob], i
   366 000003A6 E9C7010000          <2>  jmp unhand2
   367                              <2>  %assign i i+1
   368 000003AB FA                  <2>  cli
   369 000003AC C605[6F060000]05    <2>  mov byte [intprob], i
   370 000003B3 E9BA010000          <2>  jmp unhand2
   371                              <2>  %assign i i+1
   372 000003B8 FA                  <2>  cli
   373 000003B9 C605[6F060000]06    <2>  mov byte [intprob], i
   374 000003C0 E9AD010000          <2>  jmp unhand2
   375                              <2>  %assign i i+1
   376 000003C5 FA                  <2>  cli
   377 000003C6 C605[6F060000]07    <2>  mov byte [intprob], i
   378 000003CD E9A0010000          <2>  jmp unhand2
   379                              <2>  %assign i i+1
   380 000003D2 FA                  <2>  cli
   381 000003D3 C605[6F060000]08    <2>  mov byte [intprob], i
   382 000003DA E993010000          <2>  jmp unhand2
   383                              <2>  %assign i i+1
   384 000003DF FA                  <2>  cli
   385 000003E0 C605[6F060000]09    <2>  mov byte [intprob], i
   386 000003E7 E986010000          <2>  jmp unhand2
   387                              <2>  %assign i i+1
   388 000003EC FA                  <2>  cli
   389 000003ED C605[6F060000]0A    <2>  mov byte [intprob], i
   390 000003F4 E979010000          <2>  jmp unhand2
   391                              <2>  %assign i i+1
   392 000003F9 FA                  <2>  cli
   393 000003FA C605[6F060000]0B    <2>  mov byte [intprob], i
   394 00000401 E96C010000          <2>  jmp unhand2
   395                              <2>  %assign i i+1
   396 00000406 FA                  <2>  cli
   397 00000407 C605[6F060000]0C    <2>  mov byte [intprob], i
   398 0000040E E95F010000          <2>  jmp unhand2
   399                              <2>  %assign i i+1
   400 00000413 FA                  <2>  cli
   401 00000414 C605[6F060000]0D    <2>  mov byte [intprob], i
   402 0000041B E952010000          <2>  jmp unhand2
   403                              <2>  %assign i i+1
   404 00000420 FA                  <2>  cli
   405 00000421 C605[6F060000]0E    <2>  mov byte [intprob], i
   406 00000428 E945010000          <2>  jmp unhand2
   407                              <2>  %assign i i+1
   408 0000042D FA                  <2>  cli
   409 0000042E C605[6F060000]0F    <2>  mov byte [intprob], i
   410 00000435 E938010000          <2>  jmp unhand2
   411                              <2>  %assign i i+1
   412 0000043A FA                  <2>  cli
   413 0000043B C605[6F060000]10    <2>  mov byte [intprob], i
   414 00000442 E92B010000          <2>  jmp unhand2
   415                              <2>  %assign i i+1
   416 00000447 FA                  <2>  cli
   417 00000448 C605[6F060000]11    <2>  mov byte [intprob], i
   418 0000044F E91E010000          <2>  jmp unhand2
   419                              <2>  %assign i i+1
   420 00000454 FA                  <2>  cli
   421 00000455 C605[6F060000]12    <2>  mov byte [intprob], i
   422 0000045C E911010000          <2>  jmp unhand2
   423                              <2>  %assign i i+1
   424 00000461 FA                  <2>  cli
   425 00000462 C605[6F060000]13    <2>  mov byte [intprob], i
   426 00000469 E904010000          <2>  jmp unhand2
   427                              <2>  %assign i i+1
   428 0000046E FA                  <2>  cli
   429 0000046F C605[6F060000]14    <2>  mov byte [intprob], i
   430 00000476 E9F7000000          <2>  jmp unhand2
   431                              <2>  %assign i i+1
   432 0000047B FA                  <2>  cli
   433 0000047C C605[6F060000]15    <2>  mov byte [intprob], i
   434 00000483 E9EA000000          <2>  jmp unhand2
   435                              <2>  %assign i i+1
   436 00000488 FA                  <2>  cli
   437 00000489 C605[6F060000]16    <2>  mov byte [intprob], i
   438 00000490 E9DD000000          <2>  jmp unhand2
   439                              <2>  %assign i i+1
   440 00000495 FA                  <2>  cli
   441 00000496 C605[6F060000]17    <2>  mov byte [intprob], i
   442 0000049D E9D0000000          <2>  jmp unhand2
   443                              <2>  %assign i i+1
   444 000004A2 FA                  <2>  cli
   445 000004A3 C605[6F060000]18    <2>  mov byte [intprob], i
   446 000004AA E9C3000000          <2>  jmp unhand2
   447                              <2>  %assign i i+1
   448 000004AF FA                  <2>  cli
   449 000004B0 C605[6F060000]19    <2>  mov byte [intprob], i
   450 000004B7 E9B6000000          <2>  jmp unhand2
   451                              <2>  %assign i i+1
   452 000004BC FA                  <2>  cli
   453 000004BD C605[6F060000]1A    <2>  mov byte [intprob], i
   454 000004C4 E9A9000000          <2>  jmp unhand2
   455                              <2>  %assign i i+1
   456 000004C9 FA                  <2>  cli
   457 000004CA C605[6F060000]1B    <2>  mov byte [intprob], i
   458 000004D1 E99C000000          <2>  jmp unhand2
   459                              <2>  %assign i i+1
   460 000004D6 FA                  <2>  cli
   461 000004D7 C605[6F060000]1C    <2>  mov byte [intprob], i
   462 000004DE E98F000000          <2>  jmp unhand2
   463                              <2>  %assign i i+1
   464 000004E3 FA                  <2>  cli
   465 000004E4 C605[6F060000]1D    <2>  mov byte [intprob], i
   466 000004EB E982000000          <2>  jmp unhand2
   467                              <2>  %assign i i+1
   468 000004F0 FA                  <2>  cli
   469 000004F1 C605[6F060000]1E    <2>  mov byte [intprob], i
   470 000004F8 E975000000          <2>  jmp unhand2
   471                              <2>  %assign i i+1
   472 000004FD FA                  <2>  cli
   473 000004FE C605[6F060000]1F    <2>  mov byte [intprob], i
   474 00000505 E968000000          <2>  jmp unhand2
   475                              <2>  %assign i i+1
   476 0000050A FA                  <2>  cli
   477 0000050B C605[6F060000]20    <2>  mov byte [intprob], i
   478 00000512 E95B000000          <2>  jmp unhand2
   479                              <2>  %assign i i+1
   480 00000517 FA                  <2>  cli
   481 00000518 C605[6F060000]21    <2>  mov byte [intprob], i
   482 0000051F E94E000000          <2>  jmp unhand2
   483                              <2>  %assign i i+1
   484 00000524 FA                  <2>  cli
   485 00000525 C605[6F060000]22    <2>  mov byte [intprob], i
   486 0000052C E941000000          <2>  jmp unhand2
   487                              <2>  %assign i i+1
   488 00000531 FA                  <2>  cli
   489 00000532 C605[6F060000]23    <2>  mov byte [intprob], i
   490 00000539 E934000000          <2>  jmp unhand2
   491                              <2>  %assign i i+1
   492 0000053E FA                  <2>  cli
   493 0000053F C605[6F060000]24    <2>  mov byte [intprob], i
   494 00000546 E927000000          <2>  jmp unhand2
   495                              <2>  %assign i i+1
   496 0000054B FA                  <2>  cli
   497 0000054C C605[6F060000]25    <2>  mov byte [intprob], i
   498 00000553 E91A000000          <2>  jmp unhand2
   499                              <2>  %assign i i+1
   500 00000558 FA                  <2>  cli
   501 00000559 C605[6F060000]26    <2>  mov byte [intprob], i
   502 00000560 E90D000000          <2>  jmp unhand2
   503                              <2>  %assign i i+1
   504 00000565 FA                  <2>  cli
   505 00000566 C605[6F060000]27    <2>  mov byte [intprob], i
   506 0000056D E900000000          <2>  jmp unhand2
   507                              <2>  %assign i i+1
   508                              <1> unhand2:
   509 00000572 60                  <1> 	pushad
   510 00000573 C705[62030000]0000- <1> 	mov dword [user2codepoint], 0
   511 0000057B 0000                <1>
   512 0000057D 89E6                <1> 	mov esi, esp
   513 0000057F 81C628000000        <1> 	add esi, ((unhndrgend - unhndrg)/13)*4
   514 00000585 8935[65060000]      <1> 	mov [esploc], esi
   515 0000058B BE[70060000]        <1> 	mov esi, unhandmsg
   516 00000590 8935[69060000]      <1> 	mov [esiloc], esi
   517 00000596 B900000000          <1> 	mov ecx, 0
   518 0000059B 8A0D[6F060000]      <1> 	mov cl, [intprob]
   519 000005A1 E85A000000          <1> 	call expdump
   520                              <1> dumpstack:
   521 000005A6 8B35[65060000]      <1> 	mov esi, [esploc]
   522 000005AC 39E6                <1> 	cmp esi, esp
   523 000005AE 7216                <1> 	jb donedump
   524 000005B0 368B0E              <1> 	mov ecx, [ss:esi]
   525 000005B3 81EE04000000        <1> 	sub esi, 4
   526 000005B9 8935[65060000]      <1> 	mov [esploc], esi
   527 000005BF E83C000000          <1> 	call expdump
   528 000005C4 EBE0                <1> 	jmp dumpstack
   529                              <1> donedump:
   530 000005C6 8B35[65060000]      <1> 	mov esi, [esploc]
   531 000005CC 368B7C2420          <1> 	mov edi, [ss:esp + 32]
   532 000005D1 8B4FFC              <1> 	mov ecx, [edi - 4]
   533 000005D4 E827000000          <1> 	call expdump
   534 000005D9 8B35[65060000]      <1> 	mov esi, [esploc]
   535 000005DF 368B7C2420          <1> 	mov edi, [ss:esp + 32]
   536 000005E4 8B0F                <1> 	mov ecx, [edi]
   537 000005E6 E815000000          <1> 	call expdump
   538 000005EB 8B35[65060000]      <1> 	mov esi, [esploc]
   539 000005F1 368B7C2420          <1> 	mov edi, [ss:esp + 32]
   540 000005F6 8B4F04              <1> 	mov ecx, [edi + 4]
   541 000005F9 E802000000          <1> 	call expdump
   542 000005FE EBFE                <1> 	jmp $
   543                              <1> expdump:
   544 00000600 8B35[69060000]      <1> 	mov esi, [esiloc]
   545 00000606 89F7                <1> 	mov edi, esi
   546 00000608 81C70D000000        <1> 	add edi, 13
   547 0000060E 81C604000000        <1> 	add esi, 4
   548 00000614 893D[69060000]      <1> 	mov [esiloc], edi
   549 0000061A 4F                  <1> 	dec edi
   550 0000061B E82B0E0000          <1> 	call converthex
   551 00000620 81EE04000000        <1> 	sub esi, 4
   552 00000626 803D[A92C0000]00    <1> 	cmp byte [guion], 0
   553 0000062D 0F8422000000        <1> 	je near expdumptext
   554 00000633 668B0D[6D060000]    <1> 	mov cx, [locunhand]
   555 0000063A 668105[6D060000]10- <1> 	add word [locunhand], 16
   556 00000642 00                  <1>
   557 00000643 66BA0200            <1> 	mov dx, 2
   558 00000647 66B80100            <1> 	mov ax, 1
   559 0000064B 66BB0000            <1> 	mov bx, 0
   560 0000064F E822300000          <1> 	call showstring
   561 00000654 C3                  <1> 	ret
   562                              <1> expdumptext:
   563 00000655 E818050000          <1> 	call print
   564 0000065A BE[4D480000]        <1> 	mov esi, line
   565 0000065F E80E050000          <1> 	call print
   566 00000664 C3                  <1> 	ret
   567 00000665 00000000            <1> esploc dd 0
   568 00000669 00000000            <1> esiloc dd 0
   569 0000066D 0100                <1> locunhand dw 1
   570 0000066F 00                  <1> intprob db 0
   571                              <1> 	unhandmsg:	
   572 00000670 494E54203030303030- <1> 			db "INT 00000000",0
   573 00000679 30303000            <1>
   574                              <1> unhndrg:
   575 0000067D 45464C3D3030303030- <1> 			db "EFL=00000000",0
   576 00000686 30303000            <1>
   577 0000068A 43533A3D3030303030- <1> 			db "CS:=00000000",0
   578 00000693 30303000            <1>
   579 00000697 4549503D3030303030- <1> 			db "EIP=00000000",0
   580 000006A0 30303000            <1>
   581 000006A4 4541583D3030303030- <1> 			db "EAX=00000000",0
   582 000006AD 30303000            <1>
   583 000006B1 4543583D3030303030- <1> 			db "ECX=00000000",0
   584 000006BA 30303000            <1>
   585 000006BE 4544583D3030303030- <1> 			db "EDX=00000000",0
   586 000006C7 30303000            <1>
   587 000006CB 4542583D3030303030- <1> 			db "EBX=00000000",0
   588 000006D4 30303000            <1>
   589 000006D8 4553503D3030303030- <1> 			db "ESP=00000000",0
   590 000006E1 30303000            <1>
   591 000006E5 4542503D3030303030- <1> 			db "EBP=00000000",0
   592 000006EE 30303000            <1>
   593 000006F2 4553493D3030303030- <1> 			db "ESI=00000000",0
   594 000006FB 30303000            <1>
   595 000006FF 4544493D3030303030- <1> unhndrgend:	db "EDI=00000000",0
   596 00000708 30303000            <1>
   597 0000070C 434D443D3030303030- <1> 			db "CMD=00000000",0
   598 00000715 30303000            <1>
   599 00000719 434D443D3030303030- <1> 			db "CMD=00000000",0
   600 00000722 30303000            <1>
   601 00000726 434D443D3030303030- <1> 			db "CMD=00000000",0
   602 0000072F 30303000            <1>
   603                              <1> unhandmsgend:
   604                              <1> 
   605                              <1> [BITS 16]
   606                              <1> 
   607                              <1> ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
   608                              <1> ;	16-bit limit/32-bit linear base address of GDT and IDT
   609                              <1> ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
   610 00000733 2700                <1> gdtr:	dw gdt_end - gdt - 1	; GDT limit
   611 00000735 [3F070000]          <1> 	dd gdt			; linear, physical address of GDT
   612                              <1> 
   613 00000739 8701                <1> idtr:	dw idt_end - idt - 1	; IDT limit
   614 0000073B [6C070000]          <1> 	dd idt			; linear, physical address of IDT
   615                              <1> 
   616                              <1> 
   617 0000073F 0000                <1> gdt:	dw 0			; limit 15:0
   618 00000741 0000                <1> 	dw 0			; base 15:0
   619 00000743 00                  <1> 	db 0			; base 23:16
   620 00000744 00                  <1> 	db 0			; type
   621 00000745 00                  <1> 	db 0			; limit 19:16, flags
   622 00000746 00                  <1> 	db 0			; base 31:24
   623                              <1> ; linear data segment descriptor
   624                              <1> LINEAR_SEL	equ	$-gdt
   625 00000747 FFFF                <1> 	dw 0xFFFF		; limit 0xFFFFF
   626 00000749 0000                <1> 	dw 0			; base for this one is always 0
   627 0000074B 00                  <1> 	db 0
   628 0000074C 92                  <1> 	db 0x92			; present, ring 0, data, expand-up, writable
   629 0000074D CF                  <1> 	db 0xCF			; page-granular, 32-bit
   630 0000074E 00                  <1> 	db 0
   631                              <1> ; code segment descriptor
   632                              <1> SYS_CODE_SEL	equ	$-gdt
   633 0000074F FFFF                <1> gdt2:	dw 0xFFFF
   634 00000751 0000                <1> 	dw 0			; (base gets set above)
   635 00000753 00                  <1> 	db 0
   636 00000754 9A                  <1> 	db 0x9A			; present, ring 0, code, non-conforming, readable
   637 00000755 CF                  <1> 	db 0xCF
   638 00000756 00                  <1> 	db 0
   639                              <1> ; data segment descriptor
   640                              <1> SYS_DATA_SEL	equ	$-gdt
   641 00000757 FFFF                <1> gdt3:	dw 0xFFFF
   642 00000759 0000                <1> 	dw 0			; (base gets set above)
   643 0000075B 00                  <1> 	db 0
   644 0000075C 92                  <1> 	db 0x92			; present, ring 0, data, expand-up, writable
   645 0000075D CF                  <1> 	db 0xCF
   646 0000075E 00                  <1> 	db 0
   647                              <1> STACK_SEL	equ	$-gdt
   648 0000075F 0100                <1> gdts:	dw 1
   649 00000761 0000                <1> 	dw 0			; (base gets set above)
   650 00000763 00                  <1> 	db 0
   651 00000764 92                  <1> 	db 0x92			; present, ring 0, data, expand-up, writable
   652 00000765 C0                  <1> 	db 0xC0
   653 00000766 00                  <1> 	db 0
   654                              <1> gdt_end:
   655                              <1> ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
   656                              <1> ;	interrupt descriptor table (IDT)
   657                              <1> ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
   658                              <1> ; 32 reserved interrupts:
   659 00000767 494454              <1> db "IDT"
   660 0000076A [6A03]              <1> dw unhand
   661                              <1> idt:	
   662                              <1> %assign i 0
   663                              <1> %rep    48
   664                              <1>         dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   665                              <1> %assign i i+1 
   666                              <1> %endrep
   667 0000076C [6A03]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   668                              <2> %assign i i+1
   669 00000774 [7703]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   670                              <2> %assign i i+1
   671 0000077C [8403]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   672                              <2> %assign i i+1
   673 00000784 [9103]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   674                              <2> %assign i i+1
   675 0000078C [9E03]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   676                              <2> %assign i i+1
   677 00000794 [AB03]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   678                              <2> %assign i i+1
   679 0000079C [B803]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   680                              <2> %assign i i+1
   681 000007A4 [C503]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   682                              <2> %assign i i+1
   683 000007AC [D203]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   684                              <2> %assign i i+1
   685 000007B4 [DF03]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   686                              <2> %assign i i+1
   687 000007BC [EC03]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   688                              <2> %assign i i+1
   689 000007C4 [F903]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   690                              <2> %assign i i+1
   691 000007CC [0604]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   692                              <2> %assign i i+1
   693 000007D4 [1304]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   694                              <2> %assign i i+1
   695 000007DC [2004]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   696                              <2> %assign i i+1
   697 000007E4 [2D04]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   698                              <2> %assign i i+1
   699 000007EC [3A04]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   700                              <2> %assign i i+1
   701 000007F4 [4704]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   702                              <2> %assign i i+1
   703 000007FC [5404]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   704                              <2> %assign i i+1
   705 00000804 [6104]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   706                              <2> %assign i i+1
   707 0000080C [6E04]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   708                              <2> %assign i i+1
   709 00000814 [7B04]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   710                              <2> %assign i i+1
   711 0000081C [8804]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   712                              <2> %assign i i+1
   713 00000824 [9504]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   714                              <2> %assign i i+1
   715 0000082C [A204]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   716                              <2> %assign i i+1
   717 00000834 [AF04]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   718                              <2> %assign i i+1
   719 0000083C [BC04]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   720                              <2> %assign i i+1
   721 00000844 [C904]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   722                              <2> %assign i i+1
   723 0000084C [D604]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   724                              <2> %assign i i+1
   725 00000854 [E304]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   726                              <2> %assign i i+1
   727 0000085C [F004]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   728                              <2> %assign i i+1
   729 00000864 [FD04]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   730                              <2> %assign i i+1
   731 0000086C [0A05]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   732                              <2> %assign i i+1
   733 00000874 [1705]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   734                              <2> %assign i i+1
   735 0000087C [2405]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   736                              <2> %assign i i+1
   737 00000884 [3105]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   738                              <2> %assign i i+1
   739 0000088C [3E05]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   740                              <2> %assign i i+1
   741 00000894 [4B05]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   742                              <2> %assign i i+1
   743 0000089C [5805]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   744                              <2> %assign i i+1
   745 000008A4 [6505]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   746                              <2> %assign i i+1
   747 000008AC [7205]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   748                              <2> %assign i i+1
   749 000008B4 [7F05]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   750                              <2> %assign i i+1
   751 000008BC [8C05]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   752                              <2> %assign i i+1
   753 000008C4 [9905]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   754                              <2> %assign i i+1
   755 000008CC [A605]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   756                              <2> %assign i i+1
   757 000008D4 [B305]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   758                              <2> %assign i i+1
   759 000008DC [C005]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   760                              <2> %assign i i+1
   761 000008E4 [CD05]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   762                              <2> %assign i i+1
   763                              <1> ;;INT 30h for os use and 3rd party use:
   764 000008EC [F408]1000008E0000  <1> 	dw newints,SYS_CODE_SEL,0x8E00,0
   765                              <1> idt_end:
   766                              <1> [BITS 32]
   767                                  [BITS 32]
   768                                      %include 'source/ints.asm'
   769                              <1> newints:	;;for great justice
   770 000008F4 80FC00              <1> 	cmp ah, 0		;;originally 0
   771 000008F7 0F8452000000        <1> 	je near intx0   ;;0=kills app
   772 000008FD 80FC01              <1> 	cmp ah, 1		;;originally 1
   773 00000900 0F844E000000        <1> 	je near intx1   ;;3=print string
   774 00000906 80FC02              <1> 	cmp ah, 2		;;originally 2
   775 00000909 0F844B000000        <1> 	je near intx2	;;4=read string
   776 0000090F 80FC03              <1> 	cmp ah, 3		;;originally 3
   777 00000912 0F8448000000        <1> 	je near intx3	;;6=clear screen
   778 00000918 80FC04              <1> 	cmp ah, 4		;;originally 4
   779 0000091B 0F8445000000        <1> 	je near intx4	;;5=read and print string
   780 00000921 80FC05              <1> 	cmp ah, 5		;;originally 5		
   781 00000924 0F8442000000        <1> 	je near intx5	;;2=get char
   782 0000092A 80FC06              <1> 	cmp ah, 6		;;originally 6
   783 0000092D 0F843F000000        <1> 	je near intx6	;;1=print char
   784 00000933 80FC07              <1> 	cmp ah, 7
   785 00000936 0F843C000000        <1> 	je near intx7	;;read file
   786 0000093C 80FC09              <1> 	cmp ah, 9
   787 0000093F 0F8439000000        <1> 	je near intx9	;;convert number
   788 00000945 80FC0A              <1> 	cmp ah, 10
   789 00000948 0F8440000000        <1> 	je near intx10	;;create thread
   790 0000094E C3                  <1> 	ret
   791                              <1> 	
   792                              <1> intx0:
   793 0000094F E951070000          <1> 	jmp nwcmd
   794                              <1> intx1:
   795 00000954 E821020000          <1> 	call int303
   796 00000959 C3                  <1> 	ret
   797                              <1> intx2:
   798 0000095A E838020000          <1> 	call int304
   799 0000095F C3                  <1> 	ret
   800                              <1> intx3:
   801 00000960 E8D3040000          <1> 	call int306
   802 00000965 C3                  <1> 	ret
   803                              <1> intx4:
   804 00000966 E854020000          <1> 	call int305
   805 0000096B C3                  <1> 	ret
   806                              <1> intx5:
   807 0000096C E8CE010000          <1> 	call int302
   808 00000971 C3                  <1> 	ret
   809                              <1> intx6:
   810 00000972 E822000000          <1> 	call int301
   811 00000977 C3                  <1> 	ret
   812                              <1> intx7:
   813 00000978 E8653C0000          <1> 	call loadfile
   814 0000097D C3                  <1> 	ret
   815                              <1> intx9:
   816 0000097E 3C00                <1> 	cmp al, 0
   817 00000980 7506                <1> 	jne intx9B
   818 00000982 E8130C0000          <1> 	call showdec
   819 00000987 C3                  <1> 	ret
   820                              <1> intx9B:
   821 00000988 E8680B0000          <1> 	call showhex
   822 0000098D C3                  <1> 	ret
   823                              <1> intx10:
   824                              <1> ;	call thread
   825 0000098E C3                  <1> 	ret
   826                              <1> 	
   827 0000098F 0000                <1> linebeginpos dw 0
   828 00000991 0000                <1> videobufpos: dw 0
   829 00000993 0000                <1> charpos db 0,0
   830 00000995 A01E                <1> charxy db 160,30
   831 00000997 0000                <1> charbuf dw 0
   832                              <1> 
   833                              <1> int301:	;;print char, char in al, modifier in bl, will run videobuf2copy if called as is
   834 00000999 E807000000          <1> 	call int301prnt
   835 0000099E E9E4040000          <1> 	jmp termcopy
   836 000009A3 00                  <1> termguion db 0
   837 000009A4 00                  <1> termcopyon db 0
   838                              <1> int301prnt:
   839 000009A5 88DC                <1> 	mov ah, bl
   840 000009A7 66A3[97090000]      <1> 	mov [charbuf], ax
   841 000009AD BB00000000          <1> 	mov ebx, 0
   842 000009B2 668B1D[91090000]    <1> 	mov bx, [videobufpos]
   843 000009B9 BF[851E0000]        <1> 	mov edi, videobuf2
   844 000009BE 01DF                <1> 	add edi, ebx
   845 000009C0 66A1[850E0000]      <1> 	mov ax, [removedvideo]
   846 000009C6 668907              <1> 	mov [edi], ax
   847 000009C9 66A1[97090000]      <1> 	mov ax, [charbuf]
   848 000009CF BA00000000          <1> 	mov edx, 0
   849 000009D4 668B15[93090000]    <1> 	mov dx, [charpos]
   850 000009DB B900000000          <1> 	mov ecx, 0
   851 000009E0 668B0D[95090000]    <1> 	mov cx, [charxy]
   852 000009E7 3C0D                <1> 	cmp al, 13
   853 000009E9 0F8454000000        <1> 	je near int301cr
   854 000009EF 3C0A                <1> 	cmp al, 10
   855 000009F1 0F8482000000        <1> 	je near int301nl
   856 000009F7 3C08                <1> 	cmp al, 8
   857 000009F9 0F845B000000        <1> 	je near int301bs
   858 000009FF 668907              <1> 	mov [edi], ax
   859 00000A02 81C702000000        <1> 	add edi, 2
   860 00000A08 80C202              <1> 	add dl, 2
   861                              <1> donecrnl:
   862 00000A0B 38CA                <1> 	cmp dl, cl
   863 00000A0D 0F8397000000        <1> 	jae near int301eol
   864                              <1> doneeol:
   865 00000A13 38EE                <1> 	cmp dh, ch
   866 00000A15 0F83AD000000        <1> 	jae near int301scr	
   867                              <1> donescr:
   868 00000A1B 89FB                <1> 	mov ebx, edi
   869 00000A1D 668B07              <1> 	mov ax, [edi]
   870 00000A20 66A3[850E0000]      <1> 	mov [removedvideo], ax
   871 00000A26 81EB[851E0000]      <1> 	sub ebx, videobuf2
   872 00000A2C 66891D[91090000]    <1> 	mov [videobufpos], bx
   873 00000A33 668915[93090000]    <1> 	mov [charpos], dx
   874 00000A3A 66A1[97090000]      <1> 	mov ax, [charbuf]
   875 00000A40 88E3                <1> 	mov bl, ah
   876 00000A42 C3                  <1> 	ret
   877                              <1> 	
   878                              <1> 	int301cr:
   879 00000A43 B200                <1> 		mov dl, 0
   880 00000A45 BB00000000          <1> 		mov ebx, 0
   881 00000A4A BF[851E0000]        <1> 		mov edi, videobuf2
   882 00000A4F 668B1D[8F090000]    <1> 		mov bx, [linebeginpos]
   883 00000A56 01DF                <1> 		add edi, ebx
   884 00000A58 EBB1                <1> 		jmp donecrnl
   885                              <1> 			
   886                              <1> 	int301bs:
   887 00000A5A 80FA00              <1> 		cmp dl, 0
   888 00000A5D 740F                <1> 		je int301backline
   889                              <1> 	int301nobmr:
   890 00000A5F 80EA02              <1> 		sub dl, 2
   891 00000A62 66B80000            <1> 		mov ax, 0
   892 00000A66 81EF02000000        <1> 		sub edi, 2
   893 00000A6C EB9D                <1> 		jmp donecrnl
   894                              <1> 	int301backline:
   895 00000A6E 88CA                <1> 		mov dl, cl
   896 00000A70 80FE00              <1> 		cmp dh, 0
   897 00000A73 74EA                <1> 		je int301nobmr
   898 00000A75 FECE                <1> 		dec dh
   899 00000A77 EBE6                <1> 		jmp int301nobmr
   900                              <1> 		
   901                              <1> 	int301nl:
   902 00000A79 FEC6                <1> 		inc dh
   903 00000A7B BB00000000          <1> 		mov ebx, 0
   904 00000A80 88CB                <1> 		mov bl, cl
   905 00000A82 BF[851E0000]        <1> 		mov edi, videobuf2
   906 00000A87 66031D[91090000]    <1> 		add bx, [videobufpos]
   907 00000A8E 01DF                <1> 		add edi, ebx
   908 00000A90 BB00000000          <1> 		mov ebx, 0
   909 00000A95 88CB                <1> 		mov bl, cl
   910 00000A97 66031D[8F090000]    <1> 		add bx, [linebeginpos]
   911 00000A9E 66891D[8F090000]    <1> 		mov [linebeginpos], bx
   912 00000AA5 E961FFFFFF          <1> 		jmp donecrnl
   913                              <1> 		
   914                              <1> 	int301eol:
   915 00000AAA B200                <1> 		mov dl, 0
   916 00000AAC FEC6                <1> 		inc dh
   917 00000AAE BB00000000          <1> 		mov ebx, 0
   918 00000AB3 88CB                <1> 		mov bl, cl
   919 00000AB5 66031D[8F090000]    <1> 		add bx, [linebeginpos]
   920 00000ABC 66891D[8F090000]    <1> 		mov [linebeginpos], bx
   921 00000AC3 E94BFFFFFF          <1> 		jmp doneeol
   922                              <1> 	int301scr:
   923 00000AC8 FECE                <1> 		dec dh
   924 00000ACA BF[851E0000]        <1> 		mov edi, videobuf2
   925 00000ACF BB00000000          <1> 		mov ebx, 0
   926 00000AD4 88CB                <1> 		mov bl, cl
   927 00000AD6 01FB                <1> 		add ebx, edi
   928                              <1> 	intscrollloop:
   929 00000AD8 668B03              <1> 		mov ax, [ebx]
   930 00000ADB 668907              <1> 		mov [edi], ax
   931 00000ADE 81C702000000        <1> 		add edi, 2
   932 00000AE4 81C302000000        <1> 		add ebx, 2
   933 00000AEA 80E902              <1> 		sub cl, 2
   934 00000AED 80F900              <1> 		cmp cl, 0
   935 00000AF0 75E6                <1> 		jne intscrollloop
   936 00000AF2 8A0D[95090000]      <1> 		mov cl, [charxy]
   937 00000AF8 FECD                <1> 		dec ch
   938 00000AFA 80FD01              <1> 		cmp ch, 1
   939 00000AFD 77D9                <1> 		ja intscrollloop
   940 00000AFF 66B80000            <1> 		mov ax, 0
   941 00000B03 81EF[851E0000]      <1> 		sub edi, videobuf2
   942 00000B09 66893D[8F090000]    <1> 		mov [linebeginpos], di
   943 00000B10 81C7[851E0000]      <1> 		add edi, videobuf2
   944 00000B16 89FB                <1> 		mov ebx, edi
   945                              <1> 	intloopclear:
   946 00000B18 668903              <1> 		mov [ebx], ax
   947 00000B1B 81C302000000        <1> 		add ebx, 2
   948 00000B21 80E902              <1> 		sub cl, 2
   949 00000B24 80F900              <1> 		cmp cl, 0
   950 00000B27 75EF                <1> 		jne intloopclear
   951 00000B29 FECD                <1> 		dec ch
   952 00000B2B 80FD00              <1> 		cmp ch, 0
   953 00000B2E 75E8                <1> 		jne intloopclear
   954 00000B30 668B0D[95090000]    <1> 		mov cx, [charxy]
   955 00000B37 E9DFFEFFFF          <1> 		jmp donescr
   956                              <1> 		
   957                              <1> 		
   958 00000B3C 0000                <1> lastkey db 0,0
   959 00000B3E 00                  <1> trans db 0
   960                              <1> 
   961                              <1> 	int302:		;;get char, if al is 0, wait for key
   962 00000B3F A2[3E0B0000]        <1> 		mov [trans], al
   963                              <1> 	transcheck:
   964 00000B44 E8F61B0000          <1> 		call guistartin
   965 00000B49 8A3D[3E0B0000]      <1> 		mov bh, [trans]
   966 00000B4F 66A1[3C0B0000]      <1> 		mov ax, [lastkey]
   967 00000B55 80FC1C              <1> 		cmp ah, 1Ch
   968 00000B58 7414                <1> 		je int302enter
   969 00000B5A 3CE0                <1> 		cmp al, 0xE0
   970 00000B5C 7504                <1> 		jne nospecialtrans
   971 00000B5E 88C3                <1> 		mov bl, al
   972 00000B60 B000                <1> 		mov al, 0
   973                              <1> 	nospecialtrans:
   974 00000B62 08C7                <1> 		or bh, al
   975 00000B64 80FF00              <1> 		cmp bh, 0
   976 00000B67 74DB                <1> 		je transcheck
   977 00000B69 E902000000          <1> 		jmp int302end
   978                              <1> 	int302enter:
   979 00000B6E B00D                <1> 		mov al, 13
   980                              <1> 	int302end:
   981 00000B70 C3                  <1> 		ret
   982                              <1> 	
   983 00000B71 00                  <1> endkey303 db 0
   984                              <1>     print:
   985 00000B72 66B80000            <1> 		mov ax, 0
   986 00000B76 66BB0700            <1> 		mov bx, 7
   987                              <1> 	int303:	;;print line, al=last key,bl=modifier, esi=buffer
   988 00000B7A A2[710B0000]        <1> 		mov [endkey303], al
   989                              <1> 	int303b:
   990 00000B7F 8A06                <1> 		mov al, [esi]
   991 00000B81 3A05[710B0000]      <1> 		cmp al, [endkey303]
   992 00000B87 7408                <1> 		je doneint303
   993 00000B89 E817FEFFFF          <1> 		call int301prnt
   994 00000B8E 46                  <1> 		inc esi
   995 00000B8F EBEE                <1> 		jmp int303b
   996                              <1> 	doneint303:
   997 00000B91 E9F1020000          <1> 		jmp termcopy
   998                              <1> 	
   999 00000B96 00                  <1> endkey304 db 0
  1000                              <1> 	int304:	;;get line, al=last key, esi = buffer
  1001 00000B97 A2[960B0000]        <1> 		mov [endkey304], al
  1002                              <1> 	int304b:
  1003 00000B9C 56                  <1> 		push esi
  1004 00000B9D B000                <1> 		mov al, 0
  1005 00000B9F E89BFFFFFF          <1> 		call int302
  1006 00000BA4 5E                  <1> 		pop esi
  1007 00000BA5 8806                <1> 		mov [esi], al
  1008 00000BA7 46                  <1> 		inc esi
  1009 00000BA8 3A05[960B0000]      <1> 		cmp al, [endkey304]
  1010 00000BAE 75EC                <1> 		jne int304b
  1011 00000BB0 4E                  <1> 		dec esi
  1012 00000BB1 C60600              <1> 		mov byte [esi], 0
  1013 00000BB4 C3                  <1> 	ret
  1014                              <1> 	
  1015 00000BB5 00                  <1> endkey305 db 0
  1016 00000BB6 00                  <1> modkey305 db 0
  1017 00000BB7 00000000            <1> firstesi305 dd 0
  1018 00000BBB 00                  <1> commandedit db 0
  1019 00000BBC 082000              <1> backcursor db 8," ",0
  1020                              <1> 	int305:	;;print and get line, al=last key, bl=modifier, esi=buffer
  1021 00000BBF A2[B50B0000]        <1> 		mov [endkey305], al
  1022 00000BC4 881D[B60B0000]      <1> 		mov [modkey305], bl
  1023 00000BCA 8935[B70B0000]      <1> 		mov [firstesi305], esi
  1024                              <1> 	int305b:
  1025 00000BD0 56                  <1> 		push esi
  1026 00000BD1 B001                <1> 		mov al, 1
  1027 00000BD3 E867FFFFFF          <1> 		call int302
  1028 00000BD8 5E                  <1> 		pop esi
  1029 00000BD9 80FC48              <1> 		cmp ah, 0x48
  1030 00000BDC 0F8445010000        <1> 		je near int305up
  1031 00000BE2 80FC50              <1> 		cmp ah, 0x50
  1032 00000BE5 0F841F010000        <1> 		je near int305down
  1033 00000BEB 80FC4D              <1> 		cmp ah, 0x4D
  1034 00000BEE 0F84D4000000        <1> 		je near int305right
  1035 00000BF4 80FC4B              <1> 		cmp ah, 0x4B
  1036 00000BF7 0F849E000000        <1> 		je near int305left
  1037 00000BFD 3C08                <1> 		cmp al, 8
  1038 00000BFF 0F8415020000        <1> 		je near int305bscheck
  1039 00000C05 3C00                <1> 		cmp al, 0
  1040 00000C07 74C7                <1> 		je int305b
  1041 00000C09 8806                <1> 		mov [esi], al
  1042 00000C0B 46                  <1> 		inc esi
  1043                              <1> 	bscheckequal:
  1044 00000C0C 8A1D[B60B0000]      <1> 		mov bl, [modkey305]
  1045 00000C12 E882FDFFFF          <1> 		call int301
  1046 00000C17 56                  <1> 		push esi
  1047 00000C18 66A3[990C0000]      <1> 		mov [int305axcache], ax
  1048 00000C1E 8A25[B50B0000]      <1> 		mov ah, [endkey305]
  1049 00000C24 38E0                <1> 		cmp al, ah
  1050 00000C26 7429                <1> 		je nobackprintbuftxt2
  1051 00000C28 BE[701A0000]        <1> 		mov esi, buftxt2
  1052 00000C2D E840FFFFFF          <1> 		call print
  1053 00000C32 B020                <1> 		mov al, " "
  1054 00000C34 E86CFDFFFF          <1> 		call int301prnt
  1055 00000C39 B008                <1> 		mov al, 8
  1056 00000C3B 81FE[701A0000]      <1> 		cmp esi, buftxt2
  1057 00000C41 740E                <1> 		je nobackprintbuftxt2
  1058                              <1> 	backprintbuftxt2:
  1059 00000C43 E85DFDFFFF          <1> 		call int301prnt
  1060 00000C48 4E                  <1> 		dec esi
  1061 00000C49 81FE[701A0000]      <1> 		cmp esi, buftxt2
  1062 00000C4F 77F2                <1> 		ja backprintbuftxt2
  1063                              <1> 	nobackprintbuftxt2:
  1064 00000C51 E843FDFFFF          <1> 		call int301
  1065 00000C56 5E                  <1> 		pop esi
  1066 00000C57 66A1[990C0000]      <1> 		mov ax, [int305axcache]
  1067 00000C5D 8A25[B50B0000]      <1> 		mov ah, [endkey305]
  1068 00000C63 38E0                <1> 		cmp al, ah
  1069 00000C65 0F8565FFFFFF        <1> 		jne int305b
  1070 00000C6B 4E                  <1> 		dec esi
  1071 00000C6C BF[701A0000]        <1> 		mov edi, buftxt2
  1072                              <1> 	copylaterstuff:
  1073 00000C71 8A07                <1> 		mov al, [edi]
  1074 00000C73 3C00                <1> 		cmp al, 0
  1075 00000C75 7406                <1> 		je nocopylaterstuff
  1076 00000C77 8806                <1> 		mov [esi], al
  1077 00000C79 47                  <1> 		inc edi
  1078 00000C7A 46                  <1> 		inc esi
  1079 00000C7B EBF4                <1> 		jmp copylaterstuff
  1080                              <1> 	nocopylaterstuff:
  1081 00000C7D C60600              <1> 		mov byte [esi], 0
  1082 00000C80 E801000000          <1> 		call clearbuftxt2
  1083 00000C85 C3                  <1> 		ret
  1084                              <1> 	
  1085                              <1> 	clearbuftxt2:
  1086 00000C86 B000                <1> 		mov al, 0
  1087 00000C88 BF[701A0000]        <1> 		mov edi, buftxt2
  1088                              <1> 	clearbuftxt2lp:
  1089 00000C8D 8807                <1> 		mov [edi], al
  1090 00000C8F 47                  <1> 		inc edi
  1091 00000C90 81FF[701C0000]      <1> 		cmp edi, buftxt
  1092 00000C96 75F5                <1> 		jne clearbuftxt2lp
  1093 00000C98 C3                  <1> 		ret
  1094                              <1> 		
  1095 00000C99 0000                <1> 	int305axcache dw 0
  1096                              <1> 		
  1097                              <1> 	int305left:
  1098 00000C9B BF[701A0000]        <1> 		mov edi, buftxt2
  1099 00000CA0 8A07                <1> 		mov al, [edi]
  1100                              <1> 	shiftbuftxt2:
  1101 00000CA2 3C00                <1> 		cmp al, 0
  1102 00000CA4 7409                <1> 		je noshiftbuftxt2
  1103 00000CA6 47                  <1> 		inc edi
  1104 00000CA7 8A27                <1> 		mov ah, [edi]
  1105 00000CA9 8807                <1> 		mov [edi], al
  1106 00000CAB 88E0                <1> 		mov al, ah
  1107 00000CAD EBF3                <1> 		jmp shiftbuftxt2
  1108                              <1> 	noshiftbuftxt2:
  1109 00000CAF BF[701A0000]        <1> 		mov edi, buftxt2
  1110 00000CB4 4E                  <1> 		dec esi
  1111 00000CB5 8A06                <1> 		mov al, [esi]
  1112 00000CB7 8807                <1> 		mov [edi], al
  1113 00000CB9 C60600              <1> 		mov byte [esi], 0
  1114 00000CBC B008                <1> 		mov al, 8
  1115 00000CBE E8D6FCFFFF          <1> 		call int301
  1116 00000CC3 E908FFFFFF          <1> 		jmp int305b
  1117                              <1> 		
  1118                              <1> 	int305right:
  1119 00000CC8 BF[701A0000]        <1> 		mov edi, buftxt2
  1120 00000CCD 8A07                <1> 		mov al, [edi]
  1121 00000CCF 3C00                <1> 		cmp al, 0
  1122 00000CD1 0F84F9FEFFFF        <1> 		je near int305b
  1123 00000CD7 8806                <1> 		mov [esi], al
  1124                              <1> 	shiftbuftxt2lft:
  1125 00000CD9 3C00                <1> 		cmp al, 0
  1126 00000CDB 7408                <1> 		je noshiftbuftxt2lft
  1127 00000CDD 47                  <1> 		inc edi
  1128 00000CDE 8A07                <1> 		mov al, [edi]
  1129 00000CE0 8847FF              <1> 		mov [edi - 1], al
  1130 00000CE3 EBF4                <1> 		jmp shiftbuftxt2lft
  1131                              <1> 	noshiftbuftxt2lft:
  1132 00000CE5 8A06                <1> 		mov al, [esi]
  1133 00000CE7 46                  <1> 		inc esi
  1134 00000CE8 8A1D[B60B0000]      <1> 		mov bl, [modkey305]
  1135 00000CEE E8A6FCFFFF          <1> 		call int301
  1136 00000CF3 E9D8FEFFFF          <1> 		jmp int305b
  1137                              <1> 		
  1138                              <1> 	int305downbck:
  1139 00000CF8 FECC                <1> 		dec ah
  1140 00000CFA 8825[BB0B0000]      <1> 		mov [commandedit], ah
  1141 00000D00 E83A000000          <1> 		call int305bckspc
  1142 00000D05 E9C6FEFFFF          <1> 		jmp int305b
  1143                              <1> 	
  1144                              <1> 	int305down:
  1145 00000D0A 8A25[BB0B0000]      <1> 		mov ah, [commandedit]
  1146 00000D10 80FC01              <1> 		cmp ah, 1
  1147 00000D13 0F86B7FEFFFF        <1> 		jbe near int305b
  1148 00000D19 80FC02              <1> 		cmp ah, 2
  1149 00000D1C 74DA                <1> 		je int305downbck
  1150 00000D1E 80EC02              <1> 		sub ah, 2
  1151 00000D21 8825[BB0B0000]      <1> 		mov [commandedit], ah
  1152                              <1> 		
  1153                              <1> 	int305up:
  1154                              <1> 		;cmp bl, 0xE0
  1155                              <1> 		;jne int305b
  1156 00000D27 B000                <1> 		mov al, 0
  1157 00000D29 3805[BB0B0000]      <1> 		cmp [commandedit], al
  1158 00000D2F 0F849BFEFFFF        <1> 		je near int305b
  1159 00000D35 E805000000          <1> 		call int305bckspc
  1160 00000D3A E93C000000          <1> 		jmp getcurrentcommandstr
  1161                              <1> 	int305bckspc:
  1162 00000D3F 81FE[701C0000]      <1> 		cmp esi, buftxt
  1163 00000D45 7426                <1> 		je noint305upbck
  1164                              <1> 	int305upbckspclp:
  1165 00000D47 B008                <1> 		mov al, 8
  1166 00000D49 8A1D[B60B0000]      <1> 		mov bl, [modkey305]
  1167 00000D4F E851FCFFFF          <1> 		call int301prnt
  1168 00000D54 B020                <1> 		mov al, " "
  1169 00000D56 E84AFCFFFF          <1> 		call int301prnt
  1170 00000D5B B008                <1> 		mov al, 8
  1171 00000D5D E837FCFFFF          <1> 		call int301
  1172 00000D62 4E                  <1> 		dec esi
  1173 00000D63 81FE[701C0000]      <1> 		cmp esi, buftxt
  1174 00000D69 7402                <1> 		je noint305upbck
  1175 00000D6B EBDA                <1> 		jmp int305upbckspclp
  1176                              <1> 	noint305upbck:
  1177 00000D6D 8B3D[11320000]      <1> 		mov edi, [currentcommandpos]
  1178 00000D73 81C7[15320000]      <1> 		add edi, commandbuf
  1179 00000D79 4F                  <1> 		dec edi
  1180 00000D7A C3                  <1> 		ret
  1181                              <1> 	getcurrentcommandstr:
  1182 00000D7B 8A25[BB0B0000]      <1> 		mov ah, [commandedit]
  1183 00000D81 FE05[BB0B0000]      <1> 		inc byte [commandedit]
  1184                              <1> 	getccmdlp:
  1185 00000D87 4F                  <1> 		dec edi
  1186 00000D88 8A07                <1> 		mov al, [edi]
  1187 00000D8A 81FF[15320000]      <1> 		cmp edi, commandbuf
  1188 00000D90 7231                <1> 		jb getcmdresetcommandbuf
  1189 00000D92 81EF[15320000]      <1> 		sub edi, commandbuf
  1190 00000D98 3B3D[11320000]      <1> 		cmp edi, [currentcommandpos]
  1191 00000D9E 0F842CFEFFFF        <1> 		je near int305b
  1192 00000DA4 81C7[15320000]      <1> 		add edi, commandbuf
  1193 00000DAA 3C00                <1> 		cmp al, 0
  1194 00000DAC 75D9                <1> 		jne getccmdlp
  1195 00000DAE FECC                <1> 		dec ah
  1196 00000DB0 80FC00              <1> 		cmp ah, 0
  1197 00000DB3 77D2                <1> 		ja getccmdlp
  1198 00000DB5 47                  <1> 		inc edi
  1199 00000DB6 81FF[15360000]      <1> 		cmp edi, commandbufend
  1200 00000DBC 770D                <1> 		ja fixcmdbufb4moreint305
  1201 00000DBE E915000000          <1> 		jmp moreint305up
  1202                              <1> 	getcmdresetcommandbuf:
  1203 00000DC3 BF[15360000]        <1> 		mov edi, commandbufend
  1204 00000DC8 47                  <1> 		inc edi
  1205 00000DC9 EBBC                <1> 		jmp getccmdlp
  1206                              <1> 	fixcmdbufb4moreint305:
  1207 00000DCB 4F                  <1> 		dec edi
  1208 00000DCC 81EF[15360000]      <1> 		sub edi, commandbufend
  1209 00000DD2 81C7[15320000]      <1> 		add edi, commandbuf
  1210                              <1> 	moreint305up:
  1211 00000DD8 8A07                <1> 		mov al, [edi]
  1212 00000DDA 47                  <1> 		inc edi
  1213 00000DDB 81EF[15320000]      <1> 		sub edi, commandbuf
  1214 00000DE1 3C00                <1> 		cmp al, 0
  1215 00000DE3 0F84E7FDFFFF        <1> 		je near int305b
  1216 00000DE9 3B3D[11320000]      <1> 		cmp edi, [currentcommandpos]
  1217 00000DEF 0F83DBFDFFFF        <1> 		jae near int305b
  1218 00000DF5 81C7[15320000]      <1> 		add edi, commandbuf
  1219 00000DFB 8806                <1> 		mov [esi], al
  1220 00000DFD 46                  <1> 		inc esi
  1221 00000DFE 57                  <1> 		push edi
  1222 00000DFF 8A1D[B60B0000]      <1> 		mov bl, [modkey305]
  1223 00000E05 E88FFBFFFF          <1> 		call int301
  1224 00000E0A 5F                  <1> 		pop edi
  1225 00000E0B 81FF[15360000]      <1> 		cmp edi, commandbufend
  1226 00000E11 76C5                <1> 		jbe moreint305up
  1227 00000E13 BF[15320000]        <1> 		mov edi, commandbuf
  1228 00000E18 EBBE                <1> 		jmp moreint305up
  1229                              <1> 	int305bscheck:
  1230 00000E1A 3B35[B70B0000]      <1> 		cmp esi, [firstesi305]
  1231 00000E20 7705                <1> 		ja goodbscheck
  1232 00000E22 E9A9FDFFFF          <1> 		jmp int305b
  1233                              <1> 	goodbscheck:
  1234 00000E27 4E                  <1> 		dec esi
  1235 00000E28 C60600              <1> 		mov byte [esi], 0
  1236 00000E2B 8A1D[B60B0000]      <1> 		mov bl, [modkey305]
  1237 00000E31 B008                <1> 		mov al, 8
  1238 00000E33 E9D4FDFFFF          <1> 		jmp bscheckequal
  1239                              <1> 	
  1240                              <1> 		
  1241                              <1> 	clear:		
  1242                              <1> 	
  1243                              <1> 	int306:	;;clear screen
  1244 00000E38 668B0D[95090000]    <1> 		mov cx, [charxy]
  1245 00000E3F BF[851E0000]        <1> 		mov edi, videobuf2
  1246 00000E44 66B80000            <1> 		mov ax, 0
  1247 00000E48 66A3[8F090000]      <1> 		mov [linebeginpos], ax
  1248 00000E4E 66A3[91090000]      <1> 		mov [videobufpos], ax
  1249 00000E54 66BA0000            <1> 		mov dx, 0
  1250 00000E58 66A3[93090000]      <1> 		mov [charpos], ax
  1251                              <1> 	int306b:
  1252 00000E5E 668907              <1> 		mov [edi], ax
  1253 00000E61 81C702000000        <1> 		add edi, 2
  1254 00000E67 80E902              <1> 		sub cl, 2
  1255 00000E6A 80F900              <1> 		cmp cl, 0
  1256 00000E6D 75EF                <1> 		jne int306b
  1257 00000E6F 8A0D[95090000]      <1> 		mov cl, [charxy]
  1258 00000E75 FECD                <1> 		dec ch
  1259 00000E77 80FD00              <1> 		cmp ch, 0
  1260 00000E7A 75E2                <1> 		jne int306b
  1261 00000E7C E906000000          <1> 		jmp termcopy
  1262                              <1> 		
  1263 00000E81 00000000            <1> 	termcursorpos dd 0
  1264 00000E85 0000                <1> 	removedvideo dw 0
  1265                              <1> termcopy:	
  1266 00000E87 60                  <1> 	pusha
  1267 00000E88 BF[851E0000]        <1> 	mov edi, videobuf2
  1268 00000E8D BB00000000          <1> 	mov ebx, 0
  1269 00000E92 668B1D[91090000]    <1> 	mov bx, [videobufpos]
  1270 00000E99 01DF                <1> 	add edi, ebx
  1271 00000E9B 893D[810E0000]      <1> 	mov [termcursorpos], edi
  1272 00000EA1 E8C0000000          <1> 	call switchtermcursor
  1273 00000EA6 C605[A82C0000]00    <1> 	mov byte [mouseselecton], 0
  1274 00000EAD C605[A4090000]01    <1> 	mov byte [termcopyon], 1
  1275 00000EB4 803D[A92C0000]00    <1> 	cmp byte [guion], 0
  1276 00000EBB 0F8412000000        <1> 	je near nowincopy
  1277 00000EC1 803D[A3090000]01    <1> 	cmp byte [termguion], 1
  1278 00000EC8 0F84BB290000        <1> 	je near windowvideocopy
  1279 00000ECE E98C000000          <1> 	jmp nocopytermatall
  1280                              <1> nowincopy:
  1281 00000ED3 BE00000A00          <1> 	mov esi, 0xA0000
  1282 00000ED8 A1[66030000]        <1> 	mov eax, [basecache]
  1283 00000EDD C1E004              <1> 	shl eax, 4
  1284 00000EE0 29C6                <1> 	sub esi, eax
  1285 00000EE2 BF[851E0000]        <1> 	mov edi, videobuf2
  1286 00000EE7 B900000000          <1> 	mov ecx, 0
  1287 00000EEC 668B0D[95090000]    <1> 	mov cx, [charxy]
  1288                              <1> nowincopy2:
  1289 00000EF3 BB[70480000]        <1> 	mov ebx, fonts
  1290 00000EF8 B800000000          <1> 	mov eax, 0
  1291 00000EFD 8A07                <1> 	mov al, [edi]
  1292 00000EFF C1E004              <1> 	shl eax, 4
  1293 00000F02 01C3                <1> 	add ebx, eax
  1294 00000F04 47                  <1> 	inc edi
  1295 00000F05 8A27                <1> 	mov ah, [edi]
  1296 00000F07 BA00000000          <1> 	mov edx, 0
  1297 00000F0C 8A15[95090000]      <1> 	mov dl, [charxy]
  1298 00000F12 D1EA                <1> 	shr edx, 1
  1299 00000F14 C1C110              <1> 	rol ecx, 16
  1300 00000F17 B110                <1> 	mov cl, 16
  1301                              <1> nowinfont:
  1302 00000F19 8A03                <1> 	mov al, [ebx]
  1303 00000F1B D0C8                <1> 	ror al, 1
  1304 00000F1D 80FC07              <1> 	cmp ah, 7
  1305 00000F20 7602                <1> 	jbe notnotfont
  1306 00000F22 F6D0                <1> 	not al
  1307                              <1> notnotfont:
  1308 00000F24 8806                <1> 	mov [esi], al
  1309 00000F26 01D6                <1> 	add esi, edx
  1310 00000F28 43                  <1> 	inc ebx
  1311 00000F29 FEC9                <1> 	dec cl
  1312 00000F2B 80F900              <1> 	cmp cl, 0
  1313 00000F2E 75E9                <1> 	jne nowinfont
  1314 00000F30 C1E204              <1> 	shl edx, 4
  1315 00000F33 29D6                <1> 	sub esi, edx
  1316 00000F35 C1C110              <1> 	rol ecx, 16
  1317                              <1> nopresentwinfont:
  1318 00000F38 47                  <1> 	inc edi
  1319 00000F39 46                  <1> 	inc esi
  1320 00000F3A 80E902              <1> 	sub cl, 2
  1321 00000F3D 80F900              <1> 	cmp cl, 0
  1322 00000F40 75B1                <1> 	jne nowincopy2
  1323 00000F42 8A0D[95090000]      <1> 	mov cl, [charxy]
  1324 00000F48 BA00000000          <1> 	mov edx, 0
  1325 00000F4D 88CA                <1> 	mov dl, cl
  1326 00000F4F D1EA                <1> 	shr edx, 1
  1327 00000F51 29D6                <1> 	sub esi, edx
  1328 00000F53 C1E204              <1> 	shl edx, 4
  1329 00000F56 01D6                <1> 	add esi, edx
  1330 00000F58 FECD                <1> 	dec ch
  1331 00000F5A 80FD00              <1> 	cmp ch, 0
  1332 00000F5D 7594                <1> 	jne nowincopy2
  1333                              <1> nocopytermatall:
  1334 00000F5F E802000000          <1> 	call switchtermcursor
  1335 00000F64 61                  <1> 	popa
  1336 00000F65 C3                  <1> 	ret
  1337                              <1> 	
  1338                              <1> switchtermcursor:
  1339 00000F66 8B3D[810E0000]      <1> 	mov edi, [termcursorpos]
  1340 00000F6C 8A4701              <1> 	mov al, [edi + 1]
  1341 00000F6F 8A27                <1> 	mov ah, [edi]
  1342 00000F71 3C07                <1> 	cmp al, 7
  1343 00000F73 7607                <1> 	jbe movlargecursorterm
  1344 00000F75 B007                <1> 	mov al, 7
  1345 00000F77 E902000000          <1> 	jmp movedcursorterm
  1346                              <1> movlargecursorterm:
  1347 00000F7C B0F0                <1> 	mov al, 0xF0
  1348                              <1> movedcursorterm:
  1349 00000F7E 884701              <1> 	mov [edi + 1], al
  1350 00000F81 80FC00              <1> 	cmp ah, 0
  1351 00000F84 7504                <1> 	jne fixednocursorterm
  1352 00000F86 B420                <1> 	mov ah, " "
  1353 00000F88 8827                <1> 	mov [edi], ah
  1354                              <1> fixednocursorterm:
  1355 00000F8A C3                  <1> 	ret
  1356                              <1> 	
  1357                                      %include 'source/solleros.asm'
  1358                              <1> 	;SOLLEROS.ASM
  1359                              <1> os:
  1360 00000F8B E8A8FEFFFF          <1> 	call clear
  1361 00000F90 BE[2D480000]        <1> 	mov esi, userask
  1362 00000F95 E8D8FBFFFF          <1> 	call print
  1363                              <1> usercheck:
  1364 00000F9A BE[701C0000]        <1> 	mov esi, buftxt
  1365 00000F9F B00D                <1> 	mov al, 13
  1366 00000FA1 B404                <1> 	mov ah, 4
  1367 00000FA3 CD30                <1> 	int 30h
  1368 00000FA5 56                  <1> 	push esi
  1369 00000FA6 BE[4D480000]        <1> 	mov esi, line
  1370 00000FAB E8C2FBFFFF          <1> 	call print
  1371 00000FB0 BE[37480000]        <1> 	mov esi, pwdask
  1372 00000FB5 E8B8FBFFFF          <1> 	call print
  1373 00000FBA 5E                  <1> 	pop esi
  1374 00000FBB 46                  <1> 	inc esi
  1375 00000FBC 8935[7A100000]      <1> 	mov [esipass], esi
  1376                              <1> passcheck:
  1377 00000FC2 B000                <1> 	mov al, 0
  1378 00000FC4 B405                <1> 	mov ah, 5
  1379 00000FC6 CD30                <1> 	int 30h
  1380 00000FC8 3C0D                <1> 	cmp al, 13
  1381 00000FCA 0F8435000000        <1> 	je near gotpass
  1382 00000FD0 3C08                <1> 	cmp al, 8
  1383 00000FD2 0F840F000000        <1> 	je near backpass
  1384 00000FD8 8806                <1> 	mov [esi], al
  1385 00000FDA 46                  <1> 	inc esi
  1386 00000FDB B02A                <1> 	mov al, '*'
  1387 00000FDD B406                <1> 	mov ah, 6
  1388 00000FDF CD30                <1> 	int 30h
  1389 00000FE1 EBDF                <1> 	jmp passcheck
  1390 00000FE3 08200800            <1> backcursor2 db 8," ",8,0
  1391                              <1> backpass:
  1392 00000FE7 3B35[7A100000]      <1> 	cmp esi, [esipass]
  1393 00000FED 0F84CFFFFFFF        <1> 	je near passcheck
  1394 00000FF3 4E                  <1> 	dec esi
  1395 00000FF4 C60600              <1> 	mov byte [esi], 0
  1396 00000FF7 56                  <1> 	push esi
  1397 00000FF8 BE[E30F0000]        <1> 	mov esi, backcursor2
  1398 00000FFD E870FBFFFF          <1> 	call print
  1399 00001002 5E                  <1> 	pop esi
  1400 00001003 EBBD                <1> 	jmp passcheck
  1401                              <1> gotpass:
  1402 00001005 B000                <1> 	mov al,0
  1403 00001007 8806                <1> 	mov [esi], al
  1404 00001009 BE[4D480000]        <1> 	mov esi, line
  1405 0000100E E85FFBFFFF          <1> 	call print
  1406 00001013 BB[50480000]        <1> 	mov ebx, userlst
  1407                              <1> userfind:
  1408 00001018 BE[701C0000]        <1> 	mov esi, buftxt
  1409 0000101D 8A06                <1> 	mov al, [esi]
  1410 0000101F 3C00                <1> 	cmp al, 0
  1411 00001021 0F8464FFFFFF        <1> 	je near os
  1412 00001027 891D[7E100000]      <1> 	mov [usercache], ebx
  1413 0000102D E8BF010000          <1> 	call tester
  1414 00001032 3C01                <1> 	cmp al, 1
  1415 00001034 7415                <1> 	je pwdtest
  1416                              <1> nxtuser:
  1417 00001036 43                  <1> 	inc ebx
  1418 00001037 8A03                <1> 	mov al, [ebx]
  1419 00001039 3C00                <1> 	cmp al, 0
  1420 0000103B 74DB                <1> 	je userfind
  1421 0000103D 81FB[70480000]      <1> 	cmp ebx, userlstend
  1422 00001043 0F8342FFFFFF        <1> 	jae near os
  1423 00001049 EBCD                <1> 	jmp userfind
  1424                              <1> pwdtest:
  1425 0000104B 46                  <1> 	inc esi
  1426 0000104C 43                  <1> 	inc ebx
  1427 0000104D E89F010000          <1> 	call tester
  1428 00001052 3C01                <1> 	cmp al, 1
  1429 00001054 7402                <1> 	je pwdrgt
  1430 00001056 EBDE                <1> 	jmp nxtuser
  1431 00001058 E8DBFDFFFF          <1> pwdrgt:	call clear
  1432 0000105D 66B90002            <1> 	mov cx, 200h
  1433 00001061 BE[701C0000]        <1> 	mov esi, buftxt
  1434 00001066 B000                <1> 	mov al, 0
  1435 00001068 8806                <1> bufclr:	mov [esi], al
  1436 0000106A 46                  <1> 	inc esi
  1437 0000106B E2FB                <1> 	loop bufclr
  1438                              <1> ;;;;;;;;;;;;;;;;
  1439 0000106D C605[79100000]01    <1> 	mov byte [nwcmdon], 1
  1440 00001074 E92C000000          <1> 	jmp nwcmd
  1441                              <1> 
  1442 00001079 00                  <1> nwcmdon db 0
  1443 0000107A 00000000            <1> esipass dd 0
  1444 0000107E [50480000]          <1> usercache dd userlst
  1445                              <1> 	
  1446                              <1> buftxtclear:
  1447 00001082 B000                <1> 	mov al, 0
  1448 00001084 BE[701C0000]        <1> 	mov esi, buftxt
  1449 00001089 81FE[701E0000]      <1> clearbuftxt: cmp esi, buf2
  1450 0000108F 730E                <1> 	jae retbufclr
  1451 00001091 8806                <1> 	mov [esi], al
  1452 00001093 46                  <1> 	inc esi
  1453 00001094 EBF3                <1> 	jmp clearbuftxt
  1454                              <1> 
  1455 00001096 39DE                <1> clearitbuf: cmp esi, ebx
  1456 00001098 7305                <1> 	jae retbufclr
  1457 0000109A 8806                <1> 	mov [esi], al
  1458 0000109C 46                  <1> 	inc esi
  1459 0000109D EBF7                <1> 	jmp clearitbuf
  1460 0000109F C3                  <1> retbufclr: ret
  1461                              <1> 
  1462 000010A0 E900000000          <1> full:	jmp nwcmd
  1463                              <1> 
  1464                              <1> 
  1465 000010A5 B001                <1> nwcmd:	mov al, 1
  1466 000010A7 3805[69130000]      <1> 	cmp [BATCHISON], al
  1467 000010AD 0F83A5000000        <1> 	jae near batchran
  1468 000010B3 3805[79100000]      <1> 	cmp [nwcmdon], al
  1469 000010B9 7401                <1> 	je cancel
  1470 000010BB C3                  <1> 	ret	;;return from terminal
  1471 000010BC B000                <1> cancel:	mov al, 0
  1472 000010BE A2[00130000]        <1> 	mov [IFON], al
  1473 000010C3 A2[69130000]        <1> 	mov [BATCHISON], al
  1474 000010C8 B05B                <1> 	mov al, '['
  1475 000010CA B406                <1> 	mov ah, 6
  1476 000010CC 66BB0700            <1> 	mov bx, 7
  1477 000010D0 E8D0F8FFFF          <1> 	call int301prnt
  1478 000010D5 8B35[7E100000]      <1> 	mov esi, [usercache]
  1479 000010DB E892FAFFFF          <1> 	call print
  1480 000010E0 BE[41480000]        <1> 	mov esi, location
  1481 000010E5 E888FAFFFF          <1> 	call print
  1482                              <1> 	;call time
  1483                              <1> 	;mov esi, timeshow
  1484                              <1> 	;call print
  1485                              <1> 	;mov esi, cmd
  1486                              <1> 	;call print
  1487 000010EA E893FFFFFF          <1> 	call buftxtclear
  1488 000010EF BE[701C0000]        <1> 	mov esi, buftxt
  1489 000010F4 C605[BB0B0000]01    <1> 	mov byte [commandedit], 1
  1490 000010FB B00D                <1> 	mov al, 13
  1491 000010FD B307                <1> 	mov bl, 7
  1492 000010FF B404                <1> 	mov ah, 4
  1493 00001101 CD30                <1> 	int 30h
  1494 00001103 C605[BB0B0000]00    <1> 	mov byte [commandedit], 0
  1495 0000110A 8B35[11320000]      <1> gotcmd:	mov esi, [currentcommandpos]
  1496 00001110 8935[0D320000]      <1> 	mov [lastcommandpos], esi
  1497 00001116 BF[701C0000]        <1> 	mov edi, buftxt
  1498 0000111B 81C6[15320000]      <1> 	add esi, commandbuf
  1499 00001121 81FE[15360000]      <1> 	cmp esi, commandbufend
  1500 00001127 7605                <1> 	jbe copycommand
  1501 00001129 BE[15320000]        <1> 	mov esi, commandbuf
  1502                              <1> copycommand:
  1503 0000112E 8A07                <1> 	mov al, [edi]
  1504 00001130 8806                <1> 	mov [esi], al
  1505 00001132 47                  <1> 	inc edi
  1506 00001133 46                  <1> 	inc esi
  1507 00001134 3C00                <1> 	cmp al, 0
  1508 00001136 740F                <1> 	je donecopy
  1509 00001138 81FE[15360000]      <1> 	cmp esi, commandbufend
  1510 0000113E 76EE                <1> 	jbe copycommand
  1511 00001140 BE[15320000]        <1> 	mov esi, commandbuf
  1512 00001145 EBE7                <1> 	jmp copycommand
  1513                              <1> donecopy:
  1514 00001147 81EE[15320000]      <1> 	sub esi, commandbuf
  1515 0000114D 8935[11320000]      <1> 	mov [currentcommandpos], esi
  1516 00001153 E914000000          <1> 	jmp run
  1517                              <1> 	
  1518                              <1> batchran:
  1519 00001158 C3                  <1> 	ret
  1520                              <1> 
  1521 00001159 E824FFFFFF          <1> input:	call buftxtclear
  1522 0000115E BE[701C0000]        <1> 	mov esi, buftxt		;puts input into buftxt AND onto screen
  1523 00001163 B00D                <1> stdin:	mov al, 13
  1524 00001165 B307                <1> 	mov bl, 7
  1525 00001167 B404                <1> 	mov ah, 4
  1526 00001169 CD30                <1> 	int 30h
  1527 0000116B C3                  <1> 	ret
  1528                              <1> 
  1529 0000116C BE[4D480000]        <1> run:	mov esi, line
  1530 00001171 E8FCF9FFFF          <1> 	call print
  1531                              <1> progtest:
  1532 00001176 BE[701C0000]        <1> 	mov esi, buftxt
  1533 0000117B BB[6F130000]        <1> 	mov ebx, fileindex
  1534 00001180 668B03              <1> prgnxt:	mov ax, [ebx]
  1535 00001183 B105                <1> 	mov cl, 5
  1536 00001185 B504                <1> 	mov ch, 4
  1537 00001187 6639C8              <1> 	cmp ax, cx
  1538 0000118A 740B                <1> 	je fndprg
  1539 0000118C 43                  <1> 	inc ebx
  1540 0000118D 81FB[6F150000]      <1> 	cmp ebx, fileindexend
  1541 00001193 7330                <1> 	jae prgnf
  1542 00001195 EBE9                <1> 	jmp prgnxt
  1543 00001197 81C302000000        <1> fndprg: add ebx, 2
  1544 0000119D BE[701C0000]        <1> 	mov esi, buftxt
  1545 000011A2 66B90000            <1> 	mov cx, 0
  1546 000011A6 E880000000          <1> 	call cndtest
  1547 000011AB 3C01                <1> 	cmp al, 1
  1548 000011AD 7302                <1> 	jae prggood
  1549 000011AF EBCF                <1> 	jmp prgnxt
  1550 000011B1 81FB[6F150000]      <1> prggood: cmp ebx, fileindexend
  1551 000011B7 7333                <1> 	jae prgdn
  1552 000011B9 81C303000000        <1> 	add ebx, 3
  1553 000011BF 8B3B                <1> 	mov edi, [ebx]
  1554 000011C1 90                  <1> 	nop
  1555 000011C2 90                  <1> 	nop
  1556 000011C3 FFE7                <1> 	jmp edi
  1557                              <1> prgnf:	
  1558 000011C5 A0[701C0000]        <1> 	mov al, [buftxt]
  1559 000011CA 3C00                <1> 	cmp al, 0
  1560 000011CC 741E                <1> 	je prgdn
  1561 000011CE BE[14480000]        <1> 	mov esi, notfound1
  1562 000011D3 E89AF9FFFF          <1> 	call print
  1563 000011D8 BE[701C0000]        <1> 	mov esi, buftxt
  1564 000011DD E890F9FFFF          <1> 	call print
  1565 000011E2 BE[1E480000]        <1> 	mov esi, notfound2
  1566 000011E7 E886F9FFFF          <1> 	call print
  1567 000011EC E9B4FEFFFF          <1> prgdn:	jmp nwcmd
  1568                              <1> 
  1569                              <1> 
  1570                              <1> tester:			;si=user bx=prog returns 1 in al if true
  1571 000011F1 B000                <1> 	mov al, 0
  1572 000011F3 8A06                <1> retest:	mov al, [esi]
  1573 000011F5 8A23                <1> 	mov ah, [ebx]
  1574 000011F7 3C00                <1> 	cmp al, 0
  1575 000011F9 7408                <1> 	je testtrue
  1576 000011FB 38E0                <1> 	cmp al, ah
  1577 000011FD 750C                <1> 	jne testfalse
  1578 000011FF 43                  <1> 	inc ebx
  1579 00001200 46                  <1> 	inc esi
  1580 00001201 EBF0                <1> 	jmp retest
  1581                              <1> testtrue:
  1582 00001203 80FC00              <1> 	cmp ah, 0
  1583 00001206 7503                <1> 	jne testfalse
  1584 00001208 B001                <1> 	mov al, 1
  1585 0000120A C3                  <1> 	ret
  1586                              <1> testfalse:
  1587 0000120B B000                <1> 	mov al, 0
  1588 0000120D C3                  <1> 	ret
  1589                              <1> 
  1590                              <1> optest:			;si=user bx=prog returns 1 in al if true
  1591 0000120E B000                <1> 	mov al, 0
  1592                              <1> opretest:
  1593 00001210 8A06                <1> 	mov al, [esi]
  1594 00001212 8A23                <1> 	mov ah, [ebx]
  1595 00001214 38E0                <1> 	cmp al, ah
  1596 00001216 7510                <1> 	jne optestfalse
  1597 00001218 80FC00              <1> 	cmp ah, 0
  1598 0000121B 7404                <1> 	je optesttrue
  1599 0000121D 43                  <1> 	inc ebx
  1600 0000121E 46                  <1> 	inc esi
  1601 0000121F EBEF                <1> 	jmp opretest
  1602                              <1> optesttrue:
  1603 00001221 3C00                <1> 	cmp al, 0
  1604 00001223 7503                <1> 	jne optestfalse
  1605 00001225 B001                <1> 	mov al, 1
  1606 00001227 C3                  <1> 	ret
  1607                              <1> optestfalse:
  1608 00001228 B000                <1> 	mov al, 0
  1609 0000122A C3                  <1> 	ret
  1610                              <1> 
  1611                              <1> cndtest:			;si=user bx=prog cl=endchar returns 1 in al if true
  1612 0000122B B000                <1> 	mov al, 0
  1613 0000122D 8A06                <1> cndretest:	mov al, [esi]
  1614 0000122F 8A23                <1> 	mov ah, [ebx]
  1615 00001231 38CC                <1> 	cmp ah, cl
  1616 00001233 7408                <1> 	je cndtesttrue
  1617 00001235 38E0                <1> 	cmp al, ah
  1618 00001237 750B                <1> 	jne cndtestfalse
  1619 00001239 43                  <1> 	inc ebx
  1620 0000123A 46                  <1> 	inc esi
  1621 0000123B EBF0                <1> 	jmp cndretest
  1622                              <1> cndtesttrue:
  1623 0000123D 38C8                <1> 	cmp al, cl
  1624 0000123F 7506                <1> 	jne cndtestalmost
  1625 00001241 B001                <1> 	mov al, 1
  1626 00001243 C3                  <1> 	ret
  1627                              <1> cndtestfalse:
  1628 00001244 B000                <1> 	mov al, 0
  1629 00001246 C3                  <1> 	ret
  1630                              <1> cndtestalmost:
  1631 00001247 B002                <1> 	mov al, 2
  1632 00001249 C3                  <1> 	ret
  1633 0000124A 00                  <1> currentdir db 0
  1634 0000124B BE[6F130000]        <1> dir:	mov esi, fileindex
  1635 00001250 8A06                <1> 	dirnxt:	mov al, [esi]
  1636 00001252 B400                <1> 		mov ah, 0
  1637 00001254 3C05                <1> 		cmp al, 5
  1638 00001256 744A                <1> 		je dirfnd
  1639 00001258 3C07                <1> 		cmp al, 7
  1640 0000125A 743C                <1> 		je dirfnd3
  1641 0000125C 3C06                <1> 		cmp al, 6
  1642 0000125E 7438                <1> 		je dirfnd3
  1643 00001260 46                  <1> 		inc esi
  1644 00001261 81FE[6F150000]      <1> 		cmp esi,  fileindexend
  1645 00001267 737B                <1> 		jae dirdn
  1646 00001269 EBE5                <1> 		jmp dirnxt
  1647 0000126B 060400626174636800- <1> 	typetable db 6,4,0,"batch",0,7,4,0,"document",0,10,4,0,"folder",0,5,4,0,"executable",0
  1648 00001274 070400646F63756D65- <1>
  1649 0000127D 6E74000A0400666F6C- <1>
  1650 00001286 646572000504006578- <1>
  1651 0000128F 6563757461626C6500  <1>
  1652                              <1> 	dirfnd3:
  1653 00001298 46                  <1> 		inc esi
  1654 00001299 81FE[6F150000]      <1> 		cmp esi, fileindexend
  1655 0000129F 76AF                <1> 		jbe dirnxt
  1656 000012A1 4E                  <1> 		dec esi
  1657 000012A2 46                  <1> 	dirfnd:	inc esi
  1658 000012A3 8A06                <1> 		mov al, [esi]
  1659 000012A5 B400                <1> 		mov ah, 0
  1660 000012A7 3C04                <1> 		cmp al, 4
  1661 000012A9 740B                <1> 		je dirfnd2
  1662 000012AB 46                  <1> 		inc esi
  1663 000012AC 81FE[6F150000]      <1> 		cmp esi,  fileindexend
  1664 000012B2 7330                <1> 		jae dirdn
  1665 000012B4 EB9A                <1> 		jmp dirnxt
  1666 000012B6 81C601000000        <1> 	dirfnd2: add esi, 1
  1667 000012BC E8B1F8FFFF          <1> 		call print
  1668 000012C1 8935[E9120000]      <1> 		mov [esidir], esi
  1669 000012C7 BE[4D480000]        <1> 		mov esi, line
  1670 000012CC E8A1F8FFFF          <1> 		call print
  1671 000012D1 8B35[E9120000]      <1> 		mov esi, [esidir]
  1672 000012D7 81FE[6F150000]      <1> 		cmp esi,  fileindexend
  1673 000012DD 7305                <1> 		jae dirdn
  1674 000012DF E96CFFFFFF          <1> 		jmp dirnxt
  1675 000012E4 E9BCFDFFFF          <1> 	dirdn:	jmp nwcmd
  1676 000012E9 00000000            <1> esidir dd 0
  1677                              <1> 
  1678                              <1> array:				;arraystart in si, arrayend in bx, arrayseperator in cx
  1679                              <1> 		                ;ends if array seperator is found backwards after 0
  1680                              <1> 	arnxt:	      
  1681 000012ED 88E8                <1> 		mov al, ch
  1682 000012EF 88CC                <1> 		mov ah, cl        
  1683 000012F1 663906              <1> 		cmp [esi], ax
  1684 000012F4 744D                <1> 		je ardn
  1685 000012F6 66390E              <1> 		cmp [esi], cx
  1686 000012F9 7407                <1> 		je arfnd
  1687 000012FB 46                  <1> 		inc esi
  1688 000012FC 39DE                <1> 		cmp esi, ebx
  1689 000012FE 7343                <1> 		jae ardn
  1690 00001300 EBEB                <1> 		jmp arnxt
  1691 00001302 81C602000000        <1> 	arfnd: add esi, 2
  1692 00001308 891D[44130000]      <1> 		mov [arbx], ebx
  1693 0000130E 890D[48130000]      <1> 		mov [arcx], ecx
  1694 00001314 E859F8FFFF          <1> 		call print
  1695 00001319 8935[4A130000]      <1> 		mov [arsi], esi
  1696 0000131F BE[4D480000]        <1> 		mov esi, line
  1697 00001324 E849F8FFFF          <1> 		call print
  1698 00001329 8B1D[44130000]      <1> 		mov ebx, [arbx]
  1699 0000132F 668B0D[48130000]    <1> 		mov cx, [arcx]
  1700 00001336 8B35[4A130000]      <1> 		mov esi, [arsi]
  1701 0000133C 46                  <1> 		inc esi
  1702 0000133D 39DE                <1> 		cmp esi, ebx
  1703 0000133F 7302                <1> 		jae ardn
  1704 00001341 EBAA                <1> 		jmp arnxt
  1705 00001343 C3                  <1> 	ardn:	ret
  1706 00001344 00000000            <1> arbx:	dw 0,0
  1707 00001348 0000                <1> arcx:	db 0,0
  1708 0000134A 00000000            <1> arsi:	dw 0,0
  1709                              <1> 
  1710                              <1> clearbuffer:
  1711 0000134E BE[701E0000]        <1> 	mov esi, buf2
  1712 00001353 B030                <1> 	mov al, '0'
  1713 00001355 81FE[841E0000]      <1> clearbuf: cmp esi, numbuf
  1714 0000135B 7305                <1> 	jae doneclearbuff
  1715 0000135D 8806                <1> 	mov [esi], al
  1716 0000135F 46                  <1> 	inc esi
  1717 00001360 EBF3                <1> 	jmp clearbuf
  1718                              <1> doneclearbuff: 
  1719 00001362 C3                  <1> 		ret
  1720                              <1> 
  1721                              <1> convert:
  1722 00001363 4E                  <1> 	dec esi
  1723 00001364 89F3                <1> 	mov ebx, esi		;place to convert into must be in si, number to convert must be in cx
  1724                              <1> cnvrt:
  1725 00001366 89DE                <1> 	mov esi, ebx
  1726 00001368 81EE09000000        <1> 	sub esi, 9
  1727 0000136E 81F900CA9A3B        <1> 	cmp ecx, 1000000000
  1728 00001374 720A                <1> 	jb ten8
  1729 00001376 81E900CA9A3B        <1> 	sub ecx, 1000000000
  1730 0000137C FE06                <1> 	inc byte [esi]
  1731 0000137E EBE6                <1> 	jmp cnvrt
  1732 00001380 46                  <1> ten8:	inc esi
  1733 00001381 81F900E1F505        <1> 	cmp ecx, 100000000
  1734 00001387 720A                <1> 	jb ten7
  1735 00001389 81E900E1F505        <1> 	sub ecx, 100000000
  1736 0000138F FE06                <1> 	inc byte [esi]
  1737 00001391 EBD3                <1> 	jmp cnvrt
  1738 00001393 46                  <1> ten7:	inc esi
  1739 00001394 81F980969800        <1> 	cmp ecx, 10000000
  1740 0000139A 720A                <1> 	jb ten6
  1741 0000139C 81E980969800        <1> 	sub ecx, 10000000
  1742 000013A2 FE06                <1> 	inc byte [esi]
  1743 000013A4 EBC0                <1> 	jmp cnvrt
  1744 000013A6 46                  <1> ten6:	inc esi
  1745 000013A7 81F940420F00        <1> 	cmp ecx, 1000000
  1746 000013AD 720A                <1> 	jb ten5
  1747 000013AF 81E940420F00        <1> 	sub ecx, 1000000
  1748 000013B5 FE06                <1> 	inc byte [esi]
  1749 000013B7 EBAD                <1> 	jmp cnvrt
  1750 000013B9 46                  <1> ten5:	inc esi
  1751 000013BA 81F9A0860100        <1> 	cmp ecx, 100000
  1752 000013C0 720A                <1> 	jb ten4
  1753 000013C2 81E9A0860100        <1> 	sub ecx, 100000
  1754 000013C8 FE06                <1> 	inc byte [esi]
  1755 000013CA EB9A                <1> 	jmp cnvrt
  1756 000013CC 46                  <1> ten4:	inc esi
  1757 000013CD 81F910270000        <1> 	cmp ecx, 10000
  1758 000013D3 720A                <1> 	jb ten3
  1759 000013D5 81E910270000        <1> 	sub ecx, 10000
  1760 000013DB FE06                <1> 	inc byte [esi]
  1761 000013DD EB87                <1> 	jmp cnvrt
  1762 000013DF 46                  <1> ten3:	inc esi
  1763 000013E0 81F9E8030000        <1> 	cmp ecx, 1000
  1764 000013E6 720D                <1> 	jb ten2
  1765 000013E8 81E9E8030000        <1> 	sub ecx, 1000
  1766 000013EE FE06                <1> 	inc byte [esi]
  1767 000013F0 E971FFFFFF          <1> 	jmp cnvrt
  1768 000013F5 46                  <1> ten2:	inc esi
  1769 000013F6 81F964000000        <1> 	cmp ecx, 100
  1770 000013FC 720D                <1> 	jb ten1
  1771 000013FE 81E964000000        <1> 	sub ecx, 100
  1772 00001404 FE06                <1> 	inc byte [esi]
  1773 00001406 E95BFFFFFF          <1> 	jmp cnvrt
  1774 0000140B 46                  <1> ten1:	inc esi
  1775 0000140C 81F90A000000        <1> 	cmp ecx, 10
  1776 00001412 720D                <1> 	jb ten0
  1777 00001414 81E90A000000        <1> 	sub ecx, 10
  1778 0000141A FE06                <1> 	inc byte [esi]
  1779 0000141C E945FFFFFF          <1> 	jmp cnvrt
  1780 00001421 46                  <1> ten0:	inc esi
  1781 00001422 81F901000000        <1> 	cmp ecx, 1
  1782 00001428 720D                <1> 	jb tendn
  1783 0000142A 81E901000000        <1> 	sub ecx, 1
  1784 00001430 FE06                <1> 	inc byte [esi]
  1785 00001432 E92FFFFFFF          <1> 	jmp cnvrt
  1786                              <1> tendn:
  1787 00001437 C3                  <1> 	ret
  1788                              <1> 
  1789                              <1> 	
  1790                              <1> 
  1791 00001438 00<rept>            <1> hexnumber times 8 db 0
  1792 00001440 202000              <1> hexnumberend db "  ",0
  1793                              <1> 
  1794                              <1> 
  1795 00001443 00000000            <1> sibuf dw 0,0
  1796 00001447 00000000            <1> dibuf dw 0,0
  1797                              <1> 
  1798                              <1> converthex:
  1799                              <1> clearbufferhex:
  1800 0000144B B030                <1> 	mov al, '0'
  1801 0000144D 8935[43140000]      <1> 	mov [sibuf], esi
  1802 00001453 893D[47140000]      <1> 	mov [dibuf], edi
  1803 00001459 39FE                <1> clearbufhex: cmp esi, edi
  1804 0000145B 7305                <1> 	jae doneclearbuffhex
  1805 0000145D 8806                <1> 	mov [esi], al
  1806 0000145F 46                  <1> 	inc esi
  1807 00001460 EBF7                <1> 	jmp clearbufhex
  1808                              <1> doneclearbuffhex:
  1809 00001462 8B35[47140000]      <1> 	mov esi, [dibuf]
  1810 00001468 89CA                <1> 	mov edx, ecx
  1811 0000146A 81FA00000000        <1> 	cmp edx, 0
  1812 00001470 741F                <1> 	je donenxtephx
  1813                              <1> nxtexphx:	;0x10^x
  1814 00001472 4E                  <1> 	dec esi
  1815 00001473 89F7                <1> 	mov edi, esi		;;location of 0x10^x
  1816 00001475 89D1                <1> 	mov ecx, edx
  1817 00001477 81E10F000000        <1> 	and ecx, 0xF		;;just this digit
  1818 0000147D E81C000000          <1> 	call cnvrtexphx		;;get this digit
  1819 00001482 89FE                <1> 	mov esi, edi
  1820 00001484 C1EA04              <1> 	shr edx, 4		;;next digit
  1821 00001487 81FA00000000        <1> 	cmp edx, 0
  1822 0000148D 7402                <1> 	je donenxtephx
  1823 0000148F EBE1                <1> 	jmp nxtexphx
  1824                              <1> donenxtephx:
  1825 00001491 8B35[43140000]      <1> 	mov esi, [sibuf]
  1826 00001497 8B3D[47140000]      <1> 	mov edi, [dibuf]
  1827 0000149D C3                  <1> 	ret
  1828                              <1> cnvrtexphx:			;;convert this number
  1829 0000149E 89F3                <1> 	mov ebx, esi		;place to convert to must be in si, number to convert must be in cx
  1830 000014A0 81F900000000        <1> 	cmp ecx, 0
  1831 000014A6 7429                <1> 	je zerohx
  1832 000014A8 8A06                <1> cnvrthx:  mov al, [esi]
  1833 000014AA 3C39                <1> 	cmp al, '9'
  1834 000014AC 741B                <1> 	je lettershx
  1835 000014AE 3C46                <1> lttrhxdn: cmp al, 'F'
  1836 000014B0 741F                <1> 	je zerohx
  1837 000014B2 8A06                <1> 	mov al, [esi]
  1838 000014B4 FEC0                <1> 	inc al
  1839 000014B6 8806                <1> 	mov [esi], al
  1840 000014B8 89DE                <1> 	mov esi, ebx
  1841 000014BA 81E901000000        <1> cnvrtlphx: sub ecx, 1
  1842 000014C0 81F900000000        <1> 	cmp ecx, 0
  1843 000014C6 75E0                <1> 	jne cnvrthx
  1844 000014C8 C3                  <1> 	ret
  1845                              <1> lettershx:
  1846 000014C9 B041                <1> 	mov al, 'A'
  1847 000014CB 2C01                <1> 	sub al, 1
  1848 000014CD 8806                <1> 	mov [esi], al
  1849 000014CF EBDD                <1> 	jmp lttrhxdn
  1850 000014D1 B030                <1> zerohx:	mov al, '0'
  1851 000014D3 8806                <1> 	mov [esi], al
  1852 000014D5 4E                  <1> 	dec esi
  1853 000014D6 8A06                <1> 	mov al, [esi]
  1854 000014D8 3C46                <1> 	cmp al, 'F'
  1855 000014DA 74F5                <1> 	je zerohx
  1856 000014DC 41                  <1> 	inc ecx
  1857 000014DD EBDB                <1> 	jmp cnvrtlphx
  1858 000014DF 00                  <1> smallhex db 0
  1859 000014E0 01                  <1> firsthexshown db 1
  1860                              <1> showhexsmall:
  1861 000014E1 C605[DF140000]01    <1> 	mov byte [smallhex], 1
  1862 000014E8 E808000000          <1> 	call showhex
  1863 000014ED C605[DF140000]00    <1> 	mov byte [smallhex], 0
  1864 000014F4 C3                  <1> 	ret
  1865                              <1> showhex:
  1866 000014F5 60                  <1> 	pusha
  1867 000014F6 BE[38140000]        <1> 	mov esi, hexnumber
  1868 000014FB BF[40140000]        <1> 	mov edi, hexnumberend
  1869 00001500 E846FFFFFF          <1> 	call converthex
  1870 00001505 803D[E0140000]01    <1> 	cmp byte [firsthexshown], 1
  1871 0000150C 7504                <1> 	jne showthathex
  1872 0000150E 66BA0000            <1> 	mov dx, 0
  1873                              <1> showthathex:
  1874 00001512 803D[E0140000]03    <1> 	cmp byte [firsthexshown], 3
  1875 00001519 750A                <1> 	jne nonewhexline
  1876 0000151B BE[4D480000]        <1> 	mov esi, line
  1877 00001520 E84DF6FFFF          <1> 	call print
  1878                              <1> nonewhexline:
  1879 00001525 803D[E0140000]04    <1> 	cmp byte [firsthexshown], 4
  1880 0000152C 7527                <1> 	jne notabfixhex
  1881 0000152E B1A0                <1> 	mov cl, 160
  1882 00001530 28D1                <1> 	sub cl, dl
  1883 00001532 C0E905              <1> 	shr cl, 5
  1884 00001535 C0E105              <1> 	shl cl, 5
  1885 00001538 80F900              <1> 	cmp cl, 0
  1886 0000153B 750F                <1> 	jne nonewlinetabfixhex
  1887 0000153D BE[4D480000]        <1> 	mov esi, line
  1888 00001542 E82BF6FFFF          <1> 	call print
  1889 00001547 E909000000          <1> 	jmp notabfixhex
  1890                              <1> nonewlinetabfixhex:
  1891 0000154C 80C20F              <1> 	add dl, 15
  1892 0000154F C0EA04              <1> 	shr dl, 4
  1893 00001552 C0E204              <1> 	shl dl, 4
  1894                              <1> notabfixhex:
  1895 00001555 BE[38140000]        <1> 	mov esi, hexnumber
  1896 0000155A 803D[DF140000]01    <1> 	cmp byte [smallhex],1
  1897 00001561 7506                <1> 	jne printnosmallhex
  1898 00001563 81C606000000        <1> 	add esi, 6
  1899                              <1> printnosmallhex:
  1900 00001569 E804F6FFFF          <1> 	call print
  1901 0000156E 803D[E0140000]02    <1> 	cmp byte [firsthexshown], 2
  1902 00001575 750A                <1> 	jne hexshown
  1903 00001577 BE[4D480000]        <1> 	mov esi, line
  1904 0000157C E8F1F5FFFF          <1> 	call print
  1905                              <1> hexshown:
  1906 00001581 C605[E0140000]00    <1> 	mov byte [firsthexshown], 0
  1907 00001588 61                  <1> 	popa
  1908 00001589 C3                  <1> 	ret
  1909                              <1> 
  1910                              <1> 
  1911 0000158A 303030303030303030- <1> decnumber db "00000000000000"
  1912 00001593 3030303030          <1>
  1913 00001598 2000                <1> decnumberend: db " ",0
  1914                              <1> 
  1915                              <1> showdec: ;;same as showhex, just uses decimal conversion
  1916 0000159A 60                  <1> 	pusha
  1917 0000159B BF[8A150000]        <1> 	mov edi, decnumber
  1918 000015A0 BE[98150000]        <1> 	mov esi, decnumberend
  1919                              <1> cleardecbuf:
  1920 000015A5 C60730              <1> 	mov byte [edi], '0'
  1921 000015A8 47                  <1> 	inc edi
  1922 000015A9 39F7                <1> 	cmp edi, esi
  1923 000015AB 72F8                <1> 	jb cleardecbuf
  1924 000015AD BF[8A150000]        <1> 	mov edi, decnumber
  1925 000015B2 E8ACFDFFFF          <1> 	call convert
  1926 000015B7 803D[E0140000]01    <1> 	cmp byte [firsthexshown], 1
  1927 000015BE 7504                <1> 	jne showthatdec
  1928 000015C0 66BA0000            <1> 	mov dx, 0
  1929                              <1> showthatdec:
  1930 000015C4 803D[E0140000]03    <1> 	cmp byte [firsthexshown], 3
  1931 000015CB 750A                <1> 	jne nonewdecline
  1932 000015CD BE[4D480000]        <1> 	mov esi, line
  1933 000015D2 E89BF5FFFF          <1> 	call print
  1934                              <1> nonewdecline:
  1935 000015D7 803D[E0140000]04    <1> 	cmp byte [firsthexshown], 4
  1936 000015DE 7527                <1> 	jne notabfixdec
  1937 000015E0 B1A0                <1> 	mov cl, 160
  1938 000015E2 28D1                <1> 	sub cl, dl
  1939 000015E4 C0E905              <1> 	shr cl, 5
  1940 000015E7 C0E105              <1> 	shl cl, 5
  1941 000015EA 80F900              <1> 	cmp cl, 0
  1942 000015ED 750F                <1> 	jne nonewlinetabfixdec
  1943 000015EF BE[4D480000]        <1> 	mov esi, line
  1944 000015F4 E879F5FFFF          <1> 	call print
  1945 000015F9 E909000000          <1> 	jmp notabfixdec
  1946                              <1> nonewlinetabfixdec:
  1947 000015FE 80C20F              <1> 	add dl, 15
  1948 00001601 C0EA04              <1> 	shr dl, 4
  1949 00001604 C0E204              <1> 	shl dl, 4
  1950                              <1> notabfixdec:
  1951 00001607 BE[8A150000]        <1> 	mov esi, decnumber
  1952 0000160C 4E                  <1> 	dec esi
  1953                              <1> sifind:
  1954 0000160D 46                  <1> 	inc esi
  1955 0000160E 803E30              <1> 	cmp byte [esi], '0'
  1956 00001611 74FA                <1> 	je sifind
  1957 00001613 E85AF5FFFF          <1> 	call print
  1958 00001618 803D[E0140000]02    <1> 	cmp byte [firsthexshown], 2
  1959 0000161F 750A                <1> 	jne decshown
  1960 00001621 BE[4D480000]        <1> 	mov esi, line
  1961 00001626 E847F5FFFF          <1> 	call print
  1962                              <1> decshown:
  1963 0000162B C605[E0140000]00    <1> 	mov byte [firsthexshown], 0
  1964 00001632 61                  <1> 	popa
  1965 00001633 C3                  <1> 	ret
  1966                              <1> 	
  1967                              <1> cnvrttxt: 
  1968 00001634 B900000000          <1> 	mov ecx, 0
  1969 00001639 B800000000          <1> 	mov eax, 0
  1970 0000163E BA00000000          <1> 	mov edx, 0
  1971 00001643 BB00000000          <1> 	mov ebx, 0
  1972 00001648 4E                  <1> 	dec esi
  1973                              <1> cnvrtlptxt:
  1974 00001649 46                  <1> 	inc esi
  1975 0000164A 8A06                <1> 	mov al, [esi]
  1976 0000164C 3C00                <1> 	cmp al, 0
  1977 0000164E 75F9                <1> 	jne cnvrtlptxt
  1978 00001650 4E                  <1> 	dec esi
  1979 00001651 8A06                <1> 	mov al, [esi]
  1980 00001653 3C30                <1> 	cmp al, '0'
  1981 00001655 7504                <1> 	jne txtlp
  1982 00001657 39FE                <1> zerotest: cmp esi, edi
  1983 00001659 745B                <1> 	je donecnvrt
  1984                              <1> txtlp:	
  1985 0000165B B800000000          <1> 	mov eax, 0
  1986 00001660 8A06                <1> 	mov al, [esi]
  1987 00001662 3C3D                <1> 	cmp al, '='
  1988 00001664 7450                <1> 	je donecnvrt
  1989 00001666 3C30                <1> 	cmp al, 48
  1990 00001668 724C                <1> 	jb donecnvrt
  1991 0000166A 3C23                <1> 	cmp al, '#'
  1992 0000166C 7448                <1> 	je donecnvrt
  1993 0000166E 39FE                <1> 	cmp esi, edi
  1994 00001670 7244                <1> 	jb donecnvrt
  1995 00001672 81F900000000        <1> 	cmp ecx, 0
  1996 00001678 7708                <1> 	ja exp
  1997 0000167A 2C30                <1> noexp:	sub al, 48
  1998 0000167C 01C2                <1> 	add edx, eax
  1999 0000167E 4E                  <1> 	dec esi
  2000 0000167F 41                  <1> 	inc ecx
  2001 00001680 EBD9                <1> 	jmp txtlp
  2002 00001682 81F900000000        <1> exp:	cmp ecx, 0
  2003 00001688 74F0                <1> 	je noexp
  2004 0000168A 2C30                <1> 	sub al, 48
  2005 0000168C 51                  <1> 	push ecx
  2006 0000168D 89C3                <1> expmul:	mov ebx, eax
  2007 0000168F 01D8                <1> 	add eax, ebx
  2008 00001691 01D8                <1> 	add eax, ebx
  2009 00001693 01D8                <1> 	add eax, ebx
  2010 00001695 01D8                <1> 	add eax, ebx
  2011 00001697 01D8                <1> 	add eax, ebx
  2012 00001699 01D8                <1> 	add eax, ebx
  2013 0000169B 01D8                <1> 	add eax, ebx
  2014 0000169D 01D8                <1> 	add eax, ebx
  2015 0000169F 01D8                <1> 	add eax, ebx
  2016 000016A1 81E901000000        <1> 	sub ecx, 1
  2017 000016A7 81F900000000        <1> 	cmp ecx, 0
  2018 000016AD 77DE                <1> 	ja expmul
  2019 000016AF 01C2                <1> 	add edx, eax
  2020 000016B1 59                  <1> 	pop ecx
  2021 000016B2 4E                  <1> 	dec esi
  2022 000016B3 41                  <1> 	inc ecx
  2023 000016B4 EBA5                <1> 	jmp txtlp
  2024 000016B6 89D1                <1> donecnvrt: mov ecx, edx
  2025 000016B8 C3                  <1> 	ret
  2026                                      %include 'source/builtinprogs.asm'
  2027 000016B9 050406040704        <1> filetypes db 5,4,6,4,7,4
  2028                              <1> progstart:		;programs start here
  2029                              <1> ;db 5,4,"index",0
  2030                              <1> ;	call indexfiles
  2031                              <1> ;	jmp nwcmd
  2032                              <1> indexfiles:
  2033 000016BF BE[BF160000]        <1> 	mov esi, progstart
  2034 000016C4 BB[6F130000]        <1> 	mov ebx, fileindex
  2035 000016C9 BF[BF160000]        <1> 	mov edi, progstart
  2036 000016CE 81EF02000000        <1> 	sub edi, 2
  2037                              <1> indexloop:
  2038 000016D4 668B0E              <1> 	mov cx, [esi]
  2039                              <1> 	indexloop2:
  2040 000016D7 663B0F              <1> 		cmp cx, [edi]
  2041 000016DA 7424                <1> 		je indexloop2done
  2042 000016DC 81EF02000000        <1> 		sub edi, 2
  2043 000016E2 81FF[B9160000]      <1> 		cmp edi, filetypes
  2044 000016E8 73ED                <1> 		jae indexloop2
  2045 000016EA BF[BF160000]        <1> 	mov edi, progstart
  2046 000016EF 81EF02000000        <1> 	sub edi, 2
  2047 000016F5 46                  <1> 	inc esi
  2048 000016F6 81FE[C1260000]      <1> 	cmp esi, batchprogend
  2049 000016FC 734E                <1> 	jae indexloopdone
  2050 000016FE EBD4                <1> 	jmp indexloop
  2051                              <1> indexloop2done:
  2052 00001700 66890B              <1> 	mov [ebx], cx
  2053 00001703 81C302000000        <1> 	add ebx, 2
  2054 00001709 81C602000000        <1> 	add esi, 2
  2055                              <1> 	nameindex:
  2056 0000170F 8A0E                <1> 		mov cl, [esi]
  2057 00001711 80F900              <1> 		cmp cl, 0
  2058 00001714 7406                <1> 		je nameindexdone
  2059 00001716 880B                <1> 		mov [ebx], cl
  2060 00001718 46                  <1> 		inc esi
  2061 00001719 43                  <1> 		inc ebx
  2062 0000171A EBF3                <1> 		jmp nameindex
  2063                              <1> 	nameindexdone:
  2064 0000171C 43                  <1> 		inc ebx
  2065 0000171D 66C7030000          <1> 		mov word [ebx], 0
  2066 00001722 81C302000000        <1> 		add ebx, 2
  2067 00001728 46                  <1> 		inc esi
  2068 00001729 8933                <1> 		mov [ebx], esi
  2069 0000172B 81C304000000        <1> 		add ebx, 4
  2070 00001731 66C7030000          <1> 		mov word [ebx], 0
  2071 00001736 81C302000000        <1> 		add ebx, 2
  2072 0000173C 81FB[6F150000]      <1> 		cmp ebx, fileindexend
  2073 00001742 7308                <1> 		jae indexloopdone
  2074 00001744 81C601000000        <1> 		add esi, 1
  2075 0000174A EB88                <1> 		jmp indexloop
  2076 0000174C C3                  <1> indexloopdone: 	ret
  2077                              <1> 
  2078                              <1> 
  2079                              <1> ;db 5,4,"showindex",0
  2080                              <1> ;	mov esi, fileindex
  2081                              <1> ;	mov ebx, fileindexend
  2082                              <1> ;	mov cl, 5
  2083                              <1> ;	mov ch, 4
  2084                              <1> ;	call array
  2085                              <1> ;	mov esi, fileindex
  2086                              <1> ;	mov ebx, fileindexend
  2087                              <1> ;	mov cl, 6
  2088                              <1> ;	mov ch, 4
  2089                              <1> ;	call array
  2090                              <1> ;	mov esi, fileindex
  2091                              <1> ;	mov ebx, fileindexend
  2092                              <1> ;	mov cl, 7
  2093                              <1> ;	mov ch, 4
  2094                              <1> ;	call array
  2095                              <1> ;	jmp nwcmd
  2096                              <1> 
  2097 0000174D 05046C7300          <1> db 5,4,"ls",0
  2098 00001752 BE[BF160000]        <1> 	lscmd:	mov esi, progstart
  2099 00001757 BB[C1260000]        <1> 		mov ebx, progend
  2100 0000175C E9EAFAFFFF          <1> 		jmp dir
  2101                              <1> 		
  2102 00001761 05046469736B00      <1> db 5,4,"disk",0
  2103 00001768 B900000000          <1> 		mov ecx, 0
  2104 0000176D 8A0D[29000000]      <1> 		mov cl, [DriveNumber]
  2105 00001773 C605[E0140000]00    <1> 		mov byte [firsthexshown], 0
  2106 0000177A E876FDFFFF          <1> 		call showhex
  2107 0000177F BE[4D480000]        <1> 		mov esi, line
  2108 00001784 E8E9F3FFFF          <1> 		call print
  2109 00001789 BE[98470000]        <1> 		mov esi, diskfileindex
  2110                              <1> 	diskindexdir:
  2111 0000178E E8DFF3FFFF          <1> 		call print
  2112 00001793 8B4E05              <1> 		mov ecx, [esi + 5]
  2113 00001796 C605[E0140000]03    <1> 		mov byte [firsthexshown], 3
  2114 0000179D E8F8FDFFFF          <1> 		call showdec
  2115 000017A2 56                  <1> 		push esi
  2116 000017A3 BE[4D480000]        <1> 		mov esi, line
  2117 000017A8 E8C5F3FFFF          <1> 		call print
  2118 000017AD 5E                  <1> 		pop esi
  2119 000017AE 81C609000000        <1> 		add esi, 9
  2120 000017B4 81FE[0F480000]      <1> 		cmp esi, enddiskfileindex
  2121 000017BA 72D2                <1> 		jb diskindexdir
  2122 000017BC E9E4F8FFFF          <1> 		jmp nwcmd
  2123                              <1> 
  2124 000017C1 0504636C65617200    <1> db 5,4,"clear",0
  2125 000017C9 E86AF6FFFF          <1> 	cls:	call clear
  2126 000017CE E9D2F8FFFF          <1> 		jmp nwcmd
  2127                              <1> 		
  2128 000017D3 05047761697400      <1> db 5,4,"wait",0
  2129 000017DA B000                <1> 		mov al, 0
  2130 000017DC E85EF3FFFF          <1> 		call int302
  2131 000017E1 E9BFF8FFFF          <1> 		jmp nwcmd
  2132                              <1> 
  2133 000017E6 05046563686F00      <1> db 5,4,"echo",0
  2134 000017ED BE[701C0000]        <1> 	echo:	mov esi, buftxt
  2135 000017F2 81C605000000        <1> 		add esi, 5
  2136 000017F8 8A06                <1> 		mov al, [esi]
  2137 000017FA 3C24                <1> 		cmp al, '$'
  2138 000017FC 7414                <1> 		je echovr
  2139 000017FE E86FF3FFFF          <1> 		call print
  2140 00001803 BE[4D480000]        <1> 		mov esi, line
  2141 00001808 E865F3FFFF          <1> 		call print
  2142 0000180D E993F8FFFF          <1> 		jmp nwcmd
  2143 00001812 BB[6F150000]        <1> 	echovr:	mov ebx, variables
  2144 00001817 BF06000000          <1> 		mov edi, 6
  2145 0000181C E83A000000          <1> 		call nxtvrech
  2146 00001821 E957000000          <1> 		jmp prntvr2
  2147 00001826 B13D                <1> 	echvar:	mov cl, '='
  2148 00001828 43                  <1> 		inc ebx
  2149 00001829 8A03                <1> 		mov al, [ebx]
  2150 0000182B 3C00                <1> 		cmp al, 0
  2151 0000182D 742C                <1> 		je nxtvrech
  2152 0000182F 3C3D                <1> 		cmp al, '='
  2153 00001831 7420                <1> 		je nxtvrechb1
  2154 00001833 BE[701C0000]        <1> 		mov esi, buftxt
  2155 00001838 01FE                <1> 		add esi, edi
  2156 0000183A E8ECF9FFFF          <1> 		call cndtest
  2157 0000183F 3C02                <1> 		cmp al, 2
  2158 00001841 7436                <1> 		je prntvr
  2159 00001843 3C01                <1> 		cmp al, 1
  2160 00001845 7432                <1> 		je prntvr
  2161 00001847 BE[701C0000]        <1> 		mov esi, buftxt
  2162 0000184C 01FE                <1> 		add esi, edi
  2163 0000184E E908000000          <1> 		jmp nxtvrech
  2164                              <1> 	nxtvrechb1:
  2165 00001853 81EB02000000        <1> 		sub ebx, 2
  2166 00001859 EBCB                <1> 		jmp echvar
  2167 0000185B 8A03                <1> 	nxtvrech: mov al, [ebx]
  2168 0000185D 3C05                <1> 		cmp al, 5
  2169 0000185F 740F                <1> 		je nxtvrec2
  2170 00001861 43                  <1> 		inc ebx
  2171 00001862 81FB[6F1A0000]      <1> 		cmp ebx, varend
  2172 00001868 0F8337F8FFFF        <1> 		jae nwcmd
  2173 0000186E EBEB                <1> 		jmp nxtvrech
  2174 00001870 43                  <1> 	nxtvrec2: inc ebx
  2175 00001871 8A03                <1> 		mov al, [ebx]
  2176 00001873 3C04                <1> 		cmp al, 4
  2177 00001875 74AF                <1> 		je echvar
  2178 00001877 EBE2                <1> 		jmp nxtvrech
  2179 00001879 43                  <1> 	prntvr: inc ebx
  2180 0000187A 89DE                <1> 		mov esi, ebx
  2181 0000187C C3                  <1> 		ret
  2182 0000187D E8F0F2FFFF          <1> 	prntvr2: call print
  2183 00001882 BE[4D480000]        <1> 		mov esi, line
  2184 00001887 E8E6F2FFFF          <1> 		call print
  2185 0000188C E914F8FFFF          <1> 		jmp nwcmd
  2186                              <1> 		
  2187                              <1> 
  2188 00001891 05042300            <1> db 5,4,"#",0
  2189                              <1> 	num:	
  2190 00001895 E8B4FAFFFF          <1> 		call clearbuffer
  2191 0000189A C605[511B0000]00    <1> 		mov byte [decimal], 0
  2192 000018A1 C605[521B0000]00    <1> 		mov byte [decimal2], 0
  2193 000018A8 BE[701C0000]        <1> 		mov esi, buftxt
  2194 000018AD B800000000          <1> 		mov eax, 0
  2195 000018B2 B900000000          <1> 		mov ecx, 0
  2196 000018B7 BB00000000          <1> 		mov ebx, 0
  2197 000018BC 8A06                <1> 	num2:	mov al, [esi]
  2198 000018BE 3C2B                <1> 		cmp al, '+'
  2199 000018C0 741B                <1> 		je operatorfound
  2200 000018C2 3C2D                <1> 		cmp al, '-'
  2201 000018C4 7417                <1> 		je operatorfound
  2202 000018C6 3C2A                <1> 		cmp al, '*'
  2203 000018C8 7413                <1> 		je operatorfound
  2204 000018CA 3C2F                <1> 		cmp al, '/'
  2205 000018CC 740F                <1> 		je operatorfound
  2206 000018CE 3C5E                <1> 		cmp al, '^'
  2207 000018D0 740B                <1> 		je operatorfound
  2208 000018D2 46                  <1> 		inc esi
  2209 000018D3 3C00                <1> 		cmp al, 0
  2210 000018D5 0F84CAF7FFFF        <1> 		je near nwcmd
  2211 000018DB EBDF                <1> 		jmp num2
  2212 000018DD 50                  <1> 	operatorfound: push eax
  2213 000018DE B400                <1> 		mov ah, 0
  2214 000018E0 8826                <1> 		mov [esi], ah
  2215 000018E2 89F7                <1> 		mov edi, esi
  2216 000018E4 46                  <1> 		inc esi
  2217 000018E5 8A06                <1> 		mov al, [esi]
  2218 000018E7 3C24                <1> 		cmp al, '$'
  2219 000018E9 0F8481000000        <1> 		je near varnum1
  2220 000018EF 3C25                <1> 		cmp al, '%'
  2221 000018F1 0F8469000000        <1> 		je near resultnum1
  2222                              <1> 	varnum2: 
  2223 000018F7 57                  <1> 		push edi
  2224 000018F8 E8C9000000          <1> 		call checkdecimal
  2225 000018FD 5F                  <1> 		pop edi
  2226 000018FE E831FDFFFF          <1> 		call cnvrttxt
  2227                              <1> 	vrnm2:
  2228 00001903 89CB                <1> 		mov ebx, ecx
  2229 00001905 53                  <1> 		push ebx
  2230 00001906 E843FAFFFF          <1> 		call clearbuffer
  2231 0000190B BE[701C0000]        <1> 		mov esi, buftxt
  2232 00001910 89F7                <1> 		mov edi, esi
  2233 00001912 46                  <1> 		inc esi
  2234 00001913 8A06                <1> 		mov al, [esi]
  2235 00001915 3C24                <1> 		cmp al, '$'
  2236 00001917 0F8474000000        <1> 		je near varnum3
  2237 0000191D 3C25                <1> 		cmp al, '%'
  2238 0000191F 0F8443000000        <1> 		je near resultnum2
  2239                              <1> 	varnum4: 
  2240 00001925 57                  <1> 		push edi
  2241 00001926 E887000000          <1> 		call checkdecimal2
  2242 0000192B 5F                  <1> 		pop edi
  2243 0000192C E803FDFFFF          <1> 		call cnvrttxt
  2244                              <1> 	vrnm4:
  2245 00001931 5B                  <1> 		pop ebx
  2246 00001932 58                  <1> 		pop eax
  2247 00001933 3C2B                <1> 		cmp al, '+'
  2248 00001935 0F84B9000000        <1> 		je near plusnum
  2249 0000193B 3C2D                <1> 		cmp al, '-'
  2250 0000193D 0F84BD000000        <1> 		je near subnum
  2251 00001943 3C2A                <1> 		cmp al, '*'
  2252 00001945 0F84C1000000        <1> 		je near mulnum
  2253 0000194B 3C2F                <1> 		cmp al, '/'
  2254 0000194D 0F84CF000000        <1> 		je near divnum
  2255 00001953 3C5E                <1> 		cmp al, '^'
  2256 00001955 0F84ED000000        <1> 		je near expnum
  2257 0000195B E945F7FFFF          <1> 		jmp nwcmd
  2258                              <1> 	resultnum1:
  2259 00001960 8B0D[531B0000]      <1> 		mov ecx, [result]
  2260 00001966 EB9B                <1> 		jmp vrnm2
  2261                              <1> 	resultnum2:
  2262 00001968 8B0D[531B0000]      <1> 		mov ecx, [result]
  2263 0000196E EBC1                <1> 		jmp vrnm4
  2264 00001970 81EE[701C0000]      <1> 	varnum1: sub esi, buftxt
  2265 00001976 89F7                <1> 		mov edi, esi
  2266 00001978 81C6[701C0000]      <1> 		add esi, buftxt
  2267 0000197E 47                  <1> 		inc edi
  2268 0000197F BB[6F150000]        <1> 		mov ebx, variables
  2269 00001984 E8D2FEFFFF          <1> 		call nxtvrech
  2270 00001989 89F7                <1> 		mov edi, esi
  2271 0000198B 4F                  <1> 		dec edi
  2272 0000198C E966FFFFFF          <1> 		jmp varnum2
  2273 00001991 81EE[701C0000]      <1> 	varnum3: sub esi, buftxt
  2274 00001997 89F7                <1> 		mov edi, esi
  2275 00001999 81C6[701C0000]      <1> 		add esi, buftxt
  2276 0000199F 47                  <1> 		inc edi
  2277 000019A0 BB[6F150000]        <1> 		mov ebx, variables
  2278 000019A5 E8B1FEFFFF          <1> 		call nxtvrech
  2279 000019AA 89F7                <1> 		mov edi, esi
  2280 000019AC 4F                  <1> 		dec edi
  2281 000019AD E973FFFFFF          <1> 		jmp varnum4
  2282                              <1> 	checkdecimal2:
  2283 000019B2 8A25[511B0000]      <1> 		mov ah, [decimal]
  2284 000019B8 8825[521B0000]      <1> 		mov [decimal2], ah
  2285 000019BE B400                <1> 		mov ah, 0
  2286 000019C0 8825[511B0000]      <1> 		mov [decimal], ah
  2287                              <1> 	checkdecimal:
  2288 000019C6 89F7                <1> 		mov edi, esi
  2289                              <1> 	chkdec1:
  2290 000019C8 8A07                <1> 		mov al, [edi]
  2291 000019CA 3C2E                <1> 		cmp al, '.'
  2292 000019CC 0F840B000000        <1> 		je near fnddec
  2293 000019D2 3C00                <1> 		cmp al, 0
  2294 000019D4 0F8419000000        <1> 		je near nodecimal
  2295 000019DA 47                  <1> 		inc edi
  2296 000019DB EBEB                <1> 		jmp chkdec1
  2297                              <1> 	fnddec:
  2298 000019DD 8A4701              <1> 		mov al, [edi + 1]
  2299 000019E0 8807                <1> 		mov [edi], al
  2300 000019E2 3C00                <1> 		cmp al, 0
  2301 000019E4 0F8409000000        <1> 		je near nodecimal
  2302 000019EA FE05[511B0000]      <1> 		inc byte [decimal]
  2303 000019F0 47                  <1> 		inc edi
  2304 000019F1 EBEA                <1> 		jmp fnddec
  2305                              <1> 	nodecimal:
  2306 000019F3 C3                  <1> 		ret
  2307                              <1> 	plusnum:
  2308 000019F4 E816010000          <1> 		call decaddfix
  2309 000019F9 01D9                <1> 		add ecx, ebx
  2310 000019FB E991000000          <1> 		jmp retnum
  2311                              <1> 	subnum:
  2312 00001A00 E80A010000          <1> 		call decaddfix
  2313 00001A05 29D9                <1> 		sub ecx, ebx
  2314 00001A07 E985000000          <1> 		jmp retnum
  2315                              <1> 	mulnum:
  2316 00001A0C A0[521B0000]        <1> 		mov al, [decimal2]
  2317 00001A11 0005[511B0000]      <1> 		add [decimal], al
  2318 00001A17 89C8                <1> 		mov eax, ecx
  2319 00001A19 F7E3                <1> 		mul ebx
  2320 00001A1B 89C1                <1> 		mov ecx, eax
  2321 00001A1D E96F000000          <1> 		jmp retnum
  2322                              <1> 	divnum:
  2323 00001A22 E8E8000000          <1> 		call decaddfix
  2324 00001A27 B000                <1> 		mov al, 0
  2325 00001A29 A2[511B0000]        <1> 		mov [decimal], al
  2326 00001A2E 6689C8              <1> 		mov ax, cx
  2327 00001A31 80FB00              <1> 		cmp bl, 0
  2328 00001A34 0F8457000000        <1> 		je near retnum
  2329 00001A3A F6F3                <1> 		div bl
  2330 00001A3C B900000000          <1> 		mov ecx, 0
  2331 00001A41 88C1                <1> 		mov cl, al
  2332 00001A43 E949000000          <1> 		jmp retnum
  2333                              <1> 	expnum:
  2334 00001A48 8A15[511B0000]      <1> 		mov dl, [decimal]
  2335 00001A4E 8815[521B0000]      <1> 		mov [decimal2], dl
  2336 00001A54 BA00000000          <1> 		mov edx, 0
  2337 00001A59 89C8                <1> 		mov eax, ecx
  2338 00001A5B 89D9                <1> 		mov ecx, ebx
  2339 00001A5D 89C3                <1> 		mov ebx, eax
  2340 00001A5F 81F900000000        <1> 		cmp ecx, 0
  2341 00001A65 7425                <1> 		je noexpnum
  2342 00001A67 49                  <1> 		dec ecx
  2343 00001A68 81F900000000        <1> 		cmp ecx, 0
  2344 00001A6E 7415                <1> 		je noexpnumlp
  2345 00001A70 F7E3                <1> 	expnumlp: mul ebx
  2346 00001A72 8A15[521B0000]      <1> 		mov dl, [decimal2]
  2347 00001A78 0015[511B0000]      <1> 		add [decimal], dl
  2348 00001A7E BA00000000          <1> 		mov edx, 0
  2349 00001A83 E2EB                <1> 		loop expnumlp
  2350                              <1> 	noexpnumlp:
  2351 00001A85 89C1                <1> 		mov ecx, eax
  2352 00001A87 E905000000          <1> 		jmp retnum
  2353                              <1> 	noexpnum:
  2354 00001A8C B901000000          <1> 		mov ecx, 1
  2355                              <1> 	retnum: 
  2356 00001A91 BE[841E0000]        <1> 		mov esi, numbuf
  2357 00001A96 890D[531B0000]      <1> 		mov [result], ecx
  2358 00001A9C E8C2F8FFFF          <1> 		call convert
  2359 00001AA1 BE[841E0000]        <1> 		mov esi, numbuf
  2360 00001AA6 8A25[511B0000]      <1> 		mov ah, [decimal]
  2361 00001AAC 80FC00              <1> 		cmp ah, 0
  2362 00001AAF 0F8425000000        <1> 		je near noputdecimal
  2363                              <1> 	putdecimal:
  2364 00001AB5 4E                  <1> 		dec esi
  2365 00001AB6 FECC                <1> 		dec ah
  2366 00001AB8 80FC00              <1> 		cmp ah, 0
  2367 00001ABB 0F87F4FFFFFF        <1> 		ja near putdecimal
  2368 00001AC1 4E                  <1> 		dec esi
  2369 00001AC2 8A06                <1> 		mov al, [esi]
  2370 00001AC4 C6062E              <1> 		mov byte [esi], '.'
  2371                              <1> 	decputloop:
  2372 00001AC7 4E                  <1> 		dec esi
  2373 00001AC8 8A26                <1> 		mov ah, [esi]
  2374 00001ACA 8806                <1> 		mov [esi], al
  2375 00001ACC 88E0                <1> 		mov al, ah
  2376 00001ACE 81FE[701E0000]      <1> 		cmp esi, buf2
  2377 00001AD4 0F87EDFFFFFF        <1> 		ja near decputloop
  2378                              <1> 	noputdecimal:
  2379 00001ADA BE[701E0000]        <1> 		mov esi, buf2
  2380 00001ADF E809000000          <1> 		call chkadd
  2381 00001AE4 E9BCF5FFFF          <1> 		jmp nwcmd
  2382 00001AE9 00000000            <1> edxnumbuf dw 0,0
  2383 00001AED 8A06                <1> 	chkadd: mov al, [esi]
  2384 00001AEF 3C30                <1> 		cmp al, '0'
  2385 00001AF1 750C                <1> 		jne dnadd
  2386 00001AF3 46                  <1> 		inc esi
  2387 00001AF4 81FE[841E0000]      <1> 		cmp esi, numbuf
  2388 00001AFA 7402                <1> 		je dnaddm1
  2389 00001AFC EBEF                <1> 		jmp chkadd
  2390 00001AFE 4E                  <1> 	dnaddm1: dec esi
  2391 00001AFF E86EF0FFFF          <1> 	dnadd:	call print
  2392 00001B04 BE[4D480000]        <1> 		mov esi, line
  2393 00001B09 E864F0FFFF          <1> 		call print
  2394 00001B0E C3                  <1> 		ret
  2395                              <1> 		
  2396                              <1> 	decaddfix:
  2397 00001B0F A0[521B0000]        <1> 		mov al, [decimal2]
  2398 00001B14 8A25[511B0000]      <1> 		mov ah, [decimal]
  2399 00001B1A 38E0                <1> 		cmp al, ah
  2400 00001B1C 7432                <1> 		je gooddecadd
  2401 00001B1E 38E0                <1> 		cmp al, ah
  2402 00001B20 721A                <1> 		jb lowdecadd
  2403                              <1> 	highdecadd:
  2404 00001B22 FEC4                <1> 		inc ah
  2405 00001B24 89CA                <1> 		mov edx, ecx
  2406 00001B26 C1E103              <1> 		shl ecx, 3
  2407 00001B29 01D1                <1> 		add ecx, edx
  2408 00001B2B 01D1                <1> 		add ecx, edx
  2409 00001B2D 38E0                <1> 		cmp al, ah
  2410 00001B2F 77F1                <1> 		ja highdecadd
  2411 00001B31 8825[511B0000]      <1> 		mov [decimal], ah
  2412 00001B37 E914000000          <1> 		jmp gooddecadd
  2413                              <1> 	lowdecadd:
  2414 00001B3C FEC0                <1> 		inc al
  2415 00001B3E 89DA                <1> 		mov edx, ebx
  2416 00001B40 C1E303              <1> 		shl ebx, 3
  2417 00001B43 01D3                <1> 		add ebx, edx
  2418 00001B45 01D3                <1> 		add ebx, edx
  2419 00001B47 38E0                <1> 		cmp al, ah
  2420 00001B49 72F1                <1> 		jb lowdecadd
  2421 00001B4B A2[511B0000]        <1> 		mov [decimal], al
  2422                              <1> 	gooddecadd:
  2423 00001B50 C3                  <1> 		ret
  2424                              <1> 		
  2425 00001B51 00                  <1> decimal db 0
  2426 00001B52 00                  <1> decimal2 db 0
  2427 00001B53 00000000            <1> result db 0,0,0,0
  2428                              <1> 	
  2429 00001B57 05042500            <1> db 5,4,"%",0
  2430 00001B5B E8EEF7FFFF          <1> 	ans:	call clearbuffer
  2431 00001B60 8B0D[531B0000]      <1> 		mov ecx, [result]
  2432 00001B66 BE[701E0000]        <1> 		mov esi, buf2
  2433 00001B6B E8F3F7FFFF          <1> 		call convert
  2434 00001B70 BE[701E0000]        <1> 		mov esi, buf2
  2435 00001B75 E873FFFFFF          <1> 		call chkadd
  2436 00001B7A E926F5FFFF          <1> 		jmp nwcmd
  2437                              <1> 
  2438 00001B7F 05042400            <1> db 5,4,"$",0
  2439 00001B83 BE[701C0000]        <1> var:	mov esi, buftxt
  2440 00001B88 BB[6F150000]        <1> 	mov ebx, variables
  2441 00001B8D 8A06                <1> lkeq:	mov al, [esi]
  2442 00001B8F 3C3D                <1> 	cmp al, '='
  2443 00001B91 741F                <1> 	je eqfnd	;is there an '=' sign?
  2444 00001B93 3C00                <1> 	cmp al, 0
  2445 00001B95 7403                <1> 	je echovars
  2446 00001B97 46                  <1> 	inc esi
  2447 00001B98 EBF3                <1> 	jmp lkeq
  2448 00001B9A BE[6F150000]        <1> echovars: mov esi, variables
  2449 00001B9F BB[6F1A0000]        <1> 	mov ebx, varend
  2450 00001BA4 B105                <1> 	mov cl, 5
  2451 00001BA6 B504                <1> 	mov ch, 4
  2452 00001BA8 E840F7FFFF          <1> 	call array
  2453 00001BAD E9F3F4FFFF          <1> 	jmp nwcmd
  2454 00001BB2 46                  <1> eqfnd:	inc esi
  2455 00001BB3 8A06                <1> 	mov al, [esi]
  2456 00001BB5 3C00                <1> 	cmp al, 0
  2457 00001BB7 740F                <1> 	je readvar
  2458 00001BB9 BE[701C0000]        <1> 	mov esi, buftxt
  2459 00001BBE BB[6F150000]        <1> 	mov ebx, variables
  2460 00001BC3 E917000000          <1> 	jmp seek
  2461                              <1> readvar: 
  2462 00001BC8 B00D                <1> 	mov al, 13
  2463 00001BCA B404                <1> 	mov ah, 4
  2464 00001BCC B307                <1> 	mov bl, 7
  2465 00001BCE E893EDFFFF          <1> 	call intx4
  2466 00001BD3 BE[4D480000]        <1> 	mov esi, line
  2467 00001BD8 E895EFFFFF          <1> 	call print
  2468 00001BDD EBA4                <1> 	jmp var
  2469 00001BDF 668B03              <1> seek:	mov ax, [ebx]
  2470 00001BE2 B105                <1> 	mov cl, 5
  2471 00001BE4 B504                <1> 	mov ch, 4
  2472 00001BE6 663D0000            <1> 	cmp ax, 0
  2473 00001BEA 0F8459000000        <1> 	je near save
  2474 00001BF0 6639C8              <1> 	cmp ax, cx
  2475 00001BF3 7403                <1> 	je skfnd
  2476 00001BF5 43                  <1> 	inc ebx
  2477 00001BF6 EBE7                <1> 	jmp seek
  2478 00001BF8 BE[701C0000]        <1> skfnd:	mov esi, buftxt
  2479 00001BFD 46                  <1> 	inc esi
  2480 00001BFE 81C302000000        <1> 	add ebx, 2
  2481 00001C04 89DF                <1> 	mov edi, ebx
  2482 00001C06 B13D                <1> 	mov cl, '='
  2483 00001C08 E81EF6FFFF          <1> 	call cndtest
  2484 00001C0D 3C01                <1> 	cmp al, 1	
  2485 00001C0F 7417                <1> 	je varfnd
  2486 00001C11 89FB                <1> 	mov ebx, edi
  2487 00001C13 BE[701C0000]        <1> 	mov esi, buftxt
  2488 00001C18 668B03              <1> 	mov ax, [ebx]
  2489 00001C1B 663D0000            <1> 	cmp ax, 0
  2490 00001C1F 0F8424000000        <1> 	je near save
  2491 00001C25 43                  <1> 	inc ebx
  2492 00001C26 EBB7                <1> 	jmp seek
  2493 00001C28 8A03                <1> varfnd:	mov al, [ebx]
  2494 00001C2A 3C04                <1> 	cmp al, 4
  2495 00001C2C 7404                <1> 	je save2
  2496 00001C2E 4B                  <1> 	dec ebx
  2497 00001C2F 4E                  <1> 	dec esi
  2498 00001C30 EBF6                <1> 	jmp varfnd
  2499 00001C32 4B                  <1> save2:	dec ebx
  2500 00001C33 4E                  <1> 	dec esi
  2501 00001C34 8A03                <1> 	mov al, [ebx]
  2502 00001C36 3C05                <1> 	cmp al, 5
  2503 00001C38 7402                <1> 	je remove
  2504 00001C3A EBEC                <1> 	jmp varfnd
  2505 00001C3C 8A03                <1> remove: mov al, [ebx]
  2506 00001C3E 3C00                <1> 	cmp al, 0
  2507 00001C40 749D                <1> 	je seek
  2508 00001C42 B000                <1> 	mov al, 0
  2509 00001C44 8803                <1> 	mov [ebx], al
  2510 00001C46 43                  <1> 	inc ebx
  2511 00001C47 EBF3                <1> 	jmp remove	;do not need for now-need defragmentation
  2512 00001C49 BE[701C0000]        <1> save:	mov esi, buftxt
  2513 00001C4E 43                  <1> 	inc ebx
  2514 00001C4F B005                <1> 	mov al, 5
  2515 00001C51 B404                <1> 	mov ah, 4
  2516 00001C53 668903              <1> 	mov [ebx], ax
  2517 00001C56 43                  <1> 	inc ebx
  2518 00001C57 43                  <1> svhere:	inc ebx
  2519 00001C58 46                  <1> 	inc esi
  2520 00001C59 8A06                <1> 	mov al, [esi]
  2521 00001C5B 3C00                <1> 	cmp al, 0
  2522 00001C5D 0F8442000000        <1> 	je near svdone
  2523 00001C63 3C25                <1> 	cmp al, '%'
  2524 00001C65 7404                <1> 	je ans2
  2525 00001C67 8803                <1> 	mov [ebx], al	
  2526 00001C69 EBEC                <1> 	jmp svhere
  2527 00001C6B 56                  <1> ans2:	push esi
  2528 00001C6C BE[701E0000]        <1> 	mov esi, buf2
  2529 00001C71 E823000000          <1> 	call ansfnd
  2530 00001C76 E803000000          <1> 	call anscp
  2531 00001C7B 5E                  <1> 	pop esi
  2532 00001C7C EBD9                <1> 	jmp svhere
  2533 00001C7E 8A06                <1> anscp:	mov al, [esi]
  2534 00001C80 8803                <1> 	mov [ebx], al
  2535 00001C82 81FE[841E0000]      <1> 	cmp esi, numbuf
  2536 00001C88 74CD                <1> 	je svhere
  2537 00001C8A 3C00                <1> 	cmp al, 0
  2538 00001C8C 74C9                <1> 	je svhere
  2539 00001C8E 43                  <1> 	inc ebx
  2540 00001C8F 46                  <1> 	inc esi
  2541 00001C90 EBEC                <1> 	jmp anscp
  2542 00001C92 5E                  <1> ansnf:	pop esi
  2543 00001C93 8A06                <1> 	mov al, [esi]
  2544 00001C95 8803                <1> 	mov [ebx], al
  2545 00001C97 EBBE                <1> 	jmp svhere
  2546 00001C99 46                  <1> ansfnd:	inc esi
  2547 00001C9A 8A06                <1> 	mov al, [esi]
  2548 00001C9C 3C00                <1> 	cmp al, 0
  2549 00001C9E 74F2                <1> 	je ansnf
  2550 00001CA0 3C30                <1> 	cmp al, '0'
  2551 00001CA2 74F5                <1> 	je ansfnd
  2552 00001CA4 C3                  <1> 	ret
  2553 00001CA5 B000                <1> svdone:	mov al, 0
  2554 00001CA7 8803                <1> 	mov [ebx], al
  2555 00001CA9 E9F7F3FFFF          <1> 	jmp nwcmd
  2556                              <1> 	
  2557 00001CAE 05046C6F676F757400  <1> 	db 5,4,"logout",0
  2558                              <1> logout:
  2559 00001CB7 E9CFF2FFFF          <1> 	jmp os
  2560                              <1> 	
  2561 00001CBC 05047265626F6F7400  <1> 	db 5,4,"reboot",0
  2562                              <1> rebootcomp:
  2563 00001CC5 E958E5FFFF          <1> 	jmp coldboot
  2564                              <1> 
  2565 00001CCA 050473687574646F77- <1> 	db 5,4,"shutdown",0
  2566 00001CD3 6E00                <1>
  2567                              <1> shutdowncomp:
  2568 00001CD5 E91EE5FFFF          <1> 	jmp shutdown
  2569                              <1> 	
  2570                              <1> 	
  2571 00001CDA 05042E2F00          <1> 	db 5,4,"./",0
  2572                              <1> rundiskprog:
  2573 00001CDF BF[701C0000]        <1> 	mov edi, buftxt
  2574 00001CE4 81C702000000        <1> 	add edi, 2
  2575 00001CEA BE00001000          <1> 	mov esi, 0x100000
  2576 00001CEF E8EE280000          <1> 	call loadfile
  2577 00001CF4 81FA94010000        <1> 	cmp edx, 404
  2578 00001CFA 7414                <1> 	je noprogfound
  2579 00001CFC BB00001000          <1> 	mov ebx, 0x100000
  2580 00001D01 66813B4558          <1> 	cmp word [ebx], "EX"
  2581 00001D06 7531                <1> 	jne progbatchfound
  2582 00001D08 81C302000000        <1> 	add ebx, 2
  2583 00001D0E FFE3                <1> 	jmp ebx
  2584                              <1> noprogfound:
  2585 00001D10 BE[14480000]        <1> 	mov esi, notfound1
  2586 00001D15 E858EEFFFF          <1> 	call print
  2587 00001D1A BE[701C0000]        <1> 	mov esi, buftxt
  2588 00001D1F 81C602000000        <1> 	add esi, 2
  2589 00001D25 E848EEFFFF          <1> 	call print
  2590 00001D2A BE[1E480000]        <1> 	mov esi, notfound2
  2591 00001D2F E83EEEFFFF          <1> 	call print
  2592 00001D34 E96CF3FFFF          <1> 	jmp nwcmd
  2593                              <1> progbatchfound:
  2594 00001D39 BF00001000          <1> 		mov edi, 0x100000
  2595 00001D3E C605[69130000]01    <1> 		mov byte [BATCHISON], 1
  2596                              <1> 	batchrunloop:
  2597 00001D45 E838F3FFFF          <1> 		call buftxtclear
  2598 00001D4A BE[701C0000]        <1> 		mov esi, buftxt
  2599                              <1> 	batchrunloop2:
  2600 00001D4F B10D                <1> 		mov cl, 13
  2601 00001D51 B50A                <1> 		mov ch, 10
  2602 00001D53 66390F              <1> 		cmp [edi], cx
  2603 00001D56 0F841E000000        <1> 		je near nxtbatchrunline
  2604 00001D5C 66C1C108            <1> 		rol cx, 8
  2605 00001D60 66390F              <1> 		cmp [edi], cx
  2606 00001D63 0F8411000000        <1> 		je near nxtbatchrunline
  2607 00001D69 803F00              <1> 		cmp byte [edi], 0
  2608 00001D6C 0F8408000000        <1> 		je near nxtbatchrunline
  2609 00001D72 8A07                <1> 		mov al, [edi]
  2610 00001D74 8806                <1> 		mov [esi], al
  2611 00001D76 46                  <1> 		inc esi
  2612 00001D77 47                  <1> 		inc edi
  2613 00001D78 EBD5                <1> 		jmp batchrunloop2
  2614                              <1> 	nxtbatchrunline:
  2615 00001D7A 81C702000000        <1> 		add edi, 2
  2616 00001D80 893D[DF1D0000]      <1> 		mov [batchedi], edi
  2617 00001D86 C60600              <1> 		mov byte [esi], 0
  2618 00001D89 BE[701C0000]        <1> 		mov esi, buftxt
  2619 00001D8E 803E00              <1> 		cmp byte [esi], 0
  2620 00001D91 0F843C000000        <1> 		je near nobatchfoundrun
  2621 00001D97 BB00000000          <1> 		mov ebx, 0
  2622 00001D9C 8A1D[00130000]      <1> 		mov bl, [IFON]
  2623 00001DA2 80FB01              <1> 		cmp bl, 1
  2624 00001DA5 0F8338000000        <1> 		jae near iftestbatch
  2625                              <1> 	doneiftest:
  2626 00001DAB 803D[A61E0000]00    <1> 		cmp byte [runnextline], 0
  2627 00001DB2 0F8405000000        <1> 		je near noruniftest
  2628 00001DB8 E8B9F3FFFF          <1> 		call progtest
  2629                              <1> 	noruniftest:
  2630 00001DBD C605[A61E0000]01    <1> 		mov byte [runnextline], 1
  2631 00001DC4 8B3D[DF1D0000]      <1> 		mov edi, [batchedi]
  2632 00001DCA 803F00              <1> 		cmp byte [edi], 0
  2633 00001DCD 0F8572FFFFFF        <1> 		jne near batchrunloop
  2634                              <1> 	nobatchfoundrun:
  2635 00001DD3 C605[69130000]00    <1> 		mov byte [BATCHISON], 0
  2636 00001DDA E9C6F2FFFF          <1> 		jmp nwcmd
  2637                              <1> 	
  2638 00001DDF 00000000            <1> batchedi dd 0	
  2639                              <1> 	
  2640                              <1> 	iftestbatch:
  2641 00001DE3 BE[01130000]        <1> 		mov esi, IFTRUE
  2642 00001DE8 01DE                <1> 		add esi, ebx
  2643 00001DEA 803E00              <1> 		cmp byte [esi], 0
  2644 00001DED 0F85B8FFFFFF        <1> 		jne near doneiftest
  2645 00001DF3 881D[A71E0000]      <1> 		mov [iffalsebuf], bl
  2646 00001DF9 803D[6A130000]01    <1> 		cmp byte [LOOPON], 1
  2647 00001E00 750B                <1> 		jne fifindbatch
  2648 00001E02 8B3D[6B130000]      <1> 		mov edi, [LOOPPOS]
  2649 00001E08 E938FFFFFF          <1> 		jmp batchrunloop
  2650                              <1> 	fifindbatch:
  2651 00001E0D 66B96966            <1> 		mov cx, "if"
  2652 00001E11 66B86669            <1> 		mov ax, "fi"
  2653 00001E15 663907              <1> 		cmp [edi], ax
  2654 00001E18 0F841A000000        <1> 		je near fifoundbatch
  2655 00001E1E 66390F              <1> 		cmp [edi], cx
  2656 00001E21 0F8462000000        <1> 		je near iffoundbatch
  2657 00001E27 803F00              <1> 		cmp byte [edi], 0
  2658 00001E2A 0F8408000000        <1> 		je near fifoundbatch
  2659 00001E30 81C702000000        <1> 		add edi, 2
  2660 00001E36 EBD5                <1> 		jmp fifindbatch
  2661                              <1> 	fifoundbatch:
  2662 00001E38 81C702000000        <1> 		add edi, 2
  2663 00001E3E B00D                <1> 		mov al, 13
  2664 00001E40 B40A                <1> 		mov ah, 10
  2665 00001E42 663907              <1> 		cmp [edi], ax
  2666 00001E45 7414                <1> 		je goodfibatch
  2667 00001E47 66C1C008            <1> 		rol ax, 8
  2668 00001E4B 663907              <1> 		cmp [edi], ax
  2669 00001E4E 740B                <1> 		je goodfibatch
  2670 00001E50 803F00              <1> 		cmp byte [edi], 0
  2671 00001E53 0F847AFFFFFF        <1> 		je near nobatchfoundrun
  2672 00001E59 EBB2                <1> 		jmp fifindbatch
  2673                              <1> 	goodfibatch:
  2674 00001E5B B001                <1> 		mov al, 1
  2675 00001E5D 2805[00130000]      <1> 		sub [IFON], al 
  2676 00001E63 A0[00130000]        <1> 		mov al, [IFON]
  2677 00001E68 8A1D[A71E0000]      <1> 		mov bl, [iffalsebuf]
  2678 00001E6E 38D8                <1> 		cmp al, bl
  2679 00001E70 779B                <1> 		ja fifindbatch
  2680 00001E72 BE[701C0000]        <1> 		mov esi, buftxt
  2681 00001E77 81EF02000000        <1> 		sub edi, 2
  2682 00001E7D C605[A61E0000]00    <1> 		mov byte [runnextline], 0
  2683 00001E84 E9BCFEFFFF          <1> 		jmp batchrunloop
  2684                              <1> 	iffoundbatch:
  2685 00001E89 B020                <1> 		mov al, ' '
  2686 00001E8B 81C702000000        <1> 		add edi, 2
  2687 00001E91 3807                <1> 		cmp [edi], al
  2688 00001E93 0F8574FFFFFF        <1> 		jne near fifindbatch
  2689 00001E99 B001                <1> 		mov al, 1
  2690 00001E9B 0005[00130000]      <1> 		add [IFON], al
  2691 00001EA1 E967FFFFFF          <1> 		jmp fifindbatch
  2692                              <1> 		
  2693                              <1> 		
  2694 00001EA6 01                  <1> runnextline db 1
  2695 00001EA7 00                  <1> iffalsebuf db 0
  2696                              <1> 
  2697 00001EA8 E9F8F1FFFF          <1> notbatch: jmp nwcmd
  2698                              <1> 
  2699 00001EAD 05047768696C6500    <1> 	db 5,4,"while",0
  2700 00001EB5 B000                <1> while:  mov al, 0
  2701 00001EB7 3805[69130000]      <1> 	cmp [BATCHISON], al
  2702 00001EBD 0F84E5FFFFFF        <1> 	je near notbatch
  2703 00001EC3 8B35[65130000]      <1> 	MOV esi, [BATCHPOS]
  2704 00001EC9 4E                  <1> whilefnd: dec esi
  2705 00001ECA 8A06                <1> 	mov al, [esi]
  2706 00001ECC 3C0A                <1> 	cmp al, 10
  2707 00001ECE 0F8412000000        <1> 	je near whilefnd2
  2708 00001ED4 3C0D                <1> 	cmp al, 13
  2709 00001ED6 0F840A000000        <1> 	je near whilefnd2
  2710 00001EDC 3C00                <1> 	cmp al, 0
  2711 00001EDE 0F8402000000        <1> 	je near whilefnd2
  2712 00001EE4 EBE3                <1> 	jmp whilefnd
  2713                              <1> whilefnd2:
  2714 00001EE6 8935[6B130000]      <1> 	mov [LOOPPOS], esi
  2715 00001EEC C605[6A130000]01    <1> 	mov BYTE [LOOPON], 1
  2716 00001EF3 0005[00130000]      <1> 	add [IFON], al
  2717 00001EF9 BE[701C0000]        <1> 	mov esi, buftxt
  2718 00001EFE BB[701C0000]        <1> 	mov ebx, buftxt
  2719 00001F03 81C306000000        <1> 	add ebx, 6
  2720 00001F09 E923000000          <1> 	jmp chkeqsn
  2721                              <1> 
  2722                              <1> 
  2723 00001F0E 0504696600          <1> 	db 5,4,"if",0
  2724 00001F13 B000                <1> if:	mov al, 0
  2725 00001F15 3805[69130000]      <1> 	cmp [BATCHISON], al
  2726 00001F1B 0F8487FFFFFF        <1> 	je near notbatch
  2727 00001F21 BE[701C0000]        <1> 	mov esi, buftxt
  2728 00001F26 BB[701C0000]        <1> 	mov ebx, buftxt
  2729 00001F2B 81C303000000        <1> 	add ebx, 3
  2730 00001F31 8A06                <1> chkeqsn: mov al, [esi]
  2731 00001F33 3C00                <1> 	cmp al, 0
  2732 00001F35 0F846DFFFFFF        <1> 	je near notbatch
  2733 00001F3B 3C3D                <1> 	cmp al, '='
  2734 00001F3D 0F8403000000        <1> 	je near chkeqdn
  2735 00001F43 46                  <1> 	inc esi
  2736 00001F44 EBEB                <1> 	jmp chkeqsn
  2737 00001F46 B000                <1> chkeqdn: mov al, 0 
  2738 00001F48 8806                <1> 	mov [esi], al
  2739 00001F4A 46                  <1> 	inc esi
  2740 00001F4B 8A06                <1> 	mov al, [esi]
  2741 00001F4D 3C24                <1> 	cmp al, '$'
  2742 00001F4F 0F8462000000        <1> 	je near ifvar1
  2743 00001F55 8A03                <1> ifvar2: mov al, [ebx]
  2744 00001F57 3C24                <1> 	cmp al, '$'
  2745 00001F59 0F847B000000        <1> 	je near ifvar3
  2746 00001F5F E88DF2FFFF          <1> ifvar4:	call tester
  2747 00001F64 3C01                <1> 	cmp al, 1
  2748 00001F66 0F8405000000        <1> 	je near trueif
  2749 00001F6C E923000000          <1> 	jmp falseif
  2750 00001F71 B800000000          <1> trueif:	mov eax, 0
  2751 00001F76 A0[00130000]        <1> 	mov al, [IFON]
  2752 00001F7B FEC0                <1> 	inc al
  2753 00001F7D A2[00130000]        <1> 	mov [IFON], al
  2754 00001F82 B400                <1> 	mov ah, 0
  2755 00001F84 BE[01130000]        <1> 	mov esi, IFTRUE
  2756 00001F89 01C6                <1> 	add esi, eax
  2757 00001F8B B401                <1> 	mov ah, 1
  2758 00001F8D 8826                <1> 	mov [esi], ah
  2759 00001F8F E911F1FFFF          <1> 	jmp nwcmd
  2760 00001F94 B800000000          <1> falseif: mov eax, 0
  2761 00001F99 A0[00130000]        <1> 	mov al, [IFON]
  2762 00001F9E FEC0                <1> 	inc al
  2763 00001FA0 A2[00130000]        <1> 	mov [IFON], al
  2764 00001FA5 B400                <1> 	mov ah, 0
  2765 00001FA7 BE[01130000]        <1> 	mov esi, IFTRUE
  2766 00001FAC 01C6                <1> 	add esi, eax
  2767 00001FAE B400                <1> 	mov ah, 0
  2768 00001FB0 8826                <1> 	mov [esi], ah
  2769 00001FB2 E9EEF0FFFF          <1> 	jmp nwcmd
  2770 00001FB7 89F7                <1> ifvar1: mov edi, esi
  2771 00001FB9 81EF[701C0000]      <1> 	sub edi, buftxt
  2772 00001FBF 47                  <1> 	inc edi
  2773 00001FC0 BB[6F150000]        <1> 	mov ebx, variables
  2774 00001FC5 E891F8FFFF          <1> 	call nxtvrech
  2775 00001FCA BB[701C0000]        <1> 	mov ebx, buftxt
  2776 00001FCF 81C303000000        <1> 	add ebx, 3
  2777 00001FD5 E97BFFFFFF          <1> 	jmp ifvar2
  2778 00001FDA 8935[FA1F0000]      <1> ifvar3: mov [esiif], esi
  2779 00001FE0 BF04000000          <1> 	mov edi, 4
  2780 00001FE5 BB[6F150000]        <1> 	mov ebx, variables
  2781 00001FEA E86CF8FFFF          <1> 	call nxtvrech
  2782 00001FEF 8B35[FA1F0000]      <1> 	mov esi, [esiif]
  2783 00001FF5 E965FFFFFF          <1> 	jmp ifvar4
  2784                              <1> 
  2785 00001FFA 00000000            <1> esiif dd 0
  2786                              <1> 	
  2787 00001FFE 0504656C736500      <1> 	db 5,4,"else",0
  2788 00002005 B800000000          <1> else:	mov eax, 0
  2789 0000200A A0[00130000]        <1> 	mov al, [IFON]
  2790 0000200F BE[01130000]        <1> 	mov esi, IFTRUE
  2791 00002014 01C6                <1> 	add esi, eax
  2792 00002016 8A06                <1> 	mov al, [esi]
  2793 00002018 3C00                <1> 	cmp al, 0		
  2794 0000201A 7409                <1> 	je else1
  2795 0000201C 3C01                <1> 	cmp al, 1
  2796 0000201E 740E                <1> 	je else2
  2797 00002020 E980F0FFFF          <1> 	jmp nwcmd
  2798 00002025 B001                <1> else1:  mov al, 1
  2799 00002027 8806                <1> 	mov [esi], al
  2800 00002029 E977F0FFFF          <1> 	jmp nwcmd
  2801 0000202E B000                <1> else2:	mov al, 0
  2802 00002030 8806                <1> 	mov [esi], al
  2803 00002032 E96EF0FFFF          <1> 	jmp nwcmd
  2804                              <1> 
  2805 00002037 05046C6F6F7000      <1> 	db 5,4,"loop",0
  2806 0000203E 3805[6A130000]      <1> 	cmp [LOOPON], al
  2807 00002044 0F8405000000        <1> 	je near filoop
  2808 0000204A E956F0FFFF          <1> 	jmp nwcmd
  2809 0000204F 8B35[6B130000]      <1> filoop: mov esi, [LOOPPOS]
  2810 00002055 8935[65130000]      <1> 	mov [BATCHPOS], esi
  2811 0000205B E945F0FFFF          <1> 	jmp nwcmd
  2812                              <1> 	
  2813                              <1> 
  2814 00002060 0504666900          <1> 	db 5,4,"fi",0
  2815 00002065 B000                <1> 	mov al, 0
  2816 00002067 3805[69130000]      <1> 	cmp [BATCHISON], al
  2817 0000206D 0F8435FEFFFF        <1> 	je near notbatch
  2818 00002073 B001                <1> fi:	mov al, 1
  2819 00002075 2805[00130000]      <1> 	sub [IFON],al
  2820 0000207B E925F0FFFF          <1> 	jmp nwcmd
  2821                              <1> 
  2822 00002080 050473746F7000      <1> 	db 5,4,"stop",0
  2823 00002087 B000                <1> stop:	mov al, 0
  2824 00002089 A2[69130000]        <1> 	mov [BATCHISON], al
  2825 0000208E A2[00130000]        <1> 	mov [IFON], al
  2826 00002093 A2[01130000]        <1> 	mov [IFTRUE], al
  2827 00002098 A2[6A130000]        <1> 	mov [LOOPON], al
  2828 0000209D E903F0FFFF          <1> 	jmp nwcmd
  2829                                      %include 'source/programs.asm'
  2830                              <1> ;db 5,4,"internet",0
  2831                              <1> 	internettest: 			;;initialize network card, lets hope this is right
  2832                              <1> 							;;^^used to^^, now tests int 30h functions		
  2833 000020A2 B403                <1> 		mov ah, 3
  2834 000020A4 CD30                <1> 		int 30h
  2835 000020A6 B401                <1> 		mov ah, 1
  2836                              <1> 		;mov esi, datmsg
  2837 000020A8 66BB0700            <1> 		mov bx, 7
  2838 000020AC B000                <1> 		mov al, 0
  2839 000020AE CD30                <1> 		int 30h
  2840                              <1> 	    ;jmp packettest
  2841 000020B0 E9F0EFFFFF          <1> 		jmp nwcmd
  2842                              <1> ;datmsg: db "Internet has not been implemented yet.",10,13,0
  2843 000020B5 05046B6579636F6465- <1> db 5,4,"keycode",0
  2844 000020BE 00                  <1>
  2845                              <1> keycode:
  2846 000020BF E87B060000          <1> 	call guistartin
  2847 000020C4 B800000000          <1> 	mov eax, 0
  2848 000020C9 66A1[3C0B0000]      <1> 	mov ax, [lastkey]
  2849 000020CF 80FC01              <1> 	cmp ah, 1
  2850 000020D2 0F840E000000        <1> 	je near killkeycode
  2851 000020D8 B900000000          <1> 	mov ecx, 0
  2852 000020DD 88E1                <1> 	mov cl, ah
  2853 000020DF E8FDF3FFFF          <1> 	call showhexsmall
  2854 000020E4 EBD9                <1> 	jmp keycode
  2855                              <1> killkeycode:
  2856 000020E6 BE[4D480000]        <1> 	mov esi, line
  2857 000020EB E882EAFFFF          <1> 	call print
  2858 000020F0 E9B0EFFFFF          <1> 	jmp nwcmd
  2859                              <1> 
  2860 000020F5 050470636900        <1> db 5,4,"pci",0
  2861                              <1> 	pcishow:
  2862 000020FB E828230000          <1> 	call pcidump
  2863 00002100 E9A0EFFFFF          <1> 	jmp nwcmd
  2864                              <1> 	
  2865 00002105 050461727000        <1> db 5,4,"arp",0
  2866 0000210B E813220000          <1> 	call arptest
  2867 00002110 E990EFFFFF          <1> 	jmp nwcmd
  2868                              <1> 
  2869 00002115 0504626174636800    <1> db 5,4,"batch",0
  2870                              <1> 	batchst: 
  2871 0000211D BF[701C0000]        <1> 		mov edi, buftxt
  2872 00002122 81C706000000        <1> 		add edi, 6
  2873 00002128 803F00              <1> 		cmp byte [edi], 0
  2874 0000212B 0F8473000000        <1> 		je near nonamefound
  2875 00002131 BE00001000          <1> 		mov esi, 0x100000
  2876 00002136 E8A7240000          <1> 		call loadfile
  2877 0000213B 89D0                <1> 		mov eax, edx
  2878 0000213D 3D94010000          <1> 		cmp eax, 404
  2879 00002142 746F                <1> 		je goodbatchname
  2880 00002144 BE[53210000]        <1> 		mov esi, badbatchname
  2881 00002149 E824EAFFFF          <1> 		call print
  2882 0000214E E952EFFFFF          <1> 		jmp nwcmd
  2883 00002153 546869732066696C65- <1> 		badbatchname db "This file already exists!",10,13,0
  2884 0000215C 20616C726561647920- <1>
  2885 00002165 657869737473210A0D- <1>
  2886 0000216E 00                  <1>
  2887 0000216F 596F75206861766520- <1> 		namenotfoundbatch db "You have to type a name after the command.",10,13,0
  2888 00002178 746F20747970652061- <1>
  2889 00002181 206E616D6520616674- <1>
  2890 0000218A 65722074686520636F- <1>
  2891 00002193 6D6D616E642E0A0D00  <1>
  2892 0000219C 00000000            <1> 		esicache3 dd 0
  2893 000021A0 00000000            <1> 		esicache2 dd 0
  2894                              <1> 	nonamefound:
  2895 000021A4 BE[6F210000]        <1> 		mov esi, namenotfoundbatch
  2896 000021A9 E8C4E9FFFF          <1> 		call print
  2897 000021AE E9F2EEFFFF          <1> 		jmp nwcmd
  2898                              <1> 	goodbatchname:
  2899 000021B3 BE00001000          <1> 		mov esi, 0x100000
  2900                              <1> 	batchcreate:
  2901 000021B8 8935[9C210000]      <1> 		mov [esicache3], esi
  2902 000021BE B00D                <1> 		mov al, 13
  2903 000021C0 B307                <1> 		mov bl, 7
  2904 000021C2 B404                <1> 		mov ah, 4
  2905 000021C4 CD30                <1> 		int 30h
  2906 000021C6 8935[A0210000]      <1> 		mov [esicache2], esi
  2907 000021CC 8A0E                <1> 		mov cl, [esi]
  2908 000021CE 8B35[9C210000]      <1> 		mov esi, [esicache3]
  2909 000021D4 BB[2B220000]        <1> 		mov ebx, exitword
  2910 000021D9 E84DF0FFFF          <1> 		call cndtest
  2911 000021DE 3C01                <1> 		cmp al, 1
  2912 000021E0 7423                <1> 		je endbatchcreate
  2913 000021E2 3C02                <1> 		cmp al, 2
  2914 000021E4 741F                <1> 		je endbatchcreate
  2915 000021E6 BE[4D480000]        <1> 		mov esi, line
  2916 000021EB E882E9FFFF          <1> 		call print
  2917 000021F0 8B35[A0210000]      <1> 		mov esi, [esicache2]
  2918 000021F6 B00D                <1> 		mov al, 13
  2919 000021F8 B40A                <1> 		mov ah, 10
  2920 000021FA 668906              <1> 		mov [esi], ax
  2921 000021FD 81C602000000        <1> 		add esi, 2
  2922 00002203 EBB3                <1> 		jmp batchcreate
  2923                              <1> 	endbatchcreate:
  2924 00002205 8B35[9C210000]      <1> 		mov esi, [esicache3]
  2925 0000220B B800000000          <1> 		mov eax, 0
  2926 00002210 8806                <1> 		mov [esi], al
  2927 00002212 BE[4D480000]        <1> 		mov esi, line
  2928 00002217 E856E9FFFF          <1> 		call print
  2929 0000221C BE00001000          <1> 		mov esi, 0x100000
  2930 00002221 E84CE9FFFF          <1> 		call print
  2931 00002226 E97AEEFFFF          <1> 		jmp nwcmd
  2932                              <1> 	
  2933 0000222B 5C7800              <1> 	exitword db "\x",0
  2934 0000222E 54797065205C782074- <1> 	wordmsg db "Type \x to exit.",10,13,0
  2935 00002237 6F20657869742E0A0D- <1>
  2936 00002240 00                  <1>
  2937                              <1> 		
  2938 00002241 050473686F7700      <1> db 5,4,"show",0
  2939 00002248 BF[701C0000]        <1> 		mov edi, buftxt
  2940 0000224D 81C705000000        <1> 		add edi, 5
  2941 00002253 BE00001000          <1> 		mov esi, 0x100000
  2942 00002258 E885230000          <1> 		call loadfile
  2943 0000225D BE00001000          <1> 		mov esi, 0x100000
  2944 00002262 66813E424D          <1> 		cmp word [esi], "BM"
  2945 00002267 7414                <1> 		je bmpfound
  2946 00002269 E804E9FFFF          <1> 		call print
  2947 0000226E BE[4D480000]        <1> 		mov esi, line
  2948 00002273 E8FAE8FFFF          <1> 		call print
  2949 00002278 E928EEFFFF          <1> 		jmp nwcmd
  2950                              <1> bmpfound:
  2951 0000227D 803D[A92C0000]00    <1> 		cmp byte [guion], 0
  2952 00002284 0F844D000000        <1> 		je near noguibmp
  2953 0000228A BE00001000          <1> 		mov esi, 0x100000
  2954 0000228F B900000000          <1> 		mov ecx, 0
  2955 00002294 BA00000000          <1> 		mov edx, 0
  2956 00002299 B800000000          <1> 		mov eax, 0
  2957 0000229E BB00000000          <1> 		mov ebx, 0
  2958 000022A3 E8DE190000          <1> 		call showbmp
  2959 000022A8 B000                <1> 		mov al, 0
  2960 000022AA B405                <1> 		mov ah, 5
  2961 000022AC CD30                <1> 		int 30h
  2962 000022AE E85D080000          <1> 		call guiclear
  2963 000022B3 E877100000          <1> 		call reloadallgraphics
  2964 000022B8 BE[701C0000]        <1> 		mov esi, buftxt
  2965 000022BD 81C605000000        <1> 		add esi, 5
  2966 000022C3 E8AAE8FFFF          <1> 		call print
  2967 000022C8 BE[5A230000]        <1> 		mov esi, loadedbmpmsg
  2968 000022CD E8A0E8FFFF          <1> 		call print
  2969 000022D2 E9CEEDFFFF          <1> 		jmp nwcmd
  2970                              <1> noguibmp:
  2971 000022D7 BE[E6220000]        <1> 		mov esi, warnguibmp
  2972 000022DC E891E8FFFF          <1> 		call print
  2973 000022E1 E9BFEDFFFF          <1> 		jmp nwcmd
  2974 000022E6 546869732063616E20- <1> warnguibmp db "This can not be done without the gui.",10,13,0
  2975 000022EF 6E6F7420626520646F- <1>
  2976 000022F8 6E6520776974686F75- <1>
  2977 00002301 742074686520677569- <1>
  2978 0000230A 2E0A0D00            <1>
  2979                              <1> 
  2980                              <1> 		
  2981                              <1> filenotfound:
  2982 0000230E BE[37230000]        <1> 		mov esi, filenf
  2983 00002313 E85AE8FFFF          <1> 		call print
  2984 00002318 BE[701C0000]        <1> 		mov esi, buftxt
  2985 0000231D 81C608000000        <1> 		add esi, 8
  2986 00002323 E84AE8FFFF          <1> 		call print
  2987 00002328 BE[42230000]        <1> 		mov esi, filenf2
  2988 0000232D E840E8FFFF          <1> 		call print
  2989 00002332 E96EEDFFFF          <1> 		jmp nwcmd
  2990 00002337 5468652066696C6520- <1> filenf db "The file ",34,0
  2991 00002340 2200                <1>
  2992 00002342 2220636F756C64206E- <1> filenf2 db 34," could not be found.",13,10,0
  2993 0000234B 6F7420626520666F75- <1>
  2994 00002354 6E642E0D0A00        <1>
  2995                              <1> 		
  2996 0000235A 206C6F616465642E0D- <1> loadedbmpmsg db " loaded.",13,10,0
  2997 00002363 0A00                <1>
  2998                              <1> 
  2999 00002365 050464756D7000      <1> 	db 5,4,"dump",0
  3000 0000236C BE[701C0000]        <1> 	mov esi, buftxt
  3001 00002371 81C605000000        <1> 	add esi, 5
  3002 00002377 B900000000          <1> 	mov ecx, 0
  3003 0000237C E8B3F2FFFF          <1> 	call cnvrttxt
  3004 00002381 89CF                <1> 	mov edi, ecx
  3005 00002383 89FE                <1> 	mov esi, edi
  3006 00002385 81C680030000        <1> 	add esi, 896
  3007 0000238B C605[E0140000]00    <1> 	mov byte [firsthexshown],0
  3008                              <1> dumphexloop:
  3009 00002392 8B0F                <1> 	mov ecx, [edi]
  3010 00002394 E85CF1FFFF          <1> 	call showhex
  3011 00002399 81C704000000        <1> 	add edi, 4
  3012 0000239F 39F7                <1> 	cmp edi, esi
  3013 000023A1 72EF                <1> 	jb dumphexloop
  3014 000023A3 E9FDECFFFF          <1> 	jmp nwcmd
  3015                              <1> 
  3016 000023A8 050474696D6500      <1> db 5,4,"time",0
  3017 000023AF E823000000          <1> 	call time
  3018 000023B4 BE[C1250000]        <1> 	mov esi, timeshow
  3019 000023B9 E8B4E7FFFF          <1> 	call print
  3020 000023BE BE[4D480000]        <1> 	mov esi, line
  3021 000023C3 E8AAE7FFFF          <1> 	call print
  3022 000023C8 BE[CB250000]        <1> 	mov esi, dateshow
  3023 000023CD E8A0E7FFFF          <1> 	call print
  3024 000023D2 E9CEECFFFF          <1> 	jmp nwcmd
  3025                              <1> 	time:
  3026 000023D7 E86D010000          <1> 	call tstackput1
  3027 000023DC B00A                <1> 	mov al,10			;Get RTC register A
  3028 000023DE E897010000          <1> 	call tget1
  3029 000023E3 A880                <1> 	test al,0x80			;Is update in progress?
  3030 000023E5 75F0                <1> 	jne time				; yes, wait
  3031                              <1> 
  3032 000023E7 B000                <1> 	mov al,0			;Get seconds (00 to 59)
  3033 000023E9 E88C010000          <1> 	call tget1
  3034 000023EE A2[B8250000]        <1> 	mov [RTCtimeSecond],al
  3035                              <1> 
  3036 000023F3 B002                <1> 	mov al,0x02			;Get minutes (00 to 59)
  3037 000023F5 E880010000          <1> 	call tget1
  3038 000023FA A2[B9250000]        <1> 	mov [RTCtimeMinute],al
  3039                              <1> 
  3040 000023FF B004                <1> 	mov al,0x04			;Get hours (see notes)
  3041 00002401 E874010000          <1> 	call tget1
  3042 00002406 A2[BA250000]        <1> 	mov [RTCtimeHour],al
  3043                              <1> 
  3044 0000240B B007                <1> 	mov al,0x07			;Get day of month (01 to 31)
  3045 0000240D E868010000          <1> 	call tget1
  3046                              <1> ;	mov ah, 0			;;fix day
  3047                              <1> ;	mov ah, al
  3048                              <1> ;	shr ah, 4
  3049                              <1> ;	shl al, 4
  3050                              <1> ;	shr al, 4
  3051                              <1> ;	cmp al, 0
  3052                              <1> ;	jne nodecahday
  3053                              <1> ;	mov al, 10
  3054                              <1> ;	dec ah
  3055                              <1> ;nodecahday:
  3056                              <1> ;	dec al
  3057                              <1> ;	shl ah, 4
  3058                              <1> ;	or al, ah
  3059 00002412 A2[BB250000]        <1> 	mov [RTCtimeDay],al
  3060                              <1> 
  3061 00002417 B008                <1> 	mov al,0x08			;Get month (01 to 12)
  3062 00002419 E85C010000          <1> 	call tget1
  3063 0000241E A2[BC250000]        <1> 	mov [RTCtimeMonth],al
  3064                              <1> 
  3065 00002423 B009                <1> 	mov al,0x09			;Get year (00 to 99)
  3066 00002425 E850010000          <1> 	call tget1
  3067 0000242A A2[BD250000]        <1> 	mov [RTCtimeYear],al
  3068                              <1> 	
  3069 0000242F BE[C1250000]        <1> 	mov esi, timeshow
  3070 00002434 8A2D[BA250000]      <1> 	mov ch, [RTCtimeHour]
  3071 0000243A E846010000          <1> 	call tput1
  3072 0000243F 8A2D[B9250000]      <1> 	mov ch, [RTCtimeMinute]
  3073 00002445 E83B010000          <1> 	call tput1
  3074 0000244A 8A2D[B8250000]      <1> 	mov ch, [RTCtimeSecond]
  3075 00002450 E830010000          <1> 	call tput1
  3076 00002455 BE[CB250000]        <1> 	mov esi, dateshow
  3077 0000245A 8A2D[BC250000]      <1> 	mov ch, [RTCtimeMonth]
  3078 00002460 E820010000          <1> 	call tput1
  3079 00002465 8A2D[BB250000]      <1> 	mov ch, [RTCtimeDay]
  3080 0000246B E815010000          <1> 	call tput1
  3081 00002470 B520                <1> 	mov ch, 0x20
  3082 00002472 E80E010000          <1> 	call tput1
  3083 00002477 4E                  <1> 	dec esi
  3084 00002478 8A2D[BD250000]      <1> 	mov ch, [RTCtimeYear]
  3085 0000247E E802010000          <1> 	call tput1
  3086 00002483 E8DB000000          <1> 	call tstackget1
  3087 00002488 BE[C1250000]        <1> 	mov esi, timeshow
  3088 0000248D 66BB0700            <1> 	mov bx, 7
  3089 00002491 B401                <1> 	mov ah, 1
  3090 00002493 B000                <1> 	mov al, 0
  3091 00002495 CD30                <1> 	int 30h
  3092                              <1> ;;get day of week
  3093                              <1> ;;add these:
  3094                              <1> ;;century value
  3095                              <1> ;;last 2 digits of year
  3096                              <1> ;;last 2 digits of year right shifted twice
  3097                              <1> ;;month table value
  3098                              <1> ;;day of the month
  3099                              <1> ;;divide these by 7
  3100                              <1> ;;the remainder is the day
  3101 00002497 B800000000          <1> 	mov eax, 0
  3102                              <1> ;;first convert the values from BCD to hex
  3103 0000249C A0[BB250000]        <1> 	mov al, [RTCtimeDay]
  3104 000024A1 E88A000000          <1> 	call converttohex
  3105 000024A6 8825[BE250000]      <1> 	mov [dayhex], ah
  3106 000024AC A0[BC250000]        <1> 	mov al, [RTCtimeMonth]
  3107 000024B1 E87A000000          <1> 	call converttohex
  3108 000024B6 8825[BF250000]      <1> 	mov [monthhex], ah
  3109 000024BC A0[BD250000]        <1> 	mov al, [RTCtimeYear]
  3110 000024C1 E86A000000          <1> 	call converttohex
  3111 000024C6 8825[C0250000]      <1> 	mov [yearhex], ah
  3112 000024CC B800000000          <1> 	mov eax, 0
  3113 000024D1 A0[C0250000]        <1> 	mov al, [yearhex]
  3114 000024D6 C0E802              <1> 	shr al, 2
  3115 000024D9 0205[C0250000]      <1> 	add al, [yearhex]
  3116 000024DF 0506000000          <1> 	add eax, 6
  3117 000024E4 BB00000000          <1> 	mov ebx, 0
  3118 000024E9 8A1D[BF250000]      <1> 	mov bl, [monthhex]
  3119 000024EF FECB                <1> 	dec bl
  3120 000024F1 81C3[E1250000]      <1> 	add ebx, month
  3121 000024F7 B900000000          <1> 	mov ecx, 0
  3122 000024FC 8A0B                <1> 	mov cl, [ebx]
  3123 000024FE 01C8                <1> 	add eax, ecx
  3124 00002500 8A0D[BE250000]      <1> 	mov cl, [dayhex]
  3125 00002506 01C8                <1> 	add eax, ecx
  3126 00002508 66BB0700            <1> 	mov bx, 7
  3127 0000250C BA00000000          <1> 	mov edx, 0
  3128 00002511 66F7F3              <1> 	div bx
  3129 00002514 C1E202              <1> 	shl edx, 2
  3130 00002517 81C2[ED250000]      <1> 	add edx, day
  3131 0000251D 8B32                <1> 	mov esi, [edx]
  3132 0000251F 66BB0700            <1> 	mov bx, 7
  3133 00002523 B401                <1> 	mov ah, 1
  3134 00002525 B000                <1> 	mov al, 0
  3135 00002527 CD30                <1> 	int 30h
  3136 00002529 66B80000            <1> 	mov ax, 0
  3137 0000252D CD30                <1> 	int 30h
  3138 0000252F F4                  <1> 	hlt
  3139                              <1> 	
  3140                              <1> converttohex:
  3141 00002530 88C4                <1> 	mov ah, al
  3142 00002532 C0E804              <1> 	shr al, 4
  3143 00002535 C0E404              <1> 	shl ah, 4
  3144 00002538 C0EC04              <1> 	shr ah, 4
  3145 0000253B 3C00                <1> 	cmp al, 0
  3146 0000253D 7409                <1> 	je noconverttohex
  3147                              <1> converttohexlp:
  3148 0000253F 80C40A              <1> 	add ah, 10
  3149 00002542 FEC8                <1> 	dec al
  3150 00002544 3C00                <1> 	cmp al, 0
  3151 00002546 75F7                <1> 	jne converttohexlp
  3152                              <1> noconverttohex:
  3153 00002548 C3                  <1> 	ret
  3154                              <1> 	
  3155                              <1> tstackput1:
  3156 00002549 8935[B4250000]      <1> 	mov [tstack + 20], esi
  3157 0000254F BE[A0250000]        <1> 	mov esi, tstack
  3158 00002554 8906                <1> 	mov [esi], eax
  3159 00002556 895E04              <1> 	mov [esi + 4], ebx
  3160 00002559 894E08              <1> 	mov [esi + 8], ecx
  3161 0000255C 89560C              <1> 	mov [esi + 12], edx
  3162 0000255F 897E10              <1> 	mov [esi + 16], edi
  3163 00002562 C3                  <1> 	ret
  3164                              <1> 	
  3165                              <1> tstackget1:
  3166 00002563 BE[A0250000]        <1> 	mov esi, tstack
  3167 00002568 8B06                <1> 	mov eax, [esi]
  3168 0000256A 8B5E04              <1> 	mov ebx, [esi + 4]
  3169 0000256D 8B4E08              <1> 	mov ecx, [esi + 8]
  3170 00002570 8B560C              <1> 	mov edx, [esi + 12]
  3171 00002573 8B7E10              <1> 	mov edi, [esi + 16]
  3172 00002576 8B7614              <1> 	mov esi, [esi + 20]
  3173 00002579 C3                  <1> 	ret
  3174                              <1> 	
  3175                              <1> tget1:
  3176 0000257A 66BA7000            <1> 	mov dx, 0x70
  3177 0000257E EE                  <1> 	out dx, al
  3178 0000257F 6642                <1> 	inc dx
  3179 00002581 EC                  <1> 	in al, dx
  3180 00002582 664A                <1> 	dec dx
  3181 00002584 C3                  <1> 	ret
  3182                              <1> 	
  3183                              <1> tput1:
  3184 00002585 66C1E904            <1> 	shr cx, 4
  3185 00002589 B030                <1> 	mov al, 48
  3186 0000258B 00E8                <1> 	add al, ch
  3187 0000258D 8806                <1> 	mov [esi], al
  3188 0000258F 46                  <1> 	inc esi
  3189 00002590 B030                <1> 	mov al, 48
  3190 00002592 C0E904              <1> 	shr cl, 4
  3191 00002595 00C8                <1> 	add al, cl
  3192 00002597 8806                <1> 	mov [esi], al
  3193 00002599 81C602000000        <1> 	add esi, 2
  3194 0000259F C3                  <1> 	ret
  3195                              <1> 		
  3196 000025A0 000000000000000000- <1> 	tstack dd 0,0,0,0,0,0
  3197 000025A9 000000000000000000- <1>
  3198 000025B2 000000000000        <1>
  3199 000025B8 00                  <1> 	RTCtimeSecond db 0
  3200 000025B9 00                  <1> 	RTCtimeMinute db 0
  3201 000025BA 00                  <1> 	RTCtimeHour db 0
  3202 000025BB 00                  <1> 	RTCtimeDay db 0
  3203 000025BC 00                  <1> 	RTCtimeMonth db 0
  3204 000025BD 00                  <1> 	RTCtimeYear db 0
  3205 000025BE 00                  <1> 	dayhex db 0
  3206 000025BF 00                  <1> 	monthhex db 0
  3207 000025C0 00                  <1> 	yearhex db 0
  3208 000025C1 30303A30303A30300D- <1> 	timeshow db "00:00:00",13,10
  3209 000025CA 0A                  <1>
  3210 000025CB 30302D30302D303030- <1> 	dateshow db "00-00-0000",13,10,0
  3211 000025D4 300D0A00            <1>
  3212                              <1> 	oldcentury:	;;from 1700 to 1900
  3213 000025D8 040200              <1> 	db 4,2,0
  3214                              <1> 	century:	;;from 2000 to 2500
  3215 000025DB 060402000604        <1> 	db 6,4,2,0,6,4
  3216                              <1> 	month:
  3217 000025E1 000303060104060205- <1> 	db 0,3,3,6,1,4,6,2,5,0,3,5
  3218 000025EA 000305              <1>
  3219                              <1> 	day:
  3220 000025ED [09260000]          <1> 	dd sunday
  3221 000025F1 [12260000]          <1> 	dd monday
  3222 000025F5 [1B260000]          <1> 	dd tuesday
  3223 000025F9 [25260000]          <1> 	dd wednesday
  3224 000025FD [31260000]          <1> 	dd thursday
  3225 00002601 [3C260000]          <1> 	dd friday
  3226 00002605 [45260000]          <1> 	dd saturday
  3227                              <1> sunday:
  3228 00002609 53756E6461790D0A00  <1> 	db "Sunday",13,10,0
  3229                              <1> monday:
  3230 00002612 4D6F6E6461790D0A00  <1> 	db "Monday",13,10,0
  3231                              <1> tuesday:
  3232 0000261B 547565736461790D0A- <1> 	db "Tuesday",13,10,0
  3233 00002624 00                  <1>
  3234                              <1> wednesday:
  3235 00002625 5765646E6573646179- <1> 	db "Wednesday",13,10,0
  3236 0000262E 0D0A00              <1>
  3237                              <1> thursday:
  3238 00002631 54687572736461790D- <1> 	db "Thursday",13,10,0
  3239 0000263A 0A00                <1>
  3240                              <1> friday:
  3241 0000263C 4672696461790D0A00  <1> 	db "Friday",13,10,0
  3242                              <1> saturday:
  3243 00002645 53617475726461790D- <1> 	db "Saturday",13,10,0
  3244 0000264E 0A00                <1>
  3245                              <1> 
  3246 00002650 0504637075696400    <1> db 5,4,"cpuid",0
  3247 00002658 B800000000          <1> 	mov eax, 0
  3248 0000265D 0FA2                <1> 	cpuid
  3249 0000265F 891D[B4260000]      <1> 	mov [cpuidbuf], ebx
  3250 00002665 8915[B8260000]      <1> 	mov [cpuidbuf + 4], edx
  3251 0000266B 890D[BC260000]      <1> 	mov [cpuidbuf + 8], ecx
  3252 00002671 BE[B4260000]        <1> 	mov esi, cpuidbuf
  3253 00002676 E8F7E4FFFF          <1> 	call print
  3254 0000267B BE[4D480000]        <1> 	mov esi, line
  3255 00002680 E8EDE4FFFF          <1> 	call print
  3256 00002685 B801000000          <1> 	mov eax, 1
  3257 0000268A 0FA2                <1> 	cpuid
  3258 0000268C 89C1                <1> 	mov ecx, eax
  3259 0000268E C605[E0140000]02    <1> 	mov byte [firsthexshown], 2
  3260 00002695 E85BEEFFFF          <1> 	call showhex
  3261 0000269A B808000080          <1> 	mov eax, 0x80000008
  3262 0000269F 0FA2                <1> 	cpuid
  3263 000026A1 89C1                <1> 	mov ecx, eax
  3264 000026A3 C605[E0140000]02    <1> 	mov byte [firsthexshown], 2
  3265 000026AA E846EEFFFF          <1> 	call showhex
  3266 000026AF E9F1E9FFFF          <1> 	jmp nwcmd
  3267                              <1> 	
  3268 000026B4 00<rept>            <1> cpuidbuf times 13 db 0
  3269                              <1> cpuidvendorend:
  3270                              <1> progend:		;programs end here	
  3271                              <1> batchprogend:
  3272                                      %include 'source/input.asm'
  3273                              <1> PS2SET:
  3274 000026C1 B0A8                <1>   mov  al, 0xa8		; enable mouse port
  3275 000026C3 E664                <1>   out  0x64, al		; write to keyboardcontroller
  3276 000026C5 E801000000          <1>   call CHKPRT		; check if command is progressed (demand!)
  3277 000026CA C3                  <1> ret
  3278                              <1> 
  3279                              <1> CHKPRT:
  3280 000026CB 66B96400            <1>   mov  cx, 100
  3281                              <1>  .again:
  3282 000026CF E464                <1>   in   al, 0x64		; read from keyboardcontroller
  3283 000026D1 A802                <1>   test al, 2		; Check if input buffer is empty
  3284 000026D3 7402                <1>   je .go
  3285 000026D5 E2F8                <1>   loop .again
  3286                              <1>  .go:
  3287 000026D7 C3                  <1> ret
  3288                              <1> 
  3289                              <1> WMOUS:
  3290 000026D8 B0D4                <1>   mov  al, 0xd4		; write to mouse device instead of to keyboard
  3291 000026DA E664                <1>   out  0x64, al		; write to keyboardcontroller
  3292 000026DC E8EAFFFFFF          <1>   call CHKPRT		; check if command is progressed (demand!)
  3293 000026E1 C3                  <1> ret
  3294                              <1> 
  3295                              <1> MBUFFUL:
  3296 000026E2 66B96400            <1>   mov cx, 100
  3297                              <1>  .mn:
  3298 000026E6 E464                <1>   in   al, 0x64		; read from keyboardcontroller
  3299 000026E8 A820                <1>   test al, 0x20		; check if mouse output buffer is full
  3300 000026EA 7402                <1>   jz  .mnn
  3301 000026EC E2F8                <1>   loop .mn
  3302                              <1>  .mnn:
  3303 000026EE C3                  <1> ret
  3304                              <1> 
  3305                              <1> 
  3306                              <1> ACTMOUS:
  3307 000026EF E8E4FFFFFF          <1>   call WMOUS
  3308 000026F4 B0F4                <1>   mov  al, 0xf4 	; Command to activate mouse itselve (Stream mode)
  3309 000026F6 E660                <1>   out  0x60, al		; write ps/2 controller output port (activate mouse)
  3310 000026F8 E8CEFFFFFF          <1>   call CHKPRT		; check if command is progressed (demand!)
  3311 000026FD E801000000          <1>   call CHKMOUS		; check if a byte is available
  3312 00002702 C3                  <1> ret
  3313                              <1> 
  3314                              <1> CHKMOUS:
  3315 00002703 B300                <1>   mov  bl, 0
  3316 00002705 66B96400            <1>   mov cx, 100
  3317                              <1>  .vrd:
  3318 00002709 E464                <1>   in   al, 0x64		; read from keyboardcontroller
  3319 0000270B A801                <1>   test al, 1		; check if controller buffer (60h) has data
  3320 0000270D 7504                <1>   jnz .yy
  3321 0000270F E2F8                <1>   loop .vrd
  3322 00002711 B301                <1>   mov  bl, 1
  3323                              <1>  .yy:
  3324 00002713 C3                  <1> ret
  3325                              <1> 
  3326                              <1> GETB:
  3327                              <1>  .cagain:
  3328 00002714 E8EAFFFFFF          <1>   call CHKMOUS		; check if a byte is available
  3329 00002719 08DB                <1>   or bl, bl
  3330 0000271B 75F7                <1>   jnz .cagain
  3331 0000271D B0AD                <1>   mov  al, 0xad		; Disable Keyboard
  3332 0000271F E664                <1>   out  0x64, al		; write to keyboardcontroller
  3333 00002721 E8A5FFFFFF          <1>   call CHKPRT		; check if command is progressed (demand!)
  3334 00002726 6631C0              <1>   xor  ax, ax
  3335 00002729 E460                <1>   in   al, 0x60		; read ps/2 controller output port (mousebyte)
  3336 0000272B 88C2                <1>   mov  dl, al
  3337 0000272D B0AE                <1>   mov  al, 0xae		; Enable Keyboard
  3338 0000272F E664                <1>   out  0x64, al		; write to keyboardcontroller
  3339 00002731 E895FFFFFF          <1>   call CHKPRT		; check if command is progressed (demand!)
  3340 00002736 88D0                <1>   mov  al, dl
  3341 00002738 C3                  <1> ret
  3342                              <1> 
  3343 00002739 00                  <1> LBUTTON db 0x00	;	Left   button status 1=PRESSED 0=RELEASED
  3344 0000273A 00                  <1> RBUTTON db 0x00	;	Right  button status 1=PRESSED 0=RELEASED
  3345 0000273B 00                  <1> MBUTTON db 0x00	;	Middle button status 1=PRESSED 0=RELEASED
  3346 0000273C 00                  <1> XCOORD  db 0x00	;	the moved distance  (horizontal)
  3347 0000273D 00                  <1> YCOORD  db 0x00	;	the moved distance  (vertical)
  3348                              <1> 
  3349 0000273E 00                  <1> specialkey db 0
  3350                              <1> 
  3351                              <1> 	guistartin:
  3352 0000273F B800000000          <1> 		mov eax, 0
  3353 00002744 A2[3E270000]        <1> 		mov [specialkey], al
  3354 00002749 66A3[3C0B0000]      <1> 		mov [lastkey], ax
  3355 0000274F E464                <1> 		in al, 64h ; Status
  3356 00002751 A801                <1> 		test al, 1 ; output buffer full?
  3357 00002753 74EA                <1> 		jz guistartin
  3358 00002755 A820                <1> 		test al, 20h ; PS2-Mouse?
  3359 00002757 0F8508010000        <1> 		jnz near maincall2
  3360                              <1> 	guigetkey:
  3361 0000275D E460                <1> 		in al, 60h
  3362 0000275F 88C4                <1> 		mov ah, al
  3363 00002761 B000                <1> 		mov al, 0
  3364 00002763 8825[3D0B0000]      <1> 		mov [lastkey + 1], ah
  3365 00002769 88E0                <1> 		mov al, ah
  3366 0000276B BF[9C2A0000]        <1> 		mov edi, scancode
  3367                              <1> 	guisearchscan: 
  3368 00002770 3C40                <1> 		cmp al, 40h
  3369 00002772 7315                <1> 		jae guiscanother
  3370 00002774 B400                <1> 		mov ah, 0
  3371 00002776 D0E0                <1> 		shl al, 1
  3372 00002778 01C7                <1> 		add edi, eax
  3373 0000277A D0E8                <1> 		shr al, 1
  3374 0000277C 8A27                <1> 		mov ah, [edi]
  3375 0000277E 80FC00              <1> 		cmp ah, 0
  3376 00002781 7406                <1> 		je guiscanother
  3377 00002783 E98A000000          <1> 		jmp guiscanfound
  3378 00002788 00                  <1> guiupper db 0
  3379                              <1> guiscanother:
  3380 00002789 88C4                <1> 		mov ah, al
  3381 0000278B B000                <1> 		mov al, 0
  3382 0000278D 66A3[3C0B0000]      <1> 		mov [lastkey], ax
  3383 00002793 80FCE0              <1> 		cmp ah, 0E0h
  3384 00002796 0F8448000000        <1> 		je near guigetkeyspecial
  3385 0000279C B0E0                <1> 		mov al, 0xE0
  3386 0000279E 3805[3E270000]      <1> 		cmp [specialkey], al
  3387 000027A4 7507                <1> 		jne nospecialkey
  3388 000027A6 66A3[3C0B0000]      <1> 		mov [lastkey], ax
  3389 000027AC C3                  <1> 		ret
  3390                              <1> nospecialkey:
  3391                              <1> 		;cmp ah, 4Dh
  3392                              <1> 		;je near nextimage
  3393 000027AD 80FC2A              <1> 		cmp ah, 2Ah
  3394 000027B0 0F8443000000        <1> 		je near guishifton
  3395 000027B6 80FC36              <1> 		cmp ah, 36h
  3396 000027B9 0F843A000000        <1> 		je near guishifton
  3397 000027BF 80FC1C              <1> 		cmp ah, 1Ch
  3398 000027C2 0F8449000000        <1> 		je near guientdown
  3399 000027C8 80FCAA              <1> 		cmp ah, 0AAh
  3400 000027CB 0F8434000000        <1> 		je near guishiftoff
  3401 000027D1 80FCB6              <1> 		cmp ah, 0B6h
  3402 000027D4 0F842B000000        <1> 		je near guishiftoff
  3403 000027DA 80FC3A              <1> 		cmp ah, 3Ah
  3404 000027DD 0F840D000000        <1> 		je near guishift
  3405 000027E3 C3                  <1> 		ret
  3406                              <1> 	guigetkeyspecial:
  3407 000027E4 B0E0                <1> 		mov al, 0xE0
  3408 000027E6 A2[3E270000]        <1> 		mov [specialkey], al
  3409 000027EB E96DFFFFFF          <1> 		jmp guigetkey
  3410                              <1> 	guishift:
  3411 000027F0 A0[88270000]        <1> 		mov al, [guiupper]
  3412 000027F5 3C01                <1> 		cmp al, 1
  3413 000027F7 730C                <1> 		jae guishiftoff
  3414                              <1> 	guishifton:
  3415 000027F9 C605[88270000]01    <1> 		mov byte [guiupper], 1
  3416 00002800 E93AFFFFFF          <1> 		jmp guistartin
  3417                              <1> 	guishiftoff:
  3418 00002805 C605[88270000]00    <1> 		mov byte [guiupper], 0
  3419 0000280C E92EFFFFFF          <1> 		jmp guistartin
  3420                              <1> 	guientdown:
  3421 00002811 C3                  <1> 		ret
  3422                              <1> 	guiscanfound:
  3423 00002812 81C701000000        <1> 		add edi, 1
  3424 00002818 803D[88270000]01    <1> 		cmp byte [guiupper], 1
  3425 0000281F 7306                <1> 		jae uppercasegui
  3426 00002821 81EF01000000        <1> 		sub edi, 1
  3427                              <1> uppercasegui:
  3428 00002827 8A07                <1> 		mov al,[edi]
  3429 00002829 A2[3C0B0000]        <1> 		mov [lastkey], al
  3430 0000282E C3                  <1> 		ret
  3431                              <1> 		
  3432                              <1> 		
  3433                              <1> 	cursorgui:
  3434 0000282F 803D[2A3D0000]01    <1> 		cmp byte [mouseon], 1
  3435 00002836 0F8429000000        <1> 		je near maincall2
  3436 0000283C 803D[A92C0000]00    <1> 		cmp byte [guion], 0
  3437 00002843 0F84C8FFFFFF        <1> 		je near guientdown
  3438                              <1> 	initmouse:
  3439 00002849 E828050000          <1> 		call switchmousepos2
  3440 0000284E E86EFEFFFF          <1> 	  	call PS2SET
  3441 00002853 E897FEFFFF          <1> 		call ACTMOUS
  3442 00002858 C605[2A3D0000]01    <1> 		mov byte [mouseon],1
  3443 0000285F E8B0FEFFFF          <1> 		call GETB 	;;Get the responce byte of the mouse (like: Hey i am active)
  3444                              <1> 				;;If the bytes are mixed up,
  3445                              <1> 				;;remove this line or add another of this line.
  3446                              <1> 		;call GETB
  3447 00002864 C3                  <1> 		ret
  3448                              <1> 	maincall2:
  3449 00002865 803D[2A3D0000]01    <1> 		  cmp byte [mouseon], 1
  3450 0000286C 75DB                <1> 		  jne initmouse
  3451 0000286E E8A1FEFFFF          <1> 		  call GETB
  3452 00002873 88C3                <1> 		  mov  bl, al
  3453 00002875 80E301              <1> 		  and  bl, 1
  3454 00002878 881D[39270000]      <1> 		  mov  BYTE [LBUTTON], bl
  3455 0000287E 88C3                <1> 		  mov  bl, al
  3456 00002880 80E302              <1> 		  and  bl, 2
  3457 00002883 D0EB                <1> 		  shr  bl, 1
  3458 00002885 881D[3A270000]      <1> 		  mov  BYTE [RBUTTON], bl
  3459 0000288B 88C3                <1> 		  mov  bl, al
  3460 0000288D 80E304              <1> 		  and  bl, 4
  3461 00002890 C0EB02              <1> 		  shr  bl, 2
  3462 00002893 881D[3B270000]      <1> 		  mov  BYTE [MBUTTON], bl
  3463 00002899 E876FEFFFF          <1> 		  call GETB
  3464 0000289E A2[3C270000]        <1> 		  mov  BYTE [XCOORD], al
  3465 000028A3 E86CFEFFFF          <1> 		  call GETB
  3466 000028A8 A2[3D270000]        <1> 		  mov  BYTE [YCOORD], al
  3467                              <1> 
  3468                              <1> 	showpixelcursor:
  3469 000028AD 668B15[FA290000]    <1> 		mov dx, [mousecursorposition]
  3470 000028B4 668B0D[FC290000]    <1> 		mov cx, [mousecursorposition + 2]
  3471 000028BB 668915[F6290000]    <1> 		mov [lastmouseposition], dx
  3472 000028C2 66890D[F8290000]    <1> 		mov [lastmouseposition + 2], cx
  3473 000028C9 A0[3C270000]        <1> 		mov al, [XCOORD]
  3474 000028CE 3C80                <1> 		cmp al, 128
  3475 000028D0 730C                <1> 		jae subxcoord
  3476 000028D2 00C0                <1> 		add al, al
  3477 000028D4 B400                <1> 		mov ah, 0
  3478 000028D6 6601C2              <1> 		add dx, ax
  3479 000028D9 E90B000000          <1> 		jmp subxcoorddn
  3480                              <1> 	subxcoord:
  3481 000028DE 00C0                <1> 		add al, al
  3482 000028E0 B300                <1> 		mov bl, 0
  3483 000028E2 28C3                <1> 		sub bl, al
  3484 000028E4 B700                <1> 		mov bh, 0
  3485 000028E6 6629DA              <1> 		sub dx, bx
  3486                              <1> 	subxcoorddn:
  3487 000028E9 8A1D[3D270000]      <1> 		mov bl, [YCOORD]
  3488 000028EF B000                <1> 		mov al, 0
  3489 000028F1 28D8                <1> 		sub al, bl
  3490 000028F3 3C80                <1> 		cmp al, 128
  3491 000028F5 730A                <1> 		jae subycoord
  3492 000028F7 B400                <1> 		mov ah, 0
  3493 000028F9 6601C1              <1> 		add cx, ax
  3494 000028FC E909000000          <1> 		jmp subycoorddn
  3495                              <1> 	subycoord:
  3496 00002901 B300                <1> 		mov bl, 0
  3497 00002903 28C3                <1> 		sub bl, al
  3498 00002905 B700                <1> 		mov bh, 0
  3499 00002907 6629D9              <1> 		sub cx, bx
  3500                              <1> 	subycoorddn:
  3501 0000290A 6681FA204E          <1> 		cmp dx, 20000
  3502 0000290F 7604                <1> 		jbe nooriginx2
  3503 00002911 66BA0000            <1> 		mov dx, 0
  3504                              <1> 	nooriginx2:
  3505 00002915 6681F9204E          <1> 		cmp cx, 20000
  3506 0000291A 7604                <1> 		jbe nooriginy2
  3507 0000291C 66B90000            <1> 		mov cx, 0
  3508                              <1> 	nooriginy2:
  3509 00002920 6681FA0000          <1> 		cmp dx, 0
  3510 00002925 7415                <1> 		je nofixxcolumn2
  3511 00002927 663B15[D73A0000]    <1> 		cmp dx, [resolutionx2]
  3512 0000292E 720C                <1> 		jb nofixxcolumn2
  3513 00002930 668B15[D73A0000]    <1> 		mov dx, [resolutionx2]
  3514 00002937 6681EA0200          <1> 		sub dx, 2
  3515                              <1> 	nofixxcolumn2:
  3516 0000293C 6681F90000          <1> 		cmp cx, 0
  3517 00002941 7415                <1> 		je nofixyrow2
  3518 00002943 663B0D[D33A0000]    <1> 		cmp cx, [resolutiony]
  3519 0000294A 720C                <1> 		jb nofixyrow2
  3520 0000294C 668B0D[D33A0000]    <1> 		mov cx, [resolutiony]
  3521 00002953 6681E90100          <1> 		sub cx, 1
  3522                              <1> 	nofixyrow2:
  3523 00002958 668915[FA290000]    <1> 		mov [mousecursorposition], dx
  3524 0000295F 66890D[FC290000]    <1> 		mov [mousecursorposition + 2], cx
  3525 00002966 E8A2030000          <1> 		call switchmousepos ;;use dragging code to ensure proper icon drag
  3526 0000296B 803D[39270000]01    <1> 		cmp byte [LBUTTON], 1
  3527 00002972 0F847B040000        <1> 		je near clickicon
  3528 00002978 803D[3A270000]01    <1> 		cmp byte [RBUTTON], 1
  3529 0000297F 0F846E040000        <1> 		je near clickicon
  3530 00002985 A0[E02D0000]        <1> 		mov al, [pbutton]
  3531 0000298A C705[E32D0000]0000- <1> 		mov dword [dragging], 0
  3532 00002992 0000                <1>
  3533 00002994 3C00                <1> 		cmp al, 0
  3534 00002996 740F                <1> 		je nopreviousbutton
  3535 00002998 E80D030000          <1> 		call clearmousecursor
  3536 0000299D E88D090000          <1> 		call reloadallgraphics
  3537 000029A2 E8CF030000          <1> 		call switchmousepos2
  3538                              <1> 	nopreviousbutton:
  3539 000029A7 B000                <1> 		mov al, 0
  3540 000029A9 A2[E02D0000]        <1> 		mov [pbutton], al
  3541 000029AE A0[39270000]        <1> 		mov al, [LBUTTON]
  3542 000029B3 A2[E12D0000]        <1> 		mov [pLBUTTON], al
  3543 000029B8 A0[3A270000]        <1> 		mov al, [RBUTTON]
  3544 000029BD A2[E22D0000]        <1> 		mov [pRBUTTON], al
  3545 000029C2 B900000000          <1> 		mov ecx, 0
  3546 000029C7 BA00000000          <1> 		mov edx, 0
  3547 000029CC 668B15[FA290000]    <1> 		mov dx, [mousecursorposition]
  3548 000029D3 668B0D[FC290000]    <1> 		mov cx, [mousecursorposition + 2]
  3549 000029DA 66BB9CE7            <1> 		mov bx, 1110011110011100b
  3550 000029DE B400                <1> 		mov ah, 0
  3551 000029E0 B080                <1> 		mov al, 128
  3552 000029E2 C605[A62C0000]01    <1> 		mov byte [showcursorfonton], 1
  3553 000029E9 E8F9100000          <1> 		call showfontvesa
  3554 000029EE C605[A62C0000]00    <1> 		mov byte [showcursorfonton], 0
  3555 000029F5 C3                  <1> 		ret
  3556                              <1> 
  3557 000029F6 84008400            <1> lastmouseposition dw 132,132
  3558 000029FA 84008400            <1> mousecursorposition dw 132,132	
  3559                              <1> 
  3560                              <1> termmouse:
  3561 000029FE C3                  <1> 	ret	;;lets try this later
  3562 000029FF BE[851E0000]        <1> 		mov esi, videobuf2
  3563 00002A04 BA00000000          <1> 		mov edx, 0
  3564 00002A09 668B15[F6290000]    <1> 		mov dx, [lastmouseposition]
  3565 00002A10 668B0D[F8290000]    <1> 		mov cx, [lastmouseposition + 2]
  3566 00002A17 66A1[9A2A0000]      <1> 		mov ax, [cursorcache]
  3567 00002A1D 663D0000            <1> 		cmp ax, 0
  3568 00002A21 7426                <1> 		je nocopycursorcache
  3569 00002A23 66C1E104            <1> 		shl cx, 4
  3570 00002A27 66C1E203            <1> 		shl dx, 3
  3571 00002A2B 01D6                <1> 		add esi, edx
  3572 00002A2D 66BA0000            <1> 		mov dx, 0
  3573 00002A31 8A15[95090000]      <1> 		mov dl, [charxy]
  3574 00002A37 6641                <1> 		inc cx
  3575                              <1> termmousecplp1:
  3576 00002A39 01D6                <1> 		add esi, edx
  3577 00002A3B 6649                <1> 		dec cx
  3578 00002A3D 6681F90000          <1> 		cmp cx, 0
  3579 00002A42 75F5                <1> 		jne termmousecplp1
  3580 00002A44 29D6                <1> 		sub esi, edx
  3581 00002A46 668906              <1> 		mov [esi], ax
  3582                              <1> nocopycursorcache:
  3583 00002A49 BE[851E0000]        <1> 		mov esi, videobuf2
  3584 00002A4E BA00000000          <1> 		mov edx, 0
  3585 00002A53 668B15[FA290000]    <1> 		mov dx, [mousecursorposition]
  3586 00002A5A 668B0D[FC290000]    <1> 		mov cx, [mousecursorposition + 2]
  3587 00002A61 66C1E104            <1> 		shl cx, 4
  3588 00002A65 66C1E203            <1> 		shl dx, 3
  3589 00002A69 01D6                <1> 		add esi, edx
  3590 00002A6B 66BA0000            <1> 		mov dx, 0
  3591 00002A6F 8A15[95090000]      <1> 		mov dl, [charxy]
  3592 00002A75 6641                <1> 		inc cx
  3593                              <1> termmousecplp2:
  3594 00002A77 01D6                <1> 		add esi, edx
  3595 00002A79 6649                <1> 		dec cx
  3596 00002A7B 6681F90000          <1> 		cmp cx, 0
  3597 00002A80 75F5                <1> 		jne termmousecplp2
  3598 00002A82 29D6                <1> 		sub esi, edx
  3599 00002A84 668B06              <1> 		mov ax, [esi]
  3600 00002A87 66A3[9A2A0000]      <1> 		mov [cursorcache], ax
  3601 00002A8D B080                <1> 		mov al, 128
  3602 00002A8F B407                <1> 		mov ah, 7
  3603 00002A91 668906              <1> 		mov [esi], ax
  3604 00002A94 E8EEE3FFFF          <1> 		call termcopy
  3605 00002A99 C3                  <1> 		ret
  3606 00002A9A 0000                <1> cursorcache db 0,0
  3607                              <1> 	
  3608                              <1> scancode:
  3609 00002A9C 0000                <1> 	db 0,0		;,0h
  3610 00002A9E 0000                <1> 	db 0,0		;,1h
  3611 00002AA0 3121                <1> 	db '1','!'	;,2h
  3612 00002AA2 3240                <1> 	db '2','@'	;,3h
  3613 00002AA4 3323                <1> 	db '3','#'	;,4h
  3614 00002AA6 3424                <1> 	db '4','$'	;,5h
  3615 00002AA8 3525                <1> 	db '5','%'	;,6h
  3616 00002AAA 365E                <1> 	db '6','^'	;,7h
  3617 00002AAC 3726                <1> 	db '7','&'	;,8h
  3618 00002AAE 382A                <1> 	db '8','*'	;,9h
  3619 00002AB0 3928                <1> 	db '9','('	;,0Ah
  3620 00002AB2 3029                <1> 	db '0',')'	;,0Bh
  3621 00002AB4 2D5F                <1> 	db '-','_'	;,0Ch
  3622 00002AB6 3D2B                <1> 	db '=','+'	;,0Dh
  3623 00002AB8 0808                <1> 	db 8,8		;,0Eh
  3624 00002ABA 0000                <1> 	db 0,0		;,0Fh
  3625 00002ABC 7151                <1> 	db 'q','Q'	;,10h
  3626 00002ABE 7757                <1> 	db 'w','W'	;,11h
  3627 00002AC0 6545                <1> 	db 'e','E'	;,12h
  3628 00002AC2 7252                <1> 	db 'r','R'	;,13h
  3629 00002AC4 7454                <1> 	db 't','T'	;,14h
  3630 00002AC6 7959                <1> 	db 'y','Y'	;,15h
  3631 00002AC8 7555                <1> 	db 'u','U'	;,16h
  3632 00002ACA 6949                <1> 	db 'i','I'	;,17h
  3633 00002ACC 6F4F                <1> 	db 'o','O'	;,18h
  3634 00002ACE 7050                <1> 	db 'p','P'	;,19h
  3635 00002AD0 5B7B                <1> 	db '[','{'	;,1Ah
  3636 00002AD2 5D7D                <1> 	db ']','}'	;,1Bh
  3637 00002AD4 0000                <1> 	db 0,0		;,1Ch
  3638 00002AD6 0000                <1> 	db 0,0		;,1Dh
  3639 00002AD8 6141                <1> 	db 'a','A'	;,1Eh
  3640 00002ADA 7353                <1> 	db 's','S'	;,1Fh
  3641 00002ADC 6444                <1> 	db 'd','D'	;,20h
  3642 00002ADE 6646                <1> 	db 'f','F'	;,21h
  3643 00002AE0 6747                <1> 	db 'g','G'	;,22h
  3644 00002AE2 6848                <1> 	db 'h','H'	;,23h
  3645 00002AE4 6A4A                <1> 	db 'j','J'	;,24h
  3646 00002AE6 6B4B                <1> 	db 'k','K'	;,25h
  3647 00002AE8 6C4C                <1> 	db 'l','L'	;,26h
  3648 00002AEA 3B3A                <1> 	db ';',':'	;,27h
  3649 00002AEC 2722                <1> 	db 27h,22h	;,28h
  3650 00002AEE 607E                <1> 	db '`','~'	;,29h
  3651 00002AF0 0000                <1> 	db 0,0		;,2Ah
  3652 00002AF2 5C7C                <1> 	db '\','|'	;,2Bh
  3653 00002AF4 7A5A                <1> 	db 'z','Z'	;,2Ch
  3654 00002AF6 7858                <1> 	db 'x','X'	;,2Dh
  3655 00002AF8 6343                <1> 	db 'c','C'	;,2Eh
  3656 00002AFA 7656                <1> 	db 'v','V'	;,2Fh
  3657 00002AFC 6242                <1> 	db 'b','B'	;,30h
  3658 00002AFE 6E4E                <1> 	db 'n','N'	;,31h
  3659 00002B00 6D4D                <1> 	db 'm','M'	;,32h
  3660 00002B02 2C3C                <1> 	db ',','<'	;,33h
  3661 00002B04 2E3E                <1> 	db '.','>'	;,34h
  3662 00002B06 2F3F                <1> 	db '/','?'	;,35h
  3663 00002B08 0000                <1> 	db 0,0		;,36h
  3664 00002B0A 0000                <1> 	db 0,0		;,37h
  3665 00002B0C 0000                <1> 	db 0,0		;,38h
  3666 00002B0E 2020                <1> 	db ' ',' '	;,39h
  3667                              <1> noscan:
  3668                                      %include 'source/gui.asm'
  3669                              <1> guiclear:
  3670 00002B10 8B3D[B8520000]      <1> 	mov edi, [physbaseptr]
  3671 00002B16 668B15[D53A0000]    <1> 	mov dx, [resolutionx]
  3672 00002B1D 668B0D[D33A0000]    <1> 	mov cx, [resolutiony]
  3673 00002B24 66A1[4D2B0000]      <1> 	mov ax, [background]
  3674                              <1> guiclearloop:
  3675 00002B2A 668907              <1> 	mov [edi], ax
  3676 00002B2D 81C702000000        <1> 	add edi, 2
  3677 00002B33 664A                <1> 	dec dx
  3678 00002B35 6681FA0000          <1> 	cmp dx, 0
  3679 00002B3A 77EE                <1> 	ja guiclearloop
  3680 00002B3C 6649                <1> 	dec cx
  3681 00002B3E 668B15[D53A0000]    <1> 	mov dx, [resolutionx]
  3682 00002B45 6681F90000          <1> 	cmp cx, 0
  3683 00002B4A 77DE                <1> 	ja guiclearloop
  3684 00002B4C C3                  <1> 	ret
  3685                              <1> 
  3686 00002B4D CF7B                <1> background dw 0111101111001111b
  3687                              <1> 
  3688                              <1> gui:	;Let's see what I can do, I am going to try to make this as freestanding as possible
  3689 00002B4F B800000000          <1> 	mov eax, 0
  3690 00002B54 BB00000000          <1> 	mov ebx, 0
  3691 00002B59 B900000000          <1> 	mov ecx, 0
  3692 00002B5E BA00000000          <1> 	mov edx, 0
  3693 00002B63 8B3D[B8520000]      <1> 	mov edi, [physbaseptr]
  3694 00002B69 668B15[D53A0000]    <1> 	mov dx, [resolutionx]
  3695 00002B70 668B0D[D33A0000]    <1> 	mov cx, [resolutiony]
  3696 00002B77 668B1D[4D2B0000]    <1> 	mov bx, [background]
  3697                              <1> guiclearloop2:
  3698 00002B7E 66891F              <1> 	mov [edi], bx
  3699 00002B81 81C702000000        <1> 	add edi, 2
  3700 00002B87 664A                <1> 	dec dx
  3701 00002B89 6681FA0000          <1> 	cmp dx, 0
  3702 00002B8E 0F85EAFFFFFF        <1> 	jne near guiclearloop2
  3703 00002B94 6649                <1> 	dec cx
  3704 00002B96 668B15[D53A0000]    <1> 	mov dx, [resolutionx]
  3705 00002B9D 6681F90000          <1> 	cmp cx, 0
  3706 00002BA2 0F85D6FFFFFF        <1> 	jne near guiclearloop2
  3707 00002BA8 C605[A92C0000]01    <1> 	mov byte [guion], 1
  3708 00002BAF C605[A82C0000]00    <1> 	mov byte [mouseselecton], 0
  3709 00002BB6 B800000000          <1> 	mov eax, 0
  3710 00002BBB BB00000000          <1> 	mov ebx, 0
  3711 00002BC0 B900000000          <1> 	mov ecx, 0
  3712 00002BC5 BA00000000          <1> 	mov edx, 0
  3713                              <1> 	
  3714 00002BCA BE[3F3D0000]        <1> 	mov esi, pacmsg
  3715 00002BCF 66B80000            <1> 	mov ax, 0
  3716 00002BD3 BB00000000          <1> 	mov ebx, 0
  3717 00002BD8 66B90200            <1> 	mov cx, 2
  3718 00002BDC 66BA0400            <1> 	mov dx, 4
  3719 00002BE0 E8910A0000          <1> 	call showstring
  3720                              <1> 	
  3721 00002BE5 BE[553E0000]        <1> 	mov esi, interneticon
  3722 00002BEA 66B80000            <1> 	mov ax, 0
  3723 00002BEE BB[B43D0000]        <1> 	mov ebx, noie
  3724 00002BF3 66B91800            <1> 	mov cx, 24
  3725 00002BF7 66BA0400            <1> 	mov dx, 4
  3726 00002BFB E8FA0D0000          <1> 	call showicon
  3727                              <1> 	
  3728 00002C00 BE[D73E0000]        <1> 	mov esi, wordicon
  3729 00002C05 66B80000            <1> 	mov ax, 0
  3730 00002C09 BB00000000          <1> 	mov ebx, 0
  3731 00002C0E 66B91800            <1> 	mov cx, 24
  3732 00002C12 66BA3000            <1> 	mov dx, 48
  3733 00002C16 E8DF0D0000          <1> 	call showicon
  3734                              <1> 	
  3735 00002C1B BE[593F0000]        <1> 	mov esi, pacmanpellet
  3736 00002C20 66B80000            <1> 	mov ax, 0
  3737 00002C24 BB00000000          <1> 	mov ebx, 0
  3738 00002C29 66B94000            <1> 	mov cx, 64
  3739 00002C2D 66BA0400            <1> 	mov dx, 4
  3740 00002C31 E8C40D0000          <1> 	call showicon
  3741                              <1> 	
  3742 00002C36 BE[5D400000]        <1> 	mov esi, pacman
  3743 00002C3B 66B80000            <1> 	mov ax, 0
  3744 00002C3F BB[993D0000]        <1> 	mov ebx, pacmannomnom
  3745 00002C44 66B94000            <1> 	mov cx, 64
  3746 00002C48 66BA3000            <1> 	mov dx, 48
  3747 00002C4C E8A90D0000          <1> 	call showicon
  3748                              <1> 	
  3749 00002C51 BE[DB3F0000]        <1> 	mov esi, ghostie
  3750 00002C56 66B80000            <1> 	mov ax, 0
  3751 00002C5A BB[7E3D0000]        <1> 	mov ebx, boo
  3752 00002C5F 66B96C00            <1> 	mov cx, 108
  3753 00002C63 66BA0400            <1> 	mov dx, 4
  3754 00002C67 E88E0D0000          <1> 	call showicon
  3755                              <1> 
  3756 00002C6C BE[2B3D0000]        <1> 	mov esi, start
  3757 00002C71 668B0D[D33A0000]    <1> 	mov cx, [resolutiony]
  3758 00002C78 6681E91000          <1> 	sub cx, 16
  3759 00002C7D 66BA0200            <1> 	mov dx, 2
  3760 00002C81 B400                <1> 	mov ah, 0
  3761 00002C83 B010                <1> 	mov al, 00010000b
  3762 00002C85 BB[023E0000]        <1> 	mov ebx, winblows
  3763 00002C8A E8E7090000          <1> 	call showstring
  3764                              <1> 	
  3765 00002C8F E89BFBFFFF          <1> 	call cursorgui
  3766                              <1> guistart:
  3767 00002C94 E8A6FAFFFF          <1> 	call guistartin
  3768 00002C99 C605[A22C0000]00    <1> 	mov byte [copygui], 0
  3769 00002CA0 EBF2                <1> 	jmp guistart
  3770                              <1> 	
  3771                              <1> ;guicopy:	;;for double buffering
  3772                              <1> ;	mov byte [copygui], 1
  3773                              <1> ;	mov edi, [offscreenmemoffset]
  3774                              <1> ;	mov edx, 0
  3775                              <1> ;	mov ecx, 0
  3776                              <1> ;	mov dx, [mousecursorposition]
  3777                              <1> ;	mov cx, [mousecursorposition + 2]
  3778                              <1> ;	add edi, edx
  3779                              <1> ;	mov dx, [resolutionx2]
  3780                              <1> ;	inc cx
  3781                              <1> ;guicp2:
  3782                              <1> ;	add edi, edx
  3783                              <1> ;	dec cx
  3784                              <1> ;	cmp cx, 0
  3785                              <1> ;	jne guicp2
  3786                              <1> ;	sub edi, edx
  3787                              <1> ;	mov [cursorloc], edi
  3788                              <1> ;	mov ebx, cursorbmp
  3789                              <1> ;	mov cx, [resolutiony]
  3790                              <1> ;	rol ecx, 16
  3791                              <1> ;	mov cx, [resolutionx]
  3792                              <1> ;	mov esi, [physbaseptr]
  3793                              <1> ;	mov edi, [offscreenmemoffset]
  3794                              <1> ;guicp1:
  3795                              <1> ;	mov ax, [esi]
  3796                              <1> ;	mov [edi], ax
  3797                              <1> ;	add esi, 2
  3798                              <1> ;	add edi, 2
  3799                              <1> ;	cmp edi, [cursorloc]
  3800                              <1> ;	je copycursor
  3801                              <1> ;dncopycursor:
  3802                              <1> ;	dec cx
  3803                              <1> ;	cmp cx, 0
  3804                              <1> ;	jne guicp1
  3805                              <1> ;	mov cx, [resolutionx]
  3806                              <1> ;	rol ecx, 16
  3807                              <1> ;	dec cx
  3808                              <1> ;	cmp cx, 0
  3809                              <1> ;	rol ecx, 16
  3810                              <1> ;	jne guicp1
  3811                              <1> ;	mov byte [copygui], 0
  3812                              <1> ;	ret
  3813                              <1> ;copycursor:
  3814                              <1> ;	cmp ebx, cursorbmpend
  3815                              <1> ;	jae dncopycursor
  3816                              <1> ;	mov dx, [resolutionx2]
  3817                              <1> ;	add edi, edx
  3818                              <1> ;	mov [cursorloc], edi
  3819                              <1> ;	sub edi, edx
  3820                              <1> ;	dec ebx
  3821                              <1> ;	sub edi, 2
  3822                              <1> ;	sub esi, 2
  3823                              <1> ;	mov dx, 9
  3824                              <1> ;curscplp:
  3825                              <1> ;	inc ebx
  3826                              <1> ;	add esi, 2
  3827                              <1> ;	add edi, 2
  3828                              <1> ;	mov ax, [esi]
  3829                              <1> ;	mov [edi], ax
  3830                              <1> ;	mov al, [ebx]
  3831                              <1> ;	cmp al, 0
  3832                              <1> ;	je curscplp2
  3833                              <1> ;	mov word [edi], 1110011110011100b
  3834                              <1> ;curscplp2:
  3835                              <1> ;	dec cx
  3836                              <1> ;	cmp cx, 0
  3837                              <1> ;	je dncopycursor
  3838                              <1> ;	dec dx
  3839                              <1> ;	cmp dx, 0
  3840                              <1> ;	jne curscplp
  3841                              <1> ;	jmp dncopycursor
  3842                              <1> 	
  3843                              <1> 	
  3844                              <1> ;cursorloc: dd 0
  3845                              <1> 		
  3846                              <1> ;nextimage:	
  3847                              <1> ;	call guiclear
  3848                              <1> ;	mov esi, [bmpend]
  3849                              <1> ;	mov eax, 0
  3850                              <1> ;	mov ebx, 0
  3851                              <1> ;	mov ecx, 0
  3852                              <1> ;	mov edx, 0
  3853                              <1> ;	call showbmp
  3854                              <1> ;	jmp guistartin
  3855                              <1> 		
  3856 00002CA2 00                  <1> copygui db 0
  3857 00002CA3 00                  <1> graphicsset db 0
  3858 00002CA4 0000                <1> graphicspos db 0,0
  3859 00002CA6 00                  <1> showcursorfonton db 0
  3860 00002CA7 00                  <1> savefonton db 0
  3861 00002CA8 00                  <1> mouseselecton db 0
  3862 00002CA9 00                  <1> guion db 0
  3863                              <1> 
  3864                              <1> 		
  3865                              <1> clearmousecursor:
  3866 00002CAA BE[4D2B0000]        <1> 		mov esi, background
  3867 00002CAF 8B3D[B8520000]      <1> 		mov edi, [physbaseptr]
  3868 00002CB5 BA00000000          <1> 		mov edx, 0
  3869 00002CBA B900000000          <1> 		mov ecx, 0
  3870 00002CBF 668B15[F6290000]    <1> 		mov dx, [lastmouseposition]
  3871 00002CC6 668B0D[F8290000]    <1> 		mov cx, [lastmouseposition + 2]
  3872 00002CCD 01D7                <1> 		add edi, edx
  3873 00002CCF BA00000000          <1> 		mov edx, 0
  3874 00002CD4 668B15[D73A0000]    <1> 		mov dx, [resolutionx2]
  3875 00002CDB 6681F90000          <1> 		cmp cx, 0
  3876 00002CE0 740B                <1> 		je noyclr
  3877 00002CE2 01D7                <1> yclr:	add edi, edx
  3878 00002CE4 6649                <1> 		dec cx
  3879 00002CE6 6681F90000          <1> 		cmp cx, 0
  3880 00002CEB 75F5                <1> 		jne yclr
  3881 00002CED 668B06              <1> noyclr:	mov ax, [esi]
  3882 00002CF0 C1C010              <1> 		rol eax, 16
  3883 00002CF3 668B06              <1> 		mov ax, [esi]
  3884 00002CF6 8907                <1> 		mov [edi], eax
  3885 00002CF8 894704              <1> 		mov [edi + 4], eax
  3886 00002CFB 894708              <1> 		mov [edi + 8], eax
  3887 00002CFE 89470C              <1> 		mov [edi + 12], eax
  3888 00002D01 01D7                <1> 		add edi, edx
  3889 00002D03 6641                <1> 		inc cx
  3890 00002D05 6681F91000          <1> 		cmp cx, 16
  3891 00002D0A 72E1                <1> 		jb noyclr
  3892 00002D0C C3                  <1> 		ret
  3893                              <1> 
  3894                              <1> switchmousepos:		;;switch were the mouse is located
  3895 00002D0D BE[00120000]        <1> 		mov esi, mousecolorbuf
  3896 00002D12 8B3D[B8520000]      <1> 		mov edi, [physbaseptr]
  3897 00002D18 BA00000000          <1> 		mov edx, 0
  3898 00002D1D B900000000          <1> 		mov ecx, 0
  3899 00002D22 668B15[F6290000]    <1> 		mov dx, [lastmouseposition]
  3900 00002D29 668B0D[F8290000]    <1> 		mov cx, [lastmouseposition + 2]
  3901 00002D30 01D7                <1> 		add edi, edx
  3902 00002D32 BA00000000          <1> 		mov edx, 0
  3903 00002D37 668B15[D73A0000]    <1> 		mov dx, [resolutionx2]
  3904 00002D3E 6681F90000          <1> 		cmp cx, 0
  3905 00002D43 740B                <1> 		je noswmsy
  3906 00002D45 01D7                <1> swmsy:		add edi, edx
  3907 00002D47 6649                <1> 		dec cx
  3908 00002D49 6681F90000          <1> 		cmp cx, 0
  3909 00002D4E 75F5                <1> 		jne swmsy
  3910 00002D50 8B06                <1> noswmsy:	mov eax, [esi]
  3911 00002D52 8B5E04              <1> 		mov ebx, [esi + 4]
  3912 00002D55 8907                <1> 		mov [edi], eax
  3913 00002D57 895F04              <1> 		mov [edi + 4], ebx
  3914 00002D5A 8B4608              <1> 		mov eax, [esi + 8]
  3915 00002D5D 8B5E0C              <1> 		mov ebx, [esi + 12]
  3916 00002D60 894708              <1> 		mov [edi + 8], eax
  3917 00002D63 895F0C              <1> 		mov [edi + 12], ebx
  3918 00002D66 01D7                <1> 		add edi, edx
  3919 00002D68 81C610000000        <1> 		add esi, 16
  3920 00002D6E 81FE[00130000]      <1> 		cmp esi, mcolorend
  3921 00002D74 72DA                <1> 		jb noswmsy
  3922                              <1> 		
  3923                              <1> switchmousepos2:
  3924 00002D76 BE[00120000]        <1> 		mov esi, mousecolorbuf
  3925 00002D7B 8B3D[B8520000]      <1> 		mov edi, [physbaseptr]
  3926 00002D81 BA00000000          <1> 		mov edx, 0
  3927 00002D86 B900000000          <1> 		mov ecx, 0
  3928 00002D8B 668B15[FA290000]    <1> 		mov dx, [mousecursorposition]
  3929 00002D92 668B0D[FC290000]    <1> 		mov cx, [mousecursorposition + 2]
  3930 00002D99 01D7                <1> 		add edi, edx
  3931 00002D9B BA00000000          <1> 		mov edx, 0
  3932 00002DA0 668B15[D73A0000]    <1> 		mov dx, [resolutionx2]
  3933 00002DA7 6681F90000          <1> 		cmp cx, 0
  3934 00002DAC 740B                <1> 		je noswmsy2
  3935 00002DAE 01D7                <1> swmsy2:		add edi, edx
  3936 00002DB0 6649                <1> 		dec cx
  3937 00002DB2 6681F90000          <1> 		cmp cx, 0
  3938 00002DB7 75F5                <1> 		jne swmsy2
  3939 00002DB9 8B07                <1> noswmsy2:	mov eax, [edi]
  3940 00002DBB 8B5F04              <1> 		mov ebx, [edi + 4]
  3941 00002DBE 8906                <1> 		mov [esi], eax
  3942 00002DC0 895E04              <1> 		mov [esi + 4], ebx
  3943 00002DC3 8B4708              <1> 		mov eax, [edi + 8]
  3944 00002DC6 8B5F0C              <1> 		mov ebx, [edi + 12]
  3945 00002DC9 894608              <1> 		mov [esi + 8], eax
  3946 00002DCC 895E0C              <1> 		mov [esi + 12], ebx
  3947 00002DCF 01D7                <1> 		add edi, edx
  3948 00002DD1 81C610000000        <1> 		add esi, 16
  3949 00002DD7 81FE[00130000]      <1> 		cmp esi, mcolorend
  3950 00002DDD 72DA                <1> 		jb noswmsy2
  3951 00002DDF C3                  <1> 		ret
  3952                              <1> 
  3953 00002DE0 00                  <1> pbutton db 0
  3954 00002DE1 00                  <1> pLBUTTON db 0
  3955 00002DE2 00                  <1> pRBUTTON db 0
  3956 00002DE3 00000000            <1> dragging dw 0,0
  3957 00002DE7 0000000000000000    <1> lastpos dw 0,0,0,0
  3958 00002DEF 00000000            <1> colorbuf dw 0,0
  3959                              <1> 	
  3960                              <1> 	clickicon:
  3961 00002DF3 B001                <1> 		mov al, 1
  3962 00002DF5 A2[E02D0000]        <1> 		mov [pbutton], al
  3963 00002DFA A0[E12D0000]        <1> 		mov al, [pLBUTTON]
  3964 00002DFF 2205[39270000]      <1> 		and al, [LBUTTON]
  3965 00002E05 8A25[E22D0000]      <1> 		mov ah, [pRBUTTON]
  3966 00002E0B 2225[3A270000]      <1> 		and ah, [RBUTTON]
  3967 00002E11 08E0                <1> 		or al, ah
  3968 00002E13 3C00                <1> 		cmp al, 0
  3969 00002E15 741B                <1> 		je nodragclick
  3970 00002E17 813D[E32D0000]0100- <1> 		cmp dword [dragging], 1
  3971 00002E1F 0000                <1>
  3972 00002E21 732D                <1> 		jae dragclick
  3973 00002E23 C705[E32D0000]0100- <1> 		mov dword [dragging], 1
  3974 00002E2B 0000                <1>
  3975 00002E2D E91E000000          <1> 		jmp dragclick
  3976                              <1> 	nodragclick:
  3977 00002E32 C705[E32D0000]0000- <1> 		mov dword [dragging], 0
  3978 00002E3A 0000                <1>
  3979 00002E3C A0[39270000]        <1> 		mov al, [LBUTTON]
  3980 00002E41 A2[E12D0000]        <1> 		mov [pLBUTTON], al
  3981 00002E46 A0[3A270000]        <1> 		mov al, [RBUTTON]
  3982 00002E4B A2[E22D0000]        <1> 		mov [pRBUTTON], al
  3983                              <1> 	dragclick:
  3984 00002E50 66B80000            <1> 		mov ax, 0
  3985 00002E54 BE[00100000]        <1> 		mov esi, graphicstable
  3986 00002E59 C705[793D0000]0000- <1> 		mov dword [codepointer], 0
  3987 00002E61 0000                <1>
  3988                              <1> 	clicon2:
  3989 00002E63 BA00000000          <1> 		mov edx, 0
  3990 00002E68 B900000000          <1> 		mov ecx, 0
  3991 00002E6D 66813E0100          <1> 		cmp word [esi], 1
  3992 00002E72 0F841B000000        <1> 		je near iconselect
  3993 00002E78 66813E0200          <1> 		cmp word [esi], 2
  3994 00002E7D 0F8472010000        <1> 		je near textselected
  3995 00002E83 66813E0300          <1> 		cmp word [esi], 3
  3996 00002E88 0F84C7020000        <1> 		je near windowselect
  3997 00002E8E E908040000          <1> 		jmp nexticonsel
  3998                              <1> 	iconselect:
  3999 00002E93 668B5606            <1> 		mov dx, [esi + 6]
  4000 00002E97 6689D0              <1> 		mov ax, dx
  4001 00002E9A 668B4E08            <1> 		mov cx, [esi + 8]
  4002 00002E9E 6689CB              <1> 		mov bx, cx
  4003 00002EA1 6681C32000          <1> 		add bx, 32
  4004 00002EA6 6601D0              <1> 		add ax, dx
  4005 00002EA9 813D[E32D0000]0100- <1> 		cmp dword [dragging], 1
  4006 00002EB1 0000                <1>
  4007 00002EB3 746F                <1> 		je dragicon
  4008 00002EB5 813D[E32D0000]0000- <1> 		cmp dword [dragging], 0
  4009 00002EBD 0000                <1>
  4010 00002EBF 7411                <1> 		je nodragiconcheck
  4011 00002EC1 3935[E32D0000]      <1> 		cmp dword [dragging], esi
  4012 00002EC7 0F85CE030000        <1> 		jne near nexticonsel
  4013 00002ECD E952000000          <1> 		jmp dragicon
  4014                              <1> 	nodragiconcheck:
  4015 00002ED2 663905[FA290000]    <1> 		cmp [mousecursorposition], ax
  4016 00002ED9 0F82BC030000        <1> 		jb near nexticonsel
  4017 00002EDF 66054000            <1> 		add ax, 64
  4018 00002EE3 663905[FA290000]    <1> 		cmp [mousecursorposition], ax
  4019 00002EEA 0F87AB030000        <1> 		ja near nexticonsel
  4020 00002EF0 6629D0              <1> 		sub ax, dx
  4021 00002EF3 66390D[FC290000]    <1> 		cmp [mousecursorposition + 2], cx
  4022 00002EFA 0F829B030000        <1> 		jb near nexticonsel
  4023 00002F00 66391D[FC290000]    <1> 		cmp [mousecursorposition + 2], bx
  4024 00002F07 0F878E030000        <1> 		ja near nexticonsel
  4025 00002F0D 668B460A            <1> 		mov ax, [esi + 10]
  4026 00002F11 66250100            <1> 		and ax, 1
  4027 00002F15 663D0100            <1> 		cmp ax, 1
  4028 00002F19 0F84B6000000        <1> 		je near unselecticon
  4029 00002F1F E98D000000          <1> 		jmp nodragicon
  4030                              <1> 	dragicon:
  4031 00002F24 663905[F6290000]    <1> 		cmp [lastmouseposition], ax
  4032 00002F2B 0F826A030000        <1> 		jb near nexticonsel
  4033 00002F31 66054000            <1> 		add ax, 64
  4034 00002F35 663905[F6290000]    <1> 		cmp [lastmouseposition], ax
  4035 00002F3C 0F8759030000        <1> 		ja near nexticonsel
  4036 00002F42 6629D0              <1> 		sub ax, dx
  4037 00002F45 66390D[F8290000]    <1> 		cmp [lastmouseposition + 2], cx
  4038 00002F4C 0F8249030000        <1> 		jb near nexticonsel
  4039 00002F52 66391D[F8290000]    <1> 		cmp [lastmouseposition + 2], bx
  4040 00002F59 0F873C030000        <1> 		ja near nexticonsel
  4041 00002F5F 668B460A            <1> 		mov ax, [esi + 10]
  4042 00002F63 2410                <1> 		and al, 00010000b
  4043 00002F65 3C10                <1> 		cmp al, 00010000b
  4044 00002F67 7448                <1> 		je nodragicon
  4045 00002F69 8935[E32D0000]      <1> 		mov [dragging], esi
  4046 00002F6F 66D1E2              <1> 		shl dx, 1
  4047 00002F72 662B15[F6290000]    <1> 		sub dx, [lastmouseposition]
  4048 00002F79 660315[FA290000]    <1> 		add dx, [mousecursorposition]
  4049 00002F80 66D1EA              <1> 		shr dx, 1
  4050 00002F83 66030D[FC290000]    <1> 		add cx, [mousecursorposition + 2]
  4051 00002F8A 662B0D[F8290000]    <1> 		sub cx, [lastmouseposition + 2]
  4052 00002F91 663B15[D73A0000]    <1> 		cmp dx, [resolutionx2]
  4053 00002F98 7607                <1> 		jbe chkyresdrgicn
  4054 00002F9A 668B15[FA290000]    <1> 		mov dx, [mousecursorposition]
  4055                              <1> 	chkyresdrgicn:
  4056 00002FA1 663B0D[D33A0000]    <1> 		cmp cx, [resolutiony]
  4057 00002FA8 7607                <1> 		jbe nodragicon
  4058 00002FAA 668B0D[FC290000]    <1> 		mov cx, [mousecursorposition + 2]
  4059                              <1> 	nodragicon:
  4060 00002FB1 66814E0A0100        <1> 		or word [esi + 10], 1
  4061 00002FB7 8B5E0C              <1> 		mov ebx, [esi + 12]
  4062 00002FBA 668B460A            <1> 		mov ax, [esi + 10]
  4063 00002FBE 8B7602              <1> 		mov esi, [esi + 2]
  4064 00002FC1 C705[793D0000]0000- <1> 		mov dword [codepointer], 0
  4065 00002FC9 0000                <1>
  4066 00002FCB E82A0A0000          <1> 		call showicon
  4067 00002FD0 E9DF020000          <1> 		jmp doneiconsel
  4068                              <1> 	unselecticon:
  4069 00002FD5 6681660AFEFF        <1> 		and word [esi + 10], 0xFFFE
  4070 00002FDB 8B5E0C              <1> 		mov ebx, [esi + 12]
  4071 00002FDE 668B460A            <1> 		mov ax, [esi + 10]
  4072 00002FE2 8B7602              <1> 		mov esi, [esi + 2]
  4073 00002FE5 891D[793D0000]      <1> 		mov [codepointer], ebx
  4074 00002FEB E80A0A0000          <1> 		call showicon
  4075 00002FF0 E9BF020000          <1> 		jmp doneiconsel
  4076                              <1> 	textselected:
  4077 00002FF5 8B5E02              <1> 		mov ebx, [esi + 2]
  4078 00002FF8 668B5606            <1> 		mov dx, [esi + 6]
  4079 00002FFC 6689D0              <1> 		mov ax, dx
  4080 00002FFF 668B4E08            <1> 		mov cx, [esi + 8]
  4081                              <1> 	lengthtesttext:
  4082 00003003 803B00              <1> 		cmp byte [ebx], 0
  4083 00003006 7407                <1> 		je donetesttextlength
  4084 00003008 43                  <1> 		inc ebx
  4085 00003009 66051000            <1> 		add ax, 16
  4086 0000300D EBF4                <1> 		jmp lengthtesttext
  4087                              <1> 	donetesttextlength:
  4088 0000300F 6689CB              <1> 		mov bx, cx
  4089 00003012 6681C30F00          <1> 		add bx, 15
  4090 00003017 813D[E32D0000]0100- <1> 		cmp dword [dragging], 1
  4091 0000301F 0000                <1>
  4092 00003021 7468                <1> 		je dragtext
  4093 00003023 813D[E32D0000]0000- <1> 		cmp dword [dragging], 0
  4094 0000302B 0000                <1>
  4095 0000302D 7411                <1> 		je nodragtextcheck
  4096 0000302F 3935[E32D0000]      <1> 		cmp dword [dragging], esi
  4097 00003035 0F8560020000        <1> 		jne near nexticonsel
  4098 0000303B E94B000000          <1> 		jmp dragtext
  4099                              <1> 	nodragtextcheck:
  4100 00003040 663915[FA290000]    <1> 		cmp [mousecursorposition], dx
  4101 00003047 0F824E020000        <1> 		jb near nexticonsel
  4102 0000304D 663905[FA290000]    <1> 		cmp [mousecursorposition], ax
  4103 00003054 0F8741020000        <1> 		ja near nexticonsel
  4104 0000305A 66390D[FC290000]    <1> 		cmp [mousecursorposition + 2], cx
  4105 00003061 0F8234020000        <1> 		jb near nexticonsel
  4106 00003067 66391D[FC290000]    <1> 		cmp [mousecursorposition + 2], bx
  4107 0000306E 0F8727020000        <1> 		ja near nexticonsel
  4108 00003074 668B460A            <1> 		mov ax, [esi + 10]
  4109 00003078 66250100            <1> 		and ax, 1
  4110 0000307C 663D0100            <1> 		cmp ax, 1
  4111 00003080 0F84AB000000        <1> 		je near unselecttext
  4112 00003086 E986000000          <1> 		jmp nodragtext
  4113                              <1> 	dragtext:
  4114 0000308B 663915[F6290000]    <1> 		cmp [lastmouseposition], dx
  4115 00003092 0F8203020000        <1> 		jb near nexticonsel
  4116 00003098 663905[F6290000]    <1> 		cmp [lastmouseposition], ax
  4117 0000309F 0F87F6010000        <1> 		ja near nexticonsel
  4118 000030A5 66390D[F8290000]    <1> 		cmp [lastmouseposition + 2], cx
  4119 000030AC 0F82E9010000        <1> 		jb near nexticonsel
  4120 000030B2 66391D[F8290000]    <1> 		cmp [lastmouseposition + 2], bx
  4121 000030B9 0F87DC010000        <1> 		ja near nexticonsel
  4122 000030BF 668B460A            <1> 		mov ax, [esi + 10]
  4123 000030C3 2410                <1> 		and al, 00010000b
  4124 000030C5 663D1000            <1> 		cmp ax, 00010000b
  4125 000030C9 0F8442000000        <1> 		je near nodragtext
  4126 000030CF 8935[E32D0000]      <1> 		mov [dragging], esi
  4127 000030D5 662B15[F6290000]    <1> 		sub dx, [lastmouseposition]
  4128 000030DC 660315[FA290000]    <1> 		add dx, [mousecursorposition]
  4129 000030E3 66030D[FC290000]    <1> 		add cx, [mousecursorposition + 2]
  4130 000030EA 662B0D[F8290000]    <1> 		sub cx, [lastmouseposition + 2]
  4131 000030F1 663B15[D73A0000]    <1> 		cmp dx, [resolutionx2]
  4132 000030F8 7607                <1> 		jbe chkyresdrgtxt
  4133 000030FA 668B15[FA290000]    <1> 		mov dx, [mousecursorposition]
  4134                              <1> 	chkyresdrgtxt:
  4135 00003101 663B0D[D33A0000]    <1> 		cmp cx, [resolutiony]
  4136 00003108 7607                <1> 		jbe nodragtext
  4137 0000310A 668B0D[FC290000]    <1> 		mov cx, [mousecursorposition + 2]
  4138                              <1> 	nodragtext:
  4139 00003111 66814E0A0100        <1> 		or word [esi + 10], 1
  4140 00003117 8B5E0C              <1> 		mov ebx, [esi + 12]
  4141 0000311A 891D[793D0000]      <1> 		mov [codepointer], ebx
  4142 00003120 668B460A            <1> 		mov ax, [esi + 10]
  4143 00003124 8B7602              <1> 		mov esi, [esi + 2]
  4144 00003127 E84A050000          <1> 		call showstring
  4145 0000312C E983010000          <1> 		jmp doneiconsel
  4146                              <1> 	unselecttext:
  4147 00003131 6681660AFEFF        <1> 		and word [esi + 10], 0xFFFE
  4148 00003137 8B5E0C              <1> 		mov ebx, [esi + 12]
  4149 0000313A 668B460A            <1> 		mov ax, [esi + 10]
  4150 0000313E 8B7602              <1> 		mov esi, [esi + 2]
  4151 00003141 C705[793D0000]0000- <1> 		mov dword [codepointer], 0
  4152 00003149 0000                <1>
  4153 0000314B E826050000          <1> 		call showstring
  4154 00003150 E95F010000          <1> 		jmp doneiconsel
  4155                              <1> windowselect:
  4156 00003155 8B7E02              <1> 		mov edi, [esi + 2]
  4157 00003158 668B5606            <1> 		mov dx, [esi + 6]
  4158 0000315C 6689D0              <1> 		mov ax, dx
  4159 0000315F 668B4E08            <1> 		mov cx, [esi + 8]
  4160 00003163 6689CB              <1> 		mov bx, cx
  4161 00003166 6681C31000          <1> 		add bx, 16
  4162 0000316B 813D[E32D0000]0100- <1> 		cmp dword [dragging], 1
  4163 00003173 0000                <1>
  4164 00003175 746D                <1> 		je dragwin
  4165 00003177 813D[E32D0000]0000- <1> 		cmp dword [dragging], 0
  4166 0000317F 0000                <1>
  4167 00003181 7411                <1> 		je nodragwincheck
  4168 00003183 3935[E32D0000]      <1> 		cmp dword [dragging], esi
  4169 00003189 0F850C010000        <1> 		jne near nexticonsel
  4170 0000318F E950000000          <1> 		jmp dragwin
  4171                              <1> 	nodragwincheck:
  4172 00003194 663905[FA290000]    <1> 		cmp [mousecursorposition], ax
  4173 0000319B 0F82FA000000        <1> 		jb near nexticonsel
  4174 000031A1 660307              <1> 		add ax, [edi]
  4175 000031A4 660307              <1> 		add ax, [edi]
  4176 000031A7 663905[FA290000]    <1> 		cmp [mousecursorposition], ax
  4177 000031AE 0F87E7000000        <1> 		ja near nexticonsel
  4178 000031B4 66390D[FC290000]    <1> 		cmp [mousecursorposition + 2], cx
  4179 000031BB 0F82DA000000        <1> 		jb near nexticonsel
  4180 000031C1 66391D[FC290000]    <1> 		cmp [mousecursorposition + 2], bx
  4181 000031C8 0F87CD000000        <1> 		ja near nexticonsel
  4182 000031CE 662D1400            <1> 		sub ax, 20
  4183 000031D2 663905[FA290000]    <1> 		cmp [mousecursorposition], ax
  4184 000031D9 0F8795000000        <1> 		ja near killwin
  4185 000031DF E97C000000          <1> 		jmp nodragwin
  4186                              <1> 	dragwin:
  4187 000031E4 663905[F6290000]    <1> 		cmp [lastmouseposition], ax
  4188 000031EB 0F82AA000000        <1> 		jb near nexticonsel
  4189 000031F1 660307              <1> 		add ax, [edi]
  4190 000031F4 660307              <1> 		add ax, [edi]
  4191 000031F7 663905[F6290000]    <1> 		cmp [lastmouseposition], ax
  4192 000031FE 0F8797000000        <1> 		ja near nexticonsel
  4193 00003204 66390D[F8290000]    <1> 		cmp [lastmouseposition + 2], cx
  4194 0000320B 0F828A000000        <1> 		jb near nexticonsel
  4195 00003211 66391D[F8290000]    <1> 		cmp [lastmouseposition + 2], bx
  4196 00003218 0F877D000000        <1> 		ja near nexticonsel
  4197 0000321E 8935[E32D0000]      <1> 		mov [dragging], esi
  4198 00003224 662B15[F6290000]    <1> 		sub dx, [lastmouseposition]
  4199 0000322B 660315[FA290000]    <1> 		add dx, [mousecursorposition]
  4200 00003232 66030D[FC290000]    <1> 		add cx, [mousecursorposition + 2]
  4201 00003239 662B0D[F8290000]    <1> 		sub cx, [lastmouseposition + 2]
  4202 00003240 663B15[D73A0000]    <1> 		cmp dx, [resolutionx2]
  4203 00003247 7607                <1> 		jbe chkyresdrgwin
  4204 00003249 668B15[FA290000]    <1> 		mov dx, [mousecursorposition]
  4205                              <1> 	chkyresdrgwin:
  4206 00003250 663B0D[D33A0000]    <1> 		cmp cx, [resolutiony]
  4207 00003257 7607                <1> 		jbe nodragwin
  4208 00003259 668B0D[FC290000]    <1> 		mov cx, [mousecursorposition + 2]
  4209                              <1> 	nodragwin:
  4210 00003260 8B5E0C              <1> 		mov ebx, [esi + 12]
  4211 00003263 668B460A            <1> 		mov ax, [esi + 10]
  4212 00003267 8B7602              <1> 		mov esi, [esi + 2]
  4213 0000326A E85C040000          <1> 		call showwindow
  4214 0000326F E940000000          <1> 		jmp doneiconsel
  4215                              <1> 	killwin:
  4216 00003274 66C7060000          <1> 		mov word [esi], 0
  4217 00003279 C705[62030000]0000- <1> 		mov dword [user2codepoint], 0
  4218 00003281 0000                <1>
  4219 00003283 C605[A3090000]00    <1> 		mov byte [termguion], 0
  4220 0000328A C605[79100000]00    <1> 		mov byte [nwcmdon], 0
  4221 00003291 E87AF8FFFF          <1> 		call guiclear
  4222 00003296 E93A000000          <1> 		jmp doneiconsel2
  4223                              <1> 	nexticonsel:
  4224 0000329B 6681660AFEFF        <1> 		and word [esi + 10], 0xFFFE
  4225 000032A1 81C610000000        <1> 		add esi, 16
  4226 000032A7 81FE[00120000]      <1> 		cmp esi, graphicstableend
  4227 000032AD 7305                <1> 		jae doneiconsel
  4228 000032AF E9AFFBFFFF          <1> 		jmp clicon2
  4229                              <1> 	doneiconsel:
  4230 000032B4 813D[E32D0000]0100- <1> 		cmp dword [dragging], 1
  4231 000032BC 0000                <1>
  4232 000032BE 7315                <1> 		jae doneiconsel2
  4233 000032C0 813D[793D0000]0000- <1> 		cmp dword [codepointer], 0
  4234 000032C8 0000                <1>
  4235 000032CA 7409                <1> 		je doneiconsel2
  4236 000032CC 8B1D[793D0000]      <1> 		mov ebx, [codepointer]
  4237 000032D2 FFD3                <1> 		call ebx 
  4238 000032D4 C3                  <1> 		ret
  4239                              <1> 	doneiconsel2:
  4240 000032D5 A0[39270000]        <1> 		mov al, [LBUTTON]
  4241 000032DA A2[E12D0000]        <1> 		mov [pLBUTTON], al
  4242 000032DF A0[3A270000]        <1> 		mov al, [RBUTTON]
  4243 000032E4 A2[E22D0000]        <1> 		mov [pRBUTTON], al
  4244 000032E9 E8BCF9FFFF          <1> call clearmousecursor
  4245 000032EE E83C000000          <1> call reloadallgraphics
  4246 000032F3 B900000000          <1> 		mov ecx, 0
  4247 000032F8 BA00000000          <1> 		mov edx, 0
  4248 000032FD B400                <1> 		mov ah, 0
  4249 000032FF B080                <1> 		mov al, 128
  4250 00003301 668B15[FA290000]    <1> 		mov dx, [mousecursorposition]
  4251 00003308 668B0D[FC290000]    <1> 		mov cx, [mousecursorposition + 2]
  4252 0000330F 66BBE738            <1> 		mov bx, 0011100011100111b
  4253 00003313 C605[A62C0000]01    <1> 		mov byte [showcursorfonton], 1
  4254 0000331A E8C8070000          <1> 		call showfontvesa
  4255 0000331F C605[A62C0000]00    <1> 		mov byte [showcursorfonton], 0
  4256 00003326 C3                  <1> 		ret
  4257 00003327 00000000            <1> lastdrag dw 0,0
  4258 0000332B 00000000            <1> grpctblpos dw 0,0
  4259                              <1> 
  4260                              <1> reloadallgraphics:
  4261 0000332F BF[00100000]        <1> 		mov edi, graphicstable
  4262                              <1> reloadgraphicsloop:
  4263 00003334 8B7702              <1> 		mov esi, [edi + 2]
  4264 00003337 668B5706            <1> 		mov dx, [edi + 6]
  4265 0000333B 668B4F08            <1> 		mov cx, [edi + 8]
  4266 0000333F 668B07              <1> 		mov ax, [edi]
  4267 00003342 668B5F0A            <1> 		mov bx, [edi + 10]
  4268 00003346 893D[2B330000]      <1> 		mov [grpctblpos], edi
  4269 0000334C 3B3D[E32D0000]      <1> 		cmp edi, [dragging]
  4270 00003352 741E                <1> 		je loadedgraphic
  4271 00003354 663D0100            <1> 		cmp ax, 1
  4272 00003358 0F8431000000        <1> 		je near icongraphic
  4273 0000335E 663D0200            <1> 		cmp ax, 2
  4274 00003362 0F8437000000        <1> 		je near stringgraphic
  4275 00003368 663D0300            <1> 		cmp ax, 3
  4276 0000336C 0F8416000000        <1> 		je near windowgraphic
  4277 00003372 8B3D[2B330000]      <1> loadedgraphic:  mov edi, [grpctblpos]
  4278 00003378 81C710000000        <1> 		add edi, 16
  4279 0000337E 81FF[00120000]      <1> 		cmp edi, graphicstableend
  4280 00003384 7329                <1> 		jae donereloadgraphics
  4281 00003386 EBAC                <1> 		jmp reloadgraphicsloop
  4282 00003388 E891030000          <1> windowgraphic:	call showwindow2
  4283 0000338D EBE3                <1> 		jmp loadedgraphic
  4284 0000338F 80E301              <1> icongraphic:	and bl, 1
  4285 00003392 881D[7D3D0000]      <1> 		mov [iconselected], bl
  4286 00003398 E870060000          <1> 		call showicon2
  4287 0000339D EBD3                <1> 		jmp loadedgraphic
  4288 0000339F 80E301              <1> stringgraphic:  and bl, 1
  4289 000033A2 881D[A82C0000]      <1> 		mov [mouseselecton], bl
  4290 000033A8 E8DC020000          <1> 		call showstring2
  4291 000033AD EBC3                <1> 		jmp loadedgraphic
  4292                              <1> donereloadgraphics:
  4293 000033AF 8B3D[E32D0000]      <1> 		mov edi, [dragging]
  4294 000033B5 81FF[00100000]      <1> 		cmp edi, graphicstable
  4295 000033BB 7226                <1> 		jb notcorrectdrag
  4296 000033BD 668B07              <1> 		mov ax, [edi]
  4297 000033C0 8B7702              <1> 		mov esi, [edi + 2]
  4298 000033C3 668B5706            <1> 		mov dx, [edi + 6]
  4299 000033C7 668B4F08            <1> 		mov cx, [edi + 8]
  4300 000033CB 668B5F0A            <1> 		mov bx, [edi + 10]
  4301 000033CF 663D0100            <1> 		cmp ax, 1
  4302 000033D3 750F                <1> 		jne noticondragging
  4303 000033D5 80E301              <1> 		and bl, 1
  4304 000033D8 881D[7D3D0000]      <1> 		mov [iconselected], bl
  4305 000033DE E82A060000          <1> 		call showicon2
  4306                              <1> notcorrectdrag:
  4307 000033E3 C3                  <1> 		ret
  4308                              <1> 
  4309                              <1> 	noticondragging:
  4310 000033E4 663D0200            <1> 		cmp ax, 2
  4311 000033E8 75F9                <1> 		jne notcorrectdrag
  4312 000033EA 80E301              <1> 		and bl, 1
  4313 000033ED 881D[A82C0000]      <1> 		mov [mouseselecton], bl
  4314 000033F3 E891020000          <1> 		call showstring2
  4315 000033F8 EBE9                <1> 		jmp notcorrectdrag
  4316                              <1> 
  4317 000033FA 00<rept>            <1> grphbuf times 16 db 0
  4318                              <1> 	graphicsadd:
  4319 0000340A BF[00100000]        <1> 		mov edi, graphicstable
  4320                              <1> 	shwgrph1:
  4321 0000340F 397702              <1> 		cmp dword [edi + 2], esi
  4322 00003412 7414                <1> 		je showgraphicsreplace2
  4323 00003414 81C710000000        <1> 		add edi, 16
  4324 0000341A 81FF[00120000]      <1> 		cmp edi, graphicstableend
  4325 00003420 0F8335020000        <1> 		jae near showgraphicsnew
  4326 00003426 EBE7                <1> 		jmp shwgrph1
  4327                              <1> 	showgraphicsreplace2:
  4328 00003428 8935[FC330000]      <1> 		mov [grphbuf + 2], esi
  4329 0000342E 668915[00340000]    <1> 		mov [grphbuf + 6], dx
  4330 00003435 66890D[02340000]    <1> 		mov [grphbuf + 8], cx
  4331 0000343C 891D[06340000]      <1> 		mov [grphbuf + 12], ebx
  4332 00003442 B700                <1> 		mov bh, 0
  4333 00003444 88E3                <1> 		mov bl, ah
  4334 00003446 B400                <1> 		mov ah, 0
  4335 00003448 66A3[04340000]      <1> 		mov [grphbuf + 10], ax	
  4336 0000344E 66891D[FA330000]    <1> 		mov [grphbuf], bx
  4337 00003455 66A1[FA330000]      <1> 		mov ax, [grphbuf]
  4338 0000345B 663D0100            <1> 		cmp ax, 1
  4339 0000345F 0F8419000000        <1> 		je near replaceicon
  4340 00003465 663D0200            <1> 		cmp ax, 2
  4341 00003469 0F8493000000        <1> 		je near replacestring
  4342 0000346F 663D0300            <1> 		cmp ax, 3
  4343 00003473 0F840F010000        <1> 		je near replacewindow
  4344 00003479 E9BA010000          <1> 		jmp showgraphicsreplace
  4345                              <1> 	replaceicon:
  4346 0000347E 893D[E72D0000]      <1> 		mov [lastpos], edi
  4347 00003484 8935[EB2D0000]      <1> 		mov [lastpos + 4], esi
  4348 0000348A 8B7702              <1> 		mov esi, [edi + 2]
  4349 0000348D 668B5F0C            <1> 		mov bx, [edi + 12]
  4350 00003491 668B5706            <1> 		mov dx, [edi + 6]
  4351 00003495 668B4F08            <1> 		mov cx, [edi + 8]
  4352 00003499 668B06              <1> 		mov ax, [esi]
  4353 0000349C 66A3[EF2D0000]      <1> 		mov [colorbuf], ax
  4354 000034A2 66A1[4D2B0000]      <1> 		mov ax, [background]
  4355 000034A8 668906              <1> 		mov [esi], ax
  4356 000034AB 8B5F0C              <1> 		mov ebx, [edi + 12]
  4357 000034AE 668B470A            <1> 		mov ax, [edi + 10]
  4358 000034B2 2401                <1> 		and al, 1
  4359 000034B4 A2[7D3D0000]        <1> 		mov [iconselected], al
  4360 000034B9 668B470A            <1> 		mov ax, [edi + 10]
  4361 000034BD E84B050000          <1> 		call showicon2
  4362 000034C2 8B3D[E72D0000]      <1> 		mov edi, [lastpos]
  4363 000034C8 8B7702              <1> 		mov esi, [edi + 2]
  4364 000034CB 66A1[EF2D0000]      <1> 		mov ax, [colorbuf]
  4365 000034D1 668906              <1> 		mov [esi], ax
  4366 000034D4 8B35[EB2D0000]      <1> 		mov esi, [lastpos + 4]
  4367 000034DA 668B15[00340000]    <1> 		mov dx, [grphbuf + 6]
  4368 000034E1 668B0D[02340000]    <1> 		mov cx, [grphbuf + 8]
  4369 000034E8 668B1D[FA330000]    <1> 		mov bx, [grphbuf]
  4370 000034EF 66A1[04340000]      <1> 		mov ax, [grphbuf + 10]
  4371 000034F5 88DC                <1> 		mov ah, bl
  4372 000034F7 8B1D[06340000]      <1> 		mov ebx, [grphbuf + 12]
  4373 000034FD E936010000          <1> 		jmp showgraphicsreplace
  4374                              <1> 	replacestring:
  4375 00003502 893D[E72D0000]      <1> 		mov [lastpos], edi
  4376 00003508 8935[EB2D0000]      <1> 		mov [lastpos + 4], esi
  4377 0000350E 8B5F0C              <1> 		mov ebx, [edi + 12]
  4378 00003511 8B7702              <1> 		mov esi, [edi + 2]
  4379 00003514 668B5706            <1> 		mov dx, [edi + 6]
  4380 00003518 668B4F08            <1> 		mov cx, [edi + 8]
  4381 0000351C 66A1[B9360000]      <1> 		mov ax, [colorfont2]
  4382 00003522 66A3[EF2D0000]      <1> 		mov [colorbuf], ax
  4383 00003528 66A1[4D2B0000]      <1> 		mov ax, [background]
  4384 0000352E 66A3[B9360000]      <1> 		mov [colorfont2], ax		
  4385 00003534 8B5F0C              <1> 		mov ebx, [edi + 12]
  4386 00003537 668B470A            <1> 		mov ax, [edi + 10]
  4387 0000353B 2401                <1> 		and al, 1
  4388 0000353D A2[A82C0000]        <1> 		mov [mouseselecton], al
  4389 00003542 668B470A            <1> 		mov ax, [edi + 10]
  4390 00003546 E83E010000          <1> 		call showstring2
  4391 0000354B 66A1[EF2D0000]      <1> 		mov ax, [colorbuf]
  4392 00003551 66A3[B9360000]      <1> 		mov [colorfont2], ax
  4393 00003557 8B3D[E72D0000]      <1> 		mov edi, [lastpos]
  4394 0000355D 8B7702              <1> 		mov esi, [edi + 2]
  4395 00003560 668B15[00340000]    <1> 		mov dx, [grphbuf + 6]
  4396 00003567 668B0D[02340000]    <1> 		mov cx, [grphbuf + 8]
  4397 0000356E 668B1D[FA330000]    <1> 		mov bx, [grphbuf]
  4398 00003575 66A1[04340000]      <1> 		mov ax, [grphbuf + 10]
  4399 0000357B 88DC                <1> 		mov ah, bl
  4400 0000357D 8B1D[06340000]      <1> 		mov ebx, [grphbuf + 12]
  4401 00003583 E9B0000000          <1> 		jmp showgraphicsreplace
  4402                              <1> 	replacewindow:
  4403 00003588 893D[E72D0000]      <1> 		mov [lastpos], edi
  4404 0000358E 8935[EB2D0000]      <1> 		mov [lastpos + 4], esi
  4405 00003594 8B7702              <1> 		mov esi, [edi + 2]
  4406 00003597 8B3D[C7360000]      <1> 		mov edi, [windowbufloc]
  4407 0000359D BA00000000          <1> 		mov edx, 0
  4408 000035A2 668B15[D73A0000]    <1> 		mov dx, [resolutionx2]
  4409 000035A9 C1E204              <1> 		shl edx, 4
  4410 000035AC 29D7                <1> 		sub edi, edx
  4411 000035AE BA00000000          <1> 		mov edx, 0
  4412 000035B3 668B16              <1> 		mov dx, [esi]
  4413 000035B6 660316              <1> 		add dx, [esi]
  4414 000035B9 668B4E02            <1> 		mov cx, [esi + 2]
  4415 000035BD 6681C11000          <1> 		add cx, 16
  4416 000035C2 66A1[4D2B0000]      <1> 		mov ax, [background]
  4417                              <1> 	clearwindow:
  4418 000035C8 668907              <1> 		mov [edi], ax
  4419 000035CB 81C702000000        <1> 		add edi, 2
  4420 000035D1 81EA02000000        <1> 		sub edx, 2
  4421 000035D7 81FA00000000        <1> 		cmp edx, 0
  4422 000035DD 75E9                <1> 		jne clearwindow
  4423 000035DF 6649                <1> 		dec cx
  4424 000035E1 668B15[D73A0000]    <1> 		mov dx, [resolutionx2]
  4425 000035E8 662B16              <1> 		sub dx, [esi]
  4426 000035EB 662B16              <1> 		sub dx, [esi]
  4427 000035EE 01D7                <1> 		add edi, edx
  4428 000035F0 668B16              <1> 		mov dx, [esi]
  4429 000035F3 660316              <1> 		add dx, [esi]
  4430 000035F6 6681F90000          <1> 		cmp cx, 0
  4431 000035FB 75CB                <1> 		jne clearwindow
  4432 000035FD C605[A4090000]00    <1> 		mov byte [termcopyon], 0
  4433 00003604 8B3D[E72D0000]      <1> 		mov edi, [lastpos]
  4434 0000360A 8B35[FC330000]      <1> 		mov esi, [grphbuf + 2]
  4435 00003610 668B15[00340000]    <1> 		mov dx, [grphbuf + 6]
  4436 00003617 668B0D[02340000]    <1> 		mov cx, [grphbuf + 8]
  4437 0000361E 668B1D[FA330000]    <1> 		mov bx, [grphbuf]
  4438 00003625 66A1[04340000]      <1> 		mov ax, [grphbuf + 10]
  4439 0000362B 88DC                <1> 		mov ah, bl
  4440 0000362D 8B1D[06340000]      <1> 		mov ebx, [grphbuf + 12]
  4441 00003633 E900000000          <1> 		jmp showgraphicsreplace
  4442                              <1> 	showgraphicsreplace:
  4443 00003638 897702              <1> 		mov [edi + 2], esi
  4444 0000363B 66895706            <1> 		mov [edi + 6], dx
  4445 0000363F 66894F08            <1> 		mov [edi + 8], cx
  4446 00003643 895F0C              <1> 		mov [edi + 12], ebx
  4447 00003646 B700                <1> 		mov bh, 0
  4448 00003648 88E3                <1> 		mov bl, ah
  4449 0000364A B400                <1> 		mov ah, 0
  4450 0000364C 6689470A            <1> 		mov [edi + 10], ax
  4451 00003650 66891F              <1> 		mov [edi], bx
  4452 00003653 8B5F0C              <1> 		mov ebx, [edi + 12]
  4453 00003656 668B470A            <1> 		mov ax, [edi + 10]
  4454 0000365A C3                  <1> 		ret
  4455                              <1> 	showgraphicsnew:
  4456 0000365B BF[00100000]        <1> 		mov edi, graphicstable
  4457                              <1> 	shwgrph2:
  4458 00003660 66813F0000          <1> 		cmp word [edi], 0
  4459 00003665 74D1                <1> 		je showgraphicsreplace
  4460 00003667 81C710000000        <1> 		add edi, 16
  4461 0000366D 81FF[00120000]      <1> 		cmp edi, graphicstableend
  4462 00003673 72EB                <1> 		jb shwgrph2
  4463                              <1> 	showgraphicsdone:
  4464 00003675 C3                  <1> 		ret
  4465                              <1> 
  4466                              <1> 	showstring:
  4467 00003676 A2[A82C0000]        <1> 		mov [mouseselecton], al
  4468 0000367B 8025[A82C0000]01    <1> 		and byte [mouseselecton], 1
  4469 00003682 B402                <1> 		mov ah, 2
  4470 00003684 E881FDFFFF          <1> 		call graphicsadd
  4471                              <1> 	showstring2:
  4472 00003689 B400                <1> 		mov ah, 0
  4473 0000368B 8A06                <1> 		mov al, [esi]
  4474 0000368D 3C00                <1> 		cmp al, 0
  4475 0000368F 7420                <1> 		je doneshowstring
  4476 00003691 46                  <1> 		inc esi
  4477 00003692 8935[263D0000]      <1> 		mov [showstringesi], esi
  4478 00003698 668B1D[B9360000]    <1> 		mov bx, [colorfont2]
  4479 0000369F E843040000          <1> 		call showfontvesa
  4480 000036A4 6681C20800          <1> 		add dx, 8
  4481 000036A9 8B35[263D0000]      <1> 		mov esi, [showstringesi]
  4482 000036AF EBD8                <1> 		jmp showstring2
  4483                              <1> 	doneshowstring:
  4484 000036B1 C605[A82C0000]00    <1> 		mov byte [mouseselecton], 0
  4485 000036B8 C3                  <1> 		ret
  4486                              <1> 
  4487 000036B9 FFFF                <1> colorfont2 dw 0xFFFF
  4488 000036BB 0000                <1> winvcopystx dw 0
  4489 000036BD 0000                <1> winvcopysty dw 0
  4490 000036BF 0000                <1> winvcopydx dw 0
  4491 000036C1 0000                <1> winvcopycx dw 0
  4492 000036C3 FFFF0000            <1> windowcolor dw 0xFFFF,0x0
  4493 000036C7 00000000            <1> windowbufloc: dw 0,0
  4494                              <1> 
  4495                              <1> 	showwindow:	;;windowstuff in si, position in (dx, cx), nothing in ax, code in bx
  4496 000036CB C605[A3090000]01    <1> 		mov byte [termguion], 1
  4497 000036D2 6681C11000          <1> 		add cx, 16
  4498 000036D7 668915[BB360000]    <1> 		mov [winvcopystx], dx
  4499 000036DE 66890D[BD360000]    <1> 		mov [winvcopysty], cx
  4500 000036E5 668B16              <1> 		mov dx, [esi]
  4501 000036E8 668B4E02            <1> 		mov cx, [esi + 2]
  4502 000036EC 6601D2              <1> 		add dx, dx
  4503 000036EF 668915[BF360000]    <1> 		mov [winvcopydx], dx
  4504 000036F6 66890D[C1360000]    <1> 		mov [winvcopycx], cx
  4505 000036FD 668B0D[BD360000]    <1> 		mov cx, [winvcopysty]
  4506 00003704 6681E91000          <1> 		sub cx, 16
  4507 00003709 668B15[BB360000]    <1> 		mov dx, [winvcopystx]
  4508 00003710 C605[A4090000]00    <1> 		mov byte [termcopyon], 0
  4509 00003717 B403                <1> 		mov ah, 3
  4510 00003719 E8ECFCFFFF          <1> 		call graphicsadd
  4511                              <1> 	showwindow2:
  4512 0000371E 6681C11000          <1> 		add cx, 16
  4513 00003723 668915[BB360000]    <1> 		mov [winvcopystx], dx
  4514 0000372A 66890D[BD360000]    <1> 		mov [winvcopysty], cx
  4515 00003731 668B16              <1> 		mov dx, [esi]
  4516 00003734 668B4E02            <1> 		mov cx, [esi + 2]
  4517 00003738 6601D2              <1> 		add dx, dx
  4518 0000373B 668915[BF360000]    <1> 		mov [winvcopydx], dx
  4519 00003742 66890D[C1360000]    <1> 		mov [winvcopycx], cx
  4520 00003749 8B3D[C7360000]      <1> 		mov edi, [windowbufloc]
  4521 0000374F BA00000000          <1> 		mov edx, 0
  4522 00003754 668B15[D73A0000]    <1> 		mov dx, [resolutionx2]
  4523 0000375B C1E204              <1> 		shl edx, 4
  4524 0000375E 29D7                <1> 		sub edi, edx
  4525 00003760 803D[A4090000]00    <1> 		cmp byte [termcopyon], 0
  4526 00003767 753E                <1> 		jne nocleartitlebarpos
  4527 00003769 8B3D[B8520000]      <1> 		mov edi, [physbaseptr]
  4528 0000376F BA00000000          <1> 		mov edx, 0
  4529 00003774 668B15[BB360000]    <1> 		mov dx, [winvcopystx]
  4530 0000377B 01D7                <1> 		add edi, edx
  4531 0000377D 668B0D[BD360000]    <1> 		mov cx, [winvcopysty]
  4532 00003784 6681E91000          <1> 		sub cx, 16
  4533 00003789 6681F90000          <1> 		cmp cx, 0
  4534 0000378E 7417                <1> 		je nocleartitlebarpos
  4535                              <1> 	cleartitlebarpos:
  4536 00003790 BA00000000          <1> 		mov edx, 0
  4537 00003795 668B15[D73A0000]    <1> 		mov dx, [resolutionx2]
  4538 0000379C 01D7                <1> 		add edi, edx
  4539 0000379E 6649                <1> 		dec cx
  4540 000037A0 6681F90000          <1> 		cmp cx, 0
  4541 000037A5 75E9                <1> 		jne cleartitlebarpos
  4542                              <1> 	nocleartitlebarpos:
  4543 000037A7 66B91000            <1> 		mov cx, 16
  4544 000037AB 668B15[BF360000]    <1> 		mov dx, [winvcopydx]
  4545 000037B2 6681F90000          <1> 		cmp cx, 0
  4546 000037B7 0F844B000000        <1> 		je near canceltitlebarput
  4547 000037BD 6681FA0000          <1> 		cmp dx, 0
  4548 000037C2 0F8440000000        <1> 		je near canceltitlebarput
  4549                              <1> 	titlebarput:
  4550 000037C8 66A1[C3360000]      <1> 		mov ax, [windowcolor]
  4551 000037CE 668907              <1> 		mov [edi], ax
  4552 000037D1 6681EA0200          <1> 		sub dx, 2
  4553 000037D6 81C702000000        <1> 		add edi, 2
  4554 000037DC 6681FA0000          <1> 		cmp dx, 0
  4555 000037E1 75E5                <1> 		jne titlebarput
  4556 000037E3 BA00000000          <1> 		mov edx, 0
  4557 000037E8 668B15[D73A0000]    <1> 		mov dx, [resolutionx2]
  4558 000037EF 6649                <1> 		dec cx
  4559 000037F1 662B15[BF360000]    <1> 		sub dx, [winvcopydx]
  4560 000037F8 01D7                <1> 		add edi, edx
  4561 000037FA 668B15[BF360000]    <1> 		mov dx, [winvcopydx]
  4562 00003801 6681F90000          <1> 		cmp cx, 0
  4563 00003806 75C0                <1> 		jne titlebarput
  4564                              <1> 	canceltitlebarput:
  4565 00003808 893D[C7360000]      <1> 		mov [windowbufloc], edi
  4566 0000380E 803D[A4090000]02    <1> 		cmp byte [termcopyon], 2
  4567 00003815 0F8463000000        <1> 		je near winvcpst
  4568 0000381B 66B80000            <1> 		mov ax, 0
  4569 0000381F 81C604000000        <1> 		add esi, 4
  4570 00003825 668B15[BB360000]    <1> 		mov dx, [winvcopystx]
  4571 0000382C 668B0D[BD360000]    <1> 		mov cx, [winvcopysty]
  4572 00003833 6681E91000          <1> 		sub cx, 16
  4573 00003838 66BB0000            <1> 		mov bx, 0
  4574 0000383C C605[A82C0000]01    <1> 		mov byte [mouseselecton], 1
  4575 00003843 E841FEFFFF          <1> 		call showstring2
  4576 00003848 B058                <1> 		mov al, "X"
  4577 0000384A B400                <1> 		mov ah, 0
  4578 0000384C 668B1D[B9360000]    <1> 		mov bx, [colorfont2]
  4579 00003853 668B15[BB360000]    <1> 		mov dx, [winvcopystx]
  4580 0000385A 668B0D[BD360000]    <1> 		mov cx, [winvcopysty]
  4581 00003861 6681E91000          <1> 		sub cx, 16
  4582 00003866 6681EA1400          <1> 		sub dx, 20
  4583 0000386B 660315[BF360000]    <1> 		add dx, [winvcopydx]
  4584 00003872 C605[A82C0000]01    <1> 		mov byte [mouseselecton], 1
  4585 00003879 E869020000          <1> 		call showfontvesa
  4586                              <1> 	winvcpst:
  4587 0000387E 8B3D[C7360000]      <1> 		mov edi, [windowbufloc]
  4588 00003884 E957000000          <1> 		jmp windowvideocopyset
  4589                              <1> 
  4590                              <1> 	windowvideocopy:
  4591 00003889 8B3D[C7360000]      <1> 		mov edi, [windowbufloc]
  4592 0000388F 3B3D[B8520000]      <1> 		cmp edi, [physbaseptr]
  4593 00003895 0F8345000000        <1> 		jae near windowvideocopyset
  4594 0000389B B900000000          <1> 		mov ecx, 0
  4595 000038A0 BA00000000          <1> 		mov edx, 0
  4596 000038A5 668B15[BB360000]    <1> 		mov dx, [winvcopystx]
  4597 000038AC 668B0D[BD360000]    <1> 		mov cx, [winvcopysty]
  4598 000038B3 8B3D[B8520000]      <1> 		mov edi, [physbaseptr]
  4599 000038B9 01D7                <1> 		add edi, edx
  4600 000038BB 81F900000000        <1> 		cmp ecx, 0
  4601 000038C1 741D                <1> 		je windowvideocopyset
  4602                              <1> 	yrescopylp:
  4603 000038C3 BA00000000          <1> 		mov edx, 0
  4604 000038C8 668B15[D73A0000]    <1> 		mov dx, [resolutionx2]
  4605 000038CF 01D7                <1> 		add edi, edx
  4606 000038D1 6649                <1> 		dec cx
  4607 000038D3 6681F90000          <1> 		cmp cx, 0
  4608 000038D8 75E9                <1> 		jne yrescopylp
  4609 000038DA 893D[C7360000]      <1> 		mov [windowbufloc], edi
  4610                              <1> 	windowvideocopyset:
  4611 000038E0 66B90000            <1> 		mov cx, 0
  4612 000038E4 66890D[F2390000]    <1> 		mov [charposline], cx
  4613 000038EB BE[851E0000]        <1> 		mov esi, videobuf2
  4614 000038F0 8935[F4390000]      <1> 		mov [charposvbuf], esi
  4615 000038F6 8A1E                <1> 		mov bl, [esi]
  4616 000038F8 B700                <1> 		mov bh, 0
  4617 000038FA 66C1E304            <1> 		shl bx, 4
  4618 000038FE 678AB7[7048]        <1> 		mov dh, [fonts + bx]
  4619 00003903 D0CE                <1> 		ror dh, 1
  4620 00003905 89FE                <1> 		mov esi, edi
  4621                              <1> 	copywindow:
  4622 00003907 B201                <1> 		mov dl, 1
  4623 00003909 D0C6                <1> 		rol dh, 1
  4624 0000390B 20F2                <1> 		and dl, dh
  4625 0000390D 66A1[C5360000]      <1> 		mov ax, [windowcolor + 2]
  4626 00003913 668907              <1> 		mov [edi], ax
  4627 00003916 80FA00              <1> 		cmp dl, 0
  4628 00003919 7409                <1> 		je nowritewin
  4629 0000391B 66A1[C3360000]      <1> 		mov ax, [windowcolor]
  4630 00003921 668907              <1> 		mov [edi], ax
  4631                              <1> 	nowritewin:
  4632 00003924 81C702000000        <1> 		add edi, 2
  4633 0000392A FEC1                <1> 		inc cl
  4634 0000392C 80F908              <1> 		cmp cl, 8
  4635 0000392F 75D6                <1> 		jne copywindow
  4636 00003931 6643                <1> 		inc bx
  4637 00003933 B100                <1> 		mov cl, 0
  4638 00003935 BA00000000          <1> 		mov edx, 0
  4639 0000393A 668B15[D73A0000]    <1> 		mov dx, [resolutionx2]
  4640 00003941 01D6                <1> 		add esi, edx
  4641 00003943 89F7                <1> 		mov edi, esi
  4642 00003945 678AB7[7048]        <1> 		mov dh, [fonts + bx]
  4643 0000394A D0CE                <1> 		ror dh, 1
  4644 0000394C FEC5                <1> 		inc ch
  4645 0000394E 80FD10              <1> 		cmp ch, 16
  4646 00003951 75B4                <1> 		jne copywindow
  4647 00003953 66B90000            <1> 		mov cx, 0
  4648 00003957 8B3D[F4390000]      <1> 		mov edi, [charposvbuf]
  4649 0000395D 81C702000000        <1> 		add edi, 2
  4650 00003963 81FF[45310000]      <1> 		cmp edi, videobufend
  4651 00003969 7370                <1> 		jae donewincopynow
  4652 0000396B 8A1F                <1> 		mov bl, [edi]
  4653 0000396D B700                <1> 		mov bh, 0
  4654 0000396F 66C1E304            <1> 		shl bx, 4
  4655 00003973 893D[F4390000]      <1> 		mov [charposvbuf], edi
  4656 00003979 BA00000000          <1> 		mov edx, 0
  4657 0000397E 668B15[D73A0000]    <1> 		mov dx, [resolutionx2]
  4658 00003985 C1E204              <1> 		shl edx, 4
  4659 00003988 29D6                <1> 		sub esi, edx
  4660 0000398A 81C610000000        <1> 		add esi, 16
  4661 00003990 89F7                <1> 		mov edi, esi
  4662 00003992 668B0D[F2390000]    <1> 		mov cx, [charposline]
  4663 00003999 6641                <1> 		inc cx
  4664 0000399B 6681F95000          <1> 		cmp cx, 80
  4665 000039A0 7317                <1> 		jae fixwindowcopy
  4666 000039A2 66890D[F2390000]    <1> 		mov [charposline], cx
  4667 000039A9 66B90000            <1> 		mov cx, 0
  4668 000039AD 678AB7[7048]        <1> 		mov dh, [fonts + bx]
  4669 000039B2 D0CE                <1> 		ror dh, 1
  4670 000039B4 E94EFFFFFF          <1> 		jmp copywindow
  4671                              <1> fixwindowcopy:
  4672 000039B9 66B90000            <1> 		mov cx, 0
  4673 000039BD 66890D[F2390000]    <1> 		mov [charposline], cx
  4674 000039C4 662B15[BF360000]    <1> 		sub dx, [winvcopydx]
  4675 000039CB 01D6                <1> 		add esi, edx
  4676 000039CD 89F7                <1> 		mov edi, esi
  4677 000039CF 678AB7[7048]        <1> 		mov dh, [fonts + bx]
  4678 000039D4 D0CE                <1> 		ror dh, 1
  4679 000039D6 E92CFFFFFF          <1> 		jmp copywindow
  4680                              <1> donewincopynow:
  4681 000039DB E886D5FFFF          <1> 		call switchtermcursor
  4682 000039E0 803D[A4090000]01    <1> 		cmp byte [termcopyon], 1
  4683 000039E7 7501                <1> 		jne forgetresetstuff
  4684 000039E9 61                  <1> 		popa
  4685                              <1> forgetresetstuff:
  4686 000039EA C605[A4090000]00    <1> 		mov byte [termcopyon], 0
  4687 000039F1 C3                  <1> 		ret
  4688                              <1> 
  4689 000039F2 0000                <1> charposline dw 0
  4690 000039F4 00000000            <1> charposvbuf dw 0,0
  4691 000039F8 0000                <1> iconcolor dw 0
  4692                              <1> 	showicon:	;;icon in si, position in (dx,cx), selected in ax, code in bx
  4693 000039FA A2[7D3D0000]        <1> 		mov [iconselected], al
  4694 000039FF 8025[7D3D0000]01    <1> 		and byte [iconselected], 1
  4695 00003A06 B401                <1> 		mov ah, 1
  4696 00003A08 E8FDF9FFFF          <1> 		call graphicsadd
  4697                              <1> 	showicon2:
  4698 00003A0D 8B3D[B8520000]      <1> 		mov edi, [physbaseptr]
  4699 00003A13 6601D2              <1> 		add dx, dx
  4700 00003A16 663B15[D73A0000]    <1> 		cmp dx, [resolutionx2]
  4701 00003A1D 720C                <1> 		jb screenxgood
  4702 00003A1F 668B15[D73A0000]    <1> 		mov dx, [resolutionx2]
  4703 00003A26 6681EA4000          <1> 		sub dx, 64
  4704                              <1> 	screenxgood:
  4705 00003A2B 6681F90000          <1> 		cmp cx, 0
  4706 00003A30 7425                <1> 		je noscreenygoodchk
  4707 00003A32 663B0D[D33A0000]    <1> 		cmp cx, [resolutiony]
  4708 00003A39 720C                <1> 		jb screenygood
  4709 00003A3B 668B0D[D33A0000]    <1> 		mov cx, [resolutiony]
  4710 00003A42 6681E92000          <1> 		sub cx, 32
  4711                              <1> 	screenygood:
  4712 00003A47 BB00000000          <1> 		mov ebx, 0
  4713 00003A4C 668B1D[D73A0000]    <1> 		mov bx, [resolutionx2]
  4714 00003A53 01DF                <1> 		add edi, ebx
  4715 00003A55 E2F0                <1> 		loop screenygood
  4716                              <1> 	noscreenygoodchk:
  4717 00003A57 BB00000000          <1> 		mov ebx, 0
  4718 00003A5C 6689D3              <1> 		mov bx, dx
  4719 00003A5F 01DF                <1> 		add edi, ebx
  4720 00003A61 66B90000            <1> 		mov cx, 0
  4721 00003A65 668B06              <1> 		mov ax, [esi]
  4722 00003A68 81C602000000        <1> 		add esi, 2
  4723 00003A6E 66A3[F8390000]      <1> 		mov [iconcolor], ax
  4724                              <1> 	writeicon:
  4725 00003A74 8B06                <1> 		mov eax, [esi]
  4726 00003A76 D1C0                <1> 		rol eax, 1
  4727 00003A78 B100                <1> 		mov cl, 0
  4728                              <1> 	writeiconline:
  4729 00003A7A B201                <1> 		mov dl, 1
  4730 00003A7C 20C2                <1> 		and dl, al
  4731 00003A7E 3215[7D3D0000]      <1> 		xor dl, [iconselected]
  4732 00003A84 668B1D[4D2B0000]    <1> 		mov bx, [background]
  4733 00003A8B 66891F              <1> 		mov [edi], bx
  4734 00003A8E 80FA00              <1> 		cmp dl, 0
  4735 00003A91 740A                <1> 		je noiconline
  4736 00003A93 668B15[F8390000]    <1> 		mov dx, [iconcolor]
  4737 00003A9A 668917              <1> 		mov [edi], dx
  4738                              <1> 	noiconline:
  4739 00003A9D 81C702000000        <1> 		add edi, 2
  4740 00003AA3 D1C0                <1> 		rol eax, 1
  4741 00003AA5 FEC1                <1> 		inc cl
  4742 00003AA7 80F920              <1> 		cmp cl, 32
  4743 00003AAA 72CE                <1> 		jb writeiconline
  4744 00003AAC 81C604000000        <1> 		add esi, 4
  4745 00003AB2 FEC5                <1> 		inc ch
  4746 00003AB4 BA00000000          <1> 		mov edx, 0
  4747 00003AB9 668B15[D73A0000]    <1> 		mov dx, [resolutionx2]
  4748 00003AC0 01D7                <1> 		add edi, edx
  4749 00003AC2 81EF40000000        <1> 		sub edi, 64
  4750 00003AC8 80FD20              <1> 		cmp ch, 32
  4751 00003ACB 72A7                <1> 		jb writeicon
  4752 00003ACD B800000000          <1> 		mov eax, 0
  4753 00003AD2 C3                  <1> 		ret
  4754                              <1> 
  4755 00003AD3 0000                <1> resolutiony dw 0
  4756 00003AD5 0000                <1> resolutionx dw 0
  4757 00003AD7 0000                <1> resolutionx2 dw 0
  4758 00003AD9 02                  <1> resolutionbytes db 2
  4759 00003ADA 0000                <1> posxvesa dw 0
  4760 00003ADC 0000                <1> posyvesa dw 0
  4761 00003ADE FFFF                <1> colorfont dw 0xFFFF
  4762                              <1> savefontvesa:		;;same rules as showfontvesa
  4763 00003AE0 C605[A72C0000]01    <1> 	mov byte [savefonton], 1
  4764                              <1> showfontvesa:		;;position in (dx,cx), color in bx, char in al
  4765 00003AE7 66890D[DC3A0000]    <1> 	mov [posyvesa], cx
  4766 00003AEE 668915[DA3A0000]    <1> 	mov [posxvesa], dx
  4767 00003AF5 8B3D[B8520000]      <1> 	mov edi, [physbaseptr]
  4768 00003AFB 66891D[DE3A0000]    <1> 	mov [colorfont], bx
  4769 00003B02 BB00000000          <1> 	mov ebx, 0
  4770 00003B07 88C3                <1> 	mov bl, al
  4771 00003B09 B800000000          <1> 	mov eax, 0
  4772 00003B0E 88D8                <1> 	mov al, bl
  4773 00003B10 6689D3              <1> 	mov bx, dx
  4774 00003B13 89DA                <1> 	mov edx, ebx
  4775 00003B15 BB00000000          <1> 	mov ebx, 0
  4776 00003B1A 6681F90000          <1> 	cmp cx, 0
  4777 00003B1F 7415                <1> 	je vesaposloopdn
  4778 00003B21 668B1D[D73A0000]    <1> 	mov bx, [resolutionx2]
  4779                              <1> vesaposloop:
  4780 00003B28 01DA                <1> 	add edx, ebx
  4781 00003B2A 6681E90100          <1> 	sub cx, 1
  4782 00003B2F 6681F90000          <1> 	cmp cx, 0
  4783 00003B34 75F2                <1> 	jne vesaposloop
  4784                              <1> vesaposloopdn:
  4785 00003B36 01D7                <1> 	add edi, edx
  4786 00003B38 BE[70480000]        <1> 	mov esi, fonts
  4787                              <1> findfontvesa:
  4788 00003B3D B400                <1> 	mov ah, 0
  4789 00003B3F C1E004              <1> 	shl eax, 4
  4790 00003B42 01C6                <1> 	add esi, eax
  4791 00003B44 C1E804              <1> 	shr eax, 4
  4792 00003B47 81FE[90500000]      <1> 	cmp esi, fontend
  4793 00003B4D 0F83BF000000        <1> 	jae near donefontvesa
  4794 00003B53 4E                  <1> 	dec esi
  4795                              <1> foundfontvesa:
  4796 00003B54 46                  <1> 	inc esi
  4797 00003B55 803D[A72C0000]01    <1> 	cmp byte [savefonton], 1
  4798 00003B5C 0F84E1000000        <1> 	je near vesafontsaver
  4799 00003B62 B100                <1> 	mov cl, 0
  4800 00003B64 8A06                <1> 	mov al, [esi]
  4801 00003B66 668B15[D73A0000]    <1> 	mov dx, [resolutionx2]
  4802 00003B6D 662B15[DA3A0000]    <1> 	sub dx, [posxvesa]
  4803 00003B74 6681FA1000          <1> 	cmp dx, 16
  4804 00003B79 7708                <1> 	ja paintfontvesa
  4805 00003B7B D0EA                <1> 	shr dl, 1
  4806 00003B7D 8815[423C0000]      <1> 	mov [charwidth], dl
  4807                              <1> paintfontvesa:
  4808 00003B83 B201                <1> 	mov dl, 1
  4809 00003B85 20C2                <1> 	and dl, al
  4810 00003B87 803D[A62C0000]01    <1> 	cmp byte [showcursorfonton], 1
  4811 00003B8E 0F8435000000        <1> 	je near nodelpaintedfont
  4812 00003B94 803D[A62C0000]02    <1> 	cmp byte [showcursorfonton], 2
  4813 00003B9B 0F8518000000        <1> 	jne near noswitchcursorfonton
  4814 00003BA1 80FA00              <1> 	cmp dl, 0
  4815 00003BA4 0F842E000000        <1> 	je near nopixelset
  4816 00003BAA 668B1D[DE3A0000]    <1> 	mov bx, [colorfont]
  4817 00003BB1 66891F              <1> 	mov [edi], bx
  4818 00003BB4 E91F000000          <1> 	jmp nopixelset
  4819                              <1> noswitchcursorfonton:
  4820 00003BB9 3215[A82C0000]      <1> 	xor dl, [mouseselecton]
  4821 00003BBF 668B1D[4D2B0000]    <1> 	mov bx, [background]
  4822 00003BC6 66891F              <1> 	mov [edi], bx
  4823                              <1> nodelpaintedfont:
  4824 00003BC9 80FA00              <1> 	cmp dl, 0
  4825 00003BCC 740A                <1> 	je nopixelset
  4826 00003BCE 668B15[DE3A0000]    <1> 	mov dx, [colorfont]
  4827 00003BD5 668917              <1> 	mov [edi], dx
  4828                              <1> nopixelset:
  4829 00003BD8 81C702000000        <1> 	add edi, 2
  4830 00003BDE D0C0                <1> 	rol al, 1
  4831 00003BE0 FEC1                <1> 	inc cl
  4832 00003BE2 3A0D[423C0000]      <1> 	cmp cl, [charwidth]
  4833 00003BE8 7299                <1> 	jb paintfontvesa
  4834 00003BEA FEC5                <1> 	inc ch
  4835 00003BEC BA00000000          <1> 	mov edx, 0
  4836 00003BF1 668B15[D73A0000]    <1> 	mov dx, [resolutionx2]
  4837 00003BF8 01D7                <1> 	add edi, edx
  4838 00003BFA BA00000000          <1> 	mov edx, 0
  4839 00003BFF 8A15[423C0000]      <1> 	mov dl, [charwidth]
  4840 00003C05 00D2                <1> 	add dl, dl
  4841 00003C07 29D7                <1> 	sub edi, edx
  4842 00003C09 80FD10              <1> 	cmp ch, 16
  4843 00003C0C 0F8242FFFFFF        <1> 	jb foundfontvesa
  4844                              <1> donefontvesa:
  4845 00003C12 B208                <1> 	mov dl, 8
  4846 00003C14 8815[423C0000]      <1> 	mov [charwidth], dl
  4847 00003C1A 668B15[DA3A0000]    <1> 	mov dx, [posxvesa]
  4848 00003C21 8A1D[423C0000]      <1> 	mov bl, [charwidth]
  4849 00003C27 B700                <1> 	mov bh, 0
  4850 00003C29 6601DA              <1> 	add dx, bx
  4851 00003C2C 668B1D[DE3A0000]    <1> 	mov bx, [colorfont]
  4852 00003C33 668B0D[DC3A0000]    <1> 	mov cx, [posyvesa]
  4853 00003C3A C605[A72C0000]00    <1> 	mov byte [savefonton], 0
  4854 00003C41 C3                  <1> 	ret
  4855 00003C42 08                  <1> charwidth db 8
  4856                              <1> vesafontsaver:
  4857 00003C43 B000                <1> 	mov al, 0
  4858 00003C45 B100                <1> 	mov cl, 0
  4859                              <1> vesafontsaver2:
  4860 00003C47 668B17              <1> 	mov dx, [edi]
  4861 00003C4A 663B15[DE3A0000]    <1> 	cmp dx, [colorfont]
  4862 00003C51 742F                <1> 	je colorfontmatch
  4863                              <1> donecolormatch:
  4864 00003C53 81C702000000        <1> 	add edi, 2
  4865 00003C59 D0C0                <1> 	rol al, 1
  4866 00003C5B FEC1                <1> 	inc cl
  4867 00003C5D 80F908              <1> 	cmp cl, 8
  4868 00003C60 72E5                <1> 	jb vesafontsaver2
  4869 00003C62 8806                <1> 	mov [esi], al
  4870 00003C64 46                  <1> 	inc esi
  4871 00003C65 FEC5                <1> 	inc ch
  4872 00003C67 BA00000000          <1> 	mov edx, 0
  4873 00003C6C 668B15[D73A0000]    <1> 	mov dx, [resolutionx2]
  4874 00003C73 01D7                <1> 	add edi, edx
  4875 00003C75 81EF10000000        <1> 	sub edi, 16
  4876 00003C7B 80FD10              <1> 	cmp ch, 16
  4877 00003C7E 72C3                <1> 	jb vesafontsaver
  4878 00003C80 EB90                <1> 	jmp donefontvesa
  4879                              <1> colorfontmatch:
  4880 00003C82 0401                <1> 	add al, 1
  4881 00003C84 EBCD                <1> 	jmp donecolormatch
  4882                              <1> 	
  4883                              <1> showbmp:
  4884 00003C86 668B06              <1> 	mov ax, [esi]
  4885 00003C89 663D424D            <1> 	cmp ax, "BM"
  4886 00003C8D 0F858E000000        <1> 	jne near endedbmp
  4887 00003C93 8B3D[B8520000]      <1> 	mov edi, [physbaseptr]
  4888 00003C99 6689D0              <1> 	mov ax, dx
  4889 00003C9C 6689CB              <1> 	mov bx, cx
  4890 00003C9F B900000000          <1> 	mov ecx, 0
  4891 00003CA4 BA00000000          <1> 	mov edx, 0
  4892 00003CA9 6689D9              <1> 	mov cx, bx
  4893 00003CAC 6689C2              <1> 	mov dx, ax
  4894 00003CAF 01D7                <1> 	add edi, edx
  4895 00003CB1 01D7                <1> 	add edi, edx
  4896 00003CB3 BA00000000          <1> 	mov edx, 0
  4897 00003CB8 668B15[D73A0000]    <1> 	mov dx, [resolutionx2]
  4898 00003CBF 41                  <1> 	inc ecx
  4899 00003CC0 034E16              <1> 	add ecx, [esi + 22]
  4900                              <1> bmplocloop:
  4901 00003CC3 01D7                <1> 	add edi, edx
  4902 00003CC5 E2FC                <1> 	loop bmplocloop
  4903 00003CC7 29D7                <1> 	sub edi, edx
  4904 00003CC9 8B5612              <1> 	mov edx, [esi + 18]
  4905 00003CCC 8B4E16              <1> 	mov ecx, [esi + 22]
  4906 00003CCF 8B460A              <1> 	mov eax, [esi + 10]
  4907 00003CD2 8B5E02              <1> 	mov ebx, [esi + 2]
  4908 00003CD5 01F3                <1> 	add ebx, esi
  4909 00003CD7 891D[223D0000]      <1> 	mov [bmpend], ebx
  4910 00003CDD 89D3                <1> 	mov ebx, edx
  4911 00003CDF 01C6                <1> 	add esi, eax
  4912                              <1> ldxbmp:
  4913 00003CE1 668B06              <1> 	mov ax, [esi]
  4914 00003CE4 668907              <1> 	mov [edi], ax
  4915 00003CE7 81C702000000        <1> 	add edi, 2
  4916 00003CED 81C602000000        <1> 	add esi, 2
  4917 00003CF3 3B35[223D0000]      <1> 	cmp esi, [bmpend]
  4918 00003CF9 7726                <1> 	ja endedbmp
  4919 00003CFB 4A                  <1> 	dec edx
  4920 00003CFC 81FA00000000        <1> 	cmp edx, 0
  4921 00003D02 77DD                <1> 	ja ldxbmp
  4922 00003D04 BA00000000          <1> 	mov edx, 0
  4923 00003D09 668B15[D73A0000]    <1> 	mov dx, [resolutionx2]
  4924 00003D10 29DF                <1> 	sub edi, ebx
  4925 00003D12 29DF                <1> 	sub edi, ebx
  4926 00003D14 29D7                <1> 	sub edi, edx
  4927 00003D16 49                  <1> 	dec ecx
  4928 00003D17 89DA                <1> 	mov edx, ebx
  4929 00003D19 81F900000000        <1> 	cmp ecx, 0
  4930 00003D1F 77C0                <1> 	ja ldxbmp
  4931                              <1> endedbmp:
  4932 00003D21 C3                  <1> 	ret
  4933                              <1> 	
  4934 00003D22 00000000            <1> 	bmpend dd 0
  4935                              <1> 
  4936                              <1> ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;Here are some vars;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
  4937 00003D26 00000000            <1> 	showstringesi dw 0,0
  4938 00003D2A 00                  <1> 	mouseon db 0
  4939 00003D2B 737461727400        <1> 	start	db "start",0
  4940 00003D31 536F6C6C65724F5300  <1> 	gotomenu db "SollerOS",0
  4941 00003D3A 426F6F2100          <1> 	boomsg db "Boo!",0
  4942 00003D3F 5061636D616E207761- <1> 	pacmsg	db "Pacman was easy to draw.",0
  4943 00003D48 73206561737920746F- <1>
  4944 00003D51 20647261772E00      <1>
  4945 00003D58 4F6D206E6F6D206E6F- <1> 	pacnom  db "Om nom nom nom",0
  4946 00003D61 6D206E6F6D00        <1>
  4947 00003D67 77696E646F77732073- <1> 	winmsg	db "windows sucks",0
  4948 00003D70 75636B7300          <1>
  4949 00003D75 5800                <1> 	xmsg db "X",0
  4950 00003D77 0000                <1> 	icon dw 0	;pointer to icon
  4951 00003D79 00000000            <1> 	codepointer dw 0,0 ;pointer to code
  4952 00003D7D 00                  <1> 	iconselected db 0
  4953                              <1> 	
  4954                              <1> 	boo:
  4955 00003D7E BE[3A3D0000]        <1> 		mov esi, boomsg
  4956 00003D83 66BA6400            <1> 		mov dx, 100
  4957 00003D87 66B94001            <1> 		mov cx, 320
  4958 00003D8B BB00000000          <1> 		mov ebx, 0
  4959 00003D90 66B80000            <1> 		mov ax, 0
  4960 00003D94 E9DDF8FFFF          <1> 		jmp showstring
  4961                              <1> 
  4962                              <1> 	pacmannomnom:
  4963 00003D99 BE[583D0000]        <1> 		mov esi, pacnom
  4964 00003D9E 66BA8200            <1> 		mov dx, 130
  4965 00003DA2 66B93C00            <1> 		mov cx, 60
  4966 00003DA6 BB00000000          <1> 		mov ebx, 0
  4967 00003DAB 66B80000            <1> 		mov ax, 0
  4968 00003DAF E9C2F8FFFF          <1> 		jmp showstring	
  4969                              <1> 	
  4970                              <1> 	noie:
  4971 00003DB4 BE[483E0000]        <1> 		mov esi, termwindow
  4972 00003DB9 66BA0000            <1> 		mov dx, 0
  4973 00003DBD 66B90000            <1> 		mov cx, 0
  4974 00003DC1 BB[8B0F0000]        <1> 		mov ebx, os
  4975                              <1> ;;		mov ebx, internettest
  4976 00003DC6 891D[62030000]      <1> 		mov [user2codepoint], ebx
  4977 00003DCC 66B80000            <1> 		mov ax, 0
  4978 00003DD0 E8F6F8FFFF          <1> 		call showwindow
  4979                              <1> ;;		jmp internettest
  4980 00003DD5 E9B1D1FFFF          <1> 		jmp os
  4981 00003DDA C3                  <1> 		ret
  4982                              <1> 
  4983                              <1> 	gotomenuboot:
  4984 00003DDB BE[483E0000]        <1> 		mov esi, termwindow
  4985 00003DE0 66BA0000            <1> 		mov dx, 0
  4986 00003DE4 66B90000            <1> 		mov cx, 0
  4987 00003DE8 BB[8B0F0000]        <1> 		mov ebx, os
  4988 00003DED 891D[62030000]      <1> 		mov [user2codepoint], ebx
  4989 00003DF3 66B80000            <1> 		mov ax, 0
  4990 00003DF7 E8CFF8FFFF          <1> 		call showwindow
  4991 00003DFC E98AD1FFFF          <1> 		jmp os
  4992 00003E01 C3                  <1> 		ret
  4993                              <1> 
  4994                              <1> 	winblows:
  4995 00003E02 BE[673D0000]        <1> 		mov esi, winmsg
  4996 00003E07 66BA0000            <1> 		mov dx, 0
  4997 00003E0B 668B0D[D33A0000]    <1> 		mov cx, [resolutiony]
  4998 00003E12 6681E92000          <1> 		sub cx, 32
  4999 00003E17 BB00000000          <1> 		mov ebx, 0
  5000 00003E1C B400                <1> 		mov ah, 0
  5001 00003E1E B011                <1> 		mov al, 00010001b
  5002 00003E20 E851F8FFFF          <1> 		call showstring
  5003 00003E25 BE[313D0000]        <1> 		mov esi, gotomenu
  5004 00003E2A 668B0D[D33A0000]    <1> 		mov cx, [resolutiony]
  5005 00003E31 6681E93000          <1> 		sub cx, 48
  5006 00003E36 66BA0000            <1> 		mov dx, 0
  5007 00003E3A B400                <1> 		mov ah, 0
  5008 00003E3C B010                <1> 		mov al, 00010000b
  5009 00003E3E BB[DB3D0000]        <1> 		mov ebx, gotomenuboot
  5010 00003E43 E92EF8FFFF          <1> 		jmp showstring
  5011                              <1> 
  5012 00003E48 8002E001            <1> 	termwindow:	dw 640,480	;;window size
  5013 00003E4C 5445524D494E414C00  <1> 	termmsg:	db "TERMINAL",0	;;window title
  5014                              <1> 	
  5015 00003E4C <incbin>            <1> interneticon: 	incbin 'source/precompiled/interneticon.pak'
  5016 00003E4C <incbin>            <1> wordicon: 	incbin 'source/precompiled/wordicon.pak'
  5017 00003E4C <incbin>            <1> pacmanpellet: incbin 'source/precompiled/pacmanpellet.pak'
  5018 00003E4C <incbin>            <1> ghostie	incbin 'source/precompiled/ghostie.pak'
  5019 00003E4C <incbin>            <1> pacman	incbin 'source/precompiled/pacman.pak'
  5020                                      ;%include 'source/network.asm'
  5021                                  	%include 'source/rtl8139.asm'
  5022                              <1> ;;rtl8139.asm
  5023                              <1> initcard:	;;should find card, get mac, and initialize card
  5024 000040DF B800000000          <1> 	mov eax, 0
  5025 000040E4 A2[19440000]        <1> 	mov [pcifunction], al
  5026 000040E9 A2[17440000]        <1> 	mov [pcibus], al
  5027 000040EE A2[18440000]        <1> 	mov [pcidevice], al
  5028 000040F3 B002                <1> 	mov al, 0x02 ;;type code
  5029 000040F5 A2[9C440000]        <1> 	mov [pcitype], al
  5030 000040FA E81D030000          <1> 	call getpciport
  5031                              <1> initnic:		;;;;Here i tried the rtl8139 interface, fuck it
  5032 000040FF 8915[EE420000]      <1> 	mov [basenicaddr], edx
  5033 00004105 89D1                <1> 	mov ecx, edx
  5034 00004107 C605[E0140000]03    <1> 	mov byte [firsthexshown], 3
  5035 0000410E E8E2D3FFFF          <1> 	call showhex	;;for debugging, please remove
  5036 00004113 BE[15360000]        <1> 	mov esi, rbuffstart
  5037 00004118 B900200000          <1> 	mov ecx, 8192
  5038 0000411D B800000000          <1> 	mov eax, 0
  5039                              <1> clearrbuff:		;;clear receive buffer which starts at rbuffstart
  5040 00004122 8806                <1> 	mov [esi], al
  5041 00004124 46                  <1> 	inc esi
  5042 00004125 6649                <1> 	dec cx
  5043 00004127 6681F90000          <1> 	cmp cx, 0
  5044 0000412C 75F4                <1> 	jne clearrbuff
  5045                              <1> findmac:
  5046 0000412E 8B15[EE420000]      <1> 	mov edx, [basenicaddr]
  5047 00004134 BF[F6420000]        <1> 	mov edi, sysmac
  5048 00004139 B906000000          <1> 	mov ecx, 6
  5049                              <1> macputloop:
  5050 0000413E EC                  <1> 	in al, dx
  5051 0000413F 8807                <1> 	mov [edi], al
  5052 00004141 47                  <1> 	inc edi
  5053 00004142 42                  <1> 	inc edx
  5054 00004143 49                  <1> 	dec ecx
  5055 00004144 75F8                <1> 	jnz macputloop
  5056 00004146 B9[F6420000]        <1> 	mov ecx, sysmac
  5057 0000414B E837010000          <1> 	call showmac
  5058                              <1> resetnic:
  5059 00004150 8B15[EE420000]      <1> 	mov edx, [basenicaddr]
  5060 00004156 81C252000000        <1> 	add edx, 0x52
  5061 0000415C B000                <1> 	mov al, 0
  5062 0000415E EE                  <1> 	out dx, al	;;WAKE UP!!!!
  5063 0000415F 8B15[EE420000]      <1> 	mov edx, [basenicaddr]
  5064 00004165 81C237000000        <1> 	add edx, 0x37
  5065 0000416B B010                <1> 	mov al, 0x10
  5066 0000416D EE                  <1> 	out dx, al	;;Reset
  5067                              <1> resetnicwait:
  5068 0000416E 8B15[EE420000]      <1> 	mov edx, [basenicaddr]
  5069 00004174 81C237000000        <1> 	add edx, 0x37
  5070 0000417A EC                  <1> 	in al, dx
  5071 0000417B 2410                <1> 	and al, 0x10
  5072 0000417D 3C10                <1> 	cmp al, 0x10
  5073 0000417F 0F84E9FFFFFF        <1> 	je near resetnicwait
  5074 00004185 8B15[EE420000]      <1> 	mov edx, [basenicaddr]
  5075 0000418B 81C230000000        <1> 	add edx, 0x30
  5076 00004191 B8[15360000]        <1> 	mov eax, rbuffstart
  5077 00004196 EF                  <1> 	out dx, eax	;;give nic receive buffer location
  5078 00004197 8B15[EE420000]      <1> 	mov edx, [basenicaddr]
  5079 0000419D 81C23C000000        <1> 	add edx, 0x3C
  5080 000041A3 66B80500            <1> 	mov ax, 0x0005
  5081 000041A7 66EF                <1> 	out dx, ax	;;set TOK and ROK
  5082 000041A9 8B15[EE420000]      <1> 	mov edx, [basenicaddr]
  5083 000041AF 81C244000000        <1> 	add edx, 0x44
  5084 000041B5 B80F000000          <1> 	mov eax, 0xf
  5085 000041BA EF                  <1> 	out dx, eax	;;recieve packets from all matches
  5086 000041BB 8B15[EE420000]      <1> 	mov edx, [basenicaddr]
  5087 000041C1 81C237000000        <1> 	add edx, 0x37
  5088 000041C7 B00C                <1> 	mov al, 0x0C
  5089 000041C9 EE                  <1> 	out dx, al	;;use transmit and receive
  5090 000041CA C605[D7420000]01    <1> 	mov byte [nicconfig], 1
  5091 000041D1 C3                  <1> 	ret
  5092                              <1> 	
  5093                              <1> sendframe:	;;padded frame with beginning in edi and end in esi
  5094 000041D2 56                  <1> 	push esi
  5095 000041D3 57                  <1> 	push edi
  5096                              <1> nic2:		;;here come the low level drivers :(
  5097                              <1> 			;;frame begins at esi, ends at edi 			;;0x0200 is the class code for ethernet cards
  5098 000041D4 803D[D7420000]01    <1> 	cmp byte [nicconfig], 1
  5099 000041DB 7405                <1> 	je sendcachedata
  5100 000041DD E8FDFEFFFF          <1> 	call initcard
  5101                              <1> sendcachedata:
  5102 000041E2 8B15[EE420000]      <1> 	mov edx, [basenicaddr]
  5103 000041E8 81C210000000        <1> 	add edx, 0x10
  5104 000041EE ED                  <1> 	in eax, dx
  5105 000041EF 89C1                <1> 	mov ecx, eax
  5106 000041F1 E8FFD2FFFF          <1> 	call showhex
  5107 000041F6 8B15[EE420000]      <1> 	mov edx, [basenicaddr]
  5108 000041FC 81C213000000        <1> 	add edx, 0x13
  5109 00004202 ED                  <1> 	in eax, dx
  5110 00004203 89C1                <1> 	mov ecx, eax
  5111 00004205 E8EBD2FFFF          <1> 	call showhex
  5112 0000420A 8B15[EE420000]      <1> 	mov edx, [basenicaddr]
  5113 00004210 81C223000000        <1> 	add edx, 0x23	;;23 or 20?
  5114 00004216 5F                  <1> 	pop edi
  5115 00004217 89F8                <1> 	mov eax, edi
  5116 00004219 EF                  <1> 	out dx, eax	;;here's Johnny!
  5117 0000421A 5E                  <1> 	pop esi
  5118 0000421B 29FE                <1> 	sub esi, edi
  5119 0000421D 89F0                <1> 	mov eax, esi
  5120 0000421F 8B15[EE420000]      <1> 	mov edx, [basenicaddr]
  5121 00004225 81C213000000        <1> 	add edx, 0x13	;;13 or 10?
  5122 0000422B EF                  <1> 	out dx, eax
  5123                              <1> checknicstatus1:
  5124 0000422C 8B15[EE420000]      <1> 	mov edx, [basenicaddr]
  5125 00004232 81C213000000        <1> 	add edx, 0x13	;;13 or 10?
  5126 00004238 ED                  <1> 	in eax, dx
  5127 00004239 2500200000          <1> 	and eax, 0x2000
  5128 0000423E 3D00200000          <1> 	cmp eax, 0x2000
  5129 00004243 75E7                <1> 	jne checknicstatus1
  5130                              <1> checknicstatus:
  5131 00004245 8B15[EE420000]      <1> 	mov edx, [basenicaddr]
  5132 0000424B 81C213000000        <1> 	add edx, 0x13	;;13 or 10?
  5133 00004251 ED                  <1> 	in eax, dx
  5134 00004252 2500800000          <1> 	and eax, 0x8000
  5135 00004257 3D00800000          <1> 	cmp eax, 0x8000
  5136 0000425C 75E7                <1> 	jne checknicstatus
  5137 0000425E 8B15[EE420000]      <1> 	mov edx, [basenicaddr]
  5138 00004264 81C210000000        <1> 	add edx, 0x10
  5139 0000426A ED                  <1> 	in eax, dx
  5140 0000426B 89C1                <1> 	mov ecx, eax
  5141 0000426D E883D2FFFF          <1> 	call showhex
  5142 00004272 8B15[EE420000]      <1> 	mov edx, [basenicaddr]
  5143 00004278 81C213000000        <1> 	add edx, 0x13
  5144 0000427E ED                  <1> 	in eax, dx
  5145 0000427F 89C1                <1> 	mov ecx, eax
  5146 00004281 E86FD2FFFF          <1> 	call showhex
  5147 00004286 C3                  <1> 	ret
  5148                              <1> 	
  5149                              <1> showmac:	;;mac begins in [ecx]
  5150 00004287 BE[BF420000]        <1> 	mov esi, macprint
  5151 0000428C 89CF                <1> 	mov edi, ecx
  5152 0000428E 81C106000000        <1> 	add ecx, 6
  5153                              <1> showmacloop:
  5154 00004294 8A07                <1> 	mov al, [edi]
  5155 00004296 8A27                <1> 	mov ah, [edi]
  5156 00004298 C0E804              <1> 	shr al, 4
  5157 0000429B C0E404              <1> 	shl ah, 4
  5158 0000429E C0EC04              <1> 	shr ah, 4
  5159 000042A1 0430                <1> 	add al, 48
  5160 000042A3 80C430              <1> 	add ah, 48
  5161 000042A6 668906              <1> 	mov [esi], ax
  5162 000042A9 81C603000000        <1> 	add esi, 3
  5163 000042AF 47                  <1> 	inc edi
  5164 000042B0 39CF                <1> 	cmp edi, ecx
  5165 000042B2 72E0                <1> 	jb showmacloop
  5166 000042B4 BE[BF420000]        <1> 	mov esi, macprint
  5167 000042B9 E8B4C8FFFF          <1> 	call print
  5168 000042BE C3                  <1> 	ret
  5169                              <1> 	
  5170 000042BF 30302D30302D30302D- <1> macprint db "00-00-00-00-00-00  ",0
  5171 000042C8 30302D30302D303020- <1>
  5172 000042D1 2000                <1>
  5173 000042D3 00000000            <1> ethernetend dw 0,0
  5174 000042D7 00                  <1> nicconfig db 0
  5175 000042D8 4E4F204E494300      <1> nonicfoundmsg db "NO NIC",0
  5176 000042DF 496E6974696174696E- <1> initnicmsg	db "Initiating NIC",0
  5177 000042E8 67204E494300        <1>
  5178 000042EE 00000000            <1> basenicaddr	db 0,0,0,0
  5179 000042F2 C0A80005            <1> sysip db 192,168,0,5
  5180 000042F6 000000000000        <1> sysmac	db 0,0,0,0,0,0		;;my mac address
  5181                                  	%include 'source/arp.asm'
  5182                              <1> ;;let's try something else
  5183                              <1> ;;arp.asm
  5184                              <1> arpinit:
  5185 000042FC BE[B3430000]        <1> 	mov esi, arptable
  5186 00004301 BF[F6420000]        <1> 	mov edi, sysmac
  5187 00004306 BB[F2420000]        <1> 	mov ebx, sysip
  5188 0000430B 8B0F                <1> 	mov ecx, [edi]
  5189 0000430D 890E                <1> 	mov [esi], ecx
  5190 0000430F 668B4F04            <1> 	mov cx, [edi + 4]
  5191 00004313 894E04              <1> 	mov [esi + 4], ecx
  5192 00004316 8B0B                <1> 	mov ecx, [ebx]
  5193 00004318 894E06              <1> 	mov [esi + 6], ecx
  5194 0000431B C605[B2430000]01    <1> 	mov byte [arpconfig], 1
  5195 00004322 C3                  <1> 	ret
  5196                              <1> arptest:
  5197 00004323 803D[B2430000]01    <1> 	cmp byte [arpconfig], 1
  5198 0000432A 7405                <1> 	je arptest2
  5199 0000432C E8CBFFFFFF          <1> 	call arpinit
  5200                              <1> arptest2:	;;try to reach 192.168.0.1
  5201 00004331 8B0D[F6420000]      <1> 	mov ecx, [sysmac]
  5202 00004337 668B1D[FA420000]    <1> 	mov bx, [sysmac + 4]
  5203 0000433E 890D[78430000]      <1> 	mov [sourcemac], ecx
  5204 00004344 66891D[7C430000]    <1> 	mov [sourcemac + 4],bx
  5205 0000434B 890D[88430000]      <1> 	mov [arpsenderinfo], ecx
  5206 00004351 66891D[8C430000]    <1> 	mov [arpsenderinfo + 4], bx
  5207 00004358 BF[72430000]        <1> 	mov edi, frame
  5208 0000435D BE[B2430000]        <1> 	mov esi, framend
  5209 00004362 E86BFEFFFF          <1> 	call sendframe
  5210 00004367 BE[4D480000]        <1> 	mov esi, line
  5211 0000436C E801C8FFFF          <1> 	call print
  5212 00004371 C3                  <1> 	ret
  5213                              <1> 	
  5214                              <1> ;;example frame
  5215                              <1> frame:
  5216 00004372 FFFFFFFFFFFF        <1> destinationmac:	db 0xFF,0xFF,0xFF,0xFF,0xFF,0xFF
  5217 00004378 000000000000        <1> sourcemac:		db 0,0,0,0,0,0
  5218 0000437E 0608                <1> ethertype:		dw 0x0806			;;arp
  5219                              <1> 	;;example packet
  5220 00004380 0100                <1> 	arppacket: 		dw 1				;;ethernet is 1
  5221 00004382 0008                <1> 	arpprotocol: 	dw 0x0800			;;ip is 0x800
  5222 00004384 0604                <1> 					db 6,4				;;length of mac, length of ip
  5223 00004386 0100                <1> 	arpoperation: 	dw 1				;;one for arp request
  5224 00004388 000000000000        <1> 	arpsenderinfo:	db 0x00,0x00,0x00,0x00,0x00,0x00	;;mac
  5225 0000438E C0A80005            <1> 					db 192,168,0,5			;;ip
  5226 00004392 000000000000        <1> 	arptargetinfo:	db 0x00,0x00,0x00,0x00,0x00,0x00	;;ignored in requests
  5227 00004398 C0A80001            <1> 					db 192,168,0,1			;;ip
  5228 0000439C 00<rept>            <1> padding:		times (64-($-frame)) db 0
  5229                              <1> framend:
  5230                              <1> 
  5231 000043B2 00                  <1> arpconfig db 0
  5232                              <1> arptable:	;;mac,ip
  5233 000043B3 000000000000000000- <1> 	times 10 db 0,0,0,0,0,0,0,0,0,0
  5234 000043BC 00<rept>            <1>
  5235                              <1> arptableend:
  5236                                  	%include 'source/pci.asm'
  5237 00004417 00                  <1> pcibus		db 0
  5238 00004418 00                  <1> pcidevice	db 0
  5239 00004419 00                  <1> pcifunction	db 0
  5240 0000441A 00                  <1> pciregister	db 0
  5241 0000441B 00                  <1> pcireqtype db 0
  5242                              <1> 
  5243                              <1> getpciport:
  5244 0000441C B001                <1> 	mov al, 1
  5245 0000441E A2[1B440000]        <1> 	mov [pcireqtype], al
  5246 00004423 E91E000000          <1> 	jmp searchpci
  5247                              <1> pcidump:
  5248 00004428 B800000000          <1> 	mov eax, 0
  5249 0000442D A2[19440000]        <1> 	mov [pcifunction], al
  5250 00004432 A2[17440000]        <1> 	mov [pcibus], al
  5251 00004437 A2[18440000]        <1> 	mov [pcidevice], al
  5252 0000443C A2[1B440000]        <1> 	mov [pcireqtype], al
  5253 00004441 E900000000          <1> 	jmp searchpci
  5254                              <1> searchpci:		;;return in ebx, start X in pciX
  5255 00004446 B000                <1> 	mov al, 0
  5256 00004448 A2[1A440000]        <1> 	mov [pciregister], al
  5257 0000444D E84F010000          <1> 	call getpciaddr
  5258 00004452 BAF80C0000          <1> 	mov edx, 0xCF8
  5259 00004457 EF                  <1> 	out dx, eax	;;request pci config
  5260 00004458 BAFC0C0000          <1> 	mov edx, 0xCFC
  5261 0000445D ED                  <1> 	in eax, dx 	;;read in pci config
  5262 0000445E 3D0000FFFF          <1> 	cmp eax, 0xFFFF0000
  5263 00004463 0F8237000000        <1> 	jb near checkpcidevice
  5264                              <1> searchpciret:
  5265                              <1> nextpcidevice:
  5266 00004469 B000                <1> 	mov al, 0
  5267 0000446B A2[19440000]        <1> 	mov [pcifunction], al
  5268 00004470 A0[18440000]        <1> 	mov al, [pcidevice]
  5269 00004475 3C1F                <1> 	cmp al, 11111b
  5270 00004477 0F83B8000000        <1> 	jae near nextpcibus
  5271 0000447D FEC0                <1> 	inc al
  5272 0000447F A2[18440000]        <1> 	mov [pcidevice], al
  5273 00004484 EBC0                <1> 	jmp searchpci
  5274 00004486 A0[19440000]        <1> 	mov al, [pcifunction]
  5275 0000448B 3C07                <1> 	cmp al, 111b
  5276 0000448D 0F83D6FFFFFF        <1> 	jae near nextpcidevice
  5277 00004493 FEC0                <1> 	inc al
  5278 00004495 A2[19440000]        <1> 	mov [pcifunction], al
  5279 0000449A EBAA                <1> 	jmp searchpci
  5280 0000449C 00000000            <1> pcitype: db 0,0,0,0
  5281                              <1> checkpcidevice:
  5282 000044A0 B000                <1> 	mov al, 0
  5283 000044A2 3805[1B440000]      <1> 	cmp [pcireqtype], al
  5284 000044A8 0F842B000000        <1> 	je near dumppcidevice
  5285 000044AE B008                <1> 	mov al, 0x08
  5286 000044B0 A2[1A440000]        <1> 	mov [pciregister], al	;;class code, subclass, revision id
  5287 000044B5 E8E7000000          <1> 	call getpciaddr
  5288 000044BA BAF80C0000          <1> 	mov edx, 0xCF8
  5289 000044BF EF                  <1> 	out dx, eax
  5290 000044C0 BAFC0C0000          <1> 	mov edx, 0xCFC
  5291 000044C5 ED                  <1> 	in eax, dx
  5292 000044C6 C1C008              <1> 	rol eax, 8
  5293 000044C9 8A1D[9C440000]      <1> 	mov bl, [pcitype]
  5294 000044CF 38D8                <1> 	cmp al, bl
  5295 000044D1 0F8480000000        <1> 	je near foundpciaddr
  5296 000044D7 EB90                <1> 	jmp searchpciret
  5297                              <1> dumppcidevice:
  5298 000044D9 B000                <1> 	mov al, 0
  5299 000044DB A2[1A440000]        <1> 	mov [pciregister], al
  5300 000044E0 E8BC000000          <1> 	call getpciaddr
  5301 000044E5 89C1                <1> 	mov ecx, eax
  5302 000044E7 C605[E0140000]00    <1> 	mov byte [firsthexshown],0
  5303 000044EE E802D0FFFF          <1> 	call showhex
  5304                              <1> dumppcidevicelp:
  5305 000044F3 A2[1A440000]        <1> 	mov [pciregister], al
  5306 000044F8 E8A4000000          <1> 	call getpciaddr
  5307 000044FD BAF80C0000          <1> 	mov edx, 0xCF8
  5308 00004502 EF                  <1> 	out dx, eax
  5309 00004503 BAFC0C0000          <1> 	mov edx, 0xCFC
  5310 00004508 ED                  <1> 	in eax, dx
  5311 00004509 89C1                <1> 	mov ecx, eax
  5312 0000450B A0[1A440000]        <1> 	mov al, [pciregister]
  5313 00004510 0404                <1> 	add al, 4
  5314 00004512 3C1A                <1> 	cmp al, 0x1A
  5315 00004514 730E                <1> 	jae dumppcidn
  5316 00004516 C605[E0140000]00    <1> 	mov byte [firsthexshown],0
  5317 0000451D E8D3CFFFFF          <1> 	call showhex
  5318 00004522 EBCF                <1> 	jmp dumppcidevicelp
  5319                              <1> dumppcidn:
  5320 00004524 C605[E0140000]00    <1> 	mov byte [firsthexshown],0
  5321 0000452B E8C5CFFFFF          <1> 	call showhex
  5322 00004530 E934FFFFFF          <1> 	jmp searchpciret
  5323                              <1> nextpcibus:
  5324 00004535 B000                <1> 	mov al, 0
  5325 00004537 A2[18440000]        <1> 	mov [pcidevice], al
  5326 0000453C A0[17440000]        <1> 	mov al, [pcibus]
  5327 00004541 3C7F                <1> 	cmp al, 1111111b
  5328 00004543 730C                <1> 	jae donesearchpci
  5329 00004545 FEC0                <1> 	inc al
  5330 00004547 A2[17440000]        <1> 	mov [pcibus], al
  5331 0000454C E9F5FEFFFF          <1> 	jmp searchpci
  5332                              <1> donesearchpci:
  5333 00004551 BA00000000          <1> 	mov edx, 0
  5334 00004556 C3                  <1> 	ret
  5335                              <1> foundpciaddr:
  5336 00004557 B010                <1> 	mov al, 0x10
  5337 00004559 A2[1A440000]        <1> 	mov [pciregister], al
  5338                              <1> findpciioaddr:
  5339 0000455E E83E000000          <1> 	call getpciaddr
  5340 00004563 BAF80C0000          <1> 	mov edx, 0xCF8
  5341 00004568 EF                  <1> 	out dx, eax
  5342 00004569 BAFC0C0000          <1> 	mov edx, 0xCFC
  5343 0000456E ED                  <1> 	in eax, dx
  5344 0000456F 89C3                <1> 	mov ebx, eax
  5345 00004571 81E301000000        <1> 	and ebx, 1
  5346 00004577 81FB00000000        <1> 	cmp ebx, 0
  5347 0000457D 0F8408000000        <1> 	je near notpciioaddr
  5348 00004583 2D01000000          <1> 	sub eax, 1
  5349 00004588 89C2                <1> 	mov edx, eax
  5350 0000458A C3                  <1> 	ret
  5351                              <1> notpciioaddr:
  5352 0000458B A0[1A440000]        <1> 	mov al, [pciregister]
  5353 00004590 0404                <1> 	add al, 4
  5354 00004592 3C28                <1> 	cmp al, 0x28
  5355 00004594 0F87CFFEFFFF        <1> 	ja near searchpciret
  5356 0000459A A2[1A440000]        <1> 	mov [pciregister], al
  5357 0000459F EBBD                <1> 	jmp findpciioaddr
  5358                              <1> getpciaddr:		;;puts it in eax and ebx
  5359 000045A1 B800000000          <1> 			mov eax, 0
  5360 000045A6 BB00000080          <1> 			mov ebx, 0x80000000
  5361 000045AB A0[17440000]        <1> 			mov al, [pcibus]
  5362 000045B0 C1E010              <1> 			shl eax, 16
  5363 000045B3 01C3                <1> 			add ebx, eax
  5364 000045B5 B800000000          <1> 			mov eax, 0
  5365 000045BA A0[18440000]        <1> 			mov al, [pcidevice]
  5366 000045BF C1E00B              <1> 			shl eax, 11
  5367 000045C2 01C3                <1> 			add ebx, eax
  5368 000045C4 B800000000          <1> 			mov eax, 0
  5369 000045C9 A0[19440000]        <1> 			mov al, [pcifunction]
  5370 000045CE C1E008              <1> 			shl eax, 8
  5371 000045D1 01C3                <1> 			add ebx, eax
  5372 000045D3 B800000000          <1> 			mov eax, 0
  5373 000045D8 A0[1A440000]        <1> 			mov al, [pciregister]
  5374 000045DD 01C3                <1> 			add ebx, eax
  5375 000045DF 89D8                <1> 			mov eax, ebx
  5376 000045E1 C3                  <1> 			ret
  5377                              <1> 			
  5378                                  	;%include 'source/process.asm'
  5379                                      %include 'source/disk.asm'
  5380                              <1> ;;disk.asm - new - using lba
  5381                              <1> loadfile:	;;loads a file with the name buffer's location in edi into location in esi
  5382 000045E2 803F00              <1> 	cmp byte [edi], 0
  5383 000045E5 0F8444000000        <1> 	je near nofileload
  5384 000045EB 89FA                <1> 	mov edx, edi
  5385 000045ED BB[98470000]        <1> 	mov ebx, diskfileindex
  5386                              <1> nextnamechar:
  5387 000045F2 8A07                <1> 	mov al, [edi]
  5388 000045F4 8A23                <1> 	mov ah, [ebx]
  5389 000045F6 47                  <1> 	inc edi
  5390 000045F7 43                  <1> 	inc ebx
  5391 000045F8 88C1                <1> 	mov cl, al
  5392 000045FA 08E1                <1> 	or cl, ah
  5393 000045FC 80F900              <1> 	cmp cl, 0
  5394 000045FF 744E                <1> 	je equalfilenames
  5395 00004601 80F920              <1> 	cmp cl, ' '
  5396 00004604 7449                <1> 	je equalfilenames
  5397 00004606 3C2A                <1> 	cmp al, '*'
  5398 00004608 742B                <1> 	je equalfilenames2
  5399 0000460A 80FC00              <1> 	cmp ah, 0
  5400 0000460D 7410                <1> 	je nextfilename
  5401 0000460F 3C00                <1> 	cmp al, 0
  5402 00004611 740C                <1> 	je nextfilename
  5403 00004613 38E0                <1> 	cmp al, ah
  5404 00004615 74DB                <1> 	je nextnamechar
  5405                              <1> getebxzero:
  5406 00004617 8A23                <1> 	mov ah, [ebx]
  5407 00004619 43                  <1> 	inc ebx
  5408 0000461A 80FC00              <1> 	cmp ah, 0
  5409 0000461D 75F8                <1> 	jne getebxzero
  5410                              <1> nextfilename:
  5411 0000461F 81C308000000        <1> 	add ebx, 8		;;next descriptor
  5412 00004625 89D7                <1> 	mov edi, edx
  5413 00004627 81FB[0F480000]      <1> 	cmp ebx, enddiskfileindex
  5414 0000462D 72C3                <1> 	jb nextnamechar
  5415                              <1> nofileload:
  5416 0000462F BA94010000          <1> 	mov edx, 404	;;indicate not found error
  5417 00004634 C3                  <1> 	ret
  5418                              <1> equalfilenames2:
  5419 00004635 81EB02000000        <1> 	sub ebx, 2
  5420                              <1> eqfilefind:
  5421 0000463B 43                  <1> 	inc ebx
  5422 0000463C 81FB[0F480000]      <1> 	cmp ebx, enddiskfileindex
  5423 00004642 0F83E7FFFFFF        <1> 	jae near nofileload
  5424 00004648 8A03                <1> 	mov al, [ebx]
  5425 0000464A 3C00                <1> 	cmp al, 0
  5426 0000464C 75ED                <1> 	jne eqfilefind
  5427 0000464E 43                  <1> 	inc ebx
  5428                              <1> equalfilenames:
  5429 0000464F 8B4304              <1> 	mov eax, [ebx + 4] 	;;put file size in eax
  5430 00004652 8B1B                <1> 	mov ebx, [ebx]		;;put file beginning in ebx
  5431 00004654 031D[2A000000]      <1> 	add ebx, [lbaad]	;;add offset to solleros
  5432 0000465A B900000000          <1> 	mov ecx, 0
  5433 0000465F 88C1                <1> 	mov cl, al			;;get excess number of sectors
  5434 00004661 D0E1                <1> 	shl cl, 1
  5435 00004663 D0E9                <1> 	shr cl, 1			;;cut off at 128
  5436 00004665 29C8                <1> 	sub eax, ecx		;;get rid of excess sectors
  5437 00004667 B500                <1> 	mov ch, 0			;;drive 0
  5438 00004669 C1E807              <1> 	shr eax, 7			;;get number of 128 sector tracks
  5439                              <1> loaddiskfile:		;;tracks in eax, excess sectors in cl, drive in ch, buffer in esi, address in ebx
  5440 0000466C A3[AA460000]        <1> 	mov [filetracks], eax
  5441 00004671 89F7                <1> 	mov edi, esi		;;just in case cl is 0
  5442 00004673 89DA                <1> 	mov edx, ebx
  5443 00004675 80F900              <1> 	cmp cl, 0
  5444 00004678 7405                <1> 	je copytracksforfile
  5445 0000467A E831000000          <1> 	call diskr		;;take care of excess sectors
  5446                              <1> copytracksforfile:
  5447 0000467F A1[AA460000]        <1> 	mov eax, [filetracks]
  5448 00004684 3D00000000          <1> 	cmp eax, 0
  5449 00004689 7419                <1> 	je donecopyfile
  5450 0000468B 48                  <1> 	dec eax
  5451 0000468C A3[AA460000]        <1> 	mov [filetracks], eax
  5452 00004691 89D3                <1> 	mov ebx, edx	;;get end lba
  5453 00004693 B180                <1> 	mov cl, 0x80
  5454 00004695 8A2D[29000000]      <1> 	mov ch, [DriveNumber]
  5455 0000469B 89FE                <1> 	mov esi, edi	;;reset buffer
  5456 0000469D E80E000000          <1> 	call diskr
  5457 000046A2 EBDB                <1> 	jmp copytracksforfile
  5458                              <1> donecopyfile:
  5459 000046A4 BA00000000          <1> 	mov edx, 0	;;no error
  5460 000046A9 C3                  <1> 	ret
  5461                              <1> 	
  5462 000046AA 00000000            <1> filetracks dd 0
  5463                              <1> 	
  5464 000046AE 6400                <1> segments dw 100
  5465                              <1> 
  5466                              <1> diskr:		;;sector count in cl, disk number in ch, 48 bit address with first 32 bits in ebx, buffer in esi, puts end buffer in edi and end lba in edx
  5467 000046B0 8935[94470000]      <1> 	mov [bufferstartesi], esi
  5468 000046B6 891D[90470000]      <1> 	mov [lbaadstartebx], ebx
  5469 000046BC BA00000000          <1> 	mov edx, 0
  5470 000046C1 88CA                <1> 	mov dl, cl
  5471 000046C3 01DA                <1> 	add edx, ebx
  5472 000046C5 8915[8C470000]      <1> 	mov [lbaadend], edx
  5473 000046CB 66B80000            <1> 	mov ax, 0
  5474 000046CF 66BAF101            <1> 	mov dx, 0x1F1
  5475 000046D3 EE                  <1> 	out dx, al	;;2 null bytes
  5476 000046D4 EE                  <1> 	out dx, al
  5477 000046D5 B000                <1> 	mov al, 0
  5478 000046D7 66BAF201            <1> 	mov dx, 0x1F2
  5479 000046DB EE                  <1> 	out dx, al	;;16 bit sector count-last byte now 0
  5480 000046DC 88C8                <1> 	mov al, cl
  5481 000046DE EE                  <1> 	out dx, al
  5482 000046DF 66BAF301            <1> 	mov dx, 0x1F3
  5483 000046E3 89D8                <1> 	mov eax, ebx
  5484 000046E5 C1C818              <1> 	ror eax, 24
  5485 000046E8 EE                  <1> 	out dx, al	;;4th byte of address
  5486 000046E9 C1C018              <1> 	rol eax, 24
  5487 000046EC EE                  <1> 	out dx, al	;;1st byte of address
  5488 000046ED 66BAF401            <1> 	mov dx, 0x1F4
  5489 000046F1 B000                <1> 	mov al, 0
  5490 000046F3 EE                  <1> 	out dx, al	;;5th byte of address-always 0 for now
  5491 000046F4 C1C808              <1> 	ror eax, 8
  5492 000046F7 EE                  <1> 	out dx, al	;;2nd byte of address
  5493 000046F8 66BAF501            <1> 	mov dx, 0x1F5
  5494 000046FC C1C008              <1> 	rol eax, 8
  5495 000046FF B000                <1> 	mov al, 0
  5496 00004701 EE                  <1> 	out dx, al	;;6th byte
  5497 00004702 C1C810              <1> 	ror eax, 16
  5498 00004705 EE                  <1> 	out dx, al	;;3rd byte
  5499 00004706 B840000000          <1> 	mov eax, 0x40
  5500 0000470B 66BAF601            <1> 	mov dx, 0x1F6
  5501 0000470F EE                  <1> 	out dx, al	;;send magic bits-add drive indicator later
  5502 00004710 B024                <1> 	mov al, 0x24
  5503 00004712 66BAF701            <1> 	mov dx, 0x1F7
  5504 00004716 EE                  <1> 	out dx, al	;;READ!!!
  5505                              <1> diskrwait:
  5506 00004717 66BAF701            <1> 	mov dx, 0x1F7
  5507 0000471B EC                  <1> 	in al, dx
  5508 0000471C 2408                <1> 	and al, 0x08
  5509 0000471E 3C08                <1> 	cmp al, 0x08
  5510 00004720 75F5                <1> 	jne diskrwait
  5511 00004722 88CD                <1> 	mov ch, cl	;;move sector data into ch, multiplying it by 256
  5512 00004724 B100                <1> 	mov cl, 0
  5513                              <1> diskdataread:
  5514 00004726 66BAF001            <1> 	mov dx, 0x1F0
  5515 0000472A 66ED                <1> 	in ax, dx
  5516 0000472C 668906              <1> 	mov [esi], ax
  5517 0000472F 81C602000000        <1> 	add esi, 2
  5518 00004735 6649                <1> 	dec cx
  5519 00004737 6681F90000          <1> 	cmp cx, 0
  5520 0000473C 75E8                <1> 	jne diskdataread		;;read all sectors
  5521 0000473E 89F7                <1> 	mov edi, esi
  5522 00004740 8B15[8C470000]      <1> 	mov edx, [lbaadend]
  5523 00004746 8B35[94470000]      <1> 	mov esi, [bufferstartesi]
  5524 0000474C 8B1D[90470000]      <1> 	mov ebx, [lbaadstartebx]
  5525 00004752 C3                  <1> 	ret
  5526                              <1> 	
  5527                              <1> 	
  5528                              <1> diskold: ;;28 bits
  5529 00004753 66B80000            <1> 	mov ax, 0
  5530 00004757 66BAF101            <1> 	mov dx, 0x1F1
  5531 0000475B EE                  <1> 	out dx, al	;;send null byte to port
  5532 0000475C 6642                <1> 	inc dx	;;0x1F2
  5533 0000475E 88C8                <1> 	mov al, cl	;;get sector count
  5534 00004760 EE                  <1> 	out dx, al	;;send sector count
  5535 00004761 6642                <1> 	inc dx	;;0x1F3
  5536 00004763 88D8                <1> 	mov al, bl	;;get first 8 bits of address
  5537 00004765 EE                  <1> 	out dx, al	;;send them
  5538 00004766 6642                <1> 	inc dx	;;0x1F4
  5539 00004768 C1CB08              <1> 	ror ebx, 8	;;get next 8 bits
  5540 0000476B 88D8                <1> 	mov al, bl
  5541 0000476D EE                  <1> 	out dx, al
  5542 0000476E 6642                <1> 	inc dx	;;0x1F5
  5543 00004770 C1CB08              <1> 	ror ebx, 8	;;again
  5544 00004773 88D8                <1> 	mov al, bl
  5545 00004775 EE                  <1> 	out dx, al
  5546 00004776 6642                <1> 	inc dx	;;0x1F6
  5547 00004778 C1CB08              <1> 	ror ebx, 8
  5548 0000477B 88D8                <1> 	mov al, bl
  5549 0000477D 240F                <1> 	and al, 00001111b	;;last 4 bits of address
  5550 0000477F 0CE0                <1> 	or al, 0xE0			;;majic number
  5551 00004781 C0E504              <1> 	shl ch, 4
  5552 00004784 08E8                <1> 	or al, ch
  5553 00004786 EE                  <1> 	out dx, al			;;send drive indicator, magic bits, and highest 4 bits of address
  5554 00004787 6642                <1> 	inc dx	;;0x1F7
  5555 00004789 B020                <1> 	mov al, 0x20
  5556 0000478B EE                  <1> 	out dx, al			;;execute read command
  5557                              <1> 	
  5558 0000478C 00000000            <1> lbaadend dd 0
  5559 00004790 00000000            <1> lbaadstartebx dd 0
  5560 00004794 00000000            <1> bufferstartesi dd 0
  5561                                      %include 'fileindex.asm'
  5562                              <1> diskfileindex:
  5563 00004798 65787000            <1> db "exp",0
  5564 0000479C 2A000000            <1> dd (f0-$$)/512
  5565 000047A0 01000000            <1> dd (f1-f0)/512
  5566 000047A4 736F6C6C65726F732E- <1> db "solleros.bmp",0
  5567 000047AD 626D7000            <1>
  5568 000047B1 2B000000            <1> dd (f1-$$)/512
  5569 000047B5 B0020000            <1> dd (f2-f1)/512
  5570 000047B9 736F6C6C65726F732E- <1> db "solleros.txt",0
  5571 000047C2 74787400            <1>
  5572 000047C6 DB020000            <1> dd (f2-$$)/512
  5573 000047CA 01000000            <1> dd (f3-f2)/512
  5574 000047CE 74656C7900          <1> db "tely",0
  5575 000047D3 DC020000            <1> dd (f3-$$)/512
  5576 000047D7 01000000            <1> dd (f4-f3)/512
  5577 000047DB 5468756D62732E6462- <1> db "Thumbs.db",0
  5578 000047E4 00                  <1>
  5579 000047E5 DD020000            <1> dd (f4-$$)/512
  5580 000047E9 1F000000            <1> dd (f5-f4)/512
  5581 000047ED 74696D6500          <1> db "time",0
  5582 000047F2 FC020000            <1> dd (f5-$$)/512
  5583 000047F6 02000000            <1> dd (f6-f5)/512
  5584 000047FA 7475746F7269616C2E- <1> db "tutorial.bat",0
  5585 00004803 62617400            <1>
  5586 00004807 FE020000            <1> dd (f6-$$)/512
  5587 0000480B 03000000            <1> dd (f7-f6)/512
  5588                              <1> enddiskfileindex:
  5589                              <1> 
  5590                                  	%include 'source/msg.asm'
  5591 0000480F 6578697400          <1> 	exitmsg db	"exit",0
  5592 00004814 50726F6772616D2022- <1> 	notfound1 db "Program ",34,0
  5593 0000481D 00                  <1>
  5594 0000481E 22206E6F7420666F75- <1> 	notfound2 db  34," not found.",13,10,0
  5595 00004827 6E642E0D0A00        <1>
  5596 0000482D 757365726E616D653A- <1> 	userask db "username:",0
  5597 00004836 00                  <1>
  5598 00004837 70617373776F72643A- <1> 	pwdask	db	"password:",0
  5599 00004840 00                  <1>
  5600 00004841 40536F6C6C65724F53- <1> 	location	db	"@SollerOS]#",0
  5601 0000484A 5D2300              <1>
  5602 0000484D 0D0A00              <1> 	line	db	13,10,0
  5603                              <1>     ;msg:       db "SollerOS Beta version 0.9.0 - compiled by Jeremy Soller.",13,10,0
  5604                              <1> 	userlst:
  5605 00004850 7573657200          <1> 			db "user",0
  5606 00004855 70617373776F726400  <1> 			db "password",0
  5607 0000485E 726F6F7400          <1> 			db "root",0
  5608 00004863 617765736F6D65706F- <1> 			db "awesomepower",0
  5609 0000486C 77657200            <1>
  5610                              <1> 	userlstend:
  5611                              <1> 	
  5612 0000486C <incbin>            <1> fonts:	incbin 'source/precompiled/fonts.pak'
  5613                              <1> fontend2:
  5614                              <1> mcursor:
  5615 00005080 01                  <1> 	db	00000001b
  5616 00005081 81                  <1> 	db	10000001b
  5617 00005082 C1                  <1> 	db	11000001b
  5618 00005083 E1                  <1> 	db	11100001b
  5619 00005084 F1                  <1> 	db	11110001b
  5620 00005085 F9                  <1> 	db	11111001b
  5621 00005086 FD                  <1> 	db	11111101b
  5622 00005087 FF                  <1> 	db	11111111b
  5623 00005088 F9                  <1> 	db	11111001b
  5624 00005089 B9                  <1> 	db	10111001b
  5625 0000508A 39                  <1> 	db	00111001b
  5626 0000508B 1C                  <1> 	db	00011100b
  5627 0000508C 1C                  <1> 	db	00011100b
  5628 0000508D 0E                  <1> 	db	00001110b
  5629 0000508E 0E                  <1> 	db	00001110b
  5630 0000508F 0C                  <1> 	db	00001100b
  5631                              <1> fontend:
  5632                              <1> 
  5633                              <1> ;cursorbmp:
  5634                              <1> ;	db	1,0,0,0,0,0,0,0
  5635                              <1> ;	db	1,1,0,0,0,0,0,0
  5636                              <1> ;	db	1,1,1,0,0,0,0,0
  5637                              <1> ;	db	1,1,1,1,0,0,0,0
  5638                              <1> ;	db	1,1,1,1,1,0,0,0
  5639                              <1> ;	db	1,1,1,1,1,1,0,0
  5640                              <1> ;	db	1,1,1,1,1,1,1,0
  5641                              <1> ;	db	1,1,1,1,1,1,1,1
  5642                              <1> ;	db	1,1,1,1,1,1,0,0
  5643                              <1> ;	db	1,1,0,1,1,1,0,0
  5644                              <1> ;	db	1,0,0,1,1,1,0,0
  5645                              <1> ;	db	0,0,0,0,1,1,1,0
  5646                              <1> ;	db	0,0,0,0,1,1,1,0
  5647                              <1> ;	db	0,0,0,0,0,1,1,1
  5648                              <1> ;	db	0,0,0,0,0,1,1,1
  5649                              <1> ;	db	0,0,0,0,0,1,1,0
  5650                              <1> ;cursorbmpend:
  5651                              <1> 
  5652                              <1> 
  5653                              <1> VBEMODEBLOCK:
  5654 00005090 00<rept>            <1> vbesignature 		times 4 db 0	;VBE Signature
  5655 00005094 00<rept>            <1> vbeversion  		times 2 db 0	;VBE Version
  5656 00005096 00<rept>            <1> oemstringptr  		times 4 db 0	;Pointer to OEM String
  5657 0000509A 00<rept>            <1> capabilities 		times 4 db 0	;Capabilities of graphics cont.
  5658 0000509E 00<rept>            <1> videomodeptr 		times 4 db 0	;Pointer to Video Mode List
  5659 000050A2 00<rept>            <1> totalmemory   		times 2 db 0	;number of 64Kb memory blocks
  5660 000050A4 00<rept>            <1> oemsoftwarerev  	times 2 db 0	;VBE implementation Software revision
  5661 000050A6 00<rept>            <1> oemvendornameptr 	times 4 db 0	;Pointer to Vendor Name String
  5662 000050AA 00<rept>            <1> oemproductnameptr 	times 4 db 0	;Pointer to Product Name String
  5663 000050AE 00<rept>            <1> oemproductrevptr 	times 4 db 0	;Pointer to Product Revision String
  5664 000050B2 00<rept>            <1> reserved			times 222 db 0	;Reserved for VBE implementation scratch area
  5665 00005190 00<rept>            <1> oemdata 			times 256 db 0	;Data Area for OEM Strings
  5666                              <1> 
  5667                              <1> 
  5668                              <1> VBEMODEINFOBLOCK:
  5669                              <1> ;Mandatory information for all VBE revision
  5670 00005290 00<rept>            <1> modeattributes   	times 2 db 0	;Mode attributes
  5671 00005292 00                  <1> winaattributes   	times 1 db 0	;Window A attributes
  5672 00005293 00                  <1> winbattributes   	times 1 db 0	;Window B attributes
  5673 00005294 00<rept>            <1> wingranularity   	times 2 db 0	;Window granularity
  5674 00005296 00<rept>            <1> winsize          	times 2 db 0	;Window size
  5675 00005298 00<rept>            <1> winasegment      	times 2 db 0	;Window A start segment
  5676 0000529A 00<rept>            <1> winbsegment      	times 2 db 0	;Window B start segment
  5677 0000529C 00<rept>            <1> winfuncptr       	times 4 db 0	;pointer to window function
  5678 000052A0 00<rept>            <1> bytesperscanline 	times 2 db 0	;Bytes per scan line
  5679                              <1> 
  5680                              <1> ;Mandatory information for VBE 1.2 and above
  5681 000052A2 00<rept>            <1> xresolution     	times 2 db 0	;Horizontal resolution in pixel or chars
  5682 000052A4 00<rept>            <1> yresolution	    	times 2 db 0	;Vertical resolution in pixel or chars
  5683 000052A6 00                  <1> xcharsize       	times 1 db 0	;Character cell width in pixel
  5684 000052A7 00                  <1> ycharsize       	times 1 db 0	;Character cell height in pixel
  5685 000052A8 00                  <1> numberofplanes  	times 1 db 0	;Number of memory planes
  5686 000052A9 00                  <1> bitsperpixel    	times 1 db 0	;Bits per pixel
  5687 000052AA 00                  <1> numberofbanks   	times 1 db 0	;Number of banks
  5688 000052AB 00                  <1> memorymodel     	times 1 db 0	;Memory model type
  5689 000052AC 00                  <1> banksize        	times 1 db 0	;Bank size in KB
  5690 000052AD 00                  <1> numberofimagepages	times 1 db 0	;Number of images
  5691 000052AE 00                  <1> reserved1       	times 1 db 0	;Reserved for page function
  5692                              <1> 
  5693                              <1> ;Direct Color fields (required for direct/6 and YUV/7 memory models)
  5694 000052AF 00                  <1> redmasksize			times 1 db 0	;Size of direct color red mask in bits
  5695 000052B0 00                  <1> redfieldposition	times 1 db 0	;Bit position of lsb of red bask
  5696 000052B1 00                  <1> greenmasksize   	times 1 db 0	;Size of direct color green mask in bits
  5697 000052B2 00                  <1> greenfieldposition	times 1 db 0	;Bit position of lsb of green bask
  5698 000052B3 00                  <1> bluemasksize		times 1 db 0	;Size of direct color blue mask in bits
  5699 000052B4 00                  <1> bluefieldposition	times 1 db 0	;Bit position of lsb of blue bask
  5700 000052B5 00                  <1> rsvdmasksize        times 1	db 0	;Size of direct color reserved mask in bits
  5701 000052B6 00                  <1> rsvdfieldposition	times 1	db 0	;Bit position of lsb of reserved bask
  5702 000052B7 00                  <1> directcolormodeinfo	times 1 db 0	;Direct color mode attributes
  5703                              <1> 
  5704                              <1> ;Mandatory information for VBE 2.0 and above
  5705 000052B8 00<rept>            <1> physbaseptr 		times 4 db 0	;Physical address for flat frame buffer
  5706 000052BC 00<rept>            <1> offscreenmemoffset 	times 4 db 0	;Pointer to start of off screen memory
  5707 000052C0 00<rept>            <1> offscreenmemsize 	times 2 db 0    ;Amount of off screen memory in 1Kb units
  5708 000052C2 00<rept>            <1> reserved2 			times 206 db 0  ;Remainder of ModeInfoBlock
  5709                                  	;%include 'source/memory.asm'
  5710                                  	%include 'source/buf.asm'
  5711                              <1> [section .bss]
  5712                              <1> bssstart:
  5713                              <1> stack:
  5714 00000000 <res 00001000>      <1> 	resb 4096
  5715                              <1> stackend:
  5716                              <1> graphicstable: ;w type, dw datalocation, w locationx, w locationy, w selected, dw code
  5717 00001000 <res 00000200>      <1> 	resb 200h 
  5718                              <1> 	graphicstableend:
  5719                              <1> mousecolorbuf: ;where the gui under the mouse is stored
  5720 00001200 <res 00000100>      <1> 	resb 256 
  5721                              <1> mcolorend:
  5722 00001300 <res 00000001>      <1> IFON resb 1 
  5723 00001301 <res 00000064>      <1> IFTRUE resb 100 
  5724 00001365 <res 00000004>      <1> BATCHPOS resb 4 
  5725 00001369 <res 00000001>      <1> BATCHISON resb 1 
  5726 0000136A <res 00000001>      <1> LOOPON resb 1 
  5727 0000136B <res 00000004>      <1> LOOPPOS	resb 4 
  5728 0000136F <res 00000200>      <1> fileindex: resb 200h 
  5729                              <1> fileindexend:
  5730 0000156F <res 00000500>      <1> variables: 	resb 500h 
  5731 00001A6F <res 00000001>      <1> varend: resb 1
  5732 00001A70 <res 00000200>      <1> buftxt2: resb 200h
  5733 00001C70 <res 00000200>      <1> buftxt: resb 200h 
  5734 00001E70 <res 00000014>      <1> buf2:	resb 20 
  5735 00001E84 <res 00000001>      <1> numbuf: resb 1 
  5736 00001E85 <res 000012C0>      <1> videobuf2 		resb 0x12C0 
  5737 00003145 <res 000000C8>      <1> videobufend		resb 200 
  5738                              <1> ;processcache:	;;eip, eax, ebx, ecx, edx, edi, esi, esp, ebp-9*4=36 bytes each
  5739                              <1> ;processcacheend:
  5740                              <1> ;alignb 4096		;;align 4 kbytes
  5741                              <1> ;ospagedir:
  5742                              <1> ;	resb 4096
  5743                              <1> ;ospagedirend:
  5744                              <1> ;pagetables:
  5745                              <1> ;	resb 4096
  5746 0000320D <res 00000004>      <1> lastcommandpos: resb 4
  5747 00003211 <res 00000004>      <1> currentcommandpos: resb 4
  5748                              <1> commandbuf:
  5749 00003215 <res 00000400>      <1> resb 1024
  5750                              <1> commandbufend:
  5751                              <1> rbuffstart: ;for use with networking
  5752 00003615 <res 00002014>      <1> resb 8212
  5753                              <1> bssend:
  5754                              <1> [section .text]
  5755                                      %include 'files.asm'
  5756 00005390 00<rept>            <1> align 512,db 0
  5757                              <1> f0:
  5758 00005390 <incbin>            <1> incbin "included/exp"
  5759 00005422 00<rept>            <1> align 512,db 0
  5760                              <1> f1:
  5761 00005422 <incbin>            <1> incbin "included/solleros.bmp"
  5762 0005B5E6 00<rept>            <1> align 512,db 0
  5763                              <1> f2:
  5764 0005B5E6 <incbin>            <1> incbin "included/solleros.txt"
  5765 0005B776 00<rept>            <1> align 512,db 0
  5766                              <1> f3:
  5767 0005B776 <incbin>            <1> incbin "included/tely"
  5768 0005B9BD 00<rept>            <1> align 512,db 0
  5769                              <1> f4:
  5770 0005B9BD <incbin>            <1> incbin "included/Thumbs.db"
  5771                              <1> align 512,db 0
  5772                              <1> f5:
  5773 0005B9BD <incbin>            <1> incbin "included/time"
  5774 0005FA7B 00<rept>            <1> align 512,db 0
  5775                              <1> f6:
  5776 0005FA7B <incbin>            <1> incbin "included/tutorial.bat"
  5777 000600AA 00<rept>            <1> align 512,db 0
  5778                              <1> f7:
