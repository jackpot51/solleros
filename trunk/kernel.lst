     1                                  [BITS 16]
     2                                      %include 'source/menu.asm'
     3                              <1>     ; MENU.ASM
     4                              <1> menustart:	
     5 00000000 8CC8                <1> 	    mov ax, cs
     6 00000002 E90400              <1> 	    jmp mainindex	;;this command gives the solleros user the location of mainindex
     7 00000005 4A525300            <1> 	    db "JRS",0	;;this gives the bootloader a key to look for
     8                              <1> mainindex:
     9 00000009 E90000              <1> 	    jmp mainindexdn	;;this gives the size of the index
    10                              <1> 	    ;not needed;dw 0405h,progstart,batchprogend,fileindex,fileindexend,variables,varend,nwcmd,int30h,physbaseptr,0
    11                              <1> mainindexdn:
    12 0000000C 8ED8                <1> 	mov ds, ax
    13 0000000E 8EC0                <1> 	mov es, ax
    14 00000010 8ED0                <1> 	mov ss, ax
    15 00000012 880E[2B00]          <1> 	mov [DriveNumber], cl
    16 00000016 668916[2C00]        <1> 	mov [lbaad], edx
    17 0000001B B800A0              <1> 	mov ax, 0xA000
    18 0000001E 8EE8                <1> 	mov gs, ax
    19 00000020 B81200              <1> 	mov ax, 12h
    20 00000023 BB0000              <1> 	mov bx, 0
    21 00000026 CD10                <1> 	int 10h
    22 00000028 E90900              <1> 	jmp guiload
    23                              <1> 
    24 0000002B 00                  <1> DriveNumber db 0
    25 0000002C 00000000            <1> lbaad dd 0
    26                              <1> 	
    27 00000030 0000                <1> vesamode dw 0
    28 00000032 0000                <1> videomodecache dw 0
    29                              <1> 
    30                              <1> guiload:
    31 00000034 BE[5802]            <1> 	mov si, bootmsg
    32 00000037 E83301              <1> 	call printrm
    33 0000003A B80000              <1> 	mov ax, 0
    34 0000003D CD16                <1> 	int 16h
    35 0000003F 3C79                <1> 	cmp al, "y"
    36 00000041 0F85F400            <1> 	jne near guiload2
    37                              <1> guiloadagain:
    38 00000045 B8004F              <1> 	mov ax, 04F00h
    39 00000048 BF[C449]            <1> 	mov di, VBEMODEBLOCK
    40 0000004B CD10                <1> 	int 10h
    41 0000004D BE[E649]            <1> 	mov si, reserved
    42 00000050 81EE0200            <1> 	sub si, 2
    43                              <1> findvideomodes:
    44 00000054 81C60200            <1> 	add si, 2
    45 00000058 8B0C                <1> 	mov cx, [si]
    46 0000005A 81F9FFFF            <1> 	cmp cx, 0xFFFF
    47 0000005E 0F840A00            <1> 	je near nextvmode
    48 00000062 81FE[C44A]          <1> 	cmp si, oemdata
    49 00000066 0F83CF00            <1> 	jae near guiload2	;;kill if no valid list is found
    50 0000006A EBE8                <1> 	jmp findvideomodes 	
    51                              <1> ;;debug,shows vmodes available
    52                              <1> nextvmode:
    53 0000006C 81EE0200            <1> 	sub si, 2
    54 00000070 81FE[E649]          <1> 	cmp si, reserved
    55 00000074 0F82CDFF            <1> 	jb near guiloadagain
    56 00000078 8B0C                <1> 	mov cx, [si]
    57 0000007A 81F9FFFF            <1> 	cmp cx, 0xFFFF
    58 0000007E 0F84EAFF            <1> 	je near nextvmode
    59 00000082 81C10040            <1> 	add cx, 0x4000 		;;Linear Frame Buffer
    60 00000086 B8014F              <1> 	mov ax, 04F01h
    61 00000089 BF[C44B]            <1> 	mov di, VBEMODEINFOBLOCK
    62 0000008C 890E[3000]          <1> 	mov [vesamode], cx
    63 00000090 CD10                <1> 	int 10h
    64 00000092 A0[DD4B]            <1> 	mov al, [bitsperpixel]
    65 00000095 3C10                <1> 	cmp al, 16
    66 00000097 75D3                <1> 	jne nextvmode
    67 00000099 8936[3200]          <1> 	mov [videomodecache], si
    68 0000009D 80FC00              <1> 	cmp ah, 0
    69 000000A0 0F842200            <1> 	je near setvesamode
    70 000000A4 EBC6                <1> 	jmp nextvmode
    71 000000A6 0A0D49732074686973- <1> isthisvideook db 10,13,"Is this video mode OK?(y/n)",13,10,0
    72 000000AF 20766964656F206D6F- <1>
    73 000000B8 6465204F4B3F28792F- <1>
    74 000000C1 6E290D0A00          <1>
    75                              <1> setvesamode:
    76 000000C6 8B0E[D64B]          <1> 	mov cx, [xresolution]
    77 000000CA E8B800              <1> 	call decshow
    78 000000CD B078                <1> 	mov al, "x"
    79 000000CF E82001              <1> 	call char
    80 000000D2 8B0E[D84B]          <1> 	mov cx, [yresolution]
    81 000000D6 E8AC00              <1> 	call decshow
    82 000000D9 B040                <1> 	mov al, "@"
    83 000000DB E81401              <1> 	call char
    84 000000DE 8A0E[DD4B]          <1> 	mov cl, [bitsperpixel]
    85 000000E2 E8A000              <1> 	call decshow
    86 000000E5 BE[A600]            <1> 	mov si, isthisvideook
    87 000000E8 E88200              <1> 	call printrm
    88 000000EB B80000              <1> 	mov ax, 0
    89 000000EE CD16                <1> 	int 16h
    90 000000F0 8B36[3200]          <1> 	mov si, [videomodecache]
    91 000000F4 3C79                <1> 	cmp al, "y"
    92 000000F6 0F8572FF            <1> 	jne near nextvmode
    93 000000FA 8B16[D64B]          <1> 	mov dx, [xresolution]
    94 000000FE 8B0E[D84B]          <1> 	mov cx, [yresolution]
    95 00000102 8916[4137]          <1> 	mov [resolutionx], dx
    96 00000106 890E[3F37]          <1> 	mov [resolutiony], cx
    97 0000010A 01D2                <1> 	add dx, dx
    98 0000010C 8916[4337]          <1> 	mov [resolutionx2], dx
    99 00000110 BA0000              <1> 	mov dx, 0
   100 00000113 B90000              <1> 	mov cx, 0
   101 00000116 B8024F              <1> 	mov ax, 04F02h
   102 00000119 8B1E[3000]          <1> 	mov bx, [vesamode]
   103 0000011D CD10                <1> 	int 10h		;;enter VESA mode
   104 0000011F C606[6C01]00        <1> 	mov byte [guinodo], 0
   105 00000124 6631C0              <1> 	xor eax, eax
   106 00000127 6631DB              <1> 	xor ebx, ebx
   107 0000012A 6631C9              <1> 	xor ecx, ecx
   108 0000012D 6631D2              <1> 	xor edx, edx
   109 00000130 6631F6              <1> 	xor esi, esi
   110 00000133 6631FF              <1> 	xor edi, edi	;;reset registers
   111 00000136 E93901              <1> 	jmp pmode
   112                              <1> guiload2:
   113 00000139 B9E001              <1> 	mov cx, 480
   114 0000013C BA8002              <1> 	mov dx, 640
   115 0000013F 8916[4137]          <1> 	mov [resolutionx], dx
   116 00000143 01D2                <1> 	add dx, dx
   117 00000145 8916[4337]          <1> 	mov [resolutionx2], dx
   118 00000149 890E[3F37]          <1> 	mov [resolutiony], cx
   119 0000014D B81200              <1> 	mov ax, 12h
   120 00000150 BB0000              <1> 	mov bx, 0
   121 00000153 CD10                <1> 	int 10h
   122 00000155 C606[6C01]01        <1> 	mov byte [guinodo], 1
   123 0000015A 6631DB              <1> 	xor ebx, ebx
   124 0000015D 6631C9              <1> 	xor ecx, ecx
   125 00000160 6631D2              <1> 	xor edx, edx
   126 00000163 6631F6              <1> 	xor esi, esi
   127 00000166 6631FF              <1> 	xor edi, edi
   128 00000169 E90601              <1> 	jmp pmode
   129                              <1> ;;	jmp gui ;;test vesa
   130                              <1> 
   131 0000016C 00                  <1> guinodo db 0
   132                              <1> 
   133                              <1>     printrm:			; 'si' comes in with string address
   134 0000016D BB0700              <1> 	    mov bx,07		; write to display
   135 00000170 B40E                <1> 	    mov ah,0Eh		; screen function
   136 00000172 8A04                <1>     prs2:    mov al,[si]         ; get next character
   137 00000174 3C00                <1> 	    cmp al,0		; look for terminator 
   138 00000176 7405                <1>             je finpr2		; zero byte at end of string
   139 00000178 CD10                <1> 	    int 10h		; write character to screen.    
   140 0000017A 46                  <1>      	    inc si	     	; move to next character
   141 0000017B EBF5                <1> 	    jmp prs2		; loop
   142 0000017D C3                  <1>     finpr2: ret
   143                              <1> 
   144 0000017E 0000000000          <1> dcnm db 0,0,0,0,0
   145 00000183 0000                <1> dcnmend db 0,0
   146                              <1> 
   147                              <1> 
   148                              <1> decshow:
   149 00000185 BE[7E01]            <1> 	mov si, dcnm
   150                              <1> decclear:
   151 00000188 B030                <1> 	mov al, "0"
   152 0000018A 8804                <1> 	mov [si], al
   153 0000018C 46                  <1> 	inc si
   154 0000018D 81FE[8301]          <1> 	cmp si, dcnmend
   155 00000191 76F5                <1> 	jbe decclear
   156 00000193 4E                  <1> 	dec si
   157 00000194 E81500              <1> 	call convertrm
   158 00000197 BE[7E01]            <1> 	mov si, dcnm
   159                              <1> dectst:
   160 0000019A 8A04                <1> 	mov al, [si]
   161 0000019C 46                  <1> 	inc si
   162 0000019D 81FE[8301]          <1> 	cmp si, dcnmend
   163 000001A1 7704                <1> 	ja dectstend
   164 000001A3 3C30                <1> 	cmp al, "0"
   165 000001A5 76F3                <1> 	jbe dectst
   166                              <1> dectstend:
   167 000001A7 4E                  <1> 	dec si
   168 000001A8 E8C2FF              <1> 	call printrm
   169 000001AB C3                  <1> 	ret
   170                              <1> 	
   171                              <1> 	
   172                              <1> convertrm:
   173 000001AC 4E                  <1> 	dec si
   174 000001AD 89F3                <1> 	mov bx, si		;place to convert into must be in si, number to convert must be in cx
   175                              <1> cnvrtrm:
   176 000001AF 89DE                <1> 	mov si, bx
   177 000001B1 81EE0300            <1> 	sub si, 3
   178 000001B5 46                  <1> ten3rm:	inc si
   179 000001B6 81F9E803            <1> 	cmp cx, 1000
   180 000001BA 7208                <1> 	jb ten2rm
   181 000001BC 81E9E803            <1> 	sub cx, 1000
   182 000001C0 FE04                <1> 	inc byte [si]
   183 000001C2 EBEB                <1> 	jmp cnvrtrm
   184 000001C4 46                  <1> ten2rm:	inc si
   185 000001C5 81F96400            <1> 	cmp cx, 100
   186 000001C9 7208                <1> 	jb ten1rm
   187 000001CB 81E96400            <1> 	sub cx, 100
   188 000001CF FE04                <1> 	inc byte [si]
   189 000001D1 EBDC                <1> 	jmp cnvrtrm
   190 000001D3 46                  <1> ten1rm:	inc si
   191 000001D4 81F90A00            <1> 	cmp cx, 10
   192 000001D8 7208                <1> 	jb ten0rm
   193 000001DA 81E90A00            <1> 	sub cx, 10
   194 000001DE FE04                <1> 	inc byte [si]
   195 000001E0 EBCD                <1> 	jmp cnvrtrm
   196 000001E2 46                  <1> ten0rm:	inc si
   197 000001E3 81F90100            <1> 	cmp cx, 1
   198 000001E7 7208                <1> 	jb tendnrm
   199 000001E9 81E90100            <1> 	sub cx, 1
   200 000001ED FE04                <1> 	inc byte [si]
   201 000001EF EBBE                <1> 	jmp cnvrtrm
   202                              <1> tendnrm:
   203 000001F1 C3                  <1> 	ret
   204                              <1> 
   205                              <1> 
   206                              <1> 
   207                              <1> 
   208                              <1>     char: 		    ;char must be in al
   209 000001F2 BB0700              <1>            mov bx, 07
   210 000001F5 B40E                <1> 	   mov ah, 0Eh
   211 000001F7 CD10                <1> 	   int 10h
   212 000001F9 C3                  <1> 	    ret
   213                              <1> 
   214                              <1> 		shutdown:
   215 000001FA E84B00              <1> 			call realmode	
   216 000001FD B80053              <1> 			MOV AX, 5300h	; Shuts down APM-Machines.
   217 00000200 31DB                <1> 			XOR BX, BX	; Newer machines automatically
   218 00000202 CD15                <1> 			INT 15h		; shut down
   219 00000204 B80453              <1> 			MOV AX, 5304h
   220 00000207 31DB                <1> 			XOR BX, BX
   221 00000209 CD15                <1> 			INT 15h		; Interrupt 15h originally was
   222 0000020B B80153              <1> 			MOV AX, 5301h	; used for Cartridges (cassettes)
   223 0000020E 31DB                <1> 			XOR BX, BX	; but is still in use for
   224 00000210 CD15                <1> 			INT 15h		; diverse things
   225 00000212 B80753              <1> 			MOV AX, 5307h
   226 00000215 BB0100              <1> 			MOV BX, 1
   227 00000218 B90300              <1> 			MOV CX, 3
   228 0000021B CD15                <1> 			INT 15h
   229 0000021D CF                  <1> 			IRET
   230                              <1> 
   231                              <1> 	coldboot:
   232 0000021E E82700              <1> 			call realmode
   233 00000221 B84000              <1> 			MOV AX, 0040h
   234 00000224 8EC0                <1> 			MOV ES, AX
   235 00000226 26C70672000000      <1> 			MOV WORD [ES:00072h], 0h
   236 0000022D EA0000FFFF          <1> 			JMP 0FFFFh:0000h
   237 00000232 CF                  <1> 			IRET
   238                              <1> 
   239                              <1> 		warmboot:
   240 00000233 E81200              <1> 			call realmode
   241 00000236 B84000              <1> 			MOV AX, 0040h
   242 00000239 8EC0                <1> 			MOV ES, AX
   243 0000023B 26C70672003412      <1> 			MOV WORD [ES:00072h], 01234h
   244 00000242 EA0000FFFF          <1> 			JMP 0FFFFh:0000h
   245 00000247 CF                  <1> 			IRET
   246                              <1> 
   247                              <1> 
   248                              <1> realmode:
   249 00000248 0F20C0              <1>    mov eax, cr0
   250 0000024B 24FE                <1>    and al,0xFE     ; back to realmode
   251 0000024D 0F22C0              <1>    mov  cr0, eax   ; by toggling bit again
   252 00000250 FB                  <1>    sti
   253                              <1> 
   254 00000251 66B800000000        <1>    mov eax, 0
   255 00000257 C3                  <1>    ret
   256                              <1>    
   257 00000258 426F6F7420696E746F- <1> bootmsg:	db "Boot into the GUI?(y/n)",10,13,0
   258 00000261 20746865204755493F- <1>
   259 0000026A 28792F6E290A0D00    <1>
   260                                      %include 'source/pmode.asm'
   261                              <1> [BITS 16]
   262                              <1> ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
   263                              <1> ;	16-bit real mode
   264                              <1> ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
   265                              <1> 
   266                              <1> pmode:
   267 00000272 BA9200              <1> 	mov dx, 0x92
   268 00000275 EC                  <1> 	in al, dx	;;A20
   269 00000276 0C02                <1> 	or al, 2
   270 00000278 EE                  <1> 	out dx, al
   271 00000279 6631DB              <1> 	xor ebx,ebx
   272 0000027C 8CCB                <1> 	mov bx,cs		; EBX=segment
   273 0000027E 66C1E304            <1> 	shl ebx,4		;	<< 4
   274 00000282 67668D03            <1> 	lea eax,[ebx]		; EAX=linear address of segment base
   275 00000286 A3[4707]            <1> 	mov [gdt2 + 2],ax
   276 00000289 A3[4F07]            <1> 	mov [gdt3 + 2],ax
   277 0000028C 66C1E810            <1> 	shr eax,16
   278 00000290 A2[4907]            <1> 	mov [gdt2 + 4],al
   279 00000293 A2[5107]            <1> 	mov [gdt3 + 4],al
   280 00000296 8826[4C07]          <1> 	mov [gdt2 + 7],ah
   281 0000029A 8826[5407]          <1> 	mov [gdt3 + 7],ah
   282 0000029E 66B8[00000000]      <1> 	mov eax, stack
   283 000002A4 A3[5707]            <1> 	mov [gdts + 2],ax
   284 000002A7 66C1E810            <1> 	shr eax,16
   285 000002AB A2[5907]            <1> 	mov [gdts + 4],al
   286 000002AE 8826[5C07]          <1> 	mov [gdts + 7],ah
   287                              <1> ; fix up gdt and idt
   288 000002B2 67668D83[35070000]  <1> 	lea eax,[ebx + gdt]	; EAX=linear address of gdt
   289 000002BA 66A3[2B07]          <1> 	mov [gdtr + 2],eax
   290 000002BE 67668D83[62070000]  <1> 	lea eax,[ebx + idt]	; EAX=linear address of idt
   291 000002C6 66A3[3107]          <1> 	mov [idtr + 2],eax
   292 000002CA FA                  <1> 	cli
   293 000002CB 0F0116[2907]        <1> 	lgdt [gdtr]
   294 000002D0 0F011E[2F07]        <1> 	lidt [idtr]
   295 000002D5 66BB00000000        <1> 	mov ebx, 0
   296 000002DB 8CDB                <1> 	mov bx, ds
   297 000002DD 66891E[5C03]        <1> 	mov [basecache], ebx
   298 000002E2 0F20C0              <1> 	mov eax,cr0
   299 000002E5 0C01                <1> 	or al,1
   300 000002E7 0F22C0              <1> 	mov cr0,eax
   301 000002EA EA[EF02]1000        <1> 	jmp SYS_CODE_SEL:do_pm
   302                              <1> [BITS 32]
   303                              <1> do_pm:
   304 000002EF 66B81800            <1> 	mov ax, SYS_DATA_SEL
   305 000002F3 8ED8                <1> 	mov ds,ax
   306 000002F5 66B82000            <1> 	mov ax, STACK_SEL
   307 000002F9 8ED0                <1> 	mov ss, ax
   308 000002FB BC00100000          <1> 	mov esp, 4096
   309 00000300 90                  <1> 	nop
   310 00000301 90                  <1> 	nop
   311 00000302 66B81800            <1> 	mov ax, SYS_DATA_SEL
   312 00000306 8EC0                <1> 	mov es,ax
   313 00000308 8EE0                <1> 	mov fs,ax
   314 0000030A 8EE8                <1> 	mov gs,ax
   315 0000030C B800000000          <1> 	mov eax, 0
   316 00000311 BE[00000000]        <1> 	mov esi, bssstart
   317                              <1> clearkernelbuffers:
   318 00000316 8906                <1> 	mov [esi], eax
   319 00000318 81C604000000        <1> 	add esi, 4
   320 0000031E 81FE[0D300000]      <1> 	cmp esi, bssend
   321 00000324 72F0                <1> 	jb clearkernelbuffers
   322                              <1> user1:
   323 00000326 8B3D[EC4B0000]      <1> 	mov edi, [physbaseptr]
   324 0000032C A1[5C030000]        <1> 	mov eax, [basecache]
   325 00000331 C1E004              <1> 	shl eax, 4
   326 00000334 29C7                <1> 	sub edi, eax
   327 00000336 893D[EC4B0000]      <1> 	mov [physbaseptr], edi
   328 0000033C E892100000          <1> 	call indexfiles
   329 00000341 803D[6C010000]00    <1> 	cmp byte [guinodo], 0
   330 00000348 0F8405000000        <1> 	je near guido
   331 0000034E E9D8090000          <1> 	jmp os
   332                              <1> 	
   333                              <1> guido:
   334 00000353 E971240000          <1> 	jmp gui
   335                              <1> 	
   336 00000358 00000000            <1> user2codepoint dw 0,0
   337 0000035C 00000000            <1> basecache dd 0
   338                              <1> 
   339                              <1> unhand:	
   340                              <1> 	%assign i 0
   341                              <1> 	%rep 40
   342                              <1> 	cli
   343                              <1> 	mov byte [intprob], i
   344                              <1> 	jmp unhand2
   345                              <1> 	%assign i i+1
   346                              <1> 	%endrep
   347 00000360 FA                  <2>  cli
   348 00000361 C605[65060000]00    <2>  mov byte [intprob], i
   349 00000368 E9FB010000          <2>  jmp unhand2
   350                              <2>  %assign i i+1
   351 0000036D FA                  <2>  cli
   352 0000036E C605[65060000]01    <2>  mov byte [intprob], i
   353 00000375 E9EE010000          <2>  jmp unhand2
   354                              <2>  %assign i i+1
   355 0000037A FA                  <2>  cli
   356 0000037B C605[65060000]02    <2>  mov byte [intprob], i
   357 00000382 E9E1010000          <2>  jmp unhand2
   358                              <2>  %assign i i+1
   359 00000387 FA                  <2>  cli
   360 00000388 C605[65060000]03    <2>  mov byte [intprob], i
   361 0000038F E9D4010000          <2>  jmp unhand2
   362                              <2>  %assign i i+1
   363 00000394 FA                  <2>  cli
   364 00000395 C605[65060000]04    <2>  mov byte [intprob], i
   365 0000039C E9C7010000          <2>  jmp unhand2
   366                              <2>  %assign i i+1
   367 000003A1 FA                  <2>  cli
   368 000003A2 C605[65060000]05    <2>  mov byte [intprob], i
   369 000003A9 E9BA010000          <2>  jmp unhand2
   370                              <2>  %assign i i+1
   371 000003AE FA                  <2>  cli
   372 000003AF C605[65060000]06    <2>  mov byte [intprob], i
   373 000003B6 E9AD010000          <2>  jmp unhand2
   374                              <2>  %assign i i+1
   375 000003BB FA                  <2>  cli
   376 000003BC C605[65060000]07    <2>  mov byte [intprob], i
   377 000003C3 E9A0010000          <2>  jmp unhand2
   378                              <2>  %assign i i+1
   379 000003C8 FA                  <2>  cli
   380 000003C9 C605[65060000]08    <2>  mov byte [intprob], i
   381 000003D0 E993010000          <2>  jmp unhand2
   382                              <2>  %assign i i+1
   383 000003D5 FA                  <2>  cli
   384 000003D6 C605[65060000]09    <2>  mov byte [intprob], i
   385 000003DD E986010000          <2>  jmp unhand2
   386                              <2>  %assign i i+1
   387 000003E2 FA                  <2>  cli
   388 000003E3 C605[65060000]0A    <2>  mov byte [intprob], i
   389 000003EA E979010000          <2>  jmp unhand2
   390                              <2>  %assign i i+1
   391 000003EF FA                  <2>  cli
   392 000003F0 C605[65060000]0B    <2>  mov byte [intprob], i
   393 000003F7 E96C010000          <2>  jmp unhand2
   394                              <2>  %assign i i+1
   395 000003FC FA                  <2>  cli
   396 000003FD C605[65060000]0C    <2>  mov byte [intprob], i
   397 00000404 E95F010000          <2>  jmp unhand2
   398                              <2>  %assign i i+1
   399 00000409 FA                  <2>  cli
   400 0000040A C605[65060000]0D    <2>  mov byte [intprob], i
   401 00000411 E952010000          <2>  jmp unhand2
   402                              <2>  %assign i i+1
   403 00000416 FA                  <2>  cli
   404 00000417 C605[65060000]0E    <2>  mov byte [intprob], i
   405 0000041E E945010000          <2>  jmp unhand2
   406                              <2>  %assign i i+1
   407 00000423 FA                  <2>  cli
   408 00000424 C605[65060000]0F    <2>  mov byte [intprob], i
   409 0000042B E938010000          <2>  jmp unhand2
   410                              <2>  %assign i i+1
   411 00000430 FA                  <2>  cli
   412 00000431 C605[65060000]10    <2>  mov byte [intprob], i
   413 00000438 E92B010000          <2>  jmp unhand2
   414                              <2>  %assign i i+1
   415 0000043D FA                  <2>  cli
   416 0000043E C605[65060000]11    <2>  mov byte [intprob], i
   417 00000445 E91E010000          <2>  jmp unhand2
   418                              <2>  %assign i i+1
   419 0000044A FA                  <2>  cli
   420 0000044B C605[65060000]12    <2>  mov byte [intprob], i
   421 00000452 E911010000          <2>  jmp unhand2
   422                              <2>  %assign i i+1
   423 00000457 FA                  <2>  cli
   424 00000458 C605[65060000]13    <2>  mov byte [intprob], i
   425 0000045F E904010000          <2>  jmp unhand2
   426                              <2>  %assign i i+1
   427 00000464 FA                  <2>  cli
   428 00000465 C605[65060000]14    <2>  mov byte [intprob], i
   429 0000046C E9F7000000          <2>  jmp unhand2
   430                              <2>  %assign i i+1
   431 00000471 FA                  <2>  cli
   432 00000472 C605[65060000]15    <2>  mov byte [intprob], i
   433 00000479 E9EA000000          <2>  jmp unhand2
   434                              <2>  %assign i i+1
   435 0000047E FA                  <2>  cli
   436 0000047F C605[65060000]16    <2>  mov byte [intprob], i
   437 00000486 E9DD000000          <2>  jmp unhand2
   438                              <2>  %assign i i+1
   439 0000048B FA                  <2>  cli
   440 0000048C C605[65060000]17    <2>  mov byte [intprob], i
   441 00000493 E9D0000000          <2>  jmp unhand2
   442                              <2>  %assign i i+1
   443 00000498 FA                  <2>  cli
   444 00000499 C605[65060000]18    <2>  mov byte [intprob], i
   445 000004A0 E9C3000000          <2>  jmp unhand2
   446                              <2>  %assign i i+1
   447 000004A5 FA                  <2>  cli
   448 000004A6 C605[65060000]19    <2>  mov byte [intprob], i
   449 000004AD E9B6000000          <2>  jmp unhand2
   450                              <2>  %assign i i+1
   451 000004B2 FA                  <2>  cli
   452 000004B3 C605[65060000]1A    <2>  mov byte [intprob], i
   453 000004BA E9A9000000          <2>  jmp unhand2
   454                              <2>  %assign i i+1
   455 000004BF FA                  <2>  cli
   456 000004C0 C605[65060000]1B    <2>  mov byte [intprob], i
   457 000004C7 E99C000000          <2>  jmp unhand2
   458                              <2>  %assign i i+1
   459 000004CC FA                  <2>  cli
   460 000004CD C605[65060000]1C    <2>  mov byte [intprob], i
   461 000004D4 E98F000000          <2>  jmp unhand2
   462                              <2>  %assign i i+1
   463 000004D9 FA                  <2>  cli
   464 000004DA C605[65060000]1D    <2>  mov byte [intprob], i
   465 000004E1 E982000000          <2>  jmp unhand2
   466                              <2>  %assign i i+1
   467 000004E6 FA                  <2>  cli
   468 000004E7 C605[65060000]1E    <2>  mov byte [intprob], i
   469 000004EE E975000000          <2>  jmp unhand2
   470                              <2>  %assign i i+1
   471 000004F3 FA                  <2>  cli
   472 000004F4 C605[65060000]1F    <2>  mov byte [intprob], i
   473 000004FB E968000000          <2>  jmp unhand2
   474                              <2>  %assign i i+1
   475 00000500 FA                  <2>  cli
   476 00000501 C605[65060000]20    <2>  mov byte [intprob], i
   477 00000508 E95B000000          <2>  jmp unhand2
   478                              <2>  %assign i i+1
   479 0000050D FA                  <2>  cli
   480 0000050E C605[65060000]21    <2>  mov byte [intprob], i
   481 00000515 E94E000000          <2>  jmp unhand2
   482                              <2>  %assign i i+1
   483 0000051A FA                  <2>  cli
   484 0000051B C605[65060000]22    <2>  mov byte [intprob], i
   485 00000522 E941000000          <2>  jmp unhand2
   486                              <2>  %assign i i+1
   487 00000527 FA                  <2>  cli
   488 00000528 C605[65060000]23    <2>  mov byte [intprob], i
   489 0000052F E934000000          <2>  jmp unhand2
   490                              <2>  %assign i i+1
   491 00000534 FA                  <2>  cli
   492 00000535 C605[65060000]24    <2>  mov byte [intprob], i
   493 0000053C E927000000          <2>  jmp unhand2
   494                              <2>  %assign i i+1
   495 00000541 FA                  <2>  cli
   496 00000542 C605[65060000]25    <2>  mov byte [intprob], i
   497 00000549 E91A000000          <2>  jmp unhand2
   498                              <2>  %assign i i+1
   499 0000054E FA                  <2>  cli
   500 0000054F C605[65060000]26    <2>  mov byte [intprob], i
   501 00000556 E90D000000          <2>  jmp unhand2
   502                              <2>  %assign i i+1
   503 0000055B FA                  <2>  cli
   504 0000055C C605[65060000]27    <2>  mov byte [intprob], i
   505 00000563 E900000000          <2>  jmp unhand2
   506                              <2>  %assign i i+1
   507                              <1> unhand2:
   508 00000568 60                  <1> 	pushad
   509 00000569 C705[58030000]0000- <1> 	mov dword [user2codepoint], 0
   510 00000571 0000                <1>
   511 00000573 89E6                <1> 	mov esi, esp
   512 00000575 81C628000000        <1> 	add esi, ((unhndrgend - unhndrg)/13)*4
   513 0000057B 8935[5B060000]      <1> 	mov [esploc], esi
   514 00000581 BE[66060000]        <1> 	mov esi, unhandmsg
   515 00000586 8935[5F060000]      <1> 	mov [esiloc], esi
   516 0000058C B900000000          <1> 	mov ecx, 0
   517 00000591 8A0D[65060000]      <1> 	mov cl, [intprob]
   518 00000597 E85A000000          <1> 	call expdump
   519                              <1> dumpstack:
   520 0000059C 8B35[5B060000]      <1> 	mov esi, [esploc]
   521 000005A2 39E6                <1> 	cmp esi, esp
   522 000005A4 7216                <1> 	jb donedump
   523 000005A6 368B0E              <1> 	mov ecx, [ss:esi]
   524 000005A9 81EE04000000        <1> 	sub esi, 4
   525 000005AF 8935[5B060000]      <1> 	mov [esploc], esi
   526 000005B5 E83C000000          <1> 	call expdump
   527 000005BA EBE0                <1> 	jmp dumpstack
   528                              <1> donedump:
   529 000005BC 8B35[5B060000]      <1> 	mov esi, [esploc]
   530 000005C2 368B7C2420          <1> 	mov edi, [ss:esp + 32]
   531 000005C7 8B4FFC              <1> 	mov ecx, [edi - 4]
   532 000005CA E827000000          <1> 	call expdump
   533 000005CF 8B35[5B060000]      <1> 	mov esi, [esploc]
   534 000005D5 368B7C2420          <1> 	mov edi, [ss:esp + 32]
   535 000005DA 8B0F                <1> 	mov ecx, [edi]
   536 000005DC E815000000          <1> 	call expdump
   537 000005E1 8B35[5B060000]      <1> 	mov esi, [esploc]
   538 000005E7 368B7C2420          <1> 	mov edi, [ss:esp + 32]
   539 000005EC 8B4F04              <1> 	mov ecx, [edi + 4]
   540 000005EF E802000000          <1> 	call expdump
   541 000005F4 EBFE                <1> 	jmp $
   542                              <1> expdump:
   543 000005F6 8B35[5F060000]      <1> 	mov esi, [esiloc]
   544 000005FC 89F7                <1> 	mov edi, esi
   545 000005FE 81C70D000000        <1> 	add edi, 13
   546 00000604 81C604000000        <1> 	add esi, 4
   547 0000060A 893D[5F060000]      <1> 	mov [esiloc], edi
   548 00000610 4F                  <1> 	dec edi
   549 00000611 E86D0B0000          <1> 	call converthex
   550 00000616 81EE04000000        <1> 	sub esi, 4
   551 0000061C 803D[23290000]00    <1> 	cmp byte [guion], 0
   552 00000623 0F8422000000        <1> 	je near expdumptext
   553 00000629 668B0D[63060000]    <1> 	mov cx, [locunhand]
   554 00000630 668105[63060000]10- <1> 	add word [locunhand], 16
   555 00000638 00                  <1>
   556 00000639 66BA0200            <1> 	mov dx, 2
   557 0000063D 66B80100            <1> 	mov ax, 1
   558 00000641 66BB0000            <1> 	mov bx, 0
   559 00000645 E89D2C0000          <1> 	call showstring
   560 0000064A C3                  <1> 	ret
   561                              <1> expdumptext:
   562 0000064B E815050000          <1> 	call print
   563 00000650 BE[81410000]        <1> 	mov esi, line
   564 00000655 E80B050000          <1> 	call print
   565 0000065A C3                  <1> 	ret
   566 0000065B 00000000            <1> esploc dd 0
   567 0000065F 00000000            <1> esiloc dd 0
   568 00000663 0100                <1> locunhand dw 1
   569 00000665 00                  <1> intprob db 0
   570                              <1> 	unhandmsg:	
   571 00000666 494E54203030303030- <1> 			db "INT 00000000",0
   572 0000066F 30303000            <1>
   573                              <1> unhndrg:
   574 00000673 45464C3D3030303030- <1> 			db "EFL=00000000",0
   575 0000067C 30303000            <1>
   576 00000680 43533A3D3030303030- <1> 			db "CS:=00000000",0
   577 00000689 30303000            <1>
   578 0000068D 4549503D3030303030- <1> 			db "EIP=00000000",0
   579 00000696 30303000            <1>
   580 0000069A 4541583D3030303030- <1> 			db "EAX=00000000",0
   581 000006A3 30303000            <1>
   582 000006A7 4543583D3030303030- <1> 			db "ECX=00000000",0
   583 000006B0 30303000            <1>
   584 000006B4 4544583D3030303030- <1> 			db "EDX=00000000",0
   585 000006BD 30303000            <1>
   586 000006C1 4542583D3030303030- <1> 			db "EBX=00000000",0
   587 000006CA 30303000            <1>
   588 000006CE 4553503D3030303030- <1> 			db "ESP=00000000",0
   589 000006D7 30303000            <1>
   590 000006DB 4542503D3030303030- <1> 			db "EBP=00000000",0
   591 000006E4 30303000            <1>
   592 000006E8 4553493D3030303030- <1> 			db "ESI=00000000",0
   593 000006F1 30303000            <1>
   594 000006F5 4544493D3030303030- <1> unhndrgend:	db "EDI=00000000",0
   595 000006FE 30303000            <1>
   596 00000702 434D443D3030303030- <1> 			db "CMD=00000000",0
   597 0000070B 30303000            <1>
   598 0000070F 434D443D3030303030- <1> 			db "CMD=00000000",0
   599 00000718 30303000            <1>
   600 0000071C 434D443D3030303030- <1> 			db "CMD=00000000",0
   601 00000725 30303000            <1>
   602                              <1> unhandmsgend:
   603                              <1> 
   604                              <1> [BITS 16]
   605                              <1> 
   606                              <1> ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
   607                              <1> ;	16-bit limit/32-bit linear base address of GDT and IDT
   608                              <1> ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
   609 00000729 2700                <1> gdtr:	dw gdt_end - gdt - 1	; GDT limit
   610 0000072B [35070000]          <1> 	dd gdt			; linear, physical address of GDT
   611                              <1> 
   612 0000072F 8701                <1> idtr:	dw idt_end - idt - 1	; IDT limit
   613 00000731 [62070000]          <1> 	dd idt			; linear, physical address of IDT
   614                              <1> 
   615                              <1> 
   616 00000735 0000                <1> gdt:	dw 0			; limit 15:0
   617 00000737 0000                <1> 	dw 0			; base 15:0
   618 00000739 00                  <1> 	db 0			; base 23:16
   619 0000073A 00                  <1> 	db 0			; type
   620 0000073B 00                  <1> 	db 0			; limit 19:16, flags
   621 0000073C 00                  <1> 	db 0			; base 31:24
   622                              <1> ; linear data segment descriptor
   623                              <1> LINEAR_SEL	equ	$-gdt
   624 0000073D FFFF                <1> 	dw 0xFFFF		; limit 0xFFFFF
   625 0000073F 0000                <1> 	dw 0			; base for this one is always 0
   626 00000741 00                  <1> 	db 0
   627 00000742 92                  <1> 	db 0x92			; present, ring 0, data, expand-up, writable
   628 00000743 CF                  <1> 	db 0xCF			; page-granular, 32-bit
   629 00000744 00                  <1> 	db 0
   630                              <1> ; code segment descriptor
   631                              <1> SYS_CODE_SEL	equ	$-gdt
   632 00000745 FFFF                <1> gdt2:	dw 0xFFFF
   633 00000747 0000                <1> 	dw 0			; (base gets set above)
   634 00000749 00                  <1> 	db 0
   635 0000074A 9A                  <1> 	db 0x9A			; present, ring 0, code, non-conforming, readable
   636 0000074B CF                  <1> 	db 0xCF
   637 0000074C 00                  <1> 	db 0
   638                              <1> ; data segment descriptor
   639                              <1> SYS_DATA_SEL	equ	$-gdt
   640 0000074D FFFF                <1> gdt3:	dw 0xFFFF
   641 0000074F 0000                <1> 	dw 0			; (base gets set above)
   642 00000751 00                  <1> 	db 0
   643 00000752 92                  <1> 	db 0x92			; present, ring 0, data, expand-up, writable
   644 00000753 CF                  <1> 	db 0xCF
   645 00000754 00                  <1> 	db 0
   646                              <1> STACK_SEL	equ	$-gdt
   647 00000755 0100                <1> gdts:	dw 1
   648 00000757 0000                <1> 	dw 0			; (base gets set above)
   649 00000759 00                  <1> 	db 0
   650 0000075A 92                  <1> 	db 0x92			; present, ring 0, data, expand-up, writable
   651 0000075B C0                  <1> 	db 0xC0
   652 0000075C 00                  <1> 	db 0
   653                              <1> gdt_end:
   654                              <1> ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
   655                              <1> ;	interrupt descriptor table (IDT)
   656                              <1> ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
   657                              <1> ; 32 reserved interrupts:
   658 0000075D 494454              <1> db "IDT"
   659 00000760 [6003]              <1> dw unhand
   660                              <1> idt:	
   661                              <1> %assign i 0
   662                              <1> %rep    48
   663                              <1>         dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   664                              <1> %assign i i+1 
   665                              <1> %endrep
   666 00000762 [6003]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   667                              <2> %assign i i+1
   668 0000076A [6D03]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   669                              <2> %assign i i+1
   670 00000772 [7A03]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   671                              <2> %assign i i+1
   672 0000077A [8703]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   673                              <2> %assign i i+1
   674 00000782 [9403]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   675                              <2> %assign i i+1
   676 0000078A [A103]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   677                              <2> %assign i i+1
   678 00000792 [AE03]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   679                              <2> %assign i i+1
   680 0000079A [BB03]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   681                              <2> %assign i i+1
   682 000007A2 [C803]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   683                              <2> %assign i i+1
   684 000007AA [D503]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   685                              <2> %assign i i+1
   686 000007B2 [E203]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   687                              <2> %assign i i+1
   688 000007BA [EF03]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   689                              <2> %assign i i+1
   690 000007C2 [FC03]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   691                              <2> %assign i i+1
   692 000007CA [0904]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   693                              <2> %assign i i+1
   694 000007D2 [1604]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   695                              <2> %assign i i+1
   696 000007DA [2304]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   697                              <2> %assign i i+1
   698 000007E2 [3004]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   699                              <2> %assign i i+1
   700 000007EA [3D04]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   701                              <2> %assign i i+1
   702 000007F2 [4A04]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   703                              <2> %assign i i+1
   704 000007FA [5704]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   705                              <2> %assign i i+1
   706 00000802 [6404]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   707                              <2> %assign i i+1
   708 0000080A [7104]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   709                              <2> %assign i i+1
   710 00000812 [7E04]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   711                              <2> %assign i i+1
   712 0000081A [8B04]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   713                              <2> %assign i i+1
   714 00000822 [9804]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   715                              <2> %assign i i+1
   716 0000082A [A504]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   717                              <2> %assign i i+1
   718 00000832 [B204]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   719                              <2> %assign i i+1
   720 0000083A [BF04]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   721                              <2> %assign i i+1
   722 00000842 [CC04]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   723                              <2> %assign i i+1
   724 0000084A [D904]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   725                              <2> %assign i i+1
   726 00000852 [E604]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   727                              <2> %assign i i+1
   728 0000085A [F304]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   729                              <2> %assign i i+1
   730 00000862 [0005]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   731                              <2> %assign i i+1
   732 0000086A [0D05]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   733                              <2> %assign i i+1
   734 00000872 [1A05]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   735                              <2> %assign i i+1
   736 0000087A [2705]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   737                              <2> %assign i i+1
   738 00000882 [3405]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   739                              <2> %assign i i+1
   740 0000088A [4105]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   741                              <2> %assign i i+1
   742 00000892 [4E05]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   743                              <2> %assign i i+1
   744 0000089A [5B05]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   745                              <2> %assign i i+1
   746 000008A2 [6805]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   747                              <2> %assign i i+1
   748 000008AA [7505]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   749                              <2> %assign i i+1
   750 000008B2 [8205]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   751                              <2> %assign i i+1
   752 000008BA [8F05]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   753                              <2> %assign i i+1
   754 000008C2 [9C05]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   755                              <2> %assign i i+1
   756 000008CA [A905]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   757                              <2> %assign i i+1
   758 000008D2 [B605]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   759                              <2> %assign i i+1
   760 000008DA [C305]1000008E0000  <2>  dw unhand + i*13,SYS_CODE_SEL,0x8E00,0
   761                              <2> %assign i i+1
   762                              <1> ;;INT 30h for os use and 3rd party use:
   763 000008E2 [EA08]1000008E0000  <1> 	dw newints,SYS_CODE_SEL,0x8E00,0
   764                              <1> idt_end:
   765                              <1> [BITS 32]
   766                                  [BITS 32]
   767                                      %include 'source/ints.asm'
   768                              <1> newints:	;;for great justice
   769 000008EA 80FC00              <1> 	cmp ah, 0		;;originally 0
   770 000008ED 0F8452000000        <1> 	je near intx0   ;;0=kills app
   771 000008F3 80FC01              <1> 	cmp ah, 1		;;originally 1
   772 000008F6 0F844E000000        <1> 	je near intx1   ;;3=print string
   773 000008FC 80FC02              <1> 	cmp ah, 2		;;originally 2
   774 000008FF 0F844B000000        <1> 	je near intx2	;;4=read string
   775 00000905 80FC03              <1> 	cmp ah, 3		;;originally 3
   776 00000908 0F8448000000        <1> 	je near intx3	;;6=clear screen
   777 0000090E 80FC04              <1> 	cmp ah, 4		;;originally 4
   778 00000911 0F8445000000        <1> 	je near intx4	;;5=read and print string
   779 00000917 80FC05              <1> 	cmp ah, 5		;;originally 5		
   780 0000091A 0F8442000000        <1> 	je near intx5	;;2=get char
   781 00000920 80FC06              <1> 	cmp ah, 6		;;originally 6
   782 00000923 0F843F000000        <1> 	je near intx6	;;1=print char
   783 00000929 80FC07              <1> 	cmp ah, 7
   784 0000092C 0F843C000000        <1> 	je near intx7	;;read file
   785 00000932 80FC09              <1> 	cmp ah, 9
   786 00000935 0F8439000000        <1> 	je near intx9	;;convert number
   787 0000093B 80FC0A              <1> 	cmp ah, 10
   788 0000093E 0F8440000000        <1> 	je near intx10	;;create thread
   789 00000944 C3                  <1> 	ret
   790                              <1> 	
   791                              <1> intx0:
   792 00000945 E9F3040000          <1> 	jmp nwcmd
   793                              <1> intx1:
   794 0000094A E81E020000          <1> 	call int303
   795 0000094F C3                  <1> 	ret
   796                              <1> intx2:
   797 00000950 E835020000          <1> 	call int304
   798 00000955 C3                  <1> 	ret
   799                              <1> intx3:
   800 00000956 E8B9020000          <1> 	call int306
   801 0000095B C3                  <1> 	ret
   802                              <1> intx4:
   803 0000095C E850020000          <1> 	call int305
   804 00000961 C3                  <1> 	ret
   805                              <1> intx5:
   806 00000962 E8CE010000          <1> 	call int302
   807 00000967 C3                  <1> 	ret
   808                              <1> intx6:
   809 00000968 E822000000          <1> 	call int301
   810 0000096D C3                  <1> 	ret
   811                              <1> intx7:
   812 0000096E E8A3350000          <1> 	call loadfile
   813 00000973 C3                  <1> 	ret
   814                              <1> intx9:
   815 00000974 3C00                <1> 	cmp al, 0
   816 00000976 7506                <1> 	jne intx9B
   817 00000978 E831090000          <1> 	call showdec
   818 0000097D C3                  <1> 	ret
   819                              <1> intx9B:
   820 0000097E E895080000          <1> 	call showhex
   821 00000983 C3                  <1> 	ret
   822                              <1> intx10:
   823                              <1> ;	call thread
   824 00000984 C3                  <1> 	ret
   825                              <1> 	
   826 00000985 0000                <1> linebeginpos dw 0
   827 00000987 0000                <1> videobufpos: dw 0
   828 00000989 0000                <1> charpos db 0,0
   829 0000098B A01E                <1> charxy db 160,30
   830 0000098D 0000                <1> charbuf dw 0
   831                              <1> 
   832                              <1> int301:	;;print char, char in al, modifier in bl, will run videobuf2copy if called as is
   833 0000098F E807000000          <1> 	call int301prnt
   834 00000994 E9C1020000          <1> 	jmp termcopy
   835 00000999 00                  <1> termguion db 0
   836 0000099A 00                  <1> termcopyon db 0
   837                              <1> int301prnt:
   838 0000099B 88DC                <1> 	mov ah, bl
   839 0000099D 66A3[8D090000]      <1> 	mov [charbuf], ax
   840 000009A3 BB00000000          <1> 	mov ebx, 0
   841 000009A8 668B1D[87090000]    <1> 	mov bx, [videobufpos]
   842 000009AF BF[851C0000]        <1> 	mov edi, videobuf2
   843 000009B4 01DF                <1> 	add edi, ebx
   844 000009B6 66A1[580C0000]      <1> 	mov ax, [removedvideo]
   845 000009BC 668907              <1> 	mov [edi], ax
   846 000009BF 66A1[8D090000]      <1> 	mov ax, [charbuf]
   847 000009C5 BA00000000          <1> 	mov edx, 0
   848 000009CA 668B15[89090000]    <1> 	mov dx, [charpos]
   849 000009D1 B900000000          <1> 	mov ecx, 0
   850 000009D6 668B0D[8B090000]    <1> 	mov cx, [charxy]
   851 000009DD 3C0D                <1> 	cmp al, 13
   852 000009DF 0F8454000000        <1> 	je near int301cr
   853 000009E5 3C0A                <1> 	cmp al, 10
   854 000009E7 0F8482000000        <1> 	je near int301nl
   855 000009ED 3C08                <1> 	cmp al, 8
   856 000009EF 0F845B000000        <1> 	je near int301bs
   857 000009F5 668907              <1> 	mov [edi], ax
   858 000009F8 81C702000000        <1> 	add edi, 2
   859 000009FE 80C202              <1> 	add dl, 2
   860                              <1> donecrnl:
   861 00000A01 38CA                <1> 	cmp dl, cl
   862 00000A03 0F8397000000        <1> 	jae near int301eol
   863                              <1> doneeol:
   864 00000A09 38EE                <1> 	cmp dh, ch
   865 00000A0B 0F83AD000000        <1> 	jae near int301scr	
   866                              <1> donescr:
   867 00000A11 89FB                <1> 	mov ebx, edi
   868 00000A13 668B07              <1> 	mov ax, [edi]
   869 00000A16 66A3[580C0000]      <1> 	mov [removedvideo], ax
   870 00000A1C 81EB[851C0000]      <1> 	sub ebx, videobuf2
   871 00000A22 66891D[87090000]    <1> 	mov [videobufpos], bx
   872 00000A29 668915[89090000]    <1> 	mov [charpos], dx
   873 00000A30 66A1[8D090000]      <1> 	mov ax, [charbuf]
   874 00000A36 88E3                <1> 	mov bl, ah
   875 00000A38 C3                  <1> 	ret
   876                              <1> 	
   877                              <1> 	int301cr:
   878 00000A39 B200                <1> 		mov dl, 0
   879 00000A3B BB00000000          <1> 		mov ebx, 0
   880 00000A40 BF[851C0000]        <1> 		mov edi, videobuf2
   881 00000A45 668B1D[85090000]    <1> 		mov bx, [linebeginpos]
   882 00000A4C 01DF                <1> 		add edi, ebx
   883 00000A4E EBB1                <1> 		jmp donecrnl
   884                              <1> 			
   885                              <1> 	int301bs:
   886 00000A50 80FA00              <1> 		cmp dl, 0
   887 00000A53 740F                <1> 		je int301backline
   888                              <1> 	int301nobmr:
   889 00000A55 80EA02              <1> 		sub dl, 2
   890 00000A58 66B80000            <1> 		mov ax, 0
   891 00000A5C 81EF02000000        <1> 		sub edi, 2
   892 00000A62 EB9D                <1> 		jmp donecrnl
   893                              <1> 	int301backline:
   894 00000A64 88CA                <1> 		mov dl, cl
   895 00000A66 80FE00              <1> 		cmp dh, 0
   896 00000A69 74EA                <1> 		je int301nobmr
   897 00000A6B FECE                <1> 		dec dh
   898 00000A6D EBE6                <1> 		jmp int301nobmr
   899                              <1> 		
   900                              <1> 	int301nl:
   901 00000A6F FEC6                <1> 		inc dh
   902 00000A71 BB00000000          <1> 		mov ebx, 0
   903 00000A76 88CB                <1> 		mov bl, cl
   904 00000A78 BF[851C0000]        <1> 		mov edi, videobuf2
   905 00000A7D 66031D[87090000]    <1> 		add bx, [videobufpos]
   906 00000A84 01DF                <1> 		add edi, ebx
   907 00000A86 BB00000000          <1> 		mov ebx, 0
   908 00000A8B 88CB                <1> 		mov bl, cl
   909 00000A8D 66031D[85090000]    <1> 		add bx, [linebeginpos]
   910 00000A94 66891D[85090000]    <1> 		mov [linebeginpos], bx
   911 00000A9B E961FFFFFF          <1> 		jmp donecrnl
   912                              <1> 		
   913                              <1> 	int301eol:
   914 00000AA0 B200                <1> 		mov dl, 0
   915 00000AA2 FEC6                <1> 		inc dh
   916 00000AA4 BB00000000          <1> 		mov ebx, 0
   917 00000AA9 88CB                <1> 		mov bl, cl
   918 00000AAB 66031D[85090000]    <1> 		add bx, [linebeginpos]
   919 00000AB2 66891D[85090000]    <1> 		mov [linebeginpos], bx
   920 00000AB9 E94BFFFFFF          <1> 		jmp doneeol
   921                              <1> 		
   922                              <1> 	int301scr:
   923 00000ABE FECE                <1> 		dec dh
   924 00000AC0 BF[851C0000]        <1> 		mov edi, videobuf2
   925 00000AC5 BB00000000          <1> 		mov ebx, 0
   926 00000ACA 88CB                <1> 		mov bl, cl
   927 00000ACC 01FB                <1> 		add ebx, edi
   928                              <1> 	intscrollloop:
   929 00000ACE 668B03              <1> 		mov ax, [ebx]
   930 00000AD1 668907              <1> 		mov [edi], ax
   931 00000AD4 81C702000000        <1> 		add edi, 2
   932 00000ADA 81C302000000        <1> 		add ebx, 2
   933 00000AE0 80E902              <1> 		sub cl, 2
   934 00000AE3 80F900              <1> 		cmp cl, 0
   935 00000AE6 75E6                <1> 		jne intscrollloop
   936 00000AE8 8A0D[8B090000]      <1> 		mov cl, [charxy]
   937 00000AEE FECD                <1> 		dec ch
   938 00000AF0 80FD01              <1> 		cmp ch, 1
   939 00000AF3 77D9                <1> 		ja intscrollloop
   940 00000AF5 66B80000            <1> 		mov ax, 0
   941 00000AF9 81EF[851C0000]      <1> 		sub edi, videobuf2
   942 00000AFF 66893D[85090000]    <1> 		mov [linebeginpos], di
   943 00000B06 81C7[851C0000]      <1> 		add edi, videobuf2
   944 00000B0C 89FB                <1> 		mov ebx, edi
   945                              <1> 	intloopclear:
   946 00000B0E 668903              <1> 		mov [ebx], ax
   947 00000B11 81C302000000        <1> 		add ebx, 2
   948 00000B17 80E902              <1> 		sub cl, 2
   949 00000B1A 80F900              <1> 		cmp cl, 0
   950 00000B1D 75EF                <1> 		jne intloopclear
   951 00000B1F FECD                <1> 		dec ch
   952 00000B21 80FD00              <1> 		cmp ch, 0
   953 00000B24 75E8                <1> 		jne intloopclear
   954 00000B26 668B0D[8B090000]    <1> 		mov cx, [charxy]
   955 00000B2D E9DFFEFFFF          <1> 		jmp donescr
   956                              <1> 		
   957                              <1> 		
   958 00000B32 0000                <1> lastkey db 0,0
   959 00000B34 00                  <1> trans db 0
   960                              <1> 
   961                              <1> 	int302:		;;get char, if al is 0, wait for key
   962 00000B35 A2[340B0000]        <1> 		mov [trans], al
   963                              <1> 	transcheck:
   964 00000B3A E8A5180000          <1> 		call guistartin
   965 00000B3F 8A3D[340B0000]      <1> 		mov bh, [trans]
   966 00000B45 66A1[320B0000]      <1> 		mov ax, [lastkey]
   967 00000B4B 80FC1C              <1> 		cmp ah, 1Ch
   968 00000B4E 740C                <1> 		je int302enter
   969 00000B50 08C7                <1> 		or bh, al
   970 00000B52 80FF00              <1> 		cmp bh, 0
   971 00000B55 74E3                <1> 		je transcheck
   972 00000B57 E907000000          <1> 		jmp int302end
   973                              <1> 	int302enter:
   974 00000B5C B00D                <1> 		mov al, 13
   975 00000B5E E900000000          <1> 		jmp int302end
   976                              <1> 	int302end:
   977 00000B63 C3                  <1> 		ret
   978                              <1> 	
   979 00000B64 00                  <1> endkey303 db 0
   980                              <1>     print:
   981 00000B65 66B80000            <1> 		mov ax, 0
   982 00000B69 66BB0700            <1> 		mov bx, 7
   983                              <1> 	int303:	;;print line, al=last key,bl=modifier, esi=buffer
   984 00000B6D A2[640B0000]        <1> 		mov [endkey303], al
   985                              <1> 	int303b:
   986 00000B72 8A06                <1> 		mov al, [esi]
   987 00000B74 3A05[640B0000]      <1> 		cmp al, [endkey303]
   988 00000B7A 7408                <1> 		je doneint303
   989 00000B7C E81AFEFFFF          <1> 		call int301prnt
   990 00000B81 46                  <1> 		inc esi
   991 00000B82 EBEE                <1> 		jmp int303b
   992                              <1> 	doneint303:
   993 00000B84 E9D1000000          <1> 		jmp termcopy
   994                              <1> 	
   995 00000B89 00                  <1> endkey304 db 0
   996                              <1> 	int304:	;;get line, al=last key, esi = buffer
   997 00000B8A A2[890B0000]        <1> 		mov [endkey304], al
   998                              <1> 	int304b:
   999 00000B8F 56                  <1> 		push esi
  1000 00000B90 B000                <1> 		mov al, 0
  1001 00000B92 E89EFFFFFF          <1> 		call int302
  1002 00000B97 5E                  <1> 		pop esi
  1003 00000B98 8806                <1> 		mov [esi], al
  1004 00000B9A 46                  <1> 		inc esi
  1005 00000B9B 3A05[890B0000]      <1> 		cmp al, [endkey304]
  1006 00000BA1 75EC                <1> 		jne int304b
  1007 00000BA3 4E                  <1> 		dec esi
  1008 00000BA4 C60600              <1> 		mov byte [esi], 0
  1009 00000BA7 C3                  <1> 	ret
  1010                              <1> 	
  1011 00000BA8 00                  <1> endkey305 db 0
  1012 00000BA9 00                  <1> modkey305 db 0
  1013 00000BAA 00000000            <1> firstesi305 dd 0
  1014 00000BAE 082000              <1> backcursor db 8," ",0
  1015                              <1> 	int305:	;;print and get line, al=last key, bl=modifier, esi=buffer
  1016 00000BB1 A2[A80B0000]        <1> 		mov [endkey305], al
  1017 00000BB6 881D[A90B0000]      <1> 		mov [modkey305], bl
  1018 00000BBC 8935[AA0B0000]      <1> 		mov [firstesi305], esi
  1019                              <1> 	int305b:
  1020 00000BC2 56                  <1> 		push esi
  1021 00000BC3 B000                <1> 		mov al, 0
  1022 00000BC5 E86BFFFFFF          <1> 		call int302
  1023 00000BCA 5E                  <1> 		pop esi
  1024 00000BCB 3C08                <1> 		cmp al, 8
  1025 00000BCD 0F841D000000        <1> 		je near int305bscheck
  1026 00000BD3 8806                <1> 		mov [esi], al
  1027 00000BD5 46                  <1> 		inc esi
  1028                              <1> 	bscheckequal:
  1029 00000BD6 8A1D[A90B0000]      <1> 		mov bl, [modkey305]
  1030 00000BDC E8AEFDFFFF          <1> 		call int301
  1031 00000BE1 8A25[A80B0000]      <1> 		mov ah, [endkey305]
  1032 00000BE7 38E0                <1> 		cmp al, ah
  1033 00000BE9 75D7                <1> 		jne int305b
  1034 00000BEB 4E                  <1> 		dec esi
  1035 00000BEC C60600              <1> 		mov byte [esi], 0
  1036 00000BEF C3                  <1> 		ret
  1037                              <1> 	
  1038                              <1> 	int305bscheck:
  1039 00000BF0 3B35[AA0B0000]      <1> 		cmp esi, [firstesi305]
  1040 00000BF6 7702                <1> 		ja goodbscheck
  1041 00000BF8 EBC8                <1> 		jmp int305b
  1042                              <1> 	goodbscheck:
  1043 00000BFA 4E                  <1> 		dec esi
  1044 00000BFB C60600              <1> 		mov byte [esi], 0
  1045 00000BFE 8A1D[A90B0000]      <1> 		mov bl, [modkey305]
  1046 00000C04 56                  <1> 		push esi
  1047 00000C05 BE[AE0B0000]        <1> 		mov esi, backcursor
  1048 00000C0A E856FFFFFF          <1> 		call print		
  1049 00000C0F 5E                  <1> 		pop esi
  1050 00000C10 B008                <1> 		mov al, 8
  1051 00000C12 EBC2                <1> 		jmp bscheckequal
  1052                              <1> 		
  1053                              <1> 	clear:		
  1054                              <1> 	
  1055                              <1> 	int306:	;;clear screen
  1056 00000C14 668B0D[8B090000]    <1> 		mov cx, [charxy]
  1057 00000C1B BF[851C0000]        <1> 		mov edi, videobuf2
  1058 00000C20 66B80000            <1> 		mov ax, 0
  1059 00000C24 66A3[85090000]      <1> 		mov [linebeginpos], ax
  1060 00000C2A 66A3[87090000]      <1> 		mov [videobufpos], ax
  1061 00000C30 66BA0000            <1> 		mov dx, 0
  1062 00000C34 66A3[89090000]      <1> 		mov [charpos], ax
  1063                              <1> 	int306b:
  1064 00000C3A 668907              <1> 		mov [edi], ax
  1065 00000C3D 81C702000000        <1> 		add edi, 2
  1066 00000C43 80E902              <1> 		sub cl, 2
  1067 00000C46 80F900              <1> 		cmp cl, 0
  1068 00000C49 75EF                <1> 		jne int306b
  1069 00000C4B 8A0D[8B090000]      <1> 		mov cl, [charxy]
  1070 00000C51 FECD                <1> 		dec ch
  1071 00000C53 80FD00              <1> 		cmp ch, 0
  1072 00000C56 75E2                <1> 		jne int306b
  1073                              <1> 	
  1074 00000C58 0000                <1> 	removedvideo dw 0
  1075                              <1> 	
  1076                              <1> termcopy:	
  1077 00000C5A 60                  <1> 	pusha
  1078 00000C5B BF[851C0000]        <1> 	mov edi, videobuf2
  1079 00000C60 BB00000000          <1> 	mov ebx, 0
  1080 00000C65 668B1D[87090000]    <1> 	mov bx, [videobufpos]
  1081 00000C6C 01DF                <1> 	add edi, ebx
  1082 00000C6E B05F                <1> 	mov al, "_"
  1083 00000C70 B407                <1> 	mov ah, 7
  1084 00000C72 668907              <1> 	mov [edi], ax
  1085 00000C75 C605[22290000]00    <1> 	mov byte [mouseselecton], 0
  1086 00000C7C C605[9A090000]01    <1> 	mov byte [termcopyon], 1
  1087 00000C83 803D[23290000]00    <1> 	cmp byte [guion], 0
  1088 00000C8A 0F840D000000        <1> 	je near nowincopy
  1089 00000C90 803D[99090000]01    <1> 	cmp byte [termguion], 1
  1090 00000C97 0F845D280000        <1> 	je near windowvideocopy
  1091                              <1> nowincopy:
  1092 00000C9D BE00000A00          <1> 	mov esi, 0xA0000
  1093 00000CA2 A1[5C030000]        <1> 	mov eax, [basecache]
  1094 00000CA7 C1E004              <1> 	shl eax, 4
  1095 00000CAA 29C6                <1> 	sub esi, eax
  1096 00000CAC BF[851C0000]        <1> 	mov edi, videobuf2
  1097 00000CB1 B900000000          <1> 	mov ecx, 0
  1098 00000CB6 668B0D[8B090000]    <1> 	mov cx, [charxy]
  1099                              <1> nowincopy2:
  1100 00000CBD BB[A4410000]        <1> 	mov ebx, fonts
  1101 00000CC2 B800000000          <1> 	mov eax, 0
  1102 00000CC7 8A07                <1> 	mov al, [edi]
  1103 00000CC9 C1E004              <1> 	shl eax, 4
  1104 00000CCC 01C3                <1> 	add ebx, eax
  1105 00000CCE 47                  <1> 	inc edi
  1106 00000CCF 8A27                <1> 	mov ah, [edi]
  1107 00000CD1 BA00000000          <1> 	mov edx, 0
  1108 00000CD6 8A15[8B090000]      <1> 	mov dl, [charxy]
  1109 00000CDC D1EA                <1> 	shr edx, 1
  1110 00000CDE C1C110              <1> 	rol ecx, 16
  1111 00000CE1 B110                <1> 	mov cl, 16
  1112                              <1> nowinfont:
  1113 00000CE3 8A03                <1> 	mov al, [ebx]
  1114 00000CE5 D0C8                <1> 	ror al, 1
  1115 00000CE7 80FC07              <1> 	cmp ah, 7
  1116 00000CEA 7602                <1> 	jbe notnotfont
  1117 00000CEC F6D0                <1> 	not al
  1118                              <1> notnotfont:
  1119 00000CEE 8806                <1> 	mov [esi], al
  1120 00000CF0 01D6                <1> 	add esi, edx
  1121 00000CF2 43                  <1> 	inc ebx
  1122 00000CF3 FEC9                <1> 	dec cl
  1123 00000CF5 80F900              <1> 	cmp cl, 0
  1124 00000CF8 75E9                <1> 	jne nowinfont
  1125 00000CFA C1E204              <1> 	shl edx, 4
  1126 00000CFD 29D6                <1> 	sub esi, edx
  1127 00000CFF C1C110              <1> 	rol ecx, 16
  1128                              <1> nopresentwinfont:
  1129 00000D02 47                  <1> 	inc edi
  1130 00000D03 46                  <1> 	inc esi
  1131 00000D04 80E902              <1> 	sub cl, 2
  1132 00000D07 80F900              <1> 	cmp cl, 0
  1133 00000D0A 75B1                <1> 	jne nowincopy2
  1134 00000D0C 8A0D[8B090000]      <1> 	mov cl, [charxy]
  1135 00000D12 BA00000000          <1> 	mov edx, 0
  1136 00000D17 88CA                <1> 	mov dl, cl
  1137 00000D19 D1EA                <1> 	shr edx, 1
  1138 00000D1B 29D6                <1> 	sub esi, edx
  1139 00000D1D C1E204              <1> 	shl edx, 4
  1140 00000D20 01D6                <1> 	add esi, edx
  1141 00000D22 FECD                <1> 	dec ch
  1142 00000D24 80FD00              <1> 	cmp ch, 0
  1143 00000D27 7594                <1> 	jne nowincopy2
  1144 00000D29 61                  <1> 	popa
  1145 00000D2A C3                  <1> 	ret
  1146                                      %include 'source/solleros.asm'
  1147                              <1> 	;SOLLEROS.ASM
  1148                              <1> os:
  1149 00000D2B E8E4FEFFFF          <1> 	call clear
  1150 00000D30 BE[61410000]        <1> 	mov esi, userask
  1151 00000D35 E82BFEFFFF          <1> 	call print
  1152                              <1> usercheck:
  1153 00000D3A BE[701A0000]        <1> 	mov esi, buftxt
  1154 00000D3F B00D                <1> 	mov al, 13
  1155 00000D41 B404                <1> 	mov ah, 4
  1156 00000D43 CD30                <1> 	int 30h
  1157 00000D45 56                  <1> 	push esi
  1158 00000D46 BE[81410000]        <1> 	mov esi, line
  1159 00000D4B E815FEFFFF          <1> 	call print
  1160 00000D50 BE[6B410000]        <1> 	mov esi, pwdask
  1161 00000D55 E80BFEFFFF          <1> 	call print
  1162 00000D5A 5E                  <1> 	pop esi
  1163 00000D5B 46                  <1> 	inc esi
  1164 00000D5C 8935[120E0000]      <1> 	mov [esipass], esi
  1165                              <1> passcheck:
  1166 00000D62 B000                <1> 	mov al, 0
  1167 00000D64 B405                <1> 	mov ah, 5
  1168 00000D66 CD30                <1> 	int 30h
  1169 00000D68 3C0D                <1> 	cmp al, 13
  1170 00000D6A 0F8435000000        <1> 	je near gotpass
  1171 00000D70 3C08                <1> 	cmp al, 8
  1172 00000D72 0F840F000000        <1> 	je near backpass
  1173 00000D78 8806                <1> 	mov [esi], al
  1174 00000D7A 46                  <1> 	inc esi
  1175 00000D7B B02A                <1> 	mov al, '*'
  1176 00000D7D B406                <1> 	mov ah, 6
  1177 00000D7F CD30                <1> 	int 30h
  1178 00000D81 EBDF                <1> 	jmp passcheck
  1179 00000D83 08200800            <1> backcursor2 db 8," ",8,0
  1180                              <1> backpass:
  1181 00000D87 3B35[120E0000]      <1> 	cmp esi, [esipass]
  1182 00000D8D 0F84CFFFFFFF        <1> 	je near passcheck
  1183 00000D93 4E                  <1> 	dec esi
  1184 00000D94 C60600              <1> 	mov byte [esi], 0
  1185 00000D97 56                  <1> 	push esi
  1186 00000D98 BE[830D0000]        <1> 	mov esi, backcursor2
  1187 00000D9D E8C3FDFFFF          <1> 	call print
  1188 00000DA2 5E                  <1> 	pop esi
  1189 00000DA3 EBBD                <1> 	jmp passcheck
  1190                              <1> gotpass:
  1191 00000DA5 B000                <1> 	mov al,0
  1192 00000DA7 8806                <1> 	mov [esi], al
  1193 00000DA9 BE[81410000]        <1> 	mov esi, line
  1194 00000DAE E8B2FDFFFF          <1> 	call print
  1195 00000DB3 BB[84410000]        <1> 	mov ebx, userlst
  1196                              <1> userfind:
  1197 00000DB8 BE[701A0000]        <1> 	mov esi, buftxt
  1198 00000DBD 8A06                <1> 	mov al, [esi]
  1199 00000DBF 3C00                <1> 	cmp al, 0
  1200 00000DC1 0F8464FFFFFF        <1> 	je near os
  1201 00000DC7 891D[160E0000]      <1> 	mov [usercache], ebx
  1202 00000DCD E857010000          <1> 	call tester
  1203 00000DD2 3C01                <1> 	cmp al, 1
  1204 00000DD4 7415                <1> 	je pwdtest
  1205                              <1> nxtuser:
  1206 00000DD6 43                  <1> 	inc ebx
  1207 00000DD7 8A03                <1> 	mov al, [ebx]
  1208 00000DD9 3C00                <1> 	cmp al, 0
  1209 00000DDB 74DB                <1> 	je userfind
  1210 00000DDD 81FB[A4410000]      <1> 	cmp ebx, userlstend
  1211 00000DE3 0F8342FFFFFF        <1> 	jae near os
  1212 00000DE9 EBCD                <1> 	jmp userfind
  1213                              <1> pwdtest:
  1214 00000DEB 46                  <1> 	inc esi
  1215 00000DEC 43                  <1> 	inc ebx
  1216 00000DED E837010000          <1> 	call tester
  1217 00000DF2 3C01                <1> 	cmp al, 1
  1218 00000DF4 7402                <1> 	je pwdrgt
  1219 00000DF6 EBDE                <1> 	jmp nxtuser
  1220 00000DF8 E817FEFFFF          <1> pwdrgt:	call clear
  1221 00000DFD 66B90002            <1> 	mov cx, 200h
  1222 00000E01 BE[701A0000]        <1> 	mov esi, buftxt
  1223 00000E06 B000                <1> 	mov al, 0
  1224 00000E08 8806                <1> bufclr:	mov [esi], al
  1225 00000E0A 46                  <1> 	inc esi
  1226 00000E0B E2FB                <1> 	loop bufclr
  1227                              <1> ;;;;;;;;;;;;;;;;
  1228 00000E0D E92B000000          <1> 	jmp nwcmd
  1229                              <1> 
  1230 00000E12 00000000            <1> esipass dd 0
  1231 00000E16 [84410000]          <1> usercache dd userlst
  1232                              <1> 	
  1233                              <1> buftxtclear:
  1234 00000E1A B000                <1> 	mov al, 0
  1235 00000E1C BE[701A0000]        <1> 	mov esi, buftxt
  1236 00000E21 81FE[701C0000]      <1> clearbuftxt: cmp esi, buf2
  1237 00000E27 730E                <1> 	jae retbufclr
  1238 00000E29 8806                <1> 	mov [esi], al
  1239 00000E2B 46                  <1> 	inc esi
  1240 00000E2C EBF3                <1> 	jmp clearbuftxt
  1241                              <1> 
  1242 00000E2E 39DE                <1> clearitbuf: cmp esi, ebx
  1243 00000E30 7305                <1> 	jae retbufclr
  1244 00000E32 8806                <1> 	mov [esi], al
  1245 00000E34 46                  <1> 	inc esi
  1246 00000E35 EBF7                <1> 	jmp clearitbuf
  1247 00000E37 C3                  <1> retbufclr: ret
  1248                              <1> 
  1249 00000E38 E900000000          <1> full:	jmp nwcmd
  1250                              <1> 
  1251                              <1> 
  1252 00000E3D B001                <1> nwcmd:	mov al, 1
  1253 00000E3F 3805[69130000]      <1> 	cmp [BATCHISON], al
  1254 00000E45 0F8345000000        <1> 	jae near batchran
  1255 00000E4B B000                <1> cancel:	mov al, 0
  1256 00000E4D A2[00130000]        <1> 	mov [IFON], al
  1257 00000E52 A2[69130000]        <1> 	mov [BATCHISON], al
  1258 00000E57 B05B                <1> 	mov al, '['
  1259 00000E59 B406                <1> 	mov ah, 6
  1260 00000E5B 66BB0700            <1> 	mov bx, 7
  1261 00000E5F E837FBFFFF          <1> 	call int301prnt
  1262 00000E64 8B35[160E0000]      <1> 	mov esi, [usercache]
  1263 00000E6A E8F6FCFFFF          <1> 	call print
  1264 00000E6F BE[75410000]        <1> 	mov esi, location
  1265 00000E74 E8ECFCFFFF          <1> 	call print
  1266                              <1> 	;call time
  1267                              <1> 	;mov esi, timeshow
  1268                              <1> 	;call print
  1269                              <1> 	;mov esi, cmd
  1270                              <1> 	;call print
  1271 00000E79 E89CFFFFFF          <1> 	call buftxtclear
  1272 00000E7E BE[701A0000]        <1> 	mov esi, buftxt
  1273 00000E83 B00D                <1> 	mov al, 13
  1274 00000E85 B307                <1> 	mov bl, 7
  1275 00000E87 B404                <1> 	mov ah, 4
  1276 00000E89 CD30                <1> 	int 30h
  1277                              <1> gotcmd:	
  1278 00000E8B E914000000          <1> 	jmp run
  1279                              <1> 	
  1280                              <1> batchran:
  1281 00000E90 C3                  <1> 	ret
  1282                              <1> 
  1283 00000E91 E884FFFFFF          <1> input:	call buftxtclear
  1284 00000E96 BE[701A0000]        <1> 	mov esi, buftxt		;puts input into buftxt AND onto screen
  1285 00000E9B B00D                <1> stdin:	mov al, 13
  1286 00000E9D B307                <1> 	mov bl, 7
  1287 00000E9F B404                <1> 	mov ah, 4
  1288 00000EA1 CD30                <1> 	int 30h
  1289 00000EA3 C3                  <1> 	ret
  1290                              <1> 
  1291 00000EA4 BE[81410000]        <1> run:	mov esi, line
  1292 00000EA9 E8B7FCFFFF          <1> 		call print
  1293                              <1> progtest:
  1294 00000EAE BE[701A0000]        <1> 	mov esi, buftxt
  1295 00000EB3 BB[6F130000]        <1> 	mov ebx, fileindex
  1296 00000EB8 668B03              <1> prgnxt:	mov ax, [ebx]
  1297 00000EBB B105                <1> 	mov cl, 5
  1298 00000EBD B504                <1> 	mov ch, 4
  1299 00000EBF 6639C8              <1> 	cmp ax, cx
  1300 00000EC2 740B                <1> 	je fndprg
  1301 00000EC4 43                  <1> 	inc ebx
  1302 00000EC5 81FB[6F150000]      <1> 	cmp ebx, fileindexend
  1303 00000ECB 7330                <1> 	jae prgnf
  1304 00000ECD EBE9                <1> 	jmp prgnxt
  1305 00000ECF 81C302000000        <1> fndprg: add ebx, 2
  1306 00000ED5 BE[701A0000]        <1> 	mov esi, buftxt
  1307 00000EDA 66B90000            <1> 	mov cx, 0
  1308 00000EDE E880000000          <1> 	call cndtest
  1309 00000EE3 3C01                <1> 	cmp al, 1
  1310 00000EE5 7302                <1> 	jae prggood
  1311 00000EE7 EBCF                <1> 	jmp prgnxt
  1312 00000EE9 81FB[6F150000]      <1> prggood: cmp ebx, fileindexend
  1313 00000EEF 7333                <1> 	jae prgdn
  1314 00000EF1 81C303000000        <1> 	add ebx, 3
  1315 00000EF7 8B3B                <1> 	mov edi, [ebx]
  1316 00000EF9 90                  <1> 	nop
  1317 00000EFA 90                  <1> 	nop
  1318 00000EFB FFE7                <1> 	jmp edi
  1319                              <1> prgnf:	
  1320 00000EFD A0[701A0000]        <1> 	mov al, [buftxt]
  1321 00000F02 3C00                <1> 	cmp al, 0
  1322 00000F04 741E                <1> 	je prgdn
  1323 00000F06 BE[48410000]        <1> 	mov esi, notfound1
  1324 00000F0B E855FCFFFF          <1> 	call print
  1325 00000F10 BE[701A0000]        <1> 	mov esi, buftxt
  1326 00000F15 E84BFCFFFF          <1> 	call print
  1327 00000F1A BE[52410000]        <1> 	mov esi, notfound2
  1328 00000F1F E841FCFFFF          <1> 	call print
  1329 00000F24 E914FFFFFF          <1> prgdn:	jmp nwcmd
  1330                              <1> 
  1331                              <1> 
  1332                              <1> tester:			;si=user bx=prog returns 1 in al if true
  1333 00000F29 B000                <1> 	mov al, 0
  1334 00000F2B 8A06                <1> retest:	mov al, [esi]
  1335 00000F2D 8A23                <1> 	mov ah, [ebx]
  1336 00000F2F 3C00                <1> 	cmp al, 0
  1337 00000F31 7408                <1> 	je testtrue
  1338 00000F33 38E0                <1> 	cmp al, ah
  1339 00000F35 750C                <1> 	jne testfalse
  1340 00000F37 43                  <1> 	inc ebx
  1341 00000F38 46                  <1> 	inc esi
  1342 00000F39 EBF0                <1> 	jmp retest
  1343                              <1> testtrue:
  1344 00000F3B 80FC00              <1> 	cmp ah, 0
  1345 00000F3E 7503                <1> 	jne testfalse
  1346 00000F40 B001                <1> 	mov al, 1
  1347 00000F42 C3                  <1> 	ret
  1348                              <1> testfalse:
  1349 00000F43 B000                <1> 	mov al, 0
  1350 00000F45 C3                  <1> 	ret
  1351                              <1> 
  1352                              <1> optest:			;si=user bx=prog returns 1 in al if true
  1353 00000F46 B000                <1> 	mov al, 0
  1354                              <1> opretest:
  1355 00000F48 8A06                <1> 	mov al, [esi]
  1356 00000F4A 8A23                <1> 	mov ah, [ebx]
  1357 00000F4C 38E0                <1> 	cmp al, ah
  1358 00000F4E 7510                <1> 	jne optestfalse
  1359 00000F50 80FC00              <1> 	cmp ah, 0
  1360 00000F53 7404                <1> 	je optesttrue
  1361 00000F55 43                  <1> 	inc ebx
  1362 00000F56 46                  <1> 	inc esi
  1363 00000F57 EBEF                <1> 	jmp opretest
  1364                              <1> optesttrue:
  1365 00000F59 3C00                <1> 	cmp al, 0
  1366 00000F5B 7503                <1> 	jne optestfalse
  1367 00000F5D B001                <1> 	mov al, 1
  1368 00000F5F C3                  <1> 	ret
  1369                              <1> optestfalse:
  1370 00000F60 B000                <1> 	mov al, 0
  1371 00000F62 C3                  <1> 	ret
  1372                              <1> 
  1373                              <1> cndtest:			;si=user bx=prog cl=endchar returns 1 in al if true
  1374 00000F63 B000                <1> 	mov al, 0
  1375 00000F65 8A06                <1> cndretest:	mov al, [esi]
  1376 00000F67 8A23                <1> 	mov ah, [ebx]
  1377 00000F69 38CC                <1> 	cmp ah, cl
  1378 00000F6B 7408                <1> 	je cndtesttrue
  1379 00000F6D 38E0                <1> 	cmp al, ah
  1380 00000F6F 750B                <1> 	jne cndtestfalse
  1381 00000F71 43                  <1> 	inc ebx
  1382 00000F72 46                  <1> 	inc esi
  1383 00000F73 EBF0                <1> 	jmp cndretest
  1384                              <1> cndtesttrue:
  1385 00000F75 38C8                <1> 	cmp al, cl
  1386 00000F77 7506                <1> 	jne cndtestalmost
  1387 00000F79 B001                <1> 	mov al, 1
  1388 00000F7B C3                  <1> 	ret
  1389                              <1> cndtestfalse:
  1390 00000F7C B000                <1> 	mov al, 0
  1391 00000F7E C3                  <1> 	ret
  1392                              <1> cndtestalmost:
  1393 00000F7F B002                <1> 	mov al, 2
  1394 00000F81 C3                  <1> 	ret
  1395 00000F82 00                  <1> currentdir db 0
  1396 00000F83 BE[6F130000]        <1> dir:	mov esi, fileindex
  1397 00000F88 8A06                <1> 	dirnxt:	mov al, [esi]
  1398 00000F8A B400                <1> 		mov ah, 0
  1399 00000F8C 3C05                <1> 		cmp al, 5
  1400 00000F8E 744A                <1> 		je dirfnd
  1401 00000F90 3C07                <1> 		cmp al, 7
  1402 00000F92 743C                <1> 		je dirfnd3
  1403 00000F94 3C06                <1> 		cmp al, 6
  1404 00000F96 7438                <1> 		je dirfnd3
  1405 00000F98 46                  <1> 		inc esi
  1406 00000F99 81FE[6F150000]      <1> 		cmp esi,  fileindexend
  1407 00000F9F 737B                <1> 		jae dirdn
  1408 00000FA1 EBE5                <1> 		jmp dirnxt
  1409 00000FA3 060400626174636800- <1> 	typetable db 6,4,0,"batch",0,7,4,0,"document",0,10,4,0,"folder",0,5,4,0,"executable",0
  1410 00000FAC 070400646F63756D65- <1>
  1411 00000FB5 6E74000A0400666F6C- <1>
  1412 00000FBE 646572000504006578- <1>
  1413 00000FC7 6563757461626C6500  <1>
  1414                              <1> 	dirfnd3:
  1415 00000FD0 46                  <1> 		inc esi
  1416 00000FD1 81FE[6F150000]      <1> 		cmp esi, fileindexend
  1417 00000FD7 76AF                <1> 		jbe dirnxt
  1418 00000FD9 4E                  <1> 		dec esi
  1419 00000FDA 46                  <1> 	dirfnd:	inc esi
  1420 00000FDB 8A06                <1> 		mov al, [esi]
  1421 00000FDD B400                <1> 		mov ah, 0
  1422 00000FDF 3C04                <1> 		cmp al, 4
  1423 00000FE1 740B                <1> 		je dirfnd2
  1424 00000FE3 46                  <1> 		inc esi
  1425 00000FE4 81FE[6F150000]      <1> 		cmp esi,  fileindexend
  1426 00000FEA 7330                <1> 		jae dirdn
  1427 00000FEC EB9A                <1> 		jmp dirnxt
  1428 00000FEE 81C601000000        <1> 	dirfnd2: add esi, 1
  1429 00000FF4 E86CFBFFFF          <1> 		call print
  1430 00000FF9 8935[21100000]      <1> 		mov [esidir], esi
  1431 00000FFF BE[81410000]        <1> 		mov esi, line
  1432 00001004 E85CFBFFFF          <1> 		call print
  1433 00001009 8B35[21100000]      <1> 		mov esi, [esidir]
  1434 0000100F 81FE[6F150000]      <1> 		cmp esi,  fileindexend
  1435 00001015 7305                <1> 		jae dirdn
  1436 00001017 E96CFFFFFF          <1> 		jmp dirnxt
  1437 0000101C E91CFEFFFF          <1> 	dirdn:	jmp nwcmd
  1438 00001021 00000000            <1> esidir dd 0
  1439                              <1> 
  1440                              <1> array:				;arraystart in si, arrayend in bx, arrayseperator in cx
  1441                              <1> 		                ;ends if array seperator is found backwards after 0
  1442                              <1> 	arnxt:	      
  1443 00001025 88E8                <1> 		mov al, ch
  1444 00001027 88CC                <1> 		mov ah, cl        
  1445 00001029 663906              <1> 		cmp [esi], ax
  1446 0000102C 744D                <1> 		je ardn
  1447 0000102E 66390E              <1> 		cmp [esi], cx
  1448 00001031 7407                <1> 		je arfnd
  1449 00001033 46                  <1> 		inc esi
  1450 00001034 39DE                <1> 		cmp esi, ebx
  1451 00001036 7343                <1> 		jae ardn
  1452 00001038 EBEB                <1> 		jmp arnxt
  1453 0000103A 81C602000000        <1> 	arfnd: add esi, 2
  1454 00001040 891D[7C100000]      <1> 		mov [arbx], ebx
  1455 00001046 890D[80100000]      <1> 		mov [arcx], ecx
  1456 0000104C E814FBFFFF          <1> 		call print
  1457 00001051 8935[82100000]      <1> 		mov [arsi], esi
  1458 00001057 BE[81410000]        <1> 		mov esi, line
  1459 0000105C E804FBFFFF          <1> 		call print
  1460 00001061 8B1D[7C100000]      <1> 		mov ebx, [arbx]
  1461 00001067 668B0D[80100000]    <1> 		mov cx, [arcx]
  1462 0000106E 8B35[82100000]      <1> 		mov esi, [arsi]
  1463 00001074 46                  <1> 		inc esi
  1464 00001075 39DE                <1> 		cmp esi, ebx
  1465 00001077 7302                <1> 		jae ardn
  1466 00001079 EBAA                <1> 		jmp arnxt
  1467 0000107B C3                  <1> 	ardn:	ret
  1468 0000107C 00000000            <1> arbx:	dw 0,0
  1469 00001080 0000                <1> arcx:	db 0,0
  1470 00001082 00000000            <1> arsi:	dw 0,0
  1471                              <1> 
  1472                              <1> clearbuffer:
  1473 00001086 BE[701C0000]        <1> 	mov esi, buf2
  1474 0000108B B030                <1> 	mov al, '0'
  1475 0000108D 81FE[841C0000]      <1> clearbuf: cmp esi, numbuf
  1476 00001093 7305                <1> 	jae doneclearbuff
  1477 00001095 8806                <1> 	mov [esi], al
  1478 00001097 46                  <1> 	inc esi
  1479 00001098 EBF3                <1> 	jmp clearbuf
  1480                              <1> doneclearbuff: 
  1481 0000109A C3                  <1> 		ret
  1482                              <1> 
  1483                              <1> convert:
  1484 0000109B 4E                  <1> 	dec esi
  1485 0000109C 89F3                <1> 	mov ebx, esi		;place to convert into must be in si, number to convert must be in cx
  1486                              <1> cnvrt:
  1487 0000109E 89DE                <1> 	mov esi, ebx
  1488 000010A0 81EE09000000        <1> 	sub esi, 9
  1489 000010A6 81F900CA9A3B        <1> 	cmp ecx, 1000000000
  1490 000010AC 720A                <1> 	jb ten8
  1491 000010AE 81E900CA9A3B        <1> 	sub ecx, 1000000000
  1492 000010B4 FE06                <1> 	inc byte [esi]
  1493 000010B6 EBE6                <1> 	jmp cnvrt
  1494 000010B8 46                  <1> ten8:	inc esi
  1495 000010B9 81F900E1F505        <1> 	cmp ecx, 100000000
  1496 000010BF 720A                <1> 	jb ten7
  1497 000010C1 81E900E1F505        <1> 	sub ecx, 100000000
  1498 000010C7 FE06                <1> 	inc byte [esi]
  1499 000010C9 EBD3                <1> 	jmp cnvrt
  1500 000010CB 46                  <1> ten7:	inc esi
  1501 000010CC 81F980969800        <1> 	cmp ecx, 10000000
  1502 000010D2 720A                <1> 	jb ten6
  1503 000010D4 81E980969800        <1> 	sub ecx, 10000000
  1504 000010DA FE06                <1> 	inc byte [esi]
  1505 000010DC EBC0                <1> 	jmp cnvrt
  1506 000010DE 46                  <1> ten6:	inc esi
  1507 000010DF 81F940420F00        <1> 	cmp ecx, 1000000
  1508 000010E5 720A                <1> 	jb ten5
  1509 000010E7 81E940420F00        <1> 	sub ecx, 1000000
  1510 000010ED FE06                <1> 	inc byte [esi]
  1511 000010EF EBAD                <1> 	jmp cnvrt
  1512 000010F1 46                  <1> ten5:	inc esi
  1513 000010F2 81F9A0860100        <1> 	cmp ecx, 100000
  1514 000010F8 720A                <1> 	jb ten4
  1515 000010FA 81E9A0860100        <1> 	sub ecx, 100000
  1516 00001100 FE06                <1> 	inc byte [esi]
  1517 00001102 EB9A                <1> 	jmp cnvrt
  1518 00001104 46                  <1> ten4:	inc esi
  1519 00001105 81F910270000        <1> 	cmp ecx, 10000
  1520 0000110B 720A                <1> 	jb ten3
  1521 0000110D 81E910270000        <1> 	sub ecx, 10000
  1522 00001113 FE06                <1> 	inc byte [esi]
  1523 00001115 EB87                <1> 	jmp cnvrt
  1524 00001117 46                  <1> ten3:	inc esi
  1525 00001118 81F9E8030000        <1> 	cmp ecx, 1000
  1526 0000111E 720D                <1> 	jb ten2
  1527 00001120 81E9E8030000        <1> 	sub ecx, 1000
  1528 00001126 FE06                <1> 	inc byte [esi]
  1529 00001128 E971FFFFFF          <1> 	jmp cnvrt
  1530 0000112D 46                  <1> ten2:	inc esi
  1531 0000112E 81F964000000        <1> 	cmp ecx, 100
  1532 00001134 720D                <1> 	jb ten1
  1533 00001136 81E964000000        <1> 	sub ecx, 100
  1534 0000113C FE06                <1> 	inc byte [esi]
  1535 0000113E E95BFFFFFF          <1> 	jmp cnvrt
  1536 00001143 46                  <1> ten1:	inc esi
  1537 00001144 81F90A000000        <1> 	cmp ecx, 10
  1538 0000114A 720D                <1> 	jb ten0
  1539 0000114C 81E90A000000        <1> 	sub ecx, 10
  1540 00001152 FE06                <1> 	inc byte [esi]
  1541 00001154 E945FFFFFF          <1> 	jmp cnvrt
  1542 00001159 46                  <1> ten0:	inc esi
  1543 0000115A 81F901000000        <1> 	cmp ecx, 1
  1544 00001160 720D                <1> 	jb tendn
  1545 00001162 81E901000000        <1> 	sub ecx, 1
  1546 00001168 FE06                <1> 	inc byte [esi]
  1547 0000116A E92FFFFFFF          <1> 	jmp cnvrt
  1548                              <1> tendn:
  1549 0000116F C3                  <1> 	ret
  1550                              <1> 
  1551                              <1> 	
  1552                              <1> 
  1553 00001170 00<rept>            <1> hexnumber times 8 db 0
  1554 00001178 202000              <1> hexnumberend db "  ",0
  1555                              <1> 
  1556                              <1> 
  1557 0000117B 00000000            <1> sibuf dw 0,0
  1558 0000117F 00000000            <1> dibuf dw 0,0
  1559                              <1> 
  1560                              <1> converthex:
  1561                              <1> clearbufferhex:
  1562 00001183 B030                <1> 	mov al, '0'
  1563 00001185 8935[7B110000]      <1> 	mov [sibuf], esi
  1564 0000118B 893D[7F110000]      <1> 	mov [dibuf], edi
  1565 00001191 39FE                <1> clearbufhex: cmp esi, edi
  1566 00001193 7305                <1> 	jae doneclearbuffhex
  1567 00001195 8806                <1> 	mov [esi], al
  1568 00001197 46                  <1> 	inc esi
  1569 00001198 EBF7                <1> 	jmp clearbufhex
  1570                              <1> doneclearbuffhex:
  1571 0000119A 8B35[7F110000]      <1> 	mov esi, [dibuf]
  1572 000011A0 89CA                <1> 	mov edx, ecx
  1573 000011A2 81FA00000000        <1> 	cmp edx, 0
  1574 000011A8 741F                <1> 	je donenxtephx
  1575                              <1> nxtexphx:	;0x10^x
  1576 000011AA 4E                  <1> 	dec esi
  1577 000011AB 89F7                <1> 	mov edi, esi		;;location of 0x10^x
  1578 000011AD 89D1                <1> 	mov ecx, edx
  1579 000011AF 81E10F000000        <1> 	and ecx, 0xF		;;just this digit
  1580 000011B5 E81C000000          <1> 	call cnvrtexphx		;;get this digit
  1581 000011BA 89FE                <1> 	mov esi, edi
  1582 000011BC C1EA04              <1> 	shr edx, 4		;;next digit
  1583 000011BF 81FA00000000        <1> 	cmp edx, 0
  1584 000011C5 7402                <1> 	je donenxtephx
  1585 000011C7 EBE1                <1> 	jmp nxtexphx
  1586                              <1> donenxtephx:
  1587 000011C9 8B35[7B110000]      <1> 	mov esi, [sibuf]
  1588 000011CF 8B3D[7F110000]      <1> 	mov edi, [dibuf]
  1589 000011D5 C3                  <1> 	ret
  1590                              <1> cnvrtexphx:			;;convert this number
  1591 000011D6 89F3                <1> 	mov ebx, esi		;place to convert to must be in si, number to convert must be in cx
  1592 000011D8 81F900000000        <1> 	cmp ecx, 0
  1593 000011DE 7429                <1> 	je zerohx
  1594 000011E0 8A06                <1> cnvrthx:  mov al, [esi]
  1595 000011E2 3C39                <1> 	cmp al, '9'
  1596 000011E4 741B                <1> 	je lettershx
  1597 000011E6 3C46                <1> lttrhxdn: cmp al, 'F'
  1598 000011E8 741F                <1> 	je zerohx
  1599 000011EA 8A06                <1> 	mov al, [esi]
  1600 000011EC FEC0                <1> 	inc al
  1601 000011EE 8806                <1> 	mov [esi], al
  1602 000011F0 89DE                <1> 	mov esi, ebx
  1603 000011F2 81E901000000        <1> cnvrtlphx: sub ecx, 1
  1604 000011F8 81F900000000        <1> 	cmp ecx, 0
  1605 000011FE 75E0                <1> 	jne cnvrthx
  1606 00001200 C3                  <1> 	ret
  1607                              <1> lettershx:
  1608 00001201 B041                <1> 	mov al, 'A'
  1609 00001203 2C01                <1> 	sub al, 1
  1610 00001205 8806                <1> 	mov [esi], al
  1611 00001207 EBDD                <1> 	jmp lttrhxdn
  1612 00001209 B030                <1> zerohx:	mov al, '0'
  1613 0000120B 8806                <1> 	mov [esi], al
  1614 0000120D 4E                  <1> 	dec esi
  1615 0000120E 8A06                <1> 	mov al, [esi]
  1616 00001210 3C46                <1> 	cmp al, 'F'
  1617 00001212 74F5                <1> 	je zerohx
  1618 00001214 41                  <1> 	inc ecx
  1619 00001215 EBDB                <1> 	jmp cnvrtlphx
  1620                              <1> 
  1621 00001217 01                  <1> firsthexshown db 1
  1622                              <1> showhex:
  1623 00001218 60                  <1> 	pusha
  1624 00001219 BE[70110000]        <1> 	mov esi, hexnumber
  1625 0000121E BF[78110000]        <1> 	mov edi, hexnumberend
  1626 00001223 E85BFFFFFF          <1> 	call converthex
  1627 00001228 803D[17120000]01    <1> 	cmp byte [firsthexshown], 1
  1628 0000122F 7504                <1> 	jne showthathex
  1629 00001231 66BA0000            <1> 	mov dx, 0
  1630                              <1> showthathex:
  1631 00001235 803D[17120000]03    <1> 	cmp byte [firsthexshown], 3
  1632 0000123C 750A                <1> 	jne nonewhexline
  1633 0000123E BE[81410000]        <1> 	mov esi, line
  1634 00001243 E81DF9FFFF          <1> 	call print
  1635                              <1> nonewhexline:
  1636 00001248 803D[17120000]04    <1> 	cmp byte [firsthexshown], 4
  1637 0000124F 7527                <1> 	jne notabfixhex
  1638 00001251 B1A0                <1> 	mov cl, 160
  1639 00001253 28D1                <1> 	sub cl, dl
  1640 00001255 C0E905              <1> 	shr cl, 5
  1641 00001258 C0E105              <1> 	shl cl, 5
  1642 0000125B 80F900              <1> 	cmp cl, 0
  1643 0000125E 750F                <1> 	jne nonewlinetabfixhex
  1644 00001260 BE[81410000]        <1> 	mov esi, line
  1645 00001265 E8FBF8FFFF          <1> 	call print
  1646 0000126A E909000000          <1> 	jmp notabfixhex
  1647                              <1> nonewlinetabfixhex:
  1648 0000126F 80C20F              <1> 	add dl, 15
  1649 00001272 C0EA04              <1> 	shr dl, 4
  1650 00001275 C0E204              <1> 	shl dl, 4
  1651                              <1> notabfixhex:
  1652 00001278 BE[70110000]        <1> 	mov esi, hexnumber
  1653 0000127D E8E3F8FFFF          <1> 	call print
  1654 00001282 803D[17120000]02    <1> 	cmp byte [firsthexshown], 2
  1655 00001289 750A                <1> 	jne hexshown
  1656 0000128B BE[81410000]        <1> 	mov esi, line
  1657 00001290 E8D0F8FFFF          <1> 	call print
  1658                              <1> hexshown:
  1659 00001295 C605[17120000]00    <1> 	mov byte [firsthexshown], 0
  1660 0000129C 61                  <1> 	popa
  1661 0000129D C3                  <1> 	ret
  1662                              <1> 
  1663                              <1> 
  1664 0000129E 303030303030303030- <1> decnumber db "00000000000000"
  1665 000012A7 3030303030          <1>
  1666 000012AC 2000                <1> decnumberend: db " ",0
  1667                              <1> 
  1668                              <1> showdec: ;;same as showhex, just uses decimal conversion
  1669 000012AE 60                  <1> 	pusha
  1670 000012AF BF[9E120000]        <1> 	mov edi, decnumber
  1671 000012B4 BE[AC120000]        <1> 	mov esi, decnumberend
  1672                              <1> cleardecbuf:
  1673 000012B9 C60730              <1> 	mov byte [edi], '0'
  1674 000012BC 47                  <1> 	inc edi
  1675 000012BD 39F7                <1> 	cmp edi, esi
  1676 000012BF 72F8                <1> 	jb cleardecbuf
  1677 000012C1 BF[9E120000]        <1> 	mov edi, decnumber
  1678 000012C6 E8D0FDFFFF          <1> 	call convert
  1679 000012CB 803D[17120000]01    <1> 	cmp byte [firsthexshown], 1
  1680 000012D2 7504                <1> 	jne showthatdec
  1681 000012D4 66BA0000            <1> 	mov dx, 0
  1682                              <1> showthatdec:
  1683 000012D8 803D[17120000]03    <1> 	cmp byte [firsthexshown], 3
  1684 000012DF 750A                <1> 	jne nonewdecline
  1685 000012E1 BE[81410000]        <1> 	mov esi, line
  1686 000012E6 E87AF8FFFF          <1> 	call print
  1687                              <1> nonewdecline:
  1688 000012EB 803D[17120000]04    <1> 	cmp byte [firsthexshown], 4
  1689 000012F2 7527                <1> 	jne notabfixdec
  1690 000012F4 B1A0                <1> 	mov cl, 160
  1691 000012F6 28D1                <1> 	sub cl, dl
  1692 000012F8 C0E905              <1> 	shr cl, 5
  1693 000012FB C0E105              <1> 	shl cl, 5
  1694 000012FE 80F900              <1> 	cmp cl, 0
  1695 00001301 750F                <1> 	jne nonewlinetabfixdec
  1696 00001303 BE[81410000]        <1> 	mov esi, line
  1697 00001308 E858F8FFFF          <1> 	call print
  1698 0000130D E909000000          <1> 	jmp notabfixdec
  1699                              <1> nonewlinetabfixdec:
  1700 00001312 80C20F              <1> 	add dl, 15
  1701 00001315 C0EA04              <1> 	shr dl, 4
  1702 00001318 C0E204              <1> 	shl dl, 4
  1703                              <1> notabfixdec:
  1704 0000131B BE[9E120000]        <1> 	mov esi, decnumber
  1705 00001320 4E                  <1> 	dec esi
  1706                              <1> sifind:
  1707 00001321 46                  <1> 	inc esi
  1708 00001322 803E30              <1> 	cmp byte [esi], '0'
  1709 00001325 74FA                <1> 	je sifind
  1710 00001327 E839F8FFFF          <1> 	call print
  1711 0000132C 803D[17120000]02    <1> 	cmp byte [firsthexshown], 2
  1712 00001333 750A                <1> 	jne decshown
  1713 00001335 BE[81410000]        <1> 	mov esi, line
  1714 0000133A E826F8FFFF          <1> 	call print
  1715                              <1> decshown:
  1716 0000133F C605[17120000]00    <1> 	mov byte [firsthexshown], 0
  1717 00001346 61                  <1> 	popa
  1718 00001347 C3                  <1> 	ret
  1719                              <1> 	
  1720                              <1> cnvrttxt: 
  1721 00001348 B900000000          <1> 	mov ecx, 0
  1722 0000134D B800000000          <1> 	mov eax, 0
  1723 00001352 BA00000000          <1> 	mov edx, 0
  1724 00001357 BB00000000          <1> 	mov ebx, 0
  1725 0000135C 4E                  <1> 	dec esi
  1726                              <1> cnvrtlptxt:
  1727 0000135D 46                  <1> 	inc esi
  1728 0000135E 8A06                <1> 	mov al, [esi]
  1729 00001360 3C00                <1> 	cmp al, 0
  1730 00001362 75F9                <1> 	jne cnvrtlptxt
  1731 00001364 4E                  <1> 	dec esi
  1732 00001365 8A06                <1> 	mov al, [esi]
  1733 00001367 3C30                <1> 	cmp al, '0'
  1734 00001369 7504                <1> 	jne txtlp
  1735 0000136B 39FE                <1> zerotest: cmp esi, edi
  1736 0000136D 745B                <1> 	je donecnvrt
  1737                              <1> txtlp:	
  1738 0000136F B800000000          <1> 	mov eax, 0
  1739 00001374 8A06                <1> 	mov al, [esi]
  1740 00001376 3C3D                <1> 	cmp al, '='
  1741 00001378 7450                <1> 	je donecnvrt
  1742 0000137A 3C30                <1> 	cmp al, 48
  1743 0000137C 724C                <1> 	jb donecnvrt
  1744 0000137E 3C23                <1> 	cmp al, '#'
  1745 00001380 7448                <1> 	je donecnvrt
  1746 00001382 39FE                <1> 	cmp esi, edi
  1747 00001384 7244                <1> 	jb donecnvrt
  1748 00001386 81F900000000        <1> 	cmp ecx, 0
  1749 0000138C 7708                <1> 	ja exp
  1750 0000138E 2C30                <1> noexp:	sub al, 48
  1751 00001390 01C2                <1> 	add edx, eax
  1752 00001392 4E                  <1> 	dec esi
  1753 00001393 41                  <1> 	inc ecx
  1754 00001394 EBD9                <1> 	jmp txtlp
  1755 00001396 81F900000000        <1> exp:	cmp ecx, 0
  1756 0000139C 74F0                <1> 	je noexp
  1757 0000139E 2C30                <1> 	sub al, 48
  1758 000013A0 51                  <1> 	push ecx
  1759 000013A1 89C3                <1> expmul:	mov ebx, eax
  1760 000013A3 01D8                <1> 	add eax, ebx
  1761 000013A5 01D8                <1> 	add eax, ebx
  1762 000013A7 01D8                <1> 	add eax, ebx
  1763 000013A9 01D8                <1> 	add eax, ebx
  1764 000013AB 01D8                <1> 	add eax, ebx
  1765 000013AD 01D8                <1> 	add eax, ebx
  1766 000013AF 01D8                <1> 	add eax, ebx
  1767 000013B1 01D8                <1> 	add eax, ebx
  1768 000013B3 01D8                <1> 	add eax, ebx
  1769 000013B5 81E901000000        <1> 	sub ecx, 1
  1770 000013BB 81F900000000        <1> 	cmp ecx, 0
  1771 000013C1 77DE                <1> 	ja expmul
  1772 000013C3 01C2                <1> 	add edx, eax
  1773 000013C5 59                  <1> 	pop ecx
  1774 000013C6 4E                  <1> 	dec esi
  1775 000013C7 41                  <1> 	inc ecx
  1776 000013C8 EBA5                <1> 	jmp txtlp
  1777 000013CA 89D1                <1> donecnvrt: mov ecx, edx
  1778 000013CC C3                  <1> 	ret
  1779                                      %include 'source/builtinprogs.asm'
  1780 000013CD 050406040704        <1> filetypes db 5,4,6,4,7,4
  1781                              <1> progstart:		;programs start here
  1782                              <1> ;db 5,4,"index",0
  1783                              <1> ;	call indexfiles
  1784                              <1> ;	jmp nwcmd
  1785                              <1> indexfiles:
  1786 000013D3 BE[D3130000]        <1> 	mov esi, progstart
  1787 000013D8 BB[6F130000]        <1> 	mov ebx, fileindex
  1788 000013DD BF[D3130000]        <1> 	mov edi, progstart
  1789 000013E2 81EF02000000        <1> 	sub edi, 2
  1790                              <1> indexloop:
  1791 000013E8 668B0E              <1> 	mov cx, [esi]
  1792                              <1> 	indexloop2:
  1793 000013EB 663B0F              <1> 		cmp cx, [edi]
  1794 000013EE 7424                <1> 		je indexloop2done
  1795 000013F0 81EF02000000        <1> 		sub edi, 2
  1796 000013F6 81FF[CD130000]      <1> 		cmp edi, filetypes
  1797 000013FC 73ED                <1> 		jae indexloop2
  1798 000013FE BF[D3130000]        <1> 	mov edi, progstart
  1799 00001403 81EF02000000        <1> 	sub edi, 2
  1800 00001409 46                  <1> 	inc esi
  1801 0000140A 81FE[67230000]      <1> 	cmp esi, batchprogend
  1802 00001410 734E                <1> 	jae indexloopdone
  1803 00001412 EBD4                <1> 	jmp indexloop
  1804                              <1> indexloop2done:
  1805 00001414 66890B              <1> 	mov [ebx], cx
  1806 00001417 81C302000000        <1> 	add ebx, 2
  1807 0000141D 81C602000000        <1> 	add esi, 2
  1808                              <1> 	nameindex:
  1809 00001423 8A0E                <1> 		mov cl, [esi]
  1810 00001425 80F900              <1> 		cmp cl, 0
  1811 00001428 7406                <1> 		je nameindexdone
  1812 0000142A 880B                <1> 		mov [ebx], cl
  1813 0000142C 46                  <1> 		inc esi
  1814 0000142D 43                  <1> 		inc ebx
  1815 0000142E EBF3                <1> 		jmp nameindex
  1816                              <1> 	nameindexdone:
  1817 00001430 43                  <1> 		inc ebx
  1818 00001431 66C7030000          <1> 		mov word [ebx], 0
  1819 00001436 81C302000000        <1> 		add ebx, 2
  1820 0000143C 46                  <1> 		inc esi
  1821 0000143D 8933                <1> 		mov [ebx], esi
  1822 0000143F 81C304000000        <1> 		add ebx, 4
  1823 00001445 66C7030000          <1> 		mov word [ebx], 0
  1824 0000144A 81C302000000        <1> 		add ebx, 2
  1825 00001450 81FB[6F150000]      <1> 		cmp ebx, fileindexend
  1826 00001456 7308                <1> 		jae indexloopdone
  1827 00001458 81C601000000        <1> 		add esi, 1
  1828 0000145E EB88                <1> 		jmp indexloop
  1829 00001460 C3                  <1> indexloopdone: 	ret
  1830                              <1> 
  1831                              <1> 
  1832                              <1> ;db 5,4,"showindex",0
  1833                              <1> ;	mov esi, fileindex
  1834                              <1> ;	mov ebx, fileindexend
  1835                              <1> ;	mov cl, 5
  1836                              <1> ;	mov ch, 4
  1837                              <1> ;	call array
  1838                              <1> ;	mov esi, fileindex
  1839                              <1> ;	mov ebx, fileindexend
  1840                              <1> ;	mov cl, 6
  1841                              <1> ;	mov ch, 4
  1842                              <1> ;	call array
  1843                              <1> ;	mov esi, fileindex
  1844                              <1> ;	mov ebx, fileindexend
  1845                              <1> ;	mov cl, 7
  1846                              <1> ;	mov ch, 4
  1847                              <1> ;	call array
  1848                              <1> ;	jmp nwcmd
  1849                              <1> 
  1850 00001461 05046C7300          <1> db 5,4,"ls",0
  1851 00001466 BE[D3130000]        <1> 	lscmd:	mov esi, progstart
  1852 0000146B BB[67230000]        <1> 		mov ebx, progend
  1853 00001470 E90EFBFFFF          <1> 		jmp dir
  1854                              <1> 		
  1855 00001475 05046469736B00      <1> db 5,4,"disk",0
  1856 0000147C B900000000          <1> 		mov ecx, 0
  1857 00001481 8A0D[2B000000]      <1> 		mov cl, [DriveNumber]
  1858 00001487 C605[17120000]00    <1> 		mov byte [firsthexshown], 0
  1859 0000148E E885FDFFFF          <1> 		call showhex
  1860 00001493 BE[81410000]        <1> 		mov esi, line
  1861 00001498 E8C8F6FFFF          <1> 		call print
  1862 0000149D BE[CC400000]        <1> 		mov esi, diskfileindex
  1863                              <1> 	diskindexdir:
  1864 000014A2 E8BEF6FFFF          <1> 		call print
  1865 000014A7 8B4E05              <1> 		mov ecx, [esi + 5]
  1866 000014AA C605[17120000]03    <1> 		mov byte [firsthexshown], 3
  1867 000014B1 E8F8FDFFFF          <1> 		call showdec
  1868 000014B6 56                  <1> 		push esi
  1869 000014B7 BE[81410000]        <1> 		mov esi, line
  1870 000014BC E8A4F6FFFF          <1> 		call print
  1871 000014C1 5E                  <1> 		pop esi
  1872 000014C2 81C609000000        <1> 		add esi, 9
  1873 000014C8 81FE[43410000]      <1> 		cmp esi, enddiskfileindex
  1874 000014CE 72D2                <1> 		jb diskindexdir
  1875 000014D0 E968F9FFFF          <1> 		jmp nwcmd
  1876                              <1> 
  1877 000014D5 0504636C65617200    <1> db 5,4,"clear",0
  1878 000014DD E832F7FFFF          <1> 	cls:	call clear
  1879 000014E2 E956F9FFFF          <1> 		jmp nwcmd
  1880                              <1> 		
  1881 000014E7 05047761697400      <1> db 5,4,"wait",0
  1882 000014EE B000                <1> 		mov al, 0
  1883 000014F0 E840F6FFFF          <1> 		call int302
  1884 000014F5 E943F9FFFF          <1> 		jmp nwcmd
  1885                              <1> 
  1886 000014FA 05046563686F00      <1> db 5,4,"echo",0
  1887 00001501 BE[701A0000]        <1> 	echo:	mov esi, buftxt
  1888 00001506 81C605000000        <1> 		add esi, 5
  1889 0000150C 8A06                <1> 		mov al, [esi]
  1890 0000150E 3C24                <1> 		cmp al, '$'
  1891 00001510 7414                <1> 		je echovr
  1892 00001512 E84EF6FFFF          <1> 		call print
  1893 00001517 BE[81410000]        <1> 		mov esi, line
  1894 0000151C E844F6FFFF          <1> 		call print
  1895 00001521 E917F9FFFF          <1> 		jmp nwcmd
  1896 00001526 BB[6F150000]        <1> 	echovr:	mov ebx, variables
  1897 0000152B BF06000000          <1> 		mov edi, 6
  1898 00001530 E83A000000          <1> 		call nxtvrech
  1899 00001535 E957000000          <1> 		jmp prntvr2
  1900 0000153A B13D                <1> 	echvar:	mov cl, '='
  1901 0000153C 43                  <1> 		inc ebx
  1902 0000153D 8A03                <1> 		mov al, [ebx]
  1903 0000153F 3C00                <1> 		cmp al, 0
  1904 00001541 742C                <1> 		je nxtvrech
  1905 00001543 3C3D                <1> 		cmp al, '='
  1906 00001545 7420                <1> 		je nxtvrechb1
  1907 00001547 BE[701A0000]        <1> 		mov esi, buftxt
  1908 0000154C 01FE                <1> 		add esi, edi
  1909 0000154E E810FAFFFF          <1> 		call cndtest
  1910 00001553 3C02                <1> 		cmp al, 2
  1911 00001555 7436                <1> 		je prntvr
  1912 00001557 3C01                <1> 		cmp al, 1
  1913 00001559 7432                <1> 		je prntvr
  1914 0000155B BE[701A0000]        <1> 		mov esi, buftxt
  1915 00001560 01FE                <1> 		add esi, edi
  1916 00001562 E908000000          <1> 		jmp nxtvrech
  1917                              <1> 	nxtvrechb1:
  1918 00001567 81EB02000000        <1> 		sub ebx, 2
  1919 0000156D EBCB                <1> 		jmp echvar
  1920 0000156F 8A03                <1> 	nxtvrech: mov al, [ebx]
  1921 00001571 3C05                <1> 		cmp al, 5
  1922 00001573 740F                <1> 		je nxtvrec2
  1923 00001575 43                  <1> 		inc ebx
  1924 00001576 81FB[6F1A0000]      <1> 		cmp ebx, varend
  1925 0000157C 0F83BBF8FFFF        <1> 		jae nwcmd
  1926 00001582 EBEB                <1> 		jmp nxtvrech
  1927 00001584 43                  <1> 	nxtvrec2: inc ebx
  1928 00001585 8A03                <1> 		mov al, [ebx]
  1929 00001587 3C04                <1> 		cmp al, 4
  1930 00001589 74AF                <1> 		je echvar
  1931 0000158B EBE2                <1> 		jmp nxtvrech
  1932 0000158D 43                  <1> 	prntvr: inc ebx
  1933 0000158E 89DE                <1> 		mov esi, ebx
  1934 00001590 C3                  <1> 		ret
  1935 00001591 E8CFF5FFFF          <1> 	prntvr2: call print
  1936 00001596 BE[81410000]        <1> 		mov esi, line
  1937 0000159B E8C5F5FFFF          <1> 		call print
  1938 000015A0 E998F8FFFF          <1> 		jmp nwcmd
  1939                              <1> 		
  1940                              <1> 
  1941 000015A5 05042300            <1> db 5,4,"#",0
  1942                              <1> 	num:	
  1943 000015A9 E8D8FAFFFF          <1> 		call clearbuffer
  1944 000015AE C605[65180000]00    <1> 		mov byte [decimal], 0
  1945 000015B5 C605[66180000]00    <1> 		mov byte [decimal2], 0
  1946 000015BC BE[701A0000]        <1> 		mov esi, buftxt
  1947 000015C1 B800000000          <1> 		mov eax, 0
  1948 000015C6 B900000000          <1> 		mov ecx, 0
  1949 000015CB BB00000000          <1> 		mov ebx, 0
  1950 000015D0 8A06                <1> 	num2:	mov al, [esi]
  1951 000015D2 3C2B                <1> 		cmp al, '+'
  1952 000015D4 741B                <1> 		je operatorfound
  1953 000015D6 3C2D                <1> 		cmp al, '-'
  1954 000015D8 7417                <1> 		je operatorfound
  1955 000015DA 3C2A                <1> 		cmp al, '*'
  1956 000015DC 7413                <1> 		je operatorfound
  1957 000015DE 3C2F                <1> 		cmp al, '/'
  1958 000015E0 740F                <1> 		je operatorfound
  1959 000015E2 3C5E                <1> 		cmp al, '^'
  1960 000015E4 740B                <1> 		je operatorfound
  1961 000015E6 46                  <1> 		inc esi
  1962 000015E7 3C00                <1> 		cmp al, 0
  1963 000015E9 0F844EF8FFFF        <1> 		je near nwcmd
  1964 000015EF EBDF                <1> 		jmp num2
  1965 000015F1 50                  <1> 	operatorfound: push eax
  1966 000015F2 B400                <1> 		mov ah, 0
  1967 000015F4 8826                <1> 		mov [esi], ah
  1968 000015F6 89F7                <1> 		mov edi, esi
  1969 000015F8 46                  <1> 		inc esi
  1970 000015F9 8A06                <1> 		mov al, [esi]
  1971 000015FB 3C24                <1> 		cmp al, '$'
  1972 000015FD 0F8481000000        <1> 		je near varnum1
  1973 00001603 3C25                <1> 		cmp al, '%'
  1974 00001605 0F8469000000        <1> 		je near resultnum1
  1975                              <1> 	varnum2: 
  1976 0000160B 57                  <1> 		push edi
  1977 0000160C E8C9000000          <1> 		call checkdecimal
  1978 00001611 5F                  <1> 		pop edi
  1979 00001612 E831FDFFFF          <1> 		call cnvrttxt
  1980                              <1> 	vrnm2:
  1981 00001617 89CB                <1> 		mov ebx, ecx
  1982 00001619 53                  <1> 		push ebx
  1983 0000161A E867FAFFFF          <1> 		call clearbuffer
  1984 0000161F BE[701A0000]        <1> 		mov esi, buftxt
  1985 00001624 89F7                <1> 		mov edi, esi
  1986 00001626 46                  <1> 		inc esi
  1987 00001627 8A06                <1> 		mov al, [esi]
  1988 00001629 3C24                <1> 		cmp al, '$'
  1989 0000162B 0F8474000000        <1> 		je near varnum3
  1990 00001631 3C25                <1> 		cmp al, '%'
  1991 00001633 0F8443000000        <1> 		je near resultnum2
  1992                              <1> 	varnum4: 
  1993 00001639 57                  <1> 		push edi
  1994 0000163A E887000000          <1> 		call checkdecimal2
  1995 0000163F 5F                  <1> 		pop edi
  1996 00001640 E803FDFFFF          <1> 		call cnvrttxt
  1997                              <1> 	vrnm4:
  1998 00001645 5B                  <1> 		pop ebx
  1999 00001646 58                  <1> 		pop eax
  2000 00001647 3C2B                <1> 		cmp al, '+'
  2001 00001649 0F84B9000000        <1> 		je near plusnum
  2002 0000164F 3C2D                <1> 		cmp al, '-'
  2003 00001651 0F84BD000000        <1> 		je near subnum
  2004 00001657 3C2A                <1> 		cmp al, '*'
  2005 00001659 0F84C1000000        <1> 		je near mulnum
  2006 0000165F 3C2F                <1> 		cmp al, '/'
  2007 00001661 0F84CF000000        <1> 		je near divnum
  2008 00001667 3C5E                <1> 		cmp al, '^'
  2009 00001669 0F84ED000000        <1> 		je near expnum
  2010 0000166F E9C9F7FFFF          <1> 		jmp nwcmd
  2011                              <1> 	resultnum1:
  2012 00001674 8B0D[67180000]      <1> 		mov ecx, [result]
  2013 0000167A EB9B                <1> 		jmp vrnm2
  2014                              <1> 	resultnum2:
  2015 0000167C 8B0D[67180000]      <1> 		mov ecx, [result]
  2016 00001682 EBC1                <1> 		jmp vrnm4
  2017 00001684 81EE[701A0000]      <1> 	varnum1: sub esi, buftxt
  2018 0000168A 89F7                <1> 		mov edi, esi
  2019 0000168C 81C6[701A0000]      <1> 		add esi, buftxt
  2020 00001692 47                  <1> 		inc edi
  2021 00001693 BB[6F150000]        <1> 		mov ebx, variables
  2022 00001698 E8D2FEFFFF          <1> 		call nxtvrech
  2023 0000169D 89F7                <1> 		mov edi, esi
  2024 0000169F 4F                  <1> 		dec edi
  2025 000016A0 E966FFFFFF          <1> 		jmp varnum2
  2026 000016A5 81EE[701A0000]      <1> 	varnum3: sub esi, buftxt
  2027 000016AB 89F7                <1> 		mov edi, esi
  2028 000016AD 81C6[701A0000]      <1> 		add esi, buftxt
  2029 000016B3 47                  <1> 		inc edi
  2030 000016B4 BB[6F150000]        <1> 		mov ebx, variables
  2031 000016B9 E8B1FEFFFF          <1> 		call nxtvrech
  2032 000016BE 89F7                <1> 		mov edi, esi
  2033 000016C0 4F                  <1> 		dec edi
  2034 000016C1 E973FFFFFF          <1> 		jmp varnum4
  2035                              <1> 	checkdecimal2:
  2036 000016C6 8A25[65180000]      <1> 		mov ah, [decimal]
  2037 000016CC 8825[66180000]      <1> 		mov [decimal2], ah
  2038 000016D2 B400                <1> 		mov ah, 0
  2039 000016D4 8825[65180000]      <1> 		mov [decimal], ah
  2040                              <1> 	checkdecimal:
  2041 000016DA 89F7                <1> 		mov edi, esi
  2042                              <1> 	chkdec1:
  2043 000016DC 8A07                <1> 		mov al, [edi]
  2044 000016DE 3C2E                <1> 		cmp al, '.'
  2045 000016E0 0F840B000000        <1> 		je near fnddec
  2046 000016E6 3C00                <1> 		cmp al, 0
  2047 000016E8 0F8419000000        <1> 		je near nodecimal
  2048 000016EE 47                  <1> 		inc edi
  2049 000016EF EBEB                <1> 		jmp chkdec1
  2050                              <1> 	fnddec:
  2051 000016F1 8A4701              <1> 		mov al, [edi + 1]
  2052 000016F4 8807                <1> 		mov [edi], al
  2053 000016F6 3C00                <1> 		cmp al, 0
  2054 000016F8 0F8409000000        <1> 		je near nodecimal
  2055 000016FE FE05[65180000]      <1> 		inc byte [decimal]
  2056 00001704 47                  <1> 		inc edi
  2057 00001705 EBEA                <1> 		jmp fnddec
  2058                              <1> 	nodecimal:
  2059 00001707 C3                  <1> 		ret
  2060                              <1> 	plusnum:
  2061 00001708 E816010000          <1> 		call decaddfix
  2062 0000170D 01D9                <1> 		add ecx, ebx
  2063 0000170F E991000000          <1> 		jmp retnum
  2064                              <1> 	subnum:
  2065 00001714 E80A010000          <1> 		call decaddfix
  2066 00001719 29D9                <1> 		sub ecx, ebx
  2067 0000171B E985000000          <1> 		jmp retnum
  2068                              <1> 	mulnum:
  2069 00001720 A0[66180000]        <1> 		mov al, [decimal2]
  2070 00001725 0005[65180000]      <1> 		add [decimal], al
  2071 0000172B 89C8                <1> 		mov eax, ecx
  2072 0000172D F7E3                <1> 		mul ebx
  2073 0000172F 89C1                <1> 		mov ecx, eax
  2074 00001731 E96F000000          <1> 		jmp retnum
  2075                              <1> 	divnum:
  2076 00001736 E8E8000000          <1> 		call decaddfix
  2077 0000173B B000                <1> 		mov al, 0
  2078 0000173D A2[65180000]        <1> 		mov [decimal], al
  2079 00001742 6689C8              <1> 		mov ax, cx
  2080 00001745 80FB00              <1> 		cmp bl, 0
  2081 00001748 0F8457000000        <1> 		je near retnum
  2082 0000174E F6F3                <1> 		div bl
  2083 00001750 B900000000          <1> 		mov ecx, 0
  2084 00001755 88C1                <1> 		mov cl, al
  2085 00001757 E949000000          <1> 		jmp retnum
  2086                              <1> 	expnum:
  2087 0000175C 8A15[65180000]      <1> 		mov dl, [decimal]
  2088 00001762 8815[66180000]      <1> 		mov [decimal2], dl
  2089 00001768 BA00000000          <1> 		mov edx, 0
  2090 0000176D 89C8                <1> 		mov eax, ecx
  2091 0000176F 89D9                <1> 		mov ecx, ebx
  2092 00001771 89C3                <1> 		mov ebx, eax
  2093 00001773 81F900000000        <1> 		cmp ecx, 0
  2094 00001779 7425                <1> 		je noexpnum
  2095 0000177B 49                  <1> 		dec ecx
  2096 0000177C 81F900000000        <1> 		cmp ecx, 0
  2097 00001782 7415                <1> 		je noexpnumlp
  2098 00001784 F7E3                <1> 	expnumlp: mul ebx
  2099 00001786 8A15[66180000]      <1> 		mov dl, [decimal2]
  2100 0000178C 0015[65180000]      <1> 		add [decimal], dl
  2101 00001792 BA00000000          <1> 		mov edx, 0
  2102 00001797 E2EB                <1> 		loop expnumlp
  2103                              <1> 	noexpnumlp:
  2104 00001799 89C1                <1> 		mov ecx, eax
  2105 0000179B E905000000          <1> 		jmp retnum
  2106                              <1> 	noexpnum:
  2107 000017A0 B901000000          <1> 		mov ecx, 1
  2108                              <1> 	retnum: 
  2109 000017A5 BE[841C0000]        <1> 		mov esi, numbuf
  2110 000017AA 890D[67180000]      <1> 		mov [result], ecx
  2111 000017B0 E8E6F8FFFF          <1> 		call convert
  2112 000017B5 BE[841C0000]        <1> 		mov esi, numbuf
  2113 000017BA 8A25[65180000]      <1> 		mov ah, [decimal]
  2114 000017C0 80FC00              <1> 		cmp ah, 0
  2115 000017C3 0F8425000000        <1> 		je near noputdecimal
  2116                              <1> 	putdecimal:
  2117 000017C9 4E                  <1> 		dec esi
  2118 000017CA FECC                <1> 		dec ah
  2119 000017CC 80FC00              <1> 		cmp ah, 0
  2120 000017CF 0F87F4FFFFFF        <1> 		ja near putdecimal
  2121 000017D5 4E                  <1> 		dec esi
  2122 000017D6 8A06                <1> 		mov al, [esi]
  2123 000017D8 C6062E              <1> 		mov byte [esi], '.'
  2124                              <1> 	decputloop:
  2125 000017DB 4E                  <1> 		dec esi
  2126 000017DC 8A26                <1> 		mov ah, [esi]
  2127 000017DE 8806                <1> 		mov [esi], al
  2128 000017E0 88E0                <1> 		mov al, ah
  2129 000017E2 81FE[701C0000]      <1> 		cmp esi, buf2
  2130 000017E8 0F87EDFFFFFF        <1> 		ja near decputloop
  2131                              <1> 	noputdecimal:
  2132 000017EE BE[701C0000]        <1> 		mov esi, buf2
  2133 000017F3 E809000000          <1> 		call chkadd
  2134 000017F8 E940F6FFFF          <1> 		jmp nwcmd
  2135 000017FD 00000000            <1> edxnumbuf dw 0,0
  2136 00001801 8A06                <1> 	chkadd: mov al, [esi]
  2137 00001803 3C30                <1> 		cmp al, '0'
  2138 00001805 750C                <1> 		jne dnadd
  2139 00001807 46                  <1> 		inc esi
  2140 00001808 81FE[841C0000]      <1> 		cmp esi, numbuf
  2141 0000180E 7402                <1> 		je dnaddm1
  2142 00001810 EBEF                <1> 		jmp chkadd
  2143 00001812 4E                  <1> 	dnaddm1: dec esi
  2144 00001813 E84DF3FFFF          <1> 	dnadd:	call print
  2145 00001818 BE[81410000]        <1> 		mov esi, line
  2146 0000181D E843F3FFFF          <1> 		call print
  2147 00001822 C3                  <1> 		ret
  2148                              <1> 		
  2149                              <1> 	decaddfix:
  2150 00001823 A0[66180000]        <1> 		mov al, [decimal2]
  2151 00001828 8A25[65180000]      <1> 		mov ah, [decimal]
  2152 0000182E 38E0                <1> 		cmp al, ah
  2153 00001830 7432                <1> 		je gooddecadd
  2154 00001832 38E0                <1> 		cmp al, ah
  2155 00001834 721A                <1> 		jb lowdecadd
  2156                              <1> 	highdecadd:
  2157 00001836 FEC4                <1> 		inc ah
  2158 00001838 89CA                <1> 		mov edx, ecx
  2159 0000183A C1E103              <1> 		shl ecx, 3
  2160 0000183D 01D1                <1> 		add ecx, edx
  2161 0000183F 01D1                <1> 		add ecx, edx
  2162 00001841 38E0                <1> 		cmp al, ah
  2163 00001843 77F1                <1> 		ja highdecadd
  2164 00001845 8825[65180000]      <1> 		mov [decimal], ah
  2165 0000184B E914000000          <1> 		jmp gooddecadd
  2166                              <1> 	lowdecadd:
  2167 00001850 FEC0                <1> 		inc al
  2168 00001852 89DA                <1> 		mov edx, ebx
  2169 00001854 C1E303              <1> 		shl ebx, 3
  2170 00001857 01D3                <1> 		add ebx, edx
  2171 00001859 01D3                <1> 		add ebx, edx
  2172 0000185B 38E0                <1> 		cmp al, ah
  2173 0000185D 72F1                <1> 		jb lowdecadd
  2174 0000185F A2[65180000]        <1> 		mov [decimal], al
  2175                              <1> 	gooddecadd:
  2176 00001864 C3                  <1> 		ret
  2177                              <1> 		
  2178 00001865 00                  <1> decimal db 0
  2179 00001866 00                  <1> decimal2 db 0
  2180 00001867 00000000            <1> result db 0,0,0,0
  2181                              <1> 	
  2182 0000186B 05042500            <1> db 5,4,"%",0
  2183 0000186F E812F8FFFF          <1> 	ans:	call clearbuffer
  2184 00001874 8B0D[67180000]      <1> 		mov ecx, [result]
  2185 0000187A BE[701C0000]        <1> 		mov esi, buf2
  2186 0000187F E817F8FFFF          <1> 		call convert
  2187 00001884 BE[701C0000]        <1> 		mov esi, buf2
  2188 00001889 E873FFFFFF          <1> 		call chkadd
  2189 0000188E E9AAF5FFFF          <1> 		jmp nwcmd
  2190                              <1> 
  2191 00001893 05042400            <1> db 5,4,"$",0
  2192 00001897 BE[701A0000]        <1> var:	mov esi, buftxt
  2193 0000189C BB[6F150000]        <1> 	mov ebx, variables
  2194 000018A1 8A06                <1> lkeq:	mov al, [esi]
  2195 000018A3 3C3D                <1> 	cmp al, '='
  2196 000018A5 741F                <1> 	je eqfnd	;is there an '=' sign?
  2197 000018A7 3C00                <1> 	cmp al, 0
  2198 000018A9 7403                <1> 	je echovars
  2199 000018AB 46                  <1> 	inc esi
  2200 000018AC EBF3                <1> 	jmp lkeq
  2201 000018AE BE[6F150000]        <1> echovars: mov esi, variables
  2202 000018B3 BB[6F1A0000]        <1> 	mov ebx, varend
  2203 000018B8 B105                <1> 	mov cl, 5
  2204 000018BA B504                <1> 	mov ch, 4
  2205 000018BC E864F7FFFF          <1> 	call array
  2206 000018C1 E977F5FFFF          <1> 	jmp nwcmd
  2207 000018C6 46                  <1> eqfnd:	inc esi
  2208 000018C7 8A06                <1> 	mov al, [esi]
  2209 000018C9 3C00                <1> 	cmp al, 0
  2210 000018CB 740F                <1> 	je readvar
  2211 000018CD BE[701A0000]        <1> 	mov esi, buftxt
  2212 000018D2 BB[6F150000]        <1> 	mov ebx, variables
  2213 000018D7 E917000000          <1> 	jmp seek
  2214                              <1> readvar: 
  2215 000018DC B00D                <1> 	mov al, 13
  2216 000018DE B404                <1> 	mov ah, 4
  2217 000018E0 B307                <1> 	mov bl, 7
  2218 000018E2 E875F0FFFF          <1> 	call intx4
  2219 000018E7 BE[81410000]        <1> 	mov esi, line
  2220 000018EC E874F2FFFF          <1> 	call print
  2221 000018F1 EBA4                <1> 	jmp var
  2222 000018F3 668B03              <1> seek:	mov ax, [ebx]
  2223 000018F6 B105                <1> 	mov cl, 5
  2224 000018F8 B504                <1> 	mov ch, 4
  2225 000018FA 663D0000            <1> 	cmp ax, 0
  2226 000018FE 0F8459000000        <1> 	je near save
  2227 00001904 6639C8              <1> 	cmp ax, cx
  2228 00001907 7403                <1> 	je skfnd
  2229 00001909 43                  <1> 	inc ebx
  2230 0000190A EBE7                <1> 	jmp seek
  2231 0000190C BE[701A0000]        <1> skfnd:	mov esi, buftxt
  2232 00001911 46                  <1> 	inc esi
  2233 00001912 81C302000000        <1> 	add ebx, 2
  2234 00001918 89DF                <1> 	mov edi, ebx
  2235 0000191A B13D                <1> 	mov cl, '='
  2236 0000191C E842F6FFFF          <1> 	call cndtest
  2237 00001921 3C01                <1> 	cmp al, 1	
  2238 00001923 7417                <1> 	je varfnd
  2239 00001925 89FB                <1> 	mov ebx, edi
  2240 00001927 BE[701A0000]        <1> 	mov esi, buftxt
  2241 0000192C 668B03              <1> 	mov ax, [ebx]
  2242 0000192F 663D0000            <1> 	cmp ax, 0
  2243 00001933 0F8424000000        <1> 	je near save
  2244 00001939 43                  <1> 	inc ebx
  2245 0000193A EBB7                <1> 	jmp seek
  2246 0000193C 8A03                <1> varfnd:	mov al, [ebx]
  2247 0000193E 3C04                <1> 	cmp al, 4
  2248 00001940 7404                <1> 	je save2
  2249 00001942 4B                  <1> 	dec ebx
  2250 00001943 4E                  <1> 	dec esi
  2251 00001944 EBF6                <1> 	jmp varfnd
  2252 00001946 4B                  <1> save2:	dec ebx
  2253 00001947 4E                  <1> 	dec esi
  2254 00001948 8A03                <1> 	mov al, [ebx]
  2255 0000194A 3C05                <1> 	cmp al, 5
  2256 0000194C 7402                <1> 	je remove
  2257 0000194E EBEC                <1> 	jmp varfnd
  2258 00001950 8A03                <1> remove: mov al, [ebx]
  2259 00001952 3C00                <1> 	cmp al, 0
  2260 00001954 749D                <1> 	je seek
  2261 00001956 B000                <1> 	mov al, 0
  2262 00001958 8803                <1> 	mov [ebx], al
  2263 0000195A 43                  <1> 	inc ebx
  2264 0000195B EBF3                <1> 	jmp remove	;do not need for now-need defragmentation
  2265 0000195D BE[701A0000]        <1> save:	mov esi, buftxt
  2266 00001962 43                  <1> 	inc ebx
  2267 00001963 B005                <1> 	mov al, 5
  2268 00001965 B404                <1> 	mov ah, 4
  2269 00001967 668903              <1> 	mov [ebx], ax
  2270 0000196A 43                  <1> 	inc ebx
  2271 0000196B 43                  <1> svhere:	inc ebx
  2272 0000196C 46                  <1> 	inc esi
  2273 0000196D 8A06                <1> 	mov al, [esi]
  2274 0000196F 3C00                <1> 	cmp al, 0
  2275 00001971 0F8442000000        <1> 	je near svdone
  2276 00001977 3C25                <1> 	cmp al, '%'
  2277 00001979 7404                <1> 	je ans2
  2278 0000197B 8803                <1> 	mov [ebx], al	
  2279 0000197D EBEC                <1> 	jmp svhere
  2280 0000197F 56                  <1> ans2:	push esi
  2281 00001980 BE[701C0000]        <1> 	mov esi, buf2
  2282 00001985 E823000000          <1> 	call ansfnd
  2283 0000198A E803000000          <1> 	call anscp
  2284 0000198F 5E                  <1> 	pop esi
  2285 00001990 EBD9                <1> 	jmp svhere
  2286 00001992 8A06                <1> anscp:	mov al, [esi]
  2287 00001994 8803                <1> 	mov [ebx], al
  2288 00001996 81FE[841C0000]      <1> 	cmp esi, numbuf
  2289 0000199C 74CD                <1> 	je svhere
  2290 0000199E 3C00                <1> 	cmp al, 0
  2291 000019A0 74C9                <1> 	je svhere
  2292 000019A2 43                  <1> 	inc ebx
  2293 000019A3 46                  <1> 	inc esi
  2294 000019A4 EBEC                <1> 	jmp anscp
  2295 000019A6 5E                  <1> ansnf:	pop esi
  2296 000019A7 8A06                <1> 	mov al, [esi]
  2297 000019A9 8803                <1> 	mov [ebx], al
  2298 000019AB EBBE                <1> 	jmp svhere
  2299 000019AD 46                  <1> ansfnd:	inc esi
  2300 000019AE 8A06                <1> 	mov al, [esi]
  2301 000019B0 3C00                <1> 	cmp al, 0
  2302 000019B2 74F2                <1> 	je ansnf
  2303 000019B4 3C30                <1> 	cmp al, '0'
  2304 000019B6 74F5                <1> 	je ansfnd
  2305 000019B8 C3                  <1> 	ret
  2306 000019B9 B000                <1> svdone:	mov al, 0
  2307 000019BB 8803                <1> 	mov [ebx], al
  2308 000019BD E97BF4FFFF          <1> 	jmp nwcmd
  2309                              <1> 	
  2310 000019C2 05046C6F676F757400  <1> 	db 5,4,"logout",0
  2311                              <1> logout
  2312 000019CB E95BF3FFFF          <1> 	jmp os
  2313                              <1> 	
  2314                              <1> 	
  2315 000019D0 05042E2F00          <1> 	db 5,4,"./",0
  2316                              <1> rundiskprog:
  2317 000019D5 BF[701A0000]        <1> 	mov edi, buftxt
  2318 000019DA 81C702000000        <1> 	add edi, 2
  2319 000019E0 BE00001000          <1> 	mov esi, 0x100000
  2320 000019E5 E82C250000          <1> 	call loadfile
  2321 000019EA 81FA94010000        <1> 	cmp edx, 404
  2322 000019F0 7414                <1> 	je noprogfound
  2323 000019F2 BB00001000          <1> 	mov ebx, 0x100000
  2324 000019F7 66813B4558          <1> 	cmp word [ebx], "EX"
  2325 000019FC 7531                <1> 	jne progbatchfound
  2326 000019FE 81C302000000        <1> 	add ebx, 2
  2327 00001A04 FFE3                <1> 	jmp ebx
  2328                              <1> noprogfound:
  2329 00001A06 BE[48410000]        <1> 	mov esi, notfound1
  2330 00001A0B E855F1FFFF          <1> 	call print
  2331 00001A10 BE[701A0000]        <1> 	mov esi, buftxt
  2332 00001A15 81C602000000        <1> 	add esi, 2
  2333 00001A1B E845F1FFFF          <1> 	call print
  2334 00001A20 BE[52410000]        <1> 	mov esi, notfound2
  2335 00001A25 E83BF1FFFF          <1> 	call print
  2336 00001A2A E90EF4FFFF          <1> 	jmp nwcmd
  2337                              <1> progbatchfound:
  2338 00001A2F BF00001000          <1> 		mov edi, 0x100000
  2339 00001A34 C605[69130000]01    <1> 		mov byte [BATCHISON], 1
  2340                              <1> 	batchrunloop:
  2341 00001A3B E8DAF3FFFF          <1> 		call buftxtclear
  2342 00001A40 BE[701A0000]        <1> 		mov esi, buftxt
  2343                              <1> 	batchrunloop2:
  2344 00001A45 B10D                <1> 		mov cl, 13
  2345 00001A47 B50A                <1> 		mov ch, 10
  2346 00001A49 66390F              <1> 		cmp [edi], cx
  2347 00001A4C 0F841E000000        <1> 		je near nxtbatchrunline
  2348 00001A52 66C1C108            <1> 		rol cx, 8
  2349 00001A56 66390F              <1> 		cmp [edi], cx
  2350 00001A59 0F8411000000        <1> 		je near nxtbatchrunline
  2351 00001A5F 803F00              <1> 		cmp byte [edi], 0
  2352 00001A62 0F8408000000        <1> 		je near nxtbatchrunline
  2353 00001A68 8A07                <1> 		mov al, [edi]
  2354 00001A6A 8806                <1> 		mov [esi], al
  2355 00001A6C 46                  <1> 		inc esi
  2356 00001A6D 47                  <1> 		inc edi
  2357 00001A6E EBD5                <1> 		jmp batchrunloop2
  2358                              <1> 	nxtbatchrunline:
  2359 00001A70 81C702000000        <1> 		add edi, 2
  2360 00001A76 893D[D51A0000]      <1> 		mov [batchedi], edi
  2361 00001A7C C60600              <1> 		mov byte [esi], 0
  2362 00001A7F BE[701A0000]        <1> 		mov esi, buftxt
  2363 00001A84 803E00              <1> 		cmp byte [esi], 0
  2364 00001A87 0F843C000000        <1> 		je near nobatchfoundrun
  2365 00001A8D BB00000000          <1> 		mov ebx, 0
  2366 00001A92 8A1D[00130000]      <1> 		mov bl, [IFON]
  2367 00001A98 80FB01              <1> 		cmp bl, 1
  2368 00001A9B 0F8338000000        <1> 		jae near iftestbatch
  2369                              <1> 	doneiftest:
  2370 00001AA1 803D[9C1B0000]00    <1> 		cmp byte [runnextline], 0
  2371 00001AA8 0F8405000000        <1> 		je near noruniftest
  2372 00001AAE E8FBF3FFFF          <1> 		call progtest
  2373                              <1> 	noruniftest:
  2374 00001AB3 C605[9C1B0000]01    <1> 		mov byte [runnextline], 1
  2375 00001ABA 8B3D[D51A0000]      <1> 		mov edi, [batchedi]
  2376 00001AC0 803F00              <1> 		cmp byte [edi], 0
  2377 00001AC3 0F8572FFFFFF        <1> 		jne near batchrunloop
  2378                              <1> 	nobatchfoundrun:
  2379 00001AC9 C605[69130000]00    <1> 		mov byte [BATCHISON], 0
  2380 00001AD0 E968F3FFFF          <1> 		jmp nwcmd
  2381                              <1> 	
  2382 00001AD5 00000000            <1> batchedi dd 0	
  2383                              <1> 	
  2384                              <1> 	iftestbatch:
  2385 00001AD9 BE[01130000]        <1> 		mov esi, IFTRUE
  2386 00001ADE 01DE                <1> 		add esi, ebx
  2387 00001AE0 803E00              <1> 		cmp byte [esi], 0
  2388 00001AE3 0F85B8FFFFFF        <1> 		jne near doneiftest
  2389 00001AE9 881D[9D1B0000]      <1> 		mov [iffalsebuf], bl
  2390 00001AEF 803D[6A130000]01    <1> 		cmp byte [LOOPON], 1
  2391 00001AF6 750B                <1> 		jne fifindbatch
  2392 00001AF8 8B3D[6B130000]      <1> 		mov edi, [LOOPPOS]
  2393 00001AFE E938FFFFFF          <1> 		jmp batchrunloop
  2394                              <1> 	fifindbatch:
  2395 00001B03 66B96966            <1> 		mov cx, "if"
  2396 00001B07 66B86669            <1> 		mov ax, "fi"
  2397 00001B0B 663907              <1> 		cmp [edi], ax
  2398 00001B0E 0F841A000000        <1> 		je near fifoundbatch
  2399 00001B14 66390F              <1> 		cmp [edi], cx
  2400 00001B17 0F8462000000        <1> 		je near iffoundbatch
  2401 00001B1D 803F00              <1> 		cmp byte [edi], 0
  2402 00001B20 0F8408000000        <1> 		je near fifoundbatch
  2403 00001B26 81C702000000        <1> 		add edi, 2
  2404 00001B2C EBD5                <1> 		jmp fifindbatch
  2405                              <1> 	fifoundbatch:
  2406 00001B2E 81C702000000        <1> 		add edi, 2
  2407 00001B34 B00D                <1> 		mov al, 13
  2408 00001B36 B40A                <1> 		mov ah, 10
  2409 00001B38 663907              <1> 		cmp [edi], ax
  2410 00001B3B 7414                <1> 		je goodfibatch
  2411 00001B3D 66C1C008            <1> 		rol ax, 8
  2412 00001B41 663907              <1> 		cmp [edi], ax
  2413 00001B44 740B                <1> 		je goodfibatch
  2414 00001B46 803F00              <1> 		cmp byte [edi], 0
  2415 00001B49 0F847AFFFFFF        <1> 		je near nobatchfoundrun
  2416 00001B4F EBB2                <1> 		jmp fifindbatch
  2417                              <1> 	goodfibatch:
  2418 00001B51 B001                <1> 		mov al, 1
  2419 00001B53 2805[00130000]      <1> 		sub [IFON], al 
  2420 00001B59 A0[00130000]        <1> 		mov al, [IFON]
  2421 00001B5E 8A1D[9D1B0000]      <1> 		mov bl, [iffalsebuf]
  2422 00001B64 38D8                <1> 		cmp al, bl
  2423 00001B66 779B                <1> 		ja fifindbatch
  2424 00001B68 BE[701A0000]        <1> 		mov esi, buftxt
  2425 00001B6D 81EF02000000        <1> 		sub edi, 2
  2426 00001B73 C605[9C1B0000]00    <1> 		mov byte [runnextline], 0
  2427 00001B7A E9BCFEFFFF          <1> 		jmp batchrunloop
  2428                              <1> 	iffoundbatch:
  2429 00001B7F B020                <1> 		mov al, ' '
  2430 00001B81 81C702000000        <1> 		add edi, 2
  2431 00001B87 3807                <1> 		cmp [edi], al
  2432 00001B89 0F8574FFFFFF        <1> 		jne near fifindbatch
  2433 00001B8F B001                <1> 		mov al, 1
  2434 00001B91 0005[00130000]      <1> 		add [IFON], al
  2435 00001B97 E967FFFFFF          <1> 		jmp fifindbatch
  2436                              <1> 		
  2437                              <1> 		
  2438 00001B9C 01                  <1> runnextline db 1
  2439 00001B9D 00                  <1> iffalsebuf db 0
  2440                              <1> 
  2441 00001B9E E99AF2FFFF          <1> notbatch: jmp nwcmd
  2442                              <1> 
  2443 00001BA3 05047768696C6500    <1> 	db 5,4,"while",0
  2444 00001BAB B000                <1> while:  mov al, 0
  2445 00001BAD 3805[69130000]      <1> 	cmp [BATCHISON], al
  2446 00001BB3 0F84E5FFFFFF        <1> 	je near notbatch
  2447 00001BB9 8B35[65130000]      <1> 	MOV esi, [BATCHPOS]
  2448 00001BBF 4E                  <1> whilefnd: dec esi
  2449 00001BC0 8A06                <1> 	mov al, [esi]
  2450 00001BC2 3C0A                <1> 	cmp al, 10
  2451 00001BC4 0F8412000000        <1> 	je near whilefnd2
  2452 00001BCA 3C0D                <1> 	cmp al, 13
  2453 00001BCC 0F840A000000        <1> 	je near whilefnd2
  2454 00001BD2 3C00                <1> 	cmp al, 0
  2455 00001BD4 0F8402000000        <1> 	je near whilefnd2
  2456 00001BDA EBE3                <1> 	jmp whilefnd
  2457                              <1> whilefnd2:
  2458 00001BDC 8935[6B130000]      <1> 	mov [LOOPPOS], esi
  2459 00001BE2 C605[6A130000]01    <1> 	mov BYTE [LOOPON], 1
  2460 00001BE9 0005[00130000]      <1> 	add [IFON], al
  2461 00001BEF BE[701A0000]        <1> 	mov esi, buftxt
  2462 00001BF4 BB[701A0000]        <1> 	mov ebx, buftxt
  2463 00001BF9 81C306000000        <1> 	add ebx, 6
  2464 00001BFF E923000000          <1> 	jmp chkeqsn
  2465                              <1> 
  2466                              <1> 
  2467 00001C04 0504696600          <1> 	db 5,4,"if",0
  2468 00001C09 B000                <1> if:	mov al, 0
  2469 00001C0B 3805[69130000]      <1> 	cmp [BATCHISON], al
  2470 00001C11 0F8487FFFFFF        <1> 	je near notbatch
  2471 00001C17 BE[701A0000]        <1> 	mov esi, buftxt
  2472 00001C1C BB[701A0000]        <1> 	mov ebx, buftxt
  2473 00001C21 81C303000000        <1> 	add ebx, 3
  2474 00001C27 8A06                <1> chkeqsn: mov al, [esi]
  2475 00001C29 3C00                <1> 	cmp al, 0
  2476 00001C2B 0F846DFFFFFF        <1> 	je near notbatch
  2477 00001C31 3C3D                <1> 	cmp al, '='
  2478 00001C33 0F8403000000        <1> 	je near chkeqdn
  2479 00001C39 46                  <1> 	inc esi
  2480 00001C3A EBEB                <1> 	jmp chkeqsn
  2481 00001C3C B000                <1> chkeqdn: mov al, 0 
  2482 00001C3E 8806                <1> 	mov [esi], al
  2483 00001C40 46                  <1> 	inc esi
  2484 00001C41 8A06                <1> 	mov al, [esi]
  2485 00001C43 3C24                <1> 	cmp al, '$'
  2486 00001C45 0F8462000000        <1> 	je near ifvar1
  2487 00001C4B 8A03                <1> ifvar2: mov al, [ebx]
  2488 00001C4D 3C24                <1> 	cmp al, '$'
  2489 00001C4F 0F847B000000        <1> 	je near ifvar3
  2490 00001C55 E8CFF2FFFF          <1> ifvar4:	call tester
  2491 00001C5A 3C01                <1> 	cmp al, 1
  2492 00001C5C 0F8405000000        <1> 	je near trueif
  2493 00001C62 E923000000          <1> 	jmp falseif
  2494 00001C67 B800000000          <1> trueif:	mov eax, 0
  2495 00001C6C A0[00130000]        <1> 	mov al, [IFON]
  2496 00001C71 FEC0                <1> 	inc al
  2497 00001C73 A2[00130000]        <1> 	mov [IFON], al
  2498 00001C78 B400                <1> 	mov ah, 0
  2499 00001C7A BE[01130000]        <1> 	mov esi, IFTRUE
  2500 00001C7F 01C6                <1> 	add esi, eax
  2501 00001C81 B401                <1> 	mov ah, 1
  2502 00001C83 8826                <1> 	mov [esi], ah
  2503 00001C85 E9B3F1FFFF          <1> 	jmp nwcmd
  2504 00001C8A B800000000          <1> falseif: mov eax, 0
  2505 00001C8F A0[00130000]        <1> 	mov al, [IFON]
  2506 00001C94 FEC0                <1> 	inc al
  2507 00001C96 A2[00130000]        <1> 	mov [IFON], al
  2508 00001C9B B400                <1> 	mov ah, 0
  2509 00001C9D BE[01130000]        <1> 	mov esi, IFTRUE
  2510 00001CA2 01C6                <1> 	add esi, eax
  2511 00001CA4 B400                <1> 	mov ah, 0
  2512 00001CA6 8826                <1> 	mov [esi], ah
  2513 00001CA8 E990F1FFFF          <1> 	jmp nwcmd
  2514 00001CAD 89F7                <1> ifvar1: mov edi, esi
  2515 00001CAF 81EF[701A0000]      <1> 	sub edi, buftxt
  2516 00001CB5 47                  <1> 	inc edi
  2517 00001CB6 BB[6F150000]        <1> 	mov ebx, variables
  2518 00001CBB E8AFF8FFFF          <1> 	call nxtvrech
  2519 00001CC0 BB[701A0000]        <1> 	mov ebx, buftxt
  2520 00001CC5 81C303000000        <1> 	add ebx, 3
  2521 00001CCB E97BFFFFFF          <1> 	jmp ifvar2
  2522 00001CD0 8935[F01C0000]      <1> ifvar3: mov [esiif], esi
  2523 00001CD6 BF04000000          <1> 	mov edi, 4
  2524 00001CDB BB[6F150000]        <1> 	mov ebx, variables
  2525 00001CE0 E88AF8FFFF          <1> 	call nxtvrech
  2526 00001CE5 8B35[F01C0000]      <1> 	mov esi, [esiif]
  2527 00001CEB E965FFFFFF          <1> 	jmp ifvar4
  2528                              <1> 
  2529 00001CF0 00000000            <1> esiif dd 0
  2530                              <1> 	
  2531 00001CF4 0504656C736500      <1> 	db 5,4,"else",0
  2532 00001CFB B800000000          <1> else:	mov eax, 0
  2533 00001D00 A0[00130000]        <1> 	mov al, [IFON]
  2534 00001D05 BE[01130000]        <1> 	mov esi, IFTRUE
  2535 00001D0A 01C6                <1> 	add esi, eax
  2536 00001D0C 8A06                <1> 	mov al, [esi]
  2537 00001D0E 3C00                <1> 	cmp al, 0		
  2538 00001D10 7409                <1> 	je else1
  2539 00001D12 3C01                <1> 	cmp al, 1
  2540 00001D14 740E                <1> 	je else2
  2541 00001D16 E922F1FFFF          <1> 	jmp nwcmd
  2542 00001D1B B001                <1> else1:  mov al, 1
  2543 00001D1D 8806                <1> 	mov [esi], al
  2544 00001D1F E919F1FFFF          <1> 	jmp nwcmd
  2545 00001D24 B000                <1> else2:	mov al, 0
  2546 00001D26 8806                <1> 	mov [esi], al
  2547 00001D28 E910F1FFFF          <1> 	jmp nwcmd
  2548                              <1> 
  2549 00001D2D 05046C6F6F7000      <1> 	db 5,4,"loop",0
  2550 00001D34 3805[6A130000]      <1> 	cmp [LOOPON], al
  2551 00001D3A 0F8405000000        <1> 	je near filoop
  2552 00001D40 E9F8F0FFFF          <1> 	jmp nwcmd
  2553 00001D45 8B35[6B130000]      <1> filoop: mov esi, [LOOPPOS]
  2554 00001D4B 8935[65130000]      <1> 	mov [BATCHPOS], esi
  2555 00001D51 E9E7F0FFFF          <1> 	jmp nwcmd
  2556                              <1> 	
  2557                              <1> 
  2558 00001D56 0504666900          <1> 	db 5,4,"fi",0
  2559 00001D5B B000                <1> 	mov al, 0
  2560 00001D5D 3805[69130000]      <1> 	cmp [BATCHISON], al
  2561 00001D63 0F8435FEFFFF        <1> 	je near notbatch
  2562 00001D69 B001                <1> fi:	mov al, 1
  2563 00001D6B 2805[00130000]      <1> 	sub [IFON],al
  2564 00001D71 E9C7F0FFFF          <1> 	jmp nwcmd
  2565                              <1> 
  2566 00001D76 050473746F7000      <1> 	db 5,4,"stop",0
  2567 00001D7D B000                <1> stop:	mov al, 0
  2568 00001D7F A2[69130000]        <1> 	mov [BATCHISON], al
  2569 00001D84 A2[00130000]        <1> 	mov [IFON], al
  2570 00001D89 A2[01130000]        <1> 	mov [IFTRUE], al
  2571 00001D8E A2[6A130000]        <1> 	mov [LOOPON], al
  2572 00001D93 E9A5F0FFFF          <1> 	jmp nwcmd
  2573                                      %include 'source/programs.asm'
  2574                              <1> 
  2575                              <1> ;db 5,4,"internet",0
  2576                              <1> 	internettest: 			;;initialize network card, lets hope this is right
  2577                              <1> 							;;^^used to^^, now tests int 30h functions		
  2578 00001D98 B403                <1> 		mov ah, 3
  2579 00001D9A CD30                <1> 		int 30h
  2580 00001D9C B401                <1> 		mov ah, 1
  2581                              <1> ;		mov esi, datmsg
  2582 00001D9E 66BB0700            <1> 		mov bx, 7
  2583 00001DA2 B000                <1> 		mov al, 0
  2584 00001DA4 CD30                <1> 		int 30h
  2585                              <1> ;	    jmp packettest
  2586 00001DA6 E992F0FFFF          <1> 		jmp nwcmd
  2587                              <1> ;datmsg: db "Internet has not been implemented yet.",10,13,0
  2588                              <1> 		
  2589 00001DAB 050470636900        <1> db 5,4,"pci",0
  2590                              <1> 	pcishow:
  2591 00001DB1 E8A61F0000          <1> 	call pcidump
  2592 00001DB6 E982F0FFFF          <1> 	jmp nwcmd
  2593                              <1> ;db 5,4,"runbat",0
  2594                              <1> ;	runbatch2:
  2595                              <1> ;		mov esi, line
  2596                              <1> ;		call print
  2597                              <1> ;		mov edi, buftxt
  2598                              <1> ;		add edi, 7
  2599                              <1> ;		mov esi, 0x100000
  2600                              <1> ;		call loadfile
  2601                              <1> 
  2602                              <1> 
  2603 00001DBB 0504626174636800    <1> db 5,4,"batch",0
  2604                              <1> 	batchst: 
  2605 00001DC3 BF[701A0000]        <1> 		mov edi, buftxt
  2606 00001DC8 81C706000000        <1> 		add edi, 6
  2607 00001DCE 803F00              <1> 		cmp byte [edi], 0
  2608 00001DD1 0F8473000000        <1> 		je near nonamefound
  2609 00001DD7 BE00001000          <1> 		mov esi, 0x100000
  2610 00001DDC E835210000          <1> 		call loadfile
  2611 00001DE1 89D0                <1> 		mov eax, edx
  2612 00001DE3 3D94010000          <1> 		cmp eax, 404
  2613 00001DE8 746F                <1> 		je goodbatchname
  2614 00001DEA BE[F91D0000]        <1> 		mov esi, badbatchname
  2615 00001DEF E871EDFFFF          <1> 		call print
  2616 00001DF4 E944F0FFFF          <1> 		jmp nwcmd
  2617 00001DF9 546869732066696C65- <1> 		badbatchname db "This file already exists!",10,13,0
  2618 00001E02 20616C726561647920- <1>
  2619 00001E0B 657869737473210A0D- <1>
  2620 00001E14 00                  <1>
  2621 00001E15 596F75206861766520- <1> 		namenotfoundbatch db "You have to type a name after the command.",10,13,0
  2622 00001E1E 746F20747970652061- <1>
  2623 00001E27 206E616D6520616674- <1>
  2624 00001E30 65722074686520636F- <1>
  2625 00001E39 6D6D616E642E0A0D00  <1>
  2626 00001E42 00000000            <1> 		esicache3 dd 0
  2627 00001E46 00000000            <1> 		esicache2 dd 0
  2628                              <1> 	nonamefound:
  2629 00001E4A BE[151E0000]        <1> 		mov esi, namenotfoundbatch
  2630 00001E4F E811EDFFFF          <1> 		call print
  2631 00001E54 E9E4EFFFFF          <1> 		jmp nwcmd
  2632                              <1> 	goodbatchname:
  2633 00001E59 BE00001000          <1> 		mov esi, 0x100000
  2634                              <1> 	batchcreate:
  2635 00001E5E 8935[421E0000]      <1> 		mov [esicache3], esi
  2636 00001E64 B00D                <1> 		mov al, 13
  2637 00001E66 B307                <1> 		mov bl, 7
  2638 00001E68 B404                <1> 		mov ah, 4
  2639 00001E6A CD30                <1> 		int 30h
  2640 00001E6C 8935[461E0000]      <1> 		mov [esicache2], esi
  2641 00001E72 8A0E                <1> 		mov cl, [esi]
  2642 00001E74 8B35[421E0000]      <1> 		mov esi, [esicache3]
  2643 00001E7A BB[D11E0000]        <1> 		mov ebx, exitword
  2644 00001E7F E8DFF0FFFF          <1> 		call cndtest
  2645 00001E84 3C01                <1> 		cmp al, 1
  2646 00001E86 7423                <1> 		je endbatchcreate
  2647 00001E88 3C02                <1> 		cmp al, 2
  2648 00001E8A 741F                <1> 		je endbatchcreate
  2649 00001E8C BE[81410000]        <1> 		mov esi, line
  2650 00001E91 E8CFECFFFF          <1> 		call print
  2651 00001E96 8B35[461E0000]      <1> 		mov esi, [esicache2]
  2652 00001E9C B00D                <1> 		mov al, 13
  2653 00001E9E B40A                <1> 		mov ah, 10
  2654 00001EA0 668906              <1> 		mov [esi], ax
  2655 00001EA3 81C602000000        <1> 		add esi, 2
  2656 00001EA9 EBB3                <1> 		jmp batchcreate
  2657                              <1> 	endbatchcreate:
  2658 00001EAB 8B35[421E0000]      <1> 		mov esi, [esicache3]
  2659 00001EB1 B800000000          <1> 		mov eax, 0
  2660 00001EB6 8806                <1> 		mov [esi], al
  2661 00001EB8 BE[81410000]        <1> 		mov esi, line
  2662 00001EBD E8A3ECFFFF          <1> 		call print
  2663 00001EC2 BE00001000          <1> 		mov esi, 0x100000
  2664 00001EC7 E899ECFFFF          <1> 		call print
  2665 00001ECC E96CEFFFFF          <1> 		jmp nwcmd
  2666                              <1> 	
  2667 00001ED1 5C7800              <1> 	exitword db "\x",0
  2668 00001ED4 54797065205C782074- <1> 	wordmsg db "Type \x to exit.",10,13,0
  2669 00001EDD 6F20657869742E0A0D- <1>
  2670 00001EE6 00                  <1>
  2671                              <1> 		
  2672 00001EE7 050473686F7700      <1> db 5,4,"show",0
  2673 00001EEE BF[701A0000]        <1> 		mov edi, buftxt
  2674 00001EF3 81C705000000        <1> 		add edi, 5
  2675 00001EF9 BE00001000          <1> 		mov esi, 0x100000
  2676 00001EFE E813200000          <1> 		call loadfile
  2677 00001F03 BE00001000          <1> 		mov esi, 0x100000
  2678 00001F08 66813E424D          <1> 		cmp word [esi], "BM"
  2679 00001F0D 7414                <1> 		je bmpfound
  2680 00001F0F E851ECFFFF          <1> 		call print
  2681 00001F14 BE[81410000]        <1> 		mov esi, line
  2682 00001F19 E847ECFFFF          <1> 		call print
  2683 00001F1E E91AEFFFFF          <1> 		jmp nwcmd
  2684                              <1> bmpfound:
  2685 00001F23 803D[23290000]00    <1> 		cmp byte [guion], 0
  2686 00001F2A 0F844D000000        <1> 		je near noguibmp
  2687 00001F30 BE00001000          <1> 		mov esi, 0x100000
  2688 00001F35 B900000000          <1> 		mov ecx, 0
  2689 00001F3A BA00000000          <1> 		mov edx, 0
  2690 00001F3F B800000000          <1> 		mov eax, 0
  2691 00001F44 BB00000000          <1> 		mov ebx, 0
  2692 00001F49 E8A4190000          <1> 		call showbmp
  2693 00001F4E B000                <1> 		mov al, 0
  2694 00001F50 B405                <1> 		mov ah, 5
  2695 00001F52 CD30                <1> 		int 30h
  2696 00001F54 E831080000          <1> 		call guiclear
  2697 00001F59 E843100000          <1> 		call reloadallgraphics
  2698 00001F5E BE[701A0000]        <1> 		mov esi, buftxt
  2699 00001F63 81C605000000        <1> 		add esi, 5
  2700 00001F69 E8F7EBFFFF          <1> 		call print
  2701 00001F6E BE[00200000]        <1> 		mov esi, loadedbmpmsg
  2702 00001F73 E8EDEBFFFF          <1> 		call print
  2703 00001F78 E9C0EEFFFF          <1> 		jmp nwcmd
  2704                              <1> noguibmp:
  2705 00001F7D BE[8C1F0000]        <1> 		mov esi, warnguibmp
  2706 00001F82 E8DEEBFFFF          <1> 		call print
  2707 00001F87 E9B1EEFFFF          <1> 		jmp nwcmd
  2708 00001F8C 546869732063616E20- <1> warnguibmp db "This can not be done without the gui.",10,13,0
  2709 00001F95 6E6F7420626520646F- <1>
  2710 00001F9E 6E6520776974686F75- <1>
  2711 00001FA7 742074686520677569- <1>
  2712 00001FB0 2E0A0D00            <1>
  2713                              <1> 
  2714                              <1> 		
  2715                              <1> filenotfound:
  2716 00001FB4 BE[DD1F0000]        <1> 		mov esi, filenf
  2717 00001FB9 E8A7EBFFFF          <1> 		call print
  2718 00001FBE BE[701A0000]        <1> 		mov esi, buftxt
  2719 00001FC3 81C608000000        <1> 		add esi, 8
  2720 00001FC9 E897EBFFFF          <1> 		call print
  2721 00001FCE BE[E81F0000]        <1> 		mov esi, filenf2
  2722 00001FD3 E88DEBFFFF          <1> 		call print
  2723 00001FD8 E960EEFFFF          <1> 		jmp nwcmd
  2724 00001FDD 5468652066696C6520- <1> filenf db "The file ",34,0
  2725 00001FE6 2200                <1>
  2726 00001FE8 2220636F756C64206E- <1> filenf2 db 34," could not be found.",13,10,0
  2727 00001FF1 6F7420626520666F75- <1>
  2728 00001FFA 6E642E0D0A00        <1>
  2729                              <1> 		
  2730 00002000 206C6F616465642E0D- <1> loadedbmpmsg db " loaded.",13,10,0
  2731 00002009 0A00                <1>
  2732                              <1> 
  2733 0000200B 050464756D7000      <1> 	db 5,4,"dump",0
  2734 00002012 BE[701A0000]        <1> 	mov esi, buftxt
  2735 00002017 81C605000000        <1> 	add esi, 5
  2736 0000201D B900000000          <1> 	mov ecx, 0
  2737 00002022 E821F3FFFF          <1> 	call cnvrttxt
  2738 00002027 89CF                <1> 	mov edi, ecx
  2739 00002029 89FE                <1> 	mov esi, edi
  2740 0000202B 81C680030000        <1> 	add esi, 896
  2741 00002031 C605[17120000]00    <1> 	mov byte [firsthexshown],0
  2742                              <1> dumphexloop:
  2743 00002038 8B0F                <1> 	mov ecx, [edi]
  2744 0000203A E8D9F1FFFF          <1> 	call showhex
  2745 0000203F 81C704000000        <1> 	add edi, 4
  2746 00002045 39F7                <1> 	cmp edi, esi
  2747 00002047 72EF                <1> 	jb dumphexloop
  2748 00002049 E9EFEDFFFF          <1> 	jmp nwcmd
  2749                              <1> 
  2750 0000204E 050474696D6500      <1> db 5,4,"time",0
  2751 00002055 E823000000          <1> 	call time
  2752 0000205A BE[67220000]        <1> 	mov esi, timeshow
  2753 0000205F E801EBFFFF          <1> 	call print
  2754 00002064 BE[81410000]        <1> 	mov esi, line
  2755 00002069 E8F7EAFFFF          <1> 	call print
  2756 0000206E BE[71220000]        <1> 	mov esi, dateshow
  2757 00002073 E8EDEAFFFF          <1> 	call print
  2758 00002078 E9C0EDFFFF          <1> 	jmp nwcmd
  2759                              <1> 	time:
  2760 0000207D E86D010000          <1> 	call tstackput1
  2761 00002082 B00A                <1> 	mov al,10			;Get RTC register A
  2762 00002084 E897010000          <1> 	call tget1
  2763 00002089 A880                <1> 	test al,0x80			;Is update in progress?
  2764 0000208B 75F0                <1> 	jne time				; yes, wait
  2765                              <1> 
  2766 0000208D B000                <1> 	mov al,0			;Get seconds (00 to 59)
  2767 0000208F E88C010000          <1> 	call tget1
  2768 00002094 A2[5E220000]        <1> 	mov [RTCtimeSecond],al
  2769                              <1> 
  2770 00002099 B002                <1> 	mov al,0x02			;Get minutes (00 to 59)
  2771 0000209B E880010000          <1> 	call tget1
  2772 000020A0 A2[5F220000]        <1> 	mov [RTCtimeMinute],al
  2773                              <1> 
  2774 000020A5 B004                <1> 	mov al,0x04			;Get hours (see notes)
  2775 000020A7 E874010000          <1> 	call tget1
  2776 000020AC A2[60220000]        <1> 	mov [RTCtimeHour],al
  2777                              <1> 
  2778 000020B1 B007                <1> 	mov al,0x07			;Get day of month (01 to 31)
  2779 000020B3 E868010000          <1> 	call tget1
  2780                              <1> ;	mov ah, 0			;;fix day
  2781                              <1> ;	mov ah, al
  2782                              <1> ;	shr ah, 4
  2783                              <1> ;	shl al, 4
  2784                              <1> ;	shr al, 4
  2785                              <1> ;	cmp al, 0
  2786                              <1> ;	jne nodecahday
  2787                              <1> ;	mov al, 10
  2788                              <1> ;	dec ah
  2789                              <1> ;nodecahday:
  2790                              <1> ;	dec al
  2791                              <1> ;	shl ah, 4
  2792                              <1> ;	or al, ah
  2793 000020B8 A2[61220000]        <1> 	mov [RTCtimeDay],al
  2794                              <1> 
  2795 000020BD B008                <1> 	mov al,0x08			;Get month (01 to 12)
  2796 000020BF E85C010000          <1> 	call tget1
  2797 000020C4 A2[62220000]        <1> 	mov [RTCtimeMonth],al
  2798                              <1> 
  2799 000020C9 B009                <1> 	mov al,0x09			;Get year (00 to 99)
  2800 000020CB E850010000          <1> 	call tget1
  2801 000020D0 A2[63220000]        <1> 	mov [RTCtimeYear],al
  2802                              <1> 	
  2803 000020D5 BE[67220000]        <1> 	mov esi, timeshow
  2804 000020DA 8A2D[60220000]      <1> 	mov ch, [RTCtimeHour]
  2805 000020E0 E846010000          <1> 	call tput1
  2806 000020E5 8A2D[5F220000]      <1> 	mov ch, [RTCtimeMinute]
  2807 000020EB E83B010000          <1> 	call tput1
  2808 000020F0 8A2D[5E220000]      <1> 	mov ch, [RTCtimeSecond]
  2809 000020F6 E830010000          <1> 	call tput1
  2810 000020FB BE[71220000]        <1> 	mov esi, dateshow
  2811 00002100 8A2D[62220000]      <1> 	mov ch, [RTCtimeMonth]
  2812 00002106 E820010000          <1> 	call tput1
  2813 0000210B 8A2D[61220000]      <1> 	mov ch, [RTCtimeDay]
  2814 00002111 E815010000          <1> 	call tput1
  2815 00002116 B520                <1> 	mov ch, 0x20
  2816 00002118 E80E010000          <1> 	call tput1
  2817 0000211D 4E                  <1> 	dec esi
  2818 0000211E 8A2D[63220000]      <1> 	mov ch, [RTCtimeYear]
  2819 00002124 E802010000          <1> 	call tput1
  2820 00002129 E8DB000000          <1> 	call tstackget1
  2821 0000212E BE[67220000]        <1> 	mov esi, timeshow
  2822 00002133 66BB0700            <1> 	mov bx, 7
  2823 00002137 B401                <1> 	mov ah, 1
  2824 00002139 B000                <1> 	mov al, 0
  2825 0000213B CD30                <1> 	int 30h
  2826                              <1> ;;get day of week
  2827                              <1> ;;add these:
  2828                              <1> ;;century value
  2829                              <1> ;;last 2 digits of year
  2830                              <1> ;;last 2 digits of year right shifted twice
  2831                              <1> ;;month table value
  2832                              <1> ;;day of the month
  2833                              <1> ;;divide these by 7
  2834                              <1> ;;the remainder is the day
  2835 0000213D B800000000          <1> 	mov eax, 0
  2836                              <1> ;;first convert the values from BCD to hex
  2837 00002142 A0[61220000]        <1> 	mov al, [RTCtimeDay]
  2838 00002147 E88A000000          <1> 	call converttohex
  2839 0000214C 8825[64220000]      <1> 	mov [dayhex], ah
  2840 00002152 A0[62220000]        <1> 	mov al, [RTCtimeMonth]
  2841 00002157 E87A000000          <1> 	call converttohex
  2842 0000215C 8825[65220000]      <1> 	mov [monthhex], ah
  2843 00002162 A0[63220000]        <1> 	mov al, [RTCtimeYear]
  2844 00002167 E86A000000          <1> 	call converttohex
  2845 0000216C 8825[66220000]      <1> 	mov [yearhex], ah
  2846 00002172 B800000000          <1> 	mov eax, 0
  2847 00002177 A0[66220000]        <1> 	mov al, [yearhex]
  2848 0000217C C0E802              <1> 	shr al, 2
  2849 0000217F 0205[66220000]      <1> 	add al, [yearhex]
  2850 00002185 0506000000          <1> 	add eax, 6
  2851 0000218A BB00000000          <1> 	mov ebx, 0
  2852 0000218F 8A1D[65220000]      <1> 	mov bl, [monthhex]
  2853 00002195 FECB                <1> 	dec bl
  2854 00002197 81C3[87220000]      <1> 	add ebx, month
  2855 0000219D B900000000          <1> 	mov ecx, 0
  2856 000021A2 8A0B                <1> 	mov cl, [ebx]
  2857 000021A4 01C8                <1> 	add eax, ecx
  2858 000021A6 8A0D[64220000]      <1> 	mov cl, [dayhex]
  2859 000021AC 01C8                <1> 	add eax, ecx
  2860 000021AE 66BB0700            <1> 	mov bx, 7
  2861 000021B2 BA00000000          <1> 	mov edx, 0
  2862 000021B7 66F7F3              <1> 	div bx
  2863 000021BA C1E202              <1> 	shl edx, 2
  2864 000021BD 81C2[93220000]      <1> 	add edx, day
  2865 000021C3 8B32                <1> 	mov esi, [edx]
  2866 000021C5 66BB0700            <1> 	mov bx, 7
  2867 000021C9 B401                <1> 	mov ah, 1
  2868 000021CB B000                <1> 	mov al, 0
  2869 000021CD CD30                <1> 	int 30h
  2870 000021CF 66B80000            <1> 	mov ax, 0
  2871 000021D3 CD30                <1> 	int 30h
  2872 000021D5 F4                  <1> 	hlt
  2873                              <1> 	
  2874                              <1> converttohex:
  2875 000021D6 88C4                <1> 	mov ah, al
  2876 000021D8 C0E804              <1> 	shr al, 4
  2877 000021DB C0E404              <1> 	shl ah, 4
  2878 000021DE C0EC04              <1> 	shr ah, 4
  2879 000021E1 3C00                <1> 	cmp al, 0
  2880 000021E3 7409                <1> 	je noconverttohex
  2881                              <1> converttohexlp:
  2882 000021E5 80C40A              <1> 	add ah, 10
  2883 000021E8 FEC8                <1> 	dec al
  2884 000021EA 3C00                <1> 	cmp al, 0
  2885 000021EC 75F7                <1> 	jne converttohexlp
  2886                              <1> noconverttohex:
  2887 000021EE C3                  <1> 	ret
  2888                              <1> 	
  2889                              <1> tstackput1:
  2890 000021EF 8935[5A220000]      <1> 	mov [tstack + 20], esi
  2891 000021F5 BE[46220000]        <1> 	mov esi, tstack
  2892 000021FA 8906                <1> 	mov [esi], eax
  2893 000021FC 895E04              <1> 	mov [esi + 4], ebx
  2894 000021FF 894E08              <1> 	mov [esi + 8], ecx
  2895 00002202 89560C              <1> 	mov [esi + 12], edx
  2896 00002205 897E10              <1> 	mov [esi + 16], edi
  2897 00002208 C3                  <1> 	ret
  2898                              <1> 	
  2899                              <1> tstackget1:
  2900 00002209 BE[46220000]        <1> 	mov esi, tstack
  2901 0000220E 8B06                <1> 	mov eax, [esi]
  2902 00002210 8B5E04              <1> 	mov ebx, [esi + 4]
  2903 00002213 8B4E08              <1> 	mov ecx, [esi + 8]
  2904 00002216 8B560C              <1> 	mov edx, [esi + 12]
  2905 00002219 8B7E10              <1> 	mov edi, [esi + 16]
  2906 0000221C 8B7614              <1> 	mov esi, [esi + 20]
  2907 0000221F C3                  <1> 	ret
  2908                              <1> 	
  2909                              <1> tget1:
  2910 00002220 66BA7000            <1> 	mov dx, 0x70
  2911 00002224 EE                  <1> 	out dx, al
  2912 00002225 6642                <1> 	inc dx
  2913 00002227 EC                  <1> 	in al, dx
  2914 00002228 664A                <1> 	dec dx
  2915 0000222A C3                  <1> 	ret
  2916                              <1> 	
  2917                              <1> tput1:
  2918 0000222B 66C1E904            <1> 	shr cx, 4
  2919 0000222F B030                <1> 	mov al, 48
  2920 00002231 00E8                <1> 	add al, ch
  2921 00002233 8806                <1> 	mov [esi], al
  2922 00002235 46                  <1> 	inc esi
  2923 00002236 B030                <1> 	mov al, 48
  2924 00002238 C0E904              <1> 	shr cl, 4
  2925 0000223B 00C8                <1> 	add al, cl
  2926 0000223D 8806                <1> 	mov [esi], al
  2927 0000223F 81C602000000        <1> 	add esi, 2
  2928 00002245 C3                  <1> 	ret
  2929                              <1> 		
  2930 00002246 000000000000000000- <1> 	tstack dd 0,0,0,0,0,0
  2931 0000224F 000000000000000000- <1>
  2932 00002258 000000000000        <1>
  2933 0000225E 00                  <1> 	RTCtimeSecond db 0
  2934 0000225F 00                  <1> 	RTCtimeMinute db 0
  2935 00002260 00                  <1> 	RTCtimeHour db 0
  2936 00002261 00                  <1> 	RTCtimeDay db 0
  2937 00002262 00                  <1> 	RTCtimeMonth db 0
  2938 00002263 00                  <1> 	RTCtimeYear db 0
  2939 00002264 00                  <1> 	dayhex db 0
  2940 00002265 00                  <1> 	monthhex db 0
  2941 00002266 00                  <1> 	yearhex db 0
  2942 00002267 30303A30303A30300D- <1> 	timeshow db "00:00:00",13,10
  2943 00002270 0A                  <1>
  2944 00002271 30302D30302D303030- <1> 	dateshow db "00-00-0000",13,10,0
  2945 0000227A 300D0A00            <1>
  2946                              <1> 	oldcentury:	;;from 1700 to 1900
  2947 0000227E 040200              <1> 	db 4,2,0
  2948                              <1> 	century:	;;from 2000 to 2500
  2949 00002281 060402000604        <1> 	db 6,4,2,0,6,4
  2950                              <1> 	month:
  2951 00002287 000303060104060205- <1> 	db 0,3,3,6,1,4,6,2,5,0,3,5
  2952 00002290 000305              <1>
  2953                              <1> 	day:
  2954 00002293 [AF220000]          <1> 	dd sunday
  2955 00002297 [B8220000]          <1> 	dd monday
  2956 0000229B [C1220000]          <1> 	dd tuesday
  2957 0000229F [CB220000]          <1> 	dd wednesday
  2958 000022A3 [D7220000]          <1> 	dd thursday
  2959 000022A7 [E2220000]          <1> 	dd friday
  2960 000022AB [EB220000]          <1> 	dd saturday
  2961                              <1> sunday:
  2962 000022AF 53756E6461790D0A00  <1> 	db "Sunday",13,10,0
  2963                              <1> monday:
  2964 000022B8 4D6F6E6461790D0A00  <1> 	db "Monday",13,10,0
  2965                              <1> tuesday:
  2966 000022C1 547565736461790D0A- <1> 	db "Tuesday",13,10,0
  2967 000022CA 00                  <1>
  2968                              <1> wednesday:
  2969 000022CB 5765646E6573646179- <1> 	db "Wednesday",13,10,0
  2970 000022D4 0D0A00              <1>
  2971                              <1> thursday:
  2972 000022D7 54687572736461790D- <1> 	db "Thursday",13,10,0
  2973 000022E0 0A00                <1>
  2974                              <1> friday:
  2975 000022E2 4672696461790D0A00  <1> 	db "Friday",13,10,0
  2976                              <1> saturday:
  2977 000022EB 53617475726461790D- <1> 	db "Saturday",13,10,0
  2978 000022F4 0A00                <1>
  2979                              <1> 
  2980 000022F6 0504637075696400    <1> db 5,4,"cpuid",0
  2981 000022FE B800000000          <1> 	mov eax, 0
  2982 00002303 0FA2                <1> 	cpuid
  2983 00002305 891D[5A230000]      <1> 	mov [cpuidbuf], ebx
  2984 0000230B 8915[5E230000]      <1> 	mov [cpuidbuf + 4], edx
  2985 00002311 890D[62230000]      <1> 	mov [cpuidbuf + 8], ecx
  2986 00002317 BE[5A230000]        <1> 	mov esi, cpuidbuf
  2987 0000231C E844E8FFFF          <1> 	call print
  2988 00002321 BE[81410000]        <1> 	mov esi, line
  2989 00002326 E83AE8FFFF          <1> 	call print
  2990 0000232B B801000000          <1> 	mov eax, 1
  2991 00002330 0FA2                <1> 	cpuid
  2992 00002332 89C1                <1> 	mov ecx, eax
  2993 00002334 C605[17120000]02    <1> 	mov byte [firsthexshown], 2
  2994 0000233B E8D8EEFFFF          <1> 	call showhex
  2995 00002340 B808000080          <1> 	mov eax, 0x80000008
  2996 00002345 0FA2                <1> 	cpuid
  2997 00002347 89C1                <1> 	mov ecx, eax
  2998 00002349 C605[17120000]02    <1> 	mov byte [firsthexshown], 2
  2999 00002350 E8C3EEFFFF          <1> 	call showhex
  3000 00002355 E9E3EAFFFF          <1> 	jmp nwcmd
  3001                              <1> 	
  3002 0000235A 00<rept>            <1> cpuidbuf times 13 db 0
  3003                              <1> cpuidvendorend:
  3004                              <1> progend:		;programs end here	
  3005                              <1> batchprogend:
  3006                                      %include 'source/input.asm'
  3007                              <1> PS2SET:
  3008 00002367 B0A8                <1>   mov  al, 0xa8		; enable mouse port
  3009 00002369 E664                <1>   out  0x64, al		; write to keyboardcontroller
  3010 0000236B E801000000          <1>   call CHKPRT		; check if command is progressed (demand!)
  3011 00002370 C3                  <1> ret
  3012                              <1> 
  3013                              <1> ;***********************************************************************
  3014                              <1> ;Check if command is accepted. (not got stuck in inputbuffer)
  3015                              <1> ;***********************************************************************
  3016                              <1> CHKPRT:
  3017 00002371 66B96400            <1>   mov  cx, 100
  3018                              <1>  .again:
  3019 00002375 E464                <1>   in   al, 0x64		; read from keyboardcontroller
  3020 00002377 A802                <1>   test al, 2		; Check if input buffer is empty
  3021 00002379 7402                <1>   je .go
  3022 0000237B E2F8                <1>   loop .again
  3023                              <1>  .go:
  3024 0000237D C3                  <1> ret
  3025                              <1> 
  3026                              <1> ;***********************************************************************
  3027                              <1> ;Write to mouse
  3028                              <1> ;***********************************************************************
  3029                              <1> WMOUS:
  3030 0000237E B0D4                <1>   mov  al, 0xd4		; write to mouse device instead of to keyboard
  3031 00002380 E664                <1>   out  0x64, al		; write to keyboardcontroller
  3032 00002382 E8EAFFFFFF          <1>   call CHKPRT		; check if command is progressed (demand!)
  3033 00002387 C3                  <1> ret
  3034                              <1> 
  3035                              <1> 
  3036                              <1> 
  3037                              <1> ;***********************************************************************
  3038                              <1> ;mouse output buffer full
  3039                              <1> ;***********************************************************************
  3040                              <1> MBUFFUL:
  3041 00002388 66B96400            <1>   mov cx, 100
  3042                              <1>  .mn:
  3043 0000238C E464                <1>   in   al, 0x64		; read from keyboardcontroller
  3044 0000238E A820                <1>   test al, 0x20		; check if mouse output buffer is full
  3045 00002390 7402                <1>   jz  .mnn
  3046 00002392 E2F8                <1>   loop .mn
  3047                              <1>  .mnn:
  3048 00002394 C3                  <1> ret
  3049                              <1> 
  3050                              <1> 
  3051                              <1> ;***********************************************************************
  3052                              <1> ;Write activate Mouse HardWare
  3053                              <1> ;***********************************************************************
  3054                              <1> ACTMOUS:
  3055 00002395 E8E4FFFFFF          <1>   call WMOUS
  3056 0000239A B0F4                <1>   mov  al, 0xf4 	; Command to activate mouse itselve (Stream mode)
  3057 0000239C E660                <1>   out  0x60, al		; write ps/2 controller output port (activate mouse)
  3058 0000239E E8CEFFFFFF          <1>   call CHKPRT		; check if command is progressed (demand!)
  3059 000023A3 E801000000          <1>   call CHKMOUS		; check if a byte is available
  3060 000023A8 C3                  <1> ret
  3061                              <1> 
  3062                              <1> ;***********************************************************************
  3063                              <1> ;Check if mouse has info for us
  3064                              <1> ;***********************************************************************
  3065                              <1> CHKMOUS:
  3066 000023A9 B300                <1>   mov  bl, 0
  3067 000023AB 66B96400            <1>   mov cx, 100
  3068                              <1>  .vrd:
  3069 000023AF E464                <1>   in   al, 0x64		; read from keyboardcontroller
  3070 000023B1 A801                <1>   test al, 1		; check if controller buffer (60h) has data
  3071 000023B3 7504                <1>   jnz .yy
  3072 000023B5 E2F8                <1>   loop .vrd
  3073 000023B7 B301                <1>   mov  bl, 1
  3074                              <1>  .yy:
  3075 000023B9 C3                  <1> ret
  3076                              <1> 
  3077                              <1> ;***********************************************************************
  3078                              <1> ;Get Mouse Byte
  3079                              <1> ;***********************************************************************
  3080                              <1> GETB:
  3081                              <1>  .cagain:
  3082 000023BA E8EAFFFFFF          <1>   call CHKMOUS		; check if a byte is available
  3083 000023BF 08DB                <1>   or bl, bl
  3084 000023C1 75F7                <1>   jnz .cagain
  3085 000023C3 B0AD                <1>   mov  al, 0xad		; Disable Keyboard
  3086 000023C5 E664                <1>   out  0x64, al		; write to keyboardcontroller
  3087 000023C7 E8A5FFFFFF          <1>   call CHKPRT		; check if command is progressed (demand!)
  3088 000023CC 6631C0              <1>   xor  ax, ax
  3089 000023CF E460                <1>   in   al, 0x60		; read ps/2 controller output port (mousebyte)
  3090 000023D1 88C2                <1>   mov  dl, al
  3091 000023D3 B0AE                <1>   mov  al, 0xae		; Enable Keyboard
  3092 000023D5 E664                <1>   out  0x64, al		; write to keyboardcontroller
  3093 000023D7 E895FFFFFF          <1>   call CHKPRT		; check if command is progressed (demand!)
  3094 000023DC 88D0                <1>   mov  al, dl
  3095 000023DE C3                  <1> ret
  3096                              <1> 
  3097 000023DF 00                  <1> LBUTTON db 0x00	;	Left   button status 1=PRESSED 0=RELEASED
  3098 000023E0 00                  <1> RBUTTON db 0x00	;	Right  button status 1=PRESSED 0=RELEASED
  3099 000023E1 00                  <1> MBUTTON db 0x00	;	Middle button status 1=PRESSED 0=RELEASED
  3100 000023E2 00                  <1> XCOORD  db 0x00	;	the moved distance  (horizontal)
  3101 000023E3 00                  <1> YCOORD  db 0x00	;	the moved distance  (vertical)
  3102                              <1> 
  3103                              <1> 
  3104                              <1> 	guistartin:
  3105 000023E4 B800000000          <1> 		mov eax, 0
  3106 000023E9 66A3[320B0000]      <1> 		mov [lastkey], ax
  3107 000023EF E464                <1> 		in al, 64h ; Status
  3108 000023F1 A801                <1> 		test al, 1 ; output buffer full?
  3109 000023F3 74EF                <1> 		jz guistartin
  3110 000023F5 A820                <1> 		test al, 20h ; PS2-Mouse?
  3111 000023F7 0F85E2000000        <1> 		jnz near maincall2
  3112 000023FD E460                <1> 		in al, 60h
  3113 000023FF 88C4                <1> 		mov ah, al
  3114 00002401 B000                <1> 		mov al, 0
  3115 00002403 8825[330B0000]      <1> 		mov [lastkey + 1], ah
  3116 00002409 88E0                <1> 		mov al, ah
  3117 0000240B BF[16270000]        <1> 		mov edi, scancode
  3118                              <1> 	guisearchscan: 
  3119 00002410 3C40                <1> 		cmp al, 40h
  3120 00002412 7315                <1> 		jae guiscanother
  3121 00002414 B400                <1> 		mov ah, 0
  3122 00002416 D0E0                <1> 		shl al, 1
  3123 00002418 01C7                <1> 		add edi, eax
  3124 0000241A D0E8                <1> 		shr al, 1
  3125 0000241C 8A27                <1> 		mov ah, [edi]
  3126 0000241E 80FC00              <1> 		cmp ah, 0
  3127 00002421 7406                <1> 		je guiscanother
  3128 00002423 E964000000          <1> 		jmp guiscanfound
  3129 00002428 00                  <1> guiupper db 0
  3130                              <1> guiscanother:
  3131 00002429 88C4                <1> 		mov ah, al
  3132 0000242B B000                <1> 		mov al, 0
  3133 0000242D 66A3[320B0000]      <1> 		mov [lastkey], ax
  3134                              <1> 		;cmp ah, 4Dh
  3135                              <1> 		;je near nextimage
  3136 00002433 80FC2A              <1> 		cmp ah, 2Ah
  3137 00002436 0F8437000000        <1> 		je near guishifton
  3138 0000243C 80FC36              <1> 		cmp ah, 36h
  3139 0000243F 0F842E000000        <1> 		je near guishifton
  3140 00002445 80FC1C              <1> 		cmp ah, 1Ch
  3141 00002448 0F843D000000        <1> 		je near guientdown
  3142 0000244E 80FCAA              <1> 		cmp ah, 0AAh
  3143 00002451 0F8428000000        <1> 		je near guishiftoff
  3144 00002457 80FCB6              <1> 		cmp ah, 0B6h
  3145 0000245A 0F841F000000        <1> 		je near guishiftoff
  3146 00002460 80FC3A              <1> 		cmp ah, 3Ah
  3147 00002463 0F8401000000        <1> 		je near guishift
  3148 00002469 C3                  <1> 		ret
  3149                              <1> 	guishift:
  3150 0000246A A0[28240000]        <1> 		mov al, [guiupper]
  3151 0000246F 3C01                <1> 		cmp al, 1
  3152 00002471 730C                <1> 		jae guishiftoff
  3153                              <1> 	guishifton:
  3154 00002473 C605[28240000]01    <1> 		mov byte [guiupper], 1
  3155 0000247A E965FFFFFF          <1> 		jmp guistartin
  3156                              <1> 	guishiftoff:
  3157 0000247F C605[28240000]00    <1> 		mov byte [guiupper], 0
  3158 00002486 E959FFFFFF          <1> 		jmp guistartin
  3159                              <1> 	guientdown:
  3160 0000248B C3                  <1> 		ret
  3161                              <1> 	guiscanfound:
  3162 0000248C 81C701000000        <1> 		add edi, 1
  3163 00002492 803D[28240000]01    <1> 		cmp byte [guiupper], 1
  3164 00002499 7306                <1> 		jae uppercasegui
  3165 0000249B 81EF01000000        <1> 		sub edi, 1
  3166                              <1> uppercasegui:
  3167 000024A1 8A07                <1> 		mov al,[edi]
  3168 000024A3 A2[320B0000]        <1> 		mov [lastkey], al
  3169 000024A8 C3                  <1> 		ret
  3170                              <1> 		
  3171                              <1> 		
  3172                              <1> 	cursorgui:
  3173 000024A9 803D[96390000]01    <1> 		cmp byte [mouseon], 1
  3174 000024B0 0F8429000000        <1> 		je near maincall2
  3175 000024B6 803D[23290000]00    <1> 		cmp byte [guion], 0
  3176 000024BD 0F84C8FFFFFF        <1> 		je near guientdown
  3177                              <1> 	initmouse:
  3178 000024C3 E828050000          <1> 		call switchmousepos2
  3179 000024C8 E89AFEFFFF          <1> 	  	call PS2SET
  3180 000024CD E8C3FEFFFF          <1> 		call ACTMOUS
  3181 000024D2 C605[96390000]01    <1> 		mov byte [mouseon],1
  3182 000024D9 E8DCFEFFFF          <1> 		call GETB 	;;Get the responce byte of the mouse (like: Hey i am active)
  3183                              <1> 				;;If the bytes are mixed up,
  3184                              <1> 				;;remove this line or add another of this line.
  3185                              <1> 		;call GETB
  3186 000024DE C3                  <1> 		ret
  3187                              <1> 	maincall2:
  3188 000024DF 803D[96390000]01    <1> 		  cmp byte [mouseon], 1
  3189 000024E6 75DB                <1> 		  jne initmouse
  3190 000024E8 E8CDFEFFFF          <1> 		  call GETB
  3191 000024ED 88C3                <1> 		  mov  bl, al
  3192 000024EF 80E301              <1> 		  and  bl, 1
  3193 000024F2 881D[DF230000]      <1> 		  mov  BYTE [LBUTTON], bl
  3194 000024F8 88C3                <1> 		  mov  bl, al
  3195 000024FA 80E302              <1> 		  and  bl, 2
  3196 000024FD D0EB                <1> 		  shr  bl, 1
  3197 000024FF 881D[E0230000]      <1> 		  mov  BYTE [RBUTTON], bl
  3198 00002505 88C3                <1> 		  mov  bl, al
  3199 00002507 80E304              <1> 		  and  bl, 4
  3200 0000250A C0EB02              <1> 		  shr  bl, 2
  3201 0000250D 881D[E1230000]      <1> 		  mov  BYTE [MBUTTON], bl
  3202 00002513 E8A2FEFFFF          <1> 		  call GETB
  3203 00002518 A2[E2230000]        <1> 		  mov  BYTE [XCOORD], al
  3204 0000251D E898FEFFFF          <1> 		  call GETB
  3205 00002522 A2[E3230000]        <1> 		  mov  BYTE [YCOORD], al
  3206                              <1> 
  3207                              <1> 	showpixelcursor:
  3208 00002527 668B15[74260000]    <1> 		mov dx, [mousecursorposition]
  3209 0000252E 668B0D[76260000]    <1> 		mov cx, [mousecursorposition + 2]
  3210 00002535 668915[70260000]    <1> 		mov [lastmouseposition], dx
  3211 0000253C 66890D[72260000]    <1> 		mov [lastmouseposition + 2], cx
  3212 00002543 A0[E2230000]        <1> 		mov al, [XCOORD]
  3213 00002548 3C80                <1> 		cmp al, 128
  3214 0000254A 730C                <1> 		jae subxcoord
  3215 0000254C 00C0                <1> 		add al, al
  3216 0000254E B400                <1> 		mov ah, 0
  3217 00002550 6601C2              <1> 		add dx, ax
  3218 00002553 E90B000000          <1> 		jmp subxcoorddn
  3219                              <1> 	subxcoord:
  3220 00002558 00C0                <1> 		add al, al
  3221 0000255A B300                <1> 		mov bl, 0
  3222 0000255C 28C3                <1> 		sub bl, al
  3223 0000255E B700                <1> 		mov bh, 0
  3224 00002560 6629DA              <1> 		sub dx, bx
  3225                              <1> 	subxcoorddn:
  3226 00002563 8A1D[E3230000]      <1> 		mov bl, [YCOORD]
  3227 00002569 B000                <1> 		mov al, 0
  3228 0000256B 28D8                <1> 		sub al, bl
  3229 0000256D 3C80                <1> 		cmp al, 128
  3230 0000256F 730A                <1> 		jae subycoord
  3231 00002571 B400                <1> 		mov ah, 0
  3232 00002573 6601C1              <1> 		add cx, ax
  3233 00002576 E909000000          <1> 		jmp subycoorddn
  3234                              <1> 	subycoord:
  3235 0000257B B300                <1> 		mov bl, 0
  3236 0000257D 28C3                <1> 		sub bl, al
  3237 0000257F B700                <1> 		mov bh, 0
  3238 00002581 6629D9              <1> 		sub cx, bx
  3239                              <1> 	subycoorddn:
  3240 00002584 6681FA204E          <1> 		cmp dx, 20000
  3241 00002589 7604                <1> 		jbe nooriginx2
  3242 0000258B 66BA0000            <1> 		mov dx, 0
  3243                              <1> 	nooriginx2:
  3244 0000258F 6681F9204E          <1> 		cmp cx, 20000
  3245 00002594 7604                <1> 		jbe nooriginy2
  3246 00002596 66B90000            <1> 		mov cx, 0
  3247                              <1> 	nooriginy2:
  3248 0000259A 6681FA0000          <1> 		cmp dx, 0
  3249 0000259F 7415                <1> 		je nofixxcolumn2
  3250 000025A1 663B15[43370000]    <1> 		cmp dx, [resolutionx2]
  3251 000025A8 720C                <1> 		jb nofixxcolumn2
  3252 000025AA 668B15[43370000]    <1> 		mov dx, [resolutionx2]
  3253 000025B1 6681EA0200          <1> 		sub dx, 2
  3254                              <1> 	nofixxcolumn2:
  3255 000025B6 6681F90000          <1> 		cmp cx, 0
  3256 000025BB 7415                <1> 		je nofixyrow2
  3257 000025BD 663B0D[3F370000]    <1> 		cmp cx, [resolutiony]
  3258 000025C4 720C                <1> 		jb nofixyrow2
  3259 000025C6 668B0D[3F370000]    <1> 		mov cx, [resolutiony]
  3260 000025CD 6681E90100          <1> 		sub cx, 1
  3261                              <1> 	nofixyrow2:
  3262 000025D2 668915[74260000]    <1> 		mov [mousecursorposition], dx
  3263 000025D9 66890D[76260000]    <1> 		mov [mousecursorposition + 2], cx
  3264 000025E0 E8A2030000          <1> 		call switchmousepos ;;use dragging code to ensure proper icon drag
  3265 000025E5 803D[DF230000]01    <1> 		cmp byte [LBUTTON], 1
  3266 000025EC 0F847B040000        <1> 		je near clickicon
  3267 000025F2 803D[E0230000]01    <1> 		cmp byte [RBUTTON], 1
  3268 000025F9 0F846E040000        <1> 		je near clickicon
  3269 000025FF A0[5A2A0000]        <1> 		mov al, [pbutton]
  3270 00002604 C705[5D2A0000]0000- <1> 		mov dword [dragging], 0
  3271 0000260C 0000                <1>
  3272 0000260E 3C00                <1> 		cmp al, 0
  3273 00002610 740F                <1> 		je nopreviousbutton
  3274 00002612 E80D030000          <1> 		call clearmousecursor
  3275 00002617 E885090000          <1> 		call reloadallgraphics
  3276 0000261C E8CF030000          <1> 		call switchmousepos2
  3277                              <1> 	nopreviousbutton:
  3278 00002621 B000                <1> 		mov al, 0
  3279 00002623 A2[5A2A0000]        <1> 		mov [pbutton], al
  3280 00002628 A0[DF230000]        <1> 		mov al, [LBUTTON]
  3281 0000262D A2[5B2A0000]        <1> 		mov [pLBUTTON], al
  3282 00002632 A0[E0230000]        <1> 		mov al, [RBUTTON]
  3283 00002637 A2[5C2A0000]        <1> 		mov [pRBUTTON], al
  3284 0000263C B900000000          <1> 		mov ecx, 0
  3285 00002641 BA00000000          <1> 		mov edx, 0
  3286 00002646 668B15[74260000]    <1> 		mov dx, [mousecursorposition]
  3287 0000264D 668B0D[76260000]    <1> 		mov cx, [mousecursorposition + 2]
  3288 00002654 66BB9CE7            <1> 		mov bx, 1110011110011100b
  3289 00002658 B400                <1> 		mov ah, 0
  3290 0000265A B080                <1> 		mov al, 128
  3291 0000265C C605[20290000]01    <1> 		mov byte [showcursorfonton], 1
  3292 00002663 E8EB100000          <1> 		call showfontvesa
  3293 00002668 C605[20290000]00    <1> 		mov byte [showcursorfonton], 0
  3294 0000266F C3                  <1> 		ret
  3295                              <1> 
  3296 00002670 84008400            <1> lastmouseposition dw 132,132
  3297 00002674 84008400            <1> mousecursorposition dw 132,132	
  3298                              <1> 
  3299                              <1> termmouse:
  3300 00002678 C3                  <1> 	ret	;;lets try this later
  3301 00002679 BE[851C0000]        <1> 		mov esi, videobuf2
  3302 0000267E BA00000000          <1> 		mov edx, 0
  3303 00002683 668B15[70260000]    <1> 		mov dx, [lastmouseposition]
  3304 0000268A 668B0D[72260000]    <1> 		mov cx, [lastmouseposition + 2]
  3305 00002691 66A1[14270000]      <1> 		mov ax, [cursorcache]
  3306 00002697 663D0000            <1> 		cmp ax, 0
  3307 0000269B 7426                <1> 		je nocopycursorcache
  3308 0000269D 66C1E104            <1> 		shl cx, 4
  3309 000026A1 66C1E203            <1> 		shl dx, 3
  3310 000026A5 01D6                <1> 		add esi, edx
  3311 000026A7 66BA0000            <1> 		mov dx, 0
  3312 000026AB 8A15[8B090000]      <1> 		mov dl, [charxy]
  3313 000026B1 6641                <1> 		inc cx
  3314                              <1> termmousecplp1:
  3315 000026B3 01D6                <1> 		add esi, edx
  3316 000026B5 6649                <1> 		dec cx
  3317 000026B7 6681F90000          <1> 		cmp cx, 0
  3318 000026BC 75F5                <1> 		jne termmousecplp1
  3319 000026BE 29D6                <1> 		sub esi, edx
  3320 000026C0 668906              <1> 		mov [esi], ax
  3321                              <1> nocopycursorcache:
  3322 000026C3 BE[851C0000]        <1> 		mov esi, videobuf2
  3323 000026C8 BA00000000          <1> 		mov edx, 0
  3324 000026CD 668B15[74260000]    <1> 		mov dx, [mousecursorposition]
  3325 000026D4 668B0D[76260000]    <1> 		mov cx, [mousecursorposition + 2]
  3326 000026DB 66C1E104            <1> 		shl cx, 4
  3327 000026DF 66C1E203            <1> 		shl dx, 3
  3328 000026E3 01D6                <1> 		add esi, edx
  3329 000026E5 66BA0000            <1> 		mov dx, 0
  3330 000026E9 8A15[8B090000]      <1> 		mov dl, [charxy]
  3331 000026EF 6641                <1> 		inc cx
  3332                              <1> termmousecplp2:
  3333 000026F1 01D6                <1> 		add esi, edx
  3334 000026F3 6649                <1> 		dec cx
  3335 000026F5 6681F90000          <1> 		cmp cx, 0
  3336 000026FA 75F5                <1> 		jne termmousecplp2
  3337 000026FC 29D6                <1> 		sub esi, edx
  3338 000026FE 668B06              <1> 		mov ax, [esi]
  3339 00002701 66A3[14270000]      <1> 		mov [cursorcache], ax
  3340 00002707 B080                <1> 		mov al, 128
  3341 00002709 B407                <1> 		mov ah, 7
  3342 0000270B 668906              <1> 		mov [esi], ax
  3343 0000270E E847E5FFFF          <1> 		call termcopy
  3344 00002713 C3                  <1> 		ret
  3345 00002714 0000                <1> cursorcache db 0,0
  3346                              <1> 	
  3347                              <1> scancode:
  3348 00002716 0000                <1> 	db 0,0		;,0h
  3349 00002718 0000                <1> 	db 0,0		;,1h
  3350 0000271A 3121                <1> 	db '1','!'	;,2h
  3351 0000271C 3240                <1> 	db '2','@'	;,3h
  3352 0000271E 3323                <1> 	db '3','#'	;,4h
  3353 00002720 3424                <1> 	db '4','$'	;,5h
  3354 00002722 3525                <1> 	db '5','%'	;,6h
  3355 00002724 365E                <1> 	db '6','^'	;,7h
  3356 00002726 3726                <1> 	db '7','&'	;,8h
  3357 00002728 382A                <1> 	db '8','*'	;,9h
  3358 0000272A 3928                <1> 	db '9','('	;,0Ah
  3359 0000272C 3029                <1> 	db '0',')'	;,0Bh
  3360 0000272E 2D5F                <1> 	db '-','_'	;,0Ch
  3361 00002730 3D2B                <1> 	db '=','+'	;,0Dh
  3362 00002732 0808                <1> 	db 8,8		;,0Eh
  3363 00002734 0000                <1> 	db 0,0		;,0Fh
  3364 00002736 7151                <1> 	db 'q','Q'	;,10h
  3365 00002738 7757                <1> 	db 'w','W'	;,11h
  3366 0000273A 6545                <1> 	db 'e','E'	;,12h
  3367 0000273C 7252                <1> 	db 'r','R'	;,13h
  3368 0000273E 7454                <1> 	db 't','T'	;,14h
  3369 00002740 7959                <1> 	db 'y','Y'	;,15h
  3370 00002742 7555                <1> 	db 'u','U'	;,16h
  3371 00002744 6949                <1> 	db 'i','I'	;,17h
  3372 00002746 6F4F                <1> 	db 'o','O'	;,18h
  3373 00002748 7050                <1> 	db 'p','P'	;,19h
  3374 0000274A 5B7B                <1> 	db '[','{'	;,1Ah
  3375 0000274C 5D7D                <1> 	db ']','}'	;,1Bh
  3376 0000274E 0000                <1> 	db 0,0		;,1Ch
  3377 00002750 0000                <1> 	db 0,0		;,1Dh
  3378 00002752 6141                <1> 	db 'a','A'	;,1Eh
  3379 00002754 7353                <1> 	db 's','S'	;,1Fh
  3380 00002756 6444                <1> 	db 'd','D'	;,20h
  3381 00002758 6646                <1> 	db 'f','F'	;,21h
  3382 0000275A 6747                <1> 	db 'g','G'	;,22h
  3383 0000275C 6848                <1> 	db 'h','H'	;,23h
  3384 0000275E 6A4A                <1> 	db 'j','J'	;,24h
  3385 00002760 6B4B                <1> 	db 'k','K'	;,25h
  3386 00002762 6C4C                <1> 	db 'l','L'	;,26h
  3387 00002764 3B3A                <1> 	db ';',':'	;,27h
  3388 00002766 2722                <1> 	db 27h,22h	;,28h
  3389 00002768 607E                <1> 	db '`','~'	;,29h
  3390 0000276A 0000                <1> 	db 0,0		;,2Ah
  3391 0000276C 5C7C                <1> 	db '\','|'	;,2Bh
  3392 0000276E 7A5A                <1> 	db 'z','Z'	;,2Ch
  3393 00002770 7858                <1> 	db 'x','X'	;,2Dh
  3394 00002772 6343                <1> 	db 'c','C'	;,2Eh
  3395 00002774 7656                <1> 	db 'v','V'	;,2Fh
  3396 00002776 6242                <1> 	db 'b','B'	;,30h
  3397 00002778 6E4E                <1> 	db 'n','N'	;,31h
  3398 0000277A 6D4D                <1> 	db 'm','M'	;,32h
  3399 0000277C 2C3C                <1> 	db ',','<'	;,33h
  3400 0000277E 2E3E                <1> 	db '.','>'	;,34h
  3401 00002780 2F3F                <1> 	db '/','?'	;,35h
  3402 00002782 0000                <1> 	db 0,0		;,36h
  3403 00002784 0000                <1> 	db 0,0		;,37h
  3404 00002786 0000                <1> 	db 0,0		;,38h
  3405 00002788 2020                <1> 	db ' ',' '	;,39h
  3406                              <1> noscan:
  3407                                      %include 'source/gui.asm'
  3408                              <1> guiclear:
  3409 0000278A 8B3D[EC4B0000]      <1> 	mov edi, [physbaseptr]
  3410 00002790 668B15[41370000]    <1> 	mov dx, [resolutionx]
  3411 00002797 668B0D[3F370000]    <1> 	mov cx, [resolutiony]
  3412 0000279E 66A1[C7270000]      <1> 	mov ax, [background]
  3413                              <1> guiclearloop:
  3414 000027A4 668907              <1> 	mov [edi], ax
  3415 000027A7 81C702000000        <1> 	add edi, 2
  3416 000027AD 664A                <1> 	dec dx
  3417 000027AF 6681FA0000          <1> 	cmp dx, 0
  3418 000027B4 77EE                <1> 	ja guiclearloop
  3419 000027B6 6649                <1> 	dec cx
  3420 000027B8 668B15[41370000]    <1> 	mov dx, [resolutionx]
  3421 000027BF 6681F90000          <1> 	cmp cx, 0
  3422 000027C4 77DE                <1> 	ja guiclearloop
  3423 000027C6 C3                  <1> 	ret
  3424                              <1> 
  3425 000027C7 CF7B                <1> background dw 0111101111001111b
  3426                              <1> 
  3427                              <1> gui:	;Let's see what I can do, I am going to try to make this as freestanding as possible
  3428 000027C9 B800000000          <1> 	mov eax, 0
  3429 000027CE BB00000000          <1> 	mov ebx, 0
  3430 000027D3 B900000000          <1> 	mov ecx, 0
  3431 000027D8 BA00000000          <1> 	mov edx, 0
  3432 000027DD 8B3D[EC4B0000]      <1> 	mov edi, [physbaseptr]
  3433 000027E3 668B15[41370000]    <1> 	mov dx, [resolutionx]
  3434 000027EA 668B0D[3F370000]    <1> 	mov cx, [resolutiony]
  3435 000027F1 668B1D[C7270000]    <1> 	mov bx, [background]
  3436                              <1> guiclearloop2:
  3437 000027F8 66891F              <1> 	mov [edi], bx
  3438 000027FB 81C702000000        <1> 	add edi, 2
  3439 00002801 664A                <1> 	dec dx
  3440 00002803 6681FA0000          <1> 	cmp dx, 0
  3441 00002808 0F85EAFFFFFF        <1> 	jne near guiclearloop2
  3442 0000280E 6649                <1> 	dec cx
  3443 00002810 668B15[41370000]    <1> 	mov dx, [resolutionx]
  3444 00002817 6681F90000          <1> 	cmp cx, 0
  3445 0000281C 0F85D6FFFFFF        <1> 	jne near guiclearloop2
  3446 00002822 C605[23290000]01    <1> 	mov byte [guion], 1
  3447 00002829 C605[22290000]00    <1> 	mov byte [mouseselecton], 0
  3448 00002830 B800000000          <1> 	mov eax, 0
  3449 00002835 BB00000000          <1> 	mov ebx, 0
  3450 0000283A B900000000          <1> 	mov ecx, 0
  3451 0000283F BA00000000          <1> 	mov edx, 0
  3452                              <1> 	
  3453 00002844 BE[AB390000]        <1> 	mov esi, pacmsg
  3454 00002849 66B80000            <1> 	mov ax, 0
  3455 0000284D BB00000000          <1> 	mov ebx, 0
  3456 00002852 66B90200            <1> 	mov cx, 2
  3457 00002856 66BA0400            <1> 	mov dx, 4
  3458 0000285A E8880A0000          <1> 	call showstring
  3459                              <1> 	
  3460 0000285F BE[C13A0000]        <1> 	mov esi, interneticon
  3461 00002864 66B80000            <1> 	mov ax, 0
  3462 00002868 BB[203A0000]        <1> 	mov ebx, noie
  3463 0000286D 66B91800            <1> 	mov cx, 24
  3464 00002871 66BA0400            <1> 	mov dx, 4
  3465 00002875 E8EC0D0000          <1> 	call showicon
  3466                              <1> 	
  3467 0000287A BE[433B0000]        <1> 	mov esi, wordicon
  3468 0000287F 66B80000            <1> 	mov ax, 0
  3469 00002883 BB00000000          <1> 	mov ebx, 0
  3470 00002888 66B91800            <1> 	mov cx, 24
  3471 0000288C 66BA3000            <1> 	mov dx, 48
  3472 00002890 E8D10D0000          <1> 	call showicon
  3473                              <1> 	
  3474 00002895 BE[C53B0000]        <1> 	mov esi, pacmanpellet
  3475 0000289A 66B80000            <1> 	mov ax, 0
  3476 0000289E BB00000000          <1> 	mov ebx, 0
  3477 000028A3 66B94000            <1> 	mov cx, 64
  3478 000028A7 66BA0400            <1> 	mov dx, 4
  3479 000028AB E8B60D0000          <1> 	call showicon
  3480                              <1> 	
  3481 000028B0 BE[C93C0000]        <1> 	mov esi, pacman
  3482 000028B5 66B80000            <1> 	mov ax, 0
  3483 000028B9 BB[053A0000]        <1> 	mov ebx, pacmannomnom
  3484 000028BE 66B94000            <1> 	mov cx, 64
  3485 000028C2 66BA3000            <1> 	mov dx, 48
  3486 000028C6 E89B0D0000          <1> 	call showicon
  3487                              <1> 	
  3488 000028CB BE[473C0000]        <1> 	mov esi, ghostie
  3489 000028D0 66B80000            <1> 	mov ax, 0
  3490 000028D4 BB[EA390000]        <1> 	mov ebx, boo
  3491 000028D9 66B96C00            <1> 	mov cx, 108
  3492 000028DD 66BA0400            <1> 	mov dx, 4
  3493 000028E1 E8800D0000          <1> 	call showicon
  3494                              <1> 
  3495 000028E6 BE[97390000]        <1> 	mov esi, start
  3496 000028EB 668B0D[3F370000]    <1> 	mov cx, [resolutiony]
  3497 000028F2 6681E91000          <1> 	sub cx, 16
  3498 000028F7 66BA0200            <1> 	mov dx, 2
  3499 000028FB B400                <1> 	mov ah, 0
  3500 000028FD B010                <1> 	mov al, 00010000b
  3501 000028FF BB[6E3A0000]        <1> 	mov ebx, winblows
  3502 00002904 E8DE090000          <1> 	call showstring
  3503                              <1> 	
  3504 00002909 E89BFBFFFF          <1> 	call cursorgui
  3505                              <1> guistart:
  3506 0000290E E8D1FAFFFF          <1> 	call guistartin
  3507 00002913 C605[1C290000]00    <1> 	mov byte [copygui], 0
  3508 0000291A EBF2                <1> 	jmp guistart
  3509                              <1> 	
  3510                              <1> ;guicopy:	;;for double buffering
  3511                              <1> ;	mov byte [copygui], 1
  3512                              <1> ;	mov edi, [offscreenmemoffset]
  3513                              <1> ;	mov edx, 0
  3514                              <1> ;	mov ecx, 0
  3515                              <1> ;	mov dx, [mousecursorposition]
  3516                              <1> ;	mov cx, [mousecursorposition + 2]
  3517                              <1> ;	add edi, edx
  3518                              <1> ;	mov dx, [resolutionx2]
  3519                              <1> ;	inc cx
  3520                              <1> ;guicp2:
  3521                              <1> ;	add edi, edx
  3522                              <1> ;	dec cx
  3523                              <1> ;	cmp cx, 0
  3524                              <1> ;	jne guicp2
  3525                              <1> ;	sub edi, edx
  3526                              <1> ;	mov [cursorloc], edi
  3527                              <1> ;	mov ebx, cursorbmp
  3528                              <1> ;	mov cx, [resolutiony]
  3529                              <1> ;	rol ecx, 16
  3530                              <1> ;	mov cx, [resolutionx]
  3531                              <1> ;	mov esi, [physbaseptr]
  3532                              <1> ;	mov edi, [offscreenmemoffset]
  3533                              <1> ;guicp1:
  3534                              <1> ;	mov ax, [esi]
  3535                              <1> ;	mov [edi], ax
  3536                              <1> ;	add esi, 2
  3537                              <1> ;	add edi, 2
  3538                              <1> ;	cmp edi, [cursorloc]
  3539                              <1> ;	je copycursor
  3540                              <1> ;dncopycursor:
  3541                              <1> ;	dec cx
  3542                              <1> ;	cmp cx, 0
  3543                              <1> ;	jne guicp1
  3544                              <1> ;	mov cx, [resolutionx]
  3545                              <1> ;	rol ecx, 16
  3546                              <1> ;	dec cx
  3547                              <1> ;	cmp cx, 0
  3548                              <1> ;	rol ecx, 16
  3549                              <1> ;	jne guicp1
  3550                              <1> ;	mov byte [copygui], 0
  3551                              <1> ;	ret
  3552                              <1> ;copycursor:
  3553                              <1> ;	cmp ebx, cursorbmpend
  3554                              <1> ;	jae dncopycursor
  3555                              <1> ;	mov dx, [resolutionx2]
  3556                              <1> ;	add edi, edx
  3557                              <1> ;	mov [cursorloc], edi
  3558                              <1> ;	sub edi, edx
  3559                              <1> ;	dec ebx
  3560                              <1> ;	sub edi, 2
  3561                              <1> ;	sub esi, 2
  3562                              <1> ;	mov dx, 9
  3563                              <1> ;curscplp:
  3564                              <1> ;	inc ebx
  3565                              <1> ;	add esi, 2
  3566                              <1> ;	add edi, 2
  3567                              <1> ;	mov ax, [esi]
  3568                              <1> ;	mov [edi], ax
  3569                              <1> ;	mov al, [ebx]
  3570                              <1> ;	cmp al, 0
  3571                              <1> ;	je curscplp2
  3572                              <1> ;	mov word [edi], 1110011110011100b
  3573                              <1> ;curscplp2:
  3574                              <1> ;	dec cx
  3575                              <1> ;	cmp cx, 0
  3576                              <1> ;	je dncopycursor
  3577                              <1> ;	dec dx
  3578                              <1> ;	cmp dx, 0
  3579                              <1> ;	jne curscplp
  3580                              <1> ;	jmp dncopycursor
  3581                              <1> 	
  3582                              <1> 	
  3583                              <1> ;cursorloc: dd 0
  3584                              <1> 		
  3585                              <1> ;nextimage:	
  3586                              <1> ;	call guiclear
  3587                              <1> ;	mov esi, [bmpend]
  3588                              <1> ;	mov eax, 0
  3589                              <1> ;	mov ebx, 0
  3590                              <1> ;	mov ecx, 0
  3591                              <1> ;	mov edx, 0
  3592                              <1> ;	call showbmp
  3593                              <1> ;	jmp guistartin
  3594                              <1> 		
  3595 0000291C 00                  <1> copygui db 0
  3596 0000291D 00                  <1> graphicsset db 0
  3597 0000291E 0000                <1> graphicspos db 0,0
  3598 00002920 00                  <1> showcursorfonton db 0
  3599 00002921 00                  <1> savefonton db 0
  3600 00002922 00                  <1> mouseselecton db 0
  3601 00002923 00                  <1> guion db 0
  3602                              <1> 
  3603                              <1> 		
  3604                              <1> clearmousecursor:
  3605 00002924 BE[C7270000]        <1> 		mov esi, background
  3606 00002929 8B3D[EC4B0000]      <1> 		mov edi, [physbaseptr]
  3607 0000292F BA00000000          <1> 		mov edx, 0
  3608 00002934 B900000000          <1> 		mov ecx, 0
  3609 00002939 668B15[70260000]    <1> 		mov dx, [lastmouseposition]
  3610 00002940 668B0D[72260000]    <1> 		mov cx, [lastmouseposition + 2]
  3611 00002947 01D7                <1> 		add edi, edx
  3612 00002949 BA00000000          <1> 		mov edx, 0
  3613 0000294E 668B15[43370000]    <1> 		mov dx, [resolutionx2]
  3614 00002955 6681F90000          <1> 		cmp cx, 0
  3615 0000295A 740B                <1> 		je noyclr
  3616 0000295C 01D7                <1> yclr:	add edi, edx
  3617 0000295E 6649                <1> 		dec cx
  3618 00002960 6681F90000          <1> 		cmp cx, 0
  3619 00002965 75F5                <1> 		jne yclr
  3620 00002967 668B06              <1> noyclr:	mov ax, [esi]
  3621 0000296A C1C010              <1> 		rol eax, 16
  3622 0000296D 668B06              <1> 		mov ax, [esi]
  3623 00002970 8907                <1> 		mov [edi], eax
  3624 00002972 894704              <1> 		mov [edi + 4], eax
  3625 00002975 894708              <1> 		mov [edi + 8], eax
  3626 00002978 89470C              <1> 		mov [edi + 12], eax
  3627 0000297B 01D7                <1> 		add edi, edx
  3628 0000297D 6641                <1> 		inc cx
  3629 0000297F 6681F91000          <1> 		cmp cx, 16
  3630 00002984 72E1                <1> 		jb noyclr
  3631 00002986 C3                  <1> 		ret
  3632                              <1> 
  3633                              <1> switchmousepos:		;;switch were the mouse is located
  3634 00002987 BE[00120000]        <1> 		mov esi, mousecolorbuf
  3635 0000298C 8B3D[EC4B0000]      <1> 		mov edi, [physbaseptr]
  3636 00002992 BA00000000          <1> 		mov edx, 0
  3637 00002997 B900000000          <1> 		mov ecx, 0
  3638 0000299C 668B15[70260000]    <1> 		mov dx, [lastmouseposition]
  3639 000029A3 668B0D[72260000]    <1> 		mov cx, [lastmouseposition + 2]
  3640 000029AA 01D7                <1> 		add edi, edx
  3641 000029AC BA00000000          <1> 		mov edx, 0
  3642 000029B1 668B15[43370000]    <1> 		mov dx, [resolutionx2]
  3643 000029B8 6681F90000          <1> 		cmp cx, 0
  3644 000029BD 740B                <1> 		je noswmsy
  3645 000029BF 01D7                <1> swmsy:		add edi, edx
  3646 000029C1 6649                <1> 		dec cx
  3647 000029C3 6681F90000          <1> 		cmp cx, 0
  3648 000029C8 75F5                <1> 		jne swmsy
  3649 000029CA 8B06                <1> noswmsy:	mov eax, [esi]
  3650 000029CC 8B5E04              <1> 		mov ebx, [esi + 4]
  3651 000029CF 8907                <1> 		mov [edi], eax
  3652 000029D1 895F04              <1> 		mov [edi + 4], ebx
  3653 000029D4 8B4608              <1> 		mov eax, [esi + 8]
  3654 000029D7 8B5E0C              <1> 		mov ebx, [esi + 12]
  3655 000029DA 894708              <1> 		mov [edi + 8], eax
  3656 000029DD 895F0C              <1> 		mov [edi + 12], ebx
  3657 000029E0 01D7                <1> 		add edi, edx
  3658 000029E2 81C610000000        <1> 		add esi, 16
  3659 000029E8 81FE[00130000]      <1> 		cmp esi, mcolorend
  3660 000029EE 72DA                <1> 		jb noswmsy
  3661                              <1> 		
  3662                              <1> switchmousepos2:
  3663 000029F0 BE[00120000]        <1> 		mov esi, mousecolorbuf
  3664 000029F5 8B3D[EC4B0000]      <1> 		mov edi, [physbaseptr]
  3665 000029FB BA00000000          <1> 		mov edx, 0
  3666 00002A00 B900000000          <1> 		mov ecx, 0
  3667 00002A05 668B15[74260000]    <1> 		mov dx, [mousecursorposition]
  3668 00002A0C 668B0D[76260000]    <1> 		mov cx, [mousecursorposition + 2]
  3669 00002A13 01D7                <1> 		add edi, edx
  3670 00002A15 BA00000000          <1> 		mov edx, 0
  3671 00002A1A 668B15[43370000]    <1> 		mov dx, [resolutionx2]
  3672 00002A21 6681F90000          <1> 		cmp cx, 0
  3673 00002A26 740B                <1> 		je noswmsy2
  3674 00002A28 01D7                <1> swmsy2:		add edi, edx
  3675 00002A2A 6649                <1> 		dec cx
  3676 00002A2C 6681F90000          <1> 		cmp cx, 0
  3677 00002A31 75F5                <1> 		jne swmsy2
  3678 00002A33 8B07                <1> noswmsy2:	mov eax, [edi]
  3679 00002A35 8B5F04              <1> 		mov ebx, [edi + 4]
  3680 00002A38 8906                <1> 		mov [esi], eax
  3681 00002A3A 895E04              <1> 		mov [esi + 4], ebx
  3682 00002A3D 8B4708              <1> 		mov eax, [edi + 8]
  3683 00002A40 8B5F0C              <1> 		mov ebx, [edi + 12]
  3684 00002A43 894608              <1> 		mov [esi + 8], eax
  3685 00002A46 895E0C              <1> 		mov [esi + 12], ebx
  3686 00002A49 01D7                <1> 		add edi, edx
  3687 00002A4B 81C610000000        <1> 		add esi, 16
  3688 00002A51 81FE[00130000]      <1> 		cmp esi, mcolorend
  3689 00002A57 72DA                <1> 		jb noswmsy2
  3690 00002A59 C3                  <1> 		ret
  3691                              <1> 
  3692 00002A5A 00                  <1> pbutton db 0
  3693 00002A5B 00                  <1> pLBUTTON db 0
  3694 00002A5C 00                  <1> pRBUTTON db 0
  3695 00002A5D 00000000            <1> dragging dw 0,0
  3696 00002A61 0000000000000000    <1> lastpos dw 0,0,0,0
  3697 00002A69 00000000            <1> colorbuf dw 0,0
  3698                              <1> 	
  3699                              <1> 	clickicon:
  3700 00002A6D B001                <1> 		mov al, 1
  3701 00002A6F A2[5A2A0000]        <1> 		mov [pbutton], al
  3702 00002A74 A0[5B2A0000]        <1> 		mov al, [pLBUTTON]
  3703 00002A79 2205[DF230000]      <1> 		and al, [LBUTTON]
  3704 00002A7F 8A25[5C2A0000]      <1> 		mov ah, [pRBUTTON]
  3705 00002A85 2225[E0230000]      <1> 		and ah, [RBUTTON]
  3706 00002A8B 08E0                <1> 		or al, ah
  3707 00002A8D 3C00                <1> 		cmp al, 0
  3708 00002A8F 741B                <1> 		je nodragclick
  3709 00002A91 813D[5D2A0000]0100- <1> 		cmp dword [dragging], 1
  3710 00002A99 0000                <1>
  3711 00002A9B 732D                <1> 		jae dragclick
  3712 00002A9D C705[5D2A0000]0100- <1> 		mov dword [dragging], 1
  3713 00002AA5 0000                <1>
  3714 00002AA7 E91E000000          <1> 		jmp dragclick
  3715                              <1> 	nodragclick:
  3716 00002AAC C705[5D2A0000]0000- <1> 		mov dword [dragging], 0
  3717 00002AB4 0000                <1>
  3718 00002AB6 A0[DF230000]        <1> 		mov al, [LBUTTON]
  3719 00002ABB A2[5B2A0000]        <1> 		mov [pLBUTTON], al
  3720 00002AC0 A0[E0230000]        <1> 		mov al, [RBUTTON]
  3721 00002AC5 A2[5C2A0000]        <1> 		mov [pRBUTTON], al
  3722                              <1> 	dragclick:
  3723 00002ACA 66B80000            <1> 		mov ax, 0
  3724 00002ACE BE[00100000]        <1> 		mov esi, graphicstable
  3725 00002AD3 C705[E5390000]0000- <1> 		mov dword [codepointer], 0
  3726 00002ADB 0000                <1>
  3727                              <1> 	clicon2:
  3728 00002ADD BA00000000          <1> 		mov edx, 0
  3729 00002AE2 B900000000          <1> 		mov ecx, 0
  3730 00002AE7 66813E0100          <1> 		cmp word [esi], 1
  3731 00002AEC 0F841B000000        <1> 		je near iconselect
  3732 00002AF2 66813E0200          <1> 		cmp word [esi], 2
  3733 00002AF7 0F8472010000        <1> 		je near textselected
  3734 00002AFD 66813E0300          <1> 		cmp word [esi], 3
  3735 00002B02 0F84C7020000        <1> 		je near windowselect
  3736 00002B08 E901040000          <1> 		jmp nexticonsel
  3737                              <1> 	iconselect:
  3738 00002B0D 668B5606            <1> 		mov dx, [esi + 6]
  3739 00002B11 6689D0              <1> 		mov ax, dx
  3740 00002B14 668B4E08            <1> 		mov cx, [esi + 8]
  3741 00002B18 6689CB              <1> 		mov bx, cx
  3742 00002B1B 6681C32000          <1> 		add bx, 32
  3743 00002B20 6601D0              <1> 		add ax, dx
  3744 00002B23 813D[5D2A0000]0100- <1> 		cmp dword [dragging], 1
  3745 00002B2B 0000                <1>
  3746 00002B2D 746F                <1> 		je dragicon
  3747 00002B2F 813D[5D2A0000]0000- <1> 		cmp dword [dragging], 0
  3748 00002B37 0000                <1>
  3749 00002B39 7411                <1> 		je nodragiconcheck
  3750 00002B3B 3935[5D2A0000]      <1> 		cmp dword [dragging], esi
  3751 00002B41 0F85C7030000        <1> 		jne near nexticonsel
  3752 00002B47 E952000000          <1> 		jmp dragicon
  3753                              <1> 	nodragiconcheck:
  3754 00002B4C 663905[74260000]    <1> 		cmp [mousecursorposition], ax
  3755 00002B53 0F82B5030000        <1> 		jb near nexticonsel
  3756 00002B59 66054000            <1> 		add ax, 64
  3757 00002B5D 663905[74260000]    <1> 		cmp [mousecursorposition], ax
  3758 00002B64 0F87A4030000        <1> 		ja near nexticonsel
  3759 00002B6A 6629D0              <1> 		sub ax, dx
  3760 00002B6D 66390D[76260000]    <1> 		cmp [mousecursorposition + 2], cx
  3761 00002B74 0F8294030000        <1> 		jb near nexticonsel
  3762 00002B7A 66391D[76260000]    <1> 		cmp [mousecursorposition + 2], bx
  3763 00002B81 0F8787030000        <1> 		ja near nexticonsel
  3764 00002B87 668B460A            <1> 		mov ax, [esi + 10]
  3765 00002B8B 66250100            <1> 		and ax, 1
  3766 00002B8F 663D0100            <1> 		cmp ax, 1
  3767 00002B93 0F84B6000000        <1> 		je near unselecticon
  3768 00002B99 E98D000000          <1> 		jmp nodragicon
  3769                              <1> 	dragicon:
  3770 00002B9E 663905[70260000]    <1> 		cmp [lastmouseposition], ax
  3771 00002BA5 0F8263030000        <1> 		jb near nexticonsel
  3772 00002BAB 66054000            <1> 		add ax, 64
  3773 00002BAF 663905[70260000]    <1> 		cmp [lastmouseposition], ax
  3774 00002BB6 0F8752030000        <1> 		ja near nexticonsel
  3775 00002BBC 6629D0              <1> 		sub ax, dx
  3776 00002BBF 66390D[72260000]    <1> 		cmp [lastmouseposition + 2], cx
  3777 00002BC6 0F8242030000        <1> 		jb near nexticonsel
  3778 00002BCC 66391D[72260000]    <1> 		cmp [lastmouseposition + 2], bx
  3779 00002BD3 0F8735030000        <1> 		ja near nexticonsel
  3780 00002BD9 668B460A            <1> 		mov ax, [esi + 10]
  3781 00002BDD 2410                <1> 		and al, 00010000b
  3782 00002BDF 3C10                <1> 		cmp al, 00010000b
  3783 00002BE1 7448                <1> 		je nodragicon
  3784 00002BE3 8935[5D2A0000]      <1> 		mov [dragging], esi
  3785 00002BE9 66D1E2              <1> 		shl dx, 1
  3786 00002BEC 662B15[70260000]    <1> 		sub dx, [lastmouseposition]
  3787 00002BF3 660315[74260000]    <1> 		add dx, [mousecursorposition]
  3788 00002BFA 66D1EA              <1> 		shr dx, 1
  3789 00002BFD 66030D[76260000]    <1> 		add cx, [mousecursorposition + 2]
  3790 00002C04 662B0D[72260000]    <1> 		sub cx, [lastmouseposition + 2]
  3791 00002C0B 663B15[43370000]    <1> 		cmp dx, [resolutionx2]
  3792 00002C12 7607                <1> 		jbe chkyresdrgicn
  3793 00002C14 668B15[74260000]    <1> 		mov dx, [mousecursorposition]
  3794                              <1> 	chkyresdrgicn:
  3795 00002C1B 663B0D[3F370000]    <1> 		cmp cx, [resolutiony]
  3796 00002C22 7607                <1> 		jbe nodragicon
  3797 00002C24 668B0D[76260000]    <1> 		mov cx, [mousecursorposition + 2]
  3798                              <1> 	nodragicon:
  3799 00002C2B 66814E0A0100        <1> 		or word [esi + 10], 1
  3800 00002C31 8B5E0C              <1> 		mov ebx, [esi + 12]
  3801 00002C34 668B460A            <1> 		mov ax, [esi + 10]
  3802 00002C38 8B7602              <1> 		mov esi, [esi + 2]
  3803 00002C3B C705[E5390000]0000- <1> 		mov dword [codepointer], 0
  3804 00002C43 0000                <1>
  3805 00002C45 E81C0A0000          <1> 		call showicon
  3806 00002C4A E9D8020000          <1> 		jmp doneiconsel
  3807                              <1> 	unselecticon:
  3808 00002C4F 6681660AFEFF        <1> 		and word [esi + 10], 0xFFFE
  3809 00002C55 8B5E0C              <1> 		mov ebx, [esi + 12]
  3810 00002C58 668B460A            <1> 		mov ax, [esi + 10]
  3811 00002C5C 8B7602              <1> 		mov esi, [esi + 2]
  3812 00002C5F 891D[E5390000]      <1> 		mov [codepointer], ebx
  3813 00002C65 E8FC090000          <1> 		call showicon
  3814 00002C6A E9B8020000          <1> 		jmp doneiconsel
  3815                              <1> 	textselected:
  3816 00002C6F 8B5E02              <1> 		mov ebx, [esi + 2]
  3817 00002C72 668B5606            <1> 		mov dx, [esi + 6]
  3818 00002C76 6689D0              <1> 		mov ax, dx
  3819 00002C79 668B4E08            <1> 		mov cx, [esi + 8]
  3820                              <1> 	lengthtesttext:
  3821 00002C7D 803B00              <1> 		cmp byte [ebx], 0
  3822 00002C80 7407                <1> 		je donetesttextlength
  3823 00002C82 43                  <1> 		inc ebx
  3824 00002C83 66051000            <1> 		add ax, 16
  3825 00002C87 EBF4                <1> 		jmp lengthtesttext
  3826                              <1> 	donetesttextlength:
  3827 00002C89 6689CB              <1> 		mov bx, cx
  3828 00002C8C 6681C30F00          <1> 		add bx, 15
  3829 00002C91 813D[5D2A0000]0100- <1> 		cmp dword [dragging], 1
  3830 00002C99 0000                <1>
  3831 00002C9B 7468                <1> 		je dragtext
  3832 00002C9D 813D[5D2A0000]0000- <1> 		cmp dword [dragging], 0
  3833 00002CA5 0000                <1>
  3834 00002CA7 7411                <1> 		je nodragtextcheck
  3835 00002CA9 3935[5D2A0000]      <1> 		cmp dword [dragging], esi
  3836 00002CAF 0F8559020000        <1> 		jne near nexticonsel
  3837 00002CB5 E94B000000          <1> 		jmp dragtext
  3838                              <1> 	nodragtextcheck:
  3839 00002CBA 663915[74260000]    <1> 		cmp [mousecursorposition], dx
  3840 00002CC1 0F8247020000        <1> 		jb near nexticonsel
  3841 00002CC7 663905[74260000]    <1> 		cmp [mousecursorposition], ax
  3842 00002CCE 0F873A020000        <1> 		ja near nexticonsel
  3843 00002CD4 66390D[76260000]    <1> 		cmp [mousecursorposition + 2], cx
  3844 00002CDB 0F822D020000        <1> 		jb near nexticonsel
  3845 00002CE1 66391D[76260000]    <1> 		cmp [mousecursorposition + 2], bx
  3846 00002CE8 0F8720020000        <1> 		ja near nexticonsel
  3847 00002CEE 668B460A            <1> 		mov ax, [esi + 10]
  3848 00002CF2 66250100            <1> 		and ax, 1
  3849 00002CF6 663D0100            <1> 		cmp ax, 1
  3850 00002CFA 0F84AB000000        <1> 		je near unselecttext
  3851 00002D00 E986000000          <1> 		jmp nodragtext
  3852                              <1> 	dragtext:
  3853 00002D05 663915[70260000]    <1> 		cmp [lastmouseposition], dx
  3854 00002D0C 0F82FC010000        <1> 		jb near nexticonsel
  3855 00002D12 663905[70260000]    <1> 		cmp [lastmouseposition], ax
  3856 00002D19 0F87EF010000        <1> 		ja near nexticonsel
  3857 00002D1F 66390D[72260000]    <1> 		cmp [lastmouseposition + 2], cx
  3858 00002D26 0F82E2010000        <1> 		jb near nexticonsel
  3859 00002D2C 66391D[72260000]    <1> 		cmp [lastmouseposition + 2], bx
  3860 00002D33 0F87D5010000        <1> 		ja near nexticonsel
  3861 00002D39 668B460A            <1> 		mov ax, [esi + 10]
  3862 00002D3D 2410                <1> 		and al, 00010000b
  3863 00002D3F 663D1000            <1> 		cmp ax, 00010000b
  3864 00002D43 0F8442000000        <1> 		je near nodragtext
  3865 00002D49 8935[5D2A0000]      <1> 		mov [dragging], esi
  3866 00002D4F 662B15[70260000]    <1> 		sub dx, [lastmouseposition]
  3867 00002D56 660315[74260000]    <1> 		add dx, [mousecursorposition]
  3868 00002D5D 66030D[76260000]    <1> 		add cx, [mousecursorposition + 2]
  3869 00002D64 662B0D[72260000]    <1> 		sub cx, [lastmouseposition + 2]
  3870 00002D6B 663B15[43370000]    <1> 		cmp dx, [resolutionx2]
  3871 00002D72 7607                <1> 		jbe chkyresdrgtxt
  3872 00002D74 668B15[74260000]    <1> 		mov dx, [mousecursorposition]
  3873                              <1> 	chkyresdrgtxt:
  3874 00002D7B 663B0D[3F370000]    <1> 		cmp cx, [resolutiony]
  3875 00002D82 7607                <1> 		jbe nodragtext
  3876 00002D84 668B0D[76260000]    <1> 		mov cx, [mousecursorposition + 2]
  3877                              <1> 	nodragtext:
  3878 00002D8B 66814E0A0100        <1> 		or word [esi + 10], 1
  3879 00002D91 8B5E0C              <1> 		mov ebx, [esi + 12]
  3880 00002D94 891D[E5390000]      <1> 		mov [codepointer], ebx
  3881 00002D9A 668B460A            <1> 		mov ax, [esi + 10]
  3882 00002D9E 8B7602              <1> 		mov esi, [esi + 2]
  3883 00002DA1 E841050000          <1> 		call showstring
  3884 00002DA6 E97C010000          <1> 		jmp doneiconsel
  3885                              <1> 	unselecttext:
  3886 00002DAB 6681660AFEFF        <1> 		and word [esi + 10], 0xFFFE
  3887 00002DB1 8B5E0C              <1> 		mov ebx, [esi + 12]
  3888 00002DB4 668B460A            <1> 		mov ax, [esi + 10]
  3889 00002DB8 8B7602              <1> 		mov esi, [esi + 2]
  3890 00002DBB C705[E5390000]0000- <1> 		mov dword [codepointer], 0
  3891 00002DC3 0000                <1>
  3892 00002DC5 E81D050000          <1> 		call showstring
  3893 00002DCA E958010000          <1> 		jmp doneiconsel
  3894                              <1> windowselect:
  3895 00002DCF 8B7E02              <1> 		mov edi, [esi + 2]
  3896 00002DD2 668B5606            <1> 		mov dx, [esi + 6]
  3897 00002DD6 6689D0              <1> 		mov ax, dx
  3898 00002DD9 668B4E08            <1> 		mov cx, [esi + 8]
  3899 00002DDD 6689CB              <1> 		mov bx, cx
  3900 00002DE0 6681C31000          <1> 		add bx, 16
  3901 00002DE5 813D[5D2A0000]0100- <1> 		cmp dword [dragging], 1
  3902 00002DED 0000                <1>
  3903 00002DEF 746D                <1> 		je dragwin
  3904 00002DF1 813D[5D2A0000]0000- <1> 		cmp dword [dragging], 0
  3905 00002DF9 0000                <1>
  3906 00002DFB 7411                <1> 		je nodragwincheck
  3907 00002DFD 3935[5D2A0000]      <1> 		cmp dword [dragging], esi
  3908 00002E03 0F8505010000        <1> 		jne near nexticonsel
  3909 00002E09 E950000000          <1> 		jmp dragwin
  3910                              <1> 	nodragwincheck:
  3911 00002E0E 663905[74260000]    <1> 		cmp [mousecursorposition], ax
  3912 00002E15 0F82F3000000        <1> 		jb near nexticonsel
  3913 00002E1B 660307              <1> 		add ax, [edi]
  3914 00002E1E 660307              <1> 		add ax, [edi]
  3915 00002E21 663905[74260000]    <1> 		cmp [mousecursorposition], ax
  3916 00002E28 0F87E0000000        <1> 		ja near nexticonsel
  3917 00002E2E 66390D[76260000]    <1> 		cmp [mousecursorposition + 2], cx
  3918 00002E35 0F82D3000000        <1> 		jb near nexticonsel
  3919 00002E3B 66391D[76260000]    <1> 		cmp [mousecursorposition + 2], bx
  3920 00002E42 0F87C6000000        <1> 		ja near nexticonsel
  3921 00002E48 662D1400            <1> 		sub ax, 20
  3922 00002E4C 663905[74260000]    <1> 		cmp [mousecursorposition], ax
  3923 00002E53 0F8795000000        <1> 		ja near killwin
  3924 00002E59 E97C000000          <1> 		jmp nodragwin
  3925                              <1> 	dragwin:
  3926 00002E5E 663905[70260000]    <1> 		cmp [lastmouseposition], ax
  3927 00002E65 0F82A3000000        <1> 		jb near nexticonsel
  3928 00002E6B 660307              <1> 		add ax, [edi]
  3929 00002E6E 660307              <1> 		add ax, [edi]
  3930 00002E71 663905[70260000]    <1> 		cmp [lastmouseposition], ax
  3931 00002E78 0F8790000000        <1> 		ja near nexticonsel
  3932 00002E7E 66390D[72260000]    <1> 		cmp [lastmouseposition + 2], cx
  3933 00002E85 0F8283000000        <1> 		jb near nexticonsel
  3934 00002E8B 66391D[72260000]    <1> 		cmp [lastmouseposition + 2], bx
  3935 00002E92 0F8776000000        <1> 		ja near nexticonsel
  3936 00002E98 8935[5D2A0000]      <1> 		mov [dragging], esi
  3937 00002E9E 662B15[70260000]    <1> 		sub dx, [lastmouseposition]
  3938 00002EA5 660315[74260000]    <1> 		add dx, [mousecursorposition]
  3939 00002EAC 66030D[76260000]    <1> 		add cx, [mousecursorposition + 2]
  3940 00002EB3 662B0D[72260000]    <1> 		sub cx, [lastmouseposition + 2]
  3941 00002EBA 663B15[43370000]    <1> 		cmp dx, [resolutionx2]
  3942 00002EC1 7607                <1> 		jbe chkyresdrgwin
  3943 00002EC3 668B15[74260000]    <1> 		mov dx, [mousecursorposition]
  3944                              <1> 	chkyresdrgwin:
  3945 00002ECA 663B0D[3F370000]    <1> 		cmp cx, [resolutiony]
  3946 00002ED1 7607                <1> 		jbe nodragwin
  3947 00002ED3 668B0D[76260000]    <1> 		mov cx, [mousecursorposition + 2]
  3948                              <1> 	nodragwin:
  3949 00002EDA 8B5E0C              <1> 		mov ebx, [esi + 12]
  3950 00002EDD 668B460A            <1> 		mov ax, [esi + 10]
  3951 00002EE1 8B7602              <1> 		mov esi, [esi + 2]
  3952 00002EE4 E853040000          <1> 		call showwindow
  3953 00002EE9 E939000000          <1> 		jmp doneiconsel
  3954                              <1> 	killwin:
  3955 00002EEE 66C7060000          <1> 		mov word [esi], 0
  3956 00002EF3 C705[58030000]0000- <1> 		mov dword [user2codepoint], 0
  3957 00002EFB 0000                <1>
  3958 00002EFD C605[99090000]00    <1> 		mov byte [termguion], 0
  3959 00002F04 E881F8FFFF          <1> 		call guiclear
  3960 00002F09 E939000000          <1> 		jmp doneiconsel2
  3961                              <1> 	nexticonsel:
  3962 00002F0E 6681660AFEFF        <1> 		and word [esi + 10], 0xFFFE
  3963 00002F14 81C610000000        <1> 		add esi, 16
  3964 00002F1A 81FE[00120000]      <1> 		cmp esi, graphicstableend
  3965 00002F20 7305                <1> 		jae doneiconsel
  3966 00002F22 E9B6FBFFFF          <1> 		jmp clicon2
  3967                              <1> 	doneiconsel:
  3968 00002F27 813D[5D2A0000]0100- <1> 		cmp dword [dragging], 1
  3969 00002F2F 0000                <1>
  3970 00002F31 7314                <1> 		jae doneiconsel2
  3971 00002F33 813D[E5390000]0000- <1> 		cmp dword [codepointer], 0
  3972 00002F3B 0000                <1>
  3973 00002F3D 7408                <1> 		je doneiconsel2
  3974 00002F3F 8B1D[E5390000]      <1> 		mov ebx, [codepointer]
  3975 00002F45 FFE3                <1> 		jmp ebx 
  3976                              <1> 	doneiconsel2:
  3977 00002F47 A0[DF230000]        <1> 		mov al, [LBUTTON]
  3978 00002F4C A2[5B2A0000]        <1> 		mov [pLBUTTON], al
  3979 00002F51 A0[E0230000]        <1> 		mov al, [RBUTTON]
  3980 00002F56 A2[5C2A0000]        <1> 		mov [pRBUTTON], al
  3981 00002F5B E8C4F9FFFF          <1> call clearmousecursor
  3982 00002F60 E83C000000          <1> call reloadallgraphics
  3983 00002F65 B900000000          <1> 		mov ecx, 0
  3984 00002F6A BA00000000          <1> 		mov edx, 0
  3985 00002F6F B400                <1> 		mov ah, 0
  3986 00002F71 B080                <1> 		mov al, 128
  3987 00002F73 668B15[74260000]    <1> 		mov dx, [mousecursorposition]
  3988 00002F7A 668B0D[76260000]    <1> 		mov cx, [mousecursorposition + 2]
  3989 00002F81 66BBE738            <1> 		mov bx, 0011100011100111b
  3990 00002F85 C605[20290000]01    <1> 		mov byte [showcursorfonton], 1
  3991 00002F8C E8C2070000          <1> 		call showfontvesa
  3992 00002F91 C605[20290000]00    <1> 		mov byte [showcursorfonton], 0
  3993 00002F98 C3                  <1> 		ret
  3994 00002F99 00000000            <1> lastdrag dw 0,0
  3995 00002F9D 00000000            <1> grpctblpos dw 0,0
  3996                              <1> 
  3997                              <1> reloadallgraphics:
  3998 00002FA1 BF[00100000]        <1> 		mov edi, graphicstable
  3999                              <1> reloadgraphicsloop:
  4000 00002FA6 8B7702              <1> 		mov esi, [edi + 2]
  4001 00002FA9 668B5706            <1> 		mov dx, [edi + 6]
  4002 00002FAD 668B4F08            <1> 		mov cx, [edi + 8]
  4003 00002FB1 668B07              <1> 		mov ax, [edi]
  4004 00002FB4 668B5F0A            <1> 		mov bx, [edi + 10]
  4005 00002FB8 893D[9D2F0000]      <1> 		mov [grpctblpos], edi
  4006 00002FBE 3B3D[5D2A0000]      <1> 		cmp edi, [dragging]
  4007 00002FC4 741E                <1> 		je loadedgraphic
  4008 00002FC6 663D0100            <1> 		cmp ax, 1
  4009 00002FCA 0F8431000000        <1> 		je near icongraphic
  4010 00002FD0 663D0200            <1> 		cmp ax, 2
  4011 00002FD4 0F8437000000        <1> 		je near stringgraphic
  4012 00002FDA 663D0300            <1> 		cmp ax, 3
  4013 00002FDE 0F8416000000        <1> 		je near windowgraphic
  4014 00002FE4 8B3D[9D2F0000]      <1> loadedgraphic:  mov edi, [grpctblpos]
  4015 00002FEA 81C710000000        <1> 		add edi, 16
  4016 00002FF0 81FF[00120000]      <1> 		cmp edi, graphicstableend
  4017 00002FF6 7329                <1> 		jae donereloadgraphics
  4018 00002FF8 EBAC                <1> 		jmp reloadgraphicsloop
  4019 00002FFA E890030000          <1> windowgraphic:	call showwindow2
  4020 00002FFF EBE3                <1> 		jmp loadedgraphic
  4021 00003001 80E301              <1> icongraphic:	and bl, 1
  4022 00003004 881D[E9390000]      <1> 		mov [iconselected], bl
  4023 0000300A E86A060000          <1> 		call showicon2
  4024 0000300F EBD3                <1> 		jmp loadedgraphic
  4025 00003011 80E301              <1> stringgraphic:  and bl, 1
  4026 00003014 881D[22290000]      <1> 		mov [mouseselecton], bl
  4027 0000301A E8DB020000          <1> 		call showstring2
  4028 0000301F EBC3                <1> 		jmp loadedgraphic
  4029                              <1> donereloadgraphics:
  4030 00003021 8B3D[5D2A0000]      <1> 		mov edi, [dragging]
  4031 00003027 81FF[00100000]      <1> 		cmp edi, graphicstable
  4032 0000302D 723B                <1> 		jb notcorrectdrag
  4033 0000302F 668B07              <1> 		mov ax, [edi]
  4034 00003032 8B7702              <1> 		mov esi, [edi + 2]
  4035 00003035 668B5706            <1> 		mov dx, [edi + 6]
  4036 00003039 668B4F08            <1> 		mov cx, [edi + 8]
  4037 0000303D 668B5F0A            <1> 		mov bx, [edi + 10]
  4038 00003041 663D0100            <1> 		cmp ax, 1
  4039 00003045 750F                <1> 		jne noticondragging
  4040 00003047 80E301              <1> 		and bl, 1
  4041 0000304A 881D[E9390000]      <1> 		mov [iconselected], bl
  4042 00003050 E824060000          <1> 		call showicon2
  4043 00003055 C3                  <1> 		ret
  4044                              <1> 
  4045                              <1> 	noticondragging:
  4046 00003056 663D0200            <1> 		cmp ax, 2
  4047 0000305A 750E                <1> 		jne notcorrectdrag
  4048 0000305C 80E301              <1> 		and bl, 1
  4049 0000305F 881D[22290000]      <1> 		mov [mouseselecton], bl
  4050 00003065 E890020000          <1> 		call showstring2
  4051                              <1> 	notcorrectdrag:
  4052 0000306A C3                  <1> 		ret
  4053                              <1> 
  4054 0000306B 00<rept>            <1> grphbuf times 16 db 0
  4055                              <1> 	graphicsadd:
  4056 0000307B BF[00100000]        <1> 		mov edi, graphicstable
  4057                              <1> 	shwgrph1:
  4058 00003080 397702              <1> 		cmp dword [edi + 2], esi
  4059 00003083 7414                <1> 		je showgraphicsreplace2
  4060 00003085 81C710000000        <1> 		add edi, 16
  4061 0000308B 81FF[00120000]      <1> 		cmp edi, graphicstableend
  4062 00003091 0F8335020000        <1> 		jae near showgraphicsnew
  4063 00003097 EBE7                <1> 		jmp shwgrph1
  4064                              <1> 	showgraphicsreplace2:
  4065 00003099 8935[6D300000]      <1> 		mov [grphbuf + 2], esi
  4066 0000309F 668915[71300000]    <1> 		mov [grphbuf + 6], dx
  4067 000030A6 66890D[73300000]    <1> 		mov [grphbuf + 8], cx
  4068 000030AD 891D[77300000]      <1> 		mov [grphbuf + 12], ebx
  4069 000030B3 B700                <1> 		mov bh, 0
  4070 000030B5 88E3                <1> 		mov bl, ah
  4071 000030B7 B400                <1> 		mov ah, 0
  4072 000030B9 66A3[75300000]      <1> 		mov [grphbuf + 10], ax	
  4073 000030BF 66891D[6B300000]    <1> 		mov [grphbuf], bx
  4074 000030C6 66A1[6B300000]      <1> 		mov ax, [grphbuf]
  4075 000030CC 663D0100            <1> 		cmp ax, 1
  4076 000030D0 0F8419000000        <1> 		je near replaceicon
  4077 000030D6 663D0200            <1> 		cmp ax, 2
  4078 000030DA 0F8493000000        <1> 		je near replacestring
  4079 000030E0 663D0300            <1> 		cmp ax, 3
  4080 000030E4 0F840F010000        <1> 		je near replacewindow
  4081 000030EA E9BA010000          <1> 		jmp showgraphicsreplace
  4082                              <1> 	replaceicon:
  4083 000030EF 893D[612A0000]      <1> 		mov [lastpos], edi
  4084 000030F5 8935[652A0000]      <1> 		mov [lastpos + 4], esi
  4085 000030FB 8B7702              <1> 		mov esi, [edi + 2]
  4086 000030FE 668B5F0C            <1> 		mov bx, [edi + 12]
  4087 00003102 668B5706            <1> 		mov dx, [edi + 6]
  4088 00003106 668B4F08            <1> 		mov cx, [edi + 8]
  4089 0000310A 668B06              <1> 		mov ax, [esi]
  4090 0000310D 66A3[692A0000]      <1> 		mov [colorbuf], ax
  4091 00003113 66A1[C7270000]      <1> 		mov ax, [background]
  4092 00003119 668906              <1> 		mov [esi], ax
  4093 0000311C 8B5F0C              <1> 		mov ebx, [edi + 12]
  4094 0000311F 668B470A            <1> 		mov ax, [edi + 10]
  4095 00003123 2401                <1> 		and al, 1
  4096 00003125 A2[E9390000]        <1> 		mov [iconselected], al
  4097 0000312A 668B470A            <1> 		mov ax, [edi + 10]
  4098 0000312E E846050000          <1> 		call showicon2
  4099 00003133 8B3D[612A0000]      <1> 		mov edi, [lastpos]
  4100 00003139 8B7702              <1> 		mov esi, [edi + 2]
  4101 0000313C 66A1[692A0000]      <1> 		mov ax, [colorbuf]
  4102 00003142 668906              <1> 		mov [esi], ax
  4103 00003145 8B35[652A0000]      <1> 		mov esi, [lastpos + 4]
  4104 0000314B 668B15[71300000]    <1> 		mov dx, [grphbuf + 6]
  4105 00003152 668B0D[73300000]    <1> 		mov cx, [grphbuf + 8]
  4106 00003159 668B1D[6B300000]    <1> 		mov bx, [grphbuf]
  4107 00003160 66A1[75300000]      <1> 		mov ax, [grphbuf + 10]
  4108 00003166 88DC                <1> 		mov ah, bl
  4109 00003168 8B1D[77300000]      <1> 		mov ebx, [grphbuf + 12]
  4110 0000316E E936010000          <1> 		jmp showgraphicsreplace
  4111                              <1> 	replacestring:
  4112 00003173 893D[612A0000]      <1> 		mov [lastpos], edi
  4113 00003179 8935[652A0000]      <1> 		mov [lastpos + 4], esi
  4114 0000317F 8B5F0C              <1> 		mov ebx, [edi + 12]
  4115 00003182 8B7702              <1> 		mov esi, [edi + 2]
  4116 00003185 668B5706            <1> 		mov dx, [edi + 6]
  4117 00003189 668B4F08            <1> 		mov cx, [edi + 8]
  4118 0000318D 66A1[2A330000]      <1> 		mov ax, [colorfont2]
  4119 00003193 66A3[692A0000]      <1> 		mov [colorbuf], ax
  4120 00003199 66A1[C7270000]      <1> 		mov ax, [background]
  4121 0000319F 66A3[2A330000]      <1> 		mov [colorfont2], ax		
  4122 000031A5 8B5F0C              <1> 		mov ebx, [edi + 12]
  4123 000031A8 668B470A            <1> 		mov ax, [edi + 10]
  4124 000031AC 2401                <1> 		and al, 1
  4125 000031AE A2[22290000]        <1> 		mov [mouseselecton], al
  4126 000031B3 668B470A            <1> 		mov ax, [edi + 10]
  4127 000031B7 E83E010000          <1> 		call showstring2
  4128 000031BC 66A1[692A0000]      <1> 		mov ax, [colorbuf]
  4129 000031C2 66A3[2A330000]      <1> 		mov [colorfont2], ax
  4130 000031C8 8B3D[612A0000]      <1> 		mov edi, [lastpos]
  4131 000031CE 8B7702              <1> 		mov esi, [edi + 2]
  4132 000031D1 668B15[71300000]    <1> 		mov dx, [grphbuf + 6]
  4133 000031D8 668B0D[73300000]    <1> 		mov cx, [grphbuf + 8]
  4134 000031DF 668B1D[6B300000]    <1> 		mov bx, [grphbuf]
  4135 000031E6 66A1[75300000]      <1> 		mov ax, [grphbuf + 10]
  4136 000031EC 88DC                <1> 		mov ah, bl
  4137 000031EE 8B1D[77300000]      <1> 		mov ebx, [grphbuf + 12]
  4138 000031F4 E9B0000000          <1> 		jmp showgraphicsreplace
  4139                              <1> 	replacewindow:
  4140 000031F9 893D[612A0000]      <1> 		mov [lastpos], edi
  4141 000031FF 8935[652A0000]      <1> 		mov [lastpos + 4], esi
  4142 00003205 8B7702              <1> 		mov esi, [edi + 2]
  4143 00003208 8B3D[38330000]      <1> 		mov edi, [windowbufloc]
  4144 0000320E BA00000000          <1> 		mov edx, 0
  4145 00003213 668B15[43370000]    <1> 		mov dx, [resolutionx2]
  4146 0000321A C1E204              <1> 		shl edx, 4
  4147 0000321D 29D7                <1> 		sub edi, edx
  4148 0000321F BA00000000          <1> 		mov edx, 0
  4149 00003224 668B16              <1> 		mov dx, [esi]
  4150 00003227 660316              <1> 		add dx, [esi]
  4151 0000322A 668B4E02            <1> 		mov cx, [esi + 2]
  4152 0000322E 6681C11000          <1> 		add cx, 16
  4153 00003233 66A1[C7270000]      <1> 		mov ax, [background]
  4154                              <1> 	clearwindow:
  4155 00003239 668907              <1> 		mov [edi], ax
  4156 0000323C 81C702000000        <1> 		add edi, 2
  4157 00003242 81EA02000000        <1> 		sub edx, 2
  4158 00003248 81FA00000000        <1> 		cmp edx, 0
  4159 0000324E 75E9                <1> 		jne clearwindow
  4160 00003250 6649                <1> 		dec cx
  4161 00003252 668B15[43370000]    <1> 		mov dx, [resolutionx2]
  4162 00003259 662B16              <1> 		sub dx, [esi]
  4163 0000325C 662B16              <1> 		sub dx, [esi]
  4164 0000325F 01D7                <1> 		add edi, edx
  4165 00003261 668B16              <1> 		mov dx, [esi]
  4166 00003264 660316              <1> 		add dx, [esi]
  4167 00003267 6681F90000          <1> 		cmp cx, 0
  4168 0000326C 75CB                <1> 		jne clearwindow
  4169 0000326E C605[9A090000]00    <1> 		mov byte [termcopyon], 0
  4170 00003275 8B3D[612A0000]      <1> 		mov edi, [lastpos]
  4171 0000327B 8B35[6D300000]      <1> 		mov esi, [grphbuf + 2]
  4172 00003281 668B15[71300000]    <1> 		mov dx, [grphbuf + 6]
  4173 00003288 668B0D[73300000]    <1> 		mov cx, [grphbuf + 8]
  4174 0000328F 668B1D[6B300000]    <1> 		mov bx, [grphbuf]
  4175 00003296 66A1[75300000]      <1> 		mov ax, [grphbuf + 10]
  4176 0000329C 88DC                <1> 		mov ah, bl
  4177 0000329E 8B1D[77300000]      <1> 		mov ebx, [grphbuf + 12]
  4178 000032A4 E900000000          <1> 		jmp showgraphicsreplace
  4179                              <1> 	showgraphicsreplace:
  4180 000032A9 897702              <1> 		mov [edi + 2], esi
  4181 000032AC 66895706            <1> 		mov [edi + 6], dx
  4182 000032B0 66894F08            <1> 		mov [edi + 8], cx
  4183 000032B4 895F0C              <1> 		mov [edi + 12], ebx
  4184 000032B7 B700                <1> 		mov bh, 0
  4185 000032B9 88E3                <1> 		mov bl, ah
  4186 000032BB B400                <1> 		mov ah, 0
  4187 000032BD 6689470A            <1> 		mov [edi + 10], ax
  4188 000032C1 66891F              <1> 		mov [edi], bx
  4189 000032C4 8B5F0C              <1> 		mov ebx, [edi + 12]
  4190 000032C7 668B470A            <1> 		mov ax, [edi + 10]
  4191 000032CB C3                  <1> 		ret
  4192                              <1> 	showgraphicsnew:
  4193 000032CC BF[00100000]        <1> 		mov edi, graphicstable
  4194                              <1> 	shwgrph2:
  4195 000032D1 66813F0000          <1> 		cmp word [edi], 0
  4196 000032D6 74D1                <1> 		je showgraphicsreplace
  4197 000032D8 81C710000000        <1> 		add edi, 16
  4198 000032DE 81FF[00120000]      <1> 		cmp edi, graphicstableend
  4199 000032E4 72EB                <1> 		jb shwgrph2
  4200                              <1> 	showgraphicsdone:
  4201 000032E6 C3                  <1> 		ret
  4202                              <1> 
  4203                              <1> 	showstring:
  4204 000032E7 A2[22290000]        <1> 		mov [mouseselecton], al
  4205 000032EC 8025[22290000]01    <1> 		and byte [mouseselecton], 1
  4206 000032F3 B402                <1> 		mov ah, 2
  4207 000032F5 E881FDFFFF          <1> 		call graphicsadd
  4208                              <1> 	showstring2:
  4209 000032FA B400                <1> 		mov ah, 0
  4210 000032FC 8A06                <1> 		mov al, [esi]
  4211 000032FE 3C00                <1> 		cmp al, 0
  4212 00003300 7420                <1> 		je doneshowstring
  4213 00003302 46                  <1> 		inc esi
  4214 00003303 8935[92390000]      <1> 		mov [showstringesi], esi
  4215 00003309 668B1D[2A330000]    <1> 		mov bx, [colorfont2]
  4216 00003310 E83E040000          <1> 		call showfontvesa
  4217 00003315 6681C20800          <1> 		add dx, 8
  4218 0000331A 8B35[92390000]      <1> 		mov esi, [showstringesi]
  4219 00003320 EBD8                <1> 		jmp showstring2
  4220                              <1> 	doneshowstring:
  4221 00003322 C605[22290000]00    <1> 		mov byte [mouseselecton], 0
  4222 00003329 C3                  <1> 		ret
  4223                              <1> 
  4224 0000332A FFFF                <1> colorfont2 dw 0xFFFF
  4225 0000332C 0000                <1> winvcopystx dw 0
  4226 0000332E 0000                <1> winvcopysty dw 0
  4227 00003330 0000                <1> winvcopydx dw 0
  4228 00003332 0000                <1> winvcopycx dw 0
  4229 00003334 FFFF0000            <1> windowcolor dw 0xFFFF,0x0
  4230 00003338 00000000            <1> windowbufloc: dw 0,0
  4231                              <1> 
  4232                              <1> 	showwindow:	;;windowstuff in si, position in (dx, cx), nothing in ax, code in bx
  4233 0000333C C605[99090000]01    <1> 		mov byte [termguion], 1
  4234 00003343 6681C11000          <1> 		add cx, 16
  4235 00003348 668915[2C330000]    <1> 		mov [winvcopystx], dx
  4236 0000334F 66890D[2E330000]    <1> 		mov [winvcopysty], cx
  4237 00003356 668B16              <1> 		mov dx, [esi]
  4238 00003359 668B4E02            <1> 		mov cx, [esi + 2]
  4239 0000335D 6601D2              <1> 		add dx, dx
  4240 00003360 668915[30330000]    <1> 		mov [winvcopydx], dx
  4241 00003367 66890D[32330000]    <1> 		mov [winvcopycx], cx
  4242 0000336E 668B0D[2E330000]    <1> 		mov cx, [winvcopysty]
  4243 00003375 6681E91000          <1> 		sub cx, 16
  4244 0000337A 668B15[2C330000]    <1> 		mov dx, [winvcopystx]
  4245 00003381 C605[9A090000]00    <1> 		mov byte [termcopyon], 0
  4246 00003388 B403                <1> 		mov ah, 3
  4247 0000338A E8ECFCFFFF          <1> 		call graphicsadd
  4248                              <1> 	showwindow2:
  4249 0000338F 6681C11000          <1> 		add cx, 16
  4250 00003394 668915[2C330000]    <1> 		mov [winvcopystx], dx
  4251 0000339B 66890D[2E330000]    <1> 		mov [winvcopysty], cx
  4252 000033A2 668B16              <1> 		mov dx, [esi]
  4253 000033A5 668B4E02            <1> 		mov cx, [esi + 2]
  4254 000033A9 6601D2              <1> 		add dx, dx
  4255 000033AC 668915[30330000]    <1> 		mov [winvcopydx], dx
  4256 000033B3 66890D[32330000]    <1> 		mov [winvcopycx], cx
  4257 000033BA 8B3D[38330000]      <1> 		mov edi, [windowbufloc]
  4258 000033C0 BA00000000          <1> 		mov edx, 0
  4259 000033C5 668B15[43370000]    <1> 		mov dx, [resolutionx2]
  4260 000033CC C1E204              <1> 		shl edx, 4
  4261 000033CF 29D7                <1> 		sub edi, edx
  4262 000033D1 803D[9A090000]00    <1> 		cmp byte [termcopyon], 0
  4263 000033D8 753E                <1> 		jne nocleartitlebarpos
  4264 000033DA 8B3D[EC4B0000]      <1> 		mov edi, [physbaseptr]
  4265 000033E0 BA00000000          <1> 		mov edx, 0
  4266 000033E5 668B15[2C330000]    <1> 		mov dx, [winvcopystx]
  4267 000033EC 01D7                <1> 		add edi, edx
  4268 000033EE 668B0D[2E330000]    <1> 		mov cx, [winvcopysty]
  4269 000033F5 6681E91000          <1> 		sub cx, 16
  4270 000033FA 6681F90000          <1> 		cmp cx, 0
  4271 000033FF 7417                <1> 		je nocleartitlebarpos
  4272                              <1> 	cleartitlebarpos:
  4273 00003401 BA00000000          <1> 		mov edx, 0
  4274 00003406 668B15[43370000]    <1> 		mov dx, [resolutionx2]
  4275 0000340D 01D7                <1> 		add edi, edx
  4276 0000340F 6649                <1> 		dec cx
  4277 00003411 6681F90000          <1> 		cmp cx, 0
  4278 00003416 75E9                <1> 		jne cleartitlebarpos
  4279                              <1> 	nocleartitlebarpos:
  4280 00003418 66B91000            <1> 		mov cx, 16
  4281 0000341C 668B15[30330000]    <1> 		mov dx, [winvcopydx]
  4282 00003423 6681F90000          <1> 		cmp cx, 0
  4283 00003428 0F844B000000        <1> 		je near canceltitlebarput
  4284 0000342E 6681FA0000          <1> 		cmp dx, 0
  4285 00003433 0F8440000000        <1> 		je near canceltitlebarput
  4286                              <1> 	titlebarput:
  4287 00003439 66A1[34330000]      <1> 		mov ax, [windowcolor]
  4288 0000343F 668907              <1> 		mov [edi], ax
  4289 00003442 6681EA0200          <1> 		sub dx, 2
  4290 00003447 81C702000000        <1> 		add edi, 2
  4291 0000344D 6681FA0000          <1> 		cmp dx, 0
  4292 00003452 75E5                <1> 		jne titlebarput
  4293 00003454 BA00000000          <1> 		mov edx, 0
  4294 00003459 668B15[43370000]    <1> 		mov dx, [resolutionx2]
  4295 00003460 6649                <1> 		dec cx
  4296 00003462 662B15[30330000]    <1> 		sub dx, [winvcopydx]
  4297 00003469 01D7                <1> 		add edi, edx
  4298 0000346B 668B15[30330000]    <1> 		mov dx, [winvcopydx]
  4299 00003472 6681F90000          <1> 		cmp cx, 0
  4300 00003477 75C0                <1> 		jne titlebarput
  4301                              <1> 	canceltitlebarput:
  4302 00003479 893D[38330000]      <1> 		mov [windowbufloc], edi
  4303 0000347F 803D[9A090000]02    <1> 		cmp byte [termcopyon], 2
  4304 00003486 0F8463000000        <1> 		je near winvcpst
  4305 0000348C 66B80000            <1> 		mov ax, 0
  4306 00003490 81C604000000        <1> 		add esi, 4
  4307 00003496 668B15[2C330000]    <1> 		mov dx, [winvcopystx]
  4308 0000349D 668B0D[2E330000]    <1> 		mov cx, [winvcopysty]
  4309 000034A4 6681E91000          <1> 		sub cx, 16
  4310 000034A9 66BB0000            <1> 		mov bx, 0
  4311 000034AD C605[22290000]01    <1> 		mov byte [mouseselecton], 1
  4312 000034B4 E841FEFFFF          <1> 		call showstring2
  4313 000034B9 B058                <1> 		mov al, "X"
  4314 000034BB B400                <1> 		mov ah, 0
  4315 000034BD 668B1D[2A330000]    <1> 		mov bx, [colorfont2]
  4316 000034C4 668B15[2C330000]    <1> 		mov dx, [winvcopystx]
  4317 000034CB 668B0D[2E330000]    <1> 		mov cx, [winvcopysty]
  4318 000034D2 6681E91000          <1> 		sub cx, 16
  4319 000034D7 6681EA1400          <1> 		sub dx, 20
  4320 000034DC 660315[30330000]    <1> 		add dx, [winvcopydx]
  4321 000034E3 C605[22290000]01    <1> 		mov byte [mouseselecton], 1
  4322 000034EA E864020000          <1> 		call showfontvesa
  4323                              <1> 	winvcpst:
  4324 000034EF 8B3D[38330000]      <1> 		mov edi, [windowbufloc]
  4325 000034F5 E957000000          <1> 		jmp windowvideocopyset
  4326                              <1> 
  4327                              <1> 	windowvideocopy:
  4328 000034FA 8B3D[38330000]      <1> 		mov edi, [windowbufloc]
  4329 00003500 3B3D[EC4B0000]      <1> 		cmp edi, [physbaseptr]
  4330 00003506 0F8345000000        <1> 		jae near windowvideocopyset
  4331 0000350C B900000000          <1> 		mov ecx, 0
  4332 00003511 BA00000000          <1> 		mov edx, 0
  4333 00003516 668B15[2C330000]    <1> 		mov dx, [winvcopystx]
  4334 0000351D 668B0D[2E330000]    <1> 		mov cx, [winvcopysty]
  4335 00003524 8B3D[EC4B0000]      <1> 		mov edi, [physbaseptr]
  4336 0000352A 01D7                <1> 		add edi, edx
  4337 0000352C 81F900000000        <1> 		cmp ecx, 0
  4338 00003532 741D                <1> 		je windowvideocopyset
  4339                              <1> 	yrescopylp:
  4340 00003534 BA00000000          <1> 		mov edx, 0
  4341 00003539 668B15[43370000]    <1> 		mov dx, [resolutionx2]
  4342 00003540 01D7                <1> 		add edi, edx
  4343 00003542 6649                <1> 		dec cx
  4344 00003544 6681F90000          <1> 		cmp cx, 0
  4345 00003549 75E9                <1> 		jne yrescopylp
  4346 0000354B 893D[38330000]      <1> 		mov [windowbufloc], edi
  4347                              <1> 	windowvideocopyset:
  4348 00003551 66B90000            <1> 		mov cx, 0
  4349 00003555 66890D[5E360000]    <1> 		mov [charposline], cx
  4350 0000355C BE[851C0000]        <1> 		mov esi, videobuf2
  4351 00003561 8935[60360000]      <1> 		mov [charposvbuf], esi
  4352 00003567 8A1E                <1> 		mov bl, [esi]
  4353 00003569 B700                <1> 		mov bh, 0
  4354 0000356B 66C1E304            <1> 		shl bx, 4
  4355 0000356F 678AB7[A441]        <1> 		mov dh, [fonts + bx]
  4356 00003574 D0CE                <1> 		ror dh, 1
  4357 00003576 89FE                <1> 		mov esi, edi
  4358                              <1> 	copywindow:
  4359 00003578 B201                <1> 		mov dl, 1
  4360 0000357A D0C6                <1> 		rol dh, 1
  4361 0000357C 20F2                <1> 		and dl, dh
  4362 0000357E 66A1[36330000]      <1> 		mov ax, [windowcolor + 2]
  4363 00003584 668907              <1> 		mov [edi], ax
  4364 00003587 80FA00              <1> 		cmp dl, 0
  4365 0000358A 7409                <1> 		je nowritewin
  4366 0000358C 66A1[34330000]      <1> 		mov ax, [windowcolor]
  4367 00003592 668907              <1> 		mov [edi], ax
  4368                              <1> 	nowritewin:
  4369 00003595 81C702000000        <1> 		add edi, 2
  4370 0000359B FEC1                <1> 		inc cl
  4371 0000359D 80F908              <1> 		cmp cl, 8
  4372 000035A0 75D6                <1> 		jne copywindow
  4373 000035A2 6643                <1> 		inc bx
  4374 000035A4 B100                <1> 		mov cl, 0
  4375 000035A6 BA00000000          <1> 		mov edx, 0
  4376 000035AB 668B15[43370000]    <1> 		mov dx, [resolutionx2]
  4377 000035B2 01D6                <1> 		add esi, edx
  4378 000035B4 89F7                <1> 		mov edi, esi
  4379 000035B6 678AB7[A441]        <1> 		mov dh, [fonts + bx]
  4380 000035BB D0CE                <1> 		ror dh, 1
  4381 000035BD FEC5                <1> 		inc ch
  4382 000035BF 80FD10              <1> 		cmp ch, 16
  4383 000035C2 75B4                <1> 		jne copywindow
  4384 000035C4 66B90000            <1> 		mov cx, 0
  4385 000035C8 8B3D[60360000]      <1> 		mov edi, [charposvbuf]
  4386 000035CE 81C702000000        <1> 		add edi, 2
  4387 000035D4 81FF[452F0000]      <1> 		cmp edi, videobufend
  4388 000035DA 7370                <1> 		jae donewincopynow
  4389 000035DC 8A1F                <1> 		mov bl, [edi]
  4390 000035DE B700                <1> 		mov bh, 0
  4391 000035E0 66C1E304            <1> 		shl bx, 4
  4392 000035E4 893D[60360000]      <1> 		mov [charposvbuf], edi
  4393 000035EA BA00000000          <1> 		mov edx, 0
  4394 000035EF 668B15[43370000]    <1> 		mov dx, [resolutionx2]
  4395 000035F6 C1E204              <1> 		shl edx, 4
  4396 000035F9 29D6                <1> 		sub esi, edx
  4397 000035FB 81C610000000        <1> 		add esi, 16
  4398 00003601 89F7                <1> 		mov edi, esi
  4399 00003603 668B0D[5E360000]    <1> 		mov cx, [charposline]
  4400 0000360A 6641                <1> 		inc cx
  4401 0000360C 6681F95000          <1> 		cmp cx, 80
  4402 00003611 7317                <1> 		jae fixwindowcopy
  4403 00003613 66890D[5E360000]    <1> 		mov [charposline], cx
  4404 0000361A 66B90000            <1> 		mov cx, 0
  4405 0000361E 678AB7[A441]        <1> 		mov dh, [fonts + bx]
  4406 00003623 D0CE                <1> 		ror dh, 1
  4407 00003625 E94EFFFFFF          <1> 		jmp copywindow
  4408                              <1> fixwindowcopy:
  4409 0000362A 66B90000            <1> 		mov cx, 0
  4410 0000362E 66890D[5E360000]    <1> 		mov [charposline], cx
  4411 00003635 662B15[30330000]    <1> 		sub dx, [winvcopydx]
  4412 0000363C 01D6                <1> 		add esi, edx
  4413 0000363E 89F7                <1> 		mov edi, esi
  4414 00003640 678AB7[A441]        <1> 		mov dh, [fonts + bx]
  4415 00003645 D0CE                <1> 		ror dh, 1
  4416 00003647 E92CFFFFFF          <1> 		jmp copywindow
  4417                              <1> donewincopynow:
  4418 0000364C 803D[9A090000]01    <1> 		cmp byte [termcopyon], 1
  4419 00003653 7501                <1> 		jne forgetresetstuff
  4420 00003655 61                  <1> 		popa
  4421                              <1> forgetresetstuff:
  4422 00003656 C605[9A090000]00    <1> 		mov byte [termcopyon], 0
  4423 0000365D C3                  <1> 		ret
  4424                              <1> 
  4425 0000365E 0000                <1> charposline dw 0
  4426 00003660 00000000            <1> charposvbuf dw 0,0
  4427 00003664 0000                <1> iconcolor dw 0
  4428                              <1> 	showicon:	;;icon in si, position in (dx,cx), selected in ax, code in bx
  4429 00003666 A2[E9390000]        <1> 		mov [iconselected], al
  4430 0000366B 8025[E9390000]01    <1> 		and byte [iconselected], 1
  4431 00003672 B401                <1> 		mov ah, 1
  4432 00003674 E802FAFFFF          <1> 		call graphicsadd
  4433                              <1> 	showicon2:
  4434 00003679 8B3D[EC4B0000]      <1> 		mov edi, [physbaseptr]
  4435 0000367F 6601D2              <1> 		add dx, dx
  4436 00003682 663B15[43370000]    <1> 		cmp dx, [resolutionx2]
  4437 00003689 720C                <1> 		jb screenxgood
  4438 0000368B 668B15[43370000]    <1> 		mov dx, [resolutionx2]
  4439 00003692 6681EA4000          <1> 		sub dx, 64
  4440                              <1> 	screenxgood:
  4441 00003697 6681F90000          <1> 		cmp cx, 0
  4442 0000369C 7425                <1> 		je noscreenygoodchk
  4443 0000369E 663B0D[3F370000]    <1> 		cmp cx, [resolutiony]
  4444 000036A5 720C                <1> 		jb screenygood
  4445 000036A7 668B0D[3F370000]    <1> 		mov cx, [resolutiony]
  4446 000036AE 6681E92000          <1> 		sub cx, 32
  4447                              <1> 	screenygood:
  4448 000036B3 BB00000000          <1> 		mov ebx, 0
  4449 000036B8 668B1D[43370000]    <1> 		mov bx, [resolutionx2]
  4450 000036BF 01DF                <1> 		add edi, ebx
  4451 000036C1 E2F0                <1> 		loop screenygood
  4452                              <1> 	noscreenygoodchk:
  4453 000036C3 BB00000000          <1> 		mov ebx, 0
  4454 000036C8 6689D3              <1> 		mov bx, dx
  4455 000036CB 01DF                <1> 		add edi, ebx
  4456 000036CD 66B90000            <1> 		mov cx, 0
  4457 000036D1 668B06              <1> 		mov ax, [esi]
  4458 000036D4 81C602000000        <1> 		add esi, 2
  4459 000036DA 66A3[64360000]      <1> 		mov [iconcolor], ax
  4460                              <1> 	writeicon:
  4461 000036E0 8B06                <1> 		mov eax, [esi]
  4462 000036E2 D1C0                <1> 		rol eax, 1
  4463 000036E4 B100                <1> 		mov cl, 0
  4464                              <1> 	writeiconline:
  4465 000036E6 B201                <1> 		mov dl, 1
  4466 000036E8 20C2                <1> 		and dl, al
  4467 000036EA 3215[E9390000]      <1> 		xor dl, [iconselected]
  4468 000036F0 668B1D[C7270000]    <1> 		mov bx, [background]
  4469 000036F7 66891F              <1> 		mov [edi], bx
  4470 000036FA 80FA00              <1> 		cmp dl, 0
  4471 000036FD 740A                <1> 		je noiconline
  4472 000036FF 668B15[64360000]    <1> 		mov dx, [iconcolor]
  4473 00003706 668917              <1> 		mov [edi], dx
  4474                              <1> 	noiconline:
  4475 00003709 81C702000000        <1> 		add edi, 2
  4476 0000370F D1C0                <1> 		rol eax, 1
  4477 00003711 FEC1                <1> 		inc cl
  4478 00003713 80F920              <1> 		cmp cl, 32
  4479 00003716 72CE                <1> 		jb writeiconline
  4480 00003718 81C604000000        <1> 		add esi, 4
  4481 0000371E FEC5                <1> 		inc ch
  4482 00003720 BA00000000          <1> 		mov edx, 0
  4483 00003725 668B15[43370000]    <1> 		mov dx, [resolutionx2]
  4484 0000372C 01D7                <1> 		add edi, edx
  4485 0000372E 81EF40000000        <1> 		sub edi, 64
  4486 00003734 80FD20              <1> 		cmp ch, 32
  4487 00003737 72A7                <1> 		jb writeicon
  4488 00003739 B800000000          <1> 		mov eax, 0
  4489 0000373E C3                  <1> 		ret
  4490                              <1> 
  4491 0000373F 0000                <1> resolutiony dw 0
  4492 00003741 0000                <1> resolutionx dw 0
  4493 00003743 0000                <1> resolutionx2 dw 0
  4494 00003745 02                  <1> resolutionbytes db 2
  4495 00003746 0000                <1> posxvesa dw 0
  4496 00003748 0000                <1> posyvesa dw 0
  4497 0000374A FFFF                <1> colorfont dw 0xFFFF
  4498                              <1> savefontvesa:		;;same rules as showfontvesa
  4499 0000374C C605[21290000]01    <1> 	mov byte [savefonton], 1
  4500                              <1> showfontvesa:		;;position in (dx,cx), color in bx, char in al
  4501 00003753 66890D[48370000]    <1> 	mov [posyvesa], cx
  4502 0000375A 668915[46370000]    <1> 	mov [posxvesa], dx
  4503 00003761 8B3D[EC4B0000]      <1> 	mov edi, [physbaseptr]
  4504 00003767 66891D[4A370000]    <1> 	mov [colorfont], bx
  4505 0000376E BB00000000          <1> 	mov ebx, 0
  4506 00003773 88C3                <1> 	mov bl, al
  4507 00003775 B800000000          <1> 	mov eax, 0
  4508 0000377A 88D8                <1> 	mov al, bl
  4509 0000377C 6689D3              <1> 	mov bx, dx
  4510 0000377F 89DA                <1> 	mov edx, ebx
  4511 00003781 BB00000000          <1> 	mov ebx, 0
  4512 00003786 6681F90000          <1> 	cmp cx, 0
  4513 0000378B 7415                <1> 	je vesaposloopdn
  4514 0000378D 668B1D[43370000]    <1> 	mov bx, [resolutionx2]
  4515                              <1> vesaposloop:
  4516 00003794 01DA                <1> 	add edx, ebx
  4517 00003796 6681E90100          <1> 	sub cx, 1
  4518 0000379B 6681F90000          <1> 	cmp cx, 0
  4519 000037A0 75F2                <1> 	jne vesaposloop
  4520                              <1> vesaposloopdn:
  4521 000037A2 01D7                <1> 	add edi, edx
  4522 000037A4 BE[A4410000]        <1> 	mov esi, fonts
  4523                              <1> findfontvesa:
  4524 000037A9 B400                <1> 	mov ah, 0
  4525 000037AB C1E004              <1> 	shl eax, 4
  4526 000037AE 01C6                <1> 	add esi, eax
  4527 000037B0 C1E804              <1> 	shr eax, 4
  4528 000037B3 81FE[C4490000]      <1> 	cmp esi, fontend
  4529 000037B9 0F83BF000000        <1> 	jae near donefontvesa
  4530 000037BF 4E                  <1> 	dec esi
  4531                              <1> foundfontvesa:
  4532 000037C0 46                  <1> 	inc esi
  4533 000037C1 803D[21290000]01    <1> 	cmp byte [savefonton], 1
  4534 000037C8 0F84E1000000        <1> 	je near vesafontsaver
  4535 000037CE B100                <1> 	mov cl, 0
  4536 000037D0 8A06                <1> 	mov al, [esi]
  4537 000037D2 668B15[43370000]    <1> 	mov dx, [resolutionx2]
  4538 000037D9 662B15[46370000]    <1> 	sub dx, [posxvesa]
  4539 000037E0 6681FA1000          <1> 	cmp dx, 16
  4540 000037E5 7708                <1> 	ja paintfontvesa
  4541 000037E7 D0EA                <1> 	shr dl, 1
  4542 000037E9 8815[AE380000]      <1> 	mov [charwidth], dl
  4543                              <1> paintfontvesa:
  4544 000037EF B201                <1> 	mov dl, 1
  4545 000037F1 20C2                <1> 	and dl, al
  4546 000037F3 803D[20290000]01    <1> 	cmp byte [showcursorfonton], 1
  4547 000037FA 0F8435000000        <1> 	je near nodelpaintedfont
  4548 00003800 803D[20290000]02    <1> 	cmp byte [showcursorfonton], 2
  4549 00003807 0F8518000000        <1> 	jne near noswitchcursorfonton
  4550 0000380D 80FA00              <1> 	cmp dl, 0
  4551 00003810 0F842E000000        <1> 	je near nopixelset
  4552 00003816 668B1D[4A370000]    <1> 	mov bx, [colorfont]
  4553 0000381D 66891F              <1> 	mov [edi], bx
  4554 00003820 E91F000000          <1> 	jmp nopixelset
  4555                              <1> noswitchcursorfonton:
  4556 00003825 3215[22290000]      <1> 	xor dl, [mouseselecton]
  4557 0000382B 668B1D[C7270000]    <1> 	mov bx, [background]
  4558 00003832 66891F              <1> 	mov [edi], bx
  4559                              <1> nodelpaintedfont:
  4560 00003835 80FA00              <1> 	cmp dl, 0
  4561 00003838 740A                <1> 	je nopixelset
  4562 0000383A 668B15[4A370000]    <1> 	mov dx, [colorfont]
  4563 00003841 668917              <1> 	mov [edi], dx
  4564                              <1> nopixelset:
  4565 00003844 81C702000000        <1> 	add edi, 2
  4566 0000384A D0C0                <1> 	rol al, 1
  4567 0000384C FEC1                <1> 	inc cl
  4568 0000384E 3A0D[AE380000]      <1> 	cmp cl, [charwidth]
  4569 00003854 7299                <1> 	jb paintfontvesa
  4570 00003856 FEC5                <1> 	inc ch
  4571 00003858 BA00000000          <1> 	mov edx, 0
  4572 0000385D 668B15[43370000]    <1> 	mov dx, [resolutionx2]
  4573 00003864 01D7                <1> 	add edi, edx
  4574 00003866 BA00000000          <1> 	mov edx, 0
  4575 0000386B 8A15[AE380000]      <1> 	mov dl, [charwidth]
  4576 00003871 00D2                <1> 	add dl, dl
  4577 00003873 29D7                <1> 	sub edi, edx
  4578 00003875 80FD10              <1> 	cmp ch, 16
  4579 00003878 0F8242FFFFFF        <1> 	jb foundfontvesa
  4580                              <1> donefontvesa:
  4581 0000387E B208                <1> 	mov dl, 8
  4582 00003880 8815[AE380000]      <1> 	mov [charwidth], dl
  4583 00003886 668B15[46370000]    <1> 	mov dx, [posxvesa]
  4584 0000388D 8A1D[AE380000]      <1> 	mov bl, [charwidth]
  4585 00003893 B700                <1> 	mov bh, 0
  4586 00003895 6601DA              <1> 	add dx, bx
  4587 00003898 668B1D[4A370000]    <1> 	mov bx, [colorfont]
  4588 0000389F 668B0D[48370000]    <1> 	mov cx, [posyvesa]
  4589 000038A6 C605[21290000]00    <1> 	mov byte [savefonton], 0
  4590 000038AD C3                  <1> 	ret
  4591 000038AE 08                  <1> charwidth db 8
  4592                              <1> vesafontsaver:
  4593 000038AF B000                <1> 	mov al, 0
  4594 000038B1 B100                <1> 	mov cl, 0
  4595                              <1> vesafontsaver2:
  4596 000038B3 668B17              <1> 	mov dx, [edi]
  4597 000038B6 663B15[4A370000]    <1> 	cmp dx, [colorfont]
  4598 000038BD 742F                <1> 	je colorfontmatch
  4599                              <1> donecolormatch:
  4600 000038BF 81C702000000        <1> 	add edi, 2
  4601 000038C5 D0C0                <1> 	rol al, 1
  4602 000038C7 FEC1                <1> 	inc cl
  4603 000038C9 80F908              <1> 	cmp cl, 8
  4604 000038CC 72E5                <1> 	jb vesafontsaver2
  4605 000038CE 8806                <1> 	mov [esi], al
  4606 000038D0 46                  <1> 	inc esi
  4607 000038D1 FEC5                <1> 	inc ch
  4608 000038D3 BA00000000          <1> 	mov edx, 0
  4609 000038D8 668B15[43370000]    <1> 	mov dx, [resolutionx2]
  4610 000038DF 01D7                <1> 	add edi, edx
  4611 000038E1 81EF10000000        <1> 	sub edi, 16
  4612 000038E7 80FD10              <1> 	cmp ch, 16
  4613 000038EA 72C3                <1> 	jb vesafontsaver
  4614 000038EC EB90                <1> 	jmp donefontvesa
  4615                              <1> colorfontmatch:
  4616 000038EE 0401                <1> 	add al, 1
  4617 000038F0 EBCD                <1> 	jmp donecolormatch
  4618                              <1> 	
  4619                              <1> showbmp:
  4620 000038F2 668B06              <1> 	mov ax, [esi]
  4621 000038F5 663D424D            <1> 	cmp ax, "BM"
  4622 000038F9 0F858E000000        <1> 	jne near endedbmp
  4623 000038FF 8B3D[EC4B0000]      <1> 	mov edi, [physbaseptr]
  4624 00003905 6689D0              <1> 	mov ax, dx
  4625 00003908 6689CB              <1> 	mov bx, cx
  4626 0000390B B900000000          <1> 	mov ecx, 0
  4627 00003910 BA00000000          <1> 	mov edx, 0
  4628 00003915 6689D9              <1> 	mov cx, bx
  4629 00003918 6689C2              <1> 	mov dx, ax
  4630 0000391B 01D7                <1> 	add edi, edx
  4631 0000391D 01D7                <1> 	add edi, edx
  4632 0000391F BA00000000          <1> 	mov edx, 0
  4633 00003924 668B15[43370000]    <1> 	mov dx, [resolutionx2]
  4634 0000392B 41                  <1> 	inc ecx
  4635 0000392C 034E16              <1> 	add ecx, [esi + 22]
  4636                              <1> bmplocloop:
  4637 0000392F 01D7                <1> 	add edi, edx
  4638 00003931 E2FC                <1> 	loop bmplocloop
  4639 00003933 29D7                <1> 	sub edi, edx
  4640 00003935 8B5612              <1> 	mov edx, [esi + 18]
  4641 00003938 8B4E16              <1> 	mov ecx, [esi + 22]
  4642 0000393B 8B460A              <1> 	mov eax, [esi + 10]
  4643 0000393E 8B5E02              <1> 	mov ebx, [esi + 2]
  4644 00003941 01F3                <1> 	add ebx, esi
  4645 00003943 891D[8E390000]      <1> 	mov [bmpend], ebx
  4646 00003949 89D3                <1> 	mov ebx, edx
  4647 0000394B 01C6                <1> 	add esi, eax
  4648                              <1> ldxbmp:
  4649 0000394D 668B06              <1> 	mov ax, [esi]
  4650 00003950 668907              <1> 	mov [edi], ax
  4651 00003953 81C702000000        <1> 	add edi, 2
  4652 00003959 81C602000000        <1> 	add esi, 2
  4653 0000395F 3B35[8E390000]      <1> 	cmp esi, [bmpend]
  4654 00003965 7726                <1> 	ja endedbmp
  4655 00003967 4A                  <1> 	dec edx
  4656 00003968 81FA00000000        <1> 	cmp edx, 0
  4657 0000396E 77DD                <1> 	ja ldxbmp
  4658 00003970 BA00000000          <1> 	mov edx, 0
  4659 00003975 668B15[43370000]    <1> 	mov dx, [resolutionx2]
  4660 0000397C 29DF                <1> 	sub edi, ebx
  4661 0000397E 29DF                <1> 	sub edi, ebx
  4662 00003980 29D7                <1> 	sub edi, edx
  4663 00003982 49                  <1> 	dec ecx
  4664 00003983 89DA                <1> 	mov edx, ebx
  4665 00003985 81F900000000        <1> 	cmp ecx, 0
  4666 0000398B 77C0                <1> 	ja ldxbmp
  4667                              <1> endedbmp:
  4668 0000398D C3                  <1> 	ret
  4669                              <1> 	
  4670 0000398E 00000000            <1> 	bmpend dd 0
  4671                              <1> 
  4672                              <1> ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;Here are some vars;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
  4673 00003992 00000000            <1> 	showstringesi dw 0,0
  4674 00003996 00                  <1> 	mouseon db 0
  4675 00003997 737461727400        <1> 	start	db "start",0
  4676 0000399D 536F6C6C65724F5300  <1> 	gotomenu db "SollerOS",0
  4677 000039A6 426F6F2100          <1> 	boomsg db "Boo!",0
  4678 000039AB 5061636D616E207761- <1> 	pacmsg	db "Pacman was easy to draw.",0
  4679 000039B4 73206561737920746F- <1>
  4680 000039BD 20647261772E00      <1>
  4681 000039C4 4F6D206E6F6D206E6F- <1> 	pacnom  db "Om nom nom nom",0
  4682 000039CD 6D206E6F6D00        <1>
  4683 000039D3 77696E646F77732073- <1> 	winmsg	db "windows sucks",0
  4684 000039DC 75636B7300          <1>
  4685 000039E1 5800                <1> 	xmsg db "X",0
  4686 000039E3 0000                <1> 	icon dw 0	;pointer to icon
  4687 000039E5 00000000            <1> 	codepointer dw 0,0 ;pointer to code
  4688 000039E9 00                  <1> 	iconselected db 0
  4689                              <1> 	
  4690                              <1> 	boo:
  4691 000039EA BE[A6390000]        <1> 		mov esi, boomsg
  4692 000039EF 66BA6400            <1> 		mov dx, 100
  4693 000039F3 66B94001            <1> 		mov cx, 320
  4694 000039F7 BB00000000          <1> 		mov ebx, 0
  4695 000039FC 66B80000            <1> 		mov ax, 0
  4696 00003A00 E9E2F8FFFF          <1> 		jmp showstring
  4697                              <1> 
  4698                              <1> 	pacmannomnom:
  4699 00003A05 BE[C4390000]        <1> 		mov esi, pacnom
  4700 00003A0A 66BA8200            <1> 		mov dx, 130
  4701 00003A0E 66B93C00            <1> 		mov cx, 60
  4702 00003A12 BB00000000          <1> 		mov ebx, 0
  4703 00003A17 66B80000            <1> 		mov ax, 0
  4704 00003A1B E9C7F8FFFF          <1> 		jmp showstring	
  4705                              <1> 	
  4706                              <1> 	noie:
  4707 00003A20 BE[B43A0000]        <1> 		mov esi, termwindow
  4708 00003A25 66BA0000            <1> 		mov dx, 0
  4709 00003A29 66B90000            <1> 		mov cx, 0
  4710 00003A2D BB[2B0D0000]        <1> 		mov ebx, os
  4711                              <1> ;;		mov ebx, internettest
  4712 00003A32 891D[58030000]      <1> 		mov [user2codepoint], ebx
  4713 00003A38 66B80000            <1> 		mov ax, 0
  4714 00003A3C E8FBF8FFFF          <1> 		call showwindow
  4715                              <1> ;;		jmp internettest
  4716 00003A41 E9E5D2FFFF          <1> 		jmp os
  4717 00003A46 C3                  <1> 		ret
  4718                              <1> 
  4719                              <1> 	gotomenuboot:
  4720 00003A47 BE[B43A0000]        <1> 		mov esi, termwindow
  4721 00003A4C 66BA0000            <1> 		mov dx, 0
  4722 00003A50 66B90000            <1> 		mov cx, 0
  4723 00003A54 BB[2B0D0000]        <1> 		mov ebx, os
  4724 00003A59 891D[58030000]      <1> 		mov [user2codepoint], ebx
  4725 00003A5F 66B80000            <1> 		mov ax, 0
  4726 00003A63 E8D4F8FFFF          <1> 		call showwindow
  4727 00003A68 E9BED2FFFF          <1> jmp os
  4728 00003A6D C3                  <1> 		ret
  4729                              <1> 
  4730                              <1> 	winblows:
  4731 00003A6E BE[D3390000]        <1> 		mov esi, winmsg
  4732 00003A73 66BA0000            <1> 		mov dx, 0
  4733 00003A77 668B0D[3F370000]    <1> 		mov cx, [resolutiony]
  4734 00003A7E 6681E92000          <1> 		sub cx, 32
  4735 00003A83 BB00000000          <1> 		mov ebx, 0
  4736 00003A88 B400                <1> 		mov ah, 0
  4737 00003A8A B011                <1> 		mov al, 00010001b
  4738 00003A8C E856F8FFFF          <1> 		call showstring
  4739 00003A91 BE[9D390000]        <1> 		mov esi, gotomenu
  4740 00003A96 668B0D[3F370000]    <1> 		mov cx, [resolutiony]
  4741 00003A9D 6681E93000          <1> 		sub cx, 48
  4742 00003AA2 66BA0000            <1> 		mov dx, 0
  4743 00003AA6 B400                <1> 		mov ah, 0
  4744 00003AA8 B010                <1> 		mov al, 00010000b
  4745 00003AAA BB[473A0000]        <1> 		mov ebx, gotomenuboot
  4746 00003AAF E933F8FFFF          <1> 		jmp showstring
  4747                              <1> 
  4748 00003AB4 8002E001            <1> 	termwindow:	dw 640,480	;;window size
  4749 00003AB8 5445524D494E414C00  <1> 	termmsg:	db "TERMINAL",0	;;window title
  4750                              <1> 	
  4751 00003AB8 <incbin>            <1> interneticon: 	incbin 'source/precompiled/interneticon.pak'
  4752 00003AB8 <incbin>            <1> wordicon: 	incbin 'source/precompiled/wordicon.pak'
  4753 00003AB8 <incbin>            <1> pacmanpellet: incbin 'source/precompiled/pacmanpellet.pak'
  4754 00003AB8 <incbin>            <1> ghostie	incbin 'source/precompiled/ghostie.pak'
  4755 00003AB8 <incbin>            <1> pacman	incbin 'source/precompiled/pacman.pak'
  4756                                      ;%include 'source/network.asm'
  4757                                  	%include 'source/pci.asm'
  4758 00003D4B 00                  <1> pcibus		db 0
  4759 00003D4C 00                  <1> pcidevice	db 0
  4760 00003D4D 00                  <1> pcifunction	db 0
  4761 00003D4E 00                  <1> pciregister	db 0
  4762 00003D4F 00                  <1> pcireqtype db 0
  4763                              <1> 
  4764                              <1> getpciport:
  4765 00003D50 B001                <1> 	mov al, 1
  4766 00003D52 A2[4F3D0000]        <1> 	mov [pcireqtype], al
  4767 00003D57 E91E000000          <1> 	jmp searchpci
  4768                              <1> pcidump:
  4769 00003D5C B800000000          <1> 	mov eax, 0
  4770 00003D61 A2[4D3D0000]        <1> 	mov [pcifunction], al
  4771 00003D66 A2[4B3D0000]        <1> 	mov [pcibus], al
  4772 00003D6B A2[4C3D0000]        <1> 	mov [pcidevice], al
  4773 00003D70 A2[4F3D0000]        <1> 	mov [pcireqtype], al
  4774 00003D75 E900000000          <1> 	jmp searchpci
  4775                              <1> searchpci:		;;return in ebx, start X in pciX
  4776 00003D7A B000                <1> 	mov al, 0
  4777 00003D7C A2[4E3D0000]        <1> 	mov [pciregister], al
  4778 00003D81 E84F010000          <1> 	call getpciaddr
  4779 00003D86 BAF80C0000          <1> 	mov edx, 0xCF8
  4780 00003D8B EF                  <1> 	out dx, eax	;;request pci config
  4781 00003D8C BAFC0C0000          <1> 	mov edx, 0xCFC
  4782 00003D91 ED                  <1> 	in eax, dx 	;;read in pci config
  4783 00003D92 3D0000FFFF          <1> 	cmp eax, 0xFFFF0000
  4784 00003D97 0F8237000000        <1> 	jb near checkpcidevice
  4785                              <1> searchpciret:
  4786                              <1> nextpcidevice:
  4787 00003D9D B000                <1> 	mov al, 0
  4788 00003D9F A2[4D3D0000]        <1> 	mov [pcifunction], al
  4789 00003DA4 A0[4C3D0000]        <1> 	mov al, [pcidevice]
  4790 00003DA9 3C1F                <1> 	cmp al, 11111b
  4791 00003DAB 0F83B8000000        <1> 	jae near nextpcibus
  4792 00003DB1 FEC0                <1> 	inc al
  4793 00003DB3 A2[4C3D0000]        <1> 	mov [pcidevice], al
  4794 00003DB8 EBC0                <1> 	jmp searchpci
  4795 00003DBA A0[4D3D0000]        <1> 	mov al, [pcifunction]
  4796 00003DBF 3C07                <1> 	cmp al, 111b
  4797 00003DC1 0F83D6FFFFFF        <1> 	jae near nextpcidevice
  4798 00003DC7 FEC0                <1> 	inc al
  4799 00003DC9 A2[4D3D0000]        <1> 	mov [pcifunction], al
  4800 00003DCE EBAA                <1> 	jmp searchpci
  4801 00003DD0 00000000            <1> pcitype: db 0,0,0,0
  4802                              <1> checkpcidevice:
  4803 00003DD4 B000                <1> 	mov al, 0
  4804 00003DD6 3805[4F3D0000]      <1> 	cmp [pcireqtype], al
  4805 00003DDC 0F842B000000        <1> 	je near dumppcidevice
  4806 00003DE2 B008                <1> 	mov al, 0x08
  4807 00003DE4 A2[4E3D0000]        <1> 	mov [pciregister], al	;;class code, subclass, revision id
  4808 00003DE9 E8E7000000          <1> 	call getpciaddr
  4809 00003DEE BAF80C0000          <1> 	mov edx, 0xCF8
  4810 00003DF3 EF                  <1> 	out dx, eax
  4811 00003DF4 BAFC0C0000          <1> 	mov edx, 0xCFC
  4812 00003DF9 ED                  <1> 	in eax, dx
  4813 00003DFA C1C008              <1> 	rol eax, 8
  4814 00003DFD 8A1D[D03D0000]      <1> 	mov bl, [pcitype]
  4815 00003E03 38D8                <1> 	cmp al, bl
  4816 00003E05 0F8480000000        <1> 	je near foundpciaddr
  4817 00003E0B EB90                <1> 	jmp searchpciret
  4818                              <1> dumppcidevice:
  4819 00003E0D B000                <1> 	mov al, 0
  4820 00003E0F A2[4E3D0000]        <1> 	mov [pciregister], al
  4821 00003E14 E8BC000000          <1> 	call getpciaddr
  4822 00003E19 89C1                <1> 	mov ecx, eax
  4823 00003E1B C605[17120000]03    <1> 	mov byte [firsthexshown],3
  4824 00003E22 E8F1D3FFFF          <1> 	call showhex
  4825                              <1> dumppcidevicelp:
  4826 00003E27 A2[4E3D0000]        <1> 	mov [pciregister], al
  4827 00003E2C E8A4000000          <1> 	call getpciaddr
  4828 00003E31 BAF80C0000          <1> 	mov edx, 0xCF8
  4829 00003E36 EF                  <1> 	out dx, eax
  4830 00003E37 BAFC0C0000          <1> 	mov edx, 0xCFC
  4831 00003E3C ED                  <1> 	in eax, dx
  4832 00003E3D 89C1                <1> 	mov ecx, eax
  4833 00003E3F A0[4E3D0000]        <1> 	mov al, [pciregister]
  4834 00003E44 0404                <1> 	add al, 4
  4835 00003E46 3C3C                <1> 	cmp al, 0x3C
  4836 00003E48 730E                <1> 	jae dumppcidn
  4837 00003E4A C605[17120000]00    <1> 	mov byte [firsthexshown],0
  4838 00003E51 E8C2D3FFFF          <1> 	call showhex
  4839 00003E56 EBCF                <1> 	jmp dumppcidevicelp
  4840                              <1> dumppcidn:
  4841 00003E58 C605[17120000]02    <1> 	mov byte [firsthexshown],2
  4842 00003E5F E8B4D3FFFF          <1> 	call showhex
  4843 00003E64 E934FFFFFF          <1> 	jmp searchpciret
  4844                              <1> nextpcibus:
  4845 00003E69 B000                <1> 	mov al, 0
  4846 00003E6B A2[4C3D0000]        <1> 	mov [pcidevice], al
  4847 00003E70 A0[4B3D0000]        <1> 	mov al, [pcibus]
  4848 00003E75 3C7F                <1> 	cmp al, 1111111b
  4849 00003E77 730C                <1> 	jae donesearchpci
  4850 00003E79 FEC0                <1> 	inc al
  4851 00003E7B A2[4B3D0000]        <1> 	mov [pcibus], al
  4852 00003E80 E9F5FEFFFF          <1> 	jmp searchpci
  4853                              <1> donesearchpci:
  4854 00003E85 BA00000000          <1> 	mov edx, 0
  4855 00003E8A C3                  <1> 	ret
  4856                              <1> foundpciaddr:
  4857 00003E8B B010                <1> 	mov al, 0x10
  4858 00003E8D A2[4E3D0000]        <1> 	mov [pciregister], al
  4859                              <1> findpciioaddr:
  4860 00003E92 E83E000000          <1> 	call getpciaddr
  4861 00003E97 BAF80C0000          <1> 	mov edx, 0xCF8
  4862 00003E9C EF                  <1> 	out dx, eax
  4863 00003E9D BAFC0C0000          <1> 	mov edx, 0xCFC
  4864 00003EA2 ED                  <1> 	in eax, dx
  4865 00003EA3 89C3                <1> 	mov ebx, eax
  4866 00003EA5 81E301000000        <1> 	and ebx, 1
  4867 00003EAB 81FB00000000        <1> 	cmp ebx, 0
  4868 00003EB1 0F8408000000        <1> 	je near notpciioaddr
  4869 00003EB7 2D01000000          <1> 	sub eax, 1
  4870 00003EBC 89C2                <1> 	mov edx, eax
  4871 00003EBE C3                  <1> 	ret
  4872                              <1> notpciioaddr:
  4873 00003EBF A0[4E3D0000]        <1> 	mov al, [pciregister]
  4874 00003EC4 0404                <1> 	add al, 4
  4875 00003EC6 3C28                <1> 	cmp al, 0x28
  4876 00003EC8 0F87CFFEFFFF        <1> 	ja near searchpciret
  4877 00003ECE A2[4E3D0000]        <1> 	mov [pciregister], al
  4878 00003ED3 EBBD                <1> 	jmp findpciioaddr
  4879                              <1> getpciaddr:		;;puts it in eax and ebx
  4880 00003ED5 B800000000          <1> 			mov eax, 0
  4881 00003EDA BB00000080          <1> 			mov ebx, 0x80000000
  4882 00003EDF A0[4B3D0000]        <1> 			mov al, [pcibus]
  4883 00003EE4 C1E010              <1> 			shl eax, 16
  4884 00003EE7 01C3                <1> 			add ebx, eax
  4885 00003EE9 B800000000          <1> 			mov eax, 0
  4886 00003EEE A0[4C3D0000]        <1> 			mov al, [pcidevice]
  4887 00003EF3 C1E00B              <1> 			shl eax, 11
  4888 00003EF6 01C3                <1> 			add ebx, eax
  4889 00003EF8 B800000000          <1> 			mov eax, 0
  4890 00003EFD A0[4D3D0000]        <1> 			mov al, [pcifunction]
  4891 00003F02 C1E008              <1> 			shl eax, 8
  4892 00003F05 01C3                <1> 			add ebx, eax
  4893 00003F07 B800000000          <1> 			mov eax, 0
  4894 00003F0C A0[4E3D0000]        <1> 			mov al, [pciregister]
  4895 00003F11 01C3                <1> 			add ebx, eax
  4896 00003F13 89D8                <1> 			mov eax, ebx
  4897 00003F15 C3                  <1> 			ret
  4898                                  	;%include 'source/process.asm'
  4899                                      %include 'source/disk.asm'
  4900                              <1> ;;disk.asm - new - using lba
  4901                              <1> loadfile:	;;loads a file with the name buffer's location in edi into location in esi
  4902 00003F16 803F00              <1> 	cmp byte [edi], 0
  4903 00003F19 0F8444000000        <1> 	je near nofileload
  4904 00003F1F 89FA                <1> 	mov edx, edi
  4905 00003F21 BB[CC400000]        <1> 	mov ebx, diskfileindex
  4906                              <1> nextnamechar:
  4907 00003F26 8A07                <1> 	mov al, [edi]
  4908 00003F28 8A23                <1> 	mov ah, [ebx]
  4909 00003F2A 47                  <1> 	inc edi
  4910 00003F2B 43                  <1> 	inc ebx
  4911 00003F2C 88C1                <1> 	mov cl, al
  4912 00003F2E 08E1                <1> 	or cl, ah
  4913 00003F30 80F900              <1> 	cmp cl, 0
  4914 00003F33 744E                <1> 	je equalfilenames
  4915 00003F35 80F920              <1> 	cmp cl, ' '
  4916 00003F38 7449                <1> 	je equalfilenames
  4917 00003F3A 3C2A                <1> 	cmp al, '*'
  4918 00003F3C 742B                <1> 	je equalfilenames2
  4919 00003F3E 80FC00              <1> 	cmp ah, 0
  4920 00003F41 7410                <1> 	je nextfilename
  4921 00003F43 3C00                <1> 	cmp al, 0
  4922 00003F45 740C                <1> 	je nextfilename
  4923 00003F47 38E0                <1> 	cmp al, ah
  4924 00003F49 74DB                <1> 	je nextnamechar
  4925                              <1> getebxzero:
  4926 00003F4B 8A23                <1> 	mov ah, [ebx]
  4927 00003F4D 43                  <1> 	inc ebx
  4928 00003F4E 80FC00              <1> 	cmp ah, 0
  4929 00003F51 75F8                <1> 	jne getebxzero
  4930                              <1> nextfilename:
  4931 00003F53 81C308000000        <1> 	add ebx, 8		;;next descriptor
  4932 00003F59 89D7                <1> 	mov edi, edx
  4933 00003F5B 81FB[43410000]      <1> 	cmp ebx, enddiskfileindex
  4934 00003F61 72C3                <1> 	jb nextnamechar
  4935                              <1> nofileload:
  4936 00003F63 BA94010000          <1> 	mov edx, 404	;;indicate not found error
  4937 00003F68 C3                  <1> 	ret
  4938                              <1> equalfilenames2:
  4939 00003F69 81EB02000000        <1> 	sub ebx, 2
  4940                              <1> eqfilefind:
  4941 00003F6F 43                  <1> 	inc ebx
  4942 00003F70 81FB[43410000]      <1> 	cmp ebx, enddiskfileindex
  4943 00003F76 0F83E7FFFFFF        <1> 	jae near nofileload
  4944 00003F7C 8A03                <1> 	mov al, [ebx]
  4945 00003F7E 3C00                <1> 	cmp al, 0
  4946 00003F80 75ED                <1> 	jne eqfilefind
  4947 00003F82 43                  <1> 	inc ebx
  4948                              <1> equalfilenames:
  4949 00003F83 8B4304              <1> 	mov eax, [ebx + 4] 	;;put file size in eax
  4950 00003F86 8B1B                <1> 	mov ebx, [ebx]		;;put file beginning in ebx
  4951 00003F88 031D[2C000000]      <1> 	add ebx, [lbaad]	;;add offset to solleros
  4952 00003F8E B900000000          <1> 	mov ecx, 0
  4953 00003F93 88C1                <1> 	mov cl, al			;;get excess number of sectors
  4954 00003F95 D0E1                <1> 	shl cl, 1
  4955 00003F97 D0E9                <1> 	shr cl, 1			;;cut off at 128
  4956 00003F99 29C8                <1> 	sub eax, ecx		;;get rid of excess sectors
  4957 00003F9B B500                <1> 	mov ch, 0			;;drive 0
  4958 00003F9D C1E807              <1> 	shr eax, 7			;;get number of 128 sector tracks
  4959                              <1> loaddiskfile:		;;tracks in eax, excess sectors in cl, drive in ch, buffer in esi, address in ebx
  4960 00003FA0 A3[DE3F0000]        <1> 	mov [filetracks], eax
  4961 00003FA5 89F7                <1> 	mov edi, esi		;;just in case cl is 0
  4962 00003FA7 89DA                <1> 	mov edx, ebx
  4963 00003FA9 80F900              <1> 	cmp cl, 0
  4964 00003FAC 7405                <1> 	je copytracksforfile
  4965 00003FAE E831000000          <1> 	call diskr		;;take care of excess sectors
  4966                              <1> copytracksforfile:
  4967 00003FB3 A1[DE3F0000]        <1> 	mov eax, [filetracks]
  4968 00003FB8 3D00000000          <1> 	cmp eax, 0
  4969 00003FBD 7419                <1> 	je donecopyfile
  4970 00003FBF 48                  <1> 	dec eax
  4971 00003FC0 A3[DE3F0000]        <1> 	mov [filetracks], eax
  4972 00003FC5 89D3                <1> 	mov ebx, edx	;;get end lba
  4973 00003FC7 B180                <1> 	mov cl, 0x80
  4974 00003FC9 8A2D[2B000000]      <1> 	mov ch, [DriveNumber]
  4975 00003FCF 89FE                <1> 	mov esi, edi	;;reset buffer
  4976 00003FD1 E80E000000          <1> 	call diskr
  4977 00003FD6 EBDB                <1> 	jmp copytracksforfile
  4978                              <1> donecopyfile:
  4979 00003FD8 BA00000000          <1> 	mov edx, 0	;;no error
  4980 00003FDD C3                  <1> 	ret
  4981                              <1> 	
  4982 00003FDE 00000000            <1> filetracks dd 0
  4983                              <1> 	
  4984 00003FE2 6400                <1> segments dw 100
  4985                              <1> 
  4986                              <1> diskr:		;;sector count in cl, disk number in ch, 48 bit address with first 32 bits in ebx, buffer in esi, puts end buffer in edi and end lba in edx
  4987 00003FE4 8935[C8400000]      <1> 	mov [bufferstartesi], esi
  4988 00003FEA 891D[C4400000]      <1> 	mov [lbaadstartebx], ebx
  4989 00003FF0 BA00000000          <1> 	mov edx, 0
  4990 00003FF5 88CA                <1> 	mov dl, cl
  4991 00003FF7 01DA                <1> 	add edx, ebx
  4992 00003FF9 8915[C0400000]      <1> 	mov [lbaadend], edx
  4993 00003FFF 66B80000            <1> 	mov ax, 0
  4994 00004003 66BAF101            <1> 	mov dx, 0x1F1
  4995 00004007 EE                  <1> 	out dx, al	;;2 null bytes
  4996 00004008 EE                  <1> 	out dx, al
  4997 00004009 B000                <1> 	mov al, 0
  4998 0000400B 66BAF201            <1> 	mov dx, 0x1F2
  4999 0000400F EE                  <1> 	out dx, al	;;16 bit sector count-last byte now 0
  5000 00004010 88C8                <1> 	mov al, cl
  5001 00004012 EE                  <1> 	out dx, al
  5002 00004013 66BAF301            <1> 	mov dx, 0x1F3
  5003 00004017 89D8                <1> 	mov eax, ebx
  5004 00004019 C1C818              <1> 	ror eax, 24
  5005 0000401C EE                  <1> 	out dx, al	;;4th byte of address
  5006 0000401D C1C018              <1> 	rol eax, 24
  5007 00004020 EE                  <1> 	out dx, al	;;1st byte of address
  5008 00004021 66BAF401            <1> 	mov dx, 0x1F4
  5009 00004025 B000                <1> 	mov al, 0
  5010 00004027 EE                  <1> 	out dx, al	;;5th byte of address-always 0 for now
  5011 00004028 C1C808              <1> 	ror eax, 8
  5012 0000402B EE                  <1> 	out dx, al	;;2nd byte of address
  5013 0000402C 66BAF501            <1> 	mov dx, 0x1F5
  5014 00004030 C1C008              <1> 	rol eax, 8
  5015 00004033 B000                <1> 	mov al, 0
  5016 00004035 EE                  <1> 	out dx, al	;;6th byte
  5017 00004036 C1C810              <1> 	ror eax, 16
  5018 00004039 EE                  <1> 	out dx, al	;;3rd byte
  5019 0000403A B840000000          <1> 	mov eax, 0x40
  5020 0000403F 66BAF601            <1> 	mov dx, 0x1F6
  5021 00004043 EE                  <1> 	out dx, al	;;send magic bits-add drive indicator later
  5022 00004044 B024                <1> 	mov al, 0x24
  5023 00004046 66BAF701            <1> 	mov dx, 0x1F7
  5024 0000404A EE                  <1> 	out dx, al	;;READ!!!
  5025                              <1> diskrwait:
  5026 0000404B 66BAF701            <1> 	mov dx, 0x1F7
  5027 0000404F EC                  <1> 	in al, dx
  5028 00004050 2408                <1> 	and al, 0x08
  5029 00004052 3C08                <1> 	cmp al, 0x08
  5030 00004054 75F5                <1> 	jne diskrwait
  5031 00004056 88CD                <1> 	mov ch, cl	;;move sector data into ch, multiplying it by 256
  5032 00004058 B100                <1> 	mov cl, 0
  5033                              <1> diskdataread:
  5034 0000405A 66BAF001            <1> 	mov dx, 0x1F0
  5035 0000405E 66ED                <1> 	in ax, dx
  5036 00004060 668906              <1> 	mov [esi], ax
  5037 00004063 81C602000000        <1> 	add esi, 2
  5038 00004069 6649                <1> 	dec cx
  5039 0000406B 6681F90000          <1> 	cmp cx, 0
  5040 00004070 75E8                <1> 	jne diskdataread		;;read all sectors
  5041 00004072 89F7                <1> 	mov edi, esi
  5042 00004074 8B15[C0400000]      <1> 	mov edx, [lbaadend]
  5043 0000407A 8B35[C8400000]      <1> 	mov esi, [bufferstartesi]
  5044 00004080 8B1D[C4400000]      <1> 	mov ebx, [lbaadstartebx]
  5045 00004086 C3                  <1> 	ret
  5046                              <1> 	
  5047                              <1> 	
  5048                              <1> diskold: ;;28 bits
  5049 00004087 66B80000            <1> 	mov ax, 0
  5050 0000408B 66BAF101            <1> 	mov dx, 0x1F1
  5051 0000408F EE                  <1> 	out dx, al	;;send null byte to port
  5052 00004090 6642                <1> 	inc dx	;;0x1F2
  5053 00004092 88C8                <1> 	mov al, cl	;;get sector count
  5054 00004094 EE                  <1> 	out dx, al	;;send sector count
  5055 00004095 6642                <1> 	inc dx	;;0x1F3
  5056 00004097 88D8                <1> 	mov al, bl	;;get first 8 bits of address
  5057 00004099 EE                  <1> 	out dx, al	;;send them
  5058 0000409A 6642                <1> 	inc dx	;;0x1F4
  5059 0000409C C1CB08              <1> 	ror ebx, 8	;;get next 8 bits
  5060 0000409F 88D8                <1> 	mov al, bl
  5061 000040A1 EE                  <1> 	out dx, al
  5062 000040A2 6642                <1> 	inc dx	;;0x1F5
  5063 000040A4 C1CB08              <1> 	ror ebx, 8	;;again
  5064 000040A7 88D8                <1> 	mov al, bl
  5065 000040A9 EE                  <1> 	out dx, al
  5066 000040AA 6642                <1> 	inc dx	;;0x1F6
  5067 000040AC C1CB08              <1> 	ror ebx, 8
  5068 000040AF 88D8                <1> 	mov al, bl
  5069 000040B1 240F                <1> 	and al, 00001111b	;;last 4 bits of address
  5070 000040B3 0CE0                <1> 	or al, 0xE0			;;majic number
  5071 000040B5 C0E504              <1> 	shl ch, 4
  5072 000040B8 08E8                <1> 	or al, ch
  5073 000040BA EE                  <1> 	out dx, al			;;send drive indicator, magic bits, and highest 4 bits of address
  5074 000040BB 6642                <1> 	inc dx	;;0x1F7
  5075 000040BD B020                <1> 	mov al, 0x20
  5076 000040BF EE                  <1> 	out dx, al			;;execute read command
  5077                              <1> 	
  5078 000040C0 00000000            <1> lbaadend dd 0
  5079 000040C4 00000000            <1> lbaadstartebx dd 0
  5080 000040C8 00000000            <1> bufferstartesi dd 0
  5081                                      %include 'fileindex.asm'
  5082                              <1> diskfileindex:
  5083 000040CC 65787000            <1> db "exp",0
  5084 000040D0 27000000            <1> dd (f0-$$)/512
  5085 000040D4 01000000            <1> dd (f1-f0)/512
  5086 000040D8 736F6C6C65726F732E- <1> db "solleros.bmp",0
  5087 000040E1 626D7000            <1>
  5088 000040E5 28000000            <1> dd (f1-$$)/512
  5089 000040E9 B0020000            <1> dd (f2-f1)/512
  5090 000040ED 736F6C6C65726F732E- <1> db "solleros.txt",0
  5091 000040F6 74787400            <1>
  5092 000040FA D8020000            <1> dd (f2-$$)/512
  5093 000040FE 01000000            <1> dd (f3-f2)/512
  5094 00004102 74656C7900          <1> db "tely",0
  5095 00004107 D9020000            <1> dd (f3-$$)/512
  5096 0000410B 01000000            <1> dd (f4-f3)/512
  5097 0000410F 5468756D62732E6462- <1> db "Thumbs.db",0
  5098 00004118 00                  <1>
  5099 00004119 DA020000            <1> dd (f4-$$)/512
  5100 0000411D 1F000000            <1> dd (f5-f4)/512
  5101 00004121 74696D6500          <1> db "time",0
  5102 00004126 F9020000            <1> dd (f5-$$)/512
  5103 0000412A 02000000            <1> dd (f6-f5)/512
  5104 0000412E 7475746F7269616C2E- <1> db "tutorial.bat",0
  5105 00004137 62617400            <1>
  5106 0000413B FB020000            <1> dd (f6-$$)/512
  5107 0000413F 03000000            <1> dd (f7-f6)/512
  5108                              <1> enddiskfileindex:
  5109                              <1> 
  5110                                  	%include 'source/msg.asm'
  5111 00004143 6578697400          <1> 	exitmsg db	"exit",0
  5112 00004148 50726F6772616D2022- <1> 	notfound1 db "Program ",34,0
  5113 00004151 00                  <1>
  5114 00004152 22206E6F7420666F75- <1> 	notfound2 db  34," not found.",13,10,0
  5115 0000415B 6E642E0D0A00        <1>
  5116 00004161 757365726E616D653A- <1> 	userask db "username:",0
  5117 0000416A 00                  <1>
  5118 0000416B 70617373776F72643A- <1> 	pwdask	db	"password:",0
  5119 00004174 00                  <1>
  5120 00004175 40536F6C6C65724F53- <1> 	location	db	"@SollerOS]#",0
  5121 0000417E 5D2300              <1>
  5122 00004181 0D0A00              <1> 	line	db	13,10,0
  5123                              <1>     ;msg:       db "SollerOS Beta version 0.9.0 - compiled by Jeremy Soller.",13,10,0
  5124                              <1> 	userlst:
  5125 00004184 7573657200          <1> 			db "user",0
  5126 00004189 70617373776F726400  <1> 			db "password",0
  5127 00004192 726F6F7400          <1> 			db "root",0
  5128 00004197 617765736F6D65706F- <1> 			db "awesomepower",0
  5129 000041A0 77657200            <1>
  5130                              <1> 	userlstend:
  5131                              <1> 	
  5132 000041A0 <incbin>            <1> fonts:	incbin 'source/precompiled/fonts.pak'
  5133                              <1> fontend2:
  5134                              <1> mcursor:
  5135 000049B4 01                  <1> 	db	00000001b
  5136 000049B5 81                  <1> 	db	10000001b
  5137 000049B6 C1                  <1> 	db	11000001b
  5138 000049B7 E1                  <1> 	db	11100001b
  5139 000049B8 F1                  <1> 	db	11110001b
  5140 000049B9 F9                  <1> 	db	11111001b
  5141 000049BA FD                  <1> 	db	11111101b
  5142 000049BB FF                  <1> 	db	11111111b
  5143 000049BC F9                  <1> 	db	11111001b
  5144 000049BD B9                  <1> 	db	10111001b
  5145 000049BE 39                  <1> 	db	00111001b
  5146 000049BF 1C                  <1> 	db	00011100b
  5147 000049C0 1C                  <1> 	db	00011100b
  5148 000049C1 0E                  <1> 	db	00001110b
  5149 000049C2 0E                  <1> 	db	00001110b
  5150 000049C3 0C                  <1> 	db	00001100b
  5151                              <1> fontend:
  5152                              <1> 
  5153                              <1> ;cursorbmp:
  5154                              <1> ;	db	1,0,0,0,0,0,0,0
  5155                              <1> ;	db	1,1,0,0,0,0,0,0
  5156                              <1> ;	db	1,1,1,0,0,0,0,0
  5157                              <1> ;	db	1,1,1,1,0,0,0,0
  5158                              <1> ;	db	1,1,1,1,1,0,0,0
  5159                              <1> ;	db	1,1,1,1,1,1,0,0
  5160                              <1> ;	db	1,1,1,1,1,1,1,0
  5161                              <1> ;	db	1,1,1,1,1,1,1,1
  5162                              <1> ;	db	1,1,1,1,1,1,0,0
  5163                              <1> ;	db	1,1,0,1,1,1,0,0
  5164                              <1> ;	db	1,0,0,1,1,1,0,0
  5165                              <1> ;	db	0,0,0,0,1,1,1,0
  5166                              <1> ;	db	0,0,0,0,1,1,1,0
  5167                              <1> ;	db	0,0,0,0,0,1,1,1
  5168                              <1> ;	db	0,0,0,0,0,1,1,1
  5169                              <1> ;	db	0,0,0,0,0,1,1,0
  5170                              <1> ;cursorbmpend:
  5171                              <1> 
  5172                              <1> 
  5173                              <1> VBEMODEBLOCK:
  5174 000049C4 00<rept>            <1> vbesignature 		times 4 db 0	;VBE Signature
  5175 000049C8 00<rept>            <1> vbeversion  		times 2 db 0	;VBE Version
  5176 000049CA 00<rept>            <1> oemstringptr  		times 4 db 0	;Pointer to OEM String
  5177 000049CE 00<rept>            <1> capabilities 		times 4 db 0	;Capabilities of graphics cont.
  5178 000049D2 00<rept>            <1> videomodeptr 		times 4 db 0	;Pointer to Video Mode List
  5179 000049D6 00<rept>            <1> totalmemory   		times 2 db 0	;number of 64Kb memory blocks
  5180 000049D8 00<rept>            <1> oemsoftwarerev  	times 2 db 0	;VBE implementation Software revision
  5181 000049DA 00<rept>            <1> oemvendornameptr 	times 4 db 0	;Pointer to Vendor Name String
  5182 000049DE 00<rept>            <1> oemproductnameptr 	times 4 db 0	;Pointer to Product Name String
  5183 000049E2 00<rept>            <1> oemproductrevptr 	times 4 db 0	;Pointer to Product Revision String
  5184 000049E6 00<rept>            <1> reserved			times 222 db 0	;Reserved for VBE implementation scratch area
  5185 00004AC4 00<rept>            <1> oemdata 			times 256 db 0	;Data Area for OEM Strings
  5186                              <1> 
  5187                              <1> 
  5188                              <1> VBEMODEINFOBLOCK:
  5189                              <1> ;Mandatory information for all VBE revision
  5190 00004BC4 00<rept>            <1> modeattributes   	times 2 db 0	;Mode attributes
  5191 00004BC6 00                  <1> winaattributes   	times 1 db 0	;Window A attributes
  5192 00004BC7 00                  <1> winbattributes   	times 1 db 0	;Window B attributes
  5193 00004BC8 00<rept>            <1> wingranularity   	times 2 db 0	;Window granularity
  5194 00004BCA 00<rept>            <1> winsize          	times 2 db 0	;Window size
  5195 00004BCC 00<rept>            <1> winasegment      	times 2 db 0	;Window A start segment
  5196 00004BCE 00<rept>            <1> winbsegment      	times 2 db 0	;Window B start segment
  5197 00004BD0 00<rept>            <1> winfuncptr       	times 4 db 0	;pointer to window function
  5198 00004BD4 00<rept>            <1> bytesperscanline 	times 2 db 0	;Bytes per scan line
  5199                              <1> 
  5200                              <1> ;Mandatory information for VBE 1.2 and above
  5201 00004BD6 00<rept>            <1> xresolution     	times 2 db 0	;Horizontal resolution in pixel or chars
  5202 00004BD8 00<rept>            <1> yresolution	    	times 2 db 0	;Vertical resolution in pixel or chars
  5203 00004BDA 00                  <1> xcharsize       	times 1 db 0	;Character cell width in pixel
  5204 00004BDB 00                  <1> ycharsize       	times 1 db 0	;Character cell height in pixel
  5205 00004BDC 00                  <1> numberofplanes  	times 1 db 0	;Number of memory planes
  5206 00004BDD 00                  <1> bitsperpixel    	times 1 db 0	;Bits per pixel
  5207 00004BDE 00                  <1> numberofbanks   	times 1 db 0	;Number of banks
  5208 00004BDF 00                  <1> memorymodel     	times 1 db 0	;Memory model type
  5209 00004BE0 00                  <1> banksize        	times 1 db 0	;Bank size in KB
  5210 00004BE1 00                  <1> numberofimagepages	times 1 db 0	;Number of images
  5211 00004BE2 00                  <1> reserved1       	times 1 db 0	;Reserved for page function
  5212                              <1> 
  5213                              <1> ;Direct Color fields (required for direct/6 and YUV/7 memory models)
  5214 00004BE3 00                  <1> redmasksize			times 1 db 0	;Size of direct color red mask in bits
  5215 00004BE4 00                  <1> redfieldposition	times 1 db 0	;Bit position of lsb of red bask
  5216 00004BE5 00                  <1> greenmasksize   	times 1 db 0	;Size of direct color green mask in bits
  5217 00004BE6 00                  <1> greenfieldposition	times 1 db 0	;Bit position of lsb of green bask
  5218 00004BE7 00                  <1> bluemasksize		times 1 db 0	;Size of direct color blue mask in bits
  5219 00004BE8 00                  <1> bluefieldposition	times 1 db 0	;Bit position of lsb of blue bask
  5220 00004BE9 00                  <1> rsvdmasksize        times 1	db 0	;Size of direct color reserved mask in bits
  5221 00004BEA 00                  <1> rsvdfieldposition	times 1	db 0	;Bit position of lsb of reserved bask
  5222 00004BEB 00                  <1> directcolormodeinfo	times 1 db 0	;Direct color mode attributes
  5223                              <1> 
  5224                              <1> ;Mandatory information for VBE 2.0 and above
  5225 00004BEC 00<rept>            <1> physbaseptr 		times 4 db 0	;Physical address for flat frame buffer
  5226 00004BF0 00<rept>            <1> offscreenmemoffset 	times 4 db 0	;Pointer to start of off screen memory
  5227 00004BF4 00<rept>            <1> offscreenmemsize 	times 2 db 0    ;Amount of off screen memory in 1Kb units
  5228 00004BF6 00<rept>            <1> reserved2 			times 206 db 0  ;Remainder of ModeInfoBlock
  5229                                  	;%include 'source/memory.asm'
  5230                                  	%include 'source/buf.asm'
  5231                              <1> [section .bss]
  5232                              <1> bssstart:
  5233                              <1> stack:
  5234 00000000 <res 00001000>      <1> 	resb 4096
  5235                              <1> stackend:
  5236                              <1> graphicstable: ;w type, dw datalocation, w locationx, w locationy, w selected, dw code
  5237 00001000 <res 00000200>      <1> 	resb 200h 
  5238                              <1> 	graphicstableend:
  5239                              <1> mousecolorbuf: ;where the gui under the mouse is stored
  5240 00001200 <res 00000100>      <1> 	resb 256 
  5241                              <1> mcolorend:
  5242 00001300 <res 00000001>      <1> IFON resb 1 
  5243 00001301 <res 00000064>      <1> IFTRUE resb 100 
  5244 00001365 <res 00000004>      <1> BATCHPOS resb 4 
  5245 00001369 <res 00000001>      <1> BATCHISON resb 1 
  5246 0000136A <res 00000001>      <1> LOOPON resb 1 
  5247 0000136B <res 00000004>      <1> LOOPPOS	resb 4 
  5248 0000136F <res 00000200>      <1> fileindex: resb 200h 
  5249                              <1> fileindexend:
  5250 0000156F <res 00000500>      <1> variables: 	resb 500h 
  5251 00001A6F <res 00000001>      <1> varend: resb 1 
  5252 00001A70 <res 00000200>      <1> buftxt: resb 200h 
  5253 00001C70 <res 00000014>      <1> buf2:	resb 20 
  5254 00001C84 <res 00000001>      <1> numbuf: resb 1 
  5255 00001C85 <res 000012C0>      <1> videobuf2 		resb 0x12C0 
  5256 00002F45 <res 000000C8>      <1> videobufend		resb 200 
  5257                              <1> ;processcache:	;;eip, eax, ebx, ecx, edx, edi, esi, esp, ebp-9*4=36 bytes each
  5258                              <1> ;processcacheend:
  5259                              <1> ;alignb 4096		;;align 4 kbytes
  5260                              <1> ;ospagedir:
  5261                              <1> ;	resb 4096
  5262                              <1> ;ospagedirend:
  5263                              <1> ;pagetables:
  5264                              <1> ;	resb 4096
  5265                              <1> bssend:
  5266                              <1> [section .text]
  5267                                      %include 'files.asm'
  5268 00004CC4 00<rept>            <1> align 512,db 0
  5269                              <1> f0:
  5270 00004CC4 <incbin>            <1> incbin "included/exp"
  5271 00004E22 00<rept>            <1> align 512,db 0
  5272                              <1> f1:
  5273 00004E22 <incbin>            <1> incbin "included/solleros.bmp"
  5274 0005AFE6 00<rept>            <1> align 512,db 0
  5275                              <1> f2:
  5276 0005AFE6 <incbin>            <1> incbin "included/solleros.txt"
  5277 0005B176 00<rept>            <1> align 512,db 0
  5278                              <1> f3:
  5279 0005B176 <incbin>            <1> incbin "included/tely"
  5280 0005B3BD 00<rept>            <1> align 512,db 0
  5281                              <1> f4:
  5282 0005B3BD <incbin>            <1> incbin "included/Thumbs.db"
  5283                              <1> align 512,db 0
  5284                              <1> f5:
  5285 0005B3BD <incbin>            <1> incbin "included/time"
  5286 0005F47B 00<rept>            <1> align 512,db 0
  5287                              <1> f6:
  5288 0005F47B <incbin>            <1> incbin "included/tutorial.bat"
  5289 0005FAAA 00<rept>            <1> align 512,db 0
  5290                              <1> f7:
