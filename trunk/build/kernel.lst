     1                                  [map symbols build/kernel.map]
     2                                  %include "config.asm"
     3                              <1> ;These flags are used to configure options as on, put a simicolon in front of it to not configure it
     4                              <1> 
     5                              <1> %define gui.included
     6                              <1> ;Turn on the gui
     7                              <1> 
     8                              <1> ;%define gui.alphablending
     9                              <1> ;Make the terminal in the GUI 25% transparent
    10                              <1> 
    11                              <1> ;%define gui.background
    12                              <1> ;Make the GUI have a loadable background
    13                              <1> 
    14                              <1> ;%define gui.time
    15                              <1> ;Show time in top right corner of screen
    16                              <1> 
    17                              <1> ;%define io.serial "1"
    18                              <1> ;Use the specified serial port for input and output instead of the keyboard and screen
    19                              <1> ;If the gui is included this should not be enabled
    20                              <1> 
    21                              <1> ;%define terminal.vsync
    22                              <1> ;Uses the RTC to automatically update the terminal at ~64Hz
    23                              <1> 	;WARNING:
    24                              <1> 	;This may cause problems on systems with non-standard RTC's
    25                              <1> 	;It is therefore recommended that you do not enable it even
    26                              <1> 	;though it gives a large speed improvement for character output
    27                              <1> 
    28                              <1> %define font.unicode
    29                              <1> ;Include a unicode font. Disable to use an ascii font
    30                              <1> 	
    31                              <1> %define hardware.automatic
    32                              <1> ;Automatically load the sound and network drivers.
    33                              <1> 
    34                              <1> %define threads.included
    35                              <1> ;Include the thread testing stuff-this uses a relatively large amount of memory
    36                              <1> 
    37                              <1> %define exceptions.included
    38                              <1> ;Display debugging information should crashes occur-also uses quite a bit of memory
    39                              <1> 
    40                              <1> ;%define disk.protected
    41                              <1> ;Use protected mode instead of real mode for disk access-this allows for multitasking with disk reads
    42                              <1> 
    43                              <1> %define disk.real
    44                              <1> ;Use real mode for disk access-this gives greater compatibility
    45                              <1> 
    46                              <1> %define sound.included
    47                              <1> ;This includes the sound drivers
    48                              <1> 
    49                              <1> %define network.included
    50                              <1> ;This includes the network stack
    51                              <1> 
    52                              <1> ;%define rtl8169.included
    53                              <1> ;This includes the RTL8169 drivers
    54                              <1> 
    55                              <1> ;%define rtl8139.included
    56                              <1> ;This includes the RTL8139 drivers
    57                              <1> 
    58                              <1> %define ne2000.included
    59                              <1> ;This includes the ne2000 drivers
    60                              <1> 
    61                              <1> ;%define i8254x.included
    62                              <1> ;This includes the Intel 8254x drivers
    63                              <1> 
    64                              <1> ;%define sector.debug
    65                              <1> ;Dump the contents of the first sector of SollerOS
    66                              <1> 
    67                              <1> ;%define dos.compatible
    68                              <1> ;Make the kernel loadable by dos.
    69                              <1> 
    70                              <1> ;%define system.simple
    71                              <1> ;The smallest possible system, overrides all options
    72                              <1> 
    73                              <1> ;FIX DEPENDANCIES
    74                              <1> %ifdef system.simple
    75                              <1> 	%undef dos.compatible	;overides all including dos.compatible
    76                              <1> 	%define UNDEFALL
    77                              <1> %endif
    78                              <1> %ifdef dos.compatible
    79                              <1> 	%define UNDEFALL
    80                              <1> %endif
    81                              <1> %ifdef UNDEFALL
    82                              <1> 	%undef io.serial
    83                              <1> 	%undef disk.real
    84                              <1> 	%undef gui.included
    85                              <1> 	%undef gui.alphablending
    86                              <1> 	%undef gui.background
    87                              <1> 	%undef terminal.vsync
    88                              <1> 	%undef font.unicode
    89                              <1> 	%undef hardware.automatic
    90                              <1> 	%undef threads.included
    91                              <1> 	%undef exceptions.included
    92                              <1> 	%undef disk.protected
    93                              <1> 	%undef sound.included
    94                              <1> 	%undef network.included
    95                              <1> 	%undef rtl8139.included
    96                              <1> 	%undef rtl8169.included
    97                              <1> 	%undef ne2000.included
    98                              <1> 	%undef i8254x.included
    99                              <1> 	%undef sector.debug
   100                              <1> 	%undef UNDEFALL
   101                              <1> %endif
   102                              <1> %ifdef system.simple
   103                              <1> 	%define io.serial "1"
   104                              <1> 	%define disk.real
   105                              <1> %endif
   106                              <1> %ifdef gui.included
   107                              <1> 	%undef io.serial
   108                              <1> %else
   109                              <1> 	%undef gui.alphablending
   110                              <1> 	%undef gui.background
   111                              <1> %endif
   112                              <1> %ifdef network.included
   113                              <1> %else
   114                              <1> 	%undef i8254x.included
   115                              <1> 	%undef ne2000.included
   116                              <1> 	%undef rtl8139.included
   117                              <1> 	%undef rtl8169.included
   118                              <1> %endif
   119                              <1> %ifdef disk.protected
   120                              <1> 	%undef disk.real
   121                              <1> %else
   122                              <1> 	%ifdef disk.real
   123                              <1> 	%else
   124                              <1> 		%define disk.none
   125                              <1> 	%endif
   126                              <1> %endif
   127                                  [ORG 0x100]
   128                                  	%include "source/signature.asm"
   129                              <1> header:
   130 00000000 EB12                <1> 	jmp short boot
   131                              <1> signature:
   132 00000002 536F6C6C65724F5320- <1> db "SollerOS ",0 ;Operating system name
   133 0000000B 00                  <1>
   134 0000000C 18010000            <1> dd 280	;version number
   135                              <1> signatureend:
   136 00000010 00940300                	dd bsscopy - header ;size of kernel data on disk
   137                                  [BITS 16]
   138                                      %include "source/boot.asm"
   139                              <1> boot:
   140 00000014 8CC8                <1> 	mov ax, cs
   141 00000016 8ED8                <1> 	mov ds, ax
   142 00000018 8EC0                <1> 	mov es, ax
   143 0000001A 8ED0                <1> 	mov ss, ax
   144 0000001C 0F31                <1> 	rdtsc
   145 0000001E 66A3[FF8E]          <1> 	mov [initialtsc], eax
   146 00000022 668916[038F]        <1> 	mov [initialtsc + 4], edx
   147 00000027 66A3[078F]          <1> 	mov [lasttsc], eax
   148 0000002B 668916[0B8F]        <1> 	mov [lasttsc + 4], edx
   149 00000030 880E[FA8E]          <1> 	mov [DriveNumber], cl
   150 00000034 66891E[FB8E]        <1> 	mov [lbaad], ebx
   151                              <1> %ifdef io.serial
   152                              <1> 	call getmemorysize
   153                              <1> 	mov si, serialmsg
   154                              <1> 	call printrm
   155                              <1> 	jmp pmode
   156                              <1> serialmsg: db 10,13,"SollerOS: Using serial port ",io.serial," for I/O.",0
   157                              <1> %else
   158 00000039 E80300              <1> 	call vgaset	;make users switch using a command-this leads to very fast boots
   159 0000003C E95300              <1> 	jmp pmode
   160                              <1> %endif
   161                              <1> 	
   162                              <1> vgaset:
   163 0000003F B81200              <1> 	mov ax, 12h
   164 00000042 31DB                <1> 	xor bx, bx
   165 00000044 CD10                <1> 	int 10h
   166 00000046 C606[F98E]00        <1> 	mov byte [guion], 0
   167 0000004B E80100              <1> 	call getmemorysize;get the memory map after the video is initialized
   168 0000004E C3                  <1> 	ret
   169                              <1> 
   170                              <1> getmemorysize:
   171 0000004F BF[0F8F]            <1> 	mov di, memlistbuf
   172 00000052 6631DB              <1> 	xor ebx, ebx
   173                              <1> getmemsizeloop:
   174 00000055 66B820E80000        <1> 	mov eax, 0xE820
   175 0000005B 66BA50414D53        <1> 	mov edx, 0x0534D4150
   176 00000061 66B918000000        <1> 	mov ecx, 24
   177 00000067 CD15                <1> 	int 0x15
   178 00000069 81C71800            <1> 	add di, 24
   179 0000006D 81FF[4F91]          <1> 	cmp di, memlistend
   180 00000071 7305                <1> 	jae nomoregetmemsize
   181 00000073 6685DB              <1> 	test ebx, ebx
   182 00000076 75DD                <1> 	jnz getmemsizeloop
   183                              <1> nomoregetmemsize:
   184 00000078 81EF[0F8F]          <1> 	sub di, memlistbuf
   185 0000007C 893E[4F91]          <1> 	mov [memlistend], di
   186 00000080 C3                  <1> 	ret
   187                              <1> 	
   188                              <1> printrm:			; 'si' comes in with string address
   189 00000081 BB0700              <1>     mov bx,07		; write to display
   190 00000084 B40E                <1>     mov ah,0Eh		; screen function
   191 00000086 8A04                <1>    .lp:    mov al,[si]         ; get next character
   192 00000088 84C0                <1>     test al,al		; look for terminator 
   193 0000008A 7405                <1>     jz .done	; zero byte at end of string
   194 0000008C CD10                <1>     int 10h		; write character to screen.    
   195 0000008E 46                  <1> 	inc si	     	; move to next character
   196 0000008F EBF5                <1>     jmp .lp		; loop
   197 00000091 C3                  <1> .done: ret
   198                                      %include "source/pmode.asm"
   199                              <1> [BITS 16]
   200                              <1> 
   201                              <1> pmode:
   202 00000092 6631C0              <1> 	xor eax, eax
   203 00000095 6631DB              <1> 	xor ebx, ebx
   204 00000098 6631C9              <1> 	xor ecx, ecx
   205 0000009B 6631D2              <1> 	xor edx, edx
   206 0000009E 6631F6              <1> 	xor esi, esi
   207 000000A1 6631FF              <1> 	xor edi, edi
   208 000000A4 BA9200              <1> 	mov dx, 0x92
   209 000000A7 EC                  <1> 	in al, dx	;A20
   210 000000A8 0C02                <1> 	or al, 2
   211 000000AA EE                  <1> 	out dx, al
   212 000000AB 8CCB                <1> 	mov bx,cs		; EBX=segment
   213 000000AD 66C1E304            <1> 	shl ebx,4		;	<< 4
   214 000000B1 6689D8              <1> 	mov eax, ebx		; EAX=linear address of segment base
   215 000000B4 A3[A303]            <1> 	mov [gdt2 + 2],ax
   216 000000B7 A3[AB03]            <1> 	mov [gdt3 + 2],ax
   217 000000BA 66C1E810            <1> 	shr eax,16
   218 000000BE A2[A503]            <1> 	mov [gdt2 + 4],al
   219 000000C1 A2[AD03]            <1> 	mov [gdt3 + 4],al
   220 000000C4 8826[A803]          <1> 	mov [gdt2 + 7],ah
   221 000000C8 8826[B003]          <1> 	mov [gdt3 + 7],ah
   222                              <1> 
   223 000000CC 66B8[00940300]      <1> 	mov eax, initialstack
   224 000000D2 660306[4B02]        <1> 	add eax, [newcodecache]
   225 000000D7 A3[9B03]            <1> 	mov [gdts + 2],ax
   226 000000DA 66C1E810            <1> 	shr eax, 16
   227 000000DE A2[9D03]            <1> 	mov [gdts + 4],al
   228 000000E1 8826[A003]          <1> 	mov [gdts + 7], ah
   229                              <1> 	
   230 000000E5 66A1[4B02]          <1> 	mov eax, [newcodecache]
   231 000000E9 A3[B303]            <1> 	mov [gdt4 + 2],ax
   232 000000EC A3[BB03]            <1> 	mov [gdt5 + 2],ax
   233 000000EF A3[C303]            <1> 	mov [gdtv8086 + 2], ax
   234 000000F2 A3[CB03]            <1> 	mov [gdtv80862 + 2], ax
   235 000000F5 66C1E810            <1> 	shr eax,16
   236 000000F9 A2[B503]            <1> 	mov [gdt4 + 4],al
   237 000000FC A2[BD03]            <1> 	mov [gdt5 + 4],al
   238 000000FF A2[C503]            <1> 	mov [gdtv8086 + 4],al
   239 00000102 A2[CD03]            <1> 	mov [gdtv80862 + 4],al
   240 00000105 8826[B803]          <1> 	mov [gdt4 + 7],ah
   241 00000109 8826[C003]          <1> 	mov [gdt5 + 7],ah
   242 0000010D 8826[C803]          <1> 	mov [gdtv8086 + 7],ah
   243 00000111 8826[D003]          <1> 	mov [gdtv80862 + 7],ah
   244                              <1> 	
   245 00000115 66B800004000        <1> 	mov eax, dosprogloc
   246 0000011B 660306[4B02]        <1> 	add eax, [newcodecache]
   247 00000120 A3[D303]            <1> 	mov [gdtdos + 2],ax
   248 00000123 A3[DB03]            <1> 	mov [gdtdos2 + 2],ax
   249 00000126 66C1E810            <1> 	shr eax,16
   250 0000012A A2[D503]            <1> 	mov [gdtdos + 4],al
   251 0000012D A2[DD03]            <1> 	mov [gdtdos2 + 4],al
   252 00000130 8826[D803]          <1> 	mov [gdtdos + 7],ah
   253 00000134 8826[E003]          <1> 	mov [gdtdos2 + 7],ah
   254                              <1> 	
   255                              <1> ; fix up gdt and idt
   256 00000138 67668D83[89030000]  <1> 	lea eax,[ebx + gdt]	; EAX=linear address of gdt
   257 00000140 66A3[7F03]          <1> 	mov [gdtr + 2],eax
   258 00000144 67668D83[E1030000]  <1> 	lea eax,[ebx + idt]	; EAX=linear address of idt
   259 0000014C 66A3[8503]          <1> 	mov [idtr + 2],eax
   260 00000150 FA                  <1> 	cli
   261 00000151 0F0116[7D03]        <1> 	lgdt [gdtr]
   262 00000156 0F011E[8303]        <1> 	lidt [idtr]
   263 0000015B 6631DB              <1> 	xor ebx, ebx
   264 0000015E 8CDB                <1> 	mov bx, ds
   265 00000160 66891E[4702]        <1> 	mov [basecache], ebx
   266 00000165 0F20C0              <1> 	mov eax,cr0
   267 00000168 0C01                <1> 	or al,1
   268 0000016A 0F22C0              <1> 	mov cr0,eax
   269 0000016D EA[7201]1800        <1> 	jmp SYS_CODE_SEL:do_pm
   270                              <1> [BITS 32]
   271                              <1> do_pm:
   272 00000172 31C0                <1> 	xor eax, eax
   273 00000174 66B82000            <1> 	mov ax, SYS_DATA_SEL
   274 00000178 8ED8                <1> 	mov ds, ax
   275 0000017A 8EC0                <1> 	mov es, ax
   276 0000017C 8EE0                <1> 	mov fs, ax
   277 0000017E 66B83000            <1> 	mov ax, NEW_DATA_SEL
   278 00000182 8EE8                <1> 	mov gs, ax
   279                              <1> 	
   280                              <1> copykernel:
   281 00000184 648B06              <1> 	mov eax, [fs:esi]
   282 00000187 658906              <1> 	mov [gs:esi], eax
   283 0000018A 81C604000000        <1> 	add esi, 4
   284 00000190 81FE[00940300]      <1> 	cmp esi, bsscopy
   285 00000196 72EC                <1> 	jb copykernel
   286 00000198 EA[9F010000]2800    <1> 	jmp NEW_CODE_SEL:done_copy
   287                              <1> 	
   288                              <1> done_copy:
   289 0000019F 66B83000            <1> 	mov ax, NEW_DATA_SEL	;these MUST be setup AFTER the kernel switches places!!!
   290 000001A3 8ED8                <1> 	mov ds, ax
   291 000001A5 8EC0                <1> 	mov es, ax
   292 000001A7 8EE0                <1> 	mov fs, ax
   293                              <1> 	;mov ax, STACK_SEL
   294 000001A9 8ED0                <1> 	mov ss, ax
   295 000001AB BC[00B40300]        <1> 	mov esp, stackend
   296 000001B0 66B82000            <1> 	mov ax, SYS_DATA_SEL
   297 000001B4 8EE8                <1> 	mov gs, ax
   298                              <1> 	
   299 000001B6 E817650000          <1> 	call initialize	;initialize drivers
   300                              <1> 	
   301 000001BB A1[4B020000]        <1> 	mov eax, [newcodecache]
   302 000001C0 C1E804              <1> 	shr eax, 4
   303 000001C3 A3[47020000]        <1> 	mov [basecache], eax
   304                              <1> 	
   305 000001C8 BE[52C82500]        <1> 	mov esi, bssend
   306 000001CD 31C0                <1> 	xor eax, eax
   307                              <1> clearkernelbuffers:
   308 000001CF 8906                <1> 	mov [esi], eax
   309 000001D1 81EE04000000        <1> 	sub esi, 4
   310 000001D7 81FE[00940300]      <1> 	cmp esi, bsscopy
   311 000001DD 77F0                <1> 	ja clearkernelbuffers
   312 000001DF FB                  <1> 	sti
   313                              <1> 
   314                              <1> getmemoryspace:
   315 000001E0 BE[0F8F0000]        <1> 	mov esi, memlistbuf
   316 000001E5 31FF                <1> 	xor edi, edi
   317 000001E7 668B3D[4F910000]    <1> 	mov di, [memlistend]
   318 000001EE 01F7                <1> 	add edi, esi
   319 000001F0 31C0                <1> 	xor eax, eax
   320                              <1> memoryspaceaddition:
   321 000001F2 39FE                <1> 	cmp esi, edi
   322 000001F4 7322                <1> 	jae finishedmemspacecalc
   323 000001F6 81C608000000        <1> 	add esi, 8
   324 000001FC 8B0E                <1> 	mov ecx, [esi]
   325 000001FE 81C608000000        <1> 	add esi, 8
   326 00000204 8B1E                <1> 	mov ebx, [esi]
   327 00000206 81C608000000        <1> 	add esi, 8
   328 0000020C 81FB01000000        <1> 	cmp ebx, 1
   329 00000212 75DE                <1> 	jne memoryspaceaddition
   330 00000214 01C8                <1> 	add eax, ecx
   331 00000216 EBDA                <1> 	jmp memoryspaceaddition
   332                              <1> finishedmemspacecalc:
   333 00000218 A3[5C020000]        <1> 	mov [memoryspace], eax
   334                              <1> %ifdef gui.included
   335 0000021D 803D[F98E0000]00    <1> 	cmp byte [guion], 0
   336 00000224 741C                <1> 	je normalstartup
   337 00000226 8B1D[47020000]      <1> 	mov ebx, [basecache]
   338 0000022C C1E304              <1> 	shl ebx, 4
   339 0000022F 8B3D[7A5A0000]      <1> 	mov edi, [physbaseptr]
   340 00000235 29DF                <1> 	sub edi, ebx
   341 00000237 893D[7A5A0000]      <1> 	mov [physbaseptr], edi
   342 0000023D E9956A0000          <1> 	jmp guiboot
   343                              <1> %endif
   344                              <1> normalstartup:
   345 00000242 E9EE280000          <1> 	jmp os
   346                              <1> 	
   347 00000247 00000000            <1> basecache dd 0
   348 0000024B 00001000            <1> newcodecache dd 0x100000
   349                              <1> 
   350 0000024F 00                  <1> testingcpuspeed db 0
   351 00000250 00000000            <1> cpuspeedperint dd 0
   352 00000254 0000000000000000    <1> cpuclocksperint dd 0,0
   353 0000025C 00000000            <1> memoryspace dd 0
   354 00000260 7D0A                <1> pitdiv dw 2685
   355 00000262 2E562200            <1> timeinterval dd 2250286
   356                              <1> ;if using the rtc, the default frequency yeilds a period of 976562.5ns
   357                              <1> ;for the pit, note that div=1 gives 838.09ns, the clock runs at 1.193182 MHz
   358                              <1> ;div=451 is 377981.0004, div=902 is 755962.0008,
   359                              <1> ;div=2685 is 2250286.00004ns, div=5370 is 4500572.00007ns
   360                              <1> ;div=55483 is 46500044.000006ns
   361                              <1> ;use one of those values for the minimum error
   362                              <1> 
   363 00000266 00                  <1> ticks db 0
   364 00000267 00000000            <1> timeseconds dd 0
   365 0000026B 00000000            <1> timenanoseconds dd 0
   366 0000026F 00                  <1> soundon db 0
   367 00000270 0000                <1> soundrepititions dw 0
   368 00000272 00000000            <1> soundpos dd 0
   369 00000276 00000000            <1> soundendpos dd 0
   370                              <1> 
   371                              <1> cpuspeedend:
   372 0000027A C605[4F020000]00    <1> 	mov byte [testingcpuspeed], 0
   373 00000281 A3[50020000]        <1> 	mov [cpuspeedperint], eax
   374 00000286 B8[E8530000]        <1> 	mov eax, cpuspeedloopend
   375 0000028B 890424              <1> 	mov [esp], eax
   376 0000028E E9DA000000          <1> 	jmp handled
   377                              <1> 
   378                              <1> pitinterrupt: ;this controls threading
   379 00000293 803D[4F020000]01    <1> 	cmp byte [testingcpuspeed], 1	;check to see if the cpu speed test is running
   380 0000029A 74DE                <1> 	je cpuspeedend
   381                              <1> 
   382 0000029C E8A6000000          <1> 	call timekeeper ;this updates the internal time
   383                              <1> 	
   384 000002A1 803D[6F020000]01    <1> 	cmp byte [soundon], 1
   385 000002A8 0F84B05B0000        <1> 	je near PCSpeakerRAW
   386                              <1> timerinterrupt:	;put this into the interrupt handler that controls threading
   387                              <1> %ifdef threads.included
   388 000002AE 803D[D26C0000]01    <1> 	cmp byte [threadson], 1
   389 000002B5 0F84B9690000        <1> 	je near threadswitch
   390                              <1> %endif
   391                              <1> keyinterrupt:		;checks for escape, if pressed, it quits the program currently running
   392 000002BB 803D[D26C0000]00    <1> 	cmp byte [threadson], 0
   393 000002C2 0F84A5000000        <1> 	je near handled
   394                              <1> %ifdef io.serial
   395                              <1> 	jmp handled
   396                              <1> %else
   397 000002C8 FE05[66020000]      <1> 	inc byte [ticks] ;every 256 ticks, check for keys
   398 000002CE 0F8599000000        <1> 	jnz near handled
   399                              <1> 	
   400 000002D4 60                  <1> 	pusha
   401 000002D5 E464                <1> 	in al, 64h
   402 000002D7 A820                <1> 	test al, 20h
   403 000002D9 0F858D000000        <1> 	jnz near handled2
   404 000002DF E460                <1> 	in al, 60h
   405 000002E1 3C01                <1> 	cmp al, 1		;escape
   406 000002E3 7405                <1> 	je userint
   407 000002E5 E982000000          <1> 	jmp handled2
   408                              <1> ;	cmp al, 0x57
   409                              <1> ;	jne near handled2
   410                              <1> ;pauseint:	;F11 pauses
   411                              <1> ;	in al, 64h
   412                              <1> ;	test al, 20h
   413                              <1> ;	jnz pauseint
   414                              <1> ;	in al, 60h
   415                              <1> ;	cmp al, 0xD7
   416                              <1> ;	jne pauseint
   417                              <1> ;	mov esi, pausemsg
   418                              <1> ;	call print
   419                              <1> ;pauselp:
   420                              <1> ;	in al, 64h
   421                              <1> ;	test al, 20h
   422                              <1> ;	jnz pauselp
   423                              <1> ;	in al, 60h
   424                              <1> ;	cmp al, 0x57
   425                              <1> ;	je near handled2
   426                              <1> ;	jmp pauselp
   427                              <1> ;pausemsg db "Paused",10,0
   428                              <1> userint:
   429 000002EA 31C0                <1> 	xor eax, eax
   430 000002EC 3905[04B40300]      <1> 	cmp [sigtable], eax
   431 000002F2 7410                <1> 	je .nosighook
   432 000002F4 8B1D[04B40300]      <1> 	mov ebx, [sigtable]
   433 000002FA 895C2420            <1> 	mov [esp + 32], ebx
   434                              <1> ;	mov [sigtable], eax
   435 000002FE B020                <1> 	mov al, 0x20
   436 00000300 E620                <1> 	out 0x20, al
   437 00000302 61                  <1> 	popa
   438 00000303 CF                  <1> 	iret
   439                              <1> .nosighook:
   440                              <1> 		;UNMASK ALL INTS
   441 00000304 E621                <1> 	out 0x21, al
   442 00000306 E6A1                <1> 	out 0xA1, al
   443 00000308 B020                <1> 	mov al, 0x20
   444 0000030A E6A0                <1> 	out 0xA0, al
   445 0000030C E620                <1> 	out 0x20, al
   446                              <1> 		;RESET PIT DIVISOR
   447 0000030E 66A1[60020000]      <1> 	mov ax, [pitdiv]
   448 00000314 E640                <1> 	out 0x40, al
   449 00000316 66C1C008            <1> 	rol ax, 8
   450 0000031A E640                <1> 	out 0x40, al
   451                              <1> 		;RESET PIC
   452 0000031C B020                <1> 	mov al, 0x20
   453 0000031E E620                <1> 	out 0x20, al
   454 00000320 61                  <1> 	popa
   455 00000321 5D                  <1> 	pop ebp
   456 00000322 5D                  <1> 	pop ebp
   457 00000323 9D                  <1> 	popf
   458 00000324 BC[00B40300]        <1> 	mov esp, stackend ;reset stack
   459 00000329 E95B290000          <1> 	jmp returnfromexp
   460                              <1> %endif
   461 0000032E 0A                  <1> rtcrate db 10
   462                              <1> rtcint:	;this runs at 64Hz which is perfect for 60Hz displays
   463                              <1> %ifdef io.serial
   464                              <1> %else
   465                              <1> %ifdef terminal.vsync
   466                              <1> 	cmp byte [termcopyneeded], 0
   467                              <1> 	je .nocopy
   468                              <1> 	call newtermcopy
   469                              <1> .nocopy
   470                              <1> 	push eax
   471                              <1> 	mov al, 0xC
   472                              <1> 	out 0x70, al
   473                              <1> 	in al, 0x71
   474                              <1> 	pop eax
   475                              <1> %endif
   476                              <1> %endif
   477 0000032F E940000000          <1> 	jmp handledboth
   478                              <1> %ifdef rtl8139.included
   479                              <1> rtl8139.irq:
   480                              <1> 	push edx
   481                              <1> 	push eax
   482                              <1> 	mov edx, [rtl8139.basenicaddr]
   483                              <1> 	add edx, rtl8139.ISR
   484                              <1> 	xor eax, eax
   485                              <1> 	in ax, dx
   486                              <1> 	out dx, ax
   487                              <1> 	pop eax
   488                              <1> 	pop edx
   489                              <1> 	jmp handledboth
   490                              <1> %endif
   491                              <1> %ifdef sound.included
   492                              <1> sblaster.irq:
   493 00000334 60                  <1> 	pusha
   494 00000335 803D[4E610000]01    <1> 	cmp byte [SoundBlaster], 1
   495 0000033C 0F84065C0000        <1> 	je near sblaster.cont
   496 00000342 E925000000          <1> 	jmp handled2
   497                              <1> %endif
   498                              <1> 	
   499                              <1> timekeeper:
   500 00000347 50                  <1> 	push eax
   501 00000348 A1[6B020000]        <1> 	mov eax, [timenanoseconds]
   502 0000034D 0305[62020000]      <1> 	add eax, [timeinterval]
   503 00000353 3D00CA9A3B          <1> 	cmp eax, 1000000000
   504 00000358 720B                <1> 	jb nonanosecondrollover
   505 0000035A FF05[67020000]      <1> 	inc dword [timeseconds]
   506 00000360 2D00CA9A3B          <1> 	sub eax, 1000000000
   507                              <1> 	%ifdef gui.time
   508                              <1> 		;REMOVE THIS IT IS NOT EFFICIENT
   509                              <1> 		cmp byte [guion], 1
   510                              <1> 		jne nonanosecondrollover
   511                              <1> 		cmp dword [dragging], 0
   512                              <1> 		jne nonanosecondrollover
   513                              <1> 		pusha
   514                              <1> 		call guitime
   515                              <1> 		popa
   516                              <1> 	%endif
   517                              <1> nonanosecondrollover:
   518 00000365 A3[6B020000]        <1> 	mov [timenanoseconds], eax
   519 0000036A 58                  <1> 	pop eax
   520 0000036B C3                  <1> 	ret
   521                              <1> 	
   522                              <1> handled2:
   523 0000036C 61                  <1> 	popa
   524                              <1> handled:
   525 0000036D 50                  <1> 	push eax
   526 0000036E B020                <1> 	mov al, 0x20
   527 00000370 E620                <1> 	out 0x20, al
   528 00000372 58                  <1> 	pop eax
   529 00000373 CF                  <1> 	iret
   530                              <1> handledboth:
   531 00000374 50                  <1> 	push eax
   532 00000375 B020                <1> 	mov al, 0x20
   533 00000377 E6A0                <1> 	out 0xA0, al
   534 00000379 E620                <1> 	out 0x20, al
   535 0000037B 58                  <1> 	pop eax
   536 0000037C CF                  <1> 	iret
   537                              <1> 	
   538                              <1> ;	16-bit limit/32-bit linear base address of GDT and IDT
   539 0000037D 5700                <1> gdtr:	dw gdt_end - gdt - 1	; GDT limit
   540 0000037F 00000000            <1> 	dd 0    		; filled with linear, physical address of GDT
   541                              <1> 
   542 00000383 FF07                <1> idtr:	dw idt_end - idt - 1	; IDT limit
   543 00000385 00000000            <1> 	dd 0			; filled with linear, physical address of IDT
   544                              <1> 
   545                              <1> 
   546 00000389 0000                <1> gdt:	dw 0			; limit 15:0
   547 0000038B 0000                <1> 	dw 0			; base 15:0
   548 0000038D 00                  <1> 	db 0			; base 23:16
   549 0000038E 00                  <1> 	db 0			; type
   550 0000038F 00                  <1> 	db 0			; limit 19:16, flags
   551 00000390 00                  <1> 	db 0			; base 31:24
   552                              <1> ; linear data segment descriptor
   553                              <1> LINEAR_SEL	equ	$-gdt
   554 00000391 FFFF                <1> 	dw 0xFFFF		; limit 0xFFFFF
   555 00000393 0000                <1> 	dw 0			; base for this one is always 0
   556 00000395 00                  <1> 	db 0
   557 00000396 92                  <1> 	db 0x92			; present, ring 0, data, expand-up, writable
   558 00000397 CF                  <1> 	db 0xCF			; page-granular, 32-bit
   559 00000398 00                  <1> 	db 0
   560                              <1> STACK_SEL	equ $-gdt
   561 00000399 0200                <1> gdts:	dw 2;(stackend)/4096
   562 0000039B 0000                <1> 	dw 0
   563 0000039D 00                  <1> 	db 0
   564 0000039E 92                  <1> 	db 0x92
   565 0000039F CF                  <1> 	db 0xCF
   566 000003A0 00                  <1> 	db 0
   567                              <1> ; code segment descriptor
   568                              <1> SYS_CODE_SEL	equ	$-gdt
   569 000003A1 FFFF                <1> gdt2:	dw 0xFFFF
   570 000003A3 0000                <1> 	dw 0			; (base gets set above)
   571 000003A5 00                  <1> 	db 0
   572 000003A6 9A                  <1> 	db 0x9A			; present, ring 0, code, non-conforming, readable
   573 000003A7 CF                  <1> 	db 0xCF
   574 000003A8 00                  <1> 	db 0
   575                              <1> ; data segment descriptor
   576                              <1> SYS_DATA_SEL	equ	$-gdt
   577 000003A9 FFFF                <1> gdt3:	dw 0xFFFF
   578 000003AB 0000                <1> 	dw 0			; (base gets set above)
   579 000003AD 00                  <1> 	db 0
   580 000003AE 92                  <1> 	db 0x92			; present, ring 0, data, expand-up, writable
   581 000003AF CF                  <1> 	db 0xCF
   582 000003B0 00                  <1> 	db 0
   583                              <1> NEW_CODE_SEL	equ	$-gdt
   584 000003B1 FFFF                <1> gdt4:	dw 0xFFFF
   585 000003B3 0000                <1> 	dw 0			; (base gets set above)
   586 000003B5 00                  <1> 	db 0
   587 000003B6 9A                  <1> 	db 0x9A			; present, ring 0, code, non-conforming, readable
   588 000003B7 CF                  <1> 	db 0xCF
   589 000003B8 00                  <1> 	db 0
   590                              <1> ; data segment descriptor
   591                              <1> NEW_DATA_SEL	equ	$-gdt
   592 000003B9 FFFF                <1> gdt5:	dw 0xFFFF
   593 000003BB 0000                <1> 	dw 0			; (base gets set above)
   594 000003BD 00                  <1> 	db 0
   595 000003BE 92                  <1> 	db 0x92			; present, ring 0, data, expand-up, writable
   596 000003BF CF                  <1> 	db 0xCF
   597 000003C0 00                  <1> 	db 0
   598                              <1> V8086_CODE_SEL	equ $-gdt
   599 000003C1 FFFF                <1> gdtv8086: dw 0xFFFF
   600 000003C3 0000                <1> 	dw 0
   601 000003C5 00                  <1> 	db 0
   602 000003C6 9A                  <1> 	db 0x9A
   603 000003C7 8F                  <1> 	db 0x8F
   604 000003C8 00                  <1> 	db 0
   605                              <1> V8086_DATA_SEL	equ $-gdt
   606 000003C9 FFFF                <1> gdtv80862: dw 0xFFFF
   607 000003CB 0000                <1> 	dw 0
   608 000003CD 00                  <1> 	db 0
   609 000003CE 92                  <1> 	db 0x92
   610 000003CF 8F                  <1> 	db 0x8F
   611 000003D0 00                  <1> 	db 0
   612                              <1> DOS_CODE_SEL	equ $-gdt	;this gives dos programs complete access to one megabyte at the beginning of memory
   613 000003D1 0001                <1> gdtdos:	dw 256	;give it 1 MB
   614 000003D3 0000                <1> 	dw 0
   615 000003D5 00                  <1> 	db 0
   616 000003D6 9A                  <1> 	db 0x9A
   617 000003D7 8F                  <1> 	db 0x8F ;16 bit
   618 000003D8 00                  <1> 	db 0
   619                              <1> DOS_DATA_SEL 	equ $-gdt
   620 000003D9 0001                <1> gdtdos2:	dw 256
   621 000003DB 0000                <1> 	dw 0
   622 000003DD 00                  <1> 	db 0
   623 000003DE 92                  <1> 	db 0x92
   624 000003DF 8F                  <1> 	db 0x8F ;16 bit
   625 000003E0 00                  <1> 	db 0
   626                              <1> gdt_end:
   627                              <1> 
   628                              <1> ;	interrupt descriptor table (IDT)
   629                              <1> ; 32 reserved interrupts:
   630                              <1> idt:	
   631                              <1> %assign i 0
   632                              <1> %rep    8
   633                              <1> 		dw unhand + i*12,NEW_CODE_SEL,0x8E00,0
   634                              <1> %assign i i+1
   635                              <1> %endrep
   636 000003E1 [F90C]2800008E0000  <2>  dw unhand + i*12,NEW_CODE_SEL,0x8E00,0
   637                              <2> %assign i i+1
   638 000003E9 [050D]2800008E0000  <2>  dw unhand + i*12,NEW_CODE_SEL,0x8E00,0
   639                              <2> %assign i i+1
   640 000003F1 [110D]2800008E0000  <2>  dw unhand + i*12,NEW_CODE_SEL,0x8E00,0
   641                              <2> %assign i i+1
   642 000003F9 [1D0D]2800008E0000  <2>  dw unhand + i*12,NEW_CODE_SEL,0x8E00,0
   643                              <2> %assign i i+1
   644 00000401 [290D]2800008E0000  <2>  dw unhand + i*12,NEW_CODE_SEL,0x8E00,0
   645                              <2> %assign i i+1
   646 00000409 [350D]2800008E0000  <2>  dw unhand + i*12,NEW_CODE_SEL,0x8E00,0
   647                              <2> %assign i i+1
   648 00000411 [410D]2800008E0000  <2>  dw unhand + i*12,NEW_CODE_SEL,0x8E00,0
   649                              <2> %assign i i+1
   650 00000419 [4D0D]2800008E0000  <2>  dw unhand + i*12,NEW_CODE_SEL,0x8E00,0
   651                              <2> %assign i i+1
   652 00000421 [590D]1800008E0000  <1> 		dw unhand + 8*12,SYS_CODE_SEL,0x8E00,0	;double fault handler in original memory
   653                              <1> %assign i 9
   654                              <1> %rep    23
   655                              <1> 		dw unhand + i*12,NEW_CODE_SEL,0x8E00,0
   656                              <1> %assign i i+1
   657                              <1> %endrep
   658 00000429 [650D]2800008E0000  <2>  dw unhand + i*12,NEW_CODE_SEL,0x8E00,0
   659                              <2> %assign i i+1
   660 00000431 [710D]2800008E0000  <2>  dw unhand + i*12,NEW_CODE_SEL,0x8E00,0
   661                              <2> %assign i i+1
   662 00000439 [7D0D]2800008E0000  <2>  dw unhand + i*12,NEW_CODE_SEL,0x8E00,0
   663                              <2> %assign i i+1
   664 00000441 [890D]2800008E0000  <2>  dw unhand + i*12,NEW_CODE_SEL,0x8E00,0
   665                              <2> %assign i i+1
   666 00000449 [950D]2800008E0000  <2>  dw unhand + i*12,NEW_CODE_SEL,0x8E00,0
   667                              <2> %assign i i+1
   668 00000451 [A10D]2800008E0000  <2>  dw unhand + i*12,NEW_CODE_SEL,0x8E00,0
   669                              <2> %assign i i+1
   670 00000459 [AD0D]2800008E0000  <2>  dw unhand + i*12,NEW_CODE_SEL,0x8E00,0
   671                              <2> %assign i i+1
   672 00000461 [B90D]2800008E0000  <2>  dw unhand + i*12,NEW_CODE_SEL,0x8E00,0
   673                              <2> %assign i i+1
   674 00000469 [C50D]2800008E0000  <2>  dw unhand + i*12,NEW_CODE_SEL,0x8E00,0
   675                              <2> %assign i i+1
   676 00000471 [D10D]2800008E0000  <2>  dw unhand + i*12,NEW_CODE_SEL,0x8E00,0
   677                              <2> %assign i i+1
   678 00000479 [DD0D]2800008E0000  <2>  dw unhand + i*12,NEW_CODE_SEL,0x8E00,0
   679                              <2> %assign i i+1
   680 00000481 [E90D]2800008E0000  <2>  dw unhand + i*12,NEW_CODE_SEL,0x8E00,0
   681                              <2> %assign i i+1
   682 00000489 [F50D]2800008E0000  <2>  dw unhand + i*12,NEW_CODE_SEL,0x8E00,0
   683                              <2> %assign i i+1
   684 00000491 [010E]2800008E0000  <2>  dw unhand + i*12,NEW_CODE_SEL,0x8E00,0
   685                              <2> %assign i i+1
   686 00000499 [0D0E]2800008E0000  <2>  dw unhand + i*12,NEW_CODE_SEL,0x8E00,0
   687                              <2> %assign i i+1
   688 000004A1 [190E]2800008E0000  <2>  dw unhand + i*12,NEW_CODE_SEL,0x8E00,0
   689                              <2> %assign i i+1
   690 000004A9 [250E]2800008E0000  <2>  dw unhand + i*12,NEW_CODE_SEL,0x8E00,0
   691                              <2> %assign i i+1
   692 000004B1 [310E]2800008E0000  <2>  dw unhand + i*12,NEW_CODE_SEL,0x8E00,0
   693                              <2> %assign i i+1
   694 000004B9 [3D0E]2800008E0000  <2>  dw unhand + i*12,NEW_CODE_SEL,0x8E00,0
   695                              <2> %assign i i+1
   696 000004C1 [490E]2800008E0000  <2>  dw unhand + i*12,NEW_CODE_SEL,0x8E00,0
   697                              <2> %assign i i+1
   698 000004C9 [550E]2800008E0000  <2>  dw unhand + i*12,NEW_CODE_SEL,0x8E00,0
   699                              <2> %assign i i+1
   700 000004D1 [610E]2800008E0000  <2>  dw unhand + i*12,NEW_CODE_SEL,0x8E00,0
   701                              <2> %assign i i+1
   702 000004D9 [6D0E]2800008E0000  <2>  dw unhand + i*12,NEW_CODE_SEL,0x8E00,0
   703                              <2> %assign i i+1
   704 000004E1 [F729]2800008E0000  <1> 		dw int20h,NEW_CODE_SEL,0x8E00,0 ;dos ints
   705 000004E9 [FB29]2800008E0000  <1> 		dw int21h,NEW_CODE_SEL,0x8E00,0
   706                              <1> %assign i 0x22
   707                              <1> %rep 14
   708                              <1> 		dw handled,NEW_CODE_SEL,0x8E00,0
   709                              <1> %assign i +1
   710                              <1> %endrep
   711 000004F1 [6D03]2800008E0000  <2>  dw handled,NEW_CODE_SEL,0x8E00,0
   712                              <2> %assign i +1
   713 000004F9 [6D03]2800008E0000  <2>  dw handled,NEW_CODE_SEL,0x8E00,0
   714                              <2> %assign i +1
   715 00000501 [6D03]2800008E0000  <2>  dw handled,NEW_CODE_SEL,0x8E00,0
   716                              <2> %assign i +1
   717 00000509 [6D03]2800008E0000  <2>  dw handled,NEW_CODE_SEL,0x8E00,0
   718                              <2> %assign i +1
   719 00000511 [6D03]2800008E0000  <2>  dw handled,NEW_CODE_SEL,0x8E00,0
   720                              <2> %assign i +1
   721 00000519 [6D03]2800008E0000  <2>  dw handled,NEW_CODE_SEL,0x8E00,0
   722                              <2> %assign i +1
   723 00000521 [6D03]2800008E0000  <2>  dw handled,NEW_CODE_SEL,0x8E00,0
   724                              <2> %assign i +1
   725 00000529 [6D03]2800008E0000  <2>  dw handled,NEW_CODE_SEL,0x8E00,0
   726                              <2> %assign i +1
   727 00000531 [6D03]2800008E0000  <2>  dw handled,NEW_CODE_SEL,0x8E00,0
   728                              <2> %assign i +1
   729 00000539 [6D03]2800008E0000  <2>  dw handled,NEW_CODE_SEL,0x8E00,0
   730                              <2> %assign i +1
   731 00000541 [6D03]2800008E0000  <2>  dw handled,NEW_CODE_SEL,0x8E00,0
   732                              <2> %assign i +1
   733 00000549 [6D03]2800008E0000  <2>  dw handled,NEW_CODE_SEL,0x8E00,0
   734                              <2> %assign i +1
   735 00000551 [6D03]2800008E0000  <2>  dw handled,NEW_CODE_SEL,0x8E00,0
   736                              <2> %assign i +1
   737 00000559 [6D03]2800008E0000  <2>  dw handled,NEW_CODE_SEL,0x8E00,0
   738                              <2> %assign i +1
   739                              <1> ;INT 30h for os use and 3rd party use:
   740 00000561 [F81B]2800008E0000  <1> 		dw int30h,NEW_CODE_SEL,0x8E00,0
   741                              <1> %assign i 0x31
   742                              <1> %rep 15
   743                              <1> 		dw handled,NEW_CODE_SEL,0x8E00,0
   744                              <1> %assign i +1
   745                              <1> %endrep
   746 00000569 [6D03]2800008E0000  <2>  dw handled,NEW_CODE_SEL,0x8E00,0
   747                              <2> %assign i +1
   748 00000571 [6D03]2800008E0000  <2>  dw handled,NEW_CODE_SEL,0x8E00,0
   749                              <2> %assign i +1
   750 00000579 [6D03]2800008E0000  <2>  dw handled,NEW_CODE_SEL,0x8E00,0
   751                              <2> %assign i +1
   752 00000581 [6D03]2800008E0000  <2>  dw handled,NEW_CODE_SEL,0x8E00,0
   753                              <2> %assign i +1
   754 00000589 [6D03]2800008E0000  <2>  dw handled,NEW_CODE_SEL,0x8E00,0
   755                              <2> %assign i +1
   756 00000591 [6D03]2800008E0000  <2>  dw handled,NEW_CODE_SEL,0x8E00,0
   757                              <2> %assign i +1
   758 00000599 [6D03]2800008E0000  <2>  dw handled,NEW_CODE_SEL,0x8E00,0
   759                              <2> %assign i +1
   760 000005A1 [6D03]2800008E0000  <2>  dw handled,NEW_CODE_SEL,0x8E00,0
   761                              <2> %assign i +1
   762 000005A9 [6D03]2800008E0000  <2>  dw handled,NEW_CODE_SEL,0x8E00,0
   763                              <2> %assign i +1
   764 000005B1 [6D03]2800008E0000  <2>  dw handled,NEW_CODE_SEL,0x8E00,0
   765                              <2> %assign i +1
   766 000005B9 [6D03]2800008E0000  <2>  dw handled,NEW_CODE_SEL,0x8E00,0
   767                              <2> %assign i +1
   768 000005C1 [6D03]2800008E0000  <2>  dw handled,NEW_CODE_SEL,0x8E00,0
   769                              <2> %assign i +1
   770 000005C9 [6D03]2800008E0000  <2>  dw handled,NEW_CODE_SEL,0x8E00,0
   771                              <2> %assign i +1
   772 000005D1 [6D03]2800008E0000  <2>  dw handled,NEW_CODE_SEL,0x8E00,0
   773                              <2> %assign i +1
   774 000005D9 [6D03]2800008E0000  <2>  dw handled,NEW_CODE_SEL,0x8E00,0
   775                              <2> %assign i +1
   776                              <1> ;and here we are at 0x40
   777                              <1> ;here are all the irq's
   778 000005E1 [9302]2800008E0000  <1> 		dw pitinterrupt,NEW_CODE_SEL,0x8E00,0 ;IRQ 0 = PIT
   779 000005E9 [6D03]2800008E0000  <1> 		dw handled,NEW_CODE_SEL,0x8E00,0 ;IRQ 1 = keyboard
   780 000005F1 [6D03]2800008E0000  <1> 		dw handled,NEW_CODE_SEL,0x8E00,0 ;IRQ 2
   781 000005F9 [6D03]2800008E0000  <1> 		dw handled,NEW_CODE_SEL,0x8E00,0 ;IRQ 3
   782 00000601 [6D03]2800008E0000  <1> 		dw handled,NEW_CODE_SEL,0x8E00,0 ;IRQ 4
   783                              <1> 	%ifdef sound.included
   784 00000609 [3403]2800008E0000  <1> 		dw sblaster.irq,NEW_CODE_SEL,0x8E00,0 ;IRQ 5 = default SoundBlaster
   785                              <1> 	%else
   786                              <1> 		dw handled,NEW_CODE_SEL,0x8E00,0 ;IRQ 5
   787                              <1> 	%endif
   788 00000611 [6D03]2800008E0000  <1> 		dw handled,NEW_CODE_SEL,0x8E00,0 ;IRQ 6
   789 00000619 [6D03]2800008E0000  <1> 		dw handled,NEW_CODE_SEL,0x8E00,0 ;IRQ 7
   790 00000621 [2F03]2800008E0000  <1> 		dw rtcint,NEW_CODE_SEL,0x8E00,0 ;IRQ 8 = RTC
   791 00000629 [7403]2800008E0000  <1> 		dw handledboth,NEW_CODE_SEL,0x8E00,0 ;IRQ 9 = default NE2000
   792 00000631 [7403]2800008E0000  <1> 		dw handledboth,NEW_CODE_SEL,0x8E00,0 ;IRQ 10
   793                              <1> 	%ifdef rtl8139.included
   794                              <1> 		dw rtl8139.irq,NEW_CODE_SEL,0x8E00,0 ;IRQ 11 = default RTL8139
   795                              <1> 	%else
   796 00000639 [7403]2800008E0000  <1> 		dw handledboth,NEW_CODE_SEL,0x8E00,0 ;IRQ 11
   797                              <1> 	%endif
   798 00000641 [7403]2800008E0000  <1> 		dw handledboth,NEW_CODE_SEL,0x8E00,0 ;IRQ 12
   799 00000649 [7403]2800008E0000  <1> 		dw handledboth,NEW_CODE_SEL,0x8E00,0 ;IRQ 13
   800 00000651 [7403]2800008E0000  <1> 		dw handledboth,NEW_CODE_SEL,0x8E00,0 ;IRQ 14
   801 00000659 [7403]2800008E0000  <1> 		dw handledboth,NEW_CODE_SEL,0x8E00,0 ;IRQ 15
   802                              <1> ;This brings me up to 0x50
   803                              <1> %assign i 0x50
   804                              <1> %rep 176
   805                              <1> 		dw handled, NEW_CODE_SEL,0x8E00,0
   806                              <1> 		;dw unhand + i*12, NEW_CODE_SEL,0x8E00,0
   807                              <1> %assign i +1
   808                              <1> %endrep
   809 00000661 [6D03]2800008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
   810                              <2> 
   811                              <2> %assign i +1
   812 00000669 [6D03]2800008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
   813                              <2> 
   814                              <2> %assign i +1
   815 00000671 [6D03]2800008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
   816                              <2> 
   817                              <2> %assign i +1
   818 00000679 [6D03]2800008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
   819                              <2> 
   820                              <2> %assign i +1
   821 00000681 [6D03]2800008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
   822                              <2> 
   823                              <2> %assign i +1
   824 00000689 [6D03]2800008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
   825                              <2> 
   826                              <2> %assign i +1
   827 00000691 [6D03]2800008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
   828                              <2> 
   829                              <2> %assign i +1
   830 00000699 [6D03]2800008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
   831                              <2> 
   832                              <2> %assign i +1
   833 000006A1 [6D03]2800008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
   834                              <2> 
   835                              <2> %assign i +1
   836 000006A9 [6D03]2800008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
   837                              <2> 
   838                              <2> %assign i +1
   839 000006B1 [6D03]2800008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
   840                              <2> 
   841                              <2> %assign i +1
   842 000006B9 [6D03]2800008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
   843                              <2> 
   844                              <2> %assign i +1
   845 000006C1 [6D03]2800008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
   846                              <2> 
   847                              <2> %assign i +1
   848 000006C9 [6D03]2800008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
   849                              <2> 
   850                              <2> %assign i +1
   851 000006D1 [6D03]2800008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
   852                              <2> 
   853                              <2> %assign i +1
   854 000006D9 [6D03]2800008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
   855                              <2> 
   856                              <2> %assign i +1
   857 000006E1 [6D03]2800008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
   858                              <2> 
   859                              <2> %assign i +1
   860 000006E9 [6D03]2800008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
   861                              <2> 
   862                              <2> %assign i +1
   863 000006F1 [6D03]2800008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
   864                              <2> 
   865                              <2> %assign i +1
   866 000006F9 [6D03]2800008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
   867                              <2> 
   868                              <2> %assign i +1
   869 00000701 [6D03]2800008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
   870                              <2> 
   871                              <2> %assign i +1
   872 00000709 [6D03]2800008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
   873                              <2> 
   874                              <2> %assign i +1
   875 00000711 [6D03]2800008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
   876                              <2> 
   877                              <2> %assign i +1
   878 00000719 [6D03]2800008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
   879                              <2> 
   880                              <2> %assign i +1
   881 00000721 [6D03]2800008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
   882                              <2> 
   883                              <2> %assign i +1
   884 00000729 [6D03]2800008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
   885                              <2> 
   886                              <2> %assign i +1
   887 00000731 [6D03]2800008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
   888                              <2> 
   889                              <2> %assign i +1
   890 00000739 [6D03]2800008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
   891                              <2> 
   892                              <2> %assign i +1
   893 00000741 [6D03]2800008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
   894                              <2> 
   895                              <2> %assign i +1
   896 00000749 [6D03]2800008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
   897                              <2> 
   898                              <2> %assign i +1
   899 00000751 [6D03]2800008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
   900                              <2> 
   901                              <2> %assign i +1
   902 00000759 [6D03]2800008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
   903                              <2> 
   904                              <2> %assign i +1
   905 00000761 [6D03]2800008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
   906                              <2> 
   907                              <2> %assign i +1
   908 00000769 [6D03]2800008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
   909                              <2> 
   910                              <2> %assign i +1
   911 00000771 [6D03]2800008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
   912                              <2> 
   913                              <2> %assign i +1
   914 00000779 [6D03]2800008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
   915                              <2> 
   916                              <2> %assign i +1
   917 00000781 [6D03]2800008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
   918                              <2> 
   919                              <2> %assign i +1
   920 00000789 [6D03]2800008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
   921                              <2> 
   922                              <2> %assign i +1
   923 00000791 [6D03]2800008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
   924                              <2> 
   925                              <2> %assign i +1
   926 00000799 [6D03]2800008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
   927                              <2> 
   928                              <2> %assign i +1
   929 000007A1 [6D03]2800008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
   930                              <2> 
   931                              <2> %assign i +1
   932 000007A9 [6D03]2800008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
   933                              <2> 
   934                              <2> %assign i +1
   935 000007B1 [6D03]2800008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
   936                              <2> 
   937                              <2> %assign i +1
   938 000007B9 [6D03]2800008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
   939                              <2> 
   940                              <2> %assign i +1
   941 000007C1 [6D03]2800008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
   942                              <2> 
   943                              <2> %assign i +1
   944 000007C9 [6D03]2800008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
   945                              <2> 
   946                              <2> %assign i +1
   947 000007D1 [6D03]2800008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
   948                              <2> 
   949                              <2> %assign i +1
   950 000007D9 [6D03]2800008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
   951                              <2> 
   952                              <2> %assign i +1
   953 000007E1 [6D03]2800008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
   954                              <2> 
   955                              <2> %assign i +1
   956 000007E9 [6D03]2800008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
   957                              <2> 
   958                              <2> %assign i +1
   959 000007F1 [6D03]2800008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
   960                              <2> 
   961                              <2> %assign i +1
   962 000007F9 [6D03]2800008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
   963                              <2> 
   964                              <2> %assign i +1
   965 00000801 [6D03]2800008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
   966                              <2> 
   967                              <2> %assign i +1
   968 00000809 [6D03]2800008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
   969                              <2> 
   970                              <2> %assign i +1
   971 00000811 [6D03]2800008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
   972                              <2> 
   973                              <2> %assign i +1
   974 00000819 [6D03]2800008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
   975                              <2> 
   976                              <2> %assign i +1
   977 00000821 [6D03]2800008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
   978                              <2> 
   979                              <2> %assign i +1
   980 00000829 [6D03]2800008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
   981                              <2> 
   982                              <2> %assign i +1
   983 00000831 [6D03]2800008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
   984                              <2> 
   985                              <2> %assign i +1
   986 00000839 [6D03]2800008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
   987                              <2> 
   988                              <2> %assign i +1
   989 00000841 [6D03]2800008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
   990                              <2> 
   991                              <2> %assign i +1
   992 00000849 [6D03]2800008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
   993                              <2> 
   994                              <2> %assign i +1
   995 00000851 [6D03]2800008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
   996                              <2> 
   997                              <2> %assign i +1
   998 00000859 [6D03]2800008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
   999                              <2> 
  1000                              <2> %assign i +1
  1001 00000861 [6D03]2800008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1002                              <2> 
  1003                              <2> %assign i +1
  1004 00000869 [6D03]2800008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1005                              <2> 
  1006                              <2> %assign i +1
  1007 00000871 [6D03]2800008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1008                              <2> 
  1009                              <2> %assign i +1
  1010 00000879 [6D03]2800008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1011                              <2> 
  1012                              <2> %assign i +1
  1013 00000881 [6D03]2800008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1014                              <2> 
  1015                              <2> %assign i +1
  1016 00000889 [6D03]2800008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1017                              <2> 
  1018                              <2> %assign i +1
  1019 00000891 [6D03]2800008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1020                              <2> 
  1021                              <2> %assign i +1
  1022 00000899 [6D03]2800008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1023                              <2> 
  1024                              <2> %assign i +1
  1025 000008A1 [6D03]2800008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1026                              <2> 
  1027                              <2> %assign i +1
  1028 000008A9 [6D03]2800008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1029                              <2> 
  1030                              <2> %assign i +1
  1031 000008B1 [6D03]2800008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1032                              <2> 
  1033                              <2> %assign i +1
  1034 000008B9 [6D03]2800008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1035                              <2> 
  1036                              <2> %assign i +1
  1037 000008C1 [6D03]2800008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1038                              <2> 
  1039                              <2> %assign i +1
  1040 000008C9 [6D03]2800008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1041                              <2> 
  1042                              <2> %assign i +1
  1043 000008D1 [6D03]2800008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1044                              <2> 
  1045                              <2> %assign i +1
  1046 000008D9 [6D03]2800008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1047                              <2> 
  1048                              <2> %assign i +1
  1049 000008E1 [6D03]2800008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1050                              <2> 
  1051                              <2> %assign i +1
  1052 000008E9 [6D03]2800008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1053                              <2> 
  1054                              <2> %assign i +1
  1055 000008F1 [6D03]2800008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1056                              <2> 
  1057                              <2> %assign i +1
  1058 000008F9 [6D03]2800008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1059                              <2> 
  1060                              <2> %assign i +1
  1061 00000901 [6D03]2800008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1062                              <2> 
  1063                              <2> %assign i +1
  1064 00000909 [6D03]2800008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1065                              <2> 
  1066                              <2> %assign i +1
  1067 00000911 [6D03]2800008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1068                              <2> 
  1069                              <2> %assign i +1
  1070 00000919 [6D03]2800008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1071                              <2> 
  1072                              <2> %assign i +1
  1073 00000921 [6D03]2800008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1074                              <2> 
  1075                              <2> %assign i +1
  1076 00000929 [6D03]2800008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1077                              <2> 
  1078                              <2> %assign i +1
  1079 00000931 [6D03]2800008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1080                              <2> 
  1081                              <2> %assign i +1
  1082 00000939 [6D03]2800008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1083                              <2> 
  1084                              <2> %assign i +1
  1085 00000941 [6D03]2800008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1086                              <2> 
  1087                              <2> %assign i +1
  1088 00000949 [6D03]2800008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1089                              <2> 
  1090                              <2> %assign i +1
  1091 00000951 [6D03]2800008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1092                              <2> 
  1093                              <2> %assign i +1
  1094 00000959 [6D03]2800008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1095                              <2> 
  1096                              <2> %assign i +1
  1097 00000961 [6D03]2800008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1098                              <2> 
  1099                              <2> %assign i +1
  1100 00000969 [6D03]2800008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1101                              <2> 
  1102                              <2> %assign i +1
  1103 00000971 [6D03]2800008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1104                              <2> 
  1105                              <2> %assign i +1
  1106 00000979 [6D03]2800008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1107                              <2> 
  1108                              <2> %assign i +1
  1109 00000981 [6D03]2800008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1110                              <2> 
  1111                              <2> %assign i +1
  1112 00000989 [6D03]2800008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1113                              <2> 
  1114                              <2> %assign i +1
  1115 00000991 [6D03]2800008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1116                              <2> 
  1117                              <2> %assign i +1
  1118 00000999 [6D03]2800008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1119                              <2> 
  1120                              <2> %assign i +1
  1121 000009A1 [6D03]2800008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1122                              <2> 
  1123                              <2> %assign i +1
  1124 000009A9 [6D03]2800008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1125                              <2> 
  1126                              <2> %assign i +1
  1127 000009B1 [6D03]2800008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1128                              <2> 
  1129                              <2> %assign i +1
  1130 000009B9 [6D03]2800008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1131                              <2> 
  1132                              <2> %assign i +1
  1133 000009C1 [6D03]2800008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1134                              <2> 
  1135                              <2> %assign i +1
  1136 000009C9 [6D03]2800008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1137                              <2> 
  1138                              <2> %assign i +1
  1139 000009D1 [6D03]2800008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1140                              <2> 
  1141                              <2> %assign i +1
  1142 000009D9 [6D03]2800008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1143                              <2> 
  1144                              <2> %assign i +1
  1145 000009E1 [6D03]2800008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1146                              <2> 
  1147                              <2> %assign i +1
  1148 000009E9 [6D03]2800008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1149                              <2> 
  1150                              <2> %assign i +1
  1151 000009F1 [6D03]2800008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1152                              <2> 
  1153                              <2> %assign i +1
  1154 000009F9 [6D03]2800008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1155                              <2> 
  1156                              <2> %assign i +1
  1157 00000A01 [6D03]2800008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1158                              <2> 
  1159                              <2> %assign i +1
  1160 00000A09 [6D03]2800008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1161                              <2> 
  1162                              <2> %assign i +1
  1163 00000A11 [6D03]2800008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1164                              <2> 
  1165                              <2> %assign i +1
  1166 00000A19 [6D03]2800008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1167                              <2> 
  1168                              <2> %assign i +1
  1169 00000A21 [6D03]2800008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1170                              <2> 
  1171                              <2> %assign i +1
  1172 00000A29 [6D03]2800008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1173                              <2> 
  1174                              <2> %assign i +1
  1175 00000A31 [6D03]2800008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1176                              <2> 
  1177                              <2> %assign i +1
  1178 00000A39 [6D03]2800008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1179                              <2> 
  1180                              <2> %assign i +1
  1181 00000A41 [6D03]2800008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1182                              <2> 
  1183                              <2> %assign i +1
  1184 00000A49 [6D03]2800008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1185                              <2> 
  1186                              <2> %assign i +1
  1187 00000A51 [6D03]2800008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1188                              <2> 
  1189                              <2> %assign i +1
  1190 00000A59 [6D03]2800008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1191                              <2> 
  1192                              <2> %assign i +1
  1193 00000A61 [6D03]2800008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1194                              <2> 
  1195                              <2> %assign i +1
  1196 00000A69 [6D03]2800008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1197                              <2> 
  1198                              <2> %assign i +1
  1199 00000A71 [6D03]2800008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1200                              <2> 
  1201                              <2> %assign i +1
  1202 00000A79 [6D03]2800008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1203                              <2> 
  1204                              <2> %assign i +1
  1205 00000A81 [6D03]2800008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1206                              <2> 
  1207                              <2> %assign i +1
  1208 00000A89 [6D03]2800008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1209                              <2> 
  1210                              <2> %assign i +1
  1211 00000A91 [6D03]2800008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1212                              <2> 
  1213                              <2> %assign i +1
  1214 00000A99 [6D03]2800008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1215                              <2> 
  1216                              <2> %assign i +1
  1217 00000AA1 [6D03]2800008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1218                              <2> 
  1219                              <2> %assign i +1
  1220 00000AA9 [6D03]2800008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1221                              <2> 
  1222                              <2> %assign i +1
  1223 00000AB1 [6D03]2800008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1224                              <2> 
  1225                              <2> %assign i +1
  1226 00000AB9 [6D03]2800008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1227                              <2> 
  1228                              <2> %assign i +1
  1229 00000AC1 [6D03]2800008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1230                              <2> 
  1231                              <2> %assign i +1
  1232 00000AC9 [6D03]2800008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1233                              <2> 
  1234                              <2> %assign i +1
  1235 00000AD1 [6D03]2800008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1236                              <2> 
  1237                              <2> %assign i +1
  1238 00000AD9 [6D03]2800008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1239                              <2> 
  1240                              <2> %assign i +1
  1241 00000AE1 [6D03]2800008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1242                              <2> 
  1243                              <2> %assign i +1
  1244 00000AE9 [6D03]2800008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1245                              <2> 
  1246                              <2> %assign i +1
  1247 00000AF1 [6D03]2800008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1248                              <2> 
  1249                              <2> %assign i +1
  1250 00000AF9 [6D03]2800008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1251                              <2> 
  1252                              <2> %assign i +1
  1253 00000B01 [6D03]2800008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1254                              <2> 
  1255                              <2> %assign i +1
  1256 00000B09 [6D03]2800008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1257                              <2> 
  1258                              <2> %assign i +1
  1259 00000B11 [6D03]2800008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1260                              <2> 
  1261                              <2> %assign i +1
  1262 00000B19 [6D03]2800008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1263                              <2> 
  1264                              <2> %assign i +1
  1265 00000B21 [6D03]2800008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1266                              <2> 
  1267                              <2> %assign i +1
  1268 00000B29 [6D03]2800008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1269                              <2> 
  1270                              <2> %assign i +1
  1271 00000B31 [6D03]2800008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1272                              <2> 
  1273                              <2> %assign i +1
  1274 00000B39 [6D03]2800008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1275                              <2> 
  1276                              <2> %assign i +1
  1277 00000B41 [6D03]2800008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1278                              <2> 
  1279                              <2> %assign i +1
  1280 00000B49 [6D03]2800008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1281                              <2> 
  1282                              <2> %assign i +1
  1283 00000B51 [6D03]2800008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1284                              <2> 
  1285                              <2> %assign i +1
  1286 00000B59 [6D03]2800008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1287                              <2> 
  1288                              <2> %assign i +1
  1289 00000B61 [6D03]2800008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1290                              <2> 
  1291                              <2> %assign i +1
  1292 00000B69 [6D03]2800008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1293                              <2> 
  1294                              <2> %assign i +1
  1295 00000B71 [6D03]2800008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1296                              <2> 
  1297                              <2> %assign i +1
  1298 00000B79 [6D03]2800008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1299                              <2> 
  1300                              <2> %assign i +1
  1301 00000B81 [6D03]2800008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1302                              <2> 
  1303                              <2> %assign i +1
  1304 00000B89 [6D03]2800008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1305                              <2> 
  1306                              <2> %assign i +1
  1307 00000B91 [6D03]2800008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1308                              <2> 
  1309                              <2> %assign i +1
  1310 00000B99 [6D03]2800008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1311                              <2> 
  1312                              <2> %assign i +1
  1313 00000BA1 [6D03]2800008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1314                              <2> 
  1315                              <2> %assign i +1
  1316 00000BA9 [6D03]2800008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1317                              <2> 
  1318                              <2> %assign i +1
  1319 00000BB1 [6D03]2800008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1320                              <2> 
  1321                              <2> %assign i +1
  1322 00000BB9 [6D03]2800008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1323                              <2> 
  1324                              <2> %assign i +1
  1325 00000BC1 [6D03]2800008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1326                              <2> 
  1327                              <2> %assign i +1
  1328 00000BC9 [6D03]2800008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1329                              <2> 
  1330                              <2> %assign i +1
  1331 00000BD1 [6D03]2800008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1332                              <2> 
  1333                              <2> %assign i +1
  1334 00000BD9 [6D03]2800008E0000  <2>  dw handled, NEW_CODE_SEL,0x8E00,0
  1335                              <2> 
  1336                              <2> %assign i +1
  1337                              <1> idt_end:
  1338                                  	%include "source/realmode.asm"
  1339                              <1> realmode:	;make sure the real mode program's address is in realmodeptr
  1340                              <1> 
  1341 00000BE1 FA                  <1> 	cli
  1342 00000BE2 A3[EF0C0000]        <1> 	mov [realmodeeax], eax
  1343 00000BE7 891D[EB0C0000]      <1> 	mov [realmodeebx], ebx
  1344 00000BED 8925[DD0C0000]      <1> 	mov [pmodeesp], esp
  1345                              <1> 
  1346 00000BF3 BB[E70C0000]        <1> 	mov ebx, cr0old
  1347                              <1> rmcopytofirstmbyte:
  1348 00000BF8 8B03                <1> 	mov eax, [ebx]
  1349 00000BFA 658903              <1> 	mov [gs:ebx], eax
  1350 00000BFD 81C304000000        <1> 	add ebx, 4
  1351 00000C03 81FB[F30C0000]      <1> 	cmp ebx, realmodeptr
  1352 00000C09 76ED                <1> 	jbe rmcopytofirstmbyte
  1353                              <1> 
  1354 00000C0B EA[120C0000]3800    <1> 	jmp V8086_CODE_SEL:protected16bit
  1355                              <1> 
  1356                              <1> [BITS 16]
  1357                              <1> protected16bit:
  1358 00000C12 B84000              <1> 	mov ax, V8086_DATA_SEL
  1359 00000C15 8ED8                <1> 	mov ds, ax
  1360 00000C17 8EC0                <1> 	mov es, ax
  1361 00000C19 8EE0                <1> 	mov fs, ax
  1362 00000C1B 8EE8                <1> 	mov gs, ax
  1363 00000C1D 8ED0                <1> 	mov ss, ax
  1364 00000C1F 66BC[00B40300]      <1> 	mov esp, stackend
  1365 00000C25 0F20C0              <1> 	mov eax, cr0
  1366 00000C28 66A3[E70C]          <1> 	mov [cr0old], eax
  1367 00000C2C 6625FEFFFF7F        <1> 	and eax, 0x7FFFFFFE
  1368 00000C32 0F22C0              <1> 	mov cr0, eax	;now in real mode
  1369 00000C35 EA[3A0C]0010        <1> 	jmp 0x1000:inrealmode
  1370                              <1> 
  1371                              <1> inrealmode:
  1372 00000C3A 8CC8                <1> 	mov ax, cs
  1373 00000C3C 8ED8                <1> 	mov ds, ax
  1374 00000C3E 8EC0                <1> 	mov es, ax
  1375 00000C40 8EE0                <1> 	mov fs, ax
  1376 00000C42 8EE8                <1> 	mov gs, ax
  1377 00000C44 8ED0                <1> 	mov ss, ax
  1378 00000C46 BC[00B4]            <1> 	mov sp, stackend ;because this is at 0x1000: and not 0x10000: it works
  1379                              <1> 	
  1380 00000C49 B011                <1> 	mov al, 0x11
  1381 00000C4B E620                <1> 	out 0x20, al
  1382 00000C4D E6A0                <1> 	out 0xA0, al
  1383 00000C4F B008                <1> 	mov al, 0x8		;interrupt for master
  1384 00000C51 E621                <1> 	out 0x21, al
  1385 00000C53 B070                <1> 	mov al, 0x70	;interrupt for slave
  1386 00000C55 E6A1                <1> 	out 0xA1, al
  1387 00000C57 B004                <1> 	mov al, 4
  1388 00000C59 E621                <1> 	out 0x21, al
  1389 00000C5B B002                <1> 	mov al, 2
  1390 00000C5D E6A1                <1> 	out 0xA1, al
  1391 00000C5F B001                <1> 	mov al, 0x1
  1392 00000C61 E621                <1> 	out 0x21, al
  1393 00000C63 B001                <1> 	mov al, 0x1
  1394 00000C65 E6A1                <1> 	out 0xA1, al
  1395                              <1> 	
  1396 00000C67 0F011E[E10C]        <1> 	lidt [idt_real]
  1397 00000C6C FB                  <1> 	sti
  1398                              <1> 
  1399 00000C6D 66A1[EF0C]          <1> 	mov eax, [realmodeeax]
  1400 00000C71 668B1E[EB0C]        <1> 	mov ebx, [realmodeebx]
  1401                              <1> 
  1402 00000C76 FF16[F30C]          <1> 	call word [realmodeptr] ;call the real mode program here
  1403                              <1> 
  1404 00000C7A 66A3[EF0C]          <1> 	mov [realmodeeax], eax
  1405 00000C7E 66891E[EB0C]        <1> 	mov [realmodeebx], ebx
  1406                              <1> 
  1407 00000C83 FA                  <1> 	cli
  1408 00000C84 0F0116[7D03]        <1> 	lgdt [gdtr]
  1409 00000C89 0F011E[8303]        <1> 	lidt [idtr]
  1410 00000C8E 0F20C0              <1> 	mov eax, cr0
  1411 00000C91 0C01                <1> 	or al, 1
  1412 00000C93 0F22C0              <1> 	mov cr0,eax
  1413 00000C96 EA[9B0C]2800        <1> 	jmp NEW_CODE_SEL:returntopmode
  1414                              <1> 
  1415                              <1> [BITS 32]
  1416                              <1> returntopmode:
  1417 00000C9B 66B83000            <1> 	mov ax, NEW_DATA_SEL
  1418 00000C9F 8ED8                <1> 	mov ds, ax
  1419 00000CA1 8EC0                <1> 	mov es, ax
  1420 00000CA3 8EE0                <1> 	mov fs, ax
  1421 00000CA5 8ED0                <1> 	mov ss, ax
  1422 00000CA7 8B25[DD0C0000]      <1> 	mov esp, [pmodeesp]
  1423 00000CAD 66B82000            <1> 	mov ax, SYS_DATA_SEL
  1424 00000CB1 8EE8                <1> 	mov gs, ax
  1425                              <1> 
  1426 00000CB3 BB[E70C0000]        <1> 	mov ebx, cr0old
  1427                              <1> rmcopyfromfirstmbyte:
  1428 00000CB8 658B03              <1> 	mov eax, [gs:ebx]
  1429 00000CBB 8903                <1> 	mov [ebx], eax
  1430 00000CBD 81C304000000        <1> 	add ebx, 4
  1431 00000CC3 81FB[F30C0000]      <1> 	cmp ebx, realmodeptr
  1432 00000CC9 76ED                <1> 	jbe rmcopyfromfirstmbyte
  1433                              <1> 
  1434 00000CCB E8405A0000          <1> 	call initialize.pic ;reset irq's and masks
  1435 00000CD0 FB                  <1> 	sti
  1436 00000CD1 A1[EF0C0000]        <1> 	mov eax, [realmodeeax]
  1437 00000CD6 8B1D[EB0C0000]      <1> 	mov ebx, [realmodeebx]
  1438 00000CDC C3                  <1> 	ret
  1439                              <1> 	
  1440 00000CDD 00000000            <1> pmodeesp dd 0
  1441                              <1> idt_real:
  1442 00000CE1 FF03                <1> 	dw 0x3FF
  1443 00000CE3 00000000            <1> 	dd 0
  1444 00000CE7 00000000            <1> cr0old dd 0
  1445 00000CEB 00000000            <1> realmodeebx dd 0
  1446 00000CEF 00000000            <1> realmodeeax dd 0
  1447 00000CF3 0000                <1> realmodeptr dw 0
  1448 00000CF5 00000000            <1> dd 0 ;make sure the copy thing doesnt overflow
  1449                                  [BITS 32]
  1450                                      %include "source/exception.asm"
  1451                              <1> %ifdef exceptions.included
  1452                              <1> unhand:	
  1453                              <1> 	%assign i 0
  1454                              <1> 	%rep 32
  1455                              <1> 	mov byte [intprob], i
  1456                              <1> 	jmp unhand2
  1457                              <1> 	%assign i i+1
  1458                              <1> 	%endrep
  1459 00000CF9 C605[B1110000]00    <2>  mov byte [intprob], i
  1460 00000D00 E974010000          <2>  jmp unhand2
  1461                              <2>  %assign i i+1
  1462 00000D05 C605[B1110000]01    <2>  mov byte [intprob], i
  1463 00000D0C E968010000          <2>  jmp unhand2
  1464                              <2>  %assign i i+1
  1465 00000D11 C605[B1110000]02    <2>  mov byte [intprob], i
  1466 00000D18 E95C010000          <2>  jmp unhand2
  1467                              <2>  %assign i i+1
  1468 00000D1D C605[B1110000]03    <2>  mov byte [intprob], i
  1469 00000D24 E950010000          <2>  jmp unhand2
  1470                              <2>  %assign i i+1
  1471 00000D29 C605[B1110000]04    <2>  mov byte [intprob], i
  1472 00000D30 E944010000          <2>  jmp unhand2
  1473                              <2>  %assign i i+1
  1474 00000D35 C605[B1110000]05    <2>  mov byte [intprob], i
  1475 00000D3C E938010000          <2>  jmp unhand2
  1476                              <2>  %assign i i+1
  1477 00000D41 C605[B1110000]06    <2>  mov byte [intprob], i
  1478 00000D48 E92C010000          <2>  jmp unhand2
  1479                              <2>  %assign i i+1
  1480 00000D4D C605[B1110000]07    <2>  mov byte [intprob], i
  1481 00000D54 E920010000          <2>  jmp unhand2
  1482                              <2>  %assign i i+1
  1483 00000D59 C605[B1110000]08    <2>  mov byte [intprob], i
  1484 00000D60 E914010000          <2>  jmp unhand2
  1485                              <2>  %assign i i+1
  1486 00000D65 C605[B1110000]09    <2>  mov byte [intprob], i
  1487 00000D6C E908010000          <2>  jmp unhand2
  1488                              <2>  %assign i i+1
  1489 00000D71 C605[B1110000]0A    <2>  mov byte [intprob], i
  1490 00000D78 E9FC000000          <2>  jmp unhand2
  1491                              <2>  %assign i i+1
  1492 00000D7D C605[B1110000]0B    <2>  mov byte [intprob], i
  1493 00000D84 E9F0000000          <2>  jmp unhand2
  1494                              <2>  %assign i i+1
  1495 00000D89 C605[B1110000]0C    <2>  mov byte [intprob], i
  1496 00000D90 E9E4000000          <2>  jmp unhand2
  1497                              <2>  %assign i i+1
  1498 00000D95 C605[B1110000]0D    <2>  mov byte [intprob], i
  1499 00000D9C E9D8000000          <2>  jmp unhand2
  1500                              <2>  %assign i i+1
  1501 00000DA1 C605[B1110000]0E    <2>  mov byte [intprob], i
  1502 00000DA8 E9CC000000          <2>  jmp unhand2
  1503                              <2>  %assign i i+1
  1504 00000DAD C605[B1110000]0F    <2>  mov byte [intprob], i
  1505 00000DB4 E9C0000000          <2>  jmp unhand2
  1506                              <2>  %assign i i+1
  1507 00000DB9 C605[B1110000]10    <2>  mov byte [intprob], i
  1508 00000DC0 E9B4000000          <2>  jmp unhand2
  1509                              <2>  %assign i i+1
  1510 00000DC5 C605[B1110000]11    <2>  mov byte [intprob], i
  1511 00000DCC E9A8000000          <2>  jmp unhand2
  1512                              <2>  %assign i i+1
  1513 00000DD1 C605[B1110000]12    <2>  mov byte [intprob], i
  1514 00000DD8 E99C000000          <2>  jmp unhand2
  1515                              <2>  %assign i i+1
  1516 00000DDD C605[B1110000]13    <2>  mov byte [intprob], i
  1517 00000DE4 E990000000          <2>  jmp unhand2
  1518                              <2>  %assign i i+1
  1519 00000DE9 C605[B1110000]14    <2>  mov byte [intprob], i
  1520 00000DF0 E984000000          <2>  jmp unhand2
  1521                              <2>  %assign i i+1
  1522 00000DF5 C605[B1110000]15    <2>  mov byte [intprob], i
  1523 00000DFC E978000000          <2>  jmp unhand2
  1524                              <2>  %assign i i+1
  1525 00000E01 C605[B1110000]16    <2>  mov byte [intprob], i
  1526 00000E08 E96C000000          <2>  jmp unhand2
  1527                              <2>  %assign i i+1
  1528 00000E0D C605[B1110000]17    <2>  mov byte [intprob], i
  1529 00000E14 E960000000          <2>  jmp unhand2
  1530                              <2>  %assign i i+1
  1531 00000E19 C605[B1110000]18    <2>  mov byte [intprob], i
  1532 00000E20 E954000000          <2>  jmp unhand2
  1533                              <2>  %assign i i+1
  1534 00000E25 C605[B1110000]19    <2>  mov byte [intprob], i
  1535 00000E2C E948000000          <2>  jmp unhand2
  1536                              <2>  %assign i i+1
  1537 00000E31 C605[B1110000]1A    <2>  mov byte [intprob], i
  1538 00000E38 E93C000000          <2>  jmp unhand2
  1539                              <2>  %assign i i+1
  1540 00000E3D C605[B1110000]1B    <2>  mov byte [intprob], i
  1541 00000E44 E930000000          <2>  jmp unhand2
  1542                              <2>  %assign i i+1
  1543 00000E49 C605[B1110000]1C    <2>  mov byte [intprob], i
  1544 00000E50 E924000000          <2>  jmp unhand2
  1545                              <2>  %assign i i+1
  1546 00000E55 C605[B1110000]1D    <2>  mov byte [intprob], i
  1547 00000E5C E918000000          <2>  jmp unhand2
  1548                              <2>  %assign i i+1
  1549 00000E61 C605[B1110000]1E    <2>  mov byte [intprob], i
  1550 00000E68 E90C000000          <2>  jmp unhand2
  1551                              <2>  %assign i i+1
  1552 00000E6D C605[B1110000]1F    <2>  mov byte [intprob], i
  1553 00000E74 E900000000          <2>  jmp unhand2
  1554                              <2>  %assign i i+1
  1555                              <1> unhand2:
  1556 00000E79 FA                  <1> 	cli
  1557 00000E7A 1E                  <1> 	push ds
  1558 00000E7B 06                  <1> 	push es
  1559 00000E7C 0FA0                <1> 	push fs
  1560 00000E7E 0FA8                <1> 	push gs
  1561 00000E80 16                  <1> 	push ss
  1562 00000E81 60                  <1> 	pushad
  1563                              <1> %ifdef gui.included
  1564 00000E82 803D[F98E0000]00    <1> 	cmp byte [guion], 0
  1565 00000E89 0F8432000000        <1> 	je near noguiunhandstuff
  1566 00000E8F 66C705[AB110000]08- <1> 	mov word [locunhandy], 8
  1567 00000E97 00                  <1>
  1568 00000E98 66C705[AD110000]08- <1> 	mov word [locunhandx], 8
  1569 00000EA0 00                  <1>
  1570 00000EA1 668B1D[B8730000]    <1> 	mov bx, [background]
  1571 00000EA8 66891D[AF110000]    <1> 	mov [backgroundcache], bx
  1572 00000EAF C605[565B0000]01    <1> 	mov byte [mousedisabled],1
  1573 00000EB6 66BB00F8            <1> 	mov bx, 1111100000000000b
  1574 00000EBA 66891D[B8730000]    <1> 	mov [background], bx
  1575                              <1> noguiunhandstuff:
  1576                              <1> %endif
  1577 00000EC1 89E6                <1> 	mov esi, esp
  1578 00000EC3 8935[9F110000]      <1> 	mov [espfirst], esi
  1579 00000EC9 81C6BC000000        <1> 	add esi, ((unhndrgend - unhndrg)/15)*4
  1580 00000ECF 8935[9B110000]      <1> 	mov [esploc], esi
  1581 00000ED5 BE[C0110000]        <1> 	mov esi, unhandmsg
  1582 00000EDA 8935[A3110000]      <1> 	mov [esiloc], esi
  1583 00000EE0 31C9                <1> 	xor ecx, ecx
  1584 00000EE2 8A0D[B1110000]      <1> 	mov cl, [intprob]
  1585 00000EE8 BB[8F150000]        <1> 	mov ebx, errortypes
  1586 00000EED C1E102              <1> 	shl ecx, 2
  1587 00000EF0 01CB                <1> 	add ebx, ecx
  1588 00000EF2 81FB[CF150000]      <1> 	cmp ebx, errortypesend
  1589 00000EF8 7205                <1> 	jb gooderrortype
  1590 00000EFA BB[CF150000]        <1> 	mov ebx, errortypesend
  1591                              <1> gooderrortype:
  1592 00000EFF 8B33                <1> 	mov esi, [ebx]
  1593                              <1> %ifdef gui.included
  1594 00000F01 803D[F98E0000]00    <1> 	cmp byte [guion], 0
  1595 00000F08 0F842D000000        <1> 	je near errortext
  1596 00000F0E 668B0D[AB110000]    <1> 	mov cx, [locunhandy]
  1597 00000F15 668B15[AD110000]    <1> 	mov dx, [locunhandx]
  1598 00000F1C 66B80100            <1> 	mov ax, 1
  1599 00000F20 6631DB              <1> 	xor bx, bx
  1600 00000F23 E8E56A0000          <1> 	call showstring2
  1601 00000F28 66890D[AB110000]    <1> 	mov [locunhandy], cx
  1602 00000F2F 668915[AD110000]    <1> 	mov [locunhandx], dx
  1603 00000F36 E905000000          <1> 	jmp errortextdone
  1604                              <1> %endif
  1605                              <1> errortext:
  1606 00000F3B E81C0E0000          <1> 	call print		;get the error message and print it
  1607                              <1> errortextdone:
  1608 00000F40 31C9                <1> 	xor ecx, ecx
  1609 00000F42 8A0D[B1110000]      <1> 	mov cl, [intprob]
  1610 00000F48 E8E7010000          <1> 	call expdump
  1611                              <1> dumpstack:
  1612 00000F4D 8B35[9B110000]      <1> 	mov esi, [esploc]
  1613 00000F53 39E6                <1> 	cmp esi, esp
  1614 00000F55 7216                <1> 	jb donedump
  1615 00000F57 368B0E              <1> 	mov ecx, [ss:esi]
  1616 00000F5A 81EE04000000        <1> 	sub esi, 4
  1617 00000F60 8935[9B110000]      <1> 	mov [esploc], esi
  1618 00000F66 E8C9010000          <1> 	call expdump
  1619 00000F6B EBE0                <1> 	jmp dumpstack
  1620                              <1> donedump:
  1621 00000F6D 0F20C1              <1> 	mov ecx, cr0
  1622 00000F70 E8BF010000          <1> 	call expdump
  1623 00000F75 0F20D1              <1> 	mov ecx, cr2
  1624 00000F78 E8B7010000          <1> 	call expdump
  1625 00000F7D 0F20D9              <1> 	mov ecx, cr3
  1626 00000F80 E8AF010000          <1> 	call expdump
  1627 00000F85 0F20E1              <1> 	mov ecx, cr4
  1628 00000F88 E8A7010000          <1> 	call expdump
  1629 00000F8D 0F00C9              <1> 	str ecx
  1630 00000F90 E89F010000          <1> 	call expdump
  1631 00000F95 0F010D[BA110000]    <1> 	sidt [igdtcache]
  1632 00000F9C 8B0D[BC110000]      <1> 	mov ecx, [igdtcache + 2]
  1633 00000FA2 E88D010000          <1> 	call expdump
  1634 00000FA7 0F0105[BA110000]    <1> 	sgdt [igdtcache]
  1635 00000FAE 8B0D[BC110000]      <1> 	mov ecx, [igdtcache + 2]
  1636 00000FB4 E87B010000          <1> 	call expdump
  1637 00000FB9 0F00C1              <1> 	sldt ecx
  1638 00000FBC E873010000          <1> 	call expdump
  1639 00000FC1 8B35[9B110000]      <1> 	mov esi, [esploc]
  1640 00000FC7 368B7C2434          <1> 	mov edi, [ss:esp + 52]
  1641 00000FCC 81C710000000        <1> 	add edi, 16
  1642 00000FD2 893D[B6110000]      <1> 	mov [codelocend], edi
  1643 00000FD8 81EF20000000        <1> 	sub edi, 32
  1644                              <1> dumpcodeloop:
  1645 00000FDE 893D[B2110000]      <1> 	mov [codeloc], edi
  1646 00000FE4 8B0F                <1> 	mov ecx, [edi]
  1647 00000FE6 E849010000          <1> 	call expdump
  1648 00000FEB 8B3D[B2110000]      <1> 	mov edi, [codeloc]
  1649 00000FF1 81C704000000        <1> 	add edi, 4
  1650 00000FF7 3B3D[B6110000]      <1> 	cmp edi, [codelocend]
  1651 00000FFD 72DF                <1> 	jb dumpcodeloop
  1652 00000FFF BE[C5100000]        <1> 	mov esi, backtoosmsg
  1653                              <1> %ifdef gui.included
  1654 00001004 803D[F98E0000]00    <1> 	cmp byte [guion], 0
  1655 0000100B 741F                <1> 	je backtomsg
  1656                              <1> guibacktomsg:
  1657 0000100D 668B15[AD110000]    <1> 	mov dx, [locunhandx]
  1658 00001014 668B0D[AB110000]    <1> 	mov cx, [locunhandy]
  1659 0000101B 66B80100            <1> 	mov ax, 1
  1660 0000101F 6631DB              <1> 	xor bx, bx
  1661 00001022 E8E6690000          <1> 	call showstring2
  1662 00001027 E905000000          <1> 	jmp backtomsgdone
  1663                              <1> backtomsg:
  1664                              <1> %endif
  1665 0000102C E82B0D0000          <1> 	call print
  1666                              <1> backtomsgdone:
  1667 00001031 30C0                <1> 	xor al, al
  1668 00001033 E81E130000          <1> 	call rdcharint
  1669 00001038 803D[B1110000]03    <1> 	cmp byte [intprob], 3
  1670 0000103F 7541                <1> 	jne nodebugint
  1671                              <1> %ifdef gui.included
  1672 00001041 803D[F98E0000]00    <1> 	cmp byte [guion], 0
  1673 00001048 7427                <1> 	je nodebuggui
  1674 0000104A 668B1D[AF110000]    <1> 	mov bx, [backgroundcache]
  1675 00001051 66891D[B8730000]    <1> 	mov [background], bx
  1676 00001058 6631DB              <1> 	xor bx, bx
  1677 0000105B C605[565B0000]00    <1> 	mov byte [mousedisabled], 0
  1678 00001062 E805630000          <1> 	call guiclear
  1679 00001067 E850630000          <1> 	call reloadallgraphics
  1680 0000106C E841180000          <1> 	call termcopy
  1681                              <1> nodebuggui:
  1682                              <1> %endif
  1683 00001071 8B35[9F110000]      <1> 	mov esi, [espfirst]
  1684 00001077 89F4                <1> 	mov esp, esi
  1685 00001079 61                  <1> 	popad
  1686 0000107A 17                  <1> 	pop ss
  1687 0000107B 0FA9                <1> 	pop gs
  1688 0000107D 0FA1                <1> 	pop fs
  1689 0000107F 07                  <1> 	pop es
  1690 00001080 1F                  <1> 	pop ds
  1691 00001081 CF                  <1> 	iret
  1692                              <1> nodebugint:
  1693 00001082 61                  <1> 	popad
  1694 00001083 17                  <1> 	pop ss
  1695 00001084 0FA9                <1> 	pop gs
  1696 00001086 0FA1                <1> 	pop fs
  1697 00001088 07                  <1> 	pop es
  1698 00001089 1F                  <1> 	pop ds
  1699 0000108A 81C408000000        <1> 	add esp, 8
  1700                              <1> ;	popf ;pop the cs segment selector into eflags
  1701                              <1> ;	popf ;then pop the flags
  1702                              <1> %ifdef gui.included
  1703 00001090 803D[F98E0000]00    <1> 	cmp byte [guion], 0
  1704 00001097 7427                <1> 	je returnunhandgui
  1705 00001099 668B1D[AF110000]    <1> 	mov bx, [backgroundcache]
  1706 000010A0 66891D[B8730000]    <1> 	mov [background], bx
  1707 000010A7 6631DB              <1> 	xor bx, bx
  1708 000010AA C605[565B0000]00    <1> 	mov byte [mousedisabled], 0
  1709 000010B1 E8B6620000          <1> 	call guiclear
  1710 000010B6 E801630000          <1> 	call reloadallgraphics
  1711 000010BB E8F2170000          <1> 	call termcopy
  1712                              <1> %endif
  1713                              <1> returnunhandgui:
  1714 000010C0 E9301C0000          <1> 	jmp nwcmd
  1715 000010C5 506C6561736520706F- <1> backtoosmsg db "Please post any problems in the Issues section at solleros.googlecode.com",10
  1716 000010CE 737420616E79207072- <1>
  1717 000010D7 6F626C656D7320696E- <1>
  1718 000010E0 207468652049737375- <1>
  1719 000010E9 65732073656374696F- <1>
  1720 000010F2 6E20617420736F6C6C- <1>
  1721 000010FB 65726F732E676F6F67- <1>
  1722 00001104 6C65636F64652E636F- <1>
  1723 0000110D 6D0A                <1>
  1724 0000110F 507265737320616E79- <1> 			db "Press any key to return to SollerOS",10,0
  1725 00001118 206B657920746F2072- <1>
  1726 00001121 657475726E20746F20- <1>
  1727 0000112A 536F6C6C65724F530A- <1>
  1728 00001133 00                  <1>
  1729                              <1> expdump:
  1730 00001134 8B35[A3110000]      <1> 	mov esi, [esiloc]
  1731 0000113A 89F7                <1> 	mov edi, esi
  1732 0000113C 81C70F000000        <1> 	add edi, 15
  1733 00001142 81C604000000        <1> 	add esi, 4
  1734 00001148 893D[A3110000]      <1> 	mov [esiloc], edi
  1735 0000114E 81EF03000000        <1> 	sub edi, 3
  1736 00001154 E8FE1F0000          <1> 	call converthex
  1737 00001159 81EE04000000        <1> 	sub esi, 4
  1738                              <1> %ifdef gui.included
  1739 0000115F 803D[F98E0000]00    <1> 	cmp byte [guion], 0
  1740 00001166 0F8429000000        <1> 	je near expdumptext
  1741 0000116C 668B0D[AB110000]    <1> 	mov cx, [locunhandy]
  1742 00001173 668B15[AD110000]    <1> 	mov dx, [locunhandx]
  1743 0000117A 66B80100            <1> 	mov ax, 1
  1744 0000117E 6631DB              <1> 	xor bx, bx
  1745 00001181 E887680000          <1> 	call showstring2
  1746 00001186 66890D[AB110000]    <1> 	mov [locunhandy], cx
  1747 0000118D 668915[AD110000]    <1> 	mov [locunhandx], dx
  1748 00001194 C3                  <1> 	ret
  1749                              <1> %endif
  1750                              <1> expdumptext:
  1751 00001195 E8C20B0000          <1> 	call print
  1752 0000119A C3                  <1> 	ret
  1753 0000119B 00000000            <1> esploc dd 0
  1754 0000119F 00000000            <1> espfirst dd 0
  1755 000011A3 00000000            <1> esiloc dd 0
  1756 000011A7 00000000            <1> esiregbuf dd 0
  1757 000011AB 0100                <1> locunhandy dw 1
  1758 000011AD 0100                <1> locunhandx dw 1
  1759 000011AF 0000                <1> backgroundcache dw 0
  1760 000011B1 00                  <1> intprob db 0
  1761 000011B2 00000000            <1> codeloc dd 0
  1762 000011B6 00000000            <1> codelocend dd 0
  1763 000011BA 000000000000        <1> igdtcache dw 0,0,0
  1764                              <1> 	unhandmsg:	
  1765 000011C0 494E543D3030303030- <1> 			db "INT=00000000",255,10,0
  1766 000011C9 303030FF0A00        <1>
  1767                              <1> unhndrg:
  1768 000011CF FFFFFFFF3030303030- <1> 	times 7 db 255,255,255,255,"00000000  ",0	;this dumps the stack before the stack frame in question
  1769 000011D8 303030202000<rept>  <1>
  1770 00001238 FFFFFFFF3030303030- <1> 			db 255,255,255,255,"00000000",255,10,0
  1771 00001241 303030FF0A00        <1>
  1772 00001247 FFFFFFFF3030303030- <1> 	times 7 db 255,255,255,255,"00000000  ",0
  1773 00001250 303030202000<rept>  <1>
  1774 000012B0 FFFFFFFF3030303030- <1> 			db 255,255,255,255,"00000000",255,10,0
  1775 000012B9 303030FF0A00        <1>
  1776 000012BF FFFFFFFF3030303030- <1> 	times 7 db 255,255,255,255,"00000000  ",0
  1777 000012C8 303030202000<rept>  <1>
  1778 00001328 FFFFFFFF3030303030- <1> 			db 255,255,255,255,"00000000",255,10,0
  1779 00001331 303030FF0A00        <1>
  1780 00001337 FFFFFFFF3030303030- <1> 	times 7 db 255,255,255,255,"00000000  ",0
  1781 00001340 303030202000<rept>  <1>
  1782 000013A0 FFFFFFFF3030303030- <1> 			db 255,255,255,255,"00000000",255,10,0
  1783 000013A9 303030FF0A00        <1>
  1784                              <1> unhandregs:
  1785 000013AF 45464C3D3030303030- <1> 			db "EFL=00000000  ",0
  1786 000013B8 303030202000        <1>
  1787 000013BE 43533A3D3030303030- <1> 			db "CS:=00000000  ",0
  1788 000013C7 303030202000        <1>
  1789 000013CD 4549503D3030303030- <1> 			db "EIP=00000000",255,10,0
  1790 000013D6 303030FF0A00        <1>
  1791 000013DC 44533A3D3030303030- <1> 			db "DS:=00000000  ",0
  1792 000013E5 303030202000        <1>
  1793 000013EB 45533A3D3030303030- <1> 			db "ES:=00000000  ",0
  1794 000013F4 303030202000        <1>
  1795 000013FA 46533A3D3030303030- <1> 			db "FS:=00000000  ",0
  1796 00001403 303030202000        <1>
  1797 00001409 47533A3D3030303030- <1> 			db "GS:=00000000  ",0
  1798 00001412 303030202000        <1>
  1799 00001418 53533A3D3030303030- <1> 			db "SS:=00000000",255,10,0
  1800 00001421 303030FF0A00        <1>
  1801 00001427 4541583D3030303030- <1> 			db "EAX=00000000  ",0
  1802 00001430 303030202000        <1>
  1803 00001436 4543583D3030303030- <1> 			db "ECX=00000000  ",0
  1804 0000143F 303030202000        <1>
  1805 00001445 4544583D3030303030- <1> 			db "EDX=00000000  ",0
  1806 0000144E 303030202000        <1>
  1807 00001454 4542583D3030303030- <1> 			db "EBX=00000000",255,10,0
  1808 0000145D 303030FF0A00        <1>
  1809 00001463 4553503D3030303030- <1> 			db "ESP=00000000  ",0
  1810 0000146C 303030202000        <1>
  1811 00001472 4542503D3030303030- <1> 			db "EBP=00000000  ",0
  1812 0000147B 303030202000        <1>
  1813 00001481 4553493D3030303030- <1> 			db "ESI=00000000  ",0
  1814 0000148A 303030202000        <1>
  1815 00001490 4544493D3030303030- <1> unhndrgend:	db "EDI=00000000",255,10,0
  1816 00001499 303030FF0A00        <1>
  1817 0000149F 4352303D3030303030- <1> 			db "CR0=00000000  ",0
  1818 000014A8 303030202000        <1>
  1819 000014AE 4352323D3030303030- <1> 			db "CR2=00000000  ",0
  1820 000014B7 303030202000        <1>
  1821 000014BD 4352333D3030303030- <1> 			db "CR3=00000000  ",0
  1822 000014C6 303030202000        <1>
  1823 000014CC 4352343D3030303030- <1> 			db "CR4=00000000",255,10,0
  1824 000014D5 303030FF0A00        <1>
  1825 000014DB 54523A3D3030303030- <1> 			db "TR:=00000000  ",0
  1826 000014E4 303030202000        <1>
  1827 000014EA 4944543D3030303030- <1> 			db "IDT=00000000  ",0
  1828 000014F3 303030202000        <1>
  1829 000014F9 4744543D3030303030- <1> 			db "GDT=00000000  ",0
  1830 00001502 303030202000        <1>
  1831 00001508 4C44543D3030303030- <1> 			db "LDT=00000000",255,10,0
  1832 00001511 303030FF0A00        <1>
  1833 00001517 FFFFFFFF3030303030- <1> unhandcode: times 2 db 255,255,255,255,"00000000  ",0	;this dumps the code before and after the interrupt in question
  1834 00001520 303030202000<rept>  <1>
  1835 00001535 FFFFFFFF3030303030- <1> 			db 255,255,255,255,"00000000 ",255,0
  1836 0000153E 30303020FF00        <1>
  1837 00001544 FFFFFF5B3030303030- <1> 			db 255,255,255,"[00000000] ",0
  1838 0000154D 3030305D2000        <1>
  1839 00001553 FFFFFFFF3030303030- <1> 			times 3 db 255,255,255,255,"00000000  ",0
  1840 0000155C 303030202000<rept>  <1>
  1841 00001580 FFFFFFFF3030303030- <1> 			db 255,255,255,255,"00000000",255,10,0
  1842 00001589 303030FF0A00        <1>
  1843                              <1> unhandmsgend:
  1844                              <1> 
  1845                              <1> errortypes:
  1846 0000158F [D3150000]          <1> 			dd err0
  1847 00001593 [3C160000]          <1> 			dd err1
  1848 00001597 [9D160000]          <1> 			dd err2
  1849 0000159B [F2160000]          <1> 			dd err3
  1850 0000159F [56170000]          <1> 			dd err4
  1851 000015A3 [A8170000]          <1> 			dd err5
  1852 000015A7 [12180000]          <1> 			dd err6
  1853 000015AB [7A180000]          <1> 			dd err7
  1854 000015AF [C4180000]          <1> 			dd err8
  1855 000015B3 [21190000]          <1> 			dd err9
  1856 000015B7 [7A190000]          <1> 			dd err10
  1857 000015BB [C5190000]          <1> 			dd err11
  1858 000015BF [151A0000]          <1> 			dd err12
  1859 000015C3 [6E1A0000]          <1> 			dd err13
  1860 000015C7 [D11A0000]          <1> 			dd err14
  1861 000015CB [0D1B0000]          <1> 			dd err15
  1862                              <1> errortypesend:
  1863 000015CF [991B0000]          <1> 			dd unknownerror
  1864                              <1> 			
  1865 000015D3 4469766973696F6E20- <1> err0	db "Division by zero:",10
  1866 000015DC 6279207A65726F3A0A  <1>
  1867 000015E5 546563686E6963616C- <1> 		db "Technically lim a÷x = ∞ when a is any real number. Happy Easter!",10
  1868 000015EE 6C79206C696D2061C3- <1>
  1869 000015F7 B778203D20E2889E20- <1>
  1870 00001600 7768656E2061206973- <1>
  1871 00001609 20616E79207265616C- <1>
  1872 00001612 206E756D6265722E20- <1>
  1873 0000161B 486170707920456173- <1>
  1874 00001624 746572210A          <1>
  1875 00001629 202020202020202020- <1> 		db "            x→0",10,0
  1876 00001632 20202078E28692300A- <1>
  1877 0000163B 00                  <1>
  1878                              <1> 		
  1879 0000163C 53696E676C652D7374- <1> err1	db "Single-step/Breakpoint:",10
  1880 00001645 65702F427265616B70- <1>
  1881 0000164E 6F696E743A0A        <1>
  1882 00001654 4120627265616B706F- <1> 		db "A breakpoint fault, breakpoint trap, or single-step trap was triggered.",10,0
  1883 0000165D 696E74206661756C74- <1>
  1884 00001666 2C20627265616B706F- <1>
  1885 0000166F 696E7420747261702C- <1>
  1886 00001678 206F722073696E676C- <1>
  1887 00001681 652D73746570207472- <1>
  1888 0000168A 617020776173207472- <1>
  1889 00001693 696767657265642E0A- <1>
  1890 0000169C 00                  <1>
  1891                              <1> 		
  1892 0000169D 4E6F6E6D61736B6162- <1> err2	db "Nonmaskable interrupt:",10
  1893 000016A6 6C6520696E74657272- <1>
  1894 000016AF 7570743A0A          <1>
  1895 000016B4 412068617264776172- <1> 		db "A hardware interrupt was triggered that could not be masked.",10,0
  1896 000016BD 6520696E7465727275- <1>
  1897 000016C6 707420776173207472- <1>
  1898 000016CF 696767657265642074- <1>
  1899 000016D8 68617420636F756C64- <1>
  1900 000016E1 206E6F74206265206D- <1>
  1901 000016EA 61736B65642E0A00    <1>
  1902                              <1> 		
  1903 000016F2 427265616B706F696E- <1> err3	db "Breakpoint:",10
  1904 000016FB 743A0A              <1>
  1905 000016FE 5468697320696E7465- <1> 		db "This interrupt is used in programs to show the stack and registers and can be",10
  1906 00001707 727275707420697320- <1>
  1907 00001710 7573656420696E2070- <1>
  1908 00001719 726F6772616D732074- <1>
  1909 00001722 6F2073686F77207468- <1>
  1910 0000172B 6520737461636B2061- <1>
  1911 00001734 6E6420726567697374- <1>
  1912 0000173D 65727320616E642063- <1>
  1913 00001746 616E2062650A        <1>
  1914 0000174C 69676E6F7265642E0A- <1> 		db "ignored.",10,0
  1915 00001755 00                  <1>
  1916                              <1> 		
  1917 00001756 4F766572666C6F773A- <1> err4	db "Overflow:",10
  1918 0000175F 0A                  <1>
  1919 00001760 5468652070726F6365- <1> 		db "The processor ran into an INTO instruction with the overflow flag set.",10,0
  1920 00001769 73736F722072616E20- <1>
  1921 00001772 696E746F20616E2049- <1>
  1922 0000177B 4E544F20696E737472- <1>
  1923 00001784 756374696F6E207769- <1>
  1924 0000178D 746820746865206F76- <1>
  1925 00001796 6572666C6F7720666C- <1>
  1926 0000179F 6167207365742E0A00  <1>
  1927                              <1> 		
  1928 000017A8 426F756E6473206368- <1> err5	db "Bounds check:",10
  1929 000017B1 65636B3A0A          <1>
  1930 000017B6 5468652070726F6365- <1> 		db "The processor rebounded from a BOUND instruction run on an operand that was out",10
  1931 000017BF 73736F72207265626F- <1>
  1932 000017C8 756E6465642066726F- <1>
  1933 000017D1 6D206120424F554E44- <1>
  1934 000017DA 20696E737472756374- <1>
  1935 000017E3 696F6E2072756E206F- <1>
  1936 000017EC 6E20616E206F706572- <1>
  1937 000017F5 616E64207468617420- <1>
  1938 000017FE 776173206F75740A    <1>
  1939 00001806 6F6620626F756E6473- <1> 		db "of bounds.",10,0
  1940 0000180F 2E0A00              <1>
  1941                              <1> 		
  1942 00001812 496E76616C6964206F- <1> err6	db "Invalid opcode:",10
  1943 0000181B 70636F64653A0A      <1>
  1944 00001822 5468652070726F6365- <1> 		db "The processor has no idea what it was trying to execute. Don't run SSE4 code",10
  1945 0000182B 73736F722068617320- <1>
  1946 00001834 6E6F20696465612077- <1>
  1947 0000183D 686174206974207761- <1>
  1948 00001846 7320747279696E6720- <1>
  1949 0000184F 746F20657865637574- <1>
  1950 00001858 652E20446F6E277420- <1>
  1951 00001861 72756E205353453420- <1>
  1952 0000186A 636F64650A          <1>
  1953 0000186F 6F6E20343836277321- <1> 		db "on 486's!",10,0
  1954 00001878 0A00                <1>
  1955                              <1> 		
  1956 0000187A 436F70726F63657373- <1> err7	db "Coprocessor not available:",10
  1957 00001883 6F72206E6F74206176- <1>
  1958 0000188C 61696C61626C653A0A  <1>
  1959 00001895 446F6E277420796F75- <1> 		db "Don't you know they don't make those anymore!",10,0
  1960 0000189E 206B6E6F7720746865- <1>
  1961 000018A7 7920646F6E2774206D- <1>
  1962 000018B0 616B652074686F7365- <1>
  1963 000018B9 20616E796D6F726521- <1>
  1964 000018C2 0A00                <1>
  1965                              <1> 		
  1966 000018C4 446F75626C65206661- <1> err8	db "Double fault:",10
  1967 000018CD 756C743A0A          <1>
  1968 000018D2 546865206578636570- <1> 		db "The exception handler could not handle that it could not handle an exception.",10,0
  1969 000018DB 74696F6E2068616E64- <1>
  1970 000018E4 6C657220636F756C64- <1>
  1971 000018ED 206E6F742068616E64- <1>
  1972 000018F6 6C6520746861742069- <1>
  1973 000018FF 7420636F756C64206E- <1>
  1974 00001908 6F742068616E646C65- <1>
  1975 00001911 20616E206578636570- <1>
  1976 0000191A 74696F6E2E0A00      <1>
  1977                              <1> 		
  1978 00001921 436F70726F63657373- <1> err9	db "Coprocessor segment overrun:",10,0
  1979 0000192A 6F72207365676D656E- <1>
  1980 00001933 74206F76657272756E- <1>
  1981 0000193C 3A0A00              <1>
  1982 0000193F 54686973206E657665- <1> 		db "This never happens in modern computers, and never should.",10,0
  1983 00001948 722068617070656E73- <1>
  1984 00001951 20696E206D6F646572- <1>
  1985 0000195A 6E20636F6D70757465- <1>
  1986 00001963 72732C20616E64206E- <1>
  1987 0000196C 657665722073686F75- <1>
  1988 00001975 6C642E0A00          <1>
  1989                              <1> 
  1990 0000197A 496E76616C69642054- <1> err10	db "Invalid TSS:",10
  1991 00001983 53533A0A            <1>
  1992 00001987 546865205453532074- <1> 		db "The TSS that was switched to is invalid. Nothing funny here.",10,0
  1993 00001990 686174207761732073- <1>
  1994 00001999 776974636865642074- <1>
  1995 000019A2 6F20697320696E7661- <1>
  1996 000019AB 6C69642E204E6F7468- <1>
  1997 000019B4 696E672066756E6E79- <1>
  1998 000019BD 20686572652E0A00    <1>
  1999                              <1> 		
  2000 000019C5 5365676D656E74206E- <1> err11	db "Segment not present:",10
  2001 000019CE 6F742070726573656E- <1>
  2002 000019D7 743A0A              <1>
  2003 000019DA 546865207072657365- <1> 		db "The present bit of the segment descriptor is set to zero.",10,0
  2004 000019E3 6E7420626974206F66- <1>
  2005 000019EC 20746865207365676D- <1>
  2006 000019F5 656E74206465736372- <1>
  2007 000019FE 6970746F7220697320- <1>
  2008 00001A07 73657420746F207A65- <1>
  2009 00001A10 726F2E0A00          <1>
  2010                              <1> 		
  2011 00001A15 537461636B20657863- <1> err12	db "Stack exception:",10
  2012 00001A1E 657074696F6E3A0A    <1>
  2013 00001A26 546865205353206465- <1> 		db "The SS descriptor is invalid or not present or its limit is too small.",10,0
  2014 00001A2F 7363726970746F7220- <1>
  2015 00001A38 697320696E76616C69- <1>
  2016 00001A41 64206F72206E6F7420- <1>
  2017 00001A4A 70726573656E74206F- <1>
  2018 00001A53 7220697473206C696D- <1>
  2019 00001A5C 697420697320746F6F- <1>
  2020 00001A65 20736D616C6C2E0A00  <1>
  2021                              <1> 		
  2022 00001A6E 47656E6572616C2070- <1> err13	db "General protection violation:",10
  2023 00001A77 726F74656374696F6E- <1>
  2024 00001A80 2076696F6C6174696F- <1>
  2025 00001A89 6E3A0A              <1>
  2026 00001A8C 596F752076696F6C61- <1> 		db "You violated the computer. Step away slowly. The FBI is on its way.",10,0
  2027 00001A95 746564207468652063- <1>
  2028 00001A9E 6F6D70757465722E20- <1>
  2029 00001AA7 537465702061776179- <1>
  2030 00001AB0 20736C6F776C792E20- <1>
  2031 00001AB9 546865204642492069- <1>
  2032 00001AC2 73206F6E2069747320- <1>
  2033 00001ACB 7761792E0A00        <1>
  2034                              <1> 		
  2035 00001AD1 50616765206661756C- <1> err14	db "Page fault:",10
  2036 00001ADA 743A0A              <1>
  2037 00001ADD 546865207061676520- <1> 		db "The page that was requested was not available.",10,0
  2038 00001AE6 746861742077617320- <1>
  2039 00001AEF 726571756573746564- <1>
  2040 00001AF8 20776173206E6F7420- <1>
  2041 00001B01 617661696C61626C65- <1>
  2042 00001B0A 2E0A00              <1>
  2043                              <1> 		
  2044 00001B0D 526573657276656420- <1> err15	db "Reserved for Plan R:",10
  2045 00001B16 666F7220506C616E20- <1>
  2046 00001B1F 523A0A              <1>
  2047 00001B22 5468697320696E7465- <1> 		db "This interrupt is reserved for usage only by the military when it is necessary",10
  2048 00001B2B 727275707420697320- <1>
  2049 00001B34 726573657276656420- <1>
  2050 00001B3D 666F72207573616765- <1>
  2051 00001B46 206F6E6C7920627920- <1>
  2052 00001B4F 746865206D696C6974- <1>
  2053 00001B58 617279207768656E20- <1>
  2054 00001B61 6974206973206E6563- <1>
  2055 00001B6A 6573736172790A      <1>
  2056 00001B71 746F20696E69746961- <1> 		db "to initiate a full-scale coup d'état.",10,0
  2057 00001B7A 746520612066756C6C- <1>
  2058 00001B83 2D7363616C6520636F- <1>
  2059 00001B8C 7570206427C3A97461- <1>
  2060 00001B95 742E0A00            <1>
  2061                              <1> 		
  2062 00001B99 576861742074686520- <1> unknownerror db "What the hell just happened? Is everyone okay? Hard drive? Video card?",10
  2063 00001BA2 68656C6C206A757374- <1>
  2064 00001BAB 2068617070656E6564- <1>
  2065 00001BB4 3F2049732065766572- <1>
  2066 00001BBD 796F6E65206F6B6179- <1>
  2067 00001BC6 3F2048617264206472- <1>
  2068 00001BCF 6976653F2056696465- <1>
  2069 00001BD8 6F20636172643F0A    <1>
  2070 00001BE0 4D656D6F72793F2041- <1> 			db	"Memory? Are you there?",10,0
  2071 00001BE9 726520796F75207468- <1>
  2072 00001BF2 6572653F0A00        <1>
  2073                              <1> %else
  2074                              <1> unhand:	
  2075                              <1> 	%assign i 0
  2076                              <1> 	%rep 32
  2077                              <1> 	mov byte [intprob], i
  2078                              <1> 	jmp unhand2
  2079                              <1> 	%assign i i+1
  2080                              <1> 	%endrep
  2081                              <1> unhand2:
  2082                              <1> 	cmp byte [intprob], 3
  2083                              <1> 	je handled	;if it is a debug interrupt, it is auto handled
  2084                              <1> 	mov ebx, 0xDEADCD00 ;this shows that an exception occured even though more detailed info cannot be shown
  2085                              <1> 						;CD stands for the interrupt code, DEAD shows that the program died because of the int
  2086                              <1> 	mov bl, [intprob]
  2087                              <1> 	jmp exitprog
  2088                              <1> intprob db 0
  2089                              <1> %endif
  2090                                      %include "source/ints.asm"
  2091                              <1> int30h:	;for great justice
  2092 00001BF8 80FC00              <1> 	cmp ah, 0
  2093 00001BFB 0F84A3000000        <1> 	je near exitprog   ;kills app
  2094 00001C01 80FC01              <1> 	cmp ah, 1
  2095 00001C04 0F8422010000        <1> 	je near prntstr  ;print string
  2096 00001C0A 80FC02              <1> 	cmp ah, 2
  2097 00001C0D 0F84C2010000        <1> 	je near readstr	;read string
  2098 00001C13 80FC03              <1> 	cmp ah, 3
  2099 00001C16 0F84E2010000        <1> 	je near clearscrn	;clear screen
  2100 00001C1C 80FC04              <1> 	cmp ah, 4
  2101 00001C1F 0F8457020000        <1> 	je near prntreadstr	;read and print string
  2102 00001C25 80FC05              <1> 	cmp ah, 5
  2103 00001C28 0F841C070000        <1> 	je near readchar	;get char
  2104 00001C2E 80FC06              <1> 	cmp ah, 6
  2105 00001C31 0F8483070000        <1> 	je near prntchar	;print char
  2106 00001C37 80FC07              <1> 	cmp ah, 7
  2107 00001C3A 0F84A0090000        <1> 	je near openfile	;read file
  2108                              <1> ;	cmp ah, 8
  2109                              <1> ;	je near closefile	;close file
  2110 00001C40 80FC09              <1> 	cmp ah, 9
  2111 00001C43 0F84A1090000        <1> 	je near num2str	;convert number to string
  2112 00001C49 80FC0A              <1> 	cmp ah, 10
  2113 00001C4C 0F84B0090000        <1> 	je near str2num	;convert string to number
  2114                              <1> %ifdef threads.included
  2115 00001C52 80FC0B              <1> 	cmp ah, 11
  2116 00001C55 0F84B3090000        <1> 	je near forkthread	;create thread
  2117                              <1> %endif
  2118 00001C5B 80FC0C              <1> 	cmp ah, 12
  2119 00001C5E 0F84810A0000        <1> 	je near gettime	;get time
  2120 00001C64 80FC0D              <1> 	cmp ah, 13
  2121 00001C67 0F848D0A0000        <1> 	je near settime	;set time
  2122 00001C6D 80FC0E              <1> 	cmp ah, 14
  2123 00001C70 0F84940A0000        <1> 	je near runcmd	;run program
  2124 00001C76 80FC0F              <1> 	cmp ah, 15
  2125 00001C79 0F84A00A0000        <1> 	je near proginfo ;get program info-location of name/options/number of options/environmental vars
  2126 00001C7F 80FC10              <1> 	cmp ah, 16
  2127 00001C82 0F84C20A0000        <1> 	je near hooksig	;hook code to a signal
  2128                              <1> %ifdef gui.included
  2129 00001C88 80FC11              <1> 	cmp ah, 17
  2130 00001C8B 0F84C90A0000        <1> 	je near guiint	;GUI operations
  2131                              <1> %endif
  2132                              <1> %ifdef sound.included
  2133 00001C91 80FC12              <1> 	cmp ah, 18
  2134 00001C94 0F840E0C0000        <1> 	je near soundint	;sound operations
  2135                              <1> %endif
  2136                              <1> %ifdef network.included
  2137 00001C9A 80FC13              <1> 	cmp ah, 19
  2138 00001C9D 0F840A0C0000        <1> 	je near netint	;networking operations
  2139                              <1> %endif
  2140 00001CA3 CF                  <1> 	iret
  2141                              <1> 
  2142                              <1> 	%include 'source/interrupts/0_exitprog.asm'
  2143                              <2> exitprog:
  2144 00001CA4 66B83000            <2> 	mov ax, NEW_DATA_SEL
  2145 00001CA8 8ED8                <2> 	mov ds, ax
  2146 00001CAA 8EC0                <2> 	mov es, ax
  2147 00001CAC 8EE0                <2> 	mov fs, ax
  2148 00001CAE 66B82000            <2> 	mov ax, SYS_DATA_SEL
  2149 00001CB2 8EE8                <2> 	mov gs, ax
  2150 00001CB4 C705[D36C0000]0000- <2> 	mov dword [currentthread], 0
  2151 00001CBC 0000                <2>
  2152 00001CBE C705[CE6C0000]0400- <2> 	mov dword [lastthread], 4
  2153 00001CC6 0000                <2>
  2154 00001CC8 C605[D26C0000]00    <2> 	mov byte [threadson], 0 ;for now i need to use this
  2155 00001CCF 8B25[08B80300]      <2> 	mov esp, [previousstack] ;and this
  2156 00001CD5 81FB00000000        <2> 	cmp ebx, 0
  2157 00001CDB 0F8501000000        <2> 	jne near .error
  2158 00001CE1 C3                  <2> 	ret
  2159                              <2> .error:
  2160 00001CE2 89D9                <2> 	mov ecx, ebx
  2161 00001CE4 B006                <2> 	mov al, 6
  2162 00001CE6 A2[B5310000]        <2> 	mov [firsthexshown], al
  2163 00001CEB 51                  <2> 	push ecx
  2164 00001CEC BE[071D0000]        <2> 	mov esi, .msg1
  2165 00001CF1 E855000000          <2> 	call printhighlight
  2166 00001CF6 59                  <2> 	pop ecx
  2167 00001CF7 E8CE140000          <2> 	call showhex
  2168 00001CFC BE[1C1D0000]        <2> 	mov esi, .msg2
  2169 00001D01 E845000000          <2> 	call printhighlight
  2170 00001D06 C3                  <2> 	ret
  2171                              <2> 	
  2172 00001D07 416E20657869742073- <2> .msg1 db "An exit status of 0x",0
  2173 00001D10 7461747573206F6620- <2>
  2174 00001D19 307800              <2>
  2175 00001D1C 087761732072657475- <2> .msg2 db 8,"was returned.",10,0
  2176 00001D25 726E65642E0A00      <2>
  2177                              <1> 	%include 'source/interrupts/1_prntstr.asm'
  2178                              <2> prntstr:
  2179 00001D2C 30E4                <2> xor ah, ah
  2180 00001D2E E830000000          <2> call printint
  2181 00001D33 E976E5FFFF          <2> jmp timerinterrupt
  2182                              <2> 
  2183                              <2> 	printquiet:
  2184 00001D38 6631C0              <2> 		xor ax, ax
  2185 00001D3B 66A3[D31D0000]      <2> 		mov [endkeyprint], ax
  2186 00001D41 66BB0700            <2> 		mov bx, 7
  2187 00001D45 E832000000          <2> 		call printint.b
  2188 00001D4A C3                  <2> 		ret
  2189                              <2> 
  2190                              <2> 	printhighlight:
  2191 00001D4B 6631C0              <2> 		xor ax, ax
  2192 00001D4E 66BBF000            <2> 		mov bx, 0xF0
  2193 00001D52 E90C000000          <2> 		jmp printint
  2194                              <2> 
  2195                              <2> 	printline:
  2196 00001D57 BE[D48E0000]        <2> 		mov esi, line
  2197                              <2>     print:
  2198 00001D5C 6631C0              <2> 		xor ax, ax
  2199 00001D5F 66BB0700            <2> 		mov bx, 7
  2200                              <2> 	printint:	;print line, ax=last key,bx=modifier, esi=buffer
  2201 00001D63 56                  <2> 		push esi
  2202 00001D64 66A3[D31D0000]      <2> 		mov [endkeyprint], ax
  2203 00001D6A E80D000000          <2> 		call .b
  2204 00001D6F 89F1                <2> 		mov ecx, esi
  2205 00001D71 5F                  <2> 		pop edi
  2206 00001D72 29F9                <2> 		sub ecx, edi
  2207 00001D74 51                  <2> 		push ecx
  2208 00001D75 E8380B0000          <2> 		call termcopy
  2209 00001D7A 59                  <2> 		pop ecx
  2210 00001D7B C3                  <2> 		ret
  2211                              <2> 	.b:	
  2212 00001D7C 53                  <2> 		push ebx
  2213 00001D7D 31C0                <2> 		xor eax, eax
  2214 00001D7F 8A06                <2> 		mov al, [esi]
  2215 00001D81 3CFF                <2> 		cmp al, 0xFF
  2216 00001D83 7435                <2> 		je .doneutf
  2217 00001D85 3CC0                <2> 		cmp al, 0xC0
  2218 00001D87 7231                <2> 		jb .doneutf
  2219 00001D89 3CE0                <2> 		cmp al, 0xE0
  2220 00001D8B 721A                <2> 		jb .two
  2221 00001D8D 46                  <2> 		inc esi
  2222 00001D8E 8A2E                <2> 		mov ch, [esi]
  2223 00001D90 46                  <2> 		inc esi
  2224 00001D91 8A0E                <2> 		mov cl, [esi]
  2225 00001D93 C0E004              <2> 		shl al, 4
  2226 00001D96 C0E102              <2> 		shl cl, 2
  2227 00001D99 66C1E902            <2> 		shr cx, 2
  2228 00001D9D 08C5                <2> 		or ch, al
  2229 00001D9F 6689C8              <2> 		mov ax, cx
  2230 00001DA2 E913000000          <2> 		jmp .doneutf
  2231                              <2> 	.two:
  2232 00001DA7 8A2E                <2> 		mov ch, [esi]
  2233 00001DA9 46                  <2> 		inc esi
  2234 00001DAA 8A0E                <2> 		mov cl, [esi]
  2235 00001DAC 66C1E102            <2> 		shl cx, 2
  2236 00001DB0 C0ED02              <2> 		shr ch, 2
  2237 00001DB3 66C1E902            <2> 		shr cx, 2
  2238 00001DB7 6689C8              <2> 		mov ax, cx
  2239                              <2> 	.doneutf:
  2240 00001DBA 5B                  <2> 		pop ebx
  2241 00001DBB 663B05[D31D0000]    <2> 		cmp ax, [endkeyprint]
  2242 00001DC2 740E                <2> 		je .done
  2243 00001DC4 663DFFFE            <2> 		cmp ax, 0xFEFF
  2244 00001DC8 7405                <2> 		je .noprint
  2245 00001DCA E818060000          <2> 		call prcharq
  2246                              <2> 	.noprint:
  2247 00001DCF 46                  <2> 		inc esi
  2248 00001DD0 EBAA                <2> 		jmp .b
  2249                              <2> 	.done:
  2250 00001DD2 C3                  <2> 		ret
  2251                              <2> 
  2252 00001DD3 0000                <2> endkeyprint dw 0
  2253                              <1> 	%include 'source/interrupts/2_readstr.asm'
  2254                              <2> readstr:
  2255 00001DD5 E805000000          <2> call readint
  2256 00001DDA E9CFE4FFFF          <2> jmp timerinterrupt
  2257                              <2> 
  2258                              <2> 	readint:	;;get line, al=last key, esi = buffer, edi = endbuffer	
  2259 00001DDF 89C3                <2> 		mov ebx, eax
  2260                              <2> 	.b:
  2261 00001DE1 53                  <2> 		push ebx
  2262 00001DE2 57                  <2> 		push edi
  2263 00001DE3 56                  <2> 		push esi
  2264 00001DE4 30C0                <2> 		xor al, al
  2265 00001DE6 E86B050000          <2> 		call rdcharint
  2266 00001DEB 5E                  <2> 		pop esi
  2267 00001DEC 8806                <2> 		mov [esi], al
  2268 00001DEE 46                  <2> 		inc esi
  2269 00001DEF 5F                  <2> 		pop edi
  2270 00001DF0 5B                  <2> 		pop ebx
  2271 00001DF1 39FE                <2> 		cmp esi, edi
  2272 00001DF3 7304                <2> 		jae .done
  2273 00001DF5 38D8                <2> 		cmp al, bl
  2274 00001DF7 75E8                <2> 		jne .b
  2275                              <2> 	.done:
  2276 00001DF9 4E                  <2> 		dec esi
  2277 00001DFA C60600              <2> 		mov byte [esi], 0
  2278 00001DFD C3                  <2> 		ret
  2279                              <1> 	%include 'source/interrupts/3_clearscrn.asm'
  2280                              <2> clearscrn:
  2281 00001DFE E805000000          <2> call clear
  2282 00001E03 E9A6E4FFFF          <2> jmp timerinterrupt
  2283                              <2> %ifdef io.serial
  2284                              <2> clear:
  2285                              <2> 	mov esi, .str
  2286                              <2> 	call print
  2287                              <2> 	ret
  2288                              <2> .str db 27,"[2J",27,"[f",0
  2289                              <2> %else
  2290                              <2> clear:
  2291 00001E08 668B0D[DA250000]    <2> 		mov cx, [charxy]
  2292 00001E0F BF[9ED50300]        <2> 		mov edi, videobuf
  2293 00001E14 31C0                <2> 		xor eax, eax
  2294 00001E16 A3[D0250000]        <2> 		mov [linebeginpos], eax
  2295 00001E1B A3[D4250000]        <2> 		mov [videobufpos], eax
  2296 00001E20 6631D2              <2> 		xor dx, dx
  2297 00001E23 66A3[D8250000]      <2> 		mov [charpos], ax
  2298 00001E29 66B80700            <2> 		mov ax, 7
  2299 00001E2D C1E010              <2> 		shl eax, 16
  2300                              <2> 	clearb:
  2301 00001E30 8907                <2> 		mov [edi], eax
  2302 00001E32 81C704000000        <2> 		add edi, 4
  2303 00001E38 FEC9                <2> 		dec cl
  2304 00001E3A 80F900              <2> 		cmp cl, 0
  2305 00001E3D 75F1                <2> 		jne clearb
  2306 00001E3F 8A0D[DA250000]      <2> 		mov cl, [charxy]
  2307 00001E45 FECD                <2> 		dec ch
  2308 00001E47 80FD00              <2> 		cmp ch, 0
  2309 00001E4A 75E4                <2> 		jne clearb
  2310                              <2> 	cleardouble:
  2311 00001E4C BF[E6AA0400]        <2> 		mov edi, videobuf2
  2312 00001E51 668B0D[DA250000]    <2> 		mov cx, [charxy]
  2313 00001E58 31C0                <2> 		xor eax, eax
  2314                              <2> 	clearc:
  2315 00001E5A 8907                <2> 		mov [edi], eax
  2316 00001E5C 81C704000000        <2> 		add edi, 4
  2317 00001E62 FEC9                <2> 		dec cl
  2318 00001E64 80F900              <2> 		cmp cl, 0
  2319 00001E67 75F1                <2> 		jne clearc
  2320 00001E69 8A0D[DA250000]      <2> 		mov cl, [charxy]
  2321 00001E6F FECD                <2> 		dec ch
  2322 00001E71 80FD00              <2> 		cmp ch, 0
  2323 00001E74 75E4                <2> 		jne clearc
  2324 00001E76 E8370A0000          <2> 		call termcopy
  2325 00001E7B C3                  <2> 		ret
  2326                              <2> %endif
  2327                              <2> 		
  2328                              <1> 	%include 'source/interrupts/4_prntreadstr.asm'
  2329                              <2> prntreadstr:
  2330 00001E7C E80B000000          <2> call rdprint
  2331 00001E81 E928E4FFFF          <2> jmp timerinterrupt
  2332                              <2> 
  2333                              <2> readline:
  2334 00001E86 B00A                <2>   mov al, 10
  2335 00001E88 66BB0700            <2>   mov bx, 7
  2336                              <2> rdprint:	;print and get line, al=last key, bx=modifier, esi=buffer, edi=bufferend
  2337 00001E8C E80F000000          <2> 	call rdprintdos
  2338 00001E91 50                  <2> 	push eax
  2339 00001E92 A0[35230000]        <2> 	mov al, [endkeyrdpr]
  2340 00001E97 30E4                <2> 	xor ah, ah
  2341 00001E99 E832050000          <2> 	call prcharint
  2342 00001E9E 58                  <2> 	pop eax
  2343 00001E9F C3                  <2> 	ret
  2344                              <2> 
  2345                              <2> 	rdprintdos: ;allows dos compatibility with read function
  2346 00001EA0 8935[3F230000]      <2> 		mov [buftxtloc], esi
  2347 00001EA6 A2[35230000]        <2> 		mov [endkeyrdpr], al
  2348 00001EAB 66891D[37230000]    <2> 		mov [modkeyrdpr], bx
  2349 00001EB2 8935[39230000]      <2> 		mov [firstesirdpr], esi
  2350 00001EB8 893D[43230000]      <2> 		mov [endbufferrdpr], edi
  2351 00001EBE 8B3D[3A800500]      <2> 		mov edi, [commandsentered]
  2352 00001EC4 893D[36800500]      <2> 		mov [commandlistentries], edi
  2353                              <2> 	rdprintb:
  2354 00001ECA 56                  <2> 		push esi
  2355 00001ECB B001                <2> 		mov al, 1
  2356 00001ECD E884040000          <2> 		call rdcharint
  2357 00001ED2 8A25[B6230000]      <2> 		mov ah, [lastkey + 2]
  2358 00001ED8 88E1                <2> 		mov cl, ah
  2359 00001EDA 5E                  <2> 		pop esi
  2360                              <2> %ifdef io.serial
  2361                              <2> 		cmp ah, 0x41
  2362                              <2> 		je near rdprup
  2363                              <2> 		cmp ah, 0x42
  2364                              <2> 		je near rdprdown
  2365                              <2> 		cmp ah, 0x43
  2366                              <2> 		je near rdprright
  2367                              <2> 		cmp ah, 0x44
  2368                              <2> 		je near rdprleft
  2369                              <2> 		cmp ah, 0x31
  2370                              <2> 		je near rdprhome
  2371                              <2> 		cmp ah, 0x48
  2372                              <2> 		je near rdprhome
  2373                              <2> 		cmp ah, 0x46
  2374                              <2> 		je near rdprend
  2375                              <2> 		cmp ah, 0x33
  2376                              <2> 		je near rdprdel
  2377                              <2> 		cmp ah, 0x34
  2378                              <2> 		je near rdprend
  2379                              <2> %else
  2380 00001EDB 803D[4F610000]E0    <2> 		cmp byte [specialkey], 0xE0
  2381 00001EE2 753F                <2> 		jne notspecialrdprnt
  2382 00001EE4 80FC53              <2> 		cmp ah, 0x53
  2383 00001EE7 0F84B1030000        <2> 		je near rdprdel
  2384 00001EED 80FC47              <2> 		cmp ah, 0x47
  2385 00001EF0 0F847E010000        <2> 		je near rdprhome
  2386 00001EF6 80FC4F              <2> 		cmp ah, 0x4F
  2387 00001EF9 0F8494010000        <2> 		je near rdprend
  2388 00001EFF 80FC50              <2> 		cmp ah, 0x50
  2389 00001F02 0F8424020000        <2> 		je near rdprdown
  2390 00001F08 80FC4D              <2> 		cmp ah, 0x4D
  2391 00001F0B 0F84C1010000        <2> 		je near rdprright
  2392 00001F11 80FC4B              <2> 		cmp ah, 0x4B
  2393 00001F14 0F8496010000        <2> 		je near rdprleft
  2394 00001F1A 80FC48              <2> 		cmp ah, 0x48
  2395 00001F1D 0F844C020000        <2> 		je near rdprup
  2396                              <2> 	notspecialrdprnt:
  2397                              <2> %endif
  2398 00001F23 66A1[B4230000]      <2> 		mov ax, [lastkey]
  2399 00001F29 663D0800            <2> 		cmp ax, 8
  2400 00001F2D 0F84A0030000        <2> 		je near rdprbscheck
  2401 00001F33 663D0000            <2> 		cmp ax, 0
  2402 00001F37 7491                <2> 		je rdprintb
  2403 00001F39 80F900              <2> 		cmp cl, 0
  2404 00001F3C 748C                <2> 		je rdprintb
  2405 00001F3E 663D8000            <2> 		cmp ax, 0x80
  2406 00001F42 7257                <2> 		jb .normal
  2407 00001F44 663D0008            <2> 		cmp ax, 0x800
  2408 00001F48 7321                <2> 		jae .three
  2409 00001F4A 46                  <2> 		inc esi
  2410 00001F4B 3B35[43230000]      <2> 		cmp esi, [endbufferrdpr]
  2411 00001F51 0F83DA000000        <2> 		jae near donerdprinc
  2412 00001F57 66C1E002            <2> 		shl ax, 2
  2413 00001F5B C0E802              <2> 		shr al, 2
  2414 00001F5E 0C80                <2> 		or al, 10000000b
  2415 00001F60 80CCC0              <2> 		or ah, 11000000b
  2416 00001F63 8866FF              <2> 		mov [esi - 1], ah
  2417 00001F66 E930000000          <2> 		jmp .normal
  2418                              <2> .three:	
  2419 00001F6B 81C602000000        <2> 		add esi, 2
  2420 00001F71 3B35[43230000]      <2> 		cmp esi, [endbufferrdpr]
  2421 00001F77 0F83B4000000        <2> 		jae near donerdprinc
  2422 00001F7D 88E1                <2> 		mov cl, ah
  2423 00001F7F C0E904              <2> 		shr cl, 4
  2424 00001F82 80C9E0              <2> 		or cl, 11100000b
  2425 00001F85 884EFE              <2> 		mov [esi - 2], cl
  2426 00001F88 66C1E004            <2> 		shl ax, 4
  2427 00001F8C 66C1E802            <2> 		shr ax, 2
  2428 00001F90 80CC80              <2> 		or ah, 10000000b
  2429 00001F93 C0E802              <2> 		shr al, 2
  2430 00001F96 0C80                <2> 		or al, 10000000b
  2431 00001F98 8866FF              <2> 		mov [esi - 1], ah
  2432                              <2> .normal:
  2433 00001F9B 8806                <2> 		mov [esi], al
  2434 00001F9D 46                  <2> 		inc esi
  2435 00001F9E 66A1[B4230000]      <2> 		mov ax, [lastkey]
  2436                              <2> 	bscheckequal:
  2437 00001FA4 668B1D[37230000]    <2> 		mov bx, [modkeyrdpr]
  2438 00001FAB 803D[3E230000]00    <2> 		cmp byte [txtmask], 0
  2439 00001FB2 7407                <2> 		je nomasktxt
  2440 00001FB4 30E4                <2> 		xor ah, ah
  2441 00001FB6 A0[3E230000]        <2> 		mov al, [txtmask]
  2442                              <2> 	nomasktxt:
  2443 00001FBB 56                  <2> 		push esi
  2444 00001FBC 66A3[33230000]      <2> 		mov [axcache], ax
  2445 00001FC2 668B1D[35230000]    <2> 		mov bx, [endkeyrdpr]
  2446 00001FC9 6639D8              <2> 		cmp ax, bx
  2447 00001FCC 7432                <2> 		je nobackprintbuftxt2
  2448 00001FCE E8FD030000          <2> 		call prcharint
  2449 00001FD3 BE[88CA0300]        <2> 		mov esi, buftxt2
  2450 00001FD8 E85BFDFFFF          <2> 		call printquiet
  2451 00001FDD 66B82000            <2> 		mov ax, " "
  2452 00001FE1 E801040000          <2> 		call prcharq
  2453 00001FE6 66B80800            <2> 		mov ax, 8
  2454 00001FEA 81FE[88CA0300]      <2> 		cmp esi, buftxt2
  2455 00001FF0 740E                <2> 		je nobackprintbuftxt2
  2456                              <2> 	backprintbuftxt2:
  2457 00001FF2 E8F0030000          <2> 		call prcharq
  2458 00001FF7 4E                  <2> 		dec esi
  2459 00001FF8 81FE[88CA0300]      <2> 		cmp esi, buftxt2
  2460 00001FFE 77F2                <2> 		ja backprintbuftxt2
  2461                              <2> 	nobackprintbuftxt2:
  2462 00002000 663D0A00            <2> 		cmp ax, 10
  2463 00002004 7405                <2> 		je nonobackprint
  2464 00002006 E8C5030000          <2> 		call prcharint
  2465                              <2> 	nonobackprint:
  2466 0000200B 5E                  <2> 		pop esi
  2467 0000200C 3B35[43230000]      <2> 		cmp esi, [endbufferrdpr]
  2468 00002012 0F8319000000        <2> 		jae near donerdprinc
  2469 00002018 66A1[33230000]      <2> 		mov ax, [axcache]
  2470 0000201E 8A25[35230000]      <2> 		mov ah, [endkeyrdpr]
  2471 00002024 38E0                <2> 		cmp al, ah
  2472 00002026 0F859EFEFFFF        <2> 		jne rdprintb
  2473 0000202C E901000000          <2> 		jmp donerdprint
  2474                              <2> 	donerdprinc:
  2475 00002031 46                  <2> 		inc esi
  2476                              <2> 	donerdprint:
  2477 00002032 4E                  <2> 		dec esi
  2478 00002033 BF[88CA0300]        <2> 		mov edi, buftxt2
  2479                              <2> 	copylaterstuff:
  2480 00002038 8A07                <2> 		mov al, [edi]
  2481 0000203A 3C00                <2> 		cmp al, 0
  2482 0000203C 7406                <2> 		je nocopylaterstuff
  2483 0000203E 8806                <2> 		mov [esi], al
  2484 00002040 47                  <2> 		inc edi
  2485 00002041 46                  <2> 		inc esi
  2486 00002042 EBF4                <2> 		jmp copylaterstuff
  2487                              <2> 	nocopylaterstuff:
  2488 00002044 C60600              <2> 		mov byte [esi], 0
  2489 00002047 E80B000000          <2> 		call clearbuftxt2
  2490 0000204C 89F1                <2> 		mov ecx, esi
  2491 0000204E 8B3D[39230000]      <2> 		mov edi, [firstesirdpr]
  2492 00002054 29F9                <2> 		sub ecx, edi
  2493 00002056 C3                  <2> 		ret
  2494                              <2> 	
  2495                              <2> 	clearbuftxt2:
  2496 00002057 30C0                <2> 		xor al, al
  2497 00002059 BF[88CA0300]        <2> 		mov edi, buftxt2
  2498                              <2> 	clearbuftxt2lp:
  2499 0000205E 8807                <2> 		mov [edi], al
  2500 00002060 47                  <2> 		inc edi
  2501 00002061 81FF[88CE0300]      <2> 		cmp edi, buftxt
  2502 00002067 75F5                <2> 		jne clearbuftxt2lp
  2503 00002069 C3                  <2> 		ret
  2504                              <2> 	
  2505                              <2> 	rdprintb2:
  2506 0000206A E843080000          <2> 		call termcopy
  2507 0000206F E956FEFFFF          <2> 		jmp rdprintb
  2508                              <2> 	
  2509                              <2> 	rdprhome:
  2510 00002074 3B35[3F230000]      <2> 		cmp esi, [buftxtloc]
  2511 0000207A 0F84EAFFFFFF        <2> 		je near rdprintb2
  2512 00002080 BF[88CA0300]        <2> 		mov edi, buftxt2
  2513 00002085 8A07                <2> 		mov al, [edi]
  2514 00002087 E879020000          <2> 		call shiftbuftxt2
  2515 0000208C E856030000          <2> 		call prcharq
  2516 00002091 EBE1                <2> 		jmp rdprhome
  2517                              <2> 		
  2518                              <2> 	rdprend:
  2519 00002093 BF[88CA0300]        <2> 		mov edi, buftxt2
  2520 00002098 8A07                <2> 		mov al, [edi]
  2521 0000209A 3C00                <2> 		cmp al, 0
  2522 0000209C 0F84C8FFFFFF        <2> 		je near rdprintb2
  2523 000020A2 8806                <2> 		mov [esi], al
  2524 000020A4 E849000000          <2> 		call shiftbuftxt2lft
  2525 000020A9 E839030000          <2> 		call prcharq
  2526 000020AE EBE3                <2> 		jmp rdprend
  2527                              <2> 	
  2528                              <2> 	rdprleft:
  2529 000020B0 3B35[3F230000]      <2> 		cmp esi, [buftxtloc]
  2530 000020B6 0F840EFEFFFF        <2> 		je near rdprintb
  2531 000020BC BF[88CA0300]        <2> 		mov edi, buftxt2
  2532 000020C1 8A07                <2> 		mov al, [edi]
  2533 000020C3 E83D020000          <2> 		call shiftbuftxt2
  2534 000020C8 E803030000          <2> 		call prcharint
  2535 000020CD E9F8FDFFFF          <2> 		jmp rdprintb
  2536                              <2> 		
  2537                              <2> 	rdprright:
  2538 000020D2 BF[88CA0300]        <2> 		mov edi, buftxt2
  2539 000020D7 8A07                <2> 		mov al, [edi]
  2540 000020D9 3C00                <2> 		cmp al, 0
  2541 000020DB 0F84E9FDFFFF        <2> 		je near rdprintb
  2542 000020E1 8806                <2> 		mov [esi], al
  2543 000020E3 E80A000000          <2> 		call shiftbuftxt2lft
  2544 000020E8 E8E3020000          <2> 		call prcharint
  2545 000020ED E9D8FDFFFF          <2> 		jmp rdprintb
  2546                              <2> 		
  2547                              <2> 	shiftbuftxt2lft:
  2548 000020F2 55                  <2> 		push ebp
  2549 000020F3 89FD                <2> 		mov ebp, edi
  2550                              <2> 	.lp:
  2551 000020F5 3C00                <2> 		cmp al, 0
  2552 000020F7 7408                <2> 		je noshiftbuftxt2lft
  2553 000020F9 47                  <2> 		inc edi
  2554 000020FA 8A07                <2> 		mov al, [edi]
  2555 000020FC 8847FF              <2> 		mov [edi - 1], al
  2556 000020FF EBF4                <2> 		jmp .lp
  2557                              <2> 	noshiftbuftxt2lft:
  2558 00002101 8A4500              <2> 		mov al, [ebp]
  2559 00002104 5D                  <2> 		pop ebp
  2560 00002105 3CC0                <2> 		cmp al, 0xC0
  2561 00002107 7304                <2> 		jae .nofix
  2562 00002109 3C80                <2> 		cmp al, 0x80
  2563 0000210B 73E5                <2> 		jae shiftbuftxt2lft
  2564                              <2> 	.nofix:
  2565 0000210D 8A06                <2> 		mov al, [esi]
  2566 0000210F 30E4                <2> 		xor ah, ah
  2567 00002111 46                  <2> 		inc esi
  2568 00002112 668B1D[37230000]    <2> 		mov bx, [modkeyrdpr]
  2569 00002119 C3                  <2> 		ret
  2570                              <2> 		
  2571                              <2> 	rdprdownbck:
  2572 0000211A FECC                <2> 		dec ah
  2573 0000211C 8825[3D230000]      <2> 		mov [commandedit], ah
  2574 00002122 E88D000000          <2> 		call rdprbckspc
  2575 00002127 E99EFDFFFF          <2> 		jmp rdprintb
  2576                              <2> 	
  2577                              <2> 	rdprdown:
  2578 0000212C 8A25[3D230000]      <2> 		mov ah, [commandedit]
  2579 00002132 80FC01              <2> 		cmp ah, 1
  2580 00002135 0F868FFDFFFF        <2> 		jbe near rdprintb
  2581 0000213B 8B3D[3A800500]      <2> 		mov edi, [commandsentered]
  2582 00002141 3B3D[36800500]      <2> 		cmp edi, [commandlistentries]
  2583 00002147 7618                <2> 		jbe .nofix
  2584 00002149 8105[36800500]0200- <2> 		add dword [commandlistentries], 2
  2585 00002151 0000                <2>
  2586 00002153 3B3D[36800500]      <2> 		cmp edi, [commandlistentries]
  2587 00002159 7706                <2> 		ja .nofix
  2588 0000215B 893D[36800500]      <2> 		mov [commandlistentries], edi
  2589                              <2> 	.nofix:
  2590 00002161 80FC02              <2> 		cmp ah, 2
  2591 00002164 74B4                <2> 		je rdprdownbck
  2592 00002166 80EC02              <2> 		sub ah, 2
  2593 00002169 8825[3D230000]      <2> 		mov [commandedit], ah
  2594                              <2> 		
  2595                              <2> 	rdprup:
  2596 0000216F 3805[3D230000]      <2> 		cmp [commandedit], al
  2597 00002175 0F844FFDFFFF        <2> 		je near rdprintb
  2598 0000217B 813D[36800500]0000- <2> 		cmp dword [commandlistentries], 0
  2599 00002183 0000                <2>
  2600 00002185 0F843FFDFFFF        <2> 		je near rdprintb
  2601 0000218B FF0D[36800500]      <2> 		dec dword [commandlistentries]
  2602                              <2> 	.lp:
  2603 00002191 BF[88CA0300]        <2> 		mov edi, buftxt2
  2604 00002196 8A07                <2> 		mov al, [edi]
  2605 00002198 3C00                <2> 		cmp al, 0
  2606 0000219A 740E                <2> 		je .start
  2607 0000219C 8806                <2> 		mov [esi], al
  2608 0000219E E84FFFFFFF          <2> 		call shiftbuftxt2lft
  2609 000021A3 E83F020000          <2> 		call prcharq
  2610 000021A8 EBE7                <2> 		jmp .lp
  2611                              <2> 	.start:
  2612 000021AA E805000000          <2> 		call rdprbckspc
  2613 000021AF E948000000          <2> 		jmp getcurrentcommandstr
  2614                              <2> 	rdprbckspc:
  2615 000021B4 3B35[3F230000]      <2> 		cmp esi, [buftxtloc]
  2616 000021BA 7432                <2> 		je nordprupbck
  2617                              <2> 	rdprupbckspclp:
  2618 000021BC 66B80800            <2> 		mov ax, 8
  2619 000021C0 668B1D[37230000]    <2> 		mov bx, [modkeyrdpr]
  2620 000021C7 E81B020000          <2> 		call prcharq
  2621 000021CC 66B82000            <2> 		mov ax, ' '
  2622 000021D0 E812020000          <2> 		call prcharq
  2623 000021D5 66B80800            <2> 		mov ax, 8
  2624 000021D9 E809020000          <2> 		call prcharq
  2625 000021DE 4E                  <2> 		dec esi
  2626 000021DF 3B35[3F230000]      <2> 		cmp esi, [buftxtloc]
  2627 000021E5 7402                <2> 		je nordprupbck2
  2628 000021E7 EBD3                <2> 		jmp rdprupbckspclp
  2629                              <2> 	nordprupbck2:
  2630 000021E9 E8C4060000          <2> 		call termcopy
  2631                              <2> 	nordprupbck:
  2632 000021EE 8B3D[32800500]      <2> 		mov edi, [commandbufpos]
  2633 000021F4 81C7[3E800500]      <2> 		add edi, commandbuf
  2634 000021FA 4F                  <2> 		dec edi
  2635 000021FB C3                  <2> 		ret
  2636                              <2> 	getcurrentcommandstr:
  2637 000021FC 8A25[3D230000]      <2> 		mov ah, [commandedit]
  2638 00002202 FE05[3D230000]      <2> 		inc byte [commandedit]
  2639                              <2> 	getccmdlp:
  2640 00002208 4F                  <2> 		dec edi
  2641 00002209 8A07                <2> 		mov al, [edi]
  2642 0000220B 81FF[3E800500]      <2> 		cmp edi, commandbuf
  2643 00002211 7231                <2> 		jb getcmdresetcommandbuf
  2644 00002213 81EF[3E800500]      <2> 		sub edi, commandbuf
  2645 00002219 3B3D[32800500]      <2> 		cmp edi, [commandbufpos]
  2646 0000221F 0F84A5FCFFFF        <2> 		je near rdprintb
  2647 00002225 81C7[3E800500]      <2> 		add edi, commandbuf
  2648 0000222B 3C00                <2> 		cmp al, 0
  2649 0000222D 75D9                <2> 		jne getccmdlp
  2650 0000222F FECC                <2> 		dec ah
  2651 00002231 80FC00              <2> 		cmp ah, 0
  2652 00002234 77D2                <2> 		ja getccmdlp
  2653 00002236 47                  <2> 		inc edi
  2654 00002237 81FF[3E900500]      <2> 		cmp edi, commandbufend
  2655 0000223D 770D                <2> 		ja fixcmdbufb4morerdpr
  2656 0000223F E915000000          <2> 		jmp morerdprup
  2657                              <2> 	getcmdresetcommandbuf:
  2658 00002244 BF[3E900500]        <2> 		mov edi, commandbufend
  2659 00002249 47                  <2> 		inc edi
  2660 0000224A EBBC                <2> 		jmp getccmdlp
  2661                              <2> 	fixcmdbufb4morerdpr:
  2662 0000224C 4F                  <2> 		dec edi
  2663 0000224D 81EF[3E900500]      <2> 		sub edi, commandbufend
  2664 00002253 81C7[3E800500]      <2> 		add edi, commandbuf
  2665                              <2> 	morerdprup:
  2666 00002259 8A07                <2> 		mov al, [edi]
  2667 0000225B 47                  <2> 		inc edi
  2668 0000225C 81EF[3E800500]      <2> 		sub edi, commandbuf
  2669 00002262 3C00                <2> 		cmp al, 0
  2670 00002264 0F8400FEFFFF        <2> 		je near rdprintb2
  2671 0000226A 3B3D[32800500]      <2> 		cmp edi, [commandbufpos]
  2672 00002270 0F83F4FDFFFF        <2> 		jae near rdprintb2
  2673 00002276 81C7[3E800500]      <2> 		add edi, commandbuf
  2674 0000227C 8806                <2> 		mov [esi], al
  2675 0000227E 46                  <2> 		inc esi
  2676 0000227F 57                  <2> 		push edi
  2677 00002280 668B1D[37230000]    <2> 		mov bx, [modkeyrdpr]
  2678 00002287 30E4                <2> 		xor ah, ah
  2679 00002289 E859010000          <2> 		call prcharq
  2680 0000228E 5F                  <2> 		pop edi
  2681 0000228F 81FF[3E900500]      <2> 		cmp edi, commandbufend
  2682 00002295 76C2                <2> 		jbe morerdprup
  2683 00002297 BF[3E800500]        <2> 		mov edi, commandbuf
  2684 0000229C EBBB                <2> 		jmp morerdprup
  2685                              <2> 
  2686                              <2> 	rdprdel:
  2687 0000229E BF[88CA0300]        <2> 		mov edi, buftxt2
  2688 000022A3 8A07                <2> 		mov al, [edi]
  2689 000022A5 3C00                <2> 		cmp al, 0
  2690 000022A7 0F841DFCFFFF        <2> 		je near rdprintb
  2691 000022AD 8806                <2> 		mov [esi], al
  2692 000022AF 3C80                <2> 		cmp al, 0x80
  2693 000022B1 7216                <2> 		jb .fn
  2694                              <2> 	.lp:
  2695 000022B3 46                  <2> 		inc esi
  2696 000022B4 47                  <2> 		inc edi
  2697 000022B5 8A07                <2> 		mov al, [edi]
  2698 000022B7 3C00                <2> 		cmp al, 0
  2699 000022B9 0F840BFCFFFF        <2> 		je near rdprintb
  2700 000022BF 8806                <2> 		mov [esi], al
  2701 000022C1 3C80                <2> 		cmp al, 0x80
  2702 000022C3 7204                <2> 		jb .fn
  2703 000022C5 3CC0                <2> 		cmp al, 0xC0
  2704 000022C7 72EA                <2> 		jb .lp
  2705                              <2> 	.fn:
  2706 000022C9 E824FEFFFF          <2> 		call shiftbuftxt2lft
  2707 000022CE E814010000          <2> 		call prcharq
  2708                              <2> 		
  2709                              <2> 	rdprbscheck:
  2710 000022D3 3B35[39230000]      <2> 		cmp esi, [firstesirdpr]
  2711 000022D9 0F86EBFBFFFF        <2> 		jbe near rdprintb
  2712                              <2> 	goodbscheck:
  2713 000022DF 4E                  <2> 		dec esi
  2714 000022E0 8A46FF              <2> 		mov al, [esi - 1]
  2715 000022E3 C60600              <2> 		mov byte [esi], 0
  2716 000022E6 3CC0                <2> 		cmp al, 0xC0
  2717 000022E8 7309                <2> 		jae .onemore
  2718 000022EA 3C80                <2> 		cmp al, 0x80
  2719 000022EC 73F1                <2> 		jae goodbscheck
  2720 000022EE E904000000          <2> 		jmp .nomore
  2721                              <2> 	.onemore:
  2722 000022F3 4E                  <2> 		dec esi
  2723 000022F4 C60600              <2> 		mov byte [esi], 0		
  2724                              <2> 	.nomore:
  2725 000022F7 668B1D[37230000]    <2> 		mov bx, [modkeyrdpr]
  2726 000022FE B008                <2> 		mov al, 8
  2727 00002300 E99FFCFFFF          <2> 		jmp bscheckequal
  2728                              <2> 		
  2729                              <2> 	shiftbuftxt2:
  2730 00002305 55                  <2> 		push ebp
  2731 00002306 89FD                <2> 		mov ebp, edi
  2732                              <2> 	.lp:
  2733 00002308 3C00                <2> 		cmp al, 0
  2734 0000230A 7409                <2> 		je noshiftbuftxt2
  2735 0000230C 47                  <2> 		inc edi
  2736 0000230D 8A27                <2> 		mov ah, [edi]
  2737 0000230F 8807                <2> 		mov [edi], al
  2738 00002311 88E0                <2> 		mov al, ah
  2739 00002313 EBF3                <2> 		jmp .lp
  2740                              <2> 	noshiftbuftxt2:
  2741 00002315 8A4500              <2> 		mov al, [ebp]
  2742 00002318 5D                  <2> 		pop ebp
  2743 00002319 3CC0                <2> 		cmp al, 0xC0
  2744 0000231B 7304                <2> 		jae .nofix
  2745 0000231D 3C80                <2> 		cmp al, 0x80
  2746 0000231F 73E4                <2> 		jae shiftbuftxt2
  2747                              <2> 	.nofix:
  2748 00002321 BF[88CA0300]        <2> 		mov edi, buftxt2
  2749 00002326 4E                  <2> 		dec esi
  2750 00002327 8A06                <2> 		mov al, [esi]
  2751 00002329 8807                <2> 		mov [edi], al
  2752 0000232B C60600              <2> 		mov byte [esi], 0
  2753 0000232E 66B80800            <2> 		mov ax, 8
  2754 00002332 C3                  <2> 		ret
  2755                              <2> 		
  2756 00002333 0000                <2> axcache dw 0
  2757 00002335 0000                <2> endkeyrdpr dw 0
  2758 00002337 0000                <2> modkeyrdpr dw 0
  2759 00002339 00000000            <2> firstesirdpr dd 0
  2760 0000233D 00                  <2> commandedit db 0
  2761 0000233E 00                  <2> txtmask db 0
  2762 0000233F 00000000            <2> buftxtloc dd 0
  2763 00002343 00000000            <2> endbufferrdpr dd 0
  2764 00002347 082000              <2> backcursor db 8," ",0
  2765                              <1> 	%include 'source/interrupts/5_readchar.asm'
  2766                              <2> readchar:
  2767 0000234A E807000000          <2> 	call rdcharint
  2768 0000234F E95ADFFFFF          <2> 	jmp timerinterrupt
  2769                              <2> getchar:
  2770 00002354 30C0                <2> 	xor al, al
  2771                              <2> 	rdcharint:		;get char, if al is 0, wait for key
  2772 00002356 66C705[B8230000]01- <2> 		mov word [trans], 1
  2773 0000235E 00                  <2>
  2774 0000235F 3C00                <2> 		cmp al, 0
  2775 00002361 7509                <2> 		jne transcheck
  2776 00002363 66C705[B8230000]00- <2> 		mov word [trans], 0
  2777 0000236B 00                  <2>
  2778                              <2> 	transcheck:
  2779                              <2> 	%ifdef io.serial
  2780                              <2> 		call serial.receive
  2781                              <2> 		xor ah, ah
  2782                              <2> 		cmp al, 13
  2783                              <2> 		je rdenter
  2784                              <2> 	%else
  2785 0000236C E8003E0000          <2> 		call getkey
  2786 00002371 66A1[B6230000]      <2> 		mov ax, [lastkey + 2]
  2787 00002377 663D1C00            <2> 		cmp ax, 0x1C
  2788 0000237B 7425                <2> 		je rdenter
  2789                              <2> 	%endif
  2790 0000237D 66A1[B4230000]      <2> 		mov ax, [lastkey]
  2791 00002383 668B1D[B8230000]    <2> 		mov bx, [trans]
  2792 0000238A 803D[4F610000]E0    <2> 		cmp byte [specialkey], 0xE0
  2793 00002391 7500                <2> 		jne nospecialtrans
  2794                              <2> 	nospecialtrans:
  2795 00002393 6609C3              <2> 		or bx, ax
  2796 00002396 6681FB0000          <2> 		cmp bx, 0
  2797 0000239B 74CF                <2> 		je transcheck
  2798 0000239D E90C000000          <2> 		jmp rdend
  2799                              <2> 	rdenter:
  2800 000023A2 C1E010              <2> 		shl eax, 16
  2801 000023A5 66B80A00            <2> 		mov ax, 10
  2802 000023A9 A3[B4230000]        <2> 		mov [lastkey], eax
  2803                              <2> 	rdend:
  2804 000023AE A1[B4230000]        <2> 		mov eax, [lastkey]
  2805 000023B3 C3                  <2> 		ret
  2806                              <2> 		
  2807 000023B4 00000000            <2> lastkey dd 0
  2808 000023B8 0000                <2> trans dw 0
  2809                              <1> 	%include 'source/interrupts/6_prntchar.asm'
  2810                              <2> prntchar:
  2811 000023BA 30E4                <2> 	xor ah, ah ;this kills unicode from the outside unfortunately
  2812                              <2> %ifdef io.serial
  2813                              <2> 	call prcharint
  2814                              <2> 	jmp timerinterrupt
  2815                              <2> prcharint:	
  2816                              <2> prcharq:
  2817                              <2> 	call serial.send
  2818                              <2> 	ret
  2819                              <2> %else
  2820 000023BC 38FB                <2> cmp bl, bh
  2821 000023BE 740A                <2> je prchar.notimer
  2822 000023C0 E80B000000          <2> call prcharint
  2823 000023C5 E9E4DEFFFF          <2> jmp timerinterrupt
  2824                              <2> prchar.notimer:
  2825 000023CA E818000000          <2> 	call prcharq
  2826 000023CF CF                  <2> 	iret
  2827                              <2> 	
  2828                              <2> prcharint:	;print char, char in ax, modifier in bx, if ecx is eax then termcopy will not happen, will run termcopy if called as is
  2829 000023D0 663DFFFE            <2> 	cmp ax, 0xFEFF
  2830 000023D4 740E                <2> 	je .ret
  2831 000023D6 39C1                <2> 	cmp ecx, eax
  2832 000023D8 740D                <2> 	je prcharq
  2833 000023DA E808000000          <2> 	call prcharq
  2834 000023DF E8CE040000          <2> 	call termcopy
  2835                              <2> .ret:
  2836 000023E4 C3                  <2> 	ret
  2837 000023E5 00                  <2> termguion db 0
  2838 000023E6 00                  <2> termcopyon db 0
  2839                              <2> prcharq:
  2840 000023E7 C1E310              <2> 	shl ebx, 16
  2841 000023EA 6689C3              <2> 	mov bx, ax
  2842 000023ED 89D8                <2> 	mov eax, ebx
  2843 000023EF A3[DC250000]        <2> 	mov [charbuf], eax
  2844 000023F4 8B1D[D4250000]      <2> 	mov ebx, [videobufpos]
  2845 000023FA BF[9ED50300]        <2> 	mov edi, videobuf
  2846 000023FF 01DF                <2> 	add edi, ebx
  2847 00002401 A1[BD280000]        <2> 	mov eax, [removedvideo]
  2848 00002406 8907                <2> 	mov [edi], eax
  2849 00002408 A1[DC250000]        <2> 	mov eax, [charbuf]
  2850 0000240D 31D2                <2> 	xor edx, edx
  2851 0000240F 668B15[D8250000]    <2> 	mov dx, [charpos]
  2852 00002416 31C9                <2> 	xor ecx, ecx
  2853 00002418 668B0D[DA250000]    <2> 	mov cx, [charxy]
  2854 0000241F 663D0900            <2> 	cmp ax, 9
  2855 00002423 0F8479000000        <2> 	je near prtab
  2856 00002429 663D0D00            <2> 	cmp ax, 13		;I am phasing this out-it is used by windows but not unix based systems
  2857 0000242D 0F849C000000        <2> 	je near prcr
  2858 00002433 663D0A00            <2> 	cmp ax, 10
  2859 00002437 0F84E5000000        <2> 	je near prnlcr
  2860 0000243D 663D0800            <2> 	cmp ax, 8
  2861 00002441 0F8499000000        <2> 	je near prbs
  2862 00002447 663DFF00            <2> 	cmp ax, 255		;null character
  2863 0000244B 0F8424000000        <2> 	je near donescr
  2864 00002451 663D0030            <2> 	cmp ax, (fontend - fonts)/16
  2865 00002455 0F8341000000        <2> 	jae near prnofont
  2866                              <2> donepr:
  2867 0000245B 8907                <2> 	mov [edi], eax
  2868 0000245D 81C704000000        <2> 	add edi, 4
  2869 00002463 FEC2                <2> 	inc dl
  2870                              <2> donecrnl:
  2871 00002465 38CA                <2> 	cmp dl, cl
  2872 00002467 0F83D9000000        <2> 	jae near preol
  2873                              <2> doneeol:
  2874 0000246D 38EE                <2> 	cmp dh, ch
  2875 0000246F 0F83EE000000        <2> 	jae near prscr	
  2876                              <2> donescr:
  2877 00002475 89FB                <2> 	mov ebx, edi
  2878 00002477 8B07                <2> 	mov eax, [edi]
  2879 00002479 A3[BD280000]        <2> 	mov [removedvideo], eax
  2880 0000247E 81EB[9ED50300]      <2> 	sub ebx, videobuf
  2881 00002484 891D[D4250000]      <2> 	mov [videobufpos], ebx
  2882 0000248A 668915[D8250000]    <2> 	mov [charpos], dx
  2883 00002491 A1[DC250000]        <2> 	mov eax, [charbuf]
  2884 00002496 89C3                <2> 	mov ebx, eax
  2885 00002498 C1EB10              <2> 	shr ebx, 16
  2886 0000249B C3                  <2> 	ret
  2887                              <2> 	
  2888                              <2> 	prnofont:
  2889 0000249C 66B80200            <2> 		mov ax, 2
  2890 000024A0 EBB9                <2> 		jmp donepr
  2891                              <2> 	prtab:
  2892 000024A2 8B1D[D0250000]      <2> 		mov ebx, [linebeginpos]
  2893 000024A8 81EF[9ED50300]      <2> 		sub edi, videobuf
  2894 000024AE 29DF                <2> 		sub edi, ebx
  2895 000024B0 C1EF05              <2> 		shr edi, 5
  2896 000024B3 C1E705              <2> 		shl edi, 5
  2897 000024B6 81C720000000        <2> 		add edi, 32
  2898 000024BC C0EA03              <2> 		shr dl, 3
  2899 000024BF C0E203              <2> 		shl dl, 3
  2900 000024C2 80C208              <2> 		add dl, 8
  2901 000024C5 81C7[9ED50300]      <2> 		add edi, videobuf
  2902 000024CB 01DF                <2> 		add edi, ebx
  2903 000024CD EB96                <2> 		jmp donecrnl
  2904                              <2> 	
  2905                              <2> 	prcr:
  2906 000024CF 30D2                <2> 		xor dl, dl
  2907 000024D1 BF[9ED50300]        <2> 		mov edi, videobuf
  2908 000024D6 8B1D[D0250000]      <2> 		mov ebx, [linebeginpos]
  2909 000024DC 01DF                <2> 		add edi, ebx
  2910 000024DE EB85                <2> 		jmp donecrnl
  2911                              <2> 			
  2912                              <2> 	prbs:
  2913 000024E0 8B1D[D0250000]      <2> 		mov ebx, [linebeginpos]
  2914 000024E6 80FA00              <2> 		cmp dl, 0
  2915 000024E9 7415                <2> 		je prbackline
  2916                              <2> 	prnobmr:
  2917 000024EB 891D[D0250000]      <2> 		mov [linebeginpos], ebx
  2918 000024F1 FECA                <2> 		dec dl
  2919 000024F3 31C0                <2> 		xor eax, eax
  2920 000024F5 81EF04000000        <2> 		sub edi, 4
  2921 000024FB E965FFFFFF          <2> 		jmp donecrnl
  2922                              <2> 	prbackline:
  2923 00002500 6631DB              <2> 		xor bx, bx
  2924 00002503 88CA                <2> 		mov dl, cl
  2925 00002505 80FE00              <2> 		cmp dh, 0
  2926 00002508 74E1                <2> 		je prnobmr
  2927 0000250A 8B1D[D0250000]      <2> 		mov ebx, [linebeginpos]
  2928 00002510 6651                <2> 		push cx
  2929 00002512 31C9                <2> 		xor ecx, ecx
  2930 00002514 8A0C24              <2> 		mov cl, [esp]
  2931 00002517 C1E102              <2> 		shl ecx, 2
  2932 0000251A 29CB                <2> 		sub ebx, ecx
  2933 0000251C 6659                <2> 		pop cx
  2934 0000251E FECE                <2> 		dec dh
  2935 00002520 EBC9                <2> 		jmp prnobmr
  2936                              <2> 		
  2937                              <2> 	prnlcr:
  2938 00002522 FEC6                <2> 		inc dh
  2939 00002524 31DB                <2> 		xor ebx, ebx
  2940 00002526 30D2                <2> 		xor dl, dl
  2941 00002528 88CB                <2> 		mov bl, cl
  2942 0000252A 66C1E302            <2> 		shl bx, 2
  2943 0000252E BF[9ED50300]        <2> 		mov edi, videobuf
  2944 00002533 031D[D0250000]      <2> 		add ebx, [linebeginpos]
  2945 00002539 891D[D0250000]      <2> 		mov [linebeginpos], ebx
  2946 0000253F 01DF                <2> 		add edi, ebx
  2947 00002541 E91FFFFFFF          <2> 		jmp donecrnl
  2948                              <2> 		
  2949                              <2> 	preol:
  2950 00002546 30D2                <2> 		xor dl, dl
  2951 00002548 FEC6                <2> 		inc dh
  2952 0000254A 31DB                <2> 		xor ebx, ebx
  2953 0000254C 88CB                <2> 		mov bl, cl
  2954 0000254E 66C1E302            <2> 		shl bx, 2
  2955 00002552 031D[D0250000]      <2> 		add ebx, [linebeginpos]
  2956 00002558 891D[D0250000]      <2> 		mov [linebeginpos], ebx
  2957 0000255E E90AFFFFFF          <2> 		jmp doneeol
  2958                              <2> 	prscr:
  2959 00002563 FECE                <2> 		dec dh
  2960 00002565 BF[9ED50300]        <2> 		mov edi, videobuf
  2961 0000256A 31DB                <2> 		xor ebx, ebx
  2962 0000256C 88CB                <2> 		mov bl, cl
  2963 0000256E 66C1E302            <2> 		shl bx, 2
  2964 00002572 01FB                <2> 		add ebx, edi
  2965                              <2> 	intscrollloop:
  2966 00002574 8B03                <2> 		mov eax, [ebx]
  2967 00002576 8907                <2> 		mov [edi], eax
  2968 00002578 81C704000000        <2> 		add edi, 4
  2969 0000257E 81C304000000        <2> 		add ebx, 4
  2970 00002584 FEC9                <2> 		dec cl
  2971 00002586 80F900              <2> 		cmp cl, 0
  2972 00002589 75E9                <2> 		jne intscrollloop
  2973 0000258B 8A0D[DA250000]      <2> 		mov cl, [charxy]
  2974 00002591 FECD                <2> 		dec ch
  2975 00002593 80FD01              <2> 		cmp ch, 1
  2976 00002596 77DC                <2> 		ja intscrollloop
  2977 00002598 31C0                <2> 		xor eax, eax
  2978 0000259A 81EF[9ED50300]      <2> 		sub edi, videobuf
  2979 000025A0 893D[D0250000]      <2> 		mov [linebeginpos], edi
  2980 000025A6 81C7[9ED50300]      <2> 		add edi, videobuf
  2981 000025AC 89FB                <2> 		mov ebx, edi
  2982                              <2> 	intloopclear:
  2983 000025AE 8903                <2> 		mov [ebx], eax
  2984 000025B0 81C304000000        <2> 		add ebx, 4
  2985 000025B6 FEC9                <2> 		dec cl
  2986 000025B8 80F900              <2> 		cmp cl, 0
  2987 000025BB 75F1                <2> 		jne intloopclear
  2988 000025BD FECD                <2> 		dec ch
  2989 000025BF 80FD00              <2> 		cmp ch, 0
  2990 000025C2 75EA                <2> 		jne intloopclear
  2991 000025C4 668B0D[DA250000]    <2> 		mov cx, [charxy]
  2992 000025CB E9A5FEFFFF          <2> 		jmp donescr
  2993                              <2> 		
  2994 000025D0 00000000            <2> linebeginpos dd 0
  2995 000025D4 00000000            <2> videobufpos: dd 0
  2996 000025D8 0000                <2> charpos db 0,0
  2997 000025DA 501E                <2> charxy db 80,30
  2998 000025DC 00000000            <2> charbuf dd 0
  2999                              <2> %endif
  3000                              <1> 	%include 'source/interrupts/7_openfile.asm'
  3001                              <2> openfile:
  3002 000025E0 E833450000          <2> 	call loadfile
  3003 000025E5 E9C4DCFFFF          <2> 	jmp timerinterrupt
  3004                              <1> 	%include 'source/interrupts/9_num2str.asm'
  3005                              <2> num2str:
  3006 000025EA 3C00                <2> 	cmp al, 0
  3007 000025EC 750A                <2> 	jne num2strb
  3008 000025EE E8920C0000          <2> 	call showdec
  3009 000025F3 E9B6DCFFFF          <2> 	jmp timerinterrupt
  3010                              <2> num2strb:
  3011 000025F8 E8CD0B0000          <2> 	call showhex
  3012 000025FD E9ACDCFFFF          <2> 	jmp timerinterrupt
  3013                              <1> 	%include 'source/interrupts/10_str2num.asm'
  3014                              <2> str2num:
  3015 00002602 89F7                <2> 	mov edi, esi
  3016 00002604 E8570D0000          <2> 	call cnvrttxt	;the string goes into esi, number into ecx
  3017 00002609 E9A0DCFFFF          <2> 	jmp timerinterrupt
  3018                              <2> 	
  3019                              <1> %ifdef threads.included
  3020                              <1> 	%include 'source/interrupts/11_forkthread.asm'
  3021                              <2> forkthread:
  3022                              <2> 			 ;esi is next thread's start address, if 0, fork current thread
  3023                              <2> 			;returns the PID of the new fork in ebx
  3024                              <2> ;WARNING:THIS WILL NOT WORK IN C UNTIL IT COPIES THE ENTIRE STACK
  3025 0000260E FA                  <2> 	cli
  3026 0000260F 60                  <2> 	pushad
  3027 00002610 8925[DD260000]      <2> 	mov [.espold], esp
  3028 00002616 C605[D26C0000]01    <2> 	mov byte [threadson], 1
  3029 0000261D 8B1D[D36C0000]      <2> 	mov ebx, [currentthread]
  3030 00002623 C1E302              <2> 	shl ebx, 2
  3031 00002626 89A3[52B00500]      <2> 	mov [threadlist + ebx], esp
  3032 0000262C C1EB02              <2> 	shr ebx, 2
  3033 0000262F 81FB00000000        <2> 	cmp ebx, 0
  3034 00002635 750C                <2> 	jne .simplestack
  3035 00002637 BB[00B40300]        <2> 	mov ebx, stackend
  3036 0000263C 29E3                <2> 	sub ebx, esp
  3037 0000263E E90B000000          <2> 	jmp .stackcalcdone
  3038                              <2> .simplestack:
  3039 00002643 C1E30A              <2> 	shl ebx, 10
  3040 00002646 81C3[52C80500]      <2> 	add ebx, stack1
  3041 0000264C 29E3                <2> 	sub ebx, esp
  3042                              <2> .stackcalcdone:
  3043 0000264E 29DC                <2> 	sub esp, ebx
  3044 00002650 81C4[52C80500]      <2> 	add esp, stack1
  3045 00002656 8B1D[CE6C0000]      <2> 	mov ebx, [lastthread]
  3046 0000265C C1E308              <2> 	shl ebx, 8
  3047 0000265F 01DC                <2> 	add esp, ebx
  3048 00002661 891D[E1260000]      <2> 	mov [.stackend], ebx
  3049                              <2> 
  3050 00002667 89E5                <2> 	mov ebp, esp
  3051 00002669 8B25[DD260000]      <2> 	mov esp, [.espold]
  3052                              <2> 
  3053 0000266F C1EB0A              <2> 	shr ebx, 10 ;get pid then push it
  3054 00002672 895C2410            <2> 	mov [esp + 16], ebx ;set the old ebx to the new PID
  3055                              <2> 
  3056 00002676 31DB                <2> 	xor ebx, ebx
  3057                              <2> .stackcopy:
  3058 00002678 668B041C            <2> 	mov ax, [esp + ebx]
  3059 0000267C 6689441D00          <2> 	mov [ebp + ebx], ax
  3060 00002681 81C302000000        <2> 	add ebx, 2
  3061 00002687 3B1D[E1260000]      <2> 	cmp ebx, [.stackend]
  3062 0000268D 72E9                <2> 	jb .stackcopy
  3063                              <2> 
  3064 0000268F 31C0                <2> 	xor eax, eax
  3065 00002691 668CC8              <2> 	mov ax, cs
  3066 00002694 89C2                <2> 	mov edx, eax
  3067 00002696 8B4C2428            <2> 	mov ecx, [esp + 40]
  3068 0000269A 81C900020000        <2> 	or ecx, 0x200
  3069                              <2> 	
  3070 000026A0 81FE00000000        <2> 	cmp esi, 0
  3071 000026A6 7504                <2> 	jne .nochangestack
  3072 000026A8 8B742420            <2> 	mov esi, [esp + 32]
  3073                              <2> .nochangestack:
  3074 000026AC 89F0                <2> 	mov eax, esi
  3075 000026AE 89EC                <2> 	mov esp, ebp
  3076                              <2> 
  3077 000026B0 89442420            <2> 	mov [esp + 32], eax
  3078 000026B4 89542424            <2> 	mov [esp + 36], edx
  3079 000026B8 894C2428            <2> 	mov [esp + 40], ecx
  3080                              <2> 
  3081 000026BC 8B1D[CE6C0000]      <2> 	mov ebx, [lastthread]
  3082 000026C2 89A3[52B00500]      <2> 	mov [threadlist + ebx], esp
  3083 000026C8 81C304000000        <2> 	add ebx, 4
  3084 000026CE 891D[CE6C0000]      <2> 	mov [lastthread], ebx
  3085 000026D4 8B25[DD260000]      <2> 	mov esp, [.espold]
  3086 000026DA 61                  <2> 	popad
  3087 000026DB FB                  <2> 	sti
  3088 000026DC CF                  <2> 	iret
  3089                              <2> 
  3090 000026DD 00000000            <2> .espold dd 0
  3091 000026E1 00000000            <2> .stackend dd 0
  3092                              <1> %endif
  3093                              <1> 	%include 'source/interrupts/12_gettime.asm'
  3094                              <2> gettime:
  3095 000026E5 A1[67020000]        <2> 	mov eax, [timeseconds]
  3096 000026EA 8B1D[6B020000]      <2> 	mov ebx, [timenanoseconds]
  3097 000026F0 89D9                <2> 	mov ecx, ebx
  3098 000026F2 C1E90A              <2> 	shr ecx, 10	;this is in microseconds
  3099 000026F5 E9B4DBFFFF          <2> 	jmp timerinterrupt
  3100                              <1> 	%include 'source/interrupts/13_settime.asm'
  3101                              <2> settime:
  3102 000026FA A3[67020000]        <2> 	mov [timeseconds], eax
  3103 000026FF 891D[6B020000]      <2> 	mov [timenanoseconds], ebx
  3104 00002705 E9A4DBFFFF          <2> 	jmp timerinterrupt
  3105                              <2> 	
  3106                              <1> 	%include 'source/interrupts/14_runcmd.asm'
  3107                              <2> runcmd:
  3108 0000270A BF[88CE0300]        <2> 	mov edi, buftxt
  3109                              <2> cpcmd:
  3110 0000270F 8A06                <2> 	mov al, [esi]
  3111 00002711 8807                <2> 	mov [edi], al
  3112 00002713 46                  <2> 	inc esi
  3113 00002714 47                  <2> 	inc edi
  3114 00002715 3C00                <2> 	cmp al, 0
  3115 00002717 75F6                <2> 	jne cpcmd
  3116 00002719 E8B4070000          <2> 	call run
  3117 0000271E CF                  <2> 	iret
  3118                              <1> 	%include 'source/interrupts/15_proginfo.asm'
  3119                              <2> proginfo:
  3120                              <2> 	;mov ebx, variables
  3121 0000271F 8B35[A82F0000]      <2> 	mov esi, [currentcommandloc]
  3122 00002725 89F7                <2> 	mov edi, esi
  3123 00002727 31C9                <2> 	xor ecx, ecx
  3124                              <2> getcommandzeroes:
  3125 00002729 8A07                <2> 	mov al, [edi]
  3126 0000272B 47                  <2> 	inc edi
  3127 0000272C 3C3B                <2> 	cmp al, ';'
  3128 0000272E 740B                <2> 	je nomorezeroes
  3129 00002730 3C00                <2> 	cmp al, 0
  3130 00002732 7407                <2> 	je nomorezeroes
  3131 00002734 3C20                <2> 	cmp al, ' '
  3132 00002736 75F1                <2> 	jne getcommandzeroes
  3133 00002738 41                  <2> 	inc ecx
  3134 00002739 EBEE                <2> 	jmp getcommandzeroes
  3135                              <2> nomorezeroes:
  3136 0000273B 41                  <2> 	inc ecx
  3137 0000273C 4F                  <2> 	dec edi
  3138 0000273D 8B1D[14BA0300]      <2> 	mov ebx, [uid]
  3139 00002743 8B15[D36C0000]      <2> 	mov edx, [currentthread]
  3140 00002749 CF                  <2> 	iret
  3141                              <2> 	
  3142                              <1> 	%include 'source/interrupts/16_hooksig.asm'
  3143                              <2> hooksig: ;hook code in ESI to signal in AL
  3144 0000274A 3C00                <2> 	cmp al, 0
  3145 0000274C 7507                <2> 	jne .quit	;only sig 0, the escape key, is handled, and only for one app
  3146                              <2> ;	xor ebx, ebx
  3147                              <2> ;	mov bl, al
  3148                              <2> ;	shl bl, 2
  3149 0000274E BF[04B40300]        <2> 	mov edi, sigtable
  3150 00002753 8937                <2> 	mov [edi], esi
  3151                              <2> .quit:
  3152 00002755 E954DBFFFF          <2> 	jmp timerinterrupt
  3153                              <1> %ifdef gui.included
  3154                              <1> 	%include 'source/interrupts/17_guiint.asm'
  3155                              <2> guiint:
  3156 0000275A 3CFD                <2> 	cmp al, 253
  3157 0000275C 0F8473000000        <2> 	je near .getinfo
  3158 00002762 803D[F98E0000]01    <2> 	cmp byte [guion], 1
  3159 00002769 0F8550000000        <2> 	jne near .nogui
  3160 0000276F 3C00                <2> 	cmp al, 0
  3161 00002771 0F844D000000        <2> 	je near .clear
  3162 00002777 3C01                <2> 	cmp al, 1
  3163 00002779 0F84A8000000        <2> 	je near .putpixel
  3164 0000277F 3C02                <2> 	cmp al, 2
  3165 00002781 0F84AD000000        <2> 	je near .drawtext
  3166 00002787 3C03                <2> 	cmp al, 3
  3167 00002789 0F84C0000000        <2> 	je near .drawline
  3168 0000278F 3C04                <2> 	cmp al, 4
  3169 00002791 0F84CB000000        <2> 	je near .drawcircle
  3170 00002797 3C05                <2> 	cmp al, 5
  3171 00002799 0F84D3000000        <2> 	je near .fillcircle
  3172 0000279F 3C06                <2> 	cmp al, 6
  3173 000027A1 0F84DB000000        <2> 	je near .drawsquare
  3174 000027A7 3C07                <2> 	cmp al, 7
  3175 000027A9 0F84E6000000        <2> 	je near .fillsquare
  3176 000027AF 3CFE                <2> 	cmp al, 254
  3177 000027B1 0F8446000000        <2> 	je near .setinfo
  3178 000027B7 3CFF                <2> 	cmp al, 255
  3179 000027B9 0F8443000000        <2> 	je near .reset
  3180                              <2> .nogui:
  3181 000027BF E9EADAFFFF          <2> 	jmp timerinterrupt
  3182                              <2> 
  3183                              <2> .clear:		;color in bx
  3184 000027C4 66891D[B8730000]    <2> 	mov [background], bx
  3185                              <2> %ifdef gui.background
  3186                              <2> 	mov ebx, [backgroundimage]
  3187                              <2> 	cmp ebx, 0
  3188                              <2> 	je .clearit
  3189                              <2> 	mov dword [backgroundimage], 0
  3190                              <2> 	mov [.bgi], ebx
  3191                              <2> .clearit:
  3192                              <2> %endif
  3193 000027CB E89C4B0000          <2> 	call guiclear
  3194 000027D0 E9D9DAFFFF          <2> 	jmp timerinterrupt
  3195                              <2> 	
  3196                              <2> .getinfo:	;puts screen size in (dx, cx), background color in bx, and will put other stuff in other places
  3197 000027D5 31DB                <2> 	xor ebx, ebx
  3198 000027D7 31C9                <2> 	xor ecx, ecx
  3199 000027D9 31D2                <2> 	xor edx, edx
  3200 000027DB 381D[F98E0000]      <2> 	cmp [guion], bl
  3201 000027E1 74DC                <2> 	je .nogui
  3202 000027E3 668B1D[B8730000]    <2> 	mov bx, [background]
  3203 000027EA 668B15[645A0000]    <2> 	mov dx, [resolutionx]
  3204 000027F1 668B0D[665A0000]    <2> 	mov cx, [resolutiony]
  3205 000027F8 E9B1DAFFFF          <2> 	jmp timerinterrupt
  3206                              <2> 	
  3207                              <2> .setinfo:	;does nothing yet. will get screen size in (dx, cx), background color in bx, and will put other stuff in other places
  3208 000027FD E9ACDAFFFF          <2> 	jmp timerinterrupt
  3209                              <2> .reset:		;resets the screen to the original settings
  3210 00002802 66BBCF7B            <2> 	mov bx, background.original
  3211 00002806 66891D[B8730000]    <2> 	mov [background], bx
  3212 0000280D 66BBFFFF            <2> 	mov bx, 0xFFFF
  3213 00002811 66891D[757A0000]    <2> 	mov [colorfont2], bx
  3214                              <2> %ifdef gui.background
  3215                              <2> 	mov ebx, [backgroundimage]
  3216                              <2> 	cmp ebx, 0
  3217                              <2> 	jne .resetit
  3218                              <2> 	mov ebx, [.bgi]
  3219                              <2> 	mov [backgroundimage], ebx
  3220                              <2> .resetit:
  3221                              <2> %endif
  3222 00002818 E84F4B0000          <2> 	call guiclear
  3223 0000281D E89A4B0000          <2> 	call reloadallgraphics
  3224 00002822 E987DAFFFF          <2> 	jmp timerinterrupt
  3225                              <2> 
  3226                              <2> %ifdef gui.background
  3227                              <2> 	.bgi dd 0
  3228                              <2> %endif
  3229                              <2> 	
  3230                              <2> .putpixel:	;pixel location in (dx, cx), color in bx
  3231 00002827 6689DE              <2> 	mov si, bx
  3232 0000282A E89C610000          <2> 	call putpixel
  3233 0000282F E97ADAFFFF          <2> 	jmp timerinterrupt
  3234                              <2> 
  3235                              <2> .drawtext:	;background in di, foreground in bx, location in (dx,cx), string in esi
  3236 00002834 66D1E2              <2> 	shl dx, 1
  3237 00002837 66891D[757A0000]    <2> 	mov [colorfont2], bx
  3238 0000283E 66893D[B8730000]    <2> 	mov [background], di
  3239 00002845 E8C3510000          <2> 	call showstring2
  3240 0000284A E95FDAFFFF          <2> 	jmp timerinterrupt
  3241                              <2> 
  3242                              <2> .drawline:	;color in bx, start in (dx,cx), end in (di,si)
  3243 0000284F 6689F0              <2> 	mov ax, si
  3244 00002852 6689DE              <2> 	mov si, bx
  3245 00002855 6689FB              <2> 	mov bx, di
  3246 00002858 E8E3490000          <2> 	call drawline
  3247 0000285D E94CDAFFFF          <2> 	jmp timerinterrupt
  3248                              <2> 
  3249                              <2> .drawcircle: ;color in bx, radius in si, center in (dx,cx)
  3250 00002862 6689F0              <2> 	mov ax, si
  3251 00002865 6689DE              <2> 	mov si, bx
  3252 00002868 E85C450000          <2> 	call drawcircle
  3253 0000286D E93CDAFFFF          <2> 	jmp timerinterrupt
  3254                              <2> 
  3255                              <2> .fillcircle: ;color in bx, radius in si, center in (dx,cx)
  3256 00002872 6689F0              <2> 	mov ax, si
  3257 00002875 6689DE              <2> 	mov si, bx
  3258 00002878 E85E460000          <2> 	call fillcircle
  3259 0000287D E92CDAFFFF          <2> 	jmp timerinterrupt
  3260                              <2> 	
  3261                              <2> .drawsquare: ;color in bx, start in (dx, cx), end in (di, si)
  3262 00002882 6689F0              <2> 	mov ax, si
  3263 00002885 6689DE              <2> 	mov si, bx
  3264 00002888 6689FB              <2> 	mov bx, di
  3265 0000288B E8FC4B0000          <2> 	call drawsquare
  3266 00002890 E919DAFFFF          <2> 	jmp timerinterrupt
  3267                              <2> 
  3268                              <2> .fillsquare: ;color in bx, start in (dx, cx), end in (di, si)
  3269 00002895 6689F0              <2> 	mov ax, si
  3270 00002898 6689DE              <2> 	mov si, bx
  3271 0000289B 6689FB              <2> 	mov bx, di
  3272 0000289E E85E4C0000          <2> 	call fillsquare
  3273 000028A3 E906DAFFFF          <2> 	jmp timerinterrupt
  3274                              <1> %endif
  3275                              <1> %ifdef sound.included
  3276                              <1> 	%include 'source/interrupts/18_soundint.asm'
  3277                              <2> soundint:
  3278 000028A8 E901DAFFFF          <2> 	jmp timerinterrupt
  3279                              <1> %endif
  3280                              <1> %ifdef network.included
  3281                              <1> 	%include 'source/interrupts/19_netint.asm'
  3282                              <2> netint:
  3283 000028AD E9FCD9FFFF          <2> 	jmp timerinterrupt
  3284                              <1> %endif
  3285                              <1> 
  3286                              <1> termcopy:
  3287                              <1> %ifdef io.serial
  3288                              <1> 	ret
  3289                              <1> %else
  3290                              <1> %ifdef terminal.vsync
  3291                              <1> 	mov byte [termcopyneeded], 1
  3292                              <1> 	ret
  3293                              <1> %else
  3294 000028B2 E80A000000          <1> 	call newtermcopy
  3295 000028B7 C3                  <1> 	ret
  3296                              <1> %endif
  3297 000028B8 00                  <1> 	termcopyneeded db 0
  3298 000028B9 00000000            <1> 	termcursorpos dd 0
  3299 000028BD 00000000            <1> 	removedvideo dd 0
  3300                              <1> newtermcopy:
  3301 000028C1 60                  <1> 	pusha
  3302 000028C2 BF[9ED50300]        <1> 	mov edi, videobuf
  3303 000028C7 31DB                <1> 	xor ebx, ebx
  3304 000028C9 881D[B8280000]      <1> 	mov [termcopyneeded], bl
  3305 000028CF 8B1D[D4250000]      <1> 	mov ebx, [videobufpos]
  3306 000028D5 01DF                <1> 	add edi, ebx
  3307 000028D7 893D[B9280000]      <1> 	mov [termcursorpos], edi
  3308 000028DD E8E2000000          <1> 	call switchtermcursor
  3309 000028E2 803D[F98E0000]00    <1> 	cmp byte [guion], 0
  3310 000028E9 0F8420000000        <1> 	je near nowincopy
  3311                              <1> %ifdef gui.included
  3312 000028EF C605[DC810000]00    <1> 	mov byte [mouseselecton], 0
  3313 000028F6 C605[E6230000]01    <1> 	mov byte [termcopyon], 1
  3314 000028FD 803D[E5230000]01    <1> 	cmp byte [termguion], 1
  3315 00002904 0F845C560000        <1> 	je near windowvideocopy
  3316                              <1> %endif
  3317 0000290A E9AE000000          <1> 	jmp nocopytermatall
  3318                              <1> nowincopy:
  3319 0000290F BE00000A00          <1> 	mov esi, 0xA0000
  3320 00002914 A1[47020000]        <1> 	mov eax, [basecache]
  3321 00002919 C1E004              <1> 	shl eax, 4
  3322 0000291C 29C6                <1> 	sub esi, eax
  3323 0000291E BF[9ED50300]        <1> 	mov edi, videobuf
  3324 00002923 31C9                <1> 	xor ecx, ecx
  3325 00002925 668B0D[DA250000]    <1> 	mov cx, [charxy]
  3326                              <1> nowincopy2:
  3327 0000292C 8B07                <1> 	mov eax, [edi]
  3328 0000292E 81C748D50000        <1> 	add edi, (videobuf2 - videobuf)
  3329 00002934 8B1F                <1> 	mov ebx, [edi]
  3330 00002936 8907                <1> 	mov [edi], eax
  3331 00002938 81EF48D50000        <1> 	sub edi, (videobuf2 - videobuf)
  3332 0000293E 81C702000000        <1> 	add edi, 2
  3333 00002944 39D8                <1> 	cmp eax, ebx
  3334 00002946 744B                <1> 	je nopresentwinfont
  3335 00002948 81EF02000000        <1> 	sub edi, 2
  3336 0000294E BD[53910000]        <1> 	mov ebp, fonts
  3337 00002953 31C0                <1> 	xor eax, eax
  3338 00002955 668B07              <1> 	mov ax, [edi]
  3339 00002958 C1E004              <1> 	shl eax, 4
  3340 0000295B 01C5                <1> 	add ebp, eax
  3341 0000295D 81C702000000        <1> 	add edi, 2
  3342 00002963 668B1F              <1> 	mov bx, [edi]
  3343 00002966 31D2                <1> 	xor edx, edx
  3344 00002968 8A15[DA250000]      <1> 	mov dl, [charxy]
  3345 0000296E C1C110              <1> 	rol ecx, 16
  3346 00002971 B110                <1> 	mov cl, 16
  3347                              <1> nowinfont:
  3348 00002973 8A4500              <1> 	mov al, [ebp]
  3349 00002976 D0C8                <1> 	ror al, 1
  3350 00002978 80FB80              <1> 	cmp bl, 0x80
  3351 0000297B 7202                <1> 	jb notnotfont
  3352 0000297D F6D0                <1> 	not al
  3353                              <1> notnotfont:
  3354 0000297F 8806                <1> 	mov [esi], al
  3355 00002981 01D6                <1> 	add esi, edx
  3356 00002983 45                  <1> 	inc ebp
  3357 00002984 FEC9                <1> 	dec cl
  3358 00002986 80F900              <1> 	cmp cl, 0
  3359 00002989 75E8                <1> 	jne nowinfont
  3360 0000298B C1E204              <1> 	shl edx, 4
  3361 0000298E 29D6                <1> 	sub esi, edx
  3362 00002990 C1C110              <1> 	rol ecx, 16
  3363                              <1> nopresentwinfont:
  3364 00002993 81C702000000        <1> 	add edi, 2
  3365 00002999 46                  <1> 	inc esi
  3366 0000299A FEC9                <1> 	dec cl
  3367 0000299C 80F900              <1> 	cmp cl, 0
  3368 0000299F 758B                <1> 	jne nowincopy2
  3369 000029A1 8A0D[DA250000]      <1> 	mov cl, [charxy]
  3370 000029A7 31D2                <1> 	xor edx, edx
  3371 000029A9 88CA                <1> 	mov dl, cl
  3372 000029AB 29D6                <1> 	sub esi, edx
  3373 000029AD C1E204              <1> 	shl edx, 4
  3374 000029B0 01D6                <1> 	add esi, edx
  3375 000029B2 FECD                <1> 	dec ch
  3376 000029B4 80FD00              <1> 	cmp ch, 0
  3377 000029B7 0F856FFFFFFF        <1> 	jne nowincopy2
  3378                              <1> nocopytermatall:
  3379 000029BD E802000000          <1> 	call switchtermcursor
  3380 000029C2 61                  <1> 	popa
  3381 000029C3 C3                  <1> 	ret
  3382                              <1> 	
  3383                              <1> switchtermcursor:
  3384 000029C4 8B3D[B9280000]      <1> 	mov edi, [termcursorpos]
  3385 000029CA 668B4702            <1> 	mov ax, [edi + 2]
  3386 000029CE 668B1F              <1> 	mov bx, [edi]
  3387 000029D1 663D8000            <1> 	cmp ax, 0x80
  3388 000029D5 7209                <1> 	jb movlargecursorterm
  3389 000029D7 66B80700            <1> 	mov ax, 7
  3390 000029DB E904000000          <1> 	jmp movedcursorterm
  3391                              <1> movlargecursorterm:
  3392 000029E0 66B8F000            <1> 	mov ax, 0xF0
  3393                              <1> movedcursorterm:
  3394 000029E4 66894702            <1> 	mov [edi + 2], ax
  3395 000029E8 6681FB0000          <1> 	cmp bx, 0
  3396 000029ED 7507                <1> 	jne fixednocursorterm
  3397 000029EF 66BB2000            <1> 	mov bx, ' '
  3398 000029F3 66891F              <1> 	mov [edi], bx
  3399                              <1> fixednocursorterm:
  3400 000029F6 C3                  <1> 	ret
  3401                              <1> %endif
  3402                                      %include "source/dosints.asm"
  3403                              <1> int20h:
  3404 000029F7 66B8004C            <1> mov ax, 0x4C00
  3405                              <1> int21h:
  3406                              <1> dostosolleros:
  3407 000029FB 6650                <1> 	push ax
  3408 000029FD 66B83000            <1> 	mov ax, NEW_DATA_SEL
  3409 00002A01 8ED8                <1> 	mov ds, ax
  3410 00002A03 8EC0                <1> 	mov es, ax
  3411 00002A05 8EE0                <1> 	mov fs, ax
  3412 00002A07 66B82000            <1> 	mov ax, SYS_DATA_SEL
  3413 00002A0B 8EE8                <1> 	mov gs, ax
  3414 00002A0D 6658                <1> 	pop ax
  3415 00002A0F 9C                  <1> 	pushf
  3416 00002A10 60                  <1> 	pusha
  3417 00002A11 80FC01              <1> 	cmp ah, 1
  3418 00002A14 0F8449000000        <1> 	je near dosgchar
  3419 00002A1A 80FC02              <1> 	cmp ah, 2
  3420 00002A1D 0F8447000000        <1> 	je near doswchar
  3421 00002A23 80FC09              <1> 	cmp ah, 9
  3422 00002A26 0F844B000000        <1> 	je near dosprintstr
  3423 00002A2C 80FC0A              <1> 	cmp ah, 0xA
  3424 00002A2F 0F845A000000        <1> 	je near dosgetstr
  3425 00002A35 80FC2B              <1> 	cmp ah, 0x2B
  3426 00002A38 0F8496000000        <1> 	je near dosgetdate
  3427 00002A3E 80FC2C              <1> 	cmp ah, 0x2C
  3428 00002A41 0F84B0000000        <1> 	je near dosgettime
  3429 00002A47 80FC4C              <1> 	cmp ah, 0x4C
  3430 00002A4A 0F84C5000000        <1> 	je near dosexit
  3431                              <1> backtodos:
  3432 00002A50 61                  <1> 	popa
  3433 00002A51 9D                  <1> 	popf
  3434 00002A52 6650                <1> 	push ax
  3435 00002A54 66B85000            <1> 	mov ax, DOS_DATA_SEL
  3436 00002A58 8ED8                <1> 	mov ds, ax
  3437 00002A5A 8EC0                <1> 	mov es, ax
  3438 00002A5C 8EE0                <1> 	mov fs, ax
  3439 00002A5E 8EE8                <1> 	mov gs, ax
  3440 00002A60 6658                <1> 	pop ax
  3441 00002A62 CF                  <1> 	iret
  3442                              <1> 
  3443                              <1> dosgchar:
  3444 00002A63 E8ECF8FFFF          <1> 	call getchar
  3445 00002A68 EBE6                <1> 	jmp backtodos
  3446                              <1> 	
  3447                              <1> doswchar:
  3448 00002A6A 88D0                <1> 	mov al, dl
  3449 00002A6C 30E4                <1> 	xor ah, ah
  3450 00002A6E B307                <1> 	mov bl, 7
  3451 00002A70 E85BF9FFFF          <1> 	call prcharint
  3452 00002A75 EBD9                <1> 	jmp backtodos
  3453                              <1> 	
  3454                              <1> dosprintstr:
  3455 00002A77 31F6                <1> 	xor esi, esi
  3456 00002A79 6689D6              <1> 	mov si, dx
  3457 00002A7C 81C600004000        <1> 	add esi, dosprogloc
  3458 00002A82 66B82400            <1> 	mov ax, "$"
  3459 00002A86 B307                <1> 	mov bl, 7
  3460 00002A88 E8D6F2FFFF          <1> 	call printint
  3461 00002A8D EBC1                <1> 	jmp backtodos
  3462                              <1> 	
  3463                              <1> dosgetstr:
  3464 00002A8F 31F6                <1> 	xor esi, esi
  3465 00002A91 6689D6              <1> 	mov si, dx
  3466 00002A94 81C600004000        <1> 	add esi, dosprogloc
  3467 00002A9A B900000000          <1> 	mov ecx, 0
  3468 00002A9F 8A0E                <1> 	mov cl, [esi]
  3469 00002AA1 81C602000000        <1> 	add esi, 2
  3470 00002AA7 89F7                <1> 	mov edi, esi
  3471 00002AA9 8935[D02A0000]      <1> 	mov [stringstart], esi
  3472 00002AAF 01CF                <1> 	add edi, ecx
  3473 00002AB1 B00A                <1> 	mov al, 10
  3474 00002AB3 B307                <1> 	mov bl, 7
  3475 00002AB5 E8E6F3FFFF          <1> 	call rdprintdos
  3476 00002ABA 89F1                <1> 	mov ecx, esi
  3477 00002ABC 2B0D[D02A0000]      <1> 	sub ecx, [stringstart]
  3478 00002AC2 8B35[D02A0000]      <1> 	mov esi, [stringstart]
  3479 00002AC8 884EFF              <1> 	mov [esi - 1], cl
  3480 00002ACB 884EFE              <1> 	mov [esi - 2], cl
  3481 00002ACE EB80                <1> 	jmp backtodos
  3482 00002AD0 00000000            <1> stringstart dd 0
  3483                              <1> 
  3484                              <1> dosgetdate:
  3485 00002AD4 E86F160000          <1> 	call time
  3486 00002AD9 8A0D[5C440000]      <1> 	mov cl, [RTCtimeYear]
  3487 00002ADF B500                <1> 	mov ch, 0
  3488 00002AE1 6681C1D007          <1> 	add cx, 2000
  3489 00002AE6 8A35[5B440000]      <1> 	mov dh, [RTCtimeMonth]
  3490 00002AEC 8A15[5A440000]      <1> 	mov dl, [RTCtimeDay]
  3491 00002AF2 E959FFFFFF          <1> 	jmp backtodos
  3492                              <1> 
  3493                              <1> dosgettime:
  3494 00002AF7 E84C160000          <1> 	call time
  3495 00002AFC 8A2D[59440000]      <1> 	mov ch, [RTCtimeHour]
  3496 00002B02 8A0D[58440000]      <1> 	mov cl, [RTCtimeMinute]
  3497 00002B08 8A35[57440000]      <1> 	mov dh, [RTCtimeSecond]
  3498 00002B0E B200                <1> 	mov dl, 0
  3499 00002B10 E93BFFFFFF          <1> 	jmp backtodos
  3500                              <1> 	
  3501                              <1> dosexit:
  3502 00002B15 BE[D48E0000]        <1> 	mov esi, line
  3503 00002B1A E83DF2FFFF          <1> 	call print
  3504 00002B1F 61                  <1> 	popa
  3505 00002B20 9D                  <1> 	popf
  3506 00002B21 8B25[08B80300]      <1> 	mov esp, [previousstack]
  3507 00002B27 31DB                <1> 	xor ebx, ebx
  3508 00002B29 88C3                <1> 	mov bl, al
  3509 00002B2B 80FB00              <1> 	cmp bl, 0
  3510 00002B2E 0F85AEF1FFFF        <1> 	jne near exitprog.error
  3511 00002B34 C3                  <1> 	ret
  3512                                      %include "source/shush.asm"
  3513                              <1> os:
  3514                              <1> setdefenv:
  3515 00002B35 C605[14B80300]2F    <1> 	mov byte [currentfolder], '/'
  3516 00002B3C C705[10B80300]0100- <1> 	mov dword [currentfolderloc], 1
  3517 00002B44 0000                <1>
  3518 00002B46 E8BDF2FFFF          <1> 	call clear
  3519                              <1> 	
  3520                              <1> bootfilecheck:
  3521 00002B4B 803D[18BA0300]01    <1> 	cmp byte [ranboot], 1
  3522 00002B52 0F8421000000        <1> 	je near nobootfile
  3523                              <1> 	%ifdef hardware.automatic
  3524 00002B58 E86A3B0000          <1> 		call initializelater ;Initialize components that have debug messages
  3525                              <1> 	%endif
  3526                              <1> 	%ifdef disk.none
  3527                              <1> 	%else
  3528 00002B5D BF[938E0000]        <1> 		mov edi, bootfilename
  3529 00002B62 BE00004000          <1> 		mov esi, 0x400000
  3530 00002B67 E8AC3F0000          <1> 		call loadfile
  3531 00002B6C 81FA00000000        <1> 		cmp edx, 0
  3532 00002B72 7505                <1> 		jne nobootfile
  3533 00002B74 E8BA0D0000          <1> 		call progbatchfound
  3534                              <1> 	%endif
  3535                              <1> nobootfile:	
  3536 00002B79 C605[18BA0300]01    <1> 	mov byte [ranboot], 1
  3537                              <1> 
  3538 00002B80 BE[02000000]        <1> 	mov esi, signature
  3539                              <1> .sigcopyloop:	;this prevents an odd error
  3540 00002B85 658A06              <1> 	mov al, [gs:esi]
  3541 00002B88 8806                <1> 	mov [esi], al
  3542 00002B8A 46                  <1> 	inc esi
  3543 00002B8B 81FE[10000000]      <1> 	cmp esi, signatureend
  3544 00002B91 72F2                <1> 	jb .sigcopyloop
  3545                              <1> 	
  3546 00002B93 BE[02000000]        <1> 	mov esi, signature
  3547 00002B98 E8BFF1FFFF          <1> 	call print
  3548 00002B9D 8B0D[0C000000]      <1> 	mov ecx, [signatureend - 4]
  3549 00002BA3 E8DD060000          <1> 	call showdec
  3550 00002BA8 E8AAF1FFFF          <1> 	call printline
  3551 00002BAD BE[B08E0000]        <1> 	mov esi, userask
  3552 00002BB2 E8A5F1FFFF          <1> 	call print
  3553                              <1> 
  3554                              <1> usercheck:
  3555 00002BB7 BE[88CE0300]        <1> 	mov esi, buftxt
  3556 00002BBC BF[88D20300]        <1> 	mov edi, buftxtend
  3557 00002BC1 B00A                <1> 	mov al, 10
  3558 00002BC3 E8C4F2FFFF          <1> 	call rdprint
  3559 00002BC8 56                  <1> 	push esi
  3560 00002BC9 BE[BA8E0000]        <1> 	mov esi, pwdask
  3561 00002BCE E889F1FFFF          <1> 	call print
  3562 00002BD3 5E                  <1> 	pop esi
  3563 00002BD4 46                  <1> 	inc esi
  3564 00002BD5 8935[CA2C0000]      <1> 	mov [esipass], esi
  3565                              <1> passcheck:
  3566 00002BDB E874F7FFFF          <1> 	call getchar
  3567 00002BE0 3C0A                <1> 	cmp al, 10
  3568 00002BE2 0F8438000000        <1> 	je near gotpass
  3569 00002BE8 3C08                <1> 	cmp al, 8
  3570 00002BEA 0F8412000000        <1> 	je near backpass
  3571 00002BF0 8806                <1> 	mov [esi], al
  3572 00002BF2 46                  <1> 	inc esi
  3573 00002BF3 30E4                <1> 	xor ah, ah
  3574 00002BF5 B02A                <1> 	mov al, "*"
  3575 00002BF7 E8D4F7FFFF          <1> 	call prcharint
  3576 00002BFC EBDD                <1> 	jmp passcheck
  3577 00002BFE 08200800            <1> backcursor2 db 8," ",8,0
  3578                              <1> backpass:
  3579 00002C02 3B35[CA2C0000]      <1> 	cmp esi, [esipass]
  3580 00002C08 0F84CDFFFFFF        <1> 	je near passcheck
  3581 00002C0E 4E                  <1> 	dec esi
  3582 00002C0F C60600              <1> 	mov byte [esi], 0
  3583 00002C12 56                  <1> 	push esi
  3584 00002C13 BE[FE2B0000]        <1> 	mov esi, backcursor2
  3585 00002C18 E83FF1FFFF          <1> 	call print
  3586 00002C1D 5E                  <1> 	pop esi
  3587 00002C1E EBBB                <1> 	jmp passcheck
  3588                              <1> gotpass:
  3589 00002C20 B00A                <1> 	mov al, 10
  3590 00002C22 E8A9F7FFFF          <1> 	call prcharint
  3591 00002C27 30C0                <1> 	xor al, al
  3592 00002C29 31C9                <1> 	xor ecx, ecx
  3593 00002C2B 8806                <1> 	mov [esi], al
  3594 00002C2D BB[D68E0000]        <1> 	mov ebx, userlst
  3595                              <1> userfind:
  3596 00002C32 BE[88CE0300]        <1> 	mov esi, buftxt
  3597 00002C37 8A06                <1> 	mov al, [esi]
  3598 00002C39 3C00                <1> 	cmp al, 0
  3599 00002C3B 0F84F4FEFFFF        <1> 	je near os
  3600 00002C41 891D[CE2C0000]      <1> 	mov [usercache], ebx
  3601 00002C47 E860030000          <1> 	call tester
  3602 00002C4C 3C01                <1> 	cmp al, 1
  3603 00002C4E 7416                <1> 	je pwdtest
  3604 00002C50 41                  <1> 	inc ecx
  3605                              <1> nxtuser:
  3606 00002C51 8A03                <1> 	mov al, [ebx]
  3607 00002C53 43                  <1> 	inc ebx
  3608 00002C54 3C00                <1> 	cmp al, 0
  3609 00002C56 75F9                <1> 	jne nxtuser
  3610 00002C58 81FB[F98E0000]      <1> 	cmp ebx, userlstend
  3611 00002C5E 0F83D1FEFFFF        <1> 	jae near os
  3612 00002C64 EBCC                <1> 	jmp userfind
  3613                              <1> pwdtest:
  3614 00002C66 46                  <1> 	inc esi
  3615 00002C67 43                  <1> 	inc ebx
  3616 00002C68 E83F030000          <1> 	call tester
  3617 00002C6D 3C01                <1> 	cmp al, 1
  3618 00002C6F 7402                <1> 	je pwdrgt
  3619 00002C71 EBDE                <1> 	jmp nxtuser
  3620                              <1> pwdrgt:
  3621 00002C73 D1E9                <1> 	shr ecx, 1
  3622 00002C75 890D[14BA0300]      <1> 	mov [uid], ecx
  3623 00002C7B E888F1FFFF          <1> 	call clear
  3624 00002C80 31C9                <1> 	xor ecx, ecx
  3625 00002C82 41                  <1> 	inc ecx
  3626 00002C83 890D[32800500]      <1> 	mov [commandbufpos], ecx
  3627                              <1> returnfromexp:
  3628 00002C89 66B90002            <1> 	mov cx, 200h
  3629 00002C8D BE[88CE0300]        <1> 	mov esi, buftxt
  3630 00002C92 8935[A82F0000]      <1> 	mov [currentcommandloc], esi
  3631 00002C98 E825000000          <1> 	call bufclr
  3632                              <1> clearolddata:
  3633 00002C9D 31C0                <1> 	xor eax, eax
  3634 00002C9F A2[19BA0300]        <1> 	mov [IFON], al
  3635 00002CA4 A2[1ABA0300]        <1> 	mov [IFTRUE], al
  3636 00002CA9 A2[82BA0300]        <1> 	mov [BATCHISON], al
  3637 00002CAE A3[7EBA0300]        <1> 	mov [BATCHPOS], eax
  3638 00002CB3 A2[83BA0300]        <1> 	mov [LOOPON], al
  3639 00002CB8 A3[84BA0300]        <1> 	mov [LOOPPOS], eax
  3640 00002CBD E933000000          <1> 	jmp nwcmd
  3641                              <1> bufclr:	
  3642 00002CC2 30C0                <1> 	xor al, al
  3643 00002CC4 8806                <1> 	mov [esi], al
  3644 00002CC6 46                  <1> 	inc esi
  3645 00002CC7 E2F9                <1> 	loop bufclr
  3646 00002CC9 C3                  <1> 	ret
  3647                              <1> 
  3648 00002CCA 00000000            <1> esipass dd 0
  3649 00002CCE [D68E0000]          <1> usercache dd userlst
  3650                              <1> 	
  3651                              <1> buftxtclear:
  3652 00002CD2 30C0                <1> 	xor al, al
  3653 00002CD4 BE[88CE0300]        <1> 	mov esi, buftxt
  3654 00002CD9 81FE[88D20300]      <1> clearbuftxt: cmp esi, buf2
  3655 00002CDF 730E                <1> 	jae retbufclr
  3656 00002CE1 8806                <1> 	mov [esi], al
  3657 00002CE3 46                  <1> 	inc esi
  3658 00002CE4 EBF3                <1> 	jmp clearbuftxt
  3659                              <1> 
  3660 00002CE6 39DE                <1> clearitbuf: cmp esi, ebx
  3661 00002CE8 7305                <1> 	jae retbufclr
  3662 00002CEA 8806                <1> 	mov [esi], al
  3663 00002CEC 46                  <1> 	inc esi
  3664 00002CED EBF7                <1> 	jmp clearitbuf
  3665 00002CEF C3                  <1> retbufclr: ret
  3666                              <1> 
  3667 00002CF0 E900000000          <1> full:	jmp nwcmd
  3668                              <1> 
  3669                              <1> shush:	;SollerOS Hardly Unix-compatible Shell
  3670                              <1> nwcmd:
  3671 00002CF5 FB                  <1> 	sti
  3672 00002CF6 31C0                <1> 	xor eax, eax
  3673 00002CF8 3905[CA2E0000]      <1> 	cmp [nextcommandloc], eax
  3674 00002CFE 7413                <1> 	je nomultiplecommand
  3675 00002D00 8B35[CA2E0000]      <1> 	mov esi, [nextcommandloc]
  3676 00002D06 8935[CE2E0000]      <1> 	mov [thiscommandloc], esi
  3677 00002D0C E8C6010000          <1> 	call fixvariables
  3678 00002D11 EBE2                <1> 	jmp nwcmd
  3679                              <1> nomultiplecommand:
  3680 00002D13 A3[CE2E0000]        <1> 	mov [thiscommandloc], eax
  3681 00002D18 3805[D26C0000]      <1> 	cmp [threadson], al
  3682 00002D1E 7405                <1> 	je noclinwcmd
  3683 00002D20 A2[D26C0000]        <1> 	mov [threadson], al
  3684                              <1> noclinwcmd:
  3685 00002D25 B001                <1> 	mov al, 1
  3686 00002D27 3805[82BA0300]      <1> 	cmp [BATCHISON], al
  3687 00002D2D 7501                <1> 	jne cancel
  3688 00002D2F C3                  <1> 	ret
  3689 00002D30 30C0                <1> cancel:	xor al, al
  3690 00002D32 A2[19BA0300]        <1> 	mov [IFON], al
  3691 00002D37 A2[82BA0300]        <1> 	mov [BATCHISON], al
  3692 00002D3C B05B                <1> 	mov al, '['
  3693 00002D3E 66BB0700            <1> 	mov bx, 7
  3694 00002D42 E8A0F6FFFF          <1> 	call prcharq
  3695 00002D47 8B35[CE2C0000]      <1> 	mov esi, [usercache]
  3696 00002D4D E8E6EFFFFF          <1> 	call printquiet
  3697 00002D52 BE[C48E0000]        <1> 	mov esi, computer
  3698 00002D57 E8DCEFFFFF          <1> 	call printquiet
  3699 00002D5C BE[14B80300]        <1> 	mov esi, currentfolder
  3700 00002D61 0335[0CB80300]      <1> 	add esi, [lastfolderloc]
  3701 00002D67 E8CCEFFFFF          <1> 	call printquiet
  3702 00002D6C BE[CF8E0000]        <1> 	mov esi, endprompt
  3703 00002D71 E8E6EFFFFF          <1> 	call print
  3704 00002D76 E857FFFFFF          <1> 	call buftxtclear
  3705 00002D7B BE[88CE0300]        <1> 	mov esi, buftxt
  3706 00002D80 C605[3D230000]01    <1> 	mov byte [commandedit], 1
  3707 00002D87 B00A                <1> 	mov al, 10
  3708 00002D89 66BB0700            <1> 	mov bx, 7
  3709 00002D8D BF[88D20300]        <1> 	mov edi, buftxtend
  3710 00002D92 E8F5F0FFFF          <1> 	call rdprint
  3711 00002D97 C605[3D230000]00    <1> 	mov byte [commandedit], 0
  3712 00002D9E 803D[88CE0300]00    <1> 	cmp byte [buftxt], 0
  3713 00002DA5 0F844AFFFFFF        <1> 	je near nwcmd
  3714 00002DAB 8B35[32800500]      <1> gotcmd:	mov esi, [commandbufpos]
  3715 00002DB1 8935[2E800500]      <1> 	mov [lastcommandpos], esi
  3716 00002DB7 FF05[3A800500]      <1> 	inc dword [commandsentered]
  3717 00002DBD BF[88CE0300]        <1> 	mov edi, buftxt
  3718 00002DC2 81C6[3E800500]      <1> 	add esi, commandbuf
  3719 00002DC8 81FE[3E900500]      <1> 	cmp esi, commandbufend
  3720 00002DCE 7605                <1> 	jbe copycommand
  3721 00002DD0 BE[3E800500]        <1> 	mov esi, commandbuf
  3722                              <1> copycommand:
  3723 00002DD5 8A07                <1> 	mov al, [edi]
  3724 00002DD7 8806                <1> 	mov [esi], al
  3725 00002DD9 47                  <1> 	inc edi
  3726 00002DDA 46                  <1> 	inc esi
  3727 00002DDB 3C00                <1> 	cmp al, 0
  3728 00002DDD 740F                <1> 	je donecopy
  3729 00002DDF 81FE[3E900500]      <1> 	cmp esi, commandbufend
  3730 00002DE5 76EE                <1> 	jbe copycommand
  3731 00002DE7 BE[3E800500]        <1> 	mov esi, commandbuf
  3732 00002DEC EBE7                <1> 	jmp copycommand
  3733                              <1> donecopy:
  3734 00002DEE 81EE[3E800500]      <1> 	sub esi, commandbuf
  3735 00002DF4 8935[32800500]      <1> 	mov [commandbufpos], esi
  3736 00002DFA E8D3000000          <1> 	call run
  3737 00002DFF E9F1FEFFFF          <1> 	jmp nwcmd
  3738                              <1> 
  3739 00002E04 E8C9FEFFFF          <1> input:	call buftxtclear
  3740 00002E09 BE[88CE0300]        <1> 	mov esi, buftxt		;puts input into buftxt AND onto screen
  3741 00002E0E BF[88D20300]        <1> 	mov edi, buftxtend
  3742 00002E13 B00A                <1> stdin:	mov al, 10
  3743 00002E15 B307                <1> 	mov bl, 7
  3744 00002E17 E870F0FFFF          <1> 	call rdprint
  3745 00002E1C C3                  <1> 	ret
  3746                              <1> 
  3747                              <1> replacevariable:
  3748 00002E1D 8A4601              <1> 	mov al, [esi + 1]
  3749 00002E20 C64601FF            <1> 	mov byte [esi + 1], 255
  3750 00002E24 3C24                <1> 	cmp al, "$"
  3751 00002E26 0F84AB000000        <1> 	je near fixvariables
  3752 00002E2C 884601              <1> 	mov [esi + 1], al
  3753 00002E2F 56                  <1> 	push esi
  3754 00002E30 81EE[88CE0300]      <1> 	sub esi, buftxt
  3755 00002E36 89F7                <1> 	mov edi, esi
  3756 00002E38 81C6[88CE0300]      <1> 	add esi, buftxt
  3757 00002E3E 47                  <1> 	inc edi
  3758 00002E3F BB[88BA0300]        <1> 	mov ebx, variables
  3759 00002E44 E8E6190000          <1> 	call nxtvrech
  3760 00002E49 89F7                <1> 	mov edi, esi
  3761 00002E4B 31DB                <1> 	xor ebx, ebx
  3762 00002E4D 4E                  <1> 	dec esi
  3763                              <1> findvarname:
  3764 00002E4E 4E                  <1> 	dec esi
  3765 00002E4F 8A06                <1> 	mov al, [esi]
  3766 00002E51 43                  <1> 	inc ebx
  3767 00002E52 3C04                <1> 	cmp al, 4
  3768 00002E54 75F8                <1> 	jne findvarname
  3769 00002E56 5E                  <1> 	pop esi
  3770                              <1> replacevarloop:
  3771 00002E57 8A07                <1> 	mov al, [edi]
  3772 00002E59 3C00                <1> 	cmp al, 0
  3773 00002E5B 0F8413000000        <1> 	je near compressbuftxt
  3774 00002E61 81FB00000000        <1> 	cmp ebx, 0
  3775 00002E67 0F8416000000        <1> 	je near expandbuftxt
  3776 00002E6D 8806                <1> 	mov [esi], al
  3777 00002E6F 4B                  <1> 	dec ebx
  3778 00002E70 46                  <1> 	inc esi
  3779 00002E71 47                  <1> 	inc edi
  3780 00002E72 EBE3                <1> 	jmp replacevarloop
  3781                              <1> compressbuftxt:
  3782 00002E74 8A041E              <1> 	mov al, [esi + ebx]
  3783 00002E77 8806                <1> 	mov [esi], al
  3784 00002E79 46                  <1> 	inc esi
  3785 00002E7A 3C00                <1> 	cmp al, 0
  3786 00002E7C 75F6                <1> 	jne compressbuftxt
  3787 00002E7E E954000000          <1> 	jmp fixvariables
  3788                              <1> expandbuftxt:
  3789 00002E83 89F1                <1> 	mov ecx, esi
  3790 00002E85 8A26                <1> 	mov ah, [esi]
  3791                              <1> expandbuftxtlp:
  3792 00002E87 8A1E                <1> 	mov bl, [esi]
  3793 00002E89 46                  <1> 	inc esi
  3794 00002E8A 8A3E                <1> 	mov bh, [esi]
  3795 00002E8C 8826                <1> 	mov [esi], ah
  3796 00002E8E 88FC                <1> 	mov ah, bh
  3797 00002E90 80FB00              <1> 	cmp bl, 0
  3798 00002E93 75F2                <1> 	jne expandbuftxtlp
  3799 00002E95 89CE                <1> 	mov esi, ecx
  3800 00002E97 8806                <1> 	mov [esi], al
  3801 00002E99 47                  <1> 	inc edi
  3802 00002E9A 8A07                <1> 	mov al, [edi]
  3803 00002E9C 3C00                <1> 	cmp al, 0
  3804 00002E9E 0F8433000000        <1> 	je near fixvariables
  3805 00002EA4 46                  <1> 	inc esi
  3806 00002EA5 EBDC                <1> 	jmp expandbuftxt
  3807                              <1> multipleprogline:
  3808 00002EA7 30E4                <1> 	xor ah, ah
  3809 00002EA9 8826                <1> 	mov [esi], ah
  3810 00002EAB 46                  <1> 	inc esi
  3811 00002EAC 8935[CA2E0000]      <1> 	mov [nextcommandloc], esi
  3812 00002EB2 E93E000000          <1> 	jmp donefixvariables
  3813                              <1> inlinecomment:	;if the following char is #, include a #, otherwise end the line
  3814 00002EB7 46                  <1> 	inc esi
  3815 00002EB8 8A06                <1> 	mov al, [esi]
  3816 00002EBA C606FF              <1> 	mov byte [esi], 255
  3817 00002EBD 3C23                <1> 	cmp al, '#'
  3818 00002EBF 7416                <1> 	je fixvariables
  3819 00002EC1 4E                  <1> 	dec esi
  3820 00002EC2 C60600              <1> 	mov byte [esi], 0
  3821 00002EC5 E90D000000          <1> 	jmp fixvariables
  3822                              <1> 	
  3823 00002ECA 00000000            <1> nextcommandloc dd 0
  3824 00002ECE 00000000            <1> thiscommandloc dd 0	
  3825                              <1> run:
  3826 00002ED2 BE[88CE0300]        <1> 	mov esi, buftxt
  3827                              <1> fixvariables:
  3828 00002ED7 46                  <1> 	inc esi
  3829 00002ED8 8A06                <1> 	mov al, [esi]
  3830 00002EDA 3C23                <1> 	cmp al, '#'	;inline comment
  3831 00002EDC 74D9                <1> 	je inlinecomment
  3832 00002EDE 3C24                <1> 	cmp al, '$' ;variable
  3833 00002EE0 0F8437FFFFFF        <1> 	je near replacevariable
  3834 00002EE6 3C3B                <1> 	cmp al, ';' ;program list
  3835 00002EE8 74BD                <1> 	je multipleprogline
  3836 00002EEA 3C00                <1> 	cmp al, 0
  3837 00002EEC 75E9                <1> 	jne fixvariables
  3838 00002EEE 31C0                <1> 	xor eax, eax
  3839 00002EF0 A3[CA2E0000]        <1> 	mov [nextcommandloc], eax
  3840                              <1> donefixvariables:
  3841 00002EF5 803D[B2340000]00    <1> 	cmp byte [indexdone], 0
  3842 00002EFC 7505                <1> 	jne progtest
  3843 00002EFE E81A050000          <1> 	call indexfiles
  3844                              <1> progtest:
  3845 00002F03 31C0                <1> 	xor eax, eax
  3846 00002F05 BB[08B40300]        <1> 	mov ebx, fileindex
  3847 00002F0A 668B03              <1> prgnxt:	mov ax, [ebx]
  3848 00002F0D B1FF                <1> 	mov cl, 255
  3849 00002F0F B52C                <1> 	mov ch, 44
  3850 00002F11 6639C8              <1> 	cmp ax, cx
  3851 00002F14 740B                <1> 	je fndprg
  3852 00002F16 43                  <1> 	inc ebx
  3853 00002F17 81FB[08B80300]      <1> 	cmp ebx, fileindexend
  3854 00002F1D 735D                <1> 	jae prgnf
  3855 00002F1F EBE9                <1> 	jmp prgnxt
  3856 00002F21 81C302000000        <1> fndprg: add ebx, 2
  3857 00002F27 31C9                <1> 	xor ecx, ecx
  3858 00002F29 BE[88CE0300]        <1> 	mov esi, buftxt
  3859 00002F2E 390D[CE2E0000]      <1> 	cmp [thiscommandloc], ecx
  3860 00002F34 7406                <1> 	je noprgtstmultiple
  3861 00002F36 8B35[CE2E0000]      <1> 	mov esi, [thiscommandloc]
  3862                              <1> noprgtstmultiple:
  3863 00002F3C E8A6000000          <1> 	call cndtest
  3864 00002F41 3C01                <1> 	cmp al, 1
  3865 00002F43 7302                <1> 	jae prggood
  3866 00002F45 EBC3                <1> 	jmp prgnxt
  3867 00002F47 81FB[08B80300]      <1> prggood: cmp ebx, fileindexend
  3868 00002F4D 7358                <1> 	jae prgdn
  3869 00002F4F 31C0                <1> 	xor eax, eax
  3870 00002F51 BE[88CE0300]        <1> 	mov esi, buftxt
  3871 00002F56 3905[CE2E0000]      <1> 	cmp [thiscommandloc], eax
  3872 00002F5C 7406                <1> 	je noprggoodmul
  3873 00002F5E 8B35[CE2E0000]      <1> 	mov esi, [thiscommandloc]
  3874                              <1> noprggoodmul:
  3875 00002F64 8935[A82F0000]      <1> 	mov [currentcommandloc], esi
  3876 00002F6A 81C303000000        <1> 	add ebx, 3
  3877 00002F70 8B3B                <1> 	mov edi, [ebx]
  3878 00002F72 C605[D26C0000]02    <1> 	mov byte [threadson], 2
  3879 00002F79 FFD7                <1> 	call edi
  3880 00002F7B C3                  <1> 	ret
  3881                              <1> prgnf:	
  3882 00002F7C 8B35[A82F0000]      <1> 	mov esi, [currentcommandloc]
  3883 00002F82 8A06                <1> 	mov al, [esi]
  3884 00002F84 3C00                <1> 	cmp al, 0
  3885 00002F86 741F                <1> 	je prgdn
  3886 00002F88 BE[9B8E0000]        <1> 	mov esi, notfound1
  3887 00002F8D E8CAEDFFFF          <1> 	call print
  3888 00002F92 8B35[A82F0000]      <1> 	mov esi, [currentcommandloc]
  3889 00002F98 E8BFEDFFFF          <1> 	call print
  3890 00002F9D BE[A38E0000]        <1> 	mov esi, notfound2
  3891 00002FA2 E8B5EDFFFF          <1> 	call print
  3892 00002FA7 C3                  <1> prgdn:	ret
  3893                              <1> 
  3894 00002FA8 00000000            <1> currentcommandloc dd 0
  3895                              <1> 
  3896                              <1> tester:			;si=user bx=prog returns 1 in al if true
  3897 00002FAC 6631C0              <1> 	xor ax, ax
  3898 00002FAF 8A06                <1> retest:	mov al, [esi]
  3899 00002FB1 8A23                <1> 	mov ah, [ebx]
  3900 00002FB3 3C00                <1> 	cmp al, 0
  3901 00002FB5 7408                <1> 	je testtrue
  3902 00002FB7 38E0                <1> 	cmp al, ah
  3903 00002FB9 750C                <1> 	jne testfalse
  3904 00002FBB 43                  <1> 	inc ebx
  3905 00002FBC 46                  <1> 	inc esi
  3906 00002FBD EBF0                <1> 	jmp retest
  3907                              <1> testtrue:
  3908 00002FBF 80FC00              <1> 	cmp ah, 0
  3909 00002FC2 7503                <1> 	jne testfalse
  3910 00002FC4 B001                <1> 	mov al, 1
  3911 00002FC6 C3                  <1> 	ret
  3912                              <1> testfalse:
  3913 00002FC7 30C0                <1> 	xor al, al
  3914 00002FC9 C3                  <1> 	ret
  3915                              <1> 
  3916                              <1> optest:			;si=user bx=prog returns 1 in al if true
  3917 00002FCA 30C0                <1> 	xor al, al
  3918                              <1> opretest:
  3919 00002FCC 8A06                <1> 	mov al, [esi]
  3920 00002FCE 8A23                <1> 	mov ah, [ebx]
  3921 00002FD0 38E0                <1> 	cmp al, ah
  3922 00002FD2 7510                <1> 	jne optestfalse
  3923 00002FD4 80FC00              <1> 	cmp ah, 0
  3924 00002FD7 7404                <1> 	je optesttrue
  3925 00002FD9 43                  <1> 	inc ebx
  3926 00002FDA 46                  <1> 	inc esi
  3927 00002FDB EBEF                <1> 	jmp opretest
  3928                              <1> optesttrue:
  3929 00002FDD 3C00                <1> 	cmp al, 0
  3930 00002FDF 7503                <1> 	jne optestfalse
  3931 00002FE1 B001                <1> 	mov al, 1
  3932 00002FE3 C3                  <1> 	ret
  3933                              <1> optestfalse:
  3934 00002FE4 30C0                <1> 	xor al, al
  3935 00002FE6 C3                  <1> 	ret
  3936                              <1> 
  3937                              <1> cndtest:			;si=user bx=prog cl=endchar returns 1 in al if true
  3938 00002FE7 30C0                <1> 	xor al, al
  3939 00002FE9 8A06                <1> cndretest:	mov al, [esi]
  3940 00002FEB 8A23                <1> 	mov ah, [ebx]
  3941 00002FED 38CC                <1> 	cmp ah, cl
  3942 00002FEF 7408                <1> 	je cndtesttrue
  3943 00002FF1 38E0                <1> 	cmp al, ah
  3944 00002FF3 750B                <1> 	jne cndtestfalse
  3945 00002FF5 43                  <1> 	inc ebx
  3946 00002FF6 46                  <1> 	inc esi
  3947 00002FF7 EBF0                <1> 	jmp cndretest
  3948                              <1> cndtesttrue:
  3949 00002FF9 38C8                <1> 	cmp al, cl
  3950 00002FFB 7506                <1> 	jne cndtestalmost
  3951 00002FFD B001                <1> 	mov al, 1
  3952 00002FFF C3                  <1> 	ret
  3953                              <1> cndtestfalse:
  3954 00003000 30C0                <1> 	xor al, al
  3955 00003002 C3                  <1> 	ret
  3956                              <1> cndtestalmost:
  3957 00003003 B002                <1> 	mov al, 2
  3958 00003005 C3                  <1> 	ret
  3959                              <1> 	
  3960                              <1> array:				;arraystart in si, arrayend in bx, arrayseperator in cx
  3961                              <1> 		                ;ends if array seperator is found backwards after 0
  3962                              <1> 	arnxt:	      
  3963 00003006 88E8                <1> 		mov al, ch
  3964 00003008 88CC                <1> 		mov ah, cl        
  3965 0000300A 663906              <1> 		cmp [esi], ax
  3966 0000300D 7448                <1> 		je ardn
  3967 0000300F 66390E              <1> 		cmp [esi], cx
  3968 00003012 7407                <1> 		je arfnd
  3969 00003014 46                  <1> 		inc esi
  3970 00003015 39DE                <1> 		cmp esi, ebx
  3971 00003017 733E                <1> 		jae ardn
  3972 00003019 EBEB                <1> 		jmp arnxt
  3973 0000301B 81C602000000        <1> 	arfnd: add esi, 2
  3974 00003021 891D[58300000]      <1> 		mov [arbx], ebx
  3975 00003027 890D[5C300000]      <1> 		mov [arcx], ecx
  3976 0000302D E82AEDFFFF          <1> 		call print
  3977 00003032 8935[5E300000]      <1> 		mov [arsi], esi
  3978 00003038 E81AEDFFFF          <1> 		call printline
  3979 0000303D 8B1D[58300000]      <1> 		mov ebx, [arbx]
  3980 00003043 668B0D[5C300000]    <1> 		mov cx, [arcx]
  3981 0000304A 8B35[5E300000]      <1> 		mov esi, [arsi]
  3982 00003050 46                  <1> 		inc esi
  3983 00003051 39DE                <1> 		cmp esi, ebx
  3984 00003053 7302                <1> 		jae ardn
  3985 00003055 EBAF                <1> 		jmp arnxt
  3986 00003057 C3                  <1> 	ardn:	ret
  3987 00003058 00000000            <1> arbx:	dw 0,0
  3988 0000305C 0000                <1> arcx:	db 0,0
  3989 0000305E 00000000            <1> arsi:	dw 0,0
  3990                              <1> 
  3991                              <1> clearbuffer:
  3992 00003062 BE[88D20300]        <1> 	mov esi, buf2
  3993 00003067 B030                <1> 	mov al, '0'
  3994 00003069 81FE[9CD20300]      <1> clearbuf: cmp esi, numbuf
  3995 0000306F 7305                <1> 	jae doneclearbuff
  3996 00003071 8806                <1> 	mov [esi], al
  3997 00003073 46                  <1> 	inc esi
  3998 00003074 EBF3                <1> 	jmp clearbuf
  3999                              <1> doneclearbuff: 
  4000 00003076 C3                  <1> 		ret
  4001                              <1> 
  4002                              <1> convert:
  4003 00003077 4E                  <1> 	dec esi
  4004 00003078 89F3                <1> 	mov ebx, esi		;place to convert into must be in esi, number to convert must be in ecx
  4005                              <1> .lp:
  4006 0000307A 89DE                <1> 	mov esi, ebx
  4007 0000307C 81EE09000000        <1> 	sub esi, 9
  4008 00003082 81F900CA9A3B        <1> 	cmp ecx, 1000000000
  4009 00003088 720A                <1> 	jb .8
  4010 0000308A 81E900CA9A3B        <1> 	sub ecx, 1000000000
  4011 00003090 FE06                <1> 	inc byte [esi]
  4012 00003092 EBE6                <1> 	jmp .lp
  4013 00003094 46                  <1> .8:	inc esi
  4014 00003095 81F900E1F505        <1> 	cmp ecx, 100000000
  4015 0000309B 720A                <1> 	jb .7
  4016 0000309D 81E900E1F505        <1> 	sub ecx, 100000000
  4017 000030A3 FE06                <1> 	inc byte [esi]
  4018 000030A5 EBD3                <1> 	jmp .lp
  4019 000030A7 46                  <1> .7:	inc esi
  4020 000030A8 81F980969800        <1> 	cmp ecx, 10000000
  4021 000030AE 720A                <1> 	jb .6
  4022 000030B0 81E980969800        <1> 	sub ecx, 10000000
  4023 000030B6 FE06                <1> 	inc byte [esi]
  4024 000030B8 EBC0                <1> 	jmp .lp
  4025 000030BA 46                  <1> .6:	inc esi
  4026 000030BB 81F940420F00        <1> 	cmp ecx, 1000000
  4027 000030C1 720A                <1> 	jb .5
  4028 000030C3 81E940420F00        <1> 	sub ecx, 1000000
  4029 000030C9 FE06                <1> 	inc byte [esi]
  4030 000030CB EBAD                <1> 	jmp .lp
  4031 000030CD 46                  <1> .5:	inc esi
  4032 000030CE 81F9A0860100        <1> 	cmp ecx, 100000
  4033 000030D4 720A                <1> 	jb .4
  4034 000030D6 81E9A0860100        <1> 	sub ecx, 100000
  4035 000030DC FE06                <1> 	inc byte [esi]
  4036 000030DE EB9A                <1> 	jmp .lp
  4037 000030E0 46                  <1> .4:	inc esi
  4038 000030E1 81F910270000        <1> 	cmp ecx, 10000
  4039 000030E7 720A                <1> 	jb .3
  4040 000030E9 81E910270000        <1> 	sub ecx, 10000
  4041 000030EF FE06                <1> 	inc byte [esi]
  4042 000030F1 EB87                <1> 	jmp .lp
  4043 000030F3 46                  <1> .3:	inc esi
  4044 000030F4 81F9E8030000        <1> 	cmp ecx, 1000
  4045 000030FA 720D                <1> 	jb .2
  4046 000030FC 81E9E8030000        <1> 	sub ecx, 1000
  4047 00003102 FE06                <1> 	inc byte [esi]
  4048 00003104 E971FFFFFF          <1> 	jmp .lp
  4049 00003109 46                  <1> .2:	inc esi
  4050 0000310A 81F964000000        <1> 	cmp ecx, 100
  4051 00003110 720D                <1> 	jb .1
  4052 00003112 81E964000000        <1> 	sub ecx, 100
  4053 00003118 FE06                <1> 	inc byte [esi]
  4054 0000311A E95BFFFFFF          <1> 	jmp .lp
  4055 0000311F 46                  <1> .1:	inc esi
  4056 00003120 81F90A000000        <1> 	cmp ecx, 10
  4057 00003126 720D                <1> 	jb .0
  4058 00003128 81E90A000000        <1> 	sub ecx, 10
  4059 0000312E FE06                <1> 	inc byte [esi]
  4060 00003130 E945FFFFFF          <1> 	jmp .lp
  4061 00003135 46                  <1> .0:	inc esi
  4062 00003136 81F901000000        <1> 	cmp ecx, 1
  4063 0000313C 720D                <1> 	jb .dn
  4064 0000313E 81E901000000        <1> 	sub ecx, 1
  4065 00003144 FE06                <1> 	inc byte [esi]
  4066 00003146 E92FFFFFFF          <1> 	jmp .lp
  4067                              <1> .dn:
  4068 0000314B C3                  <1> 	ret
  4069                              <1> 
  4070                              <1> 	
  4071                              <1> 
  4072 0000314C 00<rept>            <1> hexnumber times 8 db 0
  4073 00003154 202000              <1> hexnumberend db "  ",0
  4074                              <1> 
  4075                              <1> converthex:
  4076                              <1> .clear:	;place to convert to in esi, end of buffer in edi number in ecx
  4077 00003157 56                  <1> 	push esi
  4078 00003158 B030                <1> 	mov al, "0"
  4079 0000315A 39FE                <1> .clearlp: cmp esi, edi
  4080 0000315C 7305                <1> 	jae .doneclear
  4081 0000315E 8806                <1> 	mov [esi], al
  4082 00003160 46                  <1> 	inc esi
  4083 00003161 EBF7                <1> 	jmp .clearlp
  4084                              <1> .doneclear:
  4085 00003163 81EE02000000        <1> 	sub esi, 2
  4086 00003169 89C8                <1> 	mov eax, ecx
  4087                              <1> .loop:
  4088 0000316B 30FF                <1> 	xor bh, bh
  4089 0000316D 88C3                <1> 	mov bl, al
  4090 0000316F 66C1E304            <1> 	shl bx, 4
  4091 00003173 C0EB04              <1> 	shr bl, 4
  4092 00003176 86DF                <1> 	xchg bl, bh ;they are backwards
  4093 00003178 80C330              <1> 	add bl, 48
  4094 0000317B 80FB39              <1> 	cmp bl, "9"
  4095 0000317E 7609                <1> 	jbe .goodbl
  4096 00003180 80EB30              <1> 	sub bl, 48
  4097 00003183 80EB0A              <1> 	sub bl, 0xA
  4098 00003186 80C341              <1> 	add bl, "A"
  4099                              <1> .goodbl:
  4100 00003189 80C730              <1> 	add bh, 48
  4101 0000318C 80FF39              <1> 	cmp bh, "9"
  4102 0000318F 7609                <1> 	jbe .goodbh
  4103 00003191 80EF30              <1> 	sub bh, 48
  4104 00003194 80EF0A              <1> 	sub bh, 0xA
  4105 00003197 80C741              <1> 	add bh, "A"
  4106                              <1> .goodbh:
  4107 0000319A C1E808              <1> 	shr eax, 8
  4108 0000319D 66891E              <1> 	mov [esi], bx
  4109 000031A0 81EE02000000        <1> 	sub esi, 2
  4110 000031A6 3B3424              <1> 	cmp esi, [esp]
  4111 000031A9 7207                <1> 	jb .done
  4112 000031AB 3D00000000          <1> 	cmp eax, 0
  4113 000031B0 75B9                <1> 	jne .loop
  4114                              <1> .done:
  4115 000031B2 5E                  <1> 	pop esi
  4116 000031B3 C3                  <1> 	ret
  4117                              <1> 	
  4118                              <1> 	
  4119 000031B4 00                  <1> smallhex db 0
  4120 000031B5 01                  <1> firsthexshown db 1
  4121                              <1> showhexsmall:
  4122 000031B6 C605[B4310000]01    <1> 	mov byte [smallhex], 1
  4123 000031BD E808000000          <1> 	call showhex
  4124 000031C2 C605[B4310000]00    <1> 	mov byte [smallhex], 0
  4125 000031C9 C3                  <1> 	ret
  4126                              <1> showhex:
  4127 000031CA 60                  <1> 	pusha
  4128 000031CB BE[4C310000]        <1> 	mov esi, hexnumber
  4129 000031D0 BF[54310000]        <1> 	mov edi, hexnumberend
  4130 000031D5 E87DFFFFFF          <1> 	call converthex
  4131 000031DA 803D[B5310000]01    <1> 	cmp byte [firsthexshown], 1
  4132 000031E1 7503                <1> 	jne .show
  4133 000031E3 6631D2              <1> 	xor dx, dx
  4134                              <1> .show:
  4135 000031E6 803D[B5310000]03    <1> 	cmp byte [firsthexshown], 3
  4136 000031ED 7505                <1> 	jne .nonewhexline
  4137 000031EF E863EBFFFF          <1> 	call printline
  4138                              <1> .nonewhexline:
  4139 000031F4 803D[B5310000]04    <1> 	cmp byte [firsthexshown], 4
  4140 000031FB 7522                <1> 	jne .notab
  4141 000031FD B1A0                <1> 	mov cl, 160
  4142 000031FF 28D1                <1> 	sub cl, dl
  4143 00003201 C0E905              <1> 	shr cl, 5
  4144 00003204 C0E105              <1> 	shl cl, 5
  4145 00003207 80F900              <1> 	cmp cl, 0
  4146 0000320A 750A                <1> 	jne .nonewline
  4147 0000320C E846EBFFFF          <1> 	call printline
  4148 00003211 E909000000          <1> 	jmp .notab
  4149                              <1> .nonewline:
  4150 00003216 80C20F              <1> 	add dl, 15
  4151 00003219 C0EA04              <1> 	shr dl, 4
  4152 0000321C C0E204              <1> 	shl dl, 4
  4153                              <1> .notab:
  4154 0000321F BE[4C310000]        <1> 	mov esi, hexnumber
  4155 00003224 803D[B4310000]01    <1> 	cmp byte [smallhex],1
  4156 0000322B 7506                <1> 	jne .nosmall
  4157 0000322D 81C606000000        <1> 	add esi, 6
  4158                              <1> .nosmall:
  4159 00003233 803D[B5310000]05    <1> 	cmp byte [firsthexshown], 5
  4160 0000323A 750A                <1> 	jne .noquiet
  4161 0000323C E8F7EAFFFF          <1> 	call printquiet
  4162 00003241 E918000000          <1> 	jmp .donequiet
  4163                              <1> .noquiet:
  4164 00003246 803D[B5310000]06    <1> 	cmp byte [firsthexshown], 6
  4165 0000324D 750A                <1> 	jne .normal
  4166 0000324F E8F7EAFFFF          <1> 	call printhighlight
  4167 00003254 E905000000          <1> 	jmp .donequiet
  4168                              <1> .normal:
  4169 00003259 E8FEEAFFFF          <1> 	call print
  4170                              <1> .donequiet:
  4171 0000325E 803D[B5310000]02    <1> 	cmp byte [firsthexshown], 2
  4172 00003265 7505                <1> 	jne .shown
  4173 00003267 E8EBEAFFFF          <1> 	call printline
  4174                              <1> .shown:
  4175 0000326C C605[B5310000]00    <1> 	mov byte [firsthexshown], 0
  4176 00003273 61                  <1> 	popa
  4177 00003274 C3                  <1> 	ret
  4178                              <1> 
  4179                              <1> 
  4180 00003275 303030303030303030- <1> decnumber db "00000000000000"
  4181 0000327E 3030303030          <1>
  4182 00003283 2000                <1> decnumberend: db " ",0
  4183                              <1> 
  4184                              <1> showdec: ;same as showhex, just uses decimal conversion
  4185 00003285 60                  <1> 	pusha
  4186 00003286 BF[75320000]        <1> 	mov edi, decnumber
  4187 0000328B BE[83320000]        <1> 	mov esi, decnumberend
  4188                              <1> .clear:
  4189 00003290 C60730              <1> 	mov byte [edi], '0'
  4190 00003293 47                  <1> 	inc edi
  4191 00003294 39F7                <1> 	cmp edi, esi
  4192 00003296 72F8                <1> 	jb .clear
  4193 00003298 BF[75320000]        <1> 	mov edi, decnumber
  4194 0000329D E8D5FDFFFF          <1> 	call convert
  4195 000032A2 803D[B5310000]01    <1> 	cmp byte [firsthexshown], 1
  4196 000032A9 7503                <1> 	jne .show
  4197 000032AB 6631D2              <1> 	xor dx, dx
  4198                              <1> .show:
  4199 000032AE 803D[B5310000]03    <1> 	cmp byte [firsthexshown], 3
  4200 000032B5 7505                <1> 	jne .nonewdecline
  4201 000032B7 E89BEAFFFF          <1> 	call printline
  4202                              <1> .nonewdecline:
  4203 000032BC 803D[B5310000]04    <1> 	cmp byte [firsthexshown], 4
  4204 000032C3 7522                <1> 	jne .notab
  4205 000032C5 B1A0                <1> 	mov cl, 160
  4206 000032C7 28D1                <1> 	sub cl, dl
  4207 000032C9 C0E905              <1> 	shr cl, 5
  4208 000032CC C0E105              <1> 	shl cl, 5
  4209 000032CF 80F900              <1> 	cmp cl, 0
  4210 000032D2 750A                <1> 	jne .nonewline
  4211 000032D4 E87EEAFFFF          <1> 	call printline
  4212 000032D9 E909000000          <1> 	jmp .notab
  4213                              <1> .nonewline:
  4214 000032DE 80C20F              <1> 	add dl, 15
  4215 000032E1 C0EA04              <1> 	shr dl, 4
  4216 000032E4 C0E204              <1> 	shl dl, 4
  4217                              <1> .notab:
  4218 000032E7 BE[75320000]        <1> 	mov esi, decnumber
  4219 000032EC 4E                  <1> 	dec esi
  4220                              <1> .sifind:
  4221 000032ED 46                  <1> 	inc esi
  4222 000032EE 81FE[82320000]      <1> 	cmp esi, decnumberend - 1
  4223 000032F4 7305                <1> 	jae .nosifind
  4224 000032F6 803E30              <1> 	cmp byte [esi], '0'
  4225 000032F9 74F2                <1> 	je .sifind
  4226                              <1> .nosifind:
  4227 000032FB E85CEAFFFF          <1> 	call print
  4228 00003300 803D[B5310000]02    <1> 	cmp byte [firsthexshown], 2
  4229 00003307 7505                <1> 	jne .shown
  4230 00003309 E849EAFFFF          <1> 	call printline
  4231                              <1> .shown:
  4232 0000330E C605[B5310000]00    <1> 	mov byte [firsthexshown], 0
  4233 00003315 61                  <1> 	popa
  4234 00003316 C3                  <1> 	ret
  4235                              <1> 	
  4236                              <1> cnvrthextxt:
  4237 00003317 31C9                <1> 	xor ecx, ecx
  4238 00003319 31C0                <1> 	xor eax, eax
  4239 0000331B 31D2                <1> 	xor edx, edx
  4240 0000331D 31DB                <1> 	xor ebx, ebx
  4241 0000331F 4E                  <1> 	dec esi
  4242                              <1> .end:
  4243 00003320 46                  <1> 	inc esi
  4244 00003321 8A06                <1> 	mov al, [esi]
  4245 00003323 3C00                <1> 	cmp al, 0
  4246 00003325 75F9                <1> 	jne .end
  4247                              <1> .loop:
  4248 00003327 4E                  <1> 	dec esi
  4249 00003328 8A06                <1> 	mov al, [esi]
  4250 0000332A 3C41                <1> 	cmp al, "A"
  4251 0000332C 7328                <1> 	jae .char
  4252 0000332E 2C30                <1> 	sub al, 48
  4253 00003330 3C10                <1> 	cmp al, 16
  4254 00003332 7721                <1> 	ja .done
  4255                              <1> .donechar:
  4256 00003334 81FA00000000        <1> 	cmp edx, 0
  4257 0000333A 740E                <1> 	je .noshl
  4258 0000333C 89D3                <1> 	mov ebx, edx
  4259                              <1> .shl:
  4260 0000333E C1E004              <1> 	shl eax, 4
  4261 00003341 4B                  <1> 	dec ebx
  4262 00003342 81FB00000000        <1> 	cmp ebx, 0
  4263 00003348 75F4                <1> 	jne .shl
  4264                              <1> .noshl:
  4265 0000334A 42                  <1> 	inc edx
  4266 0000334B 01C1                <1> 	add ecx, eax
  4267 0000334D 81FA08000000        <1> 	cmp edx, 8
  4268 00003353 72D2                <1> 	jb .loop
  4269                              <1> .done:
  4270 00003355 C3                  <1> 	ret
  4271                              <1> .char:
  4272 00003356 3C46                <1> 	cmp al, "F"
  4273 00003358 77FB                <1> 	ja .done
  4274 0000335A 2C41                <1> 	sub al, "A"
  4275 0000335C 040A                <1> 	add al, 0xA
  4276 0000335E EBD4                <1> 	jmp .donechar
  4277                              <1> 	
  4278                              <1> 	
  4279                              <1> cnvrttxt: ;text to convert in esi, first part or 0 in edi
  4280 00003360 31C9                <1> 	xor ecx, ecx
  4281 00003362 31C0                <1> 	xor eax, eax
  4282 00003364 31D2                <1> 	xor edx, edx
  4283 00003366 31DB                <1> 	xor ebx, ebx
  4284 00003368 4E                  <1> 	dec esi
  4285                              <1> .lp:
  4286 00003369 46                  <1> 	inc esi
  4287 0000336A 8A06                <1> 	mov al, [esi]
  4288 0000336C 3C00                <1> 	cmp al, 0
  4289 0000336E 75F9                <1> 	jne .lp
  4290 00003370 4E                  <1> 	dec esi
  4291 00003371 8A06                <1> 	mov al, [esi]
  4292 00003373 3C2E                <1> 	cmp al, '.'
  4293 00003375 7503                <1> 	jne .dot
  4294 00003377 46                  <1> 	inc esi
  4295 00003378 EBEF                <1> 	jmp .lp
  4296                              <1> .dot:
  4297 0000337A 3C20                <1> 	cmp al, ' '
  4298 0000337C 7404                <1> 	je .zero
  4299 0000337E 3C30                <1> 	cmp al, '0'
  4300 00003380 7504                <1> 	jne .txtlp
  4301                              <1> .zero: 
  4302 00003382 39FE                <1> 		cmp esi, edi
  4303 00003384 7441                <1> 		je .done
  4304                              <1> .txtlp:
  4305 00003386 31C0                <1> 	xor eax, eax
  4306 00003388 8A06                <1> 	mov al, [esi]
  4307 0000338A 3C3D                <1> 	cmp al, '='
  4308 0000338C 7439                <1> 	je .done
  4309 0000338E 3C30                <1> 	cmp al, 48
  4310 00003390 7235                <1> 	jb .done
  4311 00003392 3C23                <1> 	cmp al, '#'
  4312 00003394 7431                <1> 	je .done
  4313 00003396 39FE                <1> 	cmp esi, edi
  4314 00003398 722D                <1> 	jb .done
  4315 0000339A 81F900000000        <1> 	cmp ecx, 0
  4316 000033A0 7708                <1> 	ja .exp
  4317 000033A2 2C30                <1> .noexp:	sub al, 48
  4318 000033A4 01C2                <1> 	add edx, eax
  4319 000033A6 4E                  <1> 	dec esi
  4320 000033A7 41                  <1> 	inc ecx
  4321 000033A8 EBDC                <1> 	jmp .txtlp
  4322 000033AA 81F900000000        <1> .exp:	cmp ecx, 0
  4323 000033B0 74F0                <1> 	je .noexp
  4324 000033B2 2C30                <1> 	sub al, 48
  4325 000033B4 51                  <1> 	push ecx
  4326                              <1> .expmul:
  4327 000033B5 89C3                <1> 	mov ebx, eax
  4328 000033B7 01D8                <1> 	add eax, ebx
  4329 000033B9 C1E303              <1> 	shl ebx, 3
  4330 000033BC 01D8                <1> 	add eax, ebx
  4331 000033BE E2F5                <1> 	loop .expmul
  4332 000033C0 01C2                <1> 	add edx, eax
  4333 000033C2 59                  <1> 	pop ecx
  4334 000033C3 4E                  <1> 	dec esi
  4335 000033C4 41                  <1> 	inc ecx
  4336 000033C5 EBBF                <1> 	jmp .txtlp
  4337 000033C7 89D1                <1> .done: mov ecx, edx
  4338 000033C9 C3                  <1> 	ret
  4339                              <1> 
  4340                              <1> benchmarki: ;output number of clocks since initial value
  4341 000033CA 0F31                <1> 	rdtsc
  4342 000033CC 8B1D[FF8E0000]      <1> 	mov ebx, [initialtsc]
  4343 000033D2 8B0D[038F0000]      <1> 	mov ecx, [initialtsc + 4]
  4344 000033D8 E90E000000          <1> 	jmp benchmarkl.calc
  4345                              <1> 
  4346                              <1> benchmarkl: ;output number of clocks since last benchmark
  4347 000033DD 0F31                <1> 	rdtsc
  4348 000033DF 8B1D[078F0000]      <1> 	mov ebx, [lasttsc]
  4349 000033E5 8B0D[0B8F0000]      <1> 	mov ecx, [lasttsc + 4]
  4350                              <1> .calc:
  4351 000033EB 29D8                <1> 	sub eax, ebx
  4352 000033ED 7701                <1> 	ja .noover
  4353 000033EF 4A                  <1> 	dec edx
  4354                              <1> .noover:
  4355 000033F0 29CA                <1> 	sub edx, ecx
  4356 000033F2 8B0C24              <1> 	mov ecx, [esp]
  4357 000033F5 E8D0FDFFFF          <1> 	call showhex
  4358 000033FA 89D1                <1> 	mov ecx, edx
  4359 000033FC E8C9FDFFFF          <1> 	call showhex
  4360 00003401 89C1                <1> 	mov ecx, eax
  4361 00003403 E8C2FDFFFF          <1> 	call showhex
  4362 00003408 E84AE9FFFF          <1> 	call printline
  4363 0000340D 0F31                <1> 	rdtsc
  4364 0000340F A3[078F0000]        <1> 	mov [lasttsc], eax
  4365 00003414 8915[0B8F0000]      <1> 	mov [lasttsc + 4], edx
  4366 0000341A C3                  <1> 	ret
  4367                                      %include "source/programs.asm"
  4368 0000341B FF2C                <1> filetypes db 255,44
  4369                              <1> progstart:		;programs start here
  4370                              <1> indexfiles:
  4371 0000341D BE[1D340000]        <1> 	mov esi, progstart
  4372 00003422 BB[08B40300]        <1> 	mov ebx, fileindex
  4373 00003427 BF[1D340000]        <1> 	mov edi, progstart
  4374 0000342C 81EF02000000        <1> 	sub edi, 2
  4375                              <1> indexloop:
  4376 00003432 668B0E              <1> 	mov cx, [esi]
  4377                              <1> 	indexloop2:
  4378 00003435 663B0F              <1> 		cmp cx, [edi]
  4379 00003438 7424                <1> 		je indexloop2done
  4380 0000343A 81EF02000000        <1> 		sub edi, 2
  4381 00003440 81FF[1B340000]      <1> 		cmp edi, filetypes
  4382 00003446 73ED                <1> 		jae indexloop2
  4383 00003448 BF[1D340000]        <1> 	mov edi, progstart
  4384 0000344D 81EF02000000        <1> 	sub edi, 2
  4385 00003453 46                  <1> 	inc esi
  4386 00003454 81FE[66560000]      <1> 	cmp esi, batchprogend
  4387 0000345A 734E                <1> 	jae indexloopdone
  4388 0000345C EBD4                <1> 	jmp indexloop
  4389                              <1> indexloop2done:
  4390 0000345E 66890B              <1> 	mov [ebx], cx
  4391 00003461 81C302000000        <1> 	add ebx, 2
  4392 00003467 81C602000000        <1> 	add esi, 2
  4393                              <1> 	nameindex:
  4394 0000346D 8A0E                <1> 		mov cl, [esi]
  4395 0000346F 80F900              <1> 		cmp cl, 0
  4396 00003472 7406                <1> 		je nameindexdone
  4397 00003474 880B                <1> 		mov [ebx], cl
  4398 00003476 46                  <1> 		inc esi
  4399 00003477 43                  <1> 		inc ebx
  4400 00003478 EBF3                <1> 		jmp nameindex
  4401                              <1> 	nameindexdone:
  4402 0000347A 43                  <1> 		inc ebx
  4403 0000347B 66C7030000          <1> 		mov word [ebx], 0
  4404 00003480 81C302000000        <1> 		add ebx, 2
  4405 00003486 46                  <1> 		inc esi
  4406 00003487 8933                <1> 		mov [ebx], esi
  4407 00003489 81C304000000        <1> 		add ebx, 4
  4408 0000348F 66C7030000          <1> 		mov word [ebx], 0
  4409 00003494 81C302000000        <1> 		add ebx, 2
  4410 0000349A 81FB[08B80300]      <1> 		cmp ebx, fileindexend
  4411 000034A0 7308                <1> 		jae indexloopdone
  4412 000034A2 81C601000000        <1> 		add esi, 1
  4413 000034A8 EB88                <1> 		jmp indexloop
  4414 000034AA C605[B2340000]01    <1> indexloopdone: 	mov byte [indexdone], 1
  4415 000034B1 C3                  <1> 		ret
  4416 000034B2 00                  <1> indexdone db 0
  4417                              <1> %include 'source/programs/_comment.asm' ;#
  4418 000034B3 FF2C2300            <2> 	db 255,44,"#",0	;this lets you rem stuff
  4419 000034B7 C3                  <2> 	ret 
  4420                              <1> %include 'source/programs/_math.asm' ;!
  4421 000034B8 FF2C2100            <2> db 255,44,"!",0
  4422                              <2> 	num:	
  4423 000034BC E8A1FBFFFF          <2> 		call clearbuffer
  4424 000034C1 C605[30370000]00    <2> 		mov byte [decimal], 0
  4425 000034C8 C605[31370000]00    <2> 		mov byte [decimal2], 0
  4426 000034CF 8B35[A82F0000]      <2> 		mov esi, [currentcommandloc]
  4427 000034D5 31C0                <2> 		xor eax, eax
  4428 000034D7 31C9                <2> 		xor ecx, ecx
  4429 000034D9 31DB                <2> 		xor ebx, ebx
  4430 000034DB 8A06                <2> 	num2:	mov al, [esi]
  4431 000034DD 3C2B                <2> 		cmp al, '+'
  4432 000034DF 7416                <2> 		je operatorfound
  4433 000034E1 3C2D                <2> 		cmp al, '-'
  4434 000034E3 7412                <2> 		je operatorfound
  4435 000034E5 3C2A                <2> 		cmp al, '*'
  4436 000034E7 740E                <2> 		je operatorfound
  4437 000034E9 3C2F                <2> 		cmp al, '/'
  4438 000034EB 740A                <2> 		je operatorfound
  4439 000034ED 3C5E                <2> 		cmp al, '^'
  4440 000034EF 7406                <2> 		je operatorfound
  4441 000034F1 46                  <2> 		inc esi
  4442 000034F2 84C0                <2> 		test al, al
  4443 000034F4 75E5                <2> 		jnz num2
  4444 000034F6 C3                  <2> 		ret
  4445 000034F7 50                  <2> 	operatorfound: push eax
  4446 000034F8 30E4                <2> 		xor ah, ah
  4447 000034FA 8826                <2> 		mov [esi], ah
  4448 000034FC 89F7                <2> 		mov edi, esi
  4449 000034FE 46                  <2> 		inc esi
  4450 000034FF 8A06                <2> 		mov al, [esi]
  4451 00003501 3C25                <2> 		cmp al, '%'
  4452 00003503 0F845E000000        <2> 		je near resultnum1
  4453                              <2> 	varnum2: 
  4454 00003509 57                  <2> 		push edi
  4455 0000350A E8A0000000          <2> 		call checkdecimal
  4456 0000350F 5F                  <2> 		pop edi
  4457 00003510 E84BFEFFFF          <2> 		call cnvrttxt
  4458                              <2> 	vrnm2:
  4459 00003515 89CB                <2> 		mov ebx, ecx
  4460 00003517 53                  <2> 		push ebx
  4461 00003518 E845FBFFFF          <2> 		call clearbuffer
  4462 0000351D 8B35[A82F0000]      <2> 		mov esi, [currentcommandloc]
  4463 00003523 89F7                <2> 		mov edi, esi
  4464 00003525 46                  <2> 		inc esi
  4465 00003526 8A06                <2> 		mov al, [esi]
  4466 00003528 3C25                <2> 		cmp al, '%'
  4467 0000352A 0F844B000000        <2> 		je near resultnum2
  4468                              <2> 	varnum4: 
  4469 00003530 57                  <2> 		push edi
  4470 00003531 E865000000          <2> 		call checkdecimal2
  4471 00003536 5F                  <2> 		pop edi
  4472 00003537 E824FEFFFF          <2> 		call cnvrttxt
  4473                              <2> 	vrnm4:
  4474 0000353C 5B                  <2> 		pop ebx
  4475 0000353D 58                  <2> 		pop eax
  4476 0000353E 3C2B                <2> 		cmp al, '+'
  4477 00003540 0F8497000000        <2> 		je near plusnum
  4478 00003546 3C2D                <2> 		cmp al, '-'
  4479 00003548 0F849B000000        <2> 		je near subnum
  4480 0000354E 3C2A                <2> 		cmp al, '*'
  4481 00003550 0F849F000000        <2> 		je near mulnum
  4482 00003556 3C2F                <2> 		cmp al, '/'
  4483 00003558 0F84AD000000        <2> 		je near divnum
  4484 0000355E 3C5E                <2> 		cmp al, '^'
  4485 00003560 0F84CA000000        <2> 		je near expnum
  4486 00003566 C3                  <2> 		ret
  4487                              <2> 	resultnum1:
  4488 00003567 8A0D[32370000]      <2> 		mov cl, [decimalresult]
  4489 0000356D 880D[30370000]      <2> 		mov [decimal], cl
  4490 00003573 8B0D[33370000]      <2> 		mov ecx, [result]
  4491 00003579 EB9A                <2> 		jmp vrnm2
  4492                              <2> 	resultnum2:
  4493 0000357B 8A0D[30370000]      <2> 		mov cl, [decimal]
  4494 00003581 880D[31370000]      <2> 		mov [decimal2], cl
  4495 00003587 8A0D[32370000]      <2> 		mov cl, [decimalresult]
  4496 0000358D 880D[30370000]      <2> 		mov [decimal], cl
  4497 00003593 8B0D[33370000]      <2> 		mov ecx, [result]
  4498 00003599 EBA1                <2> 		jmp vrnm4
  4499                              <2> 	checkdecimal2:
  4500 0000359B 8A25[30370000]      <2> 		mov ah, [decimal]
  4501 000035A1 8825[31370000]      <2> 		mov [decimal2], ah
  4502 000035A7 30E4                <2> 		xor ah, ah
  4503 000035A9 8825[30370000]      <2> 		mov [decimal], ah
  4504                              <2> 	checkdecimal:
  4505 000035AF 89F7                <2> 		mov edi, esi
  4506                              <2> 	chkdec1:
  4507 000035B1 8A07                <2> 		mov al, [edi]
  4508 000035B3 3C2E                <2> 		cmp al, '.'
  4509 000035B5 0F840B000000        <2> 		je near fnddec
  4510 000035BB 3C00                <2> 		cmp al, 0
  4511 000035BD 0F8419000000        <2> 		je near nodecimal
  4512 000035C3 47                  <2> 		inc edi
  4513 000035C4 EBEB                <2> 		jmp chkdec1
  4514                              <2> 	fnddec:
  4515 000035C6 8A4701              <2> 		mov al, [edi + 1]
  4516 000035C9 8807                <2> 		mov [edi], al
  4517 000035CB 3C00                <2> 		cmp al, 0
  4518 000035CD 0F8409000000        <2> 		je near nodecimal
  4519 000035D3 FE05[30370000]      <2> 		inc byte [decimal]
  4520 000035D9 47                  <2> 		inc edi
  4521 000035DA EBEA                <2> 		jmp fnddec
  4522                              <2> 	nodecimal:
  4523 000035DC C3                  <2> 		ret
  4524                              <2> 	plusnum:
  4525 000035DD E80C010000          <2> 		call decaddfix
  4526 000035E2 01D9                <2> 		add ecx, ebx
  4527 000035E4 E98A000000          <2> 		jmp retnum
  4528                              <2> 	subnum:
  4529 000035E9 E800010000          <2> 		call decaddfix
  4530 000035EE 29D9                <2> 		sub ecx, ebx
  4531 000035F0 E97E000000          <2> 		jmp retnum
  4532                              <2> 	mulnum:
  4533 000035F5 A0[31370000]        <2> 		mov al, [decimal2]
  4534 000035FA 0005[30370000]      <2> 		add [decimal], al
  4535 00003600 89C8                <2> 		mov eax, ecx
  4536 00003602 F7E3                <2> 		mul ebx
  4537 00003604 89C1                <2> 		mov ecx, eax
  4538 00003606 E968000000          <2> 		jmp retnum
  4539                              <2> 	divnum:
  4540 0000360B E8DE000000          <2> 		call decaddfix
  4541 00003610 30C0                <2> 		xor al, al
  4542 00003612 A2[30370000]        <2> 		mov [decimal], al
  4543 00003617 31D2                <2> 		xor edx, edx
  4544 00003619 89C8                <2> 		mov eax, ecx
  4545 0000361B 81FB00000000        <2> 		cmp ebx, 0
  4546 00003621 0F844C000000        <2> 		je near retnum
  4547 00003627 F7F3                <2> 		div ebx
  4548 00003629 89C1                <2> 		mov ecx, eax
  4549 0000362B E943000000          <2> 		jmp retnum
  4550                              <2> 	expnum:
  4551 00003630 8A15[30370000]      <2> 		mov dl, [decimal]
  4552 00003636 8815[31370000]      <2> 		mov [decimal2], dl
  4553 0000363C 31D2                <2> 		xor edx, edx
  4554 0000363E 89C8                <2> 		mov eax, ecx
  4555 00003640 89D9                <2> 		mov ecx, ebx
  4556 00003642 89C3                <2> 		mov ebx, eax
  4557 00003644 81F900000000        <2> 		cmp ecx, 0
  4558 0000364A 7422                <2> 		je noexpnum
  4559 0000364C 49                  <2> 		dec ecx
  4560 0000364D 81F900000000        <2> 		cmp ecx, 0
  4561 00003653 7412                <2> 		je noexpnumlp
  4562 00003655 F7E3                <2> 	expnumlp: mul ebx
  4563 00003657 8A15[31370000]      <2> 		mov dl, [decimal2]
  4564 0000365D 0015[30370000]      <2> 		add [decimal], dl
  4565 00003663 31D2                <2> 		xor edx, edx
  4566 00003665 E2EE                <2> 		loop expnumlp
  4567                              <2> 	noexpnumlp:
  4568 00003667 89C1                <2> 		mov ecx, eax
  4569 00003669 E905000000          <2> 		jmp retnum
  4570                              <2> 	noexpnum:
  4571 0000366E B901000000          <2> 		mov ecx, 1
  4572                              <2> 	retnum: 
  4573 00003673 BE[9CD20300]        <2> 		mov esi, numbuf
  4574 00003678 890D[33370000]      <2> 		mov [result], ecx
  4575 0000367E E8F4F9FFFF          <2> 		call convert
  4576 00003683 BE[9CD20300]        <2> 		mov esi, numbuf
  4577 00003688 8A25[30370000]      <2> 		mov ah, [decimal]
  4578 0000368E 8825[32370000]      <2> 		mov [decimalresult], ah
  4579 00003694 80FC00              <2> 		cmp ah, 0
  4580 00003697 0F8425000000        <2> 		je near noputdecimal
  4581                              <2> 	putdecimal:
  4582 0000369D 4E                  <2> 		dec esi
  4583 0000369E FECC                <2> 		dec ah
  4584 000036A0 80FC00              <2> 		cmp ah, 0
  4585 000036A3 0F87F4FFFFFF        <2> 		ja near putdecimal
  4586 000036A9 4E                  <2> 		dec esi
  4587 000036AA 8A06                <2> 		mov al, [esi]
  4588 000036AC C6062E              <2> 		mov byte [esi], '.'
  4589                              <2> 	decputloop:
  4590 000036AF 4E                  <2> 		dec esi
  4591 000036B0 8A26                <2> 		mov ah, [esi]
  4592 000036B2 8806                <2> 		mov [esi], al
  4593 000036B4 88E0                <2> 		mov al, ah
  4594 000036B6 81FE[88D20300]      <2> 		cmp esi, buf2
  4595 000036BC 0F87EDFFFFFF        <2> 		ja near decputloop
  4596                              <2> 	noputdecimal:
  4597 000036C2 BE[88D20300]        <2> 		mov esi, buf2
  4598 000036C7 E805000000          <2> 		call chkadd
  4599 000036CC C3                  <2> 		ret
  4600 000036CD 00000000            <2> edxnumbuf dw 0,0
  4601 000036D1 8A06                <2> 	chkadd: mov al, [esi]
  4602 000036D3 3C30                <2> 		cmp al, '0'
  4603 000036D5 750C                <2> 		jne dnadd
  4604 000036D7 46                  <2> 		inc esi
  4605 000036D8 81FE[9CD20300]      <2> 		cmp esi, numbuf
  4606 000036DE 7402                <2> 		je dnaddm1
  4607 000036E0 EBEF                <2> 		jmp chkadd
  4608 000036E2 4E                  <2> 	dnaddm1: dec esi
  4609 000036E3 E874E6FFFF          <2> 	dnadd:	call print
  4610 000036E8 E86AE6FFFF          <2> 		call printline
  4611 000036ED C3                  <2> 		ret
  4612                              <2> 		
  4613                              <2> 	decaddfix:
  4614 000036EE A0[31370000]        <2> 		mov al, [decimal2]
  4615 000036F3 8A25[30370000]      <2> 		mov ah, [decimal]
  4616 000036F9 38E0                <2> 		cmp al, ah
  4617 000036FB 7432                <2> 		je gooddecadd
  4618 000036FD 38E0                <2> 		cmp al, ah
  4619 000036FF 721A                <2> 		jb lowdecadd
  4620                              <2> 	highdecadd:
  4621 00003701 FEC4                <2> 		inc ah
  4622 00003703 89CA                <2> 		mov edx, ecx
  4623 00003705 C1E103              <2> 		shl ecx, 3
  4624 00003708 01D1                <2> 		add ecx, edx
  4625 0000370A 01D1                <2> 		add ecx, edx
  4626 0000370C 38E0                <2> 		cmp al, ah
  4627 0000370E 77F1                <2> 		ja highdecadd
  4628 00003710 8825[30370000]      <2> 		mov [decimal], ah
  4629 00003716 E914000000          <2> 		jmp gooddecadd
  4630                              <2> 	lowdecadd:
  4631 0000371B FEC0                <2> 		inc al
  4632 0000371D 89DA                <2> 		mov edx, ebx
  4633 0000371F C1E303              <2> 		shl ebx, 3
  4634 00003722 01D3                <2> 		add ebx, edx
  4635 00003724 01D3                <2> 		add ebx, edx
  4636 00003726 38E0                <2> 		cmp al, ah
  4637 00003728 72F1                <2> 		jb lowdecadd
  4638 0000372A A2[30370000]        <2> 		mov [decimal], al
  4639                              <2> 	gooddecadd:
  4640 0000372F C3                  <2> 		ret
  4641                              <2> 		
  4642 00003730 00                  <2> decimal db 0
  4643 00003731 00                  <2> decimal2 db 0
  4644 00003732 00                  <2> decimalresult db 0
  4645 00003733 00000000            <2> result dd 0
  4646                              <1> %include 'source/programs/_variables.asm' ;% and $
  4647 00003737 FF2C2500            <2> db 255,44,"%",0
  4648                              <2> 	ans:
  4649 0000373B BE[88D20300]        <2> 		mov esi, buf2
  4650 00003740 E88CFFFFFF          <2> 		call chkadd
  4651 00003745 C3                  <2> 		ret
  4652                              <2> 		
  4653 00003746 FF2C2400            <2> db 255,44,"$",0
  4654 0000374A 8B35[A82F0000]      <2> var: mov esi, [currentcommandloc]
  4655 00003750 BB[88BA0300]        <2> 	mov ebx, variables
  4656 00003755 8A06                <2> lkeq:	mov al, [esi]
  4657 00003757 3C3D                <2> 	cmp al, '='
  4658 00003759 741B                <2> 	je eqfnd	;is there an '=' sign?
  4659 0000375B 3C00                <2> 	cmp al, 0
  4660 0000375D 7403                <2> 	je echovars
  4661 0000375F 46                  <2> 	inc esi
  4662 00003760 EBF3                <2> 	jmp lkeq
  4663 00003762 BE[88BA0300]        <2> echovars: mov esi, variables
  4664 00003767 BB[88CA0300]        <2> 	mov ebx, varend
  4665 0000376C B105                <2> 	mov cl, 5
  4666 0000376E B504                <2> 	mov ch, 4
  4667 00003770 E891F8FFFF          <2> 	call array
  4668 00003775 C3                  <2> 	ret
  4669 00003776 46                  <2> eqfnd:	inc esi
  4670 00003777 8A06                <2> 	mov al, [esi]
  4671 00003779 3C00                <2> 	cmp al, 0
  4672 0000377B 7410                <2> 	je readvar
  4673 0000377D 8B35[A82F0000]      <2> 	mov esi, [currentcommandloc]
  4674 00003783 BB[88BA0300]        <2> 	mov ebx, variables
  4675 00003788 E919000000          <2> 	jmp seek
  4676                              <2> readvar:
  4677 0000378D B00A                <2> 	mov al, 10
  4678 0000378F 66BB0700            <2> 	mov bx, 7
  4679 00003793 C605[3D230000]00    <2> 	mov byte [commandedit], 0
  4680 0000379A BF[88D20300]        <2> 	mov edi, buftxtend
  4681 0000379F E8E8E6FFFF          <2> 	call rdprint
  4682 000037A4 EBA4                <2> 	jmp var
  4683 000037A6 668B03              <2> seek:	mov ax, [ebx]
  4684 000037A9 B105                <2> 	mov cl, 5
  4685 000037AB B504                <2> 	mov ch, 4
  4686 000037AD 663D0000            <2> 	cmp ax, 0
  4687 000037B1 0F845B000000        <2> 	je near save
  4688 000037B7 6639C8              <2> 	cmp ax, cx
  4689 000037BA 7403                <2> 	je skfnd
  4690 000037BC 43                  <2> 	inc ebx
  4691 000037BD EBE7                <2> 	jmp seek
  4692 000037BF 8B35[A82F0000]      <2> skfnd:	mov esi, [currentcommandloc]
  4693 000037C5 46                  <2> 	inc esi
  4694 000037C6 81C302000000        <2> 	add ebx, 2
  4695 000037CC 89DF                <2> 	mov edi, ebx
  4696 000037CE B13D                <2> 	mov cl, '='
  4697 000037D0 E812F8FFFF          <2> 	call cndtest
  4698 000037D5 3C01                <2> 	cmp al, 1	
  4699 000037D7 7418                <2> 	je varfnd
  4700 000037D9 89FB                <2> 	mov ebx, edi
  4701 000037DB 8B35[A82F0000]      <2> 	mov esi, [currentcommandloc]
  4702 000037E1 668B03              <2> 	mov ax, [ebx]
  4703 000037E4 663D0000            <2> 	cmp ax, 0
  4704 000037E8 0F8424000000        <2> 	je near save
  4705 000037EE 43                  <2> 	inc ebx
  4706 000037EF EBB5                <2> 	jmp seek
  4707 000037F1 8A03                <2> varfnd:	mov al, [ebx]
  4708 000037F3 3C04                <2> 	cmp al, 4
  4709 000037F5 7404                <2> 	je save2
  4710 000037F7 4B                  <2> 	dec ebx
  4711 000037F8 4E                  <2> 	dec esi
  4712 000037F9 EBF6                <2> 	jmp varfnd
  4713 000037FB 4B                  <2> save2:	dec ebx
  4714 000037FC 4E                  <2> 	dec esi
  4715 000037FD 8A03                <2> 	mov al, [ebx]
  4716 000037FF 3C05                <2> 	cmp al, 5
  4717 00003801 7402                <2> 	je remove
  4718 00003803 EBEC                <2> 	jmp varfnd
  4719 00003805 8A03                <2> remove: mov al, [ebx]
  4720 00003807 3C00                <2> 	cmp al, 0
  4721 00003809 749B                <2> 	je seek
  4722 0000380B 30C0                <2> 	xor al, al
  4723 0000380D 8803                <2> 	mov [ebx], al
  4724 0000380F 43                  <2> 	inc ebx
  4725 00003810 EBF3                <2> 	jmp remove	;do not need for now-need defragmentation
  4726 00003812 8B35[A82F0000]      <2> save:	mov esi, [currentcommandloc]
  4727 00003818 43                  <2> 	inc ebx
  4728 00003819 B005                <2> 	mov al, 5
  4729 0000381B B404                <2> 	mov ah, 4
  4730 0000381D 668903              <2> 	mov [ebx], ax
  4731 00003820 43                  <2> 	inc ebx
  4732 00003821 43                  <2> svhere:	inc ebx
  4733 00003822 46                  <2> 	inc esi
  4734 00003823 8A06                <2> 	mov al, [esi]
  4735 00003825 3C00                <2> 	cmp al, 0
  4736 00003827 0F844A000000        <2> 	je near svdone
  4737 0000382D 3C25                <2> 	cmp al, '%'
  4738 0000382F 7404                <2> 	je ans2
  4739 00003831 8803                <2> 	mov [ebx], al	
  4740 00003833 EBEC                <2> 	jmp svhere
  4741 00003835 56                  <2> ans2:	push esi
  4742 00003836 BE[88D20300]        <2> 	mov esi, buf2
  4743 0000383B E823000000          <2> 	call ansfnd
  4744 00003840 E803000000          <2> 	call anscp
  4745 00003845 5E                  <2> 	pop esi
  4746 00003846 EBD9                <2> 	jmp svhere
  4747 00003848 8A06                <2> anscp:	mov al, [esi]
  4748 0000384A 8803                <2> 	mov [ebx], al
  4749 0000384C 81FE[9CD20300]      <2> 	cmp esi, numbuf
  4750 00003852 74CD                <2> 	je svhere
  4751 00003854 3C00                <2> 	cmp al, 0
  4752 00003856 74C9                <2> 	je svhere
  4753 00003858 43                  <2> 	inc ebx
  4754 00003859 46                  <2> 	inc esi
  4755 0000385A EBEC                <2> 	jmp anscp
  4756 0000385C 5E                  <2> ansnf:	pop esi
  4757 0000385D 8A06                <2> 	mov al, [esi]
  4758 0000385F 8803                <2> 	mov [ebx], al
  4759 00003861 EBBE                <2> 	jmp svhere
  4760 00003863 46                  <2> ansfnd:	inc esi
  4761 00003864 81FE[9BD20300]      <2> 	cmp esi, numbuf - 1
  4762 0000386A 740A                <2> 	je fndans
  4763 0000386C 8A06                <2> 	mov al, [esi]
  4764 0000386E 3C00                <2> 	cmp al, 0
  4765 00003870 74EA                <2> 	je ansnf
  4766 00003872 3C30                <2> 	cmp al, '0'
  4767 00003874 74ED                <2> 	je ansfnd
  4768                              <2> fndans:
  4769 00003876 C3                  <2> 	ret
  4770 00003877 30C0                <2> svdone:	xor al, al
  4771 00003879 8803                <2> 	mov [ebx], al
  4772 0000387B C3                  <2> 	ret
  4773                              <1> %include 'source/programs/_run.asm' ;./
  4774                              <2> 
  4775 0000387C 7F454C46            <2> 	elfstart db 0x7F,"ELF"
  4776 00003880 FF2C2E2F00          <2> 	db 255,44,"./",0
  4777                              <2> rundiskprog:
  4778 00003885 8B3D[A82F0000]      <2> 	mov edi, [currentcommandloc]
  4779 0000388B 81C702000000        <2> 	add edi, 2
  4780 00003891 BE00004000          <2> 	mov esi, 0x400000
  4781 00003896 E87D320000          <2> 	call loadfile
  4782 0000389B 81FA94010000        <2> 	cmp edx, 404
  4783 000038A1 746A                <2> 	je noprogfound
  4784 000038A3 BB00004000          <2> 	mov ebx, 0x400000
  4785 000038A8 A1[7C380000]        <2> 	mov eax, [elfstart]
  4786 000038AD 3903                <2> 	cmp [ebx], eax
  4787 000038AF 0F8437000000        <2> 	je near runelf
  4788 000038B5 66813B4558          <2> 	cmp word [ebx], "EX"
  4789 000038BA 7577                <2> 	jne progbatchfound
  4790 000038BC 81C302000000        <2> 	add ebx, 2
  4791 000038C2 8B3D[A82F0000]      <2> 	mov edi, [currentcommandloc]
  4792 000038C8 81C702000000        <2> 	add edi, 2
  4793                              <2> findspaceprog:
  4794 000038CE 8A07                <2> 	mov al, [edi]
  4795 000038D0 47                  <2> 	inc edi
  4796 000038D1 3C20                <2> 	cmp al, " "
  4797 000038D3 75F9                <2> 	jne findspaceprog
  4798                              <2> findnonspaceprog:
  4799 000038D5 8A07                <2> 	mov al, [edi]
  4800 000038D7 47                  <2> 	inc edi
  4801 000038D8 3C20                <2> 	cmp al, " "
  4802 000038DA 74F9                <2> 	je findnonspaceprog
  4803 000038DC 4F                  <2> 	dec edi
  4804 000038DD 8925[08B80300]      <2> 	mov [previousstack], esp
  4805 000038E3 FFD3                <2> 	call ebx
  4806 000038E5 8B25[08B80300]      <2> 	mov esp, [previousstack]
  4807 000038EB C3                  <2> 	ret
  4808                              <2> runelf:
  4809 000038EC 8B3D[A82F0000]      <2> 	mov edi, [currentcommandloc]
  4810 000038F2 81C702000000        <2> 	add edi, 2
  4811 000038F8 81C380000000        <2> 	add ebx, 0x80
  4812 000038FE 8925[08B80300]      <2> 	mov [previousstack], esp
  4813 00003904 FFD3                <2> 	call ebx
  4814 00003906 8B25[08B80300]      <2> 	mov esp, [previousstack]
  4815 0000390C C3                  <2> 	ret
  4816                              <2> noprogfound:
  4817 0000390D BE[9B8E0000]        <2> 	mov esi, notfound1
  4818 00003912 E845E4FFFF          <2> 	call print
  4819 00003917 8B35[A82F0000]      <2> 	mov esi, [currentcommandloc]
  4820 0000391D 81C602000000        <2> 	add esi, 2
  4821 00003923 E834E4FFFF          <2> 	call print
  4822 00003928 BE[A38E0000]        <2> 	mov esi, notfound2
  4823 0000392D E82AE4FFFF          <2> 	call print
  4824 00003932 C3                  <2> 	ret
  4825                              <2> progbatchfound:
  4826 00003933 BF00004000          <2> 		mov edi, 0x400000
  4827 00003938 C605[82BA0300]01    <2> 		mov byte [BATCHISON], 1
  4828                              <2> 	batchrunloop:
  4829 0000393F E88EF3FFFF          <2> 		call buftxtclear
  4830 00003944 BE[88CE0300]        <2> 		mov esi, buftxt
  4831 00003949 8935[A82F0000]      <2> 		mov [currentcommandloc], esi
  4832                              <2> 	batchrunloop2:
  4833 0000394F B10A                <2> 		mov cl, 10
  4834 00003951 B50D                <2> 		mov ch, 13
  4835 00003953 380F                <2> 		cmp [edi], cl
  4836 00003955 0F8419000000        <2> 		je near nxtbatchrunline
  4837 0000395B 382F                <2> 		cmp [edi], ch
  4838 0000395D 0F8411000000        <2> 		je near nxtbatchrunline
  4839 00003963 803F00              <2> 		cmp byte [edi], 0
  4840 00003966 0F8408000000        <2> 		je near nxtbatchrunline
  4841 0000396C 8A07                <2> 		mov al, [edi]
  4842 0000396E 8806                <2> 		mov [esi], al
  4843 00003970 46                  <2> 		inc esi
  4844 00003971 47                  <2> 		inc edi
  4845 00003972 EBDB                <2> 		jmp batchrunloop2
  4846                              <2> 	nxtbatchrunline:
  4847 00003974 47                  <2> 		inc edi
  4848 00003975 380F                <2> 		cmp [edi], cl
  4849 00003977 74FB                <2> 		je nxtbatchrunline
  4850 00003979 382F                <2> 		cmp [edi], ch
  4851 0000397B 74F7                <2> 		je nxtbatchrunline
  4852 0000397D 893D[DB390000]      <2> 		mov [batchedi], edi
  4853 00003983 893D[7EBA0300]      <2> 		mov [BATCHPOS], edi
  4854 00003989 C60600              <2> 		mov byte [esi], 0
  4855 0000398C BE[88CE0300]        <2> 		mov esi, buftxt
  4856 00003991 803E00              <2> 		cmp byte [esi], 0
  4857 00003994 0F8439000000        <2> 		je near nobatchfoundrun
  4858 0000399A 31DB                <2> 		xor ebx, ebx
  4859 0000399C 8A1D[19BA0300]      <2> 		mov bl, [IFON]
  4860 000039A2 80FB00              <2> 		cmp bl, 0
  4861 000039A5 0F8534000000        <2> 		jne near iftestbatch
  4862                              <2> 	doneiftest:
  4863 000039AB 803D[B13A0000]00    <2> 		cmp byte [runnextline], 0
  4864 000039B2 0F8405000000        <2> 		je near noruniftest
  4865 000039B8 E815F5FFFF          <2> 		call run
  4866                              <2> 	noruniftest:
  4867 000039BD C605[B13A0000]01    <2> 		mov byte [runnextline], 1
  4868 000039C4 8B3D[DB390000]      <2> 		mov edi, [batchedi]
  4869 000039CA 803F00              <2> 		cmp byte [edi], 0
  4870 000039CD 0F856CFFFFFF        <2> 		jne near batchrunloop
  4871                              <2> 	nobatchfoundrun:
  4872 000039D3 C605[82BA0300]00    <2> 		mov byte [BATCHISON], 0
  4873 000039DA C3                  <2> 		ret
  4874                              <2> 	
  4875 000039DB 00000000            <2> batchedi dd 0	
  4876                              <2> 	
  4877                              <2> 	iftestbatch:
  4878 000039DF BE[1ABA0300]        <2> 		mov esi, IFTRUE
  4879 000039E4 01DE                <2> 		add esi, ebx
  4880 000039E6 803E00              <2> 		cmp byte [esi], 0
  4881 000039E9 0F85BCFFFFFF        <2> 		jne near doneiftest
  4882 000039EF 881D[B23A0000]      <2> 		mov [iffalsebuf], bl
  4883 000039F5 803D[83BA0300]01    <2> 		cmp byte [LOOPON], 1
  4884 000039FC 0F8513000000        <2> 		jne near fifindbatch
  4885 00003A02 E938FFFFFF          <2> 		jmp batchrunloop
  4886                              <2> 	elsetestbatch:
  4887 00003A07 C60601              <2> 		mov byte [esi], 1
  4888 00003A0A 81C705000000        <2> 		add edi, 5
  4889 00003A10 E92AFFFFFF          <2> 		jmp batchrunloop
  4890                              <2> 	fifindbatch:
  4891 00003A15 66B96966            <2> 		mov cx, "if"
  4892 00003A19 66B86669            <2> 		mov ax, "fi"
  4893 00003A1D 663907              <2> 		cmp [edi], ax
  4894 00003A20 0F8424000000        <2> 		je near fifoundbatch
  4895 00003A26 66390F              <2> 		cmp [edi], cx
  4896 00003A29 0F8465000000        <2> 		je near iffoundbatch
  4897 00003A2F 803F00              <2> 		cmp byte [edi], 0
  4898 00003A32 0F8412000000        <2> 		je near fifoundbatch
  4899 00003A38 B8656C7365          <2> 		mov eax, "else"
  4900 00003A3D 3907                <2> 		cmp [edi], eax
  4901 00003A3F 0F84C2FFFFFF        <2> 		je near elsetestbatch
  4902 00003A45 E973FFFFFF          <2> 		jmp noruniftest
  4903                              <2> 	fifoundbatch:
  4904 00003A4A 81C702000000        <2> 		add edi, 2
  4905 00003A50 B00A                <2> 		mov al, 10
  4906 00003A52 3807                <2> 		cmp [edi], al
  4907 00003A54 0F840B000000        <2> 		je near goodfibatch
  4908 00003A5A 803F00              <2> 		cmp byte [edi], 0
  4909 00003A5D 0F8470FFFFFF        <2> 		je near nobatchfoundrun
  4910 00003A63 EBB0                <2> 		jmp fifindbatch
  4911                              <2> 	goodfibatch:
  4912 00003A65 B001                <2> 		mov al, 1
  4913 00003A67 2805[19BA0300]      <2> 		sub [IFON], al 
  4914 00003A6D A0[19BA0300]        <2> 		mov al, [IFON]
  4915 00003A72 8A1D[B23A0000]      <2> 		mov bl, [iffalsebuf]
  4916 00003A78 38D8                <2> 		cmp al, bl
  4917 00003A7A 7799                <2> 		ja fifindbatch
  4918 00003A7C 8B35[A82F0000]      <2> 		mov esi, [currentcommandloc]
  4919 00003A82 81EF02000000        <2> 		sub edi, 2
  4920 00003A88 C605[B13A0000]00    <2> 		mov byte [runnextline], 0
  4921 00003A8F E9ABFEFFFF          <2> 		jmp batchrunloop
  4922                              <2> 	iffoundbatch:
  4923 00003A94 B020                <2> 		mov al, ' '
  4924 00003A96 81C702000000        <2> 		add edi, 2
  4925 00003A9C 3807                <2> 		cmp [edi], al
  4926 00003A9E 0F8571FFFFFF        <2> 		jne near fifindbatch
  4927 00003AA4 B001                <2> 		mov al, 1
  4928 00003AA6 0005[19BA0300]      <2> 		add [IFON], al
  4929 00003AAC E964FFFFFF          <2> 		jmp fifindbatch
  4930                              <2> 		
  4931                              <2> 		
  4932 00003AB1 01                  <2> runnextline db 1
  4933 00003AB2 00                  <2> iffalsebuf db 0
  4934 00003AB3 C3                  <2> notbatch: ret 
  4935                              <1> %ifdef network.included
  4936                              <1> 	%include 'source/programs/arp.asm'
  4937 00003AB4 FF2C6172702000      <2> db 255,44,"arp ",0
  4938                              <2> 	;ARP TESTING
  4939                              <2> arptest:
  4940 00003ABB 8B35[A82F0000]      <2> 	mov esi, [currentcommandloc]
  4941 00003AC1 81C604000000        <2> 	add esi, 4
  4942 00003AC7 E8E3520000          <2> 	call strtoip
  4943 00003ACC 890D[733B0000]      <2> 	mov [arptargetinfo + 6], ecx ;move to next ip
  4944 00003AD2 E81E530000          <2> 	call showip
  4945 00003AD7 803D[773B0000]01    <2> 	cmp byte [arpconfig], 1
  4946 00003ADE 7405                <2> 	je arptest2
  4947 00003AE0 E841000000          <2> 	call arpinit
  4948                              <2> arptest2:	;try to reach 192.168.0.1
  4949 00003AE5 8B0D[8D8E0000]      <2> 	mov ecx, [sysmac]
  4950 00003AEB 668B1D[918E0000]    <2> 	mov bx, [sysmac + 4]
  4951 00003AF2 890D[533B0000]      <2> 	mov [sourcemac], ecx
  4952 00003AF8 66891D[573B0000]    <2> 	mov [sourcemac + 4],bx
  4953 00003AFF 890D[633B0000]      <2> 	mov [arpsenderinfo], ecx
  4954 00003B05 66891D[673B0000]    <2> 	mov [arpsenderinfo + 4], bx
  4955 00003B0C BF[4D3B0000]        <2> 	mov edi, frame
  4956 00003B11 BE[773B0000]        <2> 	mov esi, framend
  4957 00003B16 E862520000          <2> 	call sendpacket
  4958 00003B1B BE[D48E0000]        <2> 	mov esi, line
  4959 00003B20 E837E2FFFF          <2> 	call print
  4960 00003B25 C3                  <2> 	ret
  4961                              <2> 	
  4962                              <2> arpinit:
  4963 00003B26 BE[783B0000]        <2> 	mov esi, arptable
  4964 00003B2B BF[8D8E0000]        <2> 	mov edi, sysmac
  4965 00003B30 BB[898E0000]        <2> 	mov ebx, sysip
  4966 00003B35 8B0F                <2> 	mov ecx, [edi]
  4967 00003B37 890E                <2> 	mov [esi], ecx
  4968 00003B39 668B4F04            <2> 	mov cx, [edi + 4]
  4969 00003B3D 894E04              <2> 	mov [esi + 4], ecx
  4970 00003B40 8B0B                <2> 	mov ecx, [ebx]
  4971 00003B42 894E06              <2> 	mov [esi + 6], ecx
  4972 00003B45 C605[773B0000]01    <2> 	mov byte [arpconfig], 1
  4973 00003B4C C3                  <2> 	ret
  4974                              <2> 	
  4975                              <2> ;example frame
  4976                              <2> frame:
  4977 00003B4D FFFFFFFFFFFF        <2> destinationmac:	db 0xFF,0xFF,0xFF,0xFF,0xFF,0xFF
  4978 00003B53 000000000000        <2> sourcemac:		db 0,0,0,0,0,0
  4979 00003B59 0806                <2> ethertype:		db 8,6			;arp is 0x806
  4980                              <2> 	;example packet
  4981 00003B5B 0100                <2> 	arppacket: 		dw 1			;ethernet is 1
  4982 00003B5D 0800                <2> 	arpprotocol: 	db 8,0			;ip is 0x800
  4983 00003B5F 0604                <2> 					db 6,4			;length of mac, length of ip
  4984 00003B61 0001                <2> 	arpoperation: 	db 0,1			;one for arp request
  4985 00003B63 000000000000        <2> 	arpsenderinfo:	db 0x00,0x00,0x00,0x00,0x00,0x00	;mac
  4986 00003B69 C0A80073            <2> 					db 192,168,0,115		;ip
  4987 00003B6D 000000000000        <2> 	arptargetinfo:	db 0x00,0x00,0x00,0x00,0x00,0x00	;ignored in requests
  4988 00003B73 C0A80000            <2> 					db 192,168,0,0			;ip
  4989                              <2> framend:
  4990                              <2> 
  4991 00003B77 00                  <2> arpconfig db 0
  4992                              <2> arptable:	;mac,ip
  4993 00003B78 000000000000000000- <2> 	times 10 db 0,0,0,0,0,0,0,0,0,0
  4994 00003B81 00<rept>            <2>
  4995                              <2> arptableend:	
  4996                              <1> %endif
  4997                              <1> %include 'source/programs/batch.asm'
  4998 00003BDC FF2C626174636800    <2> db 255,44,"batch",0
  4999                              <2> 	batchst: 
  5000 00003BE4 8B3D[A82F0000]      <2> 		mov edi, [currentcommandloc]
  5001 00003BEA 81C706000000        <2> 		add edi, 6
  5002 00003BF0 803F00              <2> 		cmp byte [edi], 0
  5003 00003BF3 0F846D000000        <2> 		je near nonamefound
  5004 00003BF9 BE00004000          <2> 		mov esi, 0x400000
  5005 00003BFE E8152F0000          <2> 		call loadfile
  5006 00003C03 89D0                <2> 		mov eax, edx
  5007 00003C05 3D94010000          <2> 		cmp eax, 404
  5008 00003C0A 7465                <2> 		je goodbatchname
  5009 00003C0C BE[173C0000]        <2> 		mov esi, badbatchname
  5010 00003C11 E846E1FFFF          <2> 		call print
  5011 00003C16 C3                  <2> 		ret
  5012 00003C17 546869732066696C65- <2> 		badbatchname db "This file already exists!",10,0
  5013 00003C20 20616C726561647920- <2>
  5014 00003C29 657869737473210A00  <2>
  5015 00003C32 596F75206861766520- <2> 		namenotfoundbatch db "You have to type a name after the command.",10,0
  5016 00003C3B 746F20747970652061- <2>
  5017 00003C44 206E616D6520616674- <2>
  5018 00003C4D 65722074686520636F- <2>
  5019 00003C56 6D6D616E642E0A00    <2>
  5020 00003C5E 00000000            <2> 		esicache3 dd 0
  5021 00003C62 00000000            <2> 		esicache2 dd 0
  5022                              <2> 	nonamefound:
  5023 00003C66 BE[323C0000]        <2> 		mov esi, namenotfoundbatch
  5024 00003C6B E8ECE0FFFF          <2> 		call print
  5025 00003C70 C3                  <2> 		ret
  5026                              <2> 	goodbatchname:
  5027 00003C71 BE00004000          <2> 		mov esi, 0x400000
  5028                              <2> 	batchcreate:
  5029 00003C76 8935[5E3C0000]      <2> 		mov [esicache3], esi
  5030 00003C7C BF00008000          <2> 		mov edi, 0x800000
  5031 00003C81 B00A                <2> 		mov al, 10
  5032 00003C83 B307                <2> 		mov bl, 7
  5033 00003C85 B404                <2> 		mov ah, 4
  5034 00003C87 CD30                <2> 		int 30h
  5035 00003C89 8935[623C0000]      <2> 		mov [esicache2], esi
  5036 00003C8F 8A0E                <2> 		mov cl, [esi]
  5037 00003C91 8B35[5E3C0000]      <2> 		mov esi, [esicache3]
  5038 00003C97 BB[CB3C0000]        <2> 		mov ebx, exitword
  5039 00003C9C E846F3FFFF          <2> 		call cndtest
  5040 00003CA1 3C01                <2> 		cmp al, 1
  5041 00003CA3 7411                <2> 		je endbatchcreate
  5042 00003CA5 3C02                <2> 		cmp al, 2
  5043 00003CA7 740D                <2> 		je endbatchcreate
  5044 00003CA9 8B35[623C0000]      <2> 		mov esi, [esicache2]
  5045 00003CAF B00A                <2> 		mov al, 10
  5046 00003CB1 8806                <2> 		mov [esi], al
  5047 00003CB3 46                  <2> 		inc esi
  5048 00003CB4 EBC0                <2> 		jmp batchcreate
  5049                              <2> 	endbatchcreate:
  5050 00003CB6 8B35[5E3C0000]      <2> 		mov esi, [esicache3]
  5051 00003CBC 31C0                <2> 		xor eax, eax
  5052 00003CBE 8806                <2> 		mov [esi], al
  5053 00003CC0 BE00004000          <2> 		mov esi, 0x400000
  5054 00003CC5 E892E0FFFF          <2> 		call print
  5055 00003CCA C3                  <2> 		ret
  5056                              <2> 	
  5057 00003CCB 5C7800              <2> 	exitword db "\x",0
  5058 00003CCE 54797065205C782074- <2> 	wordmsg db "Type \x to exit.",10,0
  5059 00003CD7 6F20657869742E0A00  <2>
  5060                              <1> %ifdef gui.background
  5061                              <1> 	%include 'source/programs/background.asm'
  5062                              <1> %endif
  5063                              <1> %include 'source/programs/beep.asm'
  5064 00003CE0 FF2C6265657000      <2> 	db 255,44,"beep",0
  5065                              <2> beep:
  5066 00003CE7 B8[0C3D0000]        <2> 	mov eax, beepstart
  5067 00003CEC A3[72020000]        <2> 	mov [soundpos], eax
  5068 00003CF1 B8[103D0000]        <2> 	mov eax, beepend
  5069 00003CF6 A3[76020000]        <2> 	mov [soundendpos], eax
  5070 00003CFB C605[6F020000]01    <2> 	mov byte [soundon], 1
  5071                              <2> waitforsoundendbeep:
  5072 00003D02 A0[6F020000]        <2> 	mov al, [soundon]
  5073 00003D07 3C00                <2> 	cmp al, 0
  5074 00003D09 75F7                <2> 	jne waitforsoundendbeep
  5075 00003D0B C3                  <2> 	ret
  5076                              <2> 	
  5077                              <2> beepstart:
  5078 00003D0C 3200D111            <2> 	dw 50, 4561
  5079                              <2> beepend:
  5080                              <1> %ifdef dos.compatible
  5081                              <1> %else
  5082                              <1> 	%include 'source/programs/boot.asm'
  5083 00003D10 FF2C626F6F7400      <2> db 255,44,"boot",0
  5084                              <2> quickboot:
  5085                              <2> 	;load and jump to the bootloader
  5086                              <2> 	; mov ecx, 1
  5087                              <2> 	; xor ebx, ebx
  5088                              <2> 	; mov esi, 0x400000
  5089                              <2> 	; call diskr
  5090                              <2> 	; mov ax, LINEAR_SEL
  5091                              <2> 	; mov fs, ax
  5092                              <2> 	; mov esi, 0x400000
  5093                              <2> 	; mov edi, 0x7C00
  5094                              <2> 	; xor ebx, ebx
  5095                              <2> ; .lp:
  5096                              <2> 	; mov ecx, [esi+ebx]
  5097                              <2> 	; mov [fs:edi+ebx], ecx
  5098                              <2> 	; add ebx, 4
  5099                              <2> 	; cmp ebx, 512
  5100                              <2> 	; jb .lp
  5101 00003D17 66BB[273D]          <2> 	mov bx, bootload
  5102 00003D1B 66891D[F30C0000]    <2> 	mov [realmodeptr], bx
  5103 00003D22 E9BACEFFFF          <2> 	jmp realmode
  5104                              <2> [BITS 16]
  5105                              <2> bootload:
  5106 00003D27 B80300              <2> 	mov ax, 3
  5107 00003D2A 31DB                <2> 	xor bx, bx
  5108 00003D2C CD10                <2> 	int 10h
  5109 00003D2E EA007C0000          <2> 	jmp 0:0x7C00
  5110                              <2> [BITS 32]
  5111                              <1> %endif
  5112                              <1> %include 'source/programs/cd.asm'
  5113 00003D33 FF2C63642000        <2> db 255,44,"cd ",0
  5114                              <2> cd:
  5115 00003D39 8B35[A82F0000]      <2> 	mov esi, [currentcommandloc]
  5116 00003D3F 81C603000000        <2> 	add esi, 3
  5117 00003D45 8B3D[10B80300]      <2> 	mov edi, [currentfolderloc]
  5118 00003D4B 893D[0CB80300]      <2> 	mov [lastfolderloc], edi
  5119 00003D51 81C7[14B80300]      <2> 	add edi, currentfolder
  5120 00003D57 4F                  <2> 	dec edi
  5121 00003D58 66813E2E2E          <2> 	cmp word [esi], ".."
  5122 00003D5D 742A                <2> 	je .moveup
  5123 00003D5F 47                  <2> 	inc edi
  5124                              <2> .movedown:
  5125 00003D60 8A06                <2> 	mov al, [esi]
  5126 00003D62 8807                <2> 	mov [edi], al
  5127 00003D64 47                  <2> 	inc edi
  5128 00003D65 46                  <2> 	inc esi
  5129 00003D66 3C00                <2> 	cmp al, 0
  5130 00003D68 740A                <2> 	je .donecd
  5131 00003D6A 81FF[14BA0300]      <2> 	cmp edi, currentfolderend
  5132 00003D70 72EE                <2> 	jb .movedown
  5133 00003D72 30C0                <2> 	xor al, al
  5134                              <2> .donecd:
  5135 00003D74 4F                  <2> 	dec edi
  5136 00003D75 C6072F              <2> 	mov byte [edi], '/'
  5137 00003D78 47                  <2> 	inc edi
  5138 00003D79 C60700              <2> 	mov byte [edi], 0
  5139 00003D7C 81EF[14B80300]      <2> 	sub edi, currentfolder
  5140 00003D82 893D[10B80300]      <2> 	mov [currentfolderloc], edi
  5141 00003D88 C3                  <2> 	ret
  5142                              <2> .moveup:
  5143 00003D89 31C0                <2> 	xor eax, eax
  5144 00003D8B A3[0CB80300]        <2> 	mov [lastfolderloc], eax
  5145                              <2> .moveuploop:
  5146 00003D90 4F                  <2> 	dec edi
  5147 00003D91 8A07                <2> 	mov al, [edi]
  5148 00003D93 81FF[14B80300]      <2> 	cmp edi, currentfolder
  5149 00003D99 763B                <2> 	jbe .moveupover
  5150 00003D9B 3C2F                <2> 	cmp al, '/'
  5151 00003D9D 75F1                <2> 	jne .moveuploop
  5152 00003D9F C6072F              <2> 	mov byte [edi], '/'
  5153 00003DA2 47                  <2> 	inc edi
  5154 00003DA3 C60700              <2> 	mov byte [edi], 0
  5155 00003DA6 81EF[14B80300]      <2> 	sub edi, currentfolder
  5156 00003DAC 893D[10B80300]      <2> 	mov [currentfolderloc], edi
  5157 00003DB2 81C7[14B80300]      <2> 	add edi, currentfolder
  5158 00003DB8 4F                  <2> 	dec edi
  5159                              <2> .lastfolder:
  5160 00003DB9 4F                  <2> 	dec edi
  5161 00003DBA 8A07                <2> 	mov al, [edi]
  5162 00003DBC 81FF[14B80300]      <2> 	cmp edi, currentfolder
  5163 00003DC2 7604                <2> 	jbe .donemoveup
  5164 00003DC4 3C2F                <2> 	cmp al, '/'
  5165 00003DC6 75F1                <2> 	jne .lastfolder
  5166                              <2> .donemoveup:
  5167 00003DC8 47                  <2> 	inc edi
  5168 00003DC9 81EF[14B80300]      <2> 	sub edi, currentfolder
  5169 00003DCF 893D[0CB80300]      <2> 	mov [lastfolderloc], edi
  5170 00003DD5 C3                  <2> 	ret
  5171                              <2> .moveupover:
  5172 00003DD6 BF[14B80300]        <2> 	mov edi, currentfolder
  5173 00003DDB C6072F              <2> 	mov byte [edi], '/'
  5174 00003DDE 47                  <2> 	inc edi
  5175 00003DDF C60700              <2> 	mov byte [edi], 0
  5176 00003DE2 31C0                <2> 	xor eax, eax
  5177 00003DE4 A3[0CB80300]        <2> 	mov [lastfolderloc], eax
  5178 00003DE9 40                  <2> 	inc eax
  5179 00003DEA A3[10B80300]        <2> 	mov [currentfolderloc], eax
  5180 00003DEF C3                  <2> 	ret
  5181                              <1> %include 'source/programs/charmap.asm'
  5182 00003DF0 00                  <2> charmapnum db 0
  5183 00003DF1 FF2C636861726D6170- <2> db 255,44,"charmap",0
  5184 00003DFA 00                  <2>
  5185 00003DFB 8B35[A82F0000]      <2> 	mov esi, [currentcommandloc]
  5186 00003E01 81C608000000        <2> 	add esi, 8
  5187 00003E07 803E00              <2> 	cmp byte [esi], 0
  5188 00003E0A 7412                <2> 	je .nospecific
  5189 00003E0C E806F5FFFF          <2> 	call cnvrthextxt
  5190 00003E11 6689C8              <2> 	mov ax, cx
  5191 00003E14 66BB0700            <2> 	mov bx, 7
  5192 00003E18 E8CAE5FFFF          <2> 	call prcharq
  5193 00003E1D C3                  <2> 	ret
  5194                              <2> .nospecific:
  5195 00003E1E 66BB0700            <2> 	mov bx, 7
  5196 00003E22 66B82000            <2> 	mov ax, " "
  5197 00003E26 C605[F03D0000]00    <2> 	mov byte [charmapnum], 0
  5198 00003E2D E8B5E5FFFF          <2> 	call prcharq
  5199 00003E32 E8B0E5FFFF          <2> 	call prcharq
  5200 00003E37 E8ABE5FFFF          <2> 	call prcharq
  5201 00003E3C E8A6E5FFFF          <2> 	call prcharq
  5202 00003E41 66B83000            <2> 	mov ax, "0"
  5203                              <2> charmapnumprnt:
  5204 00003E45 E89DE5FFFF          <2> 	call prcharq
  5205 00003E4A 6640                <2> 	inc ax
  5206 00003E4C 6650                <2> 	push ax
  5207 00003E4E 66B82000            <2> 	mov ax, " "
  5208 00003E52 E890E5FFFF          <2> 	call prcharq
  5209 00003E57 6658                <2> 	pop ax
  5210 00003E59 663D3900            <2> 	cmp ax, "9"
  5211 00003E5D 76E6                <2> 	jbe charmapnumprnt
  5212 00003E5F 66B84100            <2> 	mov ax, "A"
  5213                              <2> charmapnumprnt2:
  5214 00003E63 E87FE5FFFF          <2> 	call prcharq
  5215 00003E68 6640                <2> 	inc ax
  5216 00003E6A 6650                <2> 	push ax
  5217 00003E6C 66B82000            <2> 	mov ax, " "
  5218 00003E70 E872E5FFFF          <2> 	call prcharq
  5219 00003E75 6658                <2> 	pop ax
  5220 00003E77 663D4700            <2> 	cmp ax, "G"
  5221 00003E7B 72E6                <2> 	jb charmapnumprnt2
  5222                              <2> 	
  5223 00003E7D BE[D48E0000]        <2> 	mov esi, line
  5224 00003E82 E8B1DEFFFF          <2> 	call printquiet
  5225 00003E87 6631C0              <2> 	xor ax, ax
  5226 00003E8A 6689C1              <2> 	mov cx, ax
  5227 00003E8D E824F3FFFF          <2> 	call showhexsmall
  5228 00003E92 E96C000000          <2> 	jmp charmapnocopy ;the first char is 0 which is unprintable
  5229                              <2> charmapcopy:
  5230 00003E97 6640                <2> 	inc ax
  5231 00003E99 663D0800            <2> 	cmp ax, 8
  5232 00003E9D 7464                <2> 	je charmapnocopy
  5233 00003E9F 663D0900            <2> 	cmp ax, 9
  5234 00003EA3 745E                <2> 	je charmapnocopy
  5235 00003EA5 663D0A00            <2> 	cmp ax, 10
  5236 00003EA9 7458                <2> 	je charmapnocopy
  5237 00003EAB 663D0D00            <2> 	cmp ax, 13
  5238 00003EAF 7452                <2> 	je charmapnocopy
  5239 00003EB1 663DFF00            <2> 	cmp ax, 255
  5240 00003EB5 744C                <2> 	je charmapnocopy
  5241 00003EB7 663D0001            <2> 	cmp ax, 256
  5242 00003EBB 7445                <2> 	je nomorecharmap
  5243 00003EBD 6650                <2> 	push ax
  5244 00003EBF E823E5FFFF          <2> 	call prcharq
  5245 00003EC4 66B82000            <2> 	mov ax, " "
  5246 00003EC8 E81AE5FFFF          <2> 	call prcharq
  5247 00003ECD 6658                <2> 	pop ax
  5248                              <2> charmapcopycheck:
  5249 00003ECF FE05[F03D0000]      <2> 	inc byte [charmapnum]
  5250 00003ED5 803D[F03D0000]10    <2> 	cmp byte [charmapnum], 16
  5251 00003EDC 72B9                <2> 	jb charmapcopy
  5252 00003EDE 6650                <2> 	push ax
  5253 00003EE0 BE[D48E0000]        <2> 	mov esi, line
  5254 00003EE5 E84EDEFFFF          <2> 	call printquiet
  5255 00003EEA 6658                <2> 	pop ax
  5256 00003EEC 3CFF                <2> 	cmp al, 255
  5257 00003EEE 7412                <2> 	je nomorecharmap
  5258 00003EF0 88C1                <2> 	mov cl, al
  5259 00003EF2 FEC1                <2> 	inc cl
  5260 00003EF4 E8BDF2FFFF          <2> 	call showhexsmall
  5261 00003EF9 C605[F03D0000]00    <2> 	mov byte [charmapnum], 0
  5262 00003F00 EB95                <2> 	jmp charmapcopy
  5263                              <2> nomorecharmap:
  5264 00003F02 C3                  <2> 	ret
  5265                              <2> charmapnocopy:
  5266 00003F03 6650                <2> 	push ax
  5267 00003F05 66B82000            <2> 	mov ax, " "
  5268 00003F09 E8D9E4FFFF          <2> 	call prcharq
  5269 00003F0E E8D4E4FFFF          <2> 	call prcharq
  5270 00003F13 6658                <2> 	pop ax
  5271 00003F15 EBB8                <2> 	jmp charmapcopycheck
  5272                              <1> %ifdef gui.included
  5273                              <1> 	%include 'source/programs/circle.asm'
  5274 00003F17 FF2C636972636C6500  <2> db 255,44,"circle",0
  5275                              <2> circle:
  5276 00003F20 8B35[A82F0000]      <2> 	mov esi, [currentcommandloc]
  5277 00003F26 81C607000000        <2> 	add esi, 7
  5278 00003F2C 66B91000            <2> 	mov cx, 16
  5279 00003F30 30C0                <2> 	xor al, al
  5280 00003F32 3806                <2> 	cmp [esi], al
  5281 00003F34 7405                <2> 	je .nocmdline
  5282 00003F36 E825F4FFFF          <2> 	call cnvrttxt
  5283                              <2> .nocmdline:
  5284 00003F3B E8100D0000          <2> 	call linetester.stime
  5285 00003F40 E857000000          <2> 	call fcircle.nocmdline
  5286 00003F45 E81E0D0000          <2> 	call linetester.etime
  5287 00003F4A 53                  <2> 	push ebx
  5288 00003F4B 57                  <2> 	push edi
  5289 00003F4C E803E4FFFF          <2> 	call getchar
  5290 00003F51 59                  <2> 	pop ecx
  5291 00003F52 E82EF3FFFF          <2> 	call showdec
  5292 00003F57 BE[F64C0000]        <2> 	mov esi, linetester.msgcircle
  5293 00003F5C E8D7DDFFFF          <2> 	call printquiet
  5294 00003F61 59                  <2> 	pop ecx
  5295 00003F62 E81EF3FFFF          <2> 	call showdec
  5296 00003F67 BE[0D4D0000]        <2> 	mov esi, linetester.msgtime
  5297 00003F6C E8C7DDFFFF          <2> 	call printquiet
  5298 00003F71 E846340000          <2> 	call reloadallgraphics
  5299 00003F76 C3                  <2> 	ret
  5300                              <2> 	
  5301 00003F77 FF2C66636972636C65- <2> db 255,44,"fcircle",0	;attempts to draw many circles without refreshing screen or showing time
  5302 00003F80 00                  <2>
  5303                              <2> fcircle:	
  5304 00003F81 8B35[A82F0000]      <2> 	mov esi, [currentcommandloc]
  5305 00003F87 81C608000000        <2> 	add esi, 8
  5306 00003F8D 66B91000            <2> 	mov cx, 16
  5307 00003F91 30C0                <2> 	xor al, al
  5308 00003F93 3806                <2> 	cmp [esi], al
  5309 00003F95 7405                <2> 	je .nocmdline
  5310 00003F97 E8C4F3FFFF          <2> 	call cnvrttxt
  5311                              <2> .nocmdline:
  5312 00003F9C 6689C8              <2> 	mov ax, cx
  5313 00003F9F 66D1E1              <2> 	shl cx, 1
  5314 00003FA2 6689CA              <2> 	mov dx, cx
  5315 00003FA5 663B15[645A0000]    <2> 	cmp dx, [resolutionx]
  5316 00003FAC 731B                <2> 	jae .done
  5317 00003FAE 663B0D[665A0000]    <2> 	cmp cx, [resolutiony]
  5318 00003FB5 7312                <2> 	jae .done
  5319 00003FB7 668B35[6D020000]    <2> 	mov si, [timenanoseconds + 2]
  5320 00003FBE 31FF                <2> 	xor edi, edi
  5321 00003FC0 803D[F98E0000]01    <2> 	cmp byte [guion], 1
  5322 00003FC7 7401                <2> 	je .lp
  5323 00003FC9 C3                  <2> .done ret
  5324                              <2> .lp:
  5325 00003FCA 6629C2              <2> 	sub dx, ax
  5326 00003FCD 6629C1              <2> 	sub cx, ax
  5327 00003FD0 60                  <2> 	pusha
  5328 00003FD1 E8052F0000          <2> 	call fillcircle
  5329 00003FD6 61                  <2> 	popa
  5330 00003FD7 47                  <2> 	inc edi
  5331 00003FD8 660335[6B020000]    <2> 	add si, [timenanoseconds]
  5332 00003FDF 6601C2              <2> 	add dx, ax
  5333 00003FE2 6601C2              <2> 	add dx, ax
  5334 00003FE5 6601C2              <2> 	add dx, ax
  5335 00003FE8 6601C1              <2> 	add cx, ax
  5336 00003FEB 663B15[645A0000]    <2> 	cmp dx, [resolutionx]
  5337 00003FF2 72D6                <2> 	jb .lp
  5338 00003FF4 6689C2              <2> 	mov dx, ax
  5339 00003FF7 6601C2              <2> 	add dx, ax
  5340 00003FFA 6601C1              <2> 	add cx, ax
  5341 00003FFD 6601C1              <2> 	add cx, ax
  5342 00004000 663B0D[665A0000]    <2> 	cmp cx, [resolutiony]
  5343 00004007 72C1                <2> 	jb .lp
  5344 00004009 C3                  <2> 	ret
  5345                              <1> %endif
  5346                              <1> %include 'source/programs/clear.asm'
  5347 0000400A FF2C636C65617200    <2> db 255,44,"clear",0
  5348 00004012 E8F1DDFFFF          <2> 		call clear
  5349 00004017 C3                  <2> 		ret 
  5350                              <1> %include 'source/programs/cpuid.asm'
  5351 00004018 FF2C637075696400    <2> db 255,44,"cpuid",0
  5352 00004020 31C0                <2> 	xor eax, eax
  5353 00004022 0FA2                <2> 	cpuid
  5354 00004024 891D[75400000]      <2> 	mov [cpuidbuf], ebx
  5355 0000402A 8915[79400000]      <2> 	mov [cpuidbuf + 4], edx
  5356 00004030 890D[7D400000]      <2> 	mov [cpuidbuf + 8], ecx
  5357 00004036 BE[75400000]        <2> 	mov esi, cpuidbuf
  5358 0000403B E81CDDFFFF          <2> 	call print
  5359 00004040 BE[D48E0000]        <2> 	mov esi, line
  5360 00004045 E812DDFFFF          <2> 	call print
  5361 0000404A B801000000          <2> 	mov eax, 1
  5362 0000404F 0FA2                <2> 	cpuid
  5363 00004051 89C1                <2> 	mov ecx, eax
  5364 00004053 C605[B5310000]02    <2> 	mov byte [firsthexshown], 2
  5365 0000405A E86BF1FFFF          <2> 	call showhex
  5366 0000405F B808000080          <2> 	mov eax, 0x80000008
  5367 00004064 0FA2                <2> 	cpuid
  5368 00004066 89C1                <2> 	mov ecx, eax
  5369 00004068 C605[B5310000]02    <2> 	mov byte [firsthexshown], 2
  5370 0000406F E856F1FFFF          <2> 	call showhex
  5371 00004074 C3                  <2> 	ret
  5372                              <2> 	
  5373 00004075 00<rept>            <2> cpuidbuf times 13 db 0
  5374                              <2> cpuidvendorend:
  5375                              <1> %include 'source/programs/date.asm'
  5376 00004082 082E30303030303030- <2> timenscache db 8,".000000000"
  5377 0000408B 3030                <2>
  5378 0000408D 200A00              <2> timenscacheend: db " ",10,0
  5379 00004090 00                  <2> istimeset db 0
  5380 00004091 456E74657220746865- <2> settimemsg db "Enter the current UNIX time:",10,0
  5381 0000409A 2063757272656E7420- <2>
  5382 000040A3 554E49582074696D65- <2>
  5383 000040AC 3A0A00              <2>
  5384 000040AF 00<rept>            <2> timeinputbuffer times 12 db 0
  5385 000040BB 00                  <2> timeinputbend: db 0
  5386                              <2> 
  5387 000040BC FF2C6461746500      <2> db 255,44,"date",0
  5388                              <2> 	;cmp byte [istimeset], 0
  5389                              <2> 	;jne timeisset
  5390 000040C3 E880000000          <2> 	call time
  5391 000040C8 E828020000          <2> 	call timeconvert	
  5392                              <2> 	; mov esi, settimemsg
  5393                              <2> 	; call print
  5394                              <2> 	; mov esi, timeinputbuffer
  5395                              <2> 	; mov edi, timeinputbend
  5396                              <2> 	; call readline
  5397                              <2> 	; mov esi, timeinputbuffer
  5398                              <2> 	; xor edi, edi
  5399                              <2> 	; call cnvrttxt
  5400 000040CD 890D[67020000]      <2> 	mov [timeseconds], ecx
  5401                              <2> 	;xor ecx, ecx
  5402                              <2> 	;mov [timenanoseconds], ecx
  5403 000040D3 C605[90400000]01    <2> 	mov byte [istimeset], 1
  5404                              <2> timeisset:
  5405 000040DA 8B0D[67020000]      <2> 	mov ecx, [timeseconds]
  5406 000040E0 E8A0F1FFFF          <2> 	call showdec
  5407                              <2> 	
  5408 000040E5 8B0D[6B020000]      <2> 	mov ecx, [timenanoseconds]
  5409 000040EB BE[82400000]        <2> 	mov esi, timenscache
  5410 000040F0 C7460230303030      <2> 	mov dword [esi+ 2], "0000"
  5411 000040F7 C7460630303030      <2> 	mov dword [esi + 6], "0000"
  5412 000040FE C6460A30            <2> 	mov byte [esi + 10], "0"
  5413 00004102 BE[8D400000]        <2> 	mov esi, timenscacheend
  5414 00004107 E86BEFFFFF          <2> 	call convert
  5415 0000410C BE[82400000]        <2> 	mov esi, timenscache
  5416 00004111 E822DCFFFF          <2> 	call printquiet
  5417                              <2> 	
  5418 00004116 E82D000000          <2> 	call time
  5419 0000411B BE[60440000]        <2> 	mov esi, timeshow
  5420 00004120 E813DCFFFF          <2> 	call printquiet
  5421 00004125 BE[D48E0000]        <2> 	mov esi, line
  5422 0000412A E809DCFFFF          <2> 	call printquiet
  5423 0000412F BE[69440000]        <2> 	mov esi, dateshow
  5424 00004134 E8FFDBFFFF          <2> 	call printquiet
  5425 00004139 BE[D48E0000]        <2> 	mov esi, line
  5426 0000413E E8F5DBFFFF          <2> 	call printquiet
  5427 00004143 E9BE000000          <2> 	jmp findday
  5428                              <2> time:
  5429 00004148 E851010000          <2> 	call tstackput1
  5430 0000414D B00A                <2> 	mov al,10			;Get RTC register A
  5431 0000414F E87B010000          <2> 	call tget1
  5432 00004154 A880                <2> 	test al,0x80			;Is update in progress?
  5433 00004156 75F0                <2> 	jne time				; yes, wait
  5434                              <2> 
  5435 00004158 B000                <2> 	mov al,0			;Get seconds (00 to 59)
  5436 0000415A E870010000          <2> 	call tget1
  5437 0000415F A2[57440000]        <2> 	mov [RTCtimeSecond],al
  5438                              <2> 
  5439 00004164 B002                <2> 	mov al,0x02			;Get minutes (00 to 59)
  5440 00004166 E864010000          <2> 	call tget1
  5441 0000416B A2[58440000]        <2> 	mov [RTCtimeMinute],al
  5442                              <2> 
  5443 00004170 B004                <2> 	mov al,0x04			;Get hours (see notes)
  5444 00004172 E858010000          <2> 	call tget1
  5445 00004177 A2[59440000]        <2> 	mov [RTCtimeHour],al
  5446                              <2> 
  5447 0000417C B007                <2> 	mov al,0x07			;Get day of month (01 to 31)
  5448 0000417E E84C010000          <2> 	call tget1
  5449 00004183 A2[5A440000]        <2> 	mov [RTCtimeDay],al
  5450                              <2> 
  5451 00004188 B008                <2> 	mov al,0x08			;Get month (01 to 12)
  5452 0000418A E840010000          <2> 	call tget1
  5453 0000418F 241F                <2> 	and al, 11111b
  5454 00004191 A2[5B440000]        <2> 	mov [RTCtimeMonth],al
  5455                              <2> 
  5456 00004196 B009                <2> 	mov al,0x09			;Get year (00 to 99)
  5457 00004198 E832010000          <2> 	call tget1
  5458 0000419D A2[5C440000]        <2> 	mov [RTCtimeYear],al
  5459                              <2> 	
  5460 000041A2 BE[60440000]        <2> 	mov esi, timeshow
  5461 000041A7 8A2D[59440000]      <2> 	mov ch, [RTCtimeHour]
  5462 000041AD E828010000          <2> 	call tput1
  5463 000041B2 8A2D[58440000]      <2> 	mov ch, [RTCtimeMinute]
  5464 000041B8 E81D010000          <2> 	call tput1
  5465 000041BD 8A2D[57440000]      <2> 	mov ch, [RTCtimeSecond]
  5466 000041C3 E812010000          <2> 	call tput1
  5467 000041C8 BE[69440000]        <2> 	mov esi, dateshow
  5468 000041CD 8A2D[5B440000]      <2> 	mov ch, [RTCtimeMonth]
  5469 000041D3 E802010000          <2> 	call tput1
  5470 000041D8 8A2D[5A440000]      <2> 	mov ch, [RTCtimeDay]
  5471 000041DE E8F7000000          <2> 	call tput1
  5472 000041E3 B520                <2> 	mov ch, 0x20
  5473 000041E5 E8F0000000          <2> 	call tput1
  5474 000041EA 4E                  <2> 	dec esi
  5475 000041EB 8A2D[5C440000]      <2> 	mov ch, [RTCtimeYear]
  5476 000041F1 E8E4000000          <2> 	call tput1
  5477 000041F6 E8BD000000          <2> 	call tstackget1
  5478 000041FB C3                  <2> 	ret
  5479 000041FC BE[60440000]        <2> 	mov esi, timeshow
  5480 00004201 E856DBFFFF          <2> 	call print
  5481                              <2> ;get day of week
  5482                              <2> ;add these:
  5483                              <2> ;century value
  5484                              <2> ;last 2 digits of year
  5485                              <2> ;last 2 digits of year right shifted twice
  5486                              <2> ;month table value
  5487                              <2> ;day of the month
  5488                              <2> ;divide these by 7
  5489                              <2> ;the remainder is the day
  5490                              <2> findday:
  5491 00004206 31C0                <2> 	xor eax, eax
  5492                              <2> ;first convert the values from BCD to hex
  5493 00004208 A0[5A440000]        <2> 	mov al, [RTCtimeDay]
  5494 0000420D E873000000          <2> 	call converttohex
  5495 00004212 8825[5D440000]      <2> 	mov [dayhex], ah
  5496 00004218 A0[5B440000]        <2> 	mov al, [RTCtimeMonth]
  5497 0000421D E863000000          <2> 	call converttohex
  5498 00004222 8825[5E440000]      <2> 	mov [monthhex], ah
  5499 00004228 A0[5C440000]        <2> 	mov al, [RTCtimeYear]
  5500 0000422D E853000000          <2> 	call converttohex
  5501 00004232 8825[5F440000]      <2> 	mov [yearhex], ah
  5502 00004238 31C0                <2> 	xor eax, eax
  5503 0000423A A0[5F440000]        <2> 	mov al, [yearhex]
  5504 0000423F C0E802              <2> 	shr al, 2
  5505 00004242 0205[5F440000]      <2> 	add al, [yearhex]
  5506 00004248 0506000000          <2> 	add eax, 6
  5507 0000424D 31DB                <2> 	xor ebx, ebx
  5508 0000424F 8A1D[5E440000]      <2> 	mov bl, [monthhex]
  5509 00004255 FECB                <2> 	dec bl
  5510 00004257 81C3[7E440000]      <2> 	add ebx, month
  5511 0000425D 31C9                <2> 	xor ecx, ecx
  5512 0000425F 8A0B                <2> 	mov cl, [ebx]
  5513 00004261 01C8                <2> 	add eax, ecx
  5514 00004263 8A0D[5D440000]      <2> 	mov cl, [dayhex]
  5515 00004269 01C8                <2> 	add eax, ecx
  5516 0000426B 66BB0700            <2> 	mov bx, 7
  5517 0000426F 31D2                <2> 	xor edx, edx
  5518 00004271 66F7F3              <2> 	div bx
  5519 00004274 C1E202              <2> 	shl edx, 2
  5520 00004277 81C2[8A440000]      <2> 	add edx, day
  5521 0000427D 8B32                <2> 	mov esi, [edx]
  5522 0000427F E8D8DAFFFF          <2> 	call print
  5523 00004284 C3                  <2> 	ret
  5524                              <2> 	
  5525                              <2> converttohex:
  5526 00004285 88C4                <2> 	mov ah, al
  5527 00004287 C0E804              <2> 	shr al, 4
  5528 0000428A C0E404              <2> 	shl ah, 4
  5529 0000428D C0EC04              <2> 	shr ah, 4
  5530 00004290 3C00                <2> 	cmp al, 0
  5531 00004292 7409                <2> 	je noconverttohex
  5532                              <2> converttohexlp:
  5533 00004294 80C40A              <2> 	add ah, 10
  5534 00004297 FEC8                <2> 	dec al
  5535 00004299 3C00                <2> 	cmp al, 0
  5536 0000429B 75F7                <2> 	jne converttohexlp
  5537                              <2> noconverttohex:
  5538 0000429D C3                  <2> 	ret
  5539                              <2> 	
  5540                              <2> tstackput1:
  5541 0000429E 8935[53440000]      <2> 	mov [tstack + 20], esi
  5542 000042A4 BE[3F440000]        <2> 	mov esi, tstack
  5543 000042A9 8906                <2> 	mov [esi], eax
  5544 000042AB 895E04              <2> 	mov [esi + 4], ebx
  5545 000042AE 894E08              <2> 	mov [esi + 8], ecx
  5546 000042B1 89560C              <2> 	mov [esi + 12], edx
  5547 000042B4 897E10              <2> 	mov [esi + 16], edi
  5548 000042B7 C3                  <2> 	ret
  5549                              <2> 	
  5550                              <2> tstackget1:
  5551 000042B8 BE[3F440000]        <2> 	mov esi, tstack
  5552 000042BD 8B06                <2> 	mov eax, [esi]
  5553 000042BF 8B5E04              <2> 	mov ebx, [esi + 4]
  5554 000042C2 8B4E08              <2> 	mov ecx, [esi + 8]
  5555 000042C5 8B560C              <2> 	mov edx, [esi + 12]
  5556 000042C8 8B7E10              <2> 	mov edi, [esi + 16]
  5557 000042CB 8B7614              <2> 	mov esi, [esi + 20]
  5558 000042CE C3                  <2> 	ret
  5559                              <2> 	
  5560                              <2> tget1:
  5561 000042CF 66BA7000            <2> 	mov dx, 0x70
  5562 000042D3 EE                  <2> 	out dx, al
  5563 000042D4 6642                <2> 	inc dx
  5564 000042D6 EC                  <2> 	in al, dx
  5565 000042D7 664A                <2> 	dec dx
  5566 000042D9 C3                  <2> 	ret
  5567                              <2> 	
  5568                              <2> tput1:
  5569 000042DA 66C1E904            <2> 	shr cx, 4
  5570 000042DE B030                <2> 	mov al, 48
  5571 000042E0 00E8                <2> 	add al, ch
  5572 000042E2 8806                <2> 	mov [esi], al
  5573 000042E4 46                  <2> 	inc esi
  5574 000042E5 B030                <2> 	mov al, 48
  5575 000042E7 C0E904              <2> 	shr cl, 4
  5576 000042EA 00C8                <2> 	add al, cl
  5577 000042EC 8806                <2> 	mov [esi], al
  5578 000042EE 81C602000000        <2> 	add esi, 2
  5579 000042F4 C3                  <2> 	ret
  5580                              <2> 	
  5581                              <2> timeconvert: ;return time in the RTCtime stuff in ecx
  5582 000042F5 31DB                <2> 	xor ebx, ebx
  5583 000042F7 31C9                <2> 	xor ecx, ecx
  5584 000042F9 31FF                <2> 	xor edi, edi
  5585 000042FB 31F6                <2> 	xor esi, esi
  5586                              <2> 	
  5587 000042FD A0[57440000]        <2> 	mov al, [RTCtimeSecond]
  5588 00004302 E87EFFFFFF          <2> 	call converttohex
  5589 00004307 88E1                <2> 	mov cl, ah
  5590                              <2> 	
  5591 00004309 A0[58440000]        <2> 	mov al, [RTCtimeMinute]
  5592 0000430E E872FFFFFF          <2> 	call converttohex
  5593 00004313 88E3                <2> 	mov bl, ah
  5594 00004315 B83C000000          <2> 	mov eax, 60
  5595 0000431A 31D2                <2> 	xor edx, edx
  5596 0000431C F7E3                <2> 	mul ebx
  5597 0000431E 01C1                <2> 	add ecx, eax
  5598                              <2> 	
  5599 00004320 A0[59440000]        <2> 	mov al, [RTCtimeHour]
  5600 00004325 E85BFFFFFF          <2> 	call converttohex
  5601 0000432A 88E3                <2> 	mov bl, ah
  5602 0000432C B8100E0000          <2> 	mov eax, 3600
  5603 00004331 31D2                <2> 	xor edx, edx
  5604 00004333 F7E3                <2> 	mul ebx
  5605 00004335 01C1                <2> 	add ecx, eax
  5606                              <2> 		
  5607 00004337 31C0                <2> 	xor eax, eax
  5608 00004339 A0[5C440000]        <2> 	mov al, [RTCtimeYear]
  5609 0000433E E842FFFFFF          <2> 	call converttohex
  5610 00004343 6689C6              <2> 	mov si, ax
  5611 00004346 66C1EE08            <2> 	shr si, 8
  5612 0000434A 6681FE4600          <2> 	cmp si, 70
  5613 0000434F 7705                <2> 	ja .no100
  5614 00004351 6681C66400          <2> 	add si, 100
  5615                              <2> .no100:
  5616 00004356 6681C66C07          <2> 	add si, 1900
  5617                              <2> 	
  5618 0000435B BB[31440000]        <2> 	mov ebx, .month
  5619 00004360 A0[5A440000]        <2> 	mov al, [RTCtimeDay]
  5620 00004365 E81BFFFFFF          <2> 	call converttohex
  5621 0000436A 88E0                <2> 	mov al, ah
  5622 0000436C FEC8                <2> 	dec al
  5623 0000436E 31D2                <2> 	xor edx, edx
  5624 00004370 88C2                <2> 	mov dl, al
  5625 00004372 A0[5B440000]        <2> 	mov al, [RTCtimeMonth]
  5626 00004377 E809FFFFFF          <2> 	call converttohex
  5627 0000437C 88D0                <2> 	mov al, dl
  5628 0000437E 88E2                <2> 	mov dl, ah
  5629 00004380 30E4                <2> 	xor ah, ah
  5630 00004382 6689D5              <2> 	mov bp, dx
  5631                              <2> 	
  5632 00004385 6689F7              <2> 	mov di, si
  5633 00004388 66C1EF02            <2> 	shr di, 2
  5634 0000438C 66C1E702            <2> 	shl di, 2
  5635 00004390 C605[32440000]1C    <2> 	mov byte [.month + 1], 28
  5636 00004397 6639F7              <2> 	cmp di, si
  5637 0000439A 7506                <2> 	jne .nofebmod
  5638 0000439C FE05[32440000]      <2> 	inc byte [.month + 1]
  5639                              <2> .nofebmod:
  5640 000043A2 664D                <2> 	dec bp
  5641 000043A4 6681FD0000          <2> 	cmp bp, 0
  5642 000043A9 7407                <2> 	je .ylp
  5643 000043AB 8A13                <2> 	mov dl, [ebx]
  5644 000043AD 01D0                <2> 	add eax, edx
  5645 000043AF 43                  <2> 	inc ebx
  5646 000043B0 EBF0                <2> 	jmp .nofebmod
  5647                              <2> 	
  5648                              <2> .ylp:
  5649 000043B2 6689F7              <2> 	mov di, si
  5650 000043B5 66C1EF02            <2> 	shr di, 2
  5651 000043B9 66C1E702            <2> 	shl di, 2
  5652 000043BD 81C18033E101        <2> 	add ecx, 31536000
  5653 000043C3 6639F7              <2> 	cmp di, si
  5654 000043C6 7506                <2> 	jne .noymod
  5655 000043C8 81C180510100        <2> 	add ecx, 86400
  5656                              <2> .noymod:
  5657 000043CE 664E                <2> 	dec si
  5658 000043D0 6681FEB207          <2> 	cmp si, 1970
  5659 000043D5 77DB                <2> 	ja .ylp
  5660                              <2> 	
  5661 000043D7 BB80510100          <2> 	mov ebx, 86400
  5662 000043DC 31D2                <2> 	xor edx, edx
  5663 000043DE F7E3                <2> 	mul ebx
  5664 000043E0 01C1                <2> 	add ecx, eax
  5665                              <2> 	
  5666 000043E2 31DB                <2> 	xor ebx, ebx
  5667 000043E4 31D2                <2> 	xor edx, edx
  5668 000043E6 B8100E0000          <2> 	mov eax, 3600
  5669 000043EB 8A3D[3D440000]      <2> 	mov bh, [timezoneh]
  5670 000043F1 80FF80              <2> 	cmp bh, 128
  5671 000043F4 720D                <2> 	jb .posh
  5672 000043F6 28FB                <2> 	sub bl, bh
  5673 000043F8 30FF                <2> 	xor bh, bh
  5674 000043FA F7E3                <2> 	mul ebx
  5675 000043FC 01C1                <2> 	add ecx, eax
  5676 000043FE E906000000          <2> 	jmp .doneth
  5677                              <2> .posh:
  5678 00004403 86DF                <2> 	xchg bl, bh
  5679 00004405 F7E3                <2> 	mul ebx
  5680 00004407 29C1                <2> 	sub ecx, eax
  5681                              <2> .doneth:
  5682                              <2> 
  5683 00004409 31DB                <2> 	xor ebx, ebx	
  5684 0000440B 31D2                <2> 	xor edx, edx
  5685 0000440D B83C000000          <2> 	mov eax, 60
  5686 00004412 8A3D[3E440000]      <2> 	mov bh, [timezonem]
  5687 00004418 80FF80              <2> 	cmp bh, 128
  5688 0000441B 720D                <2> 	jb .posm
  5689 0000441D 28FB                <2> 	sub bl, bh
  5690 0000441F 30FF                <2> 	xor bh, bh
  5691 00004421 F7E3                <2> 	mul ebx
  5692 00004423 01C1                <2> 	add ecx, eax
  5693 00004425 E906000000          <2> 	jmp .donetm
  5694                              <2> .posm:
  5695 0000442A 86DF                <2> 	xchg bl, bh
  5696 0000442C F7E3                <2> 	mul ebx
  5697 0000442E 29C1                <2> 	sub ecx, eax
  5698                              <2> .donetm:
  5699                              <2> 
  5700 00004430 C3                  <2> 	ret
  5701                              <2> 	
  5702                              <2> 
  5703 00004431 1F1C1F1E1F1E1F1F1E- <2> .month db 31,28,31,30,31,30,31,31,30,31,30,31
  5704 0000443A 1F1E1F              <2>
  5705                              <2> 
  5706 0000443D FA                  <2> 	timezoneh db -6
  5707 0000443E 00                  <2> 	timezonem db 0
  5708 0000443F 000000000000000000- <2> 	tstack dd 0,0,0,0,0,0
  5709 00004448 000000000000000000- <2>
  5710 00004451 000000000000        <2>
  5711 00004457 00                  <2> 	RTCtimeSecond db 0
  5712 00004458 00                  <2> 	RTCtimeMinute db 0
  5713 00004459 00                  <2> 	RTCtimeHour db 0
  5714 0000445A 00                  <2> 	RTCtimeDay db 0
  5715 0000445B 00                  <2> 	RTCtimeMonth db 0
  5716 0000445C 00                  <2> 	RTCtimeYear db 0
  5717 0000445D 00                  <2> 	dayhex db 0
  5718 0000445E 00                  <2> 	monthhex db 0
  5719 0000445F 00                  <2> 	yearhex db 0
  5720 00004460 30303A30303A303000  <2> 	timeshow db "00:00:00",0
  5721 00004469 30302D30302D303030- <2> 	dateshow db "00-00-0000 ",0
  5722 00004472 302000              <2>
  5723                              <2> 	oldcentury:	;from 1700 to 1900
  5724 00004475 040200              <2> 	db 4,2,0
  5725                              <2> 	century:	;from 2000 to 2500
  5726 00004478 060402000604        <2> 	db 6,4,2,0,6,4
  5727                              <2> 	month:
  5728 0000447E 000303060104060205- <2> 	db 0,3,3,6,1,4,6,2,5,0,3,5
  5729 00004487 000305              <2>
  5730                              <2> 	day:
  5731 0000448A [A6440000]          <2> 	dd sunday
  5732 0000448E [AE440000]          <2> 	dd monday
  5733 00004492 [B6440000]          <2> 	dd tuesday
  5734 00004496 [BF440000]          <2> 	dd wednesday
  5735 0000449A [CA440000]          <2> 	dd thursday
  5736 0000449E [D4440000]          <2> 	dd friday
  5737 000044A2 [DC440000]          <2> 	dd saturday
  5738                              <2> sunday:
  5739 000044A6 53756E6461790A00    <2> 	db "Sunday",10,0
  5740                              <2> monday:
  5741 000044AE 4D6F6E6461790A00    <2> 	db "Monday",10,0
  5742                              <2> tuesday:
  5743 000044B6 547565736461790A00  <2> 	db "Tuesday",10,0
  5744                              <2> wednesday:
  5745 000044BF 5765646E6573646179- <2> 	db "Wednesday",10,0
  5746 000044C8 0A00                <2>
  5747                              <2> thursday:
  5748 000044CA 54687572736461790A- <2> 	db "Thursday",10,0
  5749 000044D3 00                  <2>
  5750                              <2> friday:
  5751 000044D4 4672696461790A00    <2> 	db "Friday",10,0
  5752                              <2> saturday:
  5753 000044DC 53617475726461790A- <2> 	db "Saturday",10,0
  5754 000044E5 00                  <2>
  5755                              <1> %ifdef network.included
  5756                              <1> 	%include 'source/programs/dhcp.asm'
  5757 000044E6 FF2C6468637000      <2> db 255,44,"dhcp",0
  5758                              <2> dhcp:
  5759 000044ED BE[AD450000]        <2> 	mov esi, .dhcp.mac
  5760 000044F2 BB[8D460000]        <2> 	mov ebx, .dhcp.option.mac
  5761 000044F7 BF[6D450000]        <2> 	mov edi, .mac
  5762 000044FC 31C9                <2> 	xor ecx, ecx
  5763 000044FE 66890D[7F450000]    <2> 	mov [.ip.checksum], cx
  5764 00004505 66890D[8F450000]    <2> 	mov [.udp.checksum], cx
  5765 0000450C 8B0D[8D8E0000]      <2> 	mov ecx, [sysmac]
  5766 00004512 890B                <2> 	mov [ebx], ecx
  5767 00004514 890F                <2> 	mov [edi], ecx
  5768 00004516 890E                <2> 	mov [esi], ecx
  5769 00004518 668B0D[918E0000]    <2> 	mov cx, [sysmac + 4]
  5770 0000451F 66894B04            <2> 	mov [ebx + 4], cx
  5771 00004523 66894E04            <2> 	mov [esi + 4], cx
  5772 00004527 66894F04            <2> 	mov [edi + 4], cx
  5773 0000452B BF[75450000]        <2> 	mov edi, .ip.header
  5774 00004530 BE[89450000]        <2> 	mov esi, .ip.headerend
  5775 00004535 E84D480000          <2> 	call getchecksum
  5776 0000453A 66890D[7F450000]    <2> 	mov [.ip.checksum], cx
  5777 00004541 BF[89450000]        <2> 	mov edi, .udp.header
  5778 00004546 BE[A4460000]        <2> 	mov esi, .udp.end
  5779 0000454B E837480000          <2> 	call getchecksum
  5780 00004550 66890D[8F450000]    <2> 	mov [.udp.checksum], cx
  5781 00004557 BF[67450000]        <2> 	mov edi, .frame
  5782 0000455C BE[A4460000]        <2> 	mov esi, .udp.end
  5783 00004561 E817480000          <2> 	call sendpacket
  5784 00004566 C3                  <2> 	ret
  5785                              <2> 
  5786                              <2> .frame:
  5787 00004567 FFFFFFFFFFFF        <2> 	.destmac db 0xFF,0xFF,0xFF,0xFF,0xFF,0xFF
  5788 0000456D 000000000000        <2> 	.mac db 0,0,0,0,0,0
  5789 00004573 0800                <2> 	db 8,0
  5790                              <2> .ip.header:
  5791 00004575 45                  <2> 	db (0x40 | (.ip.headerend - .ip.header)/4)
  5792 00004576 00                  <2> 	db 0
  5793 00004577 012F                <2> 	db (.udp.end - .ip.header)/256, (.udp.end - .ip.header) % 256
  5794 00004579 0000                <2> 	dw 0
  5795 0000457B 0000                <2> 	dw 0
  5796 0000457D 80                  <2> 	db 0x80
  5797 0000457E 11                  <2> 	db 17
  5798 0000457F 0000                <2> .ip.checksum dw 0
  5799 00004581 00000000            <2> 	db 0,0,0,0
  5800 00004585 FFFFFFFF            <2> 	db 255,255,255,255	
  5801                              <2> .ip.headerend:
  5802                              <2> .udp.header:
  5803 00004589 0044                <2> 	db 0,68	;source port
  5804 0000458B 0043                <2> 	db 0,67 ;destination port
  5805 0000458D 012F                <2> 	db (.udp.end - .ip.header)/256, (.udp.end - .ip.header) % 256
  5806 0000458F 0000                <2> .udp.checksum dw 0
  5807                              <2> .udp.headerend:
  5808                              <2> .dhcp.data:
  5809 00004591 01                  <2> 	db 1	;message type
  5810 00004592 01                  <2> 	db 1	;hardware type
  5811 00004593 06                  <2> 	db 6	;hardware address length
  5812 00004594 00                  <2> 	db 0	;hops
  5813 00004595 EC2B2369            <2> 	db 0xEC,0x2B,0x23,0x69	;transaction ID
  5814 00004599 0000                <2> 	db 0,0	;seconds elapsed
  5815 0000459B 0000                <2> 	db 0,0	;flags
  5816 0000459D 00000000            <2> 	db 0,0,0,0	;client ip address
  5817 000045A1 00000000            <2> 	db 0,0,0,0	;your ip address
  5818 000045A5 00000000            <2> 	db 0,0,0,0	;server ip address
  5819 000045A9 00000000            <2> 	db 0,0,0,0	;relay agent ip address
  5820 000045AD 000000000000        <2> .dhcp.mac db 0,0,0,0,0,0	;client hardware address
  5821 000045B3 00<rept>            <2> 	times 10 db 0	;padding
  5822 000045BD 00<rept>            <2> 	times 64 db 0	;server host name
  5823 000045FD 00<rept>            <2> 	times 128 db 0	;boot file name
  5824 0000467D 63825363            <2> 	db 0x63,0x82,0x53,0x63	;magic cookie
  5825                              <2> .dhcp.option.type:
  5826 00004681 350103              <2> 	db 53,1,3	;DHCP Request
  5827 00004684 3204C0A80002        <2> 	db 50,4,192,168,0,2	;requested IP
  5828 0000468A 3D07                <2> 	db 61,7 ;client id(mac)
  5829 0000468C 01                  <2> 	db 1	;Type=Ethernet
  5830 0000468D 000000000000        <2> .dhcp.option.mac:	db 0,0,0,0,0,0
  5831 00004693 0C08                <2> 	db 12,8 ;host name
  5832 00004695 536F6C6C65724F53    <2> .dhcp.option.name 	db "SollerOS"
  5833 0000469D 370401030F06        <2> 	db 55,4,1,3,15,6	;request subnet, router, domain name, name server
  5834 000046A3 FF                  <2> 	db 0xFF	;end DHCP options
  5835                              <2> .dhcp.end:
  5836                              <2> .udp.end:
  5837                              <2> 	
  5838                              <1> %endif
  5839                              <1> %ifdef disk.none
  5840                              <1> %else
  5841                              <1> 	%include 'source/programs/dos.asm'
  5842 000046A4 FF2C646F732000      <2> db 255,44,"dos ",0
  5843                              <2> dosrunner:
  5844 000046AB 8925[08B80300]      <2> 	mov [previousstack], esp
  5845 000046B1 8B3D[A82F0000]      <2> 	mov edi, [currentcommandloc]
  5846 000046B7 81C704000000        <2> 	add edi, 4
  5847 000046BD BE00014000          <2> 	mov esi,  0x100 + dosprogloc	;this should be the beginning of memory
  5848 000046C2 E851240000          <2> 	call loadfile
  5849 000046C7 8B3D[A82F0000]      <2> 	mov edi, [currentcommandloc]
  5850 000046CD 81C704000000        <2> 	add edi, 4
  5851 000046D3 81FA94010000        <2> 	cmp edx, 404
  5852 000046D9 0F845E000000        <2> 	je near .noprogfound
  5853 000046DF BB81004000          <2> 	mov ebx, 0x81 + dosprogloc
  5854 000046E4 31C9                <2> 	xor ecx, ecx
  5855                              <2> .findparams:
  5856 000046E6 47                  <2> 	inc edi
  5857 000046E7 8A07                <2> 	mov al, [edi]
  5858 000046E9 3C20                <2> 	cmp al, " "
  5859 000046EB 75F9                <2> 	jne .findparams
  5860                              <2> .copyparams:
  5861 000046ED 8A07                <2> 	mov al, [edi]
  5862 000046EF 8803                <2> 	mov [ebx], al
  5863 000046F1 43                  <2> 	inc ebx
  5864 000046F2 47                  <2> 	inc edi
  5865 000046F3 41                  <2> 	inc ecx
  5866 000046F4 81FB00014000        <2> 	cmp ebx, 0x100 + dosprogloc
  5867 000046FA 7304                <2> 	jae .nomoreparams
  5868 000046FC 3C00                <2> 	cmp al, 0
  5869 000046FE 75ED                <2> 	jne .copyparams
  5870                              <2> .nomoreparams:
  5871 00004700 880D80004000        <2> 	mov [0x80 + dosprogloc], cl
  5872 00004706 66B85000            <2> 	mov ax, DOS_DATA_SEL
  5873 0000470A 8ED8                <2> 	mov ds, ax
  5874 0000470C 8EC0                <2> 	mov es, ax
  5875 0000470E 8EE0                <2> 	mov fs, ax
  5876 00004710 8EE8                <2> 	mov gs, ax
  5877 00004712 31C0                <2> 	xor eax, eax
  5878 00004714 31DB                <2> 	xor ebx, ebx
  5879 00004716 31C9                <2> 	xor ecx, ecx
  5880 00004718 31D2                <2> 	xor edx, edx
  5881 0000471A 31FF                <2> 	xor edi, edi
  5882 0000471C 31F6                <2> 	xor esi, esi
  5883 0000471E 9A000100004800      <2> 	call DOS_CODE_SEL:0x100
  5884 00004725 66BB3000            <2> 	mov bx, NEW_DATA_SEL
  5885 00004729 6689DA              <2> 	mov dx, bx
  5886 0000472C 8EC3                <2> 	mov es, bx
  5887 0000472E 8EE3                <2> 	mov fs, bx
  5888 00004730 66BB2000            <2> 	mov bx, SYS_DATA_SEL
  5889 00004734 8EEB                <2> 	mov gs, bx
  5890 00004736 8B25[08B80300]      <2> 	mov esp, [previousstack]
  5891 0000473C C3                  <2> 	ret
  5892                              <2> .noprogfound:
  5893 0000473D BE[9B8E0000]        <2> 	mov esi, notfound1
  5894 00004742 E815D6FFFF          <2> 	call print
  5895 00004747 8B35[A82F0000]      <2> 	mov esi, [currentcommandloc]
  5896 0000474D 81C604000000        <2> 	add esi, 4
  5897 00004753 E804D6FFFF          <2> 	call print
  5898 00004758 BE[A38E0000]        <2> 	mov esi, notfound2
  5899 0000475D E8FAD5FFFF          <2> 	call print
  5900 00004762 C3                  <2> 	ret
  5901                              <2> 	
  5902                              <1> %endif
  5903                              <1> %include 'source/programs/dump.asm'
  5904 00004763 FF2C64756D702000    <2> db 255,44,"dump ",0
  5905 0000476B 8B35[A82F0000]      <2> 	mov esi, [currentcommandloc]
  5906 00004771 81C605000000        <2> 	add esi, 5
  5907 00004777 31C9                <2> 	xor ecx, ecx
  5908 00004779 66B83078            <2> 	mov ax, "0x"
  5909 0000477D 663906              <2> 	cmp [esi], ax
  5910 00004780 740A                <2> 	je dumphexin
  5911 00004782 E8D9EBFFFF          <2> 	call cnvrttxt
  5912 00004787 E910000000          <2> 	jmp dumphexnow
  5913                              <2> dumphexin:
  5914 0000478C 81C602000000        <2> 	add esi, 2
  5915 00004792 E880EBFFFF          <2> 	call cnvrthextxt
  5916 00004797 E900000000          <2> 	jmp dumphexnow
  5917                              <2> dumphexnow:
  5918 0000479C 89CF                <2> 	mov edi, ecx
  5919 0000479E 89FE                <2> 	mov esi, edi
  5920 000047A0 81C680030000        <2> 	add esi, 896
  5921                              <2> dumphexloop:
  5922 000047A6 8B0F                <2> 	mov ecx, [edi]
  5923 000047A8 C605[B5310000]05    <2> 	mov byte [firsthexshown],5
  5924 000047AF E816EAFFFF          <2> 	call showhex
  5925 000047B4 81C704000000        <2> 	add edi, 4
  5926 000047BA 39F7                <2> 	cmp edi, esi
  5927 000047BC 72E8                <2> 	jb dumphexloop
  5928 000047BE E8EFE0FFFF          <2> 	call termcopy
  5929 000047C3 C3                  <2> 	ret 
  5930                              <1> %include 'source/programs/echo.asm'
  5931                              <2> 
  5932 000047C4 FF2C6563686F00      <2> db 255,44,"echo",0
  5933                              <2> 	echoprog:
  5934 000047CB 8B35[A82F0000]      <2> 		mov esi, [currentcommandloc]
  5935 000047D1 81C605000000        <2> 		add esi, 5
  5936 000047D7 8A06                <2> 		mov al, [esi]
  5937 000047D9 E85AD5FFFF          <2> 		call printquiet
  5938 000047DE E874D5FFFF          <2> 		call printline
  5939 000047E3 C3                  <2> 		ret
  5940 000047E4 BB[88BA0300]        <2> 	echovr:	mov ebx, variables
  5941 000047E9 BF06000000          <2> 		mov edi, 6
  5942 000047EE E83C000000          <2> 		call nxtvrech
  5943 000047F3 E954000000          <2> 		jmp prntvr2
  5944 000047F8 B13D                <2> 	echvar:	mov cl, '='
  5945 000047FA 43                  <2> 		inc ebx
  5946 000047FB 8A03                <2> 		mov al, [ebx]
  5947 000047FD 3C00                <2> 		cmp al, 0
  5948 000047FF 742E                <2> 		je nxtvrech
  5949 00004801 3C3D                <2> 		cmp al, '='
  5950 00004803 7422                <2> 		je nxtvrechb1
  5951 00004805 8B35[A82F0000]      <2> 		mov esi, [currentcommandloc]
  5952 0000480B 01FE                <2> 		add esi, edi
  5953 0000480D E8D5E7FFFF          <2> 		call cndtest
  5954 00004812 3C02                <2> 		cmp al, 2
  5955 00004814 7432                <2> 		je prntvr
  5956 00004816 3C01                <2> 		cmp al, 1
  5957 00004818 742E                <2> 		je prntvr
  5958 0000481A 8B35[A82F0000]      <2> 		mov esi, [currentcommandloc]
  5959 00004820 01FE                <2> 		add esi, edi
  5960 00004822 E908000000          <2> 		jmp nxtvrech
  5961                              <2> 	nxtvrechb1:
  5962 00004827 81EB02000000        <2> 		sub ebx, 2
  5963 0000482D EBC9                <2> 		jmp echvar
  5964 0000482F 8A03                <2> 	nxtvrech: mov al, [ebx]
  5965 00004831 3C05                <2> 		cmp al, 5
  5966 00004833 740A                <2> 		je nxtvrec2
  5967 00004835 43                  <2> 		inc ebx
  5968 00004836 81FB[88CA0300]      <2> 		cmp ebx, varend
  5969 0000483C 72F1                <2> 		jb nxtvrech
  5970 0000483E C3                  <2> 		ret
  5971 0000483F 43                  <2> 	nxtvrec2: inc ebx
  5972 00004840 8A03                <2> 		mov al, [ebx]
  5973 00004842 3C04                <2> 		cmp al, 4
  5974 00004844 74B2                <2> 		je echvar
  5975 00004846 EBE7                <2> 		jmp nxtvrech
  5976 00004848 43                  <2> 	prntvr: inc ebx
  5977 00004849 89DE                <2> 		mov esi, ebx
  5978 0000484B C3                  <2> 		ret
  5979 0000484C E80BD5FFFF          <2> 	prntvr2: call print
  5980 00004851 BE[D48E0000]        <2> 		mov esi, line
  5981 00004856 E801D5FFFF          <2> 		call print
  5982 0000485B C3                  <2> 		ret 
  5983                              <1> %include 'source/programs/else.asm'
  5984 0000485C FF2C656C736500      <2> 	db 255,44,"else",0
  5985 00004863 31C0                <2> elsecmd:	xor eax, eax
  5986 00004865 3805[82BA0300]      <2> 	cmp [BATCHISON], al
  5987 0000486B 0F8442F2FFFF        <2> 	je near notbatch
  5988 00004871 A0[19BA0300]        <2> 	mov al, [IFON]
  5989 00004876 BE[1ABA0300]        <2> 	mov esi, IFTRUE
  5990 0000487B 01C6                <2> 	add esi, eax
  5991 0000487D 8A06                <2> 	mov al, [esi]
  5992 0000487F 3401                <2> 	xor al, 1
  5993 00004881 8806                <2> 	mov [esi], al
  5994 00004883 C3                  <2> 	ret 
  5995                              <1> %include 'source/programs/exit.asm'
  5996 00004884 FF2C6578697400      <2> db 255,44,"exit",0
  5997 0000488B 803D[18BA0300]01    <2> 	cmp byte [ranboot], 1
  5998 00004892 0F84F1E3FFFF        <2> 	je near returnfromexp
  5999 00004898 E9DCE2FFFF          <2> 	jmp nobootfile
  6000                              <1> %include 'source/programs/fi.asm'
  6001 0000489D FF2C666900          <2> 	db 255,44,"fi",0
  6002 000048A2 30C0                <2> 	xor al, al
  6003 000048A4 3805[82BA0300]      <2> 	cmp [BATCHISON], al
  6004 000048AA 0F8403F2FFFF        <2> 	je near notbatch
  6005 000048B0 B001                <2> fi:	mov al, 1
  6006 000048B2 2805[19BA0300]      <2> 	sub [IFON],al
  6007 000048B8 C3                  <2> 	ret 
  6008                              <1> %ifdef gui.included
  6009                              <1> 	%include 'source/programs/gui.asm'
  6010 000048B9 FF2C67756900        <2> db 255,44,"gui",0
  6011                              <2> guiswitcher:
  6012 000048BF 8B35[A82F0000]      <2> 	mov esi, [currentcommandloc]
  6013 000048C5 81C604000000        <2> 	add esi, 4
  6014 000048CB 31C9                <2> 	xor ecx, ecx
  6015 000048CD 803E00              <2> 	cmp byte [esi], 0
  6016 000048D0 740A                <2> 	je .nomodepref
  6017 000048D2 E840EAFFFF          <2> 	call cnvrthextxt ;switches arg on cline to vesa mode in ecx
  6018 000048D7 E907000000          <2> 	jmp .modepref
  6019                              <2> .nomodepref:
  6020 000048DC 51                  <2> 	push ecx
  6021 000048DD E826D5FFFF          <2> 	call clear
  6022 000048E2 59                  <2> 	pop ecx
  6023                              <2> .modepref:
  6024 000048E3 66C705[F30C0000]-   <2> 	mov word [realmodeptr], guiswitch
  6025 000048EA [6656]              <2>
  6026 000048EC E8F0C2FFFF          <2> 	call realmode
  6027                              <2> guiswitchret:
  6028 000048F1 65803D[F98E0000]01  <2> 	cmp byte [gs:guion], 1
  6029 000048F9 7401                <2> 	je .cont
  6030 000048FB C3                  <2> 	ret
  6031                              <2> .cont:
  6032 000048FC BF[52580000]        <2> 	mov edi, VBEMODEBLOCK
  6033                              <2> .loop:
  6034 00004901 658B07              <2> 	mov eax, [gs:edi]
  6035 00004904 8907                <2> 	mov [edi], eax
  6036 00004906 47                  <2> 	inc edi
  6037 00004907 81FF[565B0000]      <2> 	cmp edi, VBEEND
  6038 0000490D 72F2                <2> 	jb .loop
  6039 0000490F A1[7A5A0000]        <2> 	mov eax, [physbaseptr]
  6040 00004914 8B1D[47020000]      <2> 	mov ebx, [basecache]
  6041 0000491A C1E304              <2> 	shl ebx, 4
  6042 0000491D 29D8                <2> 	sub eax, ebx
  6043 0000491F A3[7A5A0000]        <2> 	mov [physbaseptr], eax
  6044 00004924 C605[E5230000]00    <2> 	mov byte [termguion], 0
  6045 0000492B BE[9DD20300]        <2> 	mov esi, graphicstable
  6046 00004930 30C0                <2> 	xor al, al
  6047                              <2> .clear:
  6048 00004932 8806                <2> 	mov [esi], al
  6049 00004934 46                  <2> 	inc esi
  6050 00004935 81FE[9DD40300]      <2> 	cmp esi, graphicstableend
  6051 0000493B 72F5                <2> 	jb .clear
  6052 0000493D E8132C0000          <2> 	call guisetup
  6053                              <2> 	;The next few lines center a window that is 3/4ths of the full screen
  6054 00004942 668B15[645A0000]    <2> 	mov dx, [resolutionx]
  6055 00004949 668B0D[665A0000]    <2> 	mov cx, [resolutiony]
  6056 00004950 6689D3              <2> 	mov bx, dx
  6057 00004953 6689C8              <2> 	mov ax, cx
  6058 00004956 66D1EB              <2> 	shr bx, 1
  6059 00004959 66D1E8              <2> 	shr ax, 1
  6060 0000495C 6689DA              <2> 	mov dx, bx
  6061 0000495F 66D1EA              <2> 	shr dx, 1
  6062 00004962 6689C1              <2> 	mov cx, ax
  6063 00004965 66D1E9              <2> 	shr cx, 1
  6064 00004968 6601D3              <2> 	add bx, dx
  6065 0000496B 6601C8              <2> 	add ax, cx
  6066 0000496E 66D1E9              <2> 	shr cx, 1
  6067 00004971 66C1EB03            <2> 	shr bx, 3
  6068 00004975 66C1E303            <2> 	shl bx, 3
  6069 00004979 66C1E804            <2> 	shr ax, 4
  6070 0000497D 66C1E004            <2> 	shl ax, 4
  6071 00004981 66891D[5A770000]    <2> 	mov [termwindow], bx
  6072 00004988 66A3[5C770000]      <2> 	mov [termwindow + 2], ax	;the previous lines of code make a large terminal window that is 4 characters smaller than the screen
  6073 0000498E BE[5A770000]        <2> 	mov esi, termwindow
  6074 00004993 31DB                <2> 	xor ebx, ebx
  6075 00004995 6631C0              <2> 	xor ax, ax
  6076 00004998 E8EA320000          <2> 	call showwindow
  6077 0000499D E8B5110000          <2> 	call cursorgui
  6078 000049A2 E861D4FFFF          <2> 	call clear
  6079 000049A7 C3                  <2> 	ret
  6080                              <2> 	
  6081                              <1> %endif
  6082                              <1> %include 'source/programs/help.asm'
  6083 000049A8 FF2C68656C7000      <2> db 255,44,"help",0
  6084                              <2> lscmd:	
  6085 000049AF B00D                <2> 		mov al, 13
  6086 000049B1 E831DAFFFF          <2> 		call prcharq
  6087 000049B6 BE[1D340000]        <2> 		mov esi, progstart
  6088 000049BB BB[66560000]        <2> 		mov ebx, progend
  6089 000049C0 BE[08B40300]        <2> dir:	mov esi, fileindex
  6090 000049C5 8A06                <2> 	dirnxt:	mov al, [esi]
  6091 000049C7 30E4                <2> 		xor ah, ah
  6092 000049C9 3CFF                <2> 		cmp al, 255
  6093 000049CB 7415                <2> 		je dirfnd
  6094 000049CD 46                  <2> 		inc esi
  6095 000049CE 81FE[08B80300]      <2> 		cmp esi,  fileindexend
  6096 000049D4 7339                <2> 		jae dirdn
  6097 000049D6 EBED                <2> 		jmp dirnxt
  6098                              <2> 	dirfnd3:
  6099 000049D8 46                  <2> 		inc esi
  6100 000049D9 81FE[08B80300]      <2> 		cmp esi, fileindexend
  6101 000049DF 76E4                <2> 		jbe dirnxt
  6102 000049E1 4E                  <2> 		dec esi
  6103 000049E2 46                  <2> 	dirfnd:	inc esi
  6104 000049E3 8A06                <2> 		mov al, [esi]
  6105 000049E5 30E4                <2> 		xor ah, ah
  6106 000049E7 3C2C                <2> 		cmp al, 44
  6107 000049E9 740B                <2> 		je dirfnd2
  6108 000049EB 46                  <2> 		inc esi
  6109 000049EC 81FE[08B80300]      <2> 		cmp esi,  fileindexend
  6110 000049F2 731B                <2> 		jae dirdn
  6111 000049F4 EBCF                <2> 		jmp dirnxt
  6112 000049F6 46                  <2> 	dirfnd2: inc esi
  6113 000049F7 E83CD3FFFF          <2> 		call printquiet
  6114 000049FC 56                  <2> 		push esi
  6115 000049FD B009                <2> 		mov al, 9
  6116 000049FF E8E3D9FFFF          <2> 		call prcharq
  6117 00004A04 5E                  <2> 		pop esi
  6118 00004A05 81FE[08B80300]      <2> 		cmp esi,  fileindexend
  6119 00004A0B 7302                <2> 		jae dirdn
  6120 00004A0D EBB6                <2> 		jmp dirnxt
  6121 00004A0F BE[D48E0000]        <2> 	dirdn:	mov esi, line
  6122 00004A14 E843D3FFFF          <2> 			call print
  6123 00004A19 C3                  <2> 			ret
  6124 00004A1A 00                  <2> currentdir db 0
  6125                              <1> %include 'source/programs/if.asm'
  6126 00004A1B FF2C69662000        <2> 	db 255,44,"if ",0
  6127 00004A21 30C0                <2> ifcmd:	xor al, al
  6128 00004A23 3805[82BA0300]      <2> 	cmp [BATCHISON], al
  6129 00004A29 0F8484F0FFFF        <2> 	je near notbatch
  6130 00004A2F 8B1D[A82F0000]      <2> 	mov ebx, [currentcommandloc]
  6131 00004A35 81C303000000        <2> 	add ebx, 3
  6132 00004A3B 89DE                <2> 	mov esi, ebx
  6133 00004A3D 8A06                <2> chkeqsn: mov al, [esi]
  6134 00004A3F 3C00                <2> 	cmp al, 0
  6135 00004A41 0F846CF0FFFF        <2> 	je near notbatch
  6136 00004A47 3C3D                <2> 	cmp al, '='
  6137 00004A49 0F8403000000        <2> 	je near chkeqdn
  6138 00004A4F 46                  <2> 	inc esi
  6139 00004A50 EBEB                <2> 	jmp chkeqsn
  6140 00004A52 B000                <2> chkeqdn: mov al, 0 
  6141 00004A54 8806                <2> 	mov [esi], al
  6142 00004A56 46                  <2> 	inc esi
  6143 00004A57 E850E5FFFF          <2> 	call tester
  6144 00004A5C 3C01                <2> 	cmp al, 1
  6145 00004A5E 0F8405000000        <2> 	je near trueif
  6146 00004A64 E91C000000          <2> 	jmp falseif
  6147 00004A69 31C0                <2> trueif:	xor eax, eax
  6148 00004A6B A0[19BA0300]        <2> 	mov al, [IFON]
  6149 00004A70 FEC0                <2> 	inc al
  6150 00004A72 A2[19BA0300]        <2> 	mov [IFON], al
  6151 00004A77 30E4                <2> 	xor ah, ah
  6152 00004A79 BE[1ABA0300]        <2> 	mov esi, IFTRUE
  6153 00004A7E 01C6                <2> 	add esi, eax
  6154 00004A80 B401                <2> 	mov ah, 1
  6155 00004A82 8826                <2> 	mov [esi], ah
  6156 00004A84 C3                  <2> 	ret 
  6157 00004A85 31C0                <2> falseif: xor eax, eax
  6158 00004A87 A0[19BA0300]        <2> 	mov al, [IFON]
  6159 00004A8C FEC0                <2> 	inc al
  6160 00004A8E A2[19BA0300]        <2> 	mov [IFON], al
  6161 00004A93 30E4                <2> 	xor ah, ah
  6162 00004A95 BE[1ABA0300]        <2> 	mov esi, IFTRUE
  6163 00004A9A 01C6                <2> 	add esi, eax
  6164 00004A9C 30E4                <2> 	xor ah, ah
  6165 00004A9E 8826                <2> 	mov [esi], ah
  6166 00004AA0 C3                  <2> 	ret 
  6167                              <1> %ifdef network.included
  6168                              <1> 	%include 'source/programs/ipconfig.asm'
  6169 00004AA1 FF2C6966636F6E6669- <2> db 255,44,"ifconfig",0
  6170 00004AAA 6700                <2>
  6171                              <2> ifconfig:
  6172 00004AAC 8B35[A82F0000]      <2> 	mov esi, [currentcommandloc]
  6173 00004AB2 81C609000000        <2> 	add esi, 9
  6174 00004AB8 803E00              <2> 	cmp byte [esi], 0
  6175 00004ABB 740B                <2> 	je .noip
  6176 00004ABD E8ED420000          <2> 	call strtoip
  6177 00004AC2 890D[898E0000]      <2> 	mov [sysip], ecx
  6178                              <2> .noip:
  6179                              <2> %ifdef ne2000.included
  6180 00004AC8 803D[428D0000]01    <2> 	cmp byte [ne2000.nicconfig], 1
  6181 00004ACF 7519                <2> 	jne .none2000
  6182 00004AD1 BE[438D0000]        <2> 	mov esi, ne2000.name
  6183 00004AD6 E881D2FFFF          <2> 	call print
  6184 00004ADB B9[668D0000]        <2> 	mov ecx, ne2000.mac
  6185 00004AE0 E83D430000          <2> 	call showmac
  6186 00004AE5 E86DD2FFFF          <2> 	call printline
  6187                              <2> .none2000:
  6188                              <2> %endif
  6189                              <2> %ifdef rtl8139.included
  6190                              <2> 	cmp byte [rtl8139.nicconfig], 1
  6191                              <2> 	jne .nortl8139
  6192                              <2> 	mov esi, rtl8139.name
  6193                              <2> 	call print
  6194                              <2> 	mov ecx, rtl8139.mac
  6195                              <2> 	call showmac
  6196                              <2> 	call printline
  6197                              <2> .nortl8139:
  6198                              <2> %endif
  6199                              <2> %ifdef rtl8169.included
  6200                              <2> 	cmp byte [rtl8169.nicconfig], 1
  6201                              <2> 	jne .nortl8169
  6202                              <2> 	mov esi, rtl8169.name
  6203                              <2> 	call print
  6204                              <2> 	mov ecx, rtl8169.mac
  6205                              <2> 	call showmac
  6206                              <2> 	call printline
  6207                              <2> .nortl8169:
  6208                              <2> %endif
  6209                              <2> %ifdef i8254x.included
  6210                              <2> 	cmp byte [i8254x.nicconfig], 1
  6211                              <2> 	jne .noi8254x
  6212                              <2> 	mov esi, i8254x.name
  6213                              <2> 	call print
  6214                              <2> 	mov ecx, i8254x.mac
  6215                              <2> 	call showmac
  6216                              <2> 	call printline
  6217                              <2> .noi8254x:
  6218                              <2> %endif
  6219 00004AEA 8B0D[898E0000]      <2> 	mov ecx, [sysip]
  6220 00004AF0 E800430000          <2> 	call showip
  6221 00004AF5 E85DD2FFFF          <2> 	call printline
  6222 00004AFA C3                  <2> 	ret
  6223                              <2> 	
  6224                              <1> %endif
  6225                              <1> %include 'source/programs/keycode.asm'
  6226 00004AFB FF2C6B6579636F6465- <2> db 255,44,"keycode",0
  6227 00004B04 00                  <2>
  6228                              <2> keycode:
  6229 00004B05 66C705[B8230000]00- <2> 	mov word [trans], 0
  6230 00004B0D 00                  <2>
  6231 00004B0E C605[D26C0000]00    <2> 	mov byte [threadson], 0
  6232                              <2> %ifdef io.serial
  6233                              <2> .noserial:
  6234                              <2> 	hlt
  6235                              <2> 	mov dx, [serial.address]
  6236                              <2> 	in al, dx
  6237                              <2> 	cmp al, 0
  6238                              <2> 	je .noserial
  6239                              <2> 	mov cl, al
  6240                              <2> 	call showhexsmall
  6241                              <2> 	cmp al, 0x1B
  6242                              <2> 	jne .noserial
  6243                              <2> 	in al, dx
  6244                              <2> 	mov cl, al
  6245                              <2> 	call showhexsmall
  6246                              <2> 	cmp cl, 0x5B
  6247                              <2> 	je .noserial
  6248                              <2> 	ret
  6249                              <2> %else
  6250 00004B15 E857160000          <2> 	call getkey
  6251 00004B1A 31C0                <2> 	xor eax, eax
  6252 00004B1C 31C9                <2> 	xor ecx, ecx
  6253 00004B1E 8A0D[4F610000]      <2> 	mov cl, [specialkey]
  6254 00004B24 80F900              <2> 	cmp cl, 0
  6255 00004B27 0F8405000000        <2> 	je near .nospecialkeycode
  6256 00004B2D E884E6FFFF          <2> 	call showhexsmall
  6257                              <2> .nospecialkeycode:
  6258 00004B32 668B0D[B6230000]    <2> 	mov cx, [lastkey + 2]
  6259 00004B39 E878E6FFFF          <2> 	call showhexsmall
  6260 00004B3E 80F901              <2> 	cmp cl, 1
  6261 00004B41 75C2                <2> 	jne keycode
  6262 00004B43 C3                  <2> 	ret
  6263                              <2> %endif
  6264                              <1> %ifdef gui.included
  6265                              <1> 	%include 'source/programs/line.asm'
  6266 00004B44 FF2C6C696E6500      <2> db 255,44,"line",0
  6267                              <2> linetester:
  6268 00004B4B 803D[F98E0000]00    <2> 	cmp byte [guion], 0
  6269 00004B52 0F841B000000        <2> 	je near .done
  6270 00004B58 668B35[6D020000]    <2> 	mov si, [timenanoseconds + 2];essentially load a random value
  6271 00004B5F BB38000000          <2> 	mov ebx, 28*2;the line test draws ~28/6 times more lines in a 4:3 display mode than circles
  6272 00004B64 E868000000          <2> 	call .circletest
  6273 00004B69 BB0C000000          <2> 	mov ebx, 6*2 ;this makes them draw the same amount of lines as circles
  6274 00004B6E E801000000          <2> 	call .linetest
  6275                              <2> .done:
  6276 00004B73 C3                  <2> 	ret
  6277                              <2> 
  6278                              <2> .linetest:
  6279 00004B74 53                  <2> 	push ebx
  6280 00004B75 E8D6000000          <2> 	call .stime
  6281 00004B7A 5B                  <2> 	pop ebx
  6282 00004B7B 31FF                <2> 	xor edi, edi
  6283                              <2> .ltlp:
  6284 00004B7D 53                  <2> 	push ebx
  6285 00004B7E E81C010000          <2> 	call .st
  6286 00004B83 66F7D6              <2> 	not si
  6287 00004B86 E814010000          <2> 	call .st
  6288 00004B8B 5B                  <2> 	pop ebx
  6289 00004B8C 66F7D6              <2> 	not si
  6290 00004B8F 660335[6B020000]    <2> 	add si, [timenanoseconds]
  6291 00004B96 4B                  <2> 	dec ebx
  6292 00004B97 81FB00000000        <2> 	cmp ebx, 0
  6293 00004B9D 77DE                <2> 	ja .ltlp
  6294 00004B9F E8C4000000          <2> 	call .etime
  6295 00004BA4 53                  <2> 	push ebx	
  6296 00004BA5 57                  <2> 	push edi
  6297 00004BA6 E8C1270000          <2> 	call guiclear
  6298 00004BAB E80C280000          <2> 	call reloadallgraphics
  6299 00004BB0 59                  <2> 	pop ecx
  6300 00004BB1 E8CFE6FFFF          <2> 	call showdec
  6301 00004BB6 BE[E14C0000]        <2> 	mov esi, .msg
  6302 00004BBB E89CD1FFFF          <2> 	call print
  6303 00004BC0 59                  <2> 	pop ecx
  6304 00004BC1 E8BFE6FFFF          <2> 	call showdec
  6305 00004BC6 BE[0D4D0000]        <2> 	mov esi, .msgtime
  6306 00004BCB E88CD1FFFF          <2> 	call print
  6307 00004BD0 C3                  <2> 	ret
  6308                              <2> 	
  6309                              <2> .circletest:
  6310 00004BD1 53                  <2> 	push ebx
  6311 00004BD2 E879000000          <2> 	call .stime
  6312 00004BD7 5B                  <2> 	pop ebx
  6313 00004BD8 31FF                <2> 	xor edi, edi
  6314                              <2> .ctlp:
  6315 00004BDA 53                  <2> 	push ebx
  6316 00004BDB 668B0D[665A0000]    <2> 	mov cx, [resolutiony]
  6317 00004BE2 66D1E9              <2> 	shr cx, 1
  6318 00004BE5 668B15[645A0000]    <2> 	mov dx, [resolutionx]
  6319 00004BEC 66D1EA              <2> 	shr dx, 1
  6320 00004BEF 6689C8              <2> 	mov ax, cx
  6321                              <2> .circle:
  6322 00004BF2 60                  <2> 	pusha
  6323 00004BF3 E8D1210000          <2> 	call drawcircle
  6324 00004BF8 61                  <2> 	popa
  6325 00004BF9 6648                <2> 	dec ax
  6326 00004BFB 47                  <2> 	inc edi
  6327 00004BFC 663D0100            <2> 	cmp ax, 1
  6328 00004C00 77F0                <2> 	ja .circle
  6329 00004C02 66F7D6              <2> 	not si
  6330                              <2> .circle2:
  6331 00004C05 60                  <2> 	pusha
  6332 00004C06 E8BE210000          <2> 	call drawcircle
  6333 00004C0B 61                  <2> 	popa
  6334 00004C0C 47                  <2> 	inc edi
  6335 00004C0D 6640                <2> 	inc ax
  6336 00004C0F 6639C8              <2> 	cmp ax, cx
  6337 00004C12 76F1                <2> 	jbe .circle2
  6338 00004C14 5B                  <2> 	pop ebx
  6339 00004C15 66F7D6              <2> 	not si
  6340 00004C18 660335[6B020000]    <2> 	add si, [timenanoseconds]
  6341 00004C1F 4B                  <2> 	dec ebx
  6342 00004C20 81FB00000000        <2> 	cmp ebx, 0
  6343 00004C26 77B2                <2> 	ja .ctlp
  6344 00004C28 E83B000000          <2> 	call .etime
  6345 00004C2D 53                  <2> 	push ebx
  6346 00004C2E 57                  <2> 	push edi
  6347 00004C2F 59                  <2> 	pop ecx
  6348 00004C30 E850E6FFFF          <2> 	call showdec
  6349 00004C35 BE[F64C0000]        <2> 	mov esi, .msgcircle
  6350 00004C3A E81DD1FFFF          <2> 	call print
  6351 00004C3F 59                  <2> 	pop ecx
  6352 00004C40 E840E6FFFF          <2> 	call showdec
  6353 00004C45 BE[0D4D0000]        <2> 	mov esi, .msgtime
  6354 00004C4A E80DD1FFFF          <2> 	call print
  6355 00004C4F C3                  <2> 	ret
  6356                              <2> 	
  6357                              <2> .stime:
  6358 00004C50 F4                  <2> 	hlt
  6359 00004C51 A1[67020000]        <2> 	mov eax, [timeseconds]
  6360 00004C56 8B1D[6B020000]      <2> 	mov ebx, [timenanoseconds]
  6361 00004C5C A3[1C4D0000]        <2> 	mov [.time], eax
  6362 00004C61 891D[204D0000]      <2> 	mov [.time + 4], ebx
  6363 00004C67 C3                  <2> 	ret
  6364                              <2> 	
  6365                              <2> .etime:
  6366 00004C68 A1[67020000]        <2> 	mov eax, [timeseconds]
  6367 00004C6D 8B1D[6B020000]      <2> 	mov ebx, [timenanoseconds]
  6368 00004C73 8B0D[1C4D0000]      <2> 	mov ecx, [.time]
  6369 00004C79 8B15[204D0000]      <2> 	mov edx, [.time + 4]
  6370 00004C7F C1EA0A              <2> 	shr edx, 10
  6371 00004C82 C1EB0A              <2> 	shr ebx, 10
  6372 00004C85 29C8                <2> 	sub eax, ecx
  6373 00004C87 3D00000000          <2> 	cmp eax, 0
  6374 00004C8C 740E                <2> 	je .notclp
  6375                              <2> .tclp:
  6376 00004C8E 81C340420F00        <2> 	add ebx, 1000000
  6377 00004C94 48                  <2> 	dec eax
  6378 00004C95 3D00000000          <2> 	cmp eax, 0
  6379 00004C9A 75F2                <2> 	jne .tclp
  6380                              <2> .notclp:
  6381 00004C9C 29D3                <2> 	sub ebx, edx
  6382 00004C9E C3                  <2> 	ret
  6383                              <2> 	
  6384                              <2> .st:
  6385 00004C9F 6631C0              <2> 	xor ax, ax
  6386 00004CA2 6631DB              <2> 	xor bx, bx
  6387 00004CA5 668B0D[665A0000]    <2> 	mov cx, [resolutiony]
  6388 00004CAC 668B15[645A0000]    <2> 	mov dx, [resolutionx]
  6389                              <2> .lp:
  6390 00004CB3 60                  <2> 	pusha
  6391 00004CB4 E887250000          <2> 	call drawline
  6392 00004CB9 61                  <2> 	popa
  6393                              <2> .noswitch:
  6394 00004CBA 47                  <2> 	inc edi
  6395 00004CBB 6643                <2> 	inc bx
  6396 00004CBD 664A                <2> 	dec dx
  6397 00004CBF 6681FB0000          <2> 	cmp bx, 0
  6398 00004CC4 74ED                <2> 	je .lp
  6399 00004CC6 6681FA0000          <2> 	cmp dx, 0
  6400 00004CCB 75E6                <2> 	jne .lp
  6401                              <2> .lp2:
  6402 00004CCD 60                  <2> 	pusha
  6403 00004CCE E86D250000          <2> 	call drawline
  6404 00004CD3 61                  <2> 	popa
  6405 00004CD4 47                  <2> 	inc edi
  6406 00004CD5 6640                <2> 	inc ax
  6407 00004CD7 6649                <2> 	dec cx
  6408 00004CD9 6681F90000          <2> 	cmp cx, 0
  6409 00004CDE 75ED                <2> 	jne .lp2
  6410 00004CE0 C3                  <2> 	ret
  6411                              <2> 	
  6412 00004CE1 6C696E657320776572- <2> .msg db "lines were drawn in ",0
  6413 00004CEA 6520647261776E2069- <2>
  6414 00004CF3 6E2000              <2>
  6415 00004CF6 636972636C65732077- <2> .msgcircle db "circles were drawn in ",0
  6416 00004CFF 65726520647261776E- <2>
  6417 00004D08 20696E2000          <2>
  6418 00004D0D 6D6963726F7365636F- <2> .msgtime db "microseconds.",10,0
  6419 00004D16 6E64732E0A00        <2>
  6420 00004D1C 0000000000000000    <2> .time dd 0,0	
  6421                              <1> %endif
  6422                              <1> %include 'source/programs/logout.asm'
  6423 00004D24 FF2C6C6F676F757400  <2> 	db 255,44,"logout",0
  6424 00004D2D E903DEFFFF          <2> 	jmp os
  6425                              <1> %include 'source/programs/loop.asm'
  6426 00004D32 FF2C6C6F6F7000      <2> 	db 255,44,"loop",0
  6427 00004D39 803D[83BA0300]00    <2> 	cmp byte [LOOPON], 0
  6428 00004D40 0F8501000000        <2> 	jne near filoop
  6429 00004D46 C3                  <2> 	ret
  6430 00004D47 8B35[84BA0300]      <2> filoop: mov esi, [LOOPPOS]
  6431 00004D4D FE0D[19BA0300]      <2> 	dec byte [IFON]
  6432 00004D53 C605[83BA0300]00    <2> 	mov byte [LOOPON], 0
  6433 00004D5A 8935[7EBA0300]      <2> 	mov [BATCHPOS], esi
  6434 00004D60 8935[DB390000]      <2> 	mov [batchedi], esi
  6435 00004D66 C3                  <2> 	ret 
  6436                              <1> %ifdef disk.none
  6437                              <1> %else
  6438                              <1> 	%include 'source/programs/ls.asm'
  6439 00004D67 FF2C6C7300          <2> db 255,44,"ls",0
  6440 00004D6C BE[53910300]        <2> 		mov esi, diskfileindex
  6441                              <2> 	diskindexdir:
  6442 00004D71 803E5F              <2> 		cmp byte [esi], '_'
  6443 00004D74 7440                <2> 		je nextdiskindexdir
  6444 00004D76 E8BDCFFFFF          <2> 		call printquiet
  6445 00004D7B 56                  <2> 		push esi
  6446 00004D7C BE[D64D0000]        <2> 		mov esi, disktab
  6447 00004D81 E8B2CFFFFF          <2> 		call printquiet
  6448 00004D86 5E                  <2> 		pop esi
  6449 00004D87 8B4E05              <2> 		mov ecx, [esi + 5]
  6450 00004D8A C605[B5310000]05    <2> 		mov byte [firsthexshown], 5
  6451 00004D91 E8EFE4FFFF          <2> 		call showdec
  6452 00004D96 56                  <2> 		push esi
  6453 00004D97 BE[D48E0000]        <2> 		mov esi, line
  6454 00004D9C E897CFFFFF          <2> 		call printquiet
  6455 00004DA1 5E                  <2> 		pop esi
  6456 00004DA2 81C609000000        <2> 		add esi, 9
  6457 00004DA8 81FE[35920300]      <2> 		cmp esi, enddiskfileindex
  6458 00004DAE 72C1                <2> 		jb diskindexdir
  6459 00004DB0 E8FDDAFFFF          <2> 		call termcopy
  6460 00004DB5 C3                  <2> 		ret
  6461                              <2> 	nextdiskindexdir:
  6462 00004DB6 46                  <2> 		inc esi
  6463 00004DB7 803E00              <2> 		cmp byte [esi], 0
  6464 00004DBA 75FA                <2> 		jne nextdiskindexdir
  6465 00004DBC 81C609000000        <2> 		add esi, 9
  6466 00004DC2 81FE[35920300]      <2> 		cmp esi, enddiskfileindex
  6467 00004DC8 72A7                <2> 		jb diskindexdir
  6468 00004DCA E8E3DAFFFF          <2> 		call termcopy
  6469 00004DCF C3                  <2> 		ret
  6470                              <2> 		
  6471 00004DD0 4469736B2000        <2> 		diskmsg db "Disk ",0
  6472 00004DD6 0D09090900          <2> 		disktab db 13,9,9,9,0
  6473                              <1> %endif
  6474                              <1> %include 'source/programs/memory.asm'
  6475 00004DDB FF2C6D656D6F727900  <2> db 255,44,"memory",0
  6476 00004DE4 BE[0F8F0000]        <2> 	mov esi, memlistbuf
  6477 00004DE9 31FF                <2> 	xor edi, edi
  6478 00004DEB 668B3D[4F910000]    <2> 	mov di, [memlistend]
  6479 00004DF2 01F7                <2> 	add edi, esi
  6480                              <2> printmemmap:
  6481 00004DF4 8B0E                <2> 	mov ecx, [esi]
  6482 00004DF6 E8CFE3FFFF          <2> 	call showhex
  6483 00004DFB 81C608000000        <2> 	add esi, 8
  6484 00004E01 8B0E                <2> 	mov ecx, [esi]
  6485 00004E03 E8C2E3FFFF          <2> 	call showhex
  6486 00004E08 81C608000000        <2> 	add esi, 8
  6487 00004E0E 8B0E                <2> 	mov ecx, [esi]
  6488 00004E10 E8B5E3FFFF          <2> 	call showhex
  6489 00004E15 81C608000000        <2> 	add esi, 8
  6490 00004E1B 57                  <2> 	push edi
  6491 00004E1C 56                  <2> 	push esi
  6492 00004E1D E835CFFFFF          <2> 	call printline
  6493 00004E22 5E                  <2> 	pop esi
  6494 00004E23 5F                  <2> 	pop edi
  6495 00004E24 39FE                <2> 	cmp esi, edi
  6496 00004E26 72CC                <2> 	jb printmemmap
  6497 00004E28 C3                  <2> 	ret
  6498                              <2> 	
  6499                              <1> %include 'source/programs/pci.asm'
  6500 00004E29 FF2C70636900        <2> db 255,44,"pci",0
  6501 00004E2F E8B5190000          <2> 	call pcidump
  6502 00004E34 C3                  <2> 	ret 
  6503                              <1> %ifdef network.included
  6504                              <1> 	%include 'source/programs/ping.asm'
  6505 00004E35 FF2C70696E672000    <2> db 255,44,"ping ",0
  6506                              <2> ping:
  6507 00004E3D 8B35[A82F0000]      <2> 	mov esi, [currentcommandloc]
  6508 00004E43 81C605000000        <2> 	add esi, 5
  6509 00004E49 E8613F0000          <2> 	call strtoip
  6510 00004E4E 890D[D44E0000]      <2> 	mov [.destip], ecx
  6511 00004E54 E89C3F0000          <2> 	call showip
  6512 00004E59 8B0D[898E0000]      <2> 	mov ecx, [sysip]
  6513 00004E5F 890D[D04E0000]      <2> 	mov [.sourceip], ecx
  6514 00004E65 31C0                <2> 	xor eax, eax
  6515 00004E67 31DB                <2> 	xor ebx, ebx
  6516 00004E69 66A3[CE4E0000]      <2> 	mov [.checksum], ax
  6517 00004E6F 66A3[DA4E0000]      <2> 	mov [.icmpchecksum], ax
  6518 00004E75 BF[C44E0000]        <2> 	mov edi, .header
  6519 00004E7A BE[D84E0000]        <2> 	mov esi, .headerend
  6520 00004E7F E8033F0000          <2> 	call getchecksum
  6521 00004E84 66890D[CE4E0000]    <2> 	mov [.checksum], cx
  6522 00004E8B BF[D84E0000]        <2> 	mov edi, .icmp
  6523 00004E90 BE[004F0000]        <2> 	mov esi, .packetend
  6524 00004E95 E8ED3E0000          <2> 	call getchecksum
  6525 00004E9A 66890D[DA4E0000]    <2> 	mov [.icmpchecksum], cx
  6526 00004EA1 BF[B64E0000]        <2> 	mov edi, .packet
  6527 00004EA6 BE[004F0000]        <2> 	mov esi, .packetend
  6528 00004EAB E8CD3E0000          <2> 	call sendpacket
  6529 00004EB0 E8A2CEFFFF          <2> 	call printline
  6530 00004EB5 C3                  <2> 	ret
  6531                              <2> 	
  6532                              <2> 	
  6533                              <2> 	
  6534                              <2> .packet:
  6535 00004EB6 FFFFFFFFFFFF        <2> .destinationmac db 0xFF,0xFF,0xFF,0xFF,0xFF,0xFF
  6536 00004EBC 000000000000        <2> .sourcemac	db 0,0,0,0,0,0
  6537 00004EC2 0800                <2> .ethertype	db 8,0	;ip is 0x800
  6538                              <2> .header:
  6539 00004EC4 45                  <2> .version	db 0x45
  6540 00004EC5 00                  <2> .services	db 0
  6541 00004EC6 003C                <2> .length	db 0,0x3C
  6542 00004EC8 0000                <2> .id		dw 0
  6543 00004ECA 00                  <2> .flags	db 0
  6544 00004ECB 00                  <2> .fragment db 0
  6545 00004ECC 80                  <2> .ttl	db 128
  6546 00004ECD 01                  <2> .protocol db 1 ;ICMP
  6547 00004ECE 0000                <2> .checksum dw 0
  6548 00004ED0 00000000            <2> .sourceip dd 0
  6549 00004ED4 00000000            <2> .destip dd 0
  6550                              <2> .headerend:
  6551                              <2> .icmp:
  6552 00004ED8 08                  <2> .icmptype db 8 ;Ping request
  6553 00004ED9 00                  <2> .icmpcode db 0
  6554 00004EDA 0000                <2> .icmpchecksum dw 0
  6555 00004EDC 0001                <2> .icmpid db 0,1
  6556 00004EDE 0000                <2> .sequence dw 0
  6557 00004EE0 616263646566676869- <2> db "abcdefghijklmnopqrstuvwabcdefghi" ;this is what microsoft includes
  6558 00004EE9 6A6B6C6D6E6F707172- <2>
  6559 00004EF2 737475767761626364- <2>
  6560 00004EFB 6566676869          <2>
  6561                              <2> .packetend:
  6562                              <1> %endif
  6563                              <1> %ifdef disk.none
  6564                              <1> %else
  6565                              <1> 	%include 'source/programs/play.asm'
  6566 00004F00 FF2C706C6179612000  <2> db 255,44,"playa ",0
  6567 00004F09 8B3D[A82F0000]      <2> 	mov edi, [currentcommandloc]
  6568 00004F0F 81C706000000        <2> 	add edi, 6
  6569 00004F15 E835000000          <2> 	call playasync
  6570 00004F1A C3                  <2> 	ret
  6571 00004F1B FF2C706C61792000    <2> db 255,44,"play ",0
  6572                              <2> play:
  6573 00004F23 8B3D[A82F0000]      <2> 	mov edi, [currentcommandloc]
  6574 00004F29 81C705000000        <2> 	add edi, 5
  6575 00004F2F E81B000000          <2> 	call playasync
  6576                              <2> .waitforsound:
  6577 00004F34 F4                  <2> 	hlt
  6578                              <2> %ifdef sound.included
  6579 00004F35 A1[39610000]        <2> 	mov eax, [Length0]
  6580 00004F3A 660B05[3D610000]    <2> 	or ax, [Length1]
  6581                              <2> %endif
  6582 00004F41 0A05[6F020000]      <2> 	or al, [soundon]
  6583 00004F47 3D00000000          <2> 	cmp eax, 0
  6584 00004F4C 75E6                <2> 	jne .waitforsound
  6585 00004F4E C3                  <2> 	ret
  6586                              <2> playasync:
  6587 00004F4F BE0000C000          <2> 	mov esi, 0xC00000
  6588 00004F54 E8BF1B0000          <2> 	call loadfile
  6589 00004F59 81FA94010000        <2> 	cmp edx, 404
  6590 00004F5F 743F                <2> 	je nosoundfound
  6591 00004F61 BB0000C000          <2> 	mov ebx, 0xC00000
  6592 00004F66 817B0857415645      <2> 	cmp dword [ebx + 8], "WAVE"
  6593 00004F6D 0F843F010000        <2> 	je near wave_player
  6594 00004F73 66813B534E          <2> 	cmp word [ebx], "SN"
  6595 00004F78 7526                <2> 	jne nosoundfound
  6596 00004F7A 81C306000000        <2> 	add ebx, 6
  6597 00004F80 891D[72020000]      <2> 	mov [soundpos], ebx
  6598 00004F86 035BFC              <2> 	add ebx, [ebx - 4]
  6599 00004F89 891D[76020000]      <2> 	mov [soundendpos], ebx
  6600 00004F8F 66C705[70020000]00- <2> 	mov word [soundrepititions], 0
  6601 00004F97 00                  <2>
  6602 00004F98 C605[6F020000]01    <2> 	mov byte [soundon], 1
  6603 00004F9F C3                  <2> 	ret
  6604                              <2> nosoundfound:
  6605 00004FA0 BE[C64F0000]        <2> 	mov esi, notfoundsound
  6606 00004FA5 E8B2CDFFFF          <2> 	call print
  6607 00004FAA 8B35[A82F0000]      <2> 	mov esi, [currentcommandloc]
  6608 00004FB0 81C605000000        <2> 	add esi, 5
  6609 00004FB6 E8A1CDFFFF          <2> 	call print
  6610 00004FBB BE[A38E0000]        <2> 	mov esi, notfound2
  6611 00004FC0 E897CDFFFF          <2> 	call print
  6612 00004FC5 C3                  <2> 	ret
  6613 00004FC6 706C61793A2000      <2> notfoundsound db "play: ",0
  6614                              <2> 
  6615                              <2> %ifdef sound.included
  6616                              <2> sbplay:
  6617 00004FCD BE0000C000          <2> 		mov esi, 0xC00000
  6618 00004FD2 89F3                <2> 		mov ebx, esi
  6619 00004FD4 81C62C000000        <2> 		add esi, WAVSTART
  6620 00004FDA 29F7                <2> 		sub edi, esi
  6621 00004FDC 66893D[3D610000]    <2> 		mov [Length1], di
  6622 00004FE3 C1EF0F              <2> 		shr edi, 15
  6623 00004FE6 893D[39610000]      <2> 		mov [Length0], edi
  6624 00004FEC 8B4B18              <2> 		mov ecx, [ebx + 24]
  6625 00004FEF 890D[4A610000]      <2> 		mov [Freq], ecx
  6626 00004FF5 31C0                <2> 		xor eax, eax
  6627 00004FF7 BA0000C000          <2> 		mov	edx, 0xC00000 ;physical location of sound
  6628 00004FFC 81C22C000000        <2> 		add edx, WAVSTART
  6629 00005002 01D0                <2> 		add	eax, edx
  6630 00005004 89C6                <2> 		mov esi, eax
  6631 00005006 31C9                <2> 		xor ecx, ecx
  6632 00005008 31DB                <2> 		xor ebx, ebx
  6633 0000500A 66891D[47610000]    <2> 		mov [SegLoc], bx
  6634 00005011 81C300000800        <2> 		add ebx, 0x80000
  6635 00005017 66B9FFFF            <2> 		mov cx, 0xFFFF
  6636 0000501B 6681FF0000          <2> 		cmp di, 0
  6637 00005020 7520                <2> 		jne .autoinit
  6638 00005022 668B0D[3D610000]    <2> 		mov cx, [Length1]
  6639 00005029 C605[38610000]01    <2> 		mov byte [OddLength], 1
  6640 00005030 6681F90080          <2> 		cmp cx, 32768
  6641 00005035 730B                <2> 		jae .autoinit
  6642 00005037 C605[38610000]00    <2> 		mov byte [OddLength], 0
  6643 0000503E 66D1E1              <2> 		shl cx, 1
  6644 00005041 47                  <2> 		inc edi
  6645                              <2> .autoinit:
  6646 00005042 4F                  <2> 		dec edi
  6647 00005043 893D[39610000]      <2> 		mov [Length0], edi
  6648 00005049 66890D[3D610000]    <2> 		mov [Length1], cx
  6649 00005050 66D1E9              <2> 		shr cx, 1
  6650 00005053 6641                <2> 		inc cx
  6651 00005055 01C8                <2> 		add eax, ecx
  6652 00005057 A3[3F610000]        <2> 		mov [NextMemLoc], eax
  6653 0000505C 8935[43610000]      <2> 		mov	[MemLoc], esi
  6654 00005062 E8770F0000          <2> 		call DMACopy
  6655 00005067 31DB                <2> 		xor ebx, ebx
  6656 00005069 668B1D[47610000]    <2> 		mov bx, [SegLoc]
  6657 00005070 31C9                <2> 		xor ecx, ecx
  6658 00005072 668B0D[3D610000]    <2> 		mov cx, [Length1]
  6659 00005079 66D1E9              <2> 		shr cx, 1
  6660 0000507C 6641                <2> 		inc cx
  6661 0000507E 01CB                <2> 		add ebx, ecx
  6662 00005080 66891D[47610000]    <2> 		mov [SegLoc], bx
  6663 00005087 81C300000800        <2> 		add ebx, 0x80000
  6664 0000508D 8B35[3F610000]      <2> 		mov esi, [NextMemLoc]
  6665 00005093 89F0                <2> 		mov eax, esi
  6666 00005095 01C8                <2> 		add eax, ecx
  6667 00005097 A3[3F610000]        <2> 		mov [NextMemLoc], eax
  6668 0000509C 8935[43610000]      <2> 		mov	[MemLoc], esi
  6669 000050A2 E8370F0000          <2> 		call DMACopy
  6670 000050A7 E8550F0000          <2> 		call DMAPlay
  6671 000050AC E8DF0F0000          <2> 		call PlayDSP
  6672 000050B1 C3                  <2> 		ret
  6673                              <2> WAVSTART equ 44
  6674                              <2> wave_player:
  6675 000050B2 803D[4E610000]01    <2> 	cmp byte [SoundBlaster], 1
  6676 000050B9 0F840EFFFFFF        <2> 	je near sbplay
  6677 000050BF BE[CA500000]        <2> 	mov esi, nosoundblaster
  6678 000050C4 E893CCFFFF          <2> 	call print
  6679 000050C9 C3                  <2> 	ret
  6680                              <2> %else
  6681                              <2> 	wave_player:
  6682                              <2> 		mov esi, nosoundblaster
  6683                              <2> 		call print
  6684                              <2> 		ret
  6685                              <2> %endif
  6686 000050CA 4E6F20536F756E6420- <2> nosoundblaster db "No Sound Blaster detected.",10,0
  6687 000050D3 426C61737465722064- <2>
  6688 000050DC 657465637465642E0A- <2>
  6689 000050E5 00                  <2>
  6690                              <1> %endif
  6691                              <1> %include 'source/programs/pwd.asm'
  6692 000050E6 FF2C70776400        <2> db 255,44,"pwd",0
  6693 000050EC BE[14B80300]        <2> 	mov esi, currentfolder
  6694 000050F1 E842CCFFFF          <2> 	call printquiet
  6695 000050F6 E85CCCFFFF          <2> 	call printline
  6696 000050FB C3                  <2> 	ret
  6697                              <2> 	
  6698                              <1> %include 'source/programs/reboot.asm'
  6699 000050FC FF2C7265626F6F7400  <2> 	db 255,44,"reboot",0
  6700 00005105 0F011D[0F510000]    <2> 		lidt [idtreboot]
  6701 0000510C CD00                <2> 		int 0
  6702 0000510E F4                  <2> 		hlt
  6703                              <2> 	
  6704 0000510F 0000                <2> 	idtreboot dw 0
  6705 00005111 00000000            <2> 			  dd 0
  6706                              <2> 
  6707                              <2> 	coldboot:
  6708 00005115 66B84000            <2> 		MOV AX, 0040h
  6709 00005119 8EC0                <2> 		MOV ES, AX
  6710 0000511B 2666C7057200000000- <2> 		MOV WORD [ES:00072h], 0h
  6711 00005124 00                  <2>
  6712 00005125 EA00000000FFFF      <2> 		JMP 0FFFFh:0000h
  6713 0000512C CF                  <2> 		IRET
  6714                              <2> 
  6715                              <2> 	warmboot:
  6716 0000512D 66B84000            <2> 		MOV AX, 0040h
  6717 00005131 8EC0                <2> 		MOV ES, AX
  6718 00005133 2666C7057200000034- <2> 		MOV WORD [ES:00072h], 01234h
  6719 0000513C 12                  <2>
  6720 0000513D EA00000000FFFF      <2> 		JMP 0FFFFh:0000h
  6721 00005144 CF                  <2> 		IRET
  6722                              <2> 		
  6723                              <1> %include 'source/programs/reg.asm'
  6724 00005145 FF2C72656700        <2> db 255,44,"reg",0
  6725 0000514B CD03                <2> 	int 3
  6726 0000514D C3                  <2> 	ret 
  6727                              <1> %ifdef disk.none
  6728                              <1> %else
  6729                              <1> 	%include 'source/programs/show.asm'
  6730 0000514E FF2C73686F772000    <2> db 255,44,"show ",0
  6731                              <2> showprog:
  6732 00005156 8B3D[A82F0000]      <2> 		mov edi, [currentcommandloc]
  6733 0000515C 81C705000000        <2> 		add edi, 5
  6734 00005162 BE00004000          <2> 		mov esi, 0x400000
  6735 00005167 803F26              <2> 		cmp byte [edi], '&'
  6736 0000516A 741B                <2> 		je .nullfile
  6737 0000516C BE00008000          <2> 		mov esi, 0x800000
  6738 00005171 E8A2190000          <2> 		call loadfile
  6739 00005176 81FA94010000        <2> 		cmp edx, 404
  6740 0000517C 0F847E000000        <2> 		je near filenotfound
  6741 00005182 BE00008000          <2> 		mov esi, 0x800000
  6742                              <2> .nullfile:
  6743                              <2> %ifdef gui.included
  6744 00005187 66813E424D          <2> 		cmp word [esi], "BM"
  6745 0000518C 740B                <2> 		je bmpfound
  6746                              <2> %endif
  6747 0000518E E8C9CBFFFF          <2> 		call print
  6748 00005193 E8BFCBFFFF          <2> 		call printline
  6749 00005198 C3                  <2> 		ret
  6750                              <2> %ifdef gui.included
  6751                              <2> bmpfound:
  6752 00005199 803D[F98E0000]00    <2> 		cmp byte [guion], 0
  6753 000051A0 0F8428000000        <2> 		je near noguibmp
  6754 000051A6 BE00008000          <2> 		mov esi, 0x800000
  6755 000051AB 31C9                <2> 		xor ecx, ecx
  6756 000051AD 31D2                <2> 		xor edx, edx
  6757 000051AF 31C0                <2> 		xor eax, eax
  6758 000051B1 31DB                <2> 		xor ebx, ebx
  6759 000051B3 E83F1B0000          <2> 		call showbmp
  6760 000051B8 30C0                <2> 		xor al, al
  6761 000051BA B405                <2> 		mov ah, 5
  6762 000051BC CD30                <2> 		int 30h
  6763 000051BE E8A9210000          <2> 		call guiclear
  6764 000051C3 E8881E0000          <2> 		call clearmousecursor
  6765 000051C8 E8EF210000          <2> 		call reloadallgraphics
  6766 000051CD C3                  <2> 		ret
  6767                              <2> noguibmp:
  6768 000051CE BE[D9510000]        <2> 		mov esi, warnguimsg
  6769 000051D3 E884CBFFFF          <2> 		call print
  6770 000051D8 C3                  <2> 		ret
  6771 000051D9 546869732063616E20- <2> warnguimsg db "This can not be done without the GUI.",10,0
  6772 000051E2 6E6F7420626520646F- <2>
  6773 000051EB 6E6520776974686F75- <2>
  6774 000051F4 742074686520475549- <2>
  6775 000051FD 2E0A00              <2>
  6776                              <2> %endif
  6777                              <2> 
  6778                              <2> filenotfound:
  6779 00005200 BE[33520000]        <2> 		mov esi, filenf
  6780 00005205 E852CBFFFF          <2> 		call print
  6781 0000520A 8B35[A82F0000]      <2> 		mov esi, [currentcommandloc]
  6782                              <2> findfilenotfoundzero:
  6783 00005210 8A06                <2> 		mov al, [esi]
  6784 00005212 46                  <2> 		inc esi
  6785 00005213 3C00                <2> 		cmp al, 0
  6786 00005215 7411                <2> 		je nofilenamenotfound
  6787 00005217 81FE[88D20300]      <2> 		cmp esi, buftxtend
  6788 0000521D 7309                <2> 		jae nofilenamenotfound
  6789 0000521F 3C20                <2> 		cmp al, " "
  6790 00005221 75ED                <2> 		jne findfilenotfoundzero
  6791 00005223 E834CBFFFF          <2> 		call print
  6792                              <2> nofilenamenotfound:
  6793 00005228 BE[3E520000]        <2> 		mov esi, filenf2
  6794 0000522D E82ACBFFFF          <2> 		call print
  6795 00005232 C3                  <2> 		ret
  6796 00005233 5468652066696C6520- <2> filenf db "The file ",34,0
  6797 0000523C 2200                <2>
  6798 0000523E 2220636F756C64206E- <2> filenf2 db 34," could not be found.",10,0
  6799 00005247 6F7420626520666F75- <2>
  6800 00005250 6E642E0A00          <2>
  6801                              <1> %endif
  6802                              <1> %include 'source/programs/shush.asm'
  6803 00005255 FF2C736875736800    <2> db 255,44,"shush",0	;if you add 2 values it will switch size using the first as X in chars and the second as Y in chars
  6804                              <2> shushprog:
  6805                              <2> %ifdef gui.included
  6806 0000525D 803D[F98E0000]00    <2> 	cmp byte [guion], 0
  6807 00005264 0F84B9000000        <2> 	je near .noswitchsize
  6808 0000526A 8B35[A82F0000]      <2> 	mov esi, [currentcommandloc]
  6809 00005270 81C606000000        <2> 	add esi, 6
  6810 00005276 56                  <2> 	push esi
  6811 00005277 4E                  <2> 	dec esi
  6812                              <2> .findspace:
  6813 00005278 46                  <2> 	inc esi
  6814 00005279 8A06                <2> 	mov al, [esi]
  6815 0000527B 3C00                <2> 	cmp al, 0
  6816 0000527D 0F84A0000000        <2> 	je near .noswitchsize
  6817 00005283 3C58                <2> 	cmp al, "X"
  6818 00005285 7408                <2> 	je .donefind
  6819 00005287 3C78                <2> 	cmp al, "x"
  6820 00005289 7404                <2> 	je .donefind
  6821 0000528B 3C20                <2> 	cmp al, " "
  6822 0000528D 75E9                <2> 	jne .findspace
  6823                              <2> .donefind:
  6824 0000528F 30C0                <2> 	xor al, al
  6825 00005291 8806                <2> 	mov [esi], al
  6826 00005293 46                  <2> 	inc esi
  6827 00005294 89F7                <2> 	mov edi, esi
  6828 00005296 E8C5E0FFFF          <2> 	call cnvrttxt
  6829 0000529B 89C8                <2> 	mov eax, ecx
  6830 0000529D 5E                  <2> 	pop esi
  6831 0000529E 50                  <2> 	push eax
  6832 0000529F 89F7                <2> 	mov edi, esi
  6833 000052A1 E8BAE0FFFF          <2> 	call cnvrttxt
  6834 000052A6 89CB                <2> 	mov ebx, ecx
  6835 000052A8 58                  <2> 	pop eax	
  6836 000052A9 6681FB0000          <2> 	cmp bx, 0
  6837 000052AE 0F846F000000        <2> 	je near .noswitchsize
  6838 000052B4 663D0000            <2> 	cmp ax, 0
  6839 000052B8 0F8465000000        <2> 	je near .noswitchsize
  6840 000052BE 66C1E303            <2> 	shl bx, 3
  6841 000052C2 66C1E004            <2> 	shl ax, 4
  6842 000052C6 663B1D[645A0000]    <2> 	cmp bx, [resolutionx]
  6843 000052CD 7607                <2> 	jbe .nofixx
  6844 000052CF 668B1D[645A0000]    <2> 	mov bx, [resolutionx]
  6845                              <2> .nofixx:
  6846 000052D6 66051000            <2> 	add ax, 16
  6847 000052DA 663B05[665A0000]    <2> 	cmp ax, [resolutiony]
  6848 000052E1 7606                <2> 	jbe .nofixy
  6849 000052E3 66A1[665A0000]      <2> 	mov ax, [resolutiony]
  6850                              <2> .nofixy:
  6851 000052E9 662D1000            <2> 	sub ax, 16
  6852 000052ED 6631C9              <2> 	xor cx, cx
  6853 000052F0 6631D2              <2> 	xor dx, dx
  6854 000052F3 66891D[5A770000]    <2> 	mov [termwindow], bx
  6855 000052FA 66A3[5C770000]      <2> 	mov [termwindow + 2], ax	;the previous lines of code make a large terminal window that is 4 characters smaller than the screen
  6856 00005300 BE[5A770000]        <2> 	mov esi, termwindow
  6857 00005305 31DB                <2> 	xor ebx, ebx
  6858 00005307 6631C0              <2> 	xor ax, ax
  6859 0000530A E878290000          <2> 	call showwindow
  6860 0000530F E858200000          <2> 	call guiclear
  6861 00005314 E8EFCAFFFF          <2> 	call clear
  6862 00005319 E89E200000          <2> 	call reloadallgraphics
  6863 0000531E E8E51D0000          <2> 	call switchmousepos2
  6864                              <2> .noswitchsize:
  6865                              <2> %endif
  6866 00005323 BE[2E530000]        <2> 	mov esi, shushmsg
  6867 00005328 E82FCAFFFF          <2> 	call print
  6868 0000532D C3                  <2> 	ret
  6869 0000532E 57656C636F6D652074- <2> 	shushmsg db "Welcome to the SollerOS Hardly Unix-Compatible Shell!",10,0
  6870 00005337 6F2074686520536F6C- <2>
  6871 00005340 6C65724F5320486172- <2>
  6872 00005349 646C7920556E69782D- <2>
  6873 00005352 436F6D70617469626C- <2>
  6874 0000535B 65205368656C6C210A- <2>
  6875 00005364 00                  <2>
  6876                              <1> %include 'source/programs/system.asm'
  6877 00005365 FF2C73797374656D00  <2> 	db 255,44,"system",0
  6878 0000536E BE[7E540000]        <2> 	mov esi, kernelinfomsg
  6879 00005373 E8C0C9FFFF          <2> 	call printquiet
  6880 00005378 B9[53910300]        <2> 	mov ecx, osend
  6881 0000537D E803DFFFFF          <2> 	call showdec
  6882 00005382 BE[93540000]        <2> 	mov esi, diskbytemsg
  6883 00005387 E8ACC9FFFF          <2> 	call printquiet
  6884 0000538C B9[53910300]        <2> 	mov ecx, osend
  6885 00005391 81C1[3E900500]      <2> 	add ecx, commandbufend
  6886 00005397 81E9[00940300]      <2> 	sub ecx, bssstart	;add the extra buffer space
  6887 0000539D E8E3DEFFFF          <2> 	call showdec
  6888 000053A2 BE[AA540000]        <2> 	mov esi, membytemsg
  6889 000053A7 E88CC9FFFF          <2> 	call printquiet
  6890 000053AC BE[0D550000]        <2> 	mov esi, endofmemmsg
  6891 000053B1 E882C9FFFF          <2> 	call printquiet
  6892 000053B6 B9[52C82500]        <2> 	mov ecx, bssend
  6893 000053BB E80ADEFFFF          <2> 	call showhex
  6894 000053C0 BE[C3540000]        <2> 	mov esi, systeminfomsg
  6895 000053C5 E86EC9FFFF          <2> 	call printquiet
  6896                              <2> getcpuspeed:
  6897 000053CA B8FE000000          <2> 	mov eax, 0xFE
  6898 000053CF E621                <2> 	out 0x21, al ;mask off all but timer interrupt
  6899 000053D1 B020                <2> 	mov al, 0x20
  6900 000053D3 E620                <2> 	out 0x20, al
  6901 000053D5 F4                  <2> 	hlt
  6902 000053D6 0F31                <2> 	rdtsc
  6903 000053D8 89D6                <2> 	mov esi, edx
  6904 000053DA 89C7                <2> 	mov edi, eax
  6905 000053DC 31C0                <2> 	xor eax, eax
  6906 000053DE C605[4F020000]01    <2> 	mov byte [testingcpuspeed], 1
  6907                              <2> cpuspeedloop:	;wait until next timer interrupt, then inc eax until the next
  6908 000053E5 40                  <2> 	inc eax
  6909 000053E6 EBFD                <2> 	jmp cpuspeedloop
  6910                              <2> cpuspeedloopend:
  6911 000053E8 0F31                <2> 	rdtsc
  6912 000053EA 29F8                <2> 	sub eax, edi
  6913 000053EC 29F2                <2> 	sub edx, esi
  6914 000053EE 8915[58020000]      <2> 	mov [cpuclocksperint + 4], edx
  6915 000053F4 A3[54020000]        <2> 	mov [cpuclocksperint], eax
  6916 000053F9 31C0                <2> 	xor eax, eax
  6917 000053FB E621                <2> 	out 0x21, al
  6918 000053FD B020                <2> 	mov al, 0x20
  6919 000053FF E620                <2> 	out 0x20, al
  6920 00005401 31D2                <2> 	xor edx, edx
  6921 00005403 31C0                <2> 	xor eax, eax
  6922 00005405 A1[50020000]        <2> 	mov eax, [cpuspeedperint]
  6923 0000540A D1E0                <2> 	shl eax, 1	;the cpu speed loop actually contains 2 commands so multiply the
  6924                              <2> 				;result by 2
  6925 0000540C 8B1D[62020000]      <2> 	mov ebx, [timeinterval]
  6926 00005412 C1EB0A              <2> 	shr ebx, 10 ;divide the interval by 1024
  6927 00005415 F7F3                <2> 	div ebx	;quotient in eax, remainder in edx
  6928 00005417 89C1                <2> 	mov ecx, eax
  6929 00005419 E867DEFFFF          <2> 	call showdec
  6930 0000541E BE[F1540000]        <2> 	mov esi, cpuspeedmsg
  6931 00005423 E810C9FFFF          <2> 	call printquiet
  6932 00005428 31D2                <2> 	xor edx, edx
  6933 0000542A A1[54020000]        <2> 	mov eax, [cpuclocksperint]
  6934 0000542F 8B15[58020000]      <2> 	mov edx, [cpuclocksperint + 4]
  6935 00005435 8B1D[62020000]      <2> 	mov ebx, [timeinterval]
  6936 0000543B C1EB0A              <2> 	shr ebx, 10
  6937 0000543E F7F3                <2> 	div ebx
  6938 00005440 89C1                <2> 	mov ecx, eax
  6939 00005442 E83EDEFFFF          <2> 	call showdec
  6940 00005447 BE[F7540000]        <2> 	mov esi, cpuclockmsg
  6941 0000544C E8E7C8FFFF          <2> 	call printquiet
  6942 00005451 8B0D[5C020000]      <2> 	mov ecx, [memoryspace]
  6943 00005457 C1E914              <2> 	shr ecx, 20
  6944 0000545A 41                  <2> 	inc ecx	;the reading is one MB behind
  6945 0000545B E825DEFFFF          <2> 	call showdec
  6946 00005460 BE[FC540000]        <2> 	mov esi, memoryspacemsg
  6947 00005465 E8F2C8FFFF          <2> 	call print
  6948                              <2> %ifdef sound.included
  6949 0000546A 803D[4E610000]00    <2> 	cmp byte [SoundBlaster], 0
  6950 00005471 740A                <2> 	je .nosb
  6951 00005473 BE[D9540000]        <2> 	mov esi, soundblastermsg
  6952 00005478 E8DFC8FFFF          <2> 	call print
  6953                              <2> .nosb:
  6954                              <2> %endif
  6955 0000547D C3                  <2> 	ret
  6956                              <2> 
  6957 0000547E 4B65726E656C20496E- <2> kernelinfomsg db "Kernel Information:",10,0
  6958 00005487 666F726D6174696F6E- <2>
  6959 00005490 3A0A00              <2>
  6960 00005493 427974657320446973- <2> diskbytemsg db "Bytes Disk Space Used",10,0
  6961 0000549C 6B2053706163652055- <2>
  6962 000054A5 7365640A00          <2>
  6963 000054AA 4279746573204D656D- <2> membytemsg db "Bytes Memory Space Used",10,0
  6964 000054B3 6F7279205370616365- <2>
  6965 000054BC 20557365640A00      <2>
  6966 000054C3 0A53797374656D2049- <2> systeminfomsg db 10,"System Information:",10,0
  6967 000054CC 6E666F726D6174696F- <2>
  6968 000054D5 6E3A0A00            <2>
  6969                              <2> %ifdef sound.included
  6970 000054D9 536F756E64626C6173- <2> 	soundblastermsg db "Soundblaster Detected.",10,0
  6971 000054E2 746572204465746563- <2>
  6972 000054EB 7465642E0A00        <2>
  6973                              <2> %endif
  6974 000054F1 4D4950530A00        <2> cpuspeedmsg db "MIPS",10,0
  6975 000054F7 4D487A0A00          <2> cpuclockmsg db "MHz",10,0
  6976 000054FC 4D42204D656D6F7279- <2> memoryspacemsg db "MB Memory Space",10,0
  6977 00005505 2053706163650A00    <2>
  6978 0000550D 456E64206F66204D65- <2> endofmemmsg: db "End of Memory Space: 0x",0
  6979 00005516 6D6F72792053706163- <2>
  6980 0000551F 653A20307800        <2>
  6981                              <1> %include 'source/programs/time.asm'
  6982 00005525 FF2C74696D6500      <2> db 255,44,"time",0	
  6983                              <2> timer:
  6984 0000552C 8B35[A82F0000]      <2> 	mov esi, [currentcommandloc]
  6985 00005532 81C604000000        <2> 	add esi, 4
  6986 00005538 803E00              <2> 	cmp byte [esi], 0
  6987 0000553B 7477                <2> 	je .norun
  6988 0000553D 46                  <2> 	inc esi
  6989 0000553E 8B0D[67020000]      <2> 	mov ecx, [timeseconds]
  6990 00005544 51                  <2> 	push ecx
  6991 00005545 8B0D[6B020000]      <2> 	mov ecx, [timenanoseconds]
  6992 0000554B 51                  <2> 	push ecx
  6993 0000554C BF[88CE0300]        <2> 	mov edi, buftxt
  6994                              <2> .cpcmd:
  6995 00005551 8A06                <2> 	mov al, [esi]
  6996 00005553 8807                <2> 	mov [edi], al
  6997 00005555 46                  <2> 	inc esi
  6998 00005556 47                  <2> 	inc edi
  6999 00005557 3C00                <2> 	cmp al, 0
  7000 00005559 75F6                <2> 	jne .cpcmd
  7001 0000555B E872D9FFFF          <2> 	call run
  7002 00005560 5A                  <2> 	pop edx
  7003 00005561 58                  <2> 	pop eax
  7004                              <2> 
  7005 00005562 8B0D[67020000]      <2> 	mov ecx, [timeseconds]
  7006 00005568 29C1                <2> 	sub ecx, eax
  7007 0000556A 8B1D[6B020000]      <2> 	mov ebx, [timenanoseconds]
  7008 00005570 29D3                <2> 	sub ebx, edx
  7009 00005572 7307                <2> 	jae .nosign
  7010 00005574 81C300CA9A3B        <2> 	add ebx, 1000000000
  7011 0000557A 49                  <2> 	dec ecx
  7012                              <2> .nosign:
  7013 0000557B E805DDFFFF          <2> 	call showdec
  7014                              <2> 	
  7015 00005580 89D9                <2> 	mov ecx, ebx
  7016 00005582 BE[82400000]        <2> 	mov esi, timenscache
  7017 00005587 C7460230303030      <2> 	mov dword [esi+ 2], "0000"
  7018 0000558E C7460630303030      <2> 	mov dword [esi + 6], "0000"
  7019 00005595 C6460A30            <2> 	mov byte [esi + 10], "0"
  7020 00005599 BE[8D400000]        <2> 	mov esi, timenscacheend
  7021 0000559E E8D4DAFFFF          <2> 	call convert
  7022 000055A3 BE[82400000]        <2> 	mov esi, timenscache
  7023 000055A8 E8AFC7FFFF          <2> 	call print
  7024 000055AD C605[82400000]08    <2> 	mov byte [timenscache], 8
  7025                              <2> .norun:
  7026 000055B4 C3                  <2> 	ret
  7027                              <2> 	
  7028                              <1> %include 'source/programs/turnoff.asm'
  7029 000055B5 FF2C7475726E6F6666- <2> 	db 255,44,"turnoff",0
  7030 000055BE 00                  <2>
  7031                              <2> 	turnoff:
  7032 000055BF 66C705[F30C0000]-   <2> 			mov word [realmodeptr], shutdown
  7033 000055C6 [D255]              <2>
  7034 000055C8 BB[FC550000]        <2> 			mov ebx, halt
  7035 000055CD E80FB6FFFF          <2> 			call realmode
  7036                              <2> 
  7037                              <2> [BITS 16]
  7038                              <2> 		shutdown:
  7039 000055D2 B453                <2> 			mov ah, 0x53
  7040 000055D4 B004                <2> 			mov al, 4
  7041 000055D6 31DB                <2> 			xor bx, bx
  7042 000055D8 CD15                <2> 			int 0x15
  7043                              <2> 			
  7044 000055DA B453                <2> 			mov ah, 0x53
  7045 000055DC B001                <2> 			mov al, 1
  7046 000055DE 31DB                <2> 			xor bx, bx
  7047 000055E0 CD15                <2> 			int 0x15
  7048                              <2> 			
  7049 000055E2 B453                <2> 			mov ah, 0x53
  7050 000055E4 B008                <2> 			mov al, 8
  7051 000055E6 BB0100              <2> 			mov bx, 1
  7052 000055E9 B90100              <2> 			mov cx, 1
  7053 000055EC CD15                <2> 			int 0x15
  7054                              <2> 			
  7055 000055EE B453                <2> 			mov ah, 0x53
  7056 000055F0 B007                <2> 			mov al, 7
  7057 000055F2 BB0100              <2> 			mov bx, 1
  7058 000055F5 B90300              <2> 			mov cx, 3
  7059 000055F8 CD15                <2> 			int 0x15
  7060 000055FA EBFE                <2> 			jmp $
  7061                              <2> 			[BITS 32]
  7062 000055FC EBFE                <2> halt: jmp $
  7063                              <1> %include 'source/programs/wait.asm'
  7064 000055FE FF2C7761697400      <2> db 255,44,"wait",0
  7065                              <2> waitkey:
  7066 00005605 E84ACDFFFF          <2> 		call getchar
  7067 0000560A C3                  <2> 		ret
  7068                              <1> %include 'source/programs/while.asm'
  7069 0000560B FF2C7768696C652000  <2> db 255,44,"while ",0
  7070 00005614 30C0                <2> whilecmd:  xor al, al
  7071 00005616 3805[82BA0300]      <2> 	cmp [BATCHISON], al
  7072 0000561C 0F8491E4FFFF        <2> 	je near notbatch
  7073 00005622 8B35[7EBA0300]      <2> 	mov esi, [BATCHPOS]
  7074 00005628 81EE02000000        <2> 	sub esi, 2
  7075 0000562E 4E                  <2> whilefnd: dec esi
  7076 0000562F 8A06                <2> 	mov al, [esi]
  7077 00005631 3C0A                <2> 	cmp al, 10
  7078 00005633 0F840A000000        <2> 	je near whilefnd2
  7079 00005639 3C00                <2> 	cmp al, 0
  7080 0000563B 0F8402000000        <2> 	je near whilefnd2
  7081 00005641 EBEB                <2> 	jmp whilefnd
  7082                              <2> whilefnd2:
  7083 00005643 46                  <2> 	inc esi
  7084 00005644 8935[84BA0300]      <2> 	mov [LOOPPOS], esi
  7085 0000564A C605[83BA0300]01    <2> 	mov BYTE [LOOPON], 1
  7086 00005651 BE[88CE0300]        <2> 	mov esi, buftxt
  7087 00005656 BB[88CE0300]        <2> 	mov ebx, buftxt
  7088 0000565B 81C306000000        <2> 	add ebx, 6
  7089 00005661 E9D7F3FFFF          <2> 	jmp chkeqsn
  7090                              <1> progend:		;programs end here	
  7091                              <1> batchprogend:
  7092                                  	%include "source/hardware.asm"
  7093                              <1> %ifdef gui.included
  7094                              <1> 	%include "source/drivers/video/vesa.asm"
  7095                              <2> [BITS 16]
  7096                              <2> guiswitch:
  7097 00005666 81F90000            <2> 	cmp cx, 0
  7098 0000566A 750B                <2> 	jne guiswitchdefnum
  7099 0000566C B81200              <2> 	mov ax, 12h
  7100 0000566F 31DB                <2> 	xor bx, bx
  7101 00005671 CD10                <2> 	int 10h
  7102 00005673 E85100              <2> 	call guiloadagain
  7103                              <2> guiswitchnocando:
  7104 00005676 C3                  <2> 	ret	;return without switching as mode number is bad
  7105                              <2> guiswitchdefnum:	;switch to a defined mode number
  7106 00005677 B8004F              <2> 	mov ax, 0x4F00
  7107 0000567A BF[5258]            <2> 	mov di, VBEMODEBLOCK
  7108 0000567D CD10                <2> 	int 10h
  7109 0000567F BE[7458]            <2> 	mov si, reserved
  7110 00005682 81EE0200            <2> 	sub si, 2
  7111                              <2> .loop:
  7112 00005686 81C60200            <2> 	add si, 2
  7113 0000568A 81FE[5259]          <2> 	cmp si, oemdata
  7114 0000568E 74E6                <2> 	je guiswitchnocando
  7115 00005690 813CFFFF            <2> 	cmp word [si], 0xFFFF
  7116 00005694 74E0                <2> 	je guiswitchnocando
  7117 00005696 390C                <2> 	cmp [si], cx
  7118 00005698 75EC                <2> 	jne .loop
  7119 0000569A 8936[AC57]          <2> 	mov [videomodecache], si
  7120 0000569E 81C90040            <2> 	or cx, 0x4000	;make sure linear frame buffer is selected
  7121 000056A2 B8014F              <2> 	mov ax, 0x4F01
  7122 000056A5 BF[525A]            <2> 	mov di, VBEMODEINFOBLOCK
  7123 000056A8 890E[AA57]          <2> 	mov [vesamode], cx
  7124 000056AC CD10                <2> 	int 10h
  7125 000056AE E9D900              <2> 	jmp selectedvesa
  7126                              <2> guiload:
  7127 000056B1 BE[2A58]            <2> 	mov si, bootmsg
  7128 000056B4 E8CAA9              <2> 	call printrm
  7129 000056B7 31C0                <2> 	xor ax, ax
  7130 000056B9 CD16                <2> 	int 16h
  7131 000056BB 3C79                <2> 	cmp al, "y"
  7132 000056BD 0F857EA9            <2> 	jne near vgaset
  7133 000056C1 BE[D38E]            <2> 	mov si, crlf
  7134 000056C4 E8BAA9              <2> 	call printrm
  7135                              <2> guiloadagain:
  7136 000056C7 B8004F              <2> 	mov ax, 04F00h
  7137 000056CA BF[5258]            <2> 	mov di, VBEMODEBLOCK
  7138 000056CD CD10                <2> 	int 10h
  7139 000056CF BE[7458]            <2> 	mov si, reserved
  7140 000056D2 81EE0200            <2> 	sub si, 2
  7141                              <2> findvideomodes:
  7142 000056D6 81C60200            <2> 	add si, 2
  7143 000056DA 8B0C                <2> 	mov cx, [si]
  7144 000056DC 81F9FFFF            <2> 	cmp cx, 0xFFFF
  7145 000056E0 0F840A00            <2> 	je near nextvmode
  7146 000056E4 81FE[5259]          <2> 	cmp si, oemdata
  7147 000056E8 0F8353A9            <2> 	jae near vgaset	;kill if no valid list is found
  7148 000056EC EBE8                <2> 	jmp findvideomodes 	
  7149                              <2> ;debug,shows vmodes available
  7150                              <2> nextvmode:
  7151 000056EE 81EE0200            <2> 	sub si, 2
  7152 000056F2 81FE[7458]          <2> 	cmp si, reserved
  7153 000056F6 0F82CDFF            <2> 	jb near guiloadagain
  7154 000056FA 8B0C                <2> 	mov cx, [si]
  7155 000056FC 81F9FFFF            <2> 	cmp cx, 0xFFFF
  7156 00005700 0F84EAFF            <2> 	je near nextvmode
  7157 00005704 81C90040            <2> 	or cx, 0x4000 		;Linear Frame Buffer
  7158 00005708 B8014F              <2> 	mov ax, 04F01h
  7159 0000570B BF[525A]            <2> 	mov di, VBEMODEINFOBLOCK
  7160 0000570E 890E[AA57]          <2> 	mov [vesamode], cx
  7161 00005712 CD10                <2> 	int 10h
  7162 00005714 A0[6B5A]            <2> 	mov al, [bitsperpixel]
  7163 00005717 3C10                <2> 	cmp al, 16
  7164 00005719 75D3                <2> 	jne nextvmode
  7165 0000571B 8936[AC57]          <2> 	mov [videomodecache], si
  7166 0000571F 84E4                <2> 	test ah, ah
  7167 00005721 0F842200            <2> 	jz near setvesamode
  7168 00005725 EBC7                <2> 	jmp nextvmode
  7169 00005727 0A0D49732074686973- <2> isthisvideook db 10,13,"Is this video mode OK?(y/n)",13,10,0
  7170 00005730 20766964656F206D6F- <2>
  7171 00005739 6465204F4B3F28792F- <2>
  7172 00005742 6E290D0A00          <2>
  7173                              <2> setvesamode:
  7174 00005747 8B36[AC57]          <2> 	mov si, [videomodecache]
  7175 0000574B 8B0C                <2> 	mov cx, [si]
  7176 0000574D E86500              <2> 	call decshow
  7177 00005750 B03A                <2> 	mov al, ':'
  7178 00005752 E8CD00              <2> 	call char
  7179 00005755 8B0E[645A]          <2> 	mov cx, [resolutionx]
  7180 00005759 E85900              <2> 	call decshow
  7181 0000575C B078                <2> 	mov al, "x"
  7182 0000575E E8C100              <2> 	call char
  7183 00005761 8B0E[665A]          <2> 	mov cx, [resolutiony]
  7184 00005765 E84D00              <2> 	call decshow
  7185 00005768 B040                <2> 	mov al, "@"
  7186 0000576A E8B500              <2> 	call char
  7187 0000576D 31C9                <2> 	xor cx, cx
  7188 0000576F 8A0E[6B5A]          <2> 	mov cl, [bitsperpixel]
  7189 00005773 E83F00              <2> 	call decshow
  7190 00005776 BE[2757]            <2> 	mov si, isthisvideook
  7191 00005779 E805A9              <2> 	call printrm
  7192 0000577C 31C0                <2> 	xor ax, ax
  7193 0000577E CD16                <2> 	int 16h
  7194 00005780 8B36[AC57]          <2> 	mov si, [videomodecache]
  7195 00005784 3C79                <2> 	cmp al, "y"
  7196 00005786 0F8564FF            <2> 	jne near nextvmode
  7197                              <2> selectedvesa:
  7198 0000578A 8B16[645A]          <2> 	mov dx, [resolutionx]
  7199 0000578E 01D2                <2> 	add dx, dx
  7200 00005790 8916[525B]          <2> 	mov [resolutionx2], dx
  7201 00005794 31D2                <2> 	xor dx, dx
  7202 00005796 31C9                <2> 	xor cx, cx
  7203 00005798 B8024F              <2> 	mov ax, 04F02h
  7204 0000579B 8B1E[AA57]          <2> 	mov bx, [vesamode]
  7205 0000579F CD10                <2> 	int 10h		;enter VESA mode
  7206 000057A1 C606[F98E]01        <2> 	mov byte [guion], 1
  7207 000057A6 E8A6A8              <2> 	call getmemorysize;get the memory map after the video is initialized
  7208 000057A9 C3                  <2> 	ret
  7209                              <2> 	
  7210 000057AA 0000                <2> vesamode dw 0
  7211 000057AC 0000                <2> videomodecache dw 0
  7212                              <2> 
  7213 000057AE 0000000000          <2> dcnm db 0,0,0,0,0
  7214 000057B3 0000                <2> dcnmend db 0,0
  7215                              <2> 
  7216                              <2> 
  7217                              <2> decshow:
  7218 000057B5 BE[AE57]            <2> 	mov si, dcnm
  7219                              <2> decclear:
  7220 000057B8 B030                <2> 	mov al, "0"
  7221 000057BA 8804                <2> 	mov [si], al
  7222 000057BC 46                  <2> 	inc si
  7223 000057BD 81FE[B357]          <2> 	cmp si, dcnmend
  7224 000057C1 76F5                <2> 	jbe decclear
  7225 000057C3 4E                  <2> 	dec si
  7226 000057C4 E81500              <2> 	call convertrm
  7227 000057C7 BE[AE57]            <2> 	mov si, dcnm
  7228                              <2> dectst:
  7229 000057CA 8A04                <2> 	mov al, [si]
  7230 000057CC 46                  <2> 	inc si
  7231 000057CD 81FE[B357]          <2> 	cmp si, dcnmend
  7232 000057D1 7704                <2> 	ja dectstend
  7233 000057D3 3C30                <2> 	cmp al, "0"
  7234 000057D5 76F3                <2> 	jbe dectst
  7235                              <2> dectstend:
  7236 000057D7 4E                  <2> 	dec si
  7237 000057D8 E8A6A8              <2> 	call printrm
  7238 000057DB C3                  <2> 	ret
  7239                              <2> 	
  7240                              <2> 	
  7241                              <2> convertrm:
  7242 000057DC 4E                  <2> 	dec si
  7243 000057DD 89F3                <2> 	mov bx, si		;place to convert into must be in si, number to convert must be in cx
  7244                              <2> cnvrtrm:
  7245 000057DF 89DE                <2> 	mov si, bx
  7246 000057E1 81EE0300            <2> 	sub si, 3
  7247 000057E5 46                  <2> ten3rm:	inc si
  7248 000057E6 81F9E803            <2> 	cmp cx, 1000
  7249 000057EA 7208                <2> 	jb ten2rm
  7250 000057EC 81E9E803            <2> 	sub cx, 1000
  7251 000057F0 FE04                <2> 	inc byte [si]
  7252 000057F2 EBEB                <2> 	jmp cnvrtrm
  7253 000057F4 46                  <2> ten2rm:	inc si
  7254 000057F5 81F96400            <2> 	cmp cx, 100
  7255 000057F9 7208                <2> 	jb ten1rm
  7256 000057FB 81E96400            <2> 	sub cx, 100
  7257 000057FF FE04                <2> 	inc byte [si]
  7258 00005801 EBDC                <2> 	jmp cnvrtrm
  7259 00005803 46                  <2> ten1rm:	inc si
  7260 00005804 81F90A00            <2> 	cmp cx, 10
  7261 00005808 7208                <2> 	jb ten0rm
  7262 0000580A 81E90A00            <2> 	sub cx, 10
  7263 0000580E FE04                <2> 	inc byte [si]
  7264 00005810 EBCD                <2> 	jmp cnvrtrm
  7265 00005812 46                  <2> ten0rm:	inc si
  7266 00005813 81F90100            <2> 	cmp cx, 1
  7267 00005817 7208                <2> 	jb tendnrm
  7268 00005819 81E90100            <2> 	sub cx, 1
  7269 0000581D FE04                <2> 	inc byte [si]
  7270 0000581F EBBE                <2> 	jmp cnvrtrm
  7271                              <2> tendnrm:
  7272 00005821 C3                  <2> 	ret
  7273                              <2> 
  7274                              <2>     char: 		    ;char must be in al
  7275 00005822 BB0700              <2>        mov bx, 07
  7276 00005825 B40E                <2> 	   mov ah, 0Eh
  7277 00005827 CD10                <2> 	   int 10h
  7278 00005829 C3                  <2> 	   ret
  7279                              <2> 
  7280 0000582A 426F6F7420696E746F- <2> bootmsg:	db "Boot into the GUI?(y/n)",0
  7281 00005833 20746865204755493F- <2>
  7282 0000583C 28792F6E2900        <2>
  7283                              <2> 
  7284                              <2> 
  7285                              <2> mcursor:
  7286 00005842 01                  <2> 	db	00000001b
  7287 00005843 81                  <2> 	db	10000001b
  7288 00005844 C1                  <2> 	db	11000001b
  7289 00005845 E1                  <2> 	db	11100001b
  7290 00005846 F1                  <2> 	db	11110001b
  7291 00005847 F9                  <2> 	db	11111001b
  7292 00005848 FD                  <2> 	db	11111101b
  7293 00005849 FF                  <2> 	db	11111111b
  7294 0000584A F9                  <2> 	db	11111001b
  7295 0000584B B9                  <2> 	db	10111001b
  7296 0000584C 39                  <2> 	db	00111001b
  7297 0000584D 1C                  <2> 	db	00011100b
  7298 0000584E 1C                  <2> 	db	00011100b
  7299 0000584F 0E                  <2> 	db	00001110b
  7300 00005850 0E                  <2> 	db	00001110b
  7301 00005851 0C                  <2> 	db	00001100b
  7302                              <2> mcursorend:
  7303                              <2> 
  7304                              <2> 
  7305                              <2> VBEMODEBLOCK:
  7306 00005852 00<rept>            <2> vbesignature 		times  4 db 0 	;VBE Signature
  7307 00005856 00<rept>            <2> vbeversion  		times  2 db 0	;VBE Version
  7308 00005858 00<rept>            <2> oemstringptr  		times  4 db 0	;Pointer to OEM String
  7309 0000585C 00<rept>            <2> capabilities 		times  4 db 0	;Capabilities of graphics cont.
  7310 00005860 00<rept>            <2> videomodeptr 		times  4 db 0	;Pointer to Video Mode List
  7311 00005864 00<rept>            <2> totalmemory   		times  2 db 0	;number of 64Kb memory blocks
  7312 00005866 00<rept>            <2> oemsoftwarerev  	times  2 db 0	;VBE implementation Software revision
  7313 00005868 00<rept>            <2> oemvendornameptr 	times  4 db 0	;Pointer to Vendor Name String
  7314 0000586C 00<rept>            <2> oemproductnameptr 	times  4 db 0	;Pointer to Product Name String
  7315 00005870 00<rept>            <2> oemproductrevptr 	times  4 db 0	;Pointer to Product Revision String
  7316 00005874 00<rept>            <2> reserved			times  222 db 0	;Reserved for VBE implementation scratch area
  7317 00005952 00<rept>            <2> oemdata 			times  256 db 0	;Data Area for OEM Strings
  7318                              <2> 
  7319                              <2> VBEMODEINFOBLOCK:
  7320                              <2> ;Mandatory information for all VBE revision
  7321 00005A52 00<rept>            <2> modeattributes   	times  2 db 0	;Mode attributes
  7322 00005A54 00                  <2> winaattributes   	times  1 db 0	;Window A attributes
  7323 00005A55 00                  <2> winbattributes   	times  1 db 0	;Window B attributes
  7324 00005A56 00<rept>            <2> wingranularity   	times  2 db 0	;Window granularity
  7325 00005A58 00<rept>            <2> winsize          	times  2 db 0	;Window size
  7326 00005A5A 00<rept>            <2> winasegment      	times  2 db 0	;Window A start segment
  7327 00005A5C 00<rept>            <2> winbsegment      	times  2 db 0	;Window B start segment
  7328 00005A5E 00<rept>            <2> winfuncptr       	times  4 db 0	;pointer to window function
  7329 00005A62 00<rept>            <2> bytesperscanline 	times  2 db 0	;Bytes per scan line
  7330                              <2> 
  7331                              <2> ;Mandatory information for VBE 1.2 and above
  7332 00005A64 00<rept>            <2> resolutionx     	times  2 db 0	;Horizontal resolution in pixel or chars
  7333 00005A66 00<rept>            <2> resolutiony	    	times  2 db 0	;Vertical resolution in pixel or chars
  7334 00005A68 00                  <2> xcharsize       	times  1 db 0	;Character cell width in pixel
  7335 00005A69 00                  <2> ycharsize       	times  1 db 0	;Character cell height in pixel
  7336 00005A6A 00                  <2> numberofplanes  	times  1 db 0	;Number of memory planes
  7337 00005A6B 00                  <2> bitsperpixel    	times  1 db 0	;Bits per pixel
  7338 00005A6C 00                  <2> numberofbanks   	times  1 db 0	;Number of banks
  7339 00005A6D 00                  <2> memorymodel     	times  1 db 0	;Memory model type
  7340 00005A6E 00                  <2> banksize        	times  1 db 0	;Bank size in KB
  7341 00005A6F 00                  <2> numberofimagepages	times  1 db 0	;Number of images
  7342 00005A70 00                  <2> reserved1       	times  1 db 0	;Reserved for page function
  7343                              <2> 
  7344                              <2> ;Direct Color fields (required for direct/6 and YUV/7 memory models)
  7345 00005A71 00                  <2> redmasksize			times  1 db 0	;Size of direct color red mask in bits
  7346 00005A72 00                  <2> redfieldposition	times  1 db 0	;Bit position of lsb of red bask
  7347 00005A73 00                  <2> greenmasksize   	times  1 db 0	;Size of direct color green mask in bits
  7348 00005A74 00                  <2> greenfieldposition	times  1 db 0	;Bit position of lsb of green bask
  7349 00005A75 00                  <2> bluemasksize		times  1 db 0	;Size of direct color blue mask in bits
  7350 00005A76 00                  <2> bluefieldposition	times  1 db 0	;Bit position of lsb of blue bask
  7351 00005A77 00                  <2> rsvdmasksize        times  1 db 0		;Size of direct color reserved mask in bits
  7352 00005A78 00                  <2> rsvdfieldposition	times  1 db 0		;Bit position of lsb of reserved bask
  7353 00005A79 00                  <2> directcolormodeinfo	times  1 db 0	;Direct color mode attributes
  7354                              <2> 
  7355                              <2> ;Mandatory information for VBE 2.0 and above
  7356 00005A7A 00<rept>            <2> physbaseptr 		times  4 db 0	;Physical address for flat frame buffer
  7357 00005A7E 00<rept>            <2> offscreenmemoffset 	times  4 db 0	;Pointer to start of off screen memory
  7358 00005A82 00<rept>            <2> offscreenmemsize 	times  2 db 0    ;Amount of off screen memory in 1Kb units
  7359 00005A84 00<rept>            <2> reserved2 			times  206 db 0  ;Remainder of ModeInfoBlock
  7360                              <2> 
  7361 00005B52 00000000            <2> resolutionx2 dd 0	;this is not part of the VBE but is necessary GUI info
  7362                              <2> VBEEND:
  7363                              <2> [BITS 32]
  7364                              <1> 	%include "source/drivers/input/mouse.asm"
  7365 00005B56 00                  <2> mousedisabled db 0
  7366                              <2> 	
  7367                              <2> 	cursorgui:
  7368 00005B57 803D[2D8A0000]01    <2> 		cmp byte [mouseon], 1
  7369 00005B5E 0F8432000000        <2> 		je near mousedaemon
  7370 00005B64 803D[F98E0000]00    <2> 		cmp byte [guion], 0
  7371 00005B6B 0F8413070000        <2> 		je near entdown
  7372                              <2> 	initmouse:
  7373 00005B71 803D[F98E0000]00    <2> 		cmp byte [guion], 0
  7374 00005B78 7405                <2> 		je noswmsposinit
  7375 00005B7A E889150000          <2> 		call switchmousepos2
  7376                              <2> 	noswmsposinit:
  7377 00005B7F E85D020000          <2> 	  	call PS2SET
  7378 00005B84 E886020000          <2> 		call ACTMOUS
  7379 00005B89 C605[2D8A0000]01    <2> 		mov byte [mouseon],1
  7380 00005B90 E89F020000          <2> 		call GETB 	;Get the responce byte of the mouse (like: Hey i am active)
  7381                              <2> 		;call GETB
  7382                              <2> 				;if the bytes are mixed up,
  7383                              <2> 				;remove this line or add another of this line.
  7384                              <2> 	nomouse:
  7385 00005B95 C3                  <2> 		ret
  7386                              <2> 		
  7387                              <2> 	mousedaemon:
  7388 00005B96 803D[2D8A0000]01    <2> 		cmp byte [mouseon], 1
  7389 00005B9D 75D2                <2> 		jne initmouse
  7390 00005B9F E464                <2> 		in al, 64h ; Status
  7391 00005BA1 A820                <2> 		test al, 20h ; PS2-Mouse?
  7392 00005BA3 0F8502000000        <2> 		jnz near moused
  7393 00005BA9 F4                  <2> 		hlt
  7394 00005BAA C3                  <2> 		ret
  7395                              <2> 	moused:
  7396 00005BAB 803D[565B0000]01    <2> 		cmp byte [mousedisabled], 1
  7397 00005BB2 74E1                <2> 		je nomouse
  7398 00005BB4 E87B020000          <2> 		  call GETB
  7399 00005BB9 88C3                <2> 		  mov  bl, al
  7400 00005BBB 80E301              <2> 		  and  bl, 1
  7401 00005BBE 881D[595E0000]      <2> 		  mov  BYTE [LBUTTON], bl
  7402 00005BC4 88C3                <2> 		  mov  bl, al
  7403 00005BC6 80E302              <2> 		  and  bl, 2
  7404 00005BC9 D0EB                <2> 		  shr  bl, 1
  7405 00005BCB 881D[5A5E0000]      <2> 		  mov  BYTE [RBUTTON], bl
  7406 00005BD1 88C3                <2> 		  mov  bl, al
  7407 00005BD3 80E304              <2> 		  and  bl, 4
  7408 00005BD6 C0EB02              <2> 		  shr  bl, 2
  7409 00005BD9 881D[5B5E0000]      <2> 		  mov  BYTE [MBUTTON], bl
  7410 00005BDF E850020000          <2> 		  call GETB
  7411 00005BE4 A2[5C5E0000]        <2> 		  mov  BYTE [XCOORD], al
  7412 00005BE9 E846020000          <2> 		  call GETB
  7413 00005BEE A2[5D5E0000]        <2> 		  mov  BYTE [YCOORD], al
  7414                              <2> 
  7415                              <2> 	showpixelcursor:
  7416 00005BF3 668B15[485D0000]    <2> 		mov dx, [mousecursorposition]
  7417 00005BFA 668B0D[4A5D0000]    <2> 		mov cx, [mousecursorposition + 2]
  7418 00005C01 668915[445D0000]    <2> 		mov [lastmouseposition], dx
  7419 00005C08 66890D[465D0000]    <2> 		mov [lastmouseposition + 2], cx
  7420 00005C0F A0[5C5E0000]        <2> 		mov al, [XCOORD]
  7421 00005C14 3C80                <2> 		cmp al, 128
  7422 00005C16 730C                <2> 		jae subxcoord
  7423 00005C18 00C0                <2> 		add al, al
  7424 00005C1A 30E4                <2> 		xor ah, ah
  7425 00005C1C 6601C2              <2> 		add dx, ax
  7426 00005C1F E90B000000          <2> 		jmp subxcoorddn
  7427                              <2> 	subxcoord:
  7428 00005C24 00C0                <2> 		add al, al
  7429 00005C26 30DB                <2> 		xor bl, bl
  7430 00005C28 28C3                <2> 		sub bl, al
  7431 00005C2A 30FF                <2> 		xor bh, bh
  7432 00005C2C 6629DA              <2> 		sub dx, bx
  7433                              <2> 	subxcoorddn:
  7434 00005C2F 8A1D[5D5E0000]      <2> 		mov bl, [YCOORD]
  7435 00005C35 30C0                <2> 		xor al, al
  7436 00005C37 28D8                <2> 		sub al, bl
  7437 00005C39 3C80                <2> 		cmp al, 128
  7438 00005C3B 730A                <2> 		jae subycoord
  7439 00005C3D 30E4                <2> 		xor ah, ah
  7440 00005C3F 6601C1              <2> 		add cx, ax
  7441 00005C42 E909000000          <2> 		jmp subycoorddn
  7442                              <2> 	subycoord:
  7443 00005C47 30DB                <2> 		xor bl, bl
  7444 00005C49 28C3                <2> 		sub bl, al
  7445 00005C4B 30FF                <2> 		xor bh, bh
  7446 00005C4D 6629D9              <2> 		sub cx, bx
  7447                              <2> 	subycoorddn:
  7448 00005C50 6681FA204E          <2> 		cmp dx, 20000
  7449 00005C55 7603                <2> 		jbe nooriginx2
  7450 00005C57 6631D2              <2> 		xor dx, dx
  7451                              <2> 	nooriginx2:
  7452 00005C5A 6681F9204E          <2> 		cmp cx, 20000
  7453 00005C5F 7603                <2> 		jbe nooriginy2
  7454 00005C61 6631C9              <2> 		xor cx, cx
  7455                              <2> 	nooriginy2:
  7456 00005C64 6681FA0000          <2> 		cmp dx, 0
  7457 00005C69 7415                <2> 		je nofixxcolumn2
  7458 00005C6B 663B15[525B0000]    <2> 		cmp dx, [resolutionx2]
  7459 00005C72 720C                <2> 		jb nofixxcolumn2
  7460 00005C74 668B15[525B0000]    <2> 		mov dx, [resolutionx2]
  7461 00005C7B 6681EA0200          <2> 		sub dx, 2
  7462                              <2> 	nofixxcolumn2:
  7463 00005C80 6681F90000          <2> 		cmp cx, 0
  7464 00005C85 7415                <2> 		je nofixyrow2
  7465 00005C87 663B0D[665A0000]    <2> 		cmp cx, [resolutiony]
  7466 00005C8E 720C                <2> 		jb nofixyrow2
  7467 00005C90 668B0D[665A0000]    <2> 		mov cx, [resolutiony]
  7468 00005C97 6681E90100          <2> 		sub cx, 1
  7469                              <2> 	nofixyrow2:
  7470 00005C9C 668915[485D0000]    <2> 		mov [mousecursorposition], dx
  7471 00005CA3 66890D[4A5D0000]    <2> 		mov [mousecursorposition + 2], cx
  7472 00005CAA 803D[F98E0000]00    <2> 		cmp byte [guion], 0
  7473 00005CB1 0F8495000000        <2> 		je near termmouse
  7474 00005CB7 E8EC130000          <2> 		call switchmousepos ;use dragging code to ensure proper icon drag
  7475 00005CBC 803D[595E0000]01    <2> 		cmp byte [LBUTTON], 1
  7476 00005CC3 0F8427250000        <2> 		je near clickicon
  7477 00005CC9 803D[5A5E0000]01    <2> 		cmp byte [RBUTTON], 1
  7478 00005CD0 0F841A250000        <2> 		je near clickicon
  7479 00005CD6 A0[DD810000]        <2> 		mov al, [pbutton]
  7480 00005CDB C705[E0810000]0000- <2> 		mov dword [dragging], 0
  7481 00005CE3 0000                <2>
  7482 00005CE5 3C00                <2> 		cmp al, 0
  7483 00005CE7 740F                <2> 		je nopreviousbutton
  7484 00005CE9 E862130000          <2> 		call clearmousecursor
  7485 00005CEE E8C9160000          <2> 		call reloadallgraphics
  7486                              <2> 	windowtermcopyend:
  7487 00005CF3 E810140000          <2> 		call switchmousepos2
  7488                              <2> 	nopreviousbutton:
  7489 00005CF8 30C0                <2> 		xor al, al
  7490 00005CFA A2[DD810000]        <2> 		mov [pbutton], al
  7491 00005CFF A2[44870000]        <2> 		mov [windrag], al
  7492 00005D04 A0[595E0000]        <2> 		mov al, [LBUTTON]
  7493 00005D09 A2[DE810000]        <2> 		mov [pLBUTTON], al
  7494 00005D0E A0[5A5E0000]        <2> 		mov al, [RBUTTON]
  7495 00005D13 A2[DF810000]        <2> 		mov [pRBUTTON], al
  7496 00005D18 31D2                <2> 		xor edx, edx
  7497 00005D1A 668B15[485D0000]    <2> 		mov dx, [mousecursorposition]
  7498 00005D21 668B0D[4A5D0000]    <2> 		mov cx, [mousecursorposition + 2]
  7499 00005D28 66BB18C7            <2> 		mov bx, 1100011100011000b
  7500 00005D2C 66B80100            <2> 		mov ax, 1
  7501 00005D30 C605[DA810000]01    <2> 		mov byte [showcursorfonton], 1
  7502 00005D37 E84A1D0000          <2> 		call showfontvesa
  7503 00005D3C C605[DA810000]00    <2> 		mov byte [showcursorfonton], 0
  7504 00005D43 C3                  <2> 		ret
  7505                              <2> 
  7506 00005D44 00000000            <2> lastmouseposition dw 0,0
  7507 00005D48 00000000            <2> mousecursorposition dw 0,0	
  7508                              <2> 
  7509                              <2> termmouse:
  7510 00005D4C BE[9ED50300]        <2> 		mov esi, videobuf
  7511 00005D51 31D2                <2> 		xor edx, edx
  7512 00005D53 668B15[445D0000]    <2> 		mov dx, [lastmouseposition]
  7513 00005D5A 668B0D[465D0000]    <2> 		mov cx, [lastmouseposition + 2]
  7514 00005D61 66A1[DF5D0000]      <2> 		mov ax, [cursorcache]
  7515 00005D67 663D0000            <2> 		cmp ax, 0
  7516 00005D6B 7425                <2> 		je nocopycursorcache
  7517 00005D6D 66C1E104            <2> 		shl cx, 4
  7518 00005D71 66C1E203            <2> 		shl dx, 3
  7519 00005D75 01D6                <2> 		add esi, edx
  7520 00005D77 6631D2              <2> 		xor dx, dx
  7521 00005D7A 8A15[DA250000]      <2> 		mov dl, [charxy]
  7522 00005D80 6641                <2> 		inc cx
  7523                              <2> termmousecplp1:
  7524 00005D82 01D6                <2> 		add esi, edx
  7525 00005D84 6649                <2> 		dec cx
  7526 00005D86 6681F90000          <2> 		cmp cx, 0
  7527 00005D8B 75F5                <2> 		jne termmousecplp1
  7528 00005D8D 29D6                <2> 		sub esi, edx
  7529 00005D8F 668906              <2> 		mov [esi], ax
  7530                              <2> nocopycursorcache:
  7531 00005D92 BE[9ED50300]        <2> 		mov esi, videobuf
  7532 00005D97 31D2                <2> 		xor edx, edx
  7533 00005D99 668B15[485D0000]    <2> 		mov dx, [mousecursorposition]
  7534 00005DA0 668B0D[4A5D0000]    <2> 		mov cx, [mousecursorposition + 2]
  7535 00005DA7 66C1E104            <2> 		shl cx, 4
  7536 00005DAB 66C1E203            <2> 		shl dx, 3
  7537 00005DAF 01D6                <2> 		add esi, edx
  7538 00005DB1 6631D2              <2> 		xor dx, dx
  7539 00005DB4 8A15[DA250000]      <2> 		mov dl, [charxy]
  7540 00005DBA 6641                <2> 		inc cx
  7541                              <2> termmousecplp2:
  7542 00005DBC 01D6                <2> 		add esi, edx
  7543 00005DBE 6649                <2> 		dec cx
  7544 00005DC0 6681F90000          <2> 		cmp cx, 0
  7545 00005DC5 75F5                <2> 		jne termmousecplp2
  7546 00005DC7 29D6                <2> 		sub esi, edx
  7547 00005DC9 668B06              <2> 		mov ax, [esi]
  7548 00005DCC 66A3[DF5D0000]      <2> 		mov [cursorcache], ax
  7549 00005DD2 B080                <2> 		mov al, 128
  7550 00005DD4 B407                <2> 		mov ah, 7
  7551 00005DD6 668906              <2> 		mov [esi], ax
  7552 00005DD9 E8D4CAFFFF          <2> 		call termcopy
  7553 00005DDE C3                  <2> 		ret
  7554 00005DDF 0000                <2> cursorcache db 0,0
  7555                              <2> 
  7556                              <2> PS2SET:
  7557 00005DE1 B0A8                <2>   mov  al, 0xa8		; enable mouse port
  7558 00005DE3 E664                <2>   out  0x64, al		; write to keyboardcontroller
  7559 00005DE5 E801000000          <2>   call CHKPRT		; check if command is progressed (demand!)
  7560 00005DEA C3                  <2> ret
  7561                              <2> 
  7562                              <2> CHKPRT:
  7563 00005DEB 66B96400            <2>   mov  cx, 100
  7564                              <2>  .again:
  7565 00005DEF E464                <2>   in   al, 0x64		; read from keyboardcontroller
  7566 00005DF1 A802                <2>   test al, 2		; Check if input buffer is empty
  7567 00005DF3 7402                <2>   je .go
  7568 00005DF5 E2F8                <2>   loop .again
  7569                              <2>  .go:
  7570 00005DF7 C3                  <2> ret
  7571                              <2> 
  7572                              <2> WMOUS:
  7573 00005DF8 B0D4                <2>   mov  al, 0xd4		; write to mouse device instead of to keyboard
  7574 00005DFA E664                <2>   out  0x64, al		; write to keyboardcontroller
  7575 00005DFC E8EAFFFFFF          <2>   call CHKPRT		; check if command is progressed (demand!)
  7576 00005E01 C3                  <2> ret
  7577                              <2> 
  7578                              <2> MBUFFUL:
  7579 00005E02 66B96400            <2>   mov cx, 100
  7580                              <2>  .mn:
  7581 00005E06 E464                <2>   in   al, 0x64		; read from keyboardcontroller
  7582 00005E08 A820                <2>   test al, 0x20		; check if mouse output buffer is full
  7583 00005E0A 7402                <2>   jz  .mnn
  7584 00005E0C E2F8                <2>   loop .mn
  7585                              <2>  .mnn:
  7586 00005E0E C3                  <2> ret
  7587                              <2> 
  7588                              <2> 
  7589                              <2> ACTMOUS:
  7590 00005E0F E8E4FFFFFF          <2>   call WMOUS
  7591 00005E14 B0F4                <2>   mov  al, 0xf4 	; Command to activate mouse itselve (Stream mode)
  7592 00005E16 E660                <2>   out  0x60, al		; write ps/2 controller output port (activate mouse)
  7593 00005E18 E8CEFFFFFF          <2>   call CHKPRT		; check if command is progressed (demand!)
  7594 00005E1D E801000000          <2>   call CHKMOUS		; check if a byte is available
  7595 00005E22 C3                  <2> ret
  7596                              <2> 
  7597                              <2> CHKMOUS:
  7598 00005E23 B300                <2>   mov  bl, 0
  7599 00005E25 66B96400            <2>   mov cx, 100
  7600                              <2>  .vrd:
  7601 00005E29 E464                <2>   in   al, 0x64		; read from keyboardcontroller
  7602 00005E2B A801                <2>   test al, 1		; check if controller buffer (60h) has data
  7603 00005E2D 7504                <2>   jnz .yy
  7604 00005E2F E2F8                <2>   loop .vrd
  7605 00005E31 B301                <2>   mov  bl, 1
  7606                              <2>  .yy:
  7607 00005E33 C3                  <2> ret
  7608                              <2> 
  7609                              <2> GETB:
  7610                              <2>  .cagain:
  7611 00005E34 E8EAFFFFFF          <2>   call CHKMOUS		; check if a byte is available
  7612 00005E39 08DB                <2>   or bl, bl
  7613 00005E3B 75F7                <2>   jnz .cagain
  7614 00005E3D B0AD                <2>   mov  al, 0xad		; Disable Keyboard
  7615 00005E3F E664                <2>   out  0x64, al		; write to keyboardcontroller
  7616 00005E41 E8A5FFFFFF          <2>   call CHKPRT		; check if command is progressed (demand!)
  7617 00005E46 6631C0              <2>   xor  ax, ax
  7618 00005E49 E460                <2>   in   al, 0x60		; read ps/2 controller output port (mousebyte)
  7619 00005E4B 88C2                <2>   mov  dl, al
  7620 00005E4D B0AE                <2>   mov  al, 0xae		; Enable Keyboard
  7621 00005E4F E664                <2>   out  0x64, al		; write to keyboardcontroller
  7622 00005E51 E895FFFFFF          <2>   call CHKPRT		; check if command is progressed (demand!)
  7623 00005E56 88D0                <2>   mov  al, dl
  7624 00005E58 C3                  <2> ret
  7625                              <2> 
  7626 00005E59 00                  <2> LBUTTON db 0x00	;	Left   button status 1=PRESSED 0=RELEASED
  7627 00005E5A 00                  <2> RBUTTON db 0x00	;	Right  button status 1=PRESSED 0=RELEASED
  7628 00005E5B 00                  <2> MBUTTON db 0x00	;	Middle button status 1=PRESSED 0=RELEASED
  7629 00005E5C 00                  <2> XCOORD  db 0x00	;	the moved distance  (horizontal)
  7630 00005E5D 00                  <2> YCOORD  db 0x00	;	the moved distance  (vertical)
  7631                              <1> %endif
  7632                              <1> %include "source/drivers/sound/pcspkr.asm"
  7633                              <2> ;PC Speaker Drivers
  7634                              <2> PCSpeakerRAW:
  7635 00005E5E 60                  <2> 	pusha
  7636                              <2> nosoundrep:
  7637 00005E5F 8B35[72020000]      <2> 	mov esi, [soundpos]
  7638 00005E65 31C9                <2> 	xor ecx, ecx
  7639 00005E67 668B0D[70020000]    <2> 	mov cx, [soundrepititions]
  7640 00005E6E 6681F90000          <2> 	cmp cx, 0
  7641 00005E73 0F8548000000        <2> 	jne near donesetpitch
  7642 00005E79 668B0E              <2> 	mov cx, [esi]
  7643 00005E7C 668B5E02            <2> 	mov bx, [esi + 2]
  7644 00005E80 66890D[70020000]    <2> 	mov [soundrepititions], cx
  7645 00005E87 81C604000000        <2> 	add esi, 4
  7646 00005E8D 8935[72020000]      <2> 	mov [soundpos], esi
  7647 00005E93 3B35[76020000]      <2> 	cmp esi, [soundendpos]
  7648 00005E99 7735                <2> 	ja stopsound
  7649 00005E9B 66813D[70020000]00- <2> 	cmp word [soundrepititions], 0
  7650 00005EA3 00                  <2>
  7651 00005EA4 74B9                <2> 	je nosoundrep
  7652 00005EA6 6681FB0000          <2> 	cmp bx, 0
  7653 00005EAB 740F                <2> 	je nosoundplay
  7654 00005EAD E840000000          <2> 	call setpitch
  7655 00005EB2 E849000000          <2> 	call startsound
  7656 00005EB7 E905000000          <2> 	jmp donesetpitch
  7657                              <2> nosoundplay:
  7658 00005EBC E846000000          <2> 	call killsound
  7659                              <2> donesetpitch:
  7660 00005EC1 6649                <2> 	dec cx
  7661 00005EC3 66890D[70020000]    <2> 	mov [soundrepititions], cx
  7662 00005ECA 61                  <2> 	popa
  7663 00005ECB E9DEA3FFFF          <2> 	jmp timerinterrupt
  7664                              <2> stopsound:
  7665 00005ED0 31C0                <2> 	xor eax, eax
  7666 00005ED2 66A3[70020000]      <2> 	mov [soundrepititions], ax
  7667 00005ED8 A2[6F020000]        <2> 	mov [soundon], al
  7668 00005EDD A3[72020000]        <2> 	mov [soundpos], eax
  7669 00005EE2 A3[76020000]        <2> 	mov [soundendpos], eax
  7670 00005EE7 E81B000000          <2> 	call killsound
  7671 00005EEC 61                  <2> 	popa
  7672 00005EED E9BCA3FFFF          <2> 	jmp timerinterrupt
  7673                              <2> 
  7674                              <2> 
  7675                              <2> setpitch:
  7676 00005EF2 B0B6                <2> 	mov al, 0xB6
  7677 00005EF4 E643                <2> 	out 0x43, al
  7678 00005EF6 6689D8              <2> 	mov ax, bx
  7679 00005EF9 E642                <2> 	out 0x42, al
  7680 00005EFB 88E0                <2> 	mov al, ah
  7681 00005EFD E642                <2> 	out 0x42, al
  7682 00005EFF C3                  <2> 	ret
  7683                              <2> startsound:
  7684 00005F00 E461                <2> 	in al, 0x61
  7685 00005F02 0C03                <2> 	or al, 3
  7686 00005F04 E661                <2> 	out 0x61, al
  7687 00005F06 C3                  <2> 	ret
  7688                              <2> killsound:
  7689 00005F07 E461                <2> 	in al, 0x61
  7690 00005F09 24FC                <2> 	and al, 0xFC
  7691 00005F0B E661                <2> 	out 0x61, al
  7692 00005F0D C3                  <2> 	ret
  7693                              <2> 	
  7694                              <1> %ifdef sound.included
  7695                              <1> 	%include "source/drivers/sound/sblaster.asm"
  7696                              <2> ;Sound Blaster Drivers
  7697                              <2> sblaster:
  7698                              <2> .init:
  7699 00005F0E E8E1010000          <2> 		call ResetDSP			;If the system is Sound Blaster 16 compatible, reset the DSP
  7700 00005F13 A2[4E610000]        <2> 		mov [SoundBlaster], al	;if the reset worked, show an available card
  7701 00005F18 3C00                <2> 		cmp al, 0
  7702 00005F1A 7418                <2> 		je .noinit
  7703 00005F1C B0D1                <2> 		mov	al,0D1h 		; turn speaker(s) on
  7704 00005F1E E805020000          <2> 		call WriteDSP
  7705 00005F23 B088                <2> 		mov	al,088h 		; Left = 8, Right = 8 (15-highest)
  7706 00005F25 E8BB010000          <2> 		call MstrVol 		; L = Hi Nibble, R = Lo Nibble
  7707 00005F2A BE[355F0000]        <2> 		mov esi, .initmsg
  7708 00005F2F E828BEFFFF          <2> 		call print
  7709                              <2> .noinit:
  7710 00005F34 C3                  <2> 		ret
  7711 00005F35 5342313620496E6974- <2> .initmsg db "SB16 Initialized.",10,0
  7712 00005F3E 69616C697A65642E0A- <2>
  7713 00005F47 00                  <2>
  7714                              <2> sblaster.cont: ;this function goes to the next available portion of a sound, if necessary
  7715 00005F48 813D[39610000]0000- <2> 	cmp dword [Length0], 0
  7716 00005F50 0000                <2>
  7717 00005F52 0F8462000000        <2> 	je near .done
  7718 00005F58 FF0D[39610000]      <2> 	dec dword [Length0]
  7719 00005F5E E908000000          <2> 	jmp .notodd
  7720                              <2> .oddlength:
  7721 00005F63 31C9                <2> 	xor ecx, ecx
  7722 00005F65 880D[38610000]      <2> 	mov [OddLength], cl
  7723                              <2> .notodd:
  7724 00005F6B 8B35[3F610000]      <2> 	mov esi, [NextMemLoc]
  7725 00005F71 31C9                <2> 	xor ecx, ecx
  7726 00005F73 668B0D[3D610000]    <2> 	mov cx, [Length1]
  7727 00005F7A D1E9                <2> 	shr ecx, 1
  7728 00005F7C 6641                <2> 	inc cx
  7729 00005F7E 31DB                <2> 	xor ebx, ebx
  7730 00005F80 668B1D[47610000]    <2> 	mov bx, [SegLoc]
  7731 00005F87 6601CB              <2> 	add bx, cx
  7732 00005F8A 66891D[47610000]    <2> 	mov [SegLoc], bx
  7733 00005F91 81C300000800        <2> 	add ebx, 0x80000 ;linear address of sb buffer
  7734 00005F97 8935[43610000]      <2> 	mov [MemLoc], esi
  7735 00005F9D 89C8                <2> 	mov eax, ecx
  7736 00005F9F 01F0                <2> 	add eax, esi
  7737 00005FA1 A3[3F610000]        <2> 	mov [NextMemLoc], eax
  7738 00005FA6 E833000000          <2> 	call DMACopy
  7739                              <2> 	;call DMAPlay
  7740 00005FAB E8E0000000          <2> 	call PlayDSP
  7741 00005FB0 66BA2E02            <2> 	mov dx, (BasePort+0xE)
  7742 00005FB4 EC                  <2> 	in al, dx ;acknowledge the interrupt 
  7743 00005FB5 E9B2A3FFFF          <2> 	jmp handled2 ;it is part of an interrupt routine
  7744                              <2> .done:
  7745 00005FBA 803D[38610000]01    <2> 	cmp byte [OddLength], 1
  7746 00005FC1 74A0                <2> 	je .oddlength
  7747 00005FC3 31C0                <2> 	xor eax, eax
  7748 00005FC5 66A3[3D610000]      <2> 	mov [Length1], ax
  7749 00005FCB 66B8D000            <2> 	mov ax, 0xD0
  7750 00005FCF E854010000          <2> 	call WriteDSP
  7751 00005FD4 66BA2E02            <2> 	mov dx, (BasePort+0xE)
  7752 00005FD8 EC                  <2> 	in al, dx ;acknowledge the interrupt 
  7753 00005FD9 E98EA3FFFF          <2> 	jmp handled2
  7754                              <2> 	
  7755                              <2> DMACopy:
  7756 00005FDE 66B80800            <2> 		mov ax, LINEAR_SEL
  7757 00005FE2 8EE0                <2> 		mov fs, ax
  7758 00005FE4 C1E902              <2> 		shr ecx, 2
  7759                              <2> .loop:
  7760 00005FE7 8B06                <2> 		mov eax, [esi]
  7761 00005FE9 648903              <2> 		mov [fs:ebx], eax
  7762 00005FEC 81C604000000        <2> 		add esi, 4
  7763 00005FF2 81C304000000        <2> 		add ebx, 4
  7764 00005FF8 E2ED                <2> 		loop .loop
  7765 00005FFA 66B83000            <2> 		mov ax, NEW_DATA_SEL
  7766 00005FFE 8EE0                <2> 		mov fs, ax
  7767 00006000 C3                  <2> 		ret
  7768                              <2> 		
  7769                              <2> 
  7770                              <2> DMAPlay:    ;uses eax ebx edx
  7771 00006001 C605[49610000]00    <2> 		mov	byte [Page1],00h
  7772                              <2> 
  7773 00006008 B005                <2> 		mov	al,(Channel+4)
  7774 0000600A 66BA0A00            <2> 		mov	dx,0Ah
  7775 0000600E EE                  <2> 		out	dx,al
  7776 0000600F 30C0                <2> 		xor	al,al
  7777 00006011 66BA0C00            <2> 		mov	dx,0Ch
  7778 00006015 EE                  <2> 		out	dx,al
  7779 00006016 B059                <2> 		mov	al,ModeReg
  7780 00006018 66BA0B00            <2> 		mov	dx,0Bh
  7781 0000601C EE                  <2> 		out	dx,al
  7782 0000601D B800000800          <2> 		mov	eax,0x80000
  7783 00006022 66BA0200            <2> 		mov	dx,AddPort
  7784 00006026 EE                  <2> 		out	dx,al
  7785 00006027 86C4                <2> 		xchg al,ah
  7786 00006029 EE                  <2> 		out	dx,al
  7787 0000602A B800000800          <2> 		mov	eax,0x80000
  7788 0000602F 89C2                <2> 		mov	edx,eax
  7789 00006031 2500000100          <2> 		and	eax,65536
  7790 00006036 7406                <2> 		jz	MemLocN1
  7791 00006038 FE05[49610000]      <2> 		inc	byte [Page1]
  7792                              <2> MemLocN1:
  7793 0000603E 89D0                <2> 		mov	eax,edx
  7794 00006040 2500000200          <2> 		and	eax,131072
  7795 00006045 7407                <2> 		jz	MemLocN2
  7796 00006047 8005[49610000]02    <2> 		add	byte [Page1],02
  7797                              <2> MemLocN2:
  7798 0000604E 89D0                <2> 		mov	eax,edx
  7799 00006050 2500000400          <2> 		and	eax,262144
  7800 00006055 7407                <2> 		jz	MemLocN3
  7801 00006057 8005[49610000]04    <2> 		add	byte [Page1],04
  7802                              <2> MemLocN3:
  7803 0000605E 89D0                <2> 		mov	eax,edx
  7804 00006060 2500000800          <2> 		and	eax,524288
  7805 00006065 7407                <2> 		jz	MemLocN4
  7806 00006067 8005[49610000]08    <2> 		add	byte [Page1],08
  7807                              <2> MemLocN4:
  7808 0000606E 66BA8300            <2> 		mov	dx,PgPort
  7809 00006072 A0[49610000]        <2> 		mov	al,[Page1]
  7810 00006077 EE                  <2> 		out	dx,al
  7811 00006078 66BA0300            <2> 		mov	dx,LenPort
  7812 0000607C 66A1[3D610000]      <2> 		mov	ax,[Length1]
  7813 00006082 6648                <2> 		dec ax
  7814 00006084 EE                  <2> 		out	dx,al
  7815 00006085 86C4                <2> 		xchg al,ah
  7816 00006087 EE                  <2> 		out	dx,al
  7817 00006088 66BA0A00            <2> 		mov	dx,0Ah
  7818 0000608C B001                <2> 		mov	al,Channel
  7819 0000608E EE                  <2> 		out	dx,al
  7820 0000608F C3                  <2> 		ret
  7821                              <2> 		
  7822                              <2> PlayDSP:
  7823 00006090 B040                <2> 		mov	al,40h
  7824 00006092 E891000000          <2> 		call WriteDSP
  7825 00006097 31D2                <2> 		xor	edx,edx
  7826 00006099 B840420F00          <2> 		mov	eax,1000000
  7827 0000609E 8B1D[4A610000]      <2> 		mov	ebx,[Freq]
  7828 000060A4 803D[37610000]00    <2> 		cmp byte [Stereo], 0
  7829 000060AB 7402                <2> 		je .nost
  7830 000060AD D1E3                <2> 		shl ebx, 1
  7831                              <2> .nost:
  7832 000060AF F7F3                <2> 		div	ebx
  7833 000060B1 89C3                <2> 		mov	ebx,eax
  7834 000060B3 B800010000          <2> 		mov	eax,256
  7835 000060B8 29D8                <2> 		sub	eax,ebx
  7836 000060BA E869000000          <2> 		call WriteDSP
  7837 000060BF B014                <2> 		mov	al,14h	;write the mode
  7838 000060C1 803D[37610000]00    <2> 		cmp byte [Stereo], 0
  7839 000060C8 7400                <2> 		je .nost2
  7840                              <2> 		
  7841                              <2> .nost2:
  7842 000060CA E859000000          <2> 		call WriteDSP
  7843 000060CF 66A1[3D610000]      <2> 		mov	ax,[Length1]
  7844 000060D5 66D1E8              <2> 		shr ax, 1
  7845 000060D8 E84B000000          <2> 		call WriteDSP
  7846 000060DD 86C4                <2> 		xchg al,ah
  7847 000060DF E844000000          <2> 		call WriteDSP
  7848 000060E4 C3                  <2> 		ret
  7849                              <2> 
  7850                              <2> MstrVol:    ;uses ax dx
  7851 000060E5 6650                <2> 	   push ax
  7852 000060E7 66BA2402            <2> 	   mov	dx,(BasePort+4)
  7853 000060EB B022                <2> 	   mov	al,22h
  7854 000060ED EE                  <2> 	   out	dx,al
  7855 000060EE 6658                <2> 	   pop	ax
  7856 000060F0 6642                <2> 	   inc	dx
  7857 000060F2 EE                  <2> 	   out	dx,al
  7858 000060F3 C3                  <2> 	   ret
  7859                              <2> 	   
  7860                              <2> ResetDSP:   ; uses cx dx
  7861 000060F4 66BA2602            <2> 			mov	dx,(BasePort+6)
  7862 000060F8 B001                <2> 			mov	al,01
  7863 000060FA EE                  <2> 			out	dx,al
  7864 000060FB 66B93200            <2> 			mov	cx,50
  7865 000060FF EC                  <2> WaitIt1:	in	al,dx
  7866 00006100 E2FD                <2> 			loop WaitIt1
  7867 00006102 30C0                <2> 			xor	al,al
  7868 00006104 EE                  <2> 			out	dx,al
  7869 00006105 66B93200            <2> 			mov	cx,50
  7870 00006109 EC                  <2> WaitIt2:	in	al,dx
  7871 0000610A E2FD                <2> 			loop WaitIt2
  7872 0000610C B4FF                <2> 			mov	ah,0FFh 		; part of Return Code
  7873 0000610E 66BA2E02            <2> 			mov	dx,(BasePort+14)
  7874 00006112 EC                  <2> 			in	al,dx
  7875 00006113 2480                <2> 			and	al,80h
  7876 00006115 3C80                <2> 			cmp	al,80h
  7877 00006117 750C                <2> 			jne	ResetErr
  7878 00006119 66BA2A02            <2> 			mov	dx,(BasePort+10)
  7879 0000611D EC                  <2> 			in	al,dx
  7880 0000611E 3CAA                <2> 			cmp	al,0AAh
  7881 00006120 7503                <2> 			jne	ResetErr
  7882 00006122 B001                <2> ResetOK:	mov al, 1		; return ax = 0 if reset ok
  7883 00006124 C3                  <2> 			ret
  7884 00006125 30C0                <2> ResetErr:	xor al, al
  7885 00006127 C3                  <2> 			ret
  7886                              <2> 
  7887                              <2> WriteDSP:   ;uses ax dx
  7888 00006128 6650                <2> 		push ax
  7889 0000612A 66BA2C02            <2> 		mov	dx,(BasePort+12)
  7890 0000612E EC                  <2> WaitIt:	in	al,dx
  7891 0000612F 2480                <2> 		and	al,80h
  7892 00006131 75FB                <2> 		jnz	WaitIt
  7893 00006133 6658                <2> 		pop	ax
  7894 00006135 EE                  <2> 		out	dx,al
  7895 00006136 C3                  <2> 		ret
  7896                              <2> 
  7897 00006137 00                  <2> Stereo db 0
  7898 00006138 00                  <2> OddLength db 0
  7899 00006139 00000000            <2> Length0 dd	0
  7900 0000613D 0000                <2> Length1	dw  0
  7901 0000613F 00000000            <2> NextMemLoc dd 0
  7902 00006143 00000000            <2> MemLoc	dd  0
  7903 00006147 0000                <2> SegLoc  dw 0
  7904 00006149 00                  <2> Page1	db  0
  7905 0000614A 00000000            <2> Freq	dd	0
  7906                              <2> PgPort	equ 83h
  7907                              <2> AddPort	equ 02h
  7908                              <2> LenPort	equ 03h
  7909                              <2> ModeReg	equ 59h
  7910                              <2> Channel	equ 01h
  7911                              <2> BasePort	equ 220h
  7912 0000614E 00                  <2> SoundBlaster	db 0
  7913                              <1> %endif
  7914                              <1> %ifdef io.serial
  7915                              <1> 	%include "source/drivers/input/serial.asm"
  7916                              <1> %else
  7917                              <1> 	%include "source/drivers/input/keyboard.asm"
  7918 0000614F 00                  <2> specialkey db 0
  7919                              <2> ;charregion db 0
  7920                              <2> waitforinput:		;this is basically the idle process
  7921                              <2> 					;this halts the cpu for a small amount of time and then sees if there was a keypress
  7922                              <2> 					;this lets the cpu stay at close to 0% instead of 100%
  7923 00006150 6631C0              <2> 	xor ax, ax
  7924 00006153 A0[D26C0000]        <2> 	mov al, [threadson]
  7925 00006158 8825[D26C0000]      <2> 	mov [threadson], ah
  7926 0000615E FB                  <2> 	sti
  7927 0000615F F4                  <2> 	hlt
  7928 00006160 A2[D26C0000]        <2> 	mov [threadson], al
  7929 00006165 66813D[B8230000]00- <2> 	cmp word [trans], 0
  7930 0000616D 00                  <2>
  7931 0000616E 7401                <2> 	je getkey
  7932 00006170 C3                  <2> 	ret
  7933                              <2> getkey:
  7934 00006171 31C0                <2> 		xor eax, eax
  7935 00006173 A2[4F610000]        <2> 		mov [specialkey], al
  7936 00006178 A3[B4230000]        <2> 		mov [lastkey], eax
  7937 0000617D E464                <2> 		in al, 64h ; Status
  7938                              <2> 	%ifdef gui.included
  7939 0000617F A820                <2> 		test al, 20h ; PS2-Mouse?
  7940 00006181 0F8524FAFFFF        <2> 		jnz near moused
  7941                              <2> 	%endif
  7942 00006187 A801                <2> 		test al, 1 
  7943 00006189 74C5                <2> 		jz waitforinput ; if output buffer full or no keypress, jump to idle process
  7944                              <2> 	calckey:
  7945 0000618B E460                <2> 		in al, 60h
  7946 0000618D 30E4                <2> 		xor ah, ah
  7947 0000618F 6689C3              <2> 		mov bx, ax
  7948 00006192 66A3[B6230000]      <2> 		mov [lastkey + 2], ax
  7949 00006198 BF[27630000]        <2> 		mov edi, scancode
  7950                              <2> 	searchscan: 
  7951 0000619D 80FB3A              <2> 		cmp bl, 3Ah
  7952 000061A0 7314                <2> 		jae scanother
  7953 000061A2 C1E004              <2> 		shl eax, 4
  7954 000061A5 01C7                <2> 		add edi, eax
  7955 000061A7 668B07              <2> 		mov ax, [edi]
  7956 000061AA 663D0000            <2> 		cmp ax, 0
  7957 000061AE 7406                <2> 		je scanother
  7958 000061B0 E9D0000000          <2> 		jmp scanfound
  7959 000061B5 00                  <2> uppercase db 0
  7960                              <2> scanother:
  7961 000061B6 6631C0              <2> 		xor ax, ax
  7962 000061B9 66A3[B4230000]      <2> 		mov [lastkey], ax
  7963 000061BF 80FBE0              <2> 		cmp bl, 0E0h
  7964 000061C2 0F8477000000        <2> 		je near getkeyspecial
  7965 000061C8 803D[4F610000]E0    <2> 		cmp byte [specialkey], 0xE0
  7966 000061CF 7525                <2> 		jne nospecialkey
  7967 000061D1 80FB38              <2> 		cmp bl, 38h
  7968 000061D4 0F849A000000        <2> 		je near alton
  7969 000061DA 80FBB8              <2> 		cmp bl, 0B8h
  7970 000061DD 0F8499000000        <2> 		je near altoff
  7971 000061E3 80FB1D              <2> 		cmp bl, 1Dh
  7972 000061E6 0F8478000000        <2> 		je near ctron
  7973 000061EC 80FB9D              <2> 		cmp bl, 9Dh
  7974 000061EF 0F8477000000        <2> 		je near ctroff
  7975 000061F5 C3                  <2> 		ret
  7976                              <2> nospecialkey:
  7977 000061F6 80FB2A              <2> 		cmp bl, 2Ah
  7978 000061F9 0F8455000000        <2> 		je near shifton
  7979 000061FF 80FB36              <2> 		cmp bl, 36h
  7980 00006202 0F844C000000        <2> 		je near shifton
  7981 00006208 80FB1C              <2> 		cmp bl, 1Ch
  7982 0000620B 0F8473000000        <2> 		je near entdown
  7983 00006211 80FBAA              <2> 		cmp bl, 0AAh
  7984 00006214 0F8442000000        <2> 		je near shiftoff
  7985 0000621A 80FBB6              <2> 		cmp bl, 0B6h
  7986 0000621D 0F8439000000        <2> 		je near shiftoff
  7987 00006223 80FB3A              <2> 		cmp bl, 3Ah
  7988 00006226 0F84A7000000        <2> 		je near capslock
  7989 0000622C 80FB45              <2> 		cmp bl, 0x45
  7990 0000622F 0F84AF000000        <2> 		je near numlock
  7991 00006235 80FB46              <2> 		cmp bl, 0x46
  7992 00006238 0F84BE000000        <2> 		je near scrolllock
  7993 0000623E C3                  <2> 		ret
  7994                              <2> 	getkeyspecial:
  7995 0000623F C605[4F610000]E0    <2> 		mov byte [specialkey], 0xE0
  7996 00006246 E940FFFFFF          <2> 		jmp calckey
  7997                              <2> 	shift:
  7998 0000624B A0[B5610000]        <2> 		mov al, [uppercase]
  7999 00006250 3C01                <2> 		cmp al, 1
  8000 00006252 7308                <2> 		jae shiftoff
  8001                              <2> 	shifton:
  8002 00006254 C605[B5610000]01    <2> 		mov byte [uppercase], 1
  8003 0000625B C3                  <2> 		ret
  8004                              <2> 	shiftoff:
  8005 0000625C C605[B5610000]00    <2> 		mov byte [uppercase], 0
  8006 00006263 C3                  <2> 		ret
  8007                              <2> 	ctron:
  8008 00006264 C605[D2620000]01    <2> 		mov byte [ctrkey], 1
  8009 0000626B C3                  <2> 		ret
  8010                              <2> 	ctroff:
  8011 0000626C C605[D2620000]00    <2> 		mov byte [ctrkey], 0
  8012 00006273 C3                  <2> 		ret
  8013                              <2> 	alton:
  8014 00006274 C605[D1620000]01    <2> 		mov byte [altkey], 1
  8015 0000627B C3                  <2> 		ret
  8016                              <2> 	altoff:
  8017 0000627C C605[D1620000]00    <2> 		mov byte [altkey], 0
  8018 00006283 C3                  <2> 		ret
  8019                              <2> 	entdown:
  8020 00006284 C3                  <2> 		ret
  8021                              <2> scanfound:
  8022 00006285 81C708000000        <2> 		add edi, 8
  8023 0000628B 803D[D2620000]01    <2> 		cmp byte [ctrkey], 1
  8024 00006292 7306                <2> 		jae ctrlin
  8025 00006294 81EF08000000        <2> 		sub edi, 8
  8026                              <2> 	ctrlin:
  8027 0000629A 81C704000000        <2> 		add edi, 4
  8028 000062A0 803D[D1620000]01    <2> 		cmp byte [altkey], 1
  8029 000062A7 7306                <2> 		jae altin
  8030 000062A9 81EF04000000        <2> 		sub edi, 4
  8031                              <2> 	altin:
  8032 000062AF 81C702000000        <2> 		add edi, 2
  8033 000062B5 803D[B5610000]01    <2> 		cmp byte [uppercase], 1
  8034 000062BC 7306                <2> 		jae uppercaseon
  8035 000062BE 81EF02000000        <2> 		sub edi, 2
  8036                              <2> 	uppercaseon:
  8037 000062C4 668B07              <2> 		mov ax,[edi]
  8038 000062C7 66A3[B4230000]      <2> 		mov [lastkey], ax
  8039 000062CD C3                  <2> 		ret
  8040                              <2> 		
  8041 000062CE 00                  <2> keyboardstatus db 0
  8042 000062CF 00                  <2> numlockstatus db 0
  8043 000062D0 00                  <2> scrolllockstatus db 0
  8044 000062D1 00                  <2> altkey db 0
  8045 000062D2 00                  <2> ctrkey db 0
  8046                              <2> 	capslock:
  8047 000062D3 8035[CE620000]04    <2> 		xor byte [keyboardstatus], 00000100b
  8048 000062DA E835000000          <2> 		call updatekblights
  8049 000062DF E967FFFFFF          <2> 		jmp shift
  8050                              <2> 		
  8051                              <2> 	numlock:
  8052 000062E4 8035[CE620000]02    <2> 		xor byte [keyboardstatus], 00000010b
  8053 000062EB 8035[CF620000]01    <2> 		xor byte [numlockstatus], 1
  8054 000062F2 E81D000000          <2> 		call updatekblights
  8055 000062F7 E975FEFFFF          <2> 		jmp getkey
  8056                              <2> 	
  8057                              <2> 	scrolllock:
  8058 000062FC 8035[CE620000]01    <2> 		xor byte [keyboardstatus], 00000001b
  8059 00006303 8035[D0620000]01    <2> 		xor byte [scrolllockstatus], 1
  8060 0000630A E805000000          <2> 		call updatekblights
  8061 0000630F E95DFEFFFF          <2> 		jmp getkey
  8062                              <2> 		
  8063                              <2> 	updatekblights:
  8064 00006314 B0ED                <2> 		mov al, 0xED
  8065 00006316 66BA6000            <2> 		mov dx, 0x60
  8066 0000631A EE                  <2> 		out dx, al
  8067                              <2> 	chkkbdack:
  8068 0000631B EC                  <2> 		in al, dx
  8069 0000631C 3CFA                <2> 		cmp al, 0xFA
  8070 0000631E 75FB                <2> 		jne chkkbdack
  8071 00006320 A0[CE620000]        <2> 		mov al, [keyboardstatus]
  8072 00006325 EE                  <2> 		out dx, al
  8073 00006326 C3                  <2> 		ret
  8074                              <2> 		
  8075                              <2> scancode:
  8076                              <2> 	;key, KEY, alt key, ALT KEY, ctrl key, CTRL KEY, ctrl-alt, CTRL-ALT
  8077 00006327 000000000000000000- <2> 	dw 0,0,0,0,0,0,0,0
  8078 00006330 00000000000000      <2>
  8079 00006337 000000000000000000- <2> 	dw 0,0,0,0,0,0,0,0
  8080 00006340 00000000000000      <2>
  8081 00006347 31002100A1003C2000- <2> 	dw '1','!',0xA1,0x203C,0,0,0,0
  8082 00006350 00000000000000      <2>
  8083 00006357 32004000B2001A2200- <2> 	dw '2','@',0xB2,0x221A,0,0,0,0
  8084 00006360 00000000000000      <2>
  8085 00006367 33002300B3002B2200- <2> 	dw '3','#',0xB3,0x222B,0,0,0,0
  8086 00006370 00000000000000      <2>
  8087 00006377 34002400A300A20000- <2> 	dw '4','$',0xA3,0xA2,0,0,0,0
  8088 00006380 00000000000000      <2>
  8089 00006387 35002500AC20000000- <2> 	dw '5','%',0x20AC,0,0,0,0,0
  8090 00006390 00000000000000      <2>
  8091 00006397 36005E00BC007F2000- <2> 	dw '6','^',0xBC,0x207F,0,0,0,0
  8092 000063A0 00000000000000      <2>
  8093 000063A7 37002600BD00000000- <2> 	dw '7','&',0xBD,0,0,0,0,0
  8094 000063B0 00000000000000      <2>
  8095 000063B7 38002A001E22950000- <2> 	dw '8','*',0x221E,0x95,0,0,0,0
  8096 000063C0 00000000000000      <2>
  8097 000063C7 39002800AE00990000- <2> 	dw '9','(',0xAE,0x99,0,0,0,0
  8098 000063D0 00000000000000      <2>
  8099 000063D7 30002900A900000000- <2> 	dw '0',')',0xA9,0,0,0,0,0
  8100 000063E0 00000000000000      <2>
  8101 000063E7 2D005F00A500B10000- <2> 	dw '-','_',0xA5,0xB1,0,0,0,0
  8102 000063F0 00000000000000      <2>
  8103 000063F7 3D002B00F700482200- <2> 	dw '=','+',0xF7,0x2248,0,0,0,0
  8104 00006400 00000000000000      <2>
  8105 00006407 080008000000000000- <2> 	dw 8,8,0,0,0,0,0,0
  8106 00006410 00000000000000      <2>
  8107 00006417 000000000000000000- <2> 	dw 0,0,0,0,0,0,0,0
  8108 00006420 00000000000000      <2>
  8109 00006427 71005100E400C4003B- <2> 	dw 'q','Q',0xE4,0xC4,';',':',0x439,0x419
  8110 0000642F 003A0039041904      <2>
  8111 00006437 77005700E500C500C2- <2> 	dw 'w','W',0xE5,0xC5,0x3C2,0,0x446,0x426
  8112 00006440 03000046042604      <2>
  8113 00006447 65004500E900C900B5- <2> 	dw 'e','E',0xE9,0xC9,0x3B5,0x395,0x443,0x423
  8114 00006450 03950343042304      <2>
  8115 00006457 72005200EB00E800C1- <2> 	dw 'r','R',0xEB,0xE8,0x3C1,0x3A1,0x43A,0x41A
  8116 00006460 03A1033A041A04      <2>
  8117 00006467 74005400FC00DC00C4- <2> 	dw 't','T',0xFC,0xDC,0x3C4,0x3A4,0x435,0x415
  8118 00006470 03A40335041504      <2>
  8119 00006477 79005900FF009F00C5- <2> 	dw 'y','Y',0xFF,0x9F,0x3C5,0x3A5,0x43D,0x41D
  8120 00006480 03A5033D041D04      <2>
  8121 00006487 75005500FA00F900B8- <2> 	dw 'u','U',0xFA,0xF9,0x3B8,0x398,0x433,0x413
  8122 00006490 03980333041304      <2>
  8123 00006497 69004900ED00EC00B9- <2> 	dw 'i','I',0xED,0xEC,0x3B9,0x399,0x448,0x428
  8124 000064A0 03990348042804      <2>
  8125 000064A7 6F004F00F300F200BF- <2> 	dw 'o','O',0xF3,0xF2,0x3BF,0x39F,0x449,0x429
  8126 000064B0 039F0349042904      <2>
  8127 000064B7 70005000F600D600C0- <2> 	dw 'p','P',0xF6,0xD6,0x3C0,0x3A0,0x437,0x417
  8128 000064C0 03A00337041704      <2>
  8129 000064C7 5B007B00AB00000000- <2> 	dw '[','{',0xAB,0,0,0,0x445,0x425
  8130 000064D0 00000045042504      <2>
  8131 000064D7 5D007D00BB00000000- <2> 	dw ']','}',0xBB,0,0,0,0x44A,0x42A
  8132 000064E0 0000004A042A04      <2>
  8133 000064E7 000000000000000000- <2> 	dw 0,0,0,0,0,0,0,0
  8134 000064F0 00000000000000      <2>
  8135 000064F7 000000000000000000- <2> 	dw 0,0,0,0,0,0,0,0
  8136 00006500 00000000000000      <2>
  8137 00006507 61004100E100E000B1- <2> 	dw 'a','A',0xE1,0xE0,0x3B1,0x391,0x444,0x424
  8138 00006510 03910344042404      <2>
  8139 00006517 73005300A7000000C3- <2> 	dw 's','S',0xA7,0,0x3C3,0x3A3,0x44B,0x42B
  8140 00006520 03A3034B042B04      <2>
  8141 00006527 64004400B0000000B4- <2> 	dw 'd','D',0xB0,0,0x3B4,0x394,0x432,0x412
  8142 00006530 03940332041204      <2>
  8143 00006537 6600460083004026C6- <2> 	dw 'f','F',0x83,0x2640,0x3C6,0x3A6,0x430,0x410
  8144 00006540 03A60330041004      <2>
  8145 00006547 6700470000000000B3- <2> 	dw 'g','G',0,0,0x3B3,0x393,0x43F,0x41F
  8146 00006550 0393033F041F04      <2>
  8147 00006557 6800480000000000B7- <2> 	dw 'h','H',0,0,0x3B7,0x397,0x440,0x420
  8148 00006560 03970340042004      <2>
  8149 00006567 6A004A0000000000BE- <2> 	dw 'j','J',0,0,0x3BE,0x39E,0x43E,0x41E
  8150 00006570 039E033E041E04      <2>
  8151 00006577 6B004B0000000000BA- <2> 	dw 'k','K',0,0,0x3BA,0x39A,0x43B,0x41B
  8152 00006580 039A033B041B04      <2>
  8153 00006587 6C004C0000000000BB- <2> 	dw 'l','L',0,0,0x3BB,0x39B,0x434,0x414
  8154 00006590 039B0334041404      <2>
  8155 00006597 3B003A00B6000E2200- <2> 	dw ';',':',0xB6,0x220E,0,0,0x436,0x416
  8156 000065A0 00000036041604      <2>
  8157 000065A7 270022000000000000- <2> 	dw "'",'"',0,0,0,0,0x44D,0x42D
  8158 000065B0 0000004D042D04      <2>
  8159 000065B7 60007E000000000000- <2> 	dw '`','~',0,0,0,0,0x451,0x401
  8160 000065C0 00000051040104      <2>
  8161 000065C7 000000000000000000- <2> 	dw 0,0,0,0,0,0,0,0
  8162 000065D0 00000000000000      <2>
  8163 000065D7 5C007C00AC00A60000- <2> 	dw "\",'|',0xAC,0xA6,0,0,"/","\"
  8164 000065E0 0000002F005C00      <2>
  8165 000065E7 7A005A00E600C600B6- <2> 	dw 'z','Z',0xE6,0xC6,0x3B6,0x396,0x44F,0x42F
  8166 000065F0 0396034F042F04      <2>
  8167 000065F7 7800580000000000C7- <2> 	dw 'x','X',0,0,0x3C7,0x3A7,0x447,0x427
  8168 00006600 03A70347042704      <2>
  8169 00006607 63004300E700C700C8- <2> 	dw 'c','C',0xE7,0xC7,0x3C8,0x3A8,0x441,0x421
  8170 00006610 03A80341042104      <2>
  8171 00006617 7600560000000000C9- <2> 	dw 'v','V',0,0,0x3C9,0x3A9,0x43C,0x41C
  8172 00006620 03A9033C041C04      <2>
  8173 00006627 6200420000000000B2- <2> 	dw 'b','B',0,0,0x3B2,0x392,0x438,0x418
  8174 00006630 03920338041804      <2>
  8175 00006637 6E004E00F100D100BD- <2> 	dw 'n','N',0xF1,0xD1,0x3BD,0x39D,0x442,0x422
  8176 00006640 039D0342042204      <2>
  8177 00006647 6D004D006C264226BC- <2> 	dw 'm','M',0x266C,0x2642,0x3BC,0x39C,0x44C,0x42C
  8178 00006650 039C034C042C04      <2>
  8179 00006657 2C003C006422000000- <2> 	dw ',','<',0x2264,0,0,0,0x431,0x411
  8180 00006660 00000031041104      <2>
  8181 00006667 2E003E006522000000- <2> 	dw '.','>',0x2265,0,0,0,0x44E,0x42E
  8182 00006670 0000004E042E04      <2>
  8183 00006677 2F003F00BF00000000- <2> 	dw '/','?',0xBF,0,0,0,'.',','
  8184 00006680 0000002E002C00      <2>
  8185 00006687 000000000000000000- <2> 	dw 0,0,0,0,0,0,0,0
  8186 00006690 00000000000000      <2>
  8187 00006697 000000000000000000- <2> 	dw 0,0,0,0,0,0,0,0
  8188 000066A0 00000000000000      <2>
  8189 000066A7 000000000000000000- <2> 	dw 0,0,0,0,0,0,0,0
  8190 000066B0 00000000000000      <2>
  8191 000066B7 200020000000000000- <2> 	dw ' ',' ',0,0,0,0,0,0
  8192 000066C0 00000000000000      <2>
  8193                              <2> noscan:
  8194                              <2> 
  8195                              <1> %endif
  8196                              <1> ;drivers will soon be handled intelligently
  8197                              <1> ;every driver's source will be scanned for a .init function
  8198                              <1> ;that will be called and if it returns 0
  8199                              <1> ;the hardware was found and the driver initialized properly
  8200                              <1> initializelater: ;these have debugging messages and should be initialized after the screen
  8201                              <1> 	%ifdef sound.included
  8202 000066C7 E842F8FFFF          <1> 		call sblaster.init
  8203                              <1> 	%endif
  8204                              <1> 	%ifdef network.included
  8205 000066CC E864230000          <1> 		call network.init
  8206                              <1> 	%endif
  8207 000066D1 C3                  <1> 	ret
  8208                              <1> initialize:
  8209                              <1> ;Now I will initialise the interrupt controllers and remap irq's
  8210 000066D2 E839000000          <1> 	call .pic
  8211                              <1> %ifdef terminal.vsync
  8212                              <1> 	call .rtc
  8213                              <1> %endif
  8214 000066D7 E896000000          <1> 	call .pit
  8215 000066DC E8B8000000          <1> 	call .fpu
  8216 000066E1 E8C9000000          <1> 	call .sse
  8217 000066E6 31C0                <1> 	xor eax, eax
  8218 000066E8 31C9                <1> 	xor ecx, ecx
  8219                              <1> %ifdef io.serial
  8220                              <1> 	call serial.init
  8221                              <1> %endif
  8222 000066EA E801000000          <1> 	call .time
  8223 000066EF C3                  <1> 	ret
  8224                              <1> 	
  8225                              <1> .time:
  8226 000066F0 E853DAFFFF          <1> 	call time
  8227 000066F5 E8FBDBFFFF          <1> 	call timeconvert
  8228 000066FA 890D[67020000]      <1> 	mov [timeseconds], ecx
  8229 00006700 31C9                <1> 	xor ecx, ecx
  8230 00006702 890D[6B020000]      <1> 	mov [timenanoseconds], ecx
  8231 00006708 C605[90400000]01    <1> 	mov byte [istimeset], 1
  8232 0000670F C3                  <1> 	ret
  8233                              <1> 	
  8234                              <1> .pic:
  8235 00006710 B011                <1> 	mov al, 0x11
  8236 00006712 E620                <1> 	out 0x20, al
  8237 00006714 E6A0                <1> 	out 0xA0, al
  8238 00006716 B040                <1> 	mov al, 0x40	;interrupt for master
  8239 00006718 E621                <1> 	out 0x21, al
  8240 0000671A B048                <1> 	mov al, 0x48	;interrupt for slave
  8241 0000671C E6A1                <1> 	out 0xA1, al
  8242 0000671E B004                <1> 	mov al, 4
  8243 00006720 E621                <1> 	out 0x21, al
  8244 00006722 B002                <1> 	mov al, 2
  8245 00006724 E6A1                <1> 	out 0xA1, al
  8246 00006726 B001                <1> 	mov al, 0x1
  8247 00006728 E621                <1> 	out 0x21, al
  8248 0000672A B001                <1> 	mov al, 0x1
  8249 0000672C E6A1                <1> 	out 0xA1, al
  8250                              <1> 	;masks are set to zero so as not to mask
  8251 0000672E 30C0                <1> 	xor al, al
  8252 00006730 E621                <1> 	out 0x21, al
  8253 00006732 30C0                <1> 	xor al, al
  8254 00006734 E6A1                <1> 	out 0xA1, al
  8255 00006736 B020                <1> 	mov al, 0x20
  8256 00006738 E6A0                <1> 	out 0xA0, al
  8257 0000673A E620                <1> 	out 0x20, al
  8258 0000673C C3                  <1> 	ret
  8259                              <1> .rtc:
  8260 0000673D B008                <1> 	mov al, 0x8
  8261 0000673F 88C4                <1> 	mov ah, al
  8262 00006741 66BA7000            <1> 	mov dx, 0x70
  8263 00006745 EE                  <1> 	out dx, al
  8264 00006746 6642                <1> 	inc dx
  8265 00006748 EC                  <1> 	in al, dx
  8266 00006749 86C4                <1> 	xchg al, ah
  8267 0000674B 664A                <1> 	dec dx
  8268 0000674D EE                  <1> 	out dx, al
  8269 0000674E 6642                <1> 	inc dx
  8270 00006750 86C4                <1> 	xchg al, ah
  8271 00006752 0C40                <1> 	or al, 0x40
  8272 00006754 EE                  <1> 	out dx, al
  8273                              <1> 	
  8274 00006755 B00A                <1> 	mov al, 0xA
  8275 00006757 664A                <1> 	dec dx
  8276 00006759 EE                  <1> 	out dx, al
  8277 0000675A 86C4                <1> 	xchg al, ah
  8278 0000675C 6642                <1> 	inc dx
  8279 0000675E EC                  <1> 	in al, dx
  8280 0000675F 24F0                <1> 	and al, 0xF0
  8281 00006761 0A05[2E030000]      <1> 	or al, [rtcrate]
  8282 00006767 86C4                <1> 	xchg al, ah
  8283 00006769 664A                <1> 	dec dx
  8284 0000676B EE                  <1> 	out dx, al
  8285 0000676C 6642                <1> 	inc dx
  8286 0000676E 86C4                <1> 	xchg al, ah
  8287 00006770 EE                  <1> 	out dx, al
  8288 00006771 C3                  <1> 	ret
  8289                              <1> 	
  8290                              <1> .pit:
  8291                              <1> 	;initialize the PIT
  8292 00006772 66A1[60020000]      <1> 	mov ax, [pitdiv] ;this is the divider for the PIT
  8293 00006778 E640                <1> 	out 0x40, al
  8294 0000677A 66C1C008            <1> 	rol ax, 8
  8295 0000677E E640                <1> 	out 0x40, al
  8296                              <1> 	;enable rtc interrupt
  8297 00006780 B00B                <1> 	mov al, 0xB
  8298 00006782 E670                <1> 	out 0x70, al
  8299 00006784 66C1C008            <1> 	rol ax, 8
  8300 00006788 E471                <1> 	in al, 0x71
  8301 0000678A 66C1C008            <1> 	rol ax, 8
  8302 0000678E E670                <1> 	out 0x70, al
  8303 00006790 66C1C008            <1> 	rol ax, 8
  8304 00006794 0C40                <1> 	or al, 0x40
  8305 00006796 E671                <1> 	out 0x71, al
  8306 00006798 C3                  <1> 	ret
  8307                              <1> .fpu:
  8308                              <1> 	;And now to initialize the fpu
  8309 00006799 0F20E0              <1> 	mov eax, cr4
  8310 0000679C 0D00020000          <1> 	or eax, 0x200
  8311 000067A1 0F22E0              <1> 	mov cr4, eax
  8312 000067A4 B87F0B0000          <1> 	mov eax, 0xB7F
  8313 000067A9 50                  <1> 	push eax
  8314 000067AA D92C24              <1> 	fldcw [esp]
  8315 000067AD 58                  <1> 	pop eax
  8316 000067AE C3                  <1> 	ret
  8317                              <1> 	
  8318                              <1> .sse:
  8319 000067AF 0F20C0              <1> 	mov eax, cr0
  8320 000067B2 24FB                <1> 	and al, 11111011b
  8321 000067B4 0C02                <1> 	or al, 00000010b
  8322 000067B6 0F22C0              <1> 	mov cr0, eax
  8323 000067B9 0F20E0              <1> 	mov eax, cr4
  8324 000067BC 660D0006            <1> 	or ax, 0000011000000000b
  8325 000067C0 0F22E0              <1> 	mov cr4, eax
  8326 000067C3 C3                  <1> 	ret
  8327                                      %include "source/pci.asm"
  8328 000067C4 00                  <1> pcibus		db 0
  8329 000067C5 00                  <1> pcidevice	db 0
  8330 000067C6 00                  <1> pcifunction	db 0
  8331 000067C7 00                  <1> pciregister	db 0
  8332 000067C8 00                  <1> pcireqtype	db 0
  8333 000067C9 00000000            <1> pcidevid	dd 0
  8334 000067CD FFFFFFFF            <1> pcidevidmask dd 0xFFFFFFFF
  8335                              <1> getpcimem:
  8336 000067D1 B002                <1> 	mov al, 2
  8337 000067D3 A2[C8670000]        <1> 	mov [pcireqtype], al
  8338 000067D8 E922000000          <1> 	jmp searchpci
  8339                              <1> getpciport:
  8340 000067DD B001                <1> 	mov al, 1
  8341 000067DF A2[C8670000]        <1> 	mov [pcireqtype], al
  8342 000067E4 E916000000          <1> 	jmp searchpci
  8343                              <1> pcidump:
  8344 000067E9 31C0                <1> 	xor eax, eax
  8345 000067EB A2[C6670000]        <1> 	mov [pcifunction], al
  8346 000067F0 A2[C4670000]        <1> 	mov [pcibus], al
  8347 000067F5 A2[C5670000]        <1> 	mov [pcidevice], al
  8348 000067FA A2[C8670000]        <1> 	mov [pcireqtype], al
  8349                              <1> searchpci:		;return in ebx, start X in pciX
  8350 000067FF 30C0                <1> 	xor al, al
  8351 00006801 A2[C7670000]        <1> 	mov [pciregister], al
  8352 00006806 E81D020000          <1> 	call getpciaddr
  8353 0000680B BAF80C0000          <1> 	mov edx, 0xCF8
  8354 00006810 EF                  <1> 	out dx, eax	;request pci config
  8355 00006811 BAFC0C0000          <1> 	mov edx, 0xCFC
  8356 00006816 ED                  <1> 	in eax, dx 	;read in pci config
  8357 00006817 3D0000FFFF          <1> 	cmp eax, 0xFFFF0000
  8358 0000681C 0F8237000000        <1> 	jb near checkpcidevice
  8359                              <1> searchpciret:
  8360                              <1> nextpcidevice:
  8361 00006822 30C0                <1> 	xor al, al
  8362 00006824 A2[C6670000]        <1> 	mov [pcifunction], al
  8363 00006829 A0[C5670000]        <1> 	mov al, [pcidevice]
  8364 0000682E 3C1F                <1> 	cmp al, 11111b
  8365 00006830 0F8300010000        <1> 	jae near nextpcibus
  8366 00006836 FEC0                <1> 	inc al
  8367 00006838 A2[C5670000]        <1> 	mov [pcidevice], al
  8368 0000683D EBC0                <1> 	jmp searchpci
  8369 0000683F A0[C6670000]        <1> 	mov al, [pcifunction]
  8370 00006844 3C07                <1> 	cmp al, 111b
  8371 00006846 0F83D6FFFFFF        <1> 	jae near nextpcidevice
  8372 0000684C FEC0                <1> 	inc al
  8373 0000684E A2[C6670000]        <1> 	mov [pcifunction], al
  8374 00006853 EBAA                <1> 	jmp searchpci
  8375 00006855 00000000            <1> pcitype: db 0,0,0,0
  8376                              <1> checkpcidevice:
  8377 00006859 31C0                <1> 	xor eax, eax
  8378 0000685B 3905[C9670000]      <1> 	cmp [pcidevid], eax
  8379 00006861 0F8430000000        <1> 	je near .good
  8380 00006867 A2[C7670000]        <1> 	mov [pciregister], al	;device id, vendor id
  8381 0000686C E8B7010000          <1> 	call getpciaddr
  8382 00006871 BAF80C0000          <1> 	mov edx, 0xCF8
  8383 00006876 EF                  <1> 	out dx, eax
  8384 00006877 BAFC0C0000          <1> 	mov edx, 0xCFC
  8385 0000687C ED                  <1> 	in eax, dx
  8386 0000687D 2305[CD670000]      <1> 	and eax, [pcidevidmask]
  8387 00006883 8B1D[C9670000]      <1> 	mov ebx, [pcidevid]
  8388 00006889 231D[CD670000]      <1> 	and ebx, [pcidevidmask]
  8389 0000688F 39D8                <1> 	cmp eax, ebx
  8390 00006891 0F858BFFFFFF        <1> 	jne near searchpciret
  8391                              <1> .good:
  8392 00006897 30C0                <1> 	xor al, al
  8393 00006899 3805[C8670000]      <1> 	cmp [pcireqtype], al
  8394 0000689F 0F842C000000        <1> 	je near dumppcidevice
  8395 000068A5 B008                <1> 	mov al, 0x08
  8396 000068A7 A2[C7670000]        <1> 	mov [pciregister], al	;class code, subclass, revision id
  8397 000068AC E877010000          <1> 	call getpciaddr
  8398 000068B1 BAF80C0000          <1> 	mov edx, 0xCF8
  8399 000068B6 EF                  <1> 	out dx, eax
  8400 000068B7 BAFC0C0000          <1> 	mov edx, 0xCFC
  8401 000068BC ED                  <1> 	in eax, dx
  8402 000068BD C1C008              <1> 	rol eax, 8
  8403 000068C0 3A05[55680000]      <1> 	cmp al, [pcitype]
  8404 000068C6 0F84A0000000        <1> 	je near foundpciaddr
  8405 000068CC E951FFFFFF          <1> 	jmp searchpciret
  8406                              <1> dumppcidevice:
  8407 000068D1 30C0                <1> 	xor al, al
  8408 000068D3 A2[C7670000]        <1> 	mov [pciregister], al
  8409 000068D8 E84B010000          <1> 	call getpciaddr
  8410 000068DD 89C1                <1> 	mov ecx, eax
  8411 000068DF C605[B5310000]05    <1> 	mov byte [firsthexshown], 5
  8412 000068E6 E8DFC8FFFF          <1> 	call showhex
  8413                              <1> dumppcidevicelp:
  8414 000068EB A2[C7670000]        <1> 	mov [pciregister], al
  8415 000068F0 E833010000          <1> 	call getpciaddr
  8416 000068F5 BAF80C0000          <1> 	mov edx, 0xCF8
  8417 000068FA EF                  <1> 	out dx, eax
  8418 000068FB BAFC0C0000          <1> 	mov edx, 0xCFC
  8419 00006900 ED                  <1> 	in eax, dx
  8420 00006901 89C1                <1> 	mov ecx, eax
  8421 00006903 A0[C7670000]        <1> 	mov al, [pciregister]
  8422 00006908 0404                <1> 	add al, 4
  8423 0000690A C605[B5310000]05    <1> 	mov byte [firsthexshown], 5
  8424 00006911 E8B4C8FFFF          <1> 	call showhex
  8425 00006916 3C3C                <1> 	cmp al, 0x3C
  8426 00006918 72D1                <1> 	jb dumppcidevicelp
  8427                              <1> dumppcidn:
  8428                              <1> %ifdef io.serial
  8429                              <1> 	mov esi, line
  8430                              <1> 	call print
  8431                              <1> %else
  8432 0000691A 803D[D8250000]00    <1> 	cmp byte [charpos], 0
  8433 00006921 0F84FBFEFFFF        <1> 	je near searchpciret
  8434 00006927 BE[D48E0000]        <1> 	mov esi, line
  8435 0000692C E82BB4FFFF          <1> 	call print
  8436                              <1> %endif
  8437 00006931 E9ECFEFFFF          <1> 	jmp searchpciret
  8438                              <1> nextpcibus:
  8439 00006936 30C0                <1> 	xor al, al
  8440 00006938 A2[C5670000]        <1> 	mov [pcidevice], al
  8441 0000693D A0[C4670000]        <1> 	mov al, [pcibus]
  8442 00006942 3C7F                <1> 	cmp al, 1111111b
  8443 00006944 730C                <1> 	jae donesearchpci
  8444 00006946 FEC0                <1> 	inc al
  8445 00006948 A2[C4670000]        <1> 	mov [pcibus], al
  8446 0000694D E9ADFEFFFF          <1> 	jmp searchpci
  8447                              <1> donesearchpci:
  8448 00006952 BBFFFFFFFF          <1> 	mov ebx, 0xFFFFFFFF
  8449 00006957 31D2                <1> 	xor edx, edx
  8450 00006959 8815[55680000]      <1> 	mov [pcitype], dl
  8451 0000695F 8915[C9670000]      <1> 	mov [pcidevid], edx
  8452 00006965 891D[CD670000]      <1> 	mov [pcidevidmask], ebx
  8453 0000696B C3                  <1> 	ret
  8454                              <1> foundpciaddr:
  8455 0000696C B010                <1> 	mov al, 0x10
  8456 0000696E A2[C7670000]        <1> 	mov [pciregister], al
  8457 00006973 803D[C8670000]02    <1> 	cmp byte [pcireqtype], 2
  8458 0000697A 7443                <1> 	je findpcimemaddr
  8459                              <1> findpciioaddr:
  8460 0000697C E8A7000000          <1> 	call getpciaddr
  8461 00006981 BAF80C0000          <1> 	mov edx, 0xCF8
  8462 00006986 EF                  <1> 	out dx, eax
  8463 00006987 BAFC0C0000          <1> 	mov edx, 0xCFC
  8464 0000698C ED                  <1> 	in eax, dx
  8465 0000698D 89C3                <1> 	mov ebx, eax
  8466 0000698F 81E301000000        <1> 	and ebx, 1
  8467 00006995 81FB00000000        <1> 	cmp ebx, 0
  8468 0000699B 0F846E000000        <1> 	je near notpciioaddr
  8469 000069A1 2D01000000          <1> 	sub eax, 1
  8470 000069A6 89C2                <1> 	mov edx, eax
  8471 000069A8 31DB                <1> 	xor ebx, ebx
  8472 000069AA 4B                  <1> 	dec ebx
  8473 000069AB 891D[CD670000]      <1> 	mov [pcidevidmask], ebx
  8474 000069B1 43                  <1> 	inc ebx
  8475 000069B2 881D[55680000]      <1> 	mov [pcitype], bl
  8476 000069B8 891D[C9670000]      <1> 	mov [pcidevid], ebx
  8477 000069BE C3                  <1> 	ret
  8478                              <1> findpcimemaddr:
  8479 000069BF E864000000          <1> 	call getpciaddr
  8480 000069C4 BAF80C0000          <1> 	mov edx, 0xCF8
  8481 000069C9 EF                  <1> 	out dx, eax
  8482 000069CA BAFC0C0000          <1> 	mov edx, 0xCFC
  8483 000069CF ED                  <1> 	in eax, dx
  8484 000069D0 89C3                <1> 	mov ebx, eax
  8485 000069D2 81E301000000        <1> 	and ebx, 1
  8486 000069D8 81FB01000000        <1> 	cmp ebx, 1
  8487 000069DE 0F842B000000        <1> 	je near notpciioaddr
  8488 000069E4 C1E804              <1> 	shr eax, 4
  8489 000069E7 C1E004              <1> 	shl eax, 4	;remove prefetch and type
  8490 000069EA 89C2                <1> 	mov edx, eax
  8491 000069EC 50                  <1> 	push eax
  8492 000069ED A1[47020000]        <1> 	mov eax, [basecache]
  8493 000069F2 C1E004              <1> 	shl eax, 4
  8494 000069F5 29C2                <1> 	sub edx, eax
  8495 000069F7 58                  <1> 	pop eax
  8496 000069F8 31DB                <1> 	xor ebx, ebx
  8497 000069FA 4B                  <1> 	dec ebx
  8498 000069FB 891D[CD670000]      <1> 	mov [pcidevidmask], ebx
  8499 00006A01 43                  <1> 	inc ebx
  8500 00006A02 881D[55680000]      <1> 	mov [pcitype], bl
  8501 00006A08 891D[C9670000]      <1> 	mov [pcidevid], ebx
  8502 00006A0E C3                  <1> 	ret
  8503                              <1> notpciioaddr:
  8504 00006A0F A0[C7670000]        <1> 	mov al, [pciregister]
  8505 00006A14 0404                <1> 	add al, 4
  8506 00006A16 3C28                <1> 	cmp al, 0x28
  8507 00006A18 0F8704FEFFFF        <1> 	ja near searchpciret
  8508 00006A1E A2[C7670000]        <1> 	mov [pciregister], al
  8509 00006A23 E954FFFFFF          <1> 	jmp findpciioaddr
  8510                              <1> getpciaddr:		;puts it in eax and ebx
  8511 00006A28 31C0                <1> 			xor eax, eax
  8512 00006A2A BB00000080          <1> 			mov ebx, 0x80000000
  8513 00006A2F A0[C4670000]        <1> 			mov al, [pcibus]
  8514 00006A34 C1E010              <1> 			shl eax, 16
  8515 00006A37 01C3                <1> 			add ebx, eax
  8516 00006A39 31C0                <1> 			xor eax, eax
  8517 00006A3B A0[C5670000]        <1> 			mov al, [pcidevice]
  8518 00006A40 C1E00B              <1> 			shl eax, 11
  8519 00006A43 01C3                <1> 			add ebx, eax
  8520 00006A45 31C0                <1> 			xor eax, eax
  8521 00006A47 A0[C6670000]        <1> 			mov al, [pcifunction]
  8522 00006A4C C1E008              <1> 			shl eax, 8
  8523 00006A4F 01C3                <1> 			add ebx, eax
  8524 00006A51 31C0                <1> 			xor eax, eax
  8525 00006A53 A0[C7670000]        <1> 			mov al, [pciregister]
  8526 00006A58 01C3                <1> 			add ebx, eax
  8527 00006A5A 89D8                <1> 			mov eax, ebx
  8528 00006A5C C3                  <1> 			ret
  8529                                      %include "source/disk.asm"
  8530                              <1> %ifdef disk.real
  8531                              <1> 	%include "source/drivers/disk/realmode.asm"
  8532                              <2> diskr:
  8533                              <2> 			;sector count in cl
  8534                              <2> 			;disk number in ch
  8535                              <2> 			;48 bit address with last 32 bits in ebx
  8536                              <2> 			;buffer in esi
  8537                              <2> 			;puts end of buffer in edi and end lba address in edx
  8538 00006A5D 880D[846A0000]      <2> 	mov [sdlength], cl
  8539 00006A63 891D[856A0000]      <2> 	mov [sdaddress], ebx
  8540 00006A69 8935[006C0000]      <2> 	mov [oldesireal], esi
  8541 00006A6F 66BE[896A]          <2> 	mov si, readdiskreal
  8542 00006A73 668935[F30C0000]    <2> 	mov [realmodeptr], si
  8543 00006A7A E862A1FFFF          <2> 	call realmode
  8544 00006A7F E941000000          <2> 	jmp backfromrealread
  8545 00006A84 00                  <2> sdlength db 0
  8546 00006A85 00000000            <2> sdaddress dd 0
  8547                              <2> 
  8548                              <2> [BITS 16]
  8549                              <2> readdiskreal:
  8550 00006A89 C706[B56A]1000      <2> 	mov word [dlen], 0x10
  8551 00006A8F C706[B96A]0000      <2> 	mov word [daddress], 0
  8552 00006A95 C706[BB6A]0001      <2> 	mov word [dsegm], 0x100
  8553 00006A9B 66891E[BD6A]        <2> 	mov [dlbaad], ebx
  8554 00006AA0 880E[B76A]          <2> 	mov [dreadlen], cl
  8555                              <2> ReadHardDisk:
  8556 00006AA4 BE[B56A]            <2> 	mov si, diskaddresspacket
  8557 00006AA7 31C0                <2> 	xor ax, ax
  8558 00006AA9 B442                <2> 	mov ah, 0x42
  8559 00006AAB 8A16[B46A]          <2> 	mov dl, [dnumber]
  8560 00006AAF CD13                <2> 	int 0x13
  8561 00006AB1 72F1                <2> 	jc ReadHardDisk
  8562 00006AB3 C3                  <2> 	ret
  8563                              <2> 
  8564 00006AB4 80                  <2> dnumber db 0x80
  8565                              <2> diskaddresspacket:
  8566 00006AB5 10                  <2> dlen:	db 0x10 ;size of packet
  8567 00006AB6 00                  <2> 		db 0
  8568 00006AB7 7F00                <2> dreadlen:	dw 0x7F	;blocks to read=maximum
  8569 00006AB9 0000                <2> daddress:	dw 0	;address 0
  8570 00006ABB 0001                <2> dsegm:		dw 0x100	;segment
  8571                              <2> 		;start with known value for hd
  8572                              <2> dlbaad:
  8573 00006ABD 00000000            <2> 	dd 0	;lba address
  8574 00006AC1 00000000            <2> 	dd 0
  8575                              <2> [BITS 32]
  8576                              <2> backfromrealread:
  8577 00006AC5 8B35[006C0000]      <2> 	mov esi, [oldesireal]
  8578 00006ACB 8B1D[856A0000]      <2> 	mov ebx, [sdaddress]
  8579 00006AD1 31C9                <2> 	xor ecx, ecx
  8580 00006AD3 8A0D[846A0000]      <2> 	mov cl, [sdlength]
  8581 00006AD9 01CB                <2> 	add ebx, ecx
  8582 00006ADB 66B80800            <2> 	mov ax, LINEAR_SEL
  8583 00006ADF 8EE0                <2> 	mov fs, ax
  8584 00006AE1 BF00100000          <2> 	mov edi, 0x1000
  8585 00006AE6 B200                <2> 	mov dl, 0
  8586 00006AE8 D0E1                <2> 	shl cl, 1
  8587                              <2> copyfromrmodedisk:
  8588 00006AEA 648A07              <2> 	mov al, [fs:edi]
  8589 00006AED 8806                <2> 	mov [esi], al
  8590 00006AEF 47                  <2> 	inc edi
  8591 00006AF0 46                  <2> 	inc esi
  8592 00006AF1 FECA                <2> 	dec dl
  8593 00006AF3 80FA00              <2> 	cmp dl, 0
  8594 00006AF6 75F2                <2> 	jne copyfromrmodedisk
  8595 00006AF8 FEC9                <2> 	dec cl
  8596 00006AFA B200                <2> 	mov dl, 0
  8597 00006AFC 80F900              <2> 	cmp cl, 0
  8598 00006AFF 75E9                <2> 	jne copyfromrmodedisk
  8599 00006B01 66B83000            <2> 	mov ax, NEW_DATA_SEL
  8600 00006B05 8EE0                <2> 	mov fs, ax
  8601 00006B07 89F7                <2> 	mov edi, esi
  8602 00006B09 8B35[006C0000]      <2> 	mov esi, [oldesireal]
  8603 00006B0F 89DA                <2> 	mov edx, ebx
  8604 00006B11 8B1D[856A0000]      <2> 	mov ebx, [sdaddress]
  8605 00006B17 C3                  <2> 	ret
  8606                              <2> 	
  8607                              <1> %else
  8608                              <1> 	%ifdef disk.protected
  8609                              <1> 		%include "source/drivers/disk/pata.asm"
  8610                              <1> 	%endif
  8611                              <1> %endif
  8612                              <1> %ifdef disk.none
  8613                              <1> loadfile:	xor edx, edx
  8614                              <1> 			cmp byte [edi], '&'
  8615                              <1> 			je .ret
  8616                              <1> 			mov edx, 404	;no files are found except &
  8617                              <1> 		.ret:
  8618                              <1> 			ret
  8619                              <1> %else
  8620                              <1> ;This loads files using the methods in the loaded driver
  8621                              <1> loadfile:	;loads a file with the name buffer's location in edi into location in esi
  8622                              <1> 			;returns with err code in edx and file end in edi
  8623 00006B18 803F00              <1> 	cmp byte [edi], 0
  8624 00006B1B 0F8448000000        <1> 	je near nofileload
  8625 00006B21 89FA                <1> 	mov edx, edi
  8626 00006B23 BB[53910300]        <1> 	mov ebx, diskfileindex
  8627                              <1> nextnamechar:
  8628 00006B28 8A07                <1> 	mov al, [edi]
  8629 00006B2A 3C26                <1> 	cmp al, '&'
  8630 00006B2C 7440                <1> 	je nullfile
  8631 00006B2E 8A23                <1> 	mov ah, [ebx]
  8632 00006B30 47                  <1> 	inc edi
  8633 00006B31 43                  <1> 	inc ebx
  8634 00006B32 88C1                <1> 	mov cl, al
  8635 00006B34 08E1                <1> 	or cl, ah
  8636 00006B36 80F900              <1> 	cmp cl, 0
  8637 00006B39 746B                <1> 	je equalfilenames
  8638 00006B3B 80F920              <1> 	cmp cl, ' '
  8639 00006B3E 7466                <1> 	je equalfilenames
  8640 00006B40 3C2A                <1> 	cmp al, '*'
  8641 00006B42 742B                <1> 	je asteriskcheck
  8642 00006B44 80FC00              <1> 	cmp ah, 0
  8643 00006B47 7410                <1> 	je nextfilename
  8644 00006B49 3C00                <1> 	cmp al, 0
  8645 00006B4B 7404                <1> 	je getebxzero
  8646 00006B4D 38E0                <1> 	cmp al, ah
  8647 00006B4F 74D7                <1> 	je nextnamechar
  8648                              <1> getebxzero:
  8649 00006B51 8A23                <1> 	mov ah, [ebx]
  8650 00006B53 43                  <1> 	inc ebx
  8651 00006B54 80FC00              <1> 	cmp ah, 0
  8652 00006B57 75F8                <1> 	jne getebxzero
  8653                              <1> nextfilename:
  8654 00006B59 81C308000000        <1> 	add ebx, 8		;next descriptor
  8655 00006B5F 89D7                <1> 	mov edi, edx
  8656 00006B61 81FB[35920300]      <1> 	cmp ebx, enddiskfileindex
  8657 00006B67 72BF                <1> 	jb nextnamechar
  8658                              <1> nofileload:
  8659 00006B69 BA94010000          <1> 	mov edx, 404	;indicate not found error
  8660                              <1> nullfile:
  8661 00006B6E C3                  <1> 	ret
  8662                              <1> asteriskcheck:
  8663 00006B6F 4B                  <1> 	dec ebx
  8664 00006B70 8A07                <1> 	mov al, [edi]
  8665 00006B72 3C2A                <1> 	cmp al, '*'
  8666 00006B74 74F9                <1> 	je asteriskcheck ;remove multiple asterisks
  8667 00006B76 3C20                <1> 	cmp al, ' '
  8668 00006B78 7412                <1> 	je equalfilenames2
  8669 00006B7A 3C00                <1> 	cmp al, 0
  8670 00006B7C 740E                <1> 	je equalfilenames2
  8671                              <1> .lp:
  8672 00006B7E 8A23                <1> 	mov ah, [ebx]
  8673 00006B80 80FC00              <1> 	cmp ah, 0
  8674 00006B83 74D4                <1> 	je nextfilename
  8675 00006B85 38E0                <1> 	cmp al, ah
  8676 00006B87 749F                <1> 	je nextnamechar
  8677 00006B89 43                  <1> 	inc ebx
  8678 00006B8A EBF2                <1> 	jmp .lp
  8679                              <1> equalfilenames2:
  8680 00006B8C 81EB02000000        <1> 	sub ebx, 2
  8681                              <1> eqfilefind:
  8682 00006B92 43                  <1> 	inc ebx
  8683 00006B93 81FB[35920300]      <1> 	cmp ebx, enddiskfileindex
  8684 00006B99 0F83CAFFFFFF        <1> 	jae near nofileload
  8685 00006B9F 8A03                <1> 	mov al, [ebx]
  8686 00006BA1 3C00                <1> 	cmp al, 0
  8687 00006BA3 75ED                <1> 	jne eqfilefind
  8688 00006BA5 43                  <1> 	inc ebx
  8689                              <1> equalfilenames:
  8690 00006BA6 8B4304              <1> 	mov eax, [ebx + 4] 	;put file size in eax
  8691 00006BA9 8B1B                <1> 	mov ebx, [ebx]		;put file beginning in ebx
  8692 00006BAB 031D[FB8E0000]      <1> 	add ebx, [lbaad]	;add offset to solleros start
  8693 00006BB1 31C9                <1> 	xor ecx, ecx
  8694 00006BB3 88C1                <1> 	mov cl, al			;get excess number of sectors
  8695 00006BB5 C0E102              <1> 	shl cl, 2
  8696 00006BB8 C0E902              <1> 	shr cl, 2			;cut off at 64
  8697 00006BBB 29C8                <1> 	sub eax, ecx		;get rid of excess sectors
  8698 00006BBD B500                <1> 	mov ch, 0			;drive 0
  8699 00006BBF C1E806              <1> 	shr eax, 6			;get number of 64 sector tracks
  8700                              <1> loaddiskfile:			;tracks in eax, excess sectors in cl, drive in ch, buffer in esi, address in ebx
  8701 00006BC2 A3[046C0000]        <1> 	mov [filetracks], eax
  8702 00006BC7 89F7                <1> 	mov edi, esi		;just in case cl is 0
  8703 00006BC9 89DA                <1> 	mov edx, ebx
  8704 00006BCB 80F900              <1> 	cmp cl, 0
  8705 00006BCE 7405                <1> 	je copytracksforfile
  8706 00006BD0 E888FEFFFF          <1> 	call diskr	;take care of excess sectors
  8707                              <1> copytracksforfile:
  8708 00006BD5 A1[046C0000]        <1> 	mov eax, [filetracks]
  8709 00006BDA 3D00000000          <1> 	cmp eax, 0
  8710 00006BDF 7419                <1> 	je donecopyfile
  8711 00006BE1 48                  <1> 	dec eax
  8712 00006BE2 A3[046C0000]        <1> 	mov [filetracks], eax
  8713 00006BE7 89D3                <1> 	mov ebx, edx	;get end lba
  8714 00006BE9 B140                <1> 	mov cl, 0x40 ;for compatability with BIOS it uses 64 instead of 128
  8715 00006BEB 8A2D[FA8E0000]      <1> 	mov ch, [DriveNumber]
  8716 00006BF1 89FE                <1> 	mov esi, edi	;reset buffer
  8717 00006BF3 E865FEFFFF          <1> 	call diskr
  8718 00006BF8 EBDB                <1> 	jmp copytracksforfile
  8719                              <1> donecopyfile:
  8720 00006BFA BA00000000          <1> 	mov edx, 0	;no error
  8721 00006BFF C3                  <1> 	ret
  8722                              <1> 
  8723 00006C00 00000000            <1> oldesireal dd 0
  8724 00006C04 00000000            <1> filetracks dd 0
  8725 00006C08 00                  <1> lbad1 db 0
  8726 00006C09 00                  <1> lbad2 db 0
  8727 00006C0A 00                  <1> lbad3 db 0
  8728 00006C0B 00                  <1> lbad4 db 0
  8729 00006C0C 00                  <1> lbad5 db 0
  8730 00006C0D 00                  <1> lbad6 db 0
  8731 00006C0E 6400                <1> segments dw 100
  8732                              <1> %endif
  8733                                      %include "source/threads.asm"
  8734                              <1> %ifdef threads.included	
  8735                              <1> nwcmdst:
  8736 00006C10 31C0                <1> 	xor eax, eax
  8737 00006C12 BC[00B40300]        <1> 	mov esp, stackend
  8738 00006C17 A2[D26C0000]        <1> 	mov [threadson], al
  8739 00006C1C A3[D36C0000]        <1> 	mov [currentthread], eax
  8740 00006C21 0504000000          <1> 	add eax, 4
  8741 00006C26 A3[CE6C0000]        <1> 	mov [lastthread], eax
  8742 00006C2B FB                  <1> 	sti
  8743 00006C2C E9C4C0FFFF          <1> 	jmp nwcmd
  8744                              <1> 
  8745                              <1> nomorethreadspace:
  8746 00006C31 BE[476C0000]        <1> 	mov esi, nmts
  8747 00006C36 E821B1FFFF          <1> 	call print
  8748 00006C3B C605[D26C0000]00    <1> 	mov byte [threadson], 0
  8749 00006C42 E9AEC0FFFF          <1> 	jmp nwcmd
  8750 00006C47 546872656164204F76- <1> nmts	db "Thread Overflow",10,0
  8751 00006C50 6572666C6F770A00    <1>
  8752                              <1> 
  8753                              <1> nomorestackspace:
  8754 00006C58 BE[646C0000]        <1> 	mov esi, nmss
  8755 00006C5D E8FAB0FFFF          <1> 	call print
  8756 00006C62 EBAC                <1> 	jmp nwcmdst
  8757 00006C64 537461636B204F7665- <1> nmss	db "Stack Overflow",10,0
  8758 00006C6D 72666C6F770A00      <1>
  8759                              <1> 	
  8760                              <1> threadswitch:
  8761 00006C74 60                  <1> 	pushad 
  8762 00006C75 BF[52B00500]        <1> 	mov edi, threadlist
  8763 00006C7A A1[D36C0000]        <1> 	mov eax, [currentthread]
  8764 00006C7F 40                  <1> 	inc eax
  8765 00006C80 A3[D36C0000]        <1> 	mov [currentthread], eax
  8766 00006C85 6648                <1> 	dec ax
  8767 00006C87 C1E002              <1> 	shl eax, 2
  8768 00006C8A 01C7                <1> 	add edi, eax
  8769 00006C8C 8927                <1> 	mov [edi], esp
  8770 00006C8E 81C704000000        <1> 	add edi, 4
  8771 00006C94 81FF[52C00500]      <1> 	cmp edi, threadlistend
  8772 00006C9A 0F830D000000        <1> 	jae near nookespthread
  8773 00006CA0 8B07                <1> 	mov eax, [edi]
  8774 00006CA2 3D00000000          <1> 	cmp eax, 0
  8775 00006CA7 0F8519000000        <1> 	jne near okespthread
  8776                              <1> nookespthread:
  8777 00006CAD BF[52B00500]        <1> 	mov edi, threadlist
  8778 00006CB2 31C0                <1> 	xor eax, eax
  8779 00006CB4 A3[D36C0000]        <1> 	mov [currentthread], eax
  8780 00006CB9 8B07                <1> 	mov eax, [edi]
  8781 00006CBB 3D00000000          <1> 	cmp eax, 0
  8782 00006CC0 0F844AFFFFFF        <1> 	je near nwcmdst
  8783                              <1> okespthread:
  8784 00006CC6 89C4                <1> 	mov esp, eax
  8785 00006CC8 B020                <1> 	mov al, 0x20
  8786 00006CCA E620                <1> 	out 0x20, al
  8787 00006CCC 61                  <1> 	popad
  8788 00006CCD CF                  <1> 	iret
  8789                              <1> 
  8790                              <1> %endif
  8791 00006CCE 04000000            <1> 	lastthread dd 4
  8792 00006CD2 00                  <1> 	threadson db 0
  8793 00006CD3 00000000            <1> 	currentthread dd 0
  8794                                  %ifdef gui.included
  8795                                      %include "source/gui/gui.asm"
  8796                              <1> guiboot:	;Let's see what I can do, I am going to try to make this as freestanding as possible
  8797 00006CD7 31C0                <1> 	xor eax, eax
  8798 00006CD9 31DB                <1> 	xor ebx, ebx
  8799 00006CDB 31C9                <1> 	xor ecx, ecx
  8800 00006CDD 31D2                <1> 	xor edx, edx
  8801 00006CDF E871080000          <1> 	call guisetup
  8802                              <1> guiloop:
  8803 00006CE4 E86EEEFFFF          <1> 	call cursorgui
  8804                              <1> guistart:
  8805 00006CE9 E883F4FFFF          <1> 	call getkey
  8806 00006CEE C605[D6810000]00    <1> 	mov byte [copygui], 0
  8807 00006CF5 EBF2                <1> 	jmp guistart
  8808                              <1> 
  8809                              <1> %include "source/gui/bmp.asm"
  8810                              <2> showbmp:
  8811 00006CF7 668B06              <2> 	mov ax, [esi]
  8812 00006CFA 663D424D            <2> 	cmp ax, "BM"
  8813 00006CFE 0F85BB000000        <2> 	jne near endedbmp
  8814 00006D04 8B3D[7A5A0000]      <2> 	mov edi, [physbaseptr]
  8815 00006D0A 6689D0              <2> 	mov ax, dx
  8816 00006D0D 6689CB              <2> 	mov bx, cx
  8817 00006D10 31C9                <2> 	xor ecx, ecx
  8818 00006D12 31D2                <2> 	xor edx, edx
  8819 00006D14 6689D9              <2> 	mov cx, bx
  8820 00006D17 6689C2              <2> 	mov dx, ax
  8821 00006D1A 01D7                <2> 	add edi, edx
  8822 00006D1C 01D7                <2> 	add edi, edx
  8823 00006D1E 31D2                <2> 	xor edx, edx
  8824 00006D20 668B15[525B0000]    <2> 	mov dx, [resolutionx2]
  8825 00006D27 034E16              <2> 	add ecx, [esi + 22]
  8826                              <2> bmplocloop:
  8827 00006D2A 52                  <2> 	push edx
  8828 00006D2B 31C0                <2> 	xor eax, eax
  8829 00006D2D 6689D0              <2> 	mov ax, dx
  8830 00006D30 F7E1                <2> 	mul ecx
  8831 00006D32 5A                  <2> 	pop edx
  8832 00006D33 663B0D[665A0000]    <2> 	cmp cx, [resolutiony]
  8833 00006D3A 7609                <2> 	jbe .nofixy
  8834 00006D3C 31C9                <2> 	xor ecx, ecx
  8835 00006D3E 668B0D[665A0000]    <2> 	mov cx, [resolutiony]
  8836                              <2> .nofixy:
  8837 00006D45 01C7                <2> 	add edi, eax
  8838 00006D47 8B5612              <2> 	mov edx, [esi + 18]
  8839 00006D4A 8B4E16              <2> 	mov ecx, [esi + 22]
  8840 00006D4D 8B460A              <2> 	mov eax, [esi + 10]
  8841 00006D50 8B5E02              <2> 	mov ebx, [esi + 2]
  8842 00006D53 01F3                <2> 	add ebx, esi
  8843 00006D55 891D[C56D0000]      <2> 	mov [bmpend], ebx
  8844 00006D5B 89D3                <2> 	mov ebx, edx
  8845 00006D5D 01C6                <2> 	add esi, eax
  8846                              <2> ldxbmp2:
  8847 00006D5F 31D2                <2> 	xor edx, edx
  8848 00006D61 668B15[645A0000]    <2> 	mov dx, [resolutionx]
  8849 00006D68 39D3                <2> 	cmp ebx, edx
  8850 00006D6A 7702                <2> 	ja ldxbmp
  8851 00006D6C 89DA                <2> 	mov edx, ebx
  8852                              <2> ldxbmp:
  8853 00006D6E 668B06              <2> 	mov ax, [esi]
  8854 00006D71 668907              <2> 	mov [edi], ax
  8855 00006D74 81C702000000        <2> 	add edi, 2
  8856 00006D7A 81C602000000        <2> 	add esi, 2
  8857 00006D80 3B35[C56D0000]      <2> 	cmp esi, [bmpend]
  8858 00006D86 7737                <2> 	ja endedbmp
  8859 00006D88 4A                  <2> 	dec edx
  8860 00006D89 81FA00000000        <2> 	cmp edx, 0
  8861 00006D8F 77DD                <2> 	ja ldxbmp
  8862 00006D91 31D2                <2> 	xor edx, edx
  8863 00006D93 668B15[645A0000]    <2> 	mov dx, [resolutionx]
  8864 00006D9A 39D3                <2> 	cmp ebx, edx
  8865 00006D9C 7610                <2> 	jbe .notover
  8866                              <2> .over:
  8867 00006D9E 01DE                <2> 	add esi, ebx
  8868 00006DA0 01DE                <2> 	add esi, ebx
  8869 00006DA2 29D6                <2> 	sub esi, edx
  8870 00006DA4 29D6                <2> 	sub esi, edx
  8871 00006DA6 01DF                <2> 	add edi, ebx
  8872 00006DA8 01DF                <2> 	add edi, ebx
  8873 00006DAA 29D7                <2> 	sub edi, edx
  8874 00006DAC 29D7                <2> 	sub edi, edx
  8875                              <2> .notover:
  8876 00006DAE 29DF                <2> 	sub edi, ebx
  8877 00006DB0 29DF                <2> 	sub edi, ebx
  8878 00006DB2 29D7                <2> 	sub edi, edx
  8879 00006DB4 29D7                <2> 	sub edi, edx
  8880 00006DB6 49                  <2> 	dec ecx
  8881 00006DB7 81F900000000        <2> 	cmp ecx, 0
  8882 00006DBD 77A0                <2> 	ja ldxbmp2
  8883                              <2> endedbmp:
  8884 00006DBF E844030000          <2> 	call switchmousepos2
  8885 00006DC4 C3                  <2> 	ret
  8886                              <2> 	
  8887 00006DC5 00000000            <2> 	bmpend dd 0
  8888                              <1> %include "source/gui/circle.asm"
  8889                              <2> drawcircle:	;center in (dx,cx), color in si, radius in ax
  8890 00006DC9 55                  <2> 	push ebp
  8891 00006DCA 663D0000            <2> 	cmp ax, 0
  8892 00006DCE 770A                <2> 	ja .nozerocircle
  8893 00006DD0 E8F61B0000          <2> 	call putpixel	;the easiest circle ever
  8894 00006DD5 E9F7000000          <2> 	jmp .done
  8895                              <2> .nozerocircle:
  8896 00006DDA 6689F5              <2> 	mov bp, si
  8897 00006DDD 6650                <2> 	push ax
  8898 00006DDF E8281C0000          <2> 	call getpixelmem
  8899 00006DE4 31C0                <2> 	xor eax, eax
  8900 00006DE6 6658                <2> 	pop ax
  8901 00006DE8 BE01000000          <2> 	mov esi, 1
  8902 00006DED 29C6                <2> 	sub esi, eax
  8903 00006DEF 89C1                <2> 	mov ecx, eax
  8904 00006DF1 31C0                <2> 	xor eax, eax
  8905 00006DF3 66A1[525B0000]      <2> 	mov ax, [resolutionx2]
  8906 00006DF9 F7E1                <2> 	mul ecx
  8907 00006DFB 50                  <2> 	push eax
  8908 00006DFC 31D2                <2> 	xor edx, edx
  8909 00006DFE 01C7                <2> 	add edi, eax
  8910 00006E00 66892F              <2> 	mov [edi], bp
  8911 00006E03 29C7                <2> 	sub edi, eax
  8912 00006E05 29C7                <2> 	sub edi, eax
  8913 00006E07 66892F              <2> 	mov [edi], bp
  8914 00006E0A 01C7                <2> 	add edi, eax
  8915 00006E0C D1E1                <2> 	shl ecx, 1
  8916 00006E0E 01CF                <2> 	add edi, ecx
  8917 00006E10 66892F              <2> 	mov [edi], bp
  8918 00006E13 D1E1                <2> 	shl ecx, 1
  8919 00006E15 29CF                <2> 	sub edi, ecx
  8920 00006E17 66892F              <2> 	mov [edi], bp
  8921 00006E1A D1E9                <2> 	shr ecx, 1
  8922 00006E1C 01CF                <2> 	add edi, ecx
  8923 00006E1E D1E9                <2> 	shr ecx, 1
  8924 00006E20 B802000000          <2> 	mov eax, 2
  8925 00006E25 F7E1                <2> 	mul ecx
  8926 00006E27 48                  <2> 	dec eax
  8927 00006E28 F7D0                <2> 	not eax ;make it negative
  8928 00006E2A A3[D76E0000]        <2> 	mov [.ddF_y], eax
  8929 00006E2F 58                  <2> 	pop eax
  8930 00006E30 BB01000000          <2> 	mov ebx, 1
  8931 00006E35 891D[D36E0000]      <2> 	mov [.ddF_x], ebx
  8932 00006E3B 4B                  <2> 	dec ebx
  8933 00006E3C 31D2                <2> 	xor edx, edx
  8934 00006E3E E904000000          <2> 	jmp .lp
  8935                              <2> .lpb:
  8936 00006E43 D1EA                <2> 	shr edx, 1
  8937 00006E45 D1E9                <2> 	shr ecx, 1
  8938                              <2> .lp:	;it starts this with the center in edi
  8939                              <2> 		;color in bp
  8940                              <2> 		;ddF_x in memory
  8941                              <2> 		;x*resolutionx2 in ebx
  8942                              <2> 		;x in edx
  8943                              <2> 		;ddF_y in memory
  8944                              <2> 		;y*resolutionx2 in eax
  8945                              <2> 		;f in esi
  8946                              <2> 		;y in ecx
  8947 00006E47 81FE00000080        <2> 	cmp esi, 0x80000000 ;this means it is not negative
  8948 00006E4D 7717                <2> 	ja	.noddF_y
  8949 00006E4F 49                  <2> 	dec ecx
  8950 00006E50 2B05[525B0000]      <2> 	sub eax, [resolutionx2]
  8951 00006E56 8105[D76E0000]0200- <2> 	add dword [.ddF_y], 2
  8952 00006E5E 0000                <2>
  8953 00006E60 0335[D76E0000]      <2> 	add esi, [.ddF_y]
  8954                              <2> .noddF_y:
  8955 00006E66 42                  <2> 	inc edx
  8956 00006E67 031D[525B0000]      <2> 	add ebx, [resolutionx2]
  8957 00006E6D 8105[D36E0000]0200- <2> 	add dword [.ddF_x], 2
  8958 00006E75 0000                <2>
  8959 00006E77 0335[D36E0000]      <2> 	add esi, [.ddF_x]
  8960                              <2> 
  8961 00006E7D D1E2                <2> 	shl edx, 1
  8962 00006E7F D1E1                <2> 	shl ecx, 1
  8963 00006E81 01D7                <2> 	add edi, edx
  8964 00006E83 01C7                <2> 	add edi, eax
  8965 00006E85 66892F              <2> 	mov [edi], bp	;(cx+x,cy+y)
  8966 00006E88 D1E2                <2> 	shl edx, 1
  8967 00006E8A 29D7                <2> 	sub edi, edx
  8968 00006E8C 66892F              <2> 	mov [edi], bp	;(cx-x,cy+y)
  8969 00006E8F D1E0                <2> 	shl eax, 1
  8970 00006E91 29C7                <2> 	sub edi, eax
  8971 00006E93 66892F              <2> 	mov [edi], bp	;(cx-x,cy-y)
  8972 00006E96 01D7                <2> 	add edi, edx
  8973 00006E98 66892F              <2> 	mov [edi], bp	;(cx+x,cy-y)
  8974 00006E9B D1E8                <2> 	shr eax, 1
  8975 00006E9D D1EA                <2> 	shr edx, 1
  8976 00006E9F 01C7                <2> 	add edi, eax
  8977 00006EA1 29D7                <2> 	sub edi, edx
  8978                              <2> 
  8979 00006EA3 39D1                <2> 	cmp ecx, edx
  8980 00006EA5 749C                <2> 	je .lpb
  8981                              <2> 
  8982 00006EA7 01DF                <2> 	add edi, ebx
  8983 00006EA9 01CF                <2> 	add edi, ecx
  8984 00006EAB 66892F              <2> 	mov [edi], bp	;(cx+y,cy+x)
  8985 00006EAE D1E1                <2> 	shl ecx, 1
  8986 00006EB0 29CF                <2> 	sub edi, ecx
  8987 00006EB2 66892F              <2> 	mov [edi], bp	;(cx-y,cy+x)
  8988 00006EB5 D1E3                <2> 	shl ebx, 1
  8989 00006EB7 29DF                <2> 	sub edi, ebx
  8990 00006EB9 66892F              <2> 	mov [edi], bp	;(cx-y,cy-x)
  8991 00006EBC 01CF                <2> 	add edi, ecx
  8992 00006EBE 66892F              <2> 	mov [edi], bp	;(cx+y,cy-x)
  8993 00006EC1 D1EB                <2> 	shr ebx, 1
  8994 00006EC3 D1E9                <2> 	shr ecx, 1
  8995 00006EC5 01DF                <2> 	add edi, ebx
  8996 00006EC7 29CF                <2> 	sub edi, ecx
  8997 00006EC9 39CA                <2> 	cmp edx, ecx
  8998 00006ECB 0F8272FFFFFF        <2> 	jb .lpb
  8999                              <2> .done:
  9000 00006ED1 5D                  <2> 	pop ebp
  9001 00006ED2 C3                  <2> 	ret
  9002                              <2> 	
  9003 00006ED3 00000000            <2> .ddF_x dd 0
  9004 00006ED7 00000000            <2> .ddF_y dd 0
  9005                              <2> 
  9006                              <2> fillcircle:	;center in (dx,cx), color in si, radius in ax
  9007 00006EDB 55                  <2> 	push ebp
  9008 00006EDC 663D0000            <2> 	cmp ax, 0
  9009 00006EE0 770A                <2> 	ja .nozerocircle
  9010 00006EE2 E8E41A0000          <2> 	call putpixel	;the easiest circle ever
  9011 00006EE7 E95A010000          <2> 	jmp .done
  9012                              <2> .nozerocircle:
  9013 00006EEC 6689F5              <2> 	mov bp, si
  9014 00006EEF 6650                <2> 	push ax
  9015 00006EF1 E8161B0000          <2> 	call getpixelmem
  9016 00006EF6 31C0                <2> 	xor eax, eax
  9017 00006EF8 6658                <2> 	pop ax
  9018 00006EFA BE01000000          <2> 	mov esi, 1
  9019 00006EFF 29C6                <2> 	sub esi, eax
  9020 00006F01 89C1                <2> 	mov ecx, eax
  9021 00006F03 31C0                <2> 	xor eax, eax
  9022 00006F05 66A1[525B0000]      <2> 	mov ax, [resolutionx2]
  9023 00006F0B F7E1                <2> 	mul ecx
  9024 00006F0D 50                  <2> 	push eax
  9025 00006F0E 31D2                <2> 	xor edx, edx
  9026 00006F10 01C7                <2> 	add edi, eax
  9027 00006F12 66892F              <2> 	mov [edi], bp
  9028 00006F15 29C7                <2> 	sub edi, eax
  9029 00006F17 29C7                <2> 	sub edi, eax
  9030 00006F19 66892F              <2> 	mov [edi], bp
  9031 00006F1C 01C7                <2> 	add edi, eax
  9032 00006F1E D1E1                <2> 	shl ecx, 1
  9033 00006F20 01CF                <2> 	add edi, ecx
  9034 00006F22 51                  <2> 	push ecx
  9035                              <2> .s0:
  9036 00006F23 66892F              <2> 	mov [edi], bp
  9037 00006F26 81EF02000000        <2> 	sub edi, 2
  9038 00006F2C 49                  <2> 	dec ecx
  9039 00006F2D 81F900000000        <2> 	cmp ecx, 0
  9040 00006F33 75EE                <2> 	jne .s0
  9041 00006F35 66892F              <2> 	mov [edi], bp
  9042 00006F38 59                  <2> 	pop ecx
  9043 00006F39 01CF                <2> 	add edi, ecx
  9044 00006F3B D1E9                <2> 	shr ecx, 1
  9045 00006F3D B802000000          <2> 	mov eax, 2
  9046 00006F42 F7E1                <2> 	mul ecx
  9047 00006F44 48                  <2> 	dec eax
  9048 00006F45 F7D0                <2> 	not eax ;make it negative
  9049 00006F47 A3[4C700000]        <2> 	mov [.ddF_y], eax
  9050 00006F4C 58                  <2> 	pop eax
  9051 00006F4D BB01000000          <2> 	mov ebx, 1
  9052 00006F52 891D[48700000]      <2> 	mov [.ddF_x], ebx
  9053 00006F58 4B                  <2> 	dec ebx
  9054 00006F59 31D2                <2> 	xor edx, edx
  9055 00006F5B E904000000          <2> 	jmp .lp
  9056                              <2> .lpb:
  9057 00006F60 D1EA                <2> 	shr edx, 1
  9058 00006F62 D1E9                <2> 	shr ecx, 1
  9059                              <2> .lp:	;it starts this with the center in edi
  9060                              <2> 		;color in bp
  9061                              <2> 		;ddF_x in memory
  9062                              <2> 		;x*resolutionx2 in ebx
  9063                              <2> 		;x in edx
  9064                              <2> 		;ddF_y in memory
  9065                              <2> 		;y*resolutionx2 in eax
  9066                              <2> 		;f in esi
  9067                              <2> 		;y in ecx
  9068 00006F64 81FE00000080        <2> 	cmp esi, 0x80000000 ;this means it is not negative
  9069 00006F6A 7717                <2> 	ja	.noddF_y
  9070 00006F6C 49                  <2> 	dec ecx
  9071 00006F6D 2B05[525B0000]      <2> 	sub eax, [resolutionx2]
  9072 00006F73 8105[4C700000]0200- <2> 	add dword [.ddF_y], 2
  9073 00006F7B 0000                <2>
  9074 00006F7D 0335[4C700000]      <2> 	add esi, [.ddF_y]
  9075                              <2> .noddF_y:
  9076 00006F83 42                  <2> 	inc edx
  9077 00006F84 031D[525B0000]      <2> 	add ebx, [resolutionx2]
  9078 00006F8A 8105[48700000]0200- <2> 	add dword [.ddF_x], 2
  9079 00006F92 0000                <2>
  9080 00006F94 0335[48700000]      <2> 	add esi, [.ddF_x]
  9081                              <2> 
  9082 00006F9A D1E2                <2> 	shl edx, 1
  9083 00006F9C D1E1                <2> 	shl ecx, 1
  9084 00006F9E 52                  <2> 	push edx
  9085 00006F9F 29D7                <2> 	sub edi, edx
  9086 00006FA1 01C7                <2> 	add edi, eax
  9087 00006FA3 81FA00000000        <2> 	cmp edx, 0
  9088 00006FA9 7412                <2> 	je .nos1
  9089                              <2> .s1:
  9090 00006FAB 66892F              <2> 	mov [edi], bp	;(cx-x,cy+y)
  9091 00006FAE 81C702000000        <2> 	add edi, 2
  9092 00006FB4 4A                  <2> 	dec edx
  9093 00006FB5 81FA00000000        <2> 	cmp edx, 0
  9094 00006FBB 75EE                <2> 	jne .s1
  9095                              <2> .nos1:
  9096 00006FBD 66892F              <2> 	mov [edi], bp
  9097 00006FC0 5A                  <2> 	pop edx
  9098 00006FC1 52                  <2> 	push edx
  9099 00006FC2 29C7                <2> 	sub edi, eax
  9100 00006FC4 29C7                <2> 	sub edi, eax
  9101 00006FC6 81FA00000000        <2> 	cmp edx, 0
  9102 00006FCC 7412                <2> 	je .nos2
  9103                              <2> .s2:
  9104 00006FCE 66892F              <2> 	mov [edi], bp	;(cx+x,cy-y)
  9105 00006FD1 81EF02000000        <2> 	sub edi, 2
  9106 00006FD7 4A                  <2> 	dec edx
  9107 00006FD8 81FA00000000        <2> 	cmp edx, 0
  9108 00006FDE 75EE                <2> 	jne .s2
  9109                              <2> .nos2:
  9110 00006FE0 66892F              <2> 	mov [edi], bp
  9111 00006FE3 5A                  <2> 	pop edx
  9112 00006FE4 01C7                <2> 	add edi, eax	;(cx-x,cy-y)
  9113 00006FE6 01D7                <2> 	add edi, edx
  9114                              <2> 
  9115 00006FE8 39D1                <2> 	cmp ecx, edx
  9116 00006FEA 0F8470FFFFFF        <2> 	je .lpb
  9117                              <2> 
  9118 00006FF0 51                  <2> 	push ecx
  9119 00006FF1 01DF                <2> 	add edi, ebx
  9120 00006FF3 29CF                <2> 	sub edi, ecx
  9121 00006FF5 81F900000000        <2> 	cmp ecx, 0
  9122 00006FFB 7412                <2> 	je .nos3
  9123                              <2> .s3:
  9124 00006FFD 66892F              <2> 	mov [edi], bp	;(cx-y,cy+x)
  9125 00007000 81C702000000        <2> 	add edi, 2
  9126 00007006 49                  <2> 	dec ecx
  9127 00007007 81F900000000        <2> 	cmp ecx, 0
  9128 0000700D 75EE                <2> 	jne .s3
  9129                              <2> .nos3:
  9130 0000700F 66892F              <2> 	mov [edi], bp
  9131 00007012 59                  <2> 	pop ecx
  9132 00007013 51                  <2> 	push ecx
  9133 00007014 29DF                <2> 	sub edi, ebx
  9134 00007016 29DF                <2> 	sub edi, ebx
  9135 00007018 81F900000000        <2> 	cmp ecx, 0
  9136 0000701E 7412                <2> 	je .nos4
  9137                              <2> .s4:
  9138 00007020 66892F              <2> 	mov [edi], bp	;(cx+y,cy-x)
  9139 00007023 81EF02000000        <2> 	sub edi, 2
  9140 00007029 49                  <2> 	dec ecx
  9141 0000702A 81F900000000        <2> 	cmp ecx, 0
  9142 00007030 75EE                <2> 	jne .s4
  9143                              <2> .nos4:
  9144 00007032 66892F              <2> 	mov [edi], bp
  9145 00007035 59                  <2> 	pop ecx
  9146 00007036 01DF                <2> 	add edi, ebx	;(cx-y,cy-x)
  9147 00007038 01CF                <2> 	add edi, ecx
  9148                              <2> 
  9149 0000703A D1EA                <2> 	shr edx, 1
  9150 0000703C D1E9                <2> 	shr ecx, 1
  9151 0000703E 39CA                <2> 	cmp edx, ecx
  9152 00007040 0F821EFFFFFF        <2> 	jb .lp
  9153                              <2> .done:
  9154 00007046 5D                  <2> 	pop ebp
  9155 00007047 C3                  <2> 	ret
  9156                              <2> 	
  9157 00007048 00000000            <2> .ddF_x dd 0
  9158 0000704C 00000000            <2> .ddF_y dd 0
  9159                              <1> %include "source/gui/cursor.asm"
  9160                              <2> clearmousecursor:
  9161 00007050 BE[B8730000]        <2> 		mov esi, background
  9162 00007055 8B3D[7A5A0000]      <2> 		mov edi, [physbaseptr]
  9163 0000705B 31D2                <2> 		xor edx, edx
  9164 0000705D 31C9                <2> 		xor ecx, ecx
  9165 0000705F 668B15[445D0000]    <2> 		mov dx, [lastmouseposition]
  9166 00007066 668B0D[465D0000]    <2> 		mov cx, [lastmouseposition + 2]
  9167 0000706D 01D7                <2> 		add edi, edx
  9168 0000706F 31D2                <2> 		xor edx, edx
  9169 00007071 668B15[525B0000]    <2> 		mov dx, [resolutionx2]
  9170 00007078 81F900000000        <2> 		cmp ecx, 0
  9171 0000707E 7408                <2> 		je .nomul
  9172 00007080 52                  <2> 		push edx
  9173 00007081 89D0                <2> 		mov eax, edx
  9174 00007083 F7E1                <2> 		mul ecx
  9175 00007085 01C7                <2> 		add edi, eax
  9176 00007087 5A                  <2> 		pop edx
  9177                              <2> .nomul:
  9178                              <2> %ifdef 	gui.background
  9179                              <2> 		cmp dword [backgroundimage], 0
  9180                              <2> 		je .noyclr
  9181                              <2> 		mov esi, [backgroundimage]
  9182                              <2> 		sub edi, [physbaseptr]
  9183                              <2> 		add esi, edi
  9184                              <2> 		add edi, [physbaseptr]
  9185                              <2> .backlp:
  9186                              <2> 		xor ebx, ebx
  9187                              <2> .noyback:
  9188                              <2> 		mov eax, [esi + ebx]
  9189                              <2> 		mov [edi + ebx], eax
  9190                              <2> 		add ebx, 4
  9191                              <2> 		cmp ebx, 16
  9192                              <2> 		jne .noyback
  9193                              <2> 		add edi, edx
  9194                              <2> 		add esi, edx
  9195                              <2> 		inc cx
  9196                              <2> 		cmp cx, 16
  9197                              <2> 		jb .backlp
  9198                              <2> 		ret
  9199                              <2> %endif
  9200                              <2> .noyclr:
  9201 00007088 668B06              <2> 		mov ax, [esi]
  9202 0000708B C1C010              <2> 		rol eax, 16
  9203 0000708E 668B06              <2> 		mov ax, [esi]
  9204 00007091 8907                <2> 		mov [edi], eax
  9205 00007093 894704              <2> 		mov [edi + 4], eax
  9206 00007096 894708              <2> 		mov [edi + 8], eax
  9207 00007099 89470C              <2> 		mov [edi + 12], eax
  9208 0000709C 01D7                <2> 		add edi, edx
  9209 0000709E 6641                <2> 		inc cx
  9210 000070A0 6681F91000          <2> 		cmp cx, 16
  9211 000070A5 72E1                <2> 		jb .noyclr
  9212 000070A7 C3                  <2> 		ret
  9213                              <2> 
  9214                              <2> switchmousepos:		;;switch were the mouse is located
  9215 000070A8 BE[9DD40300]        <2> 		mov esi, mousecolorbuf
  9216 000070AD 8B3D[7A5A0000]      <2> 		mov edi, [physbaseptr]
  9217 000070B3 31D2                <2> 		xor edx, edx
  9218 000070B5 31C9                <2> 		xor ecx, ecx
  9219 000070B7 668B15[445D0000]    <2> 		mov dx, [lastmouseposition]
  9220 000070BE 668B0D[465D0000]    <2> 		mov cx, [lastmouseposition + 2]
  9221 000070C5 01D7                <2> 		add edi, edx
  9222 000070C7 31D2                <2> 		xor edx, edx
  9223 000070C9 668B15[525B0000]    <2> 		mov dx, [resolutionx2]
  9224 000070D0 6681F90000          <2> 		cmp cx, 0
  9225 000070D5 740B                <2> 		je noswmsy
  9226 000070D7 01D7                <2> swmsy:		add edi, edx
  9227 000070D9 6649                <2> 		dec cx
  9228 000070DB 6681F90000          <2> 		cmp cx, 0
  9229 000070E0 75F5                <2> 		jne swmsy
  9230 000070E2 8B06                <2> noswmsy:	mov eax, [esi]
  9231 000070E4 8B5E04              <2> 		mov ebx, [esi + 4]
  9232 000070E7 8907                <2> 		mov [edi], eax
  9233 000070E9 895F04              <2> 		mov [edi + 4], ebx
  9234 000070EC 8B4608              <2> 		mov eax, [esi + 8]
  9235 000070EF 8B5E0C              <2> 		mov ebx, [esi + 12]
  9236 000070F2 894708              <2> 		mov [edi + 8], eax
  9237 000070F5 895F0C              <2> 		mov [edi + 12], ebx
  9238 000070F8 01D7                <2> 		add edi, edx
  9239 000070FA 81C610000000        <2> 		add esi, 16
  9240 00007100 81FE[9DD50300]      <2> 		cmp esi, mcolorend
  9241 00007106 72DA                <2> 		jb noswmsy
  9242                              <2> 		
  9243                              <2> switchmousepos2:
  9244 00007108 BE[9DD40300]        <2> 		mov esi, mousecolorbuf
  9245 0000710D 8B3D[7A5A0000]      <2> 		mov edi, [physbaseptr]
  9246 00007113 31D2                <2> 		xor edx, edx
  9247 00007115 31C9                <2> 		xor ecx, ecx
  9248 00007117 668B15[485D0000]    <2> 		mov dx, [mousecursorposition]
  9249 0000711E 668B0D[4A5D0000]    <2> 		mov cx, [mousecursorposition + 2]
  9250 00007125 01D7                <2> 		add edi, edx
  9251 00007127 31D2                <2> 		xor edx, edx
  9252 00007129 668B15[525B0000]    <2> 		mov dx, [resolutionx2]
  9253 00007130 6681F90000          <2> 		cmp cx, 0
  9254 00007135 740B                <2> 		je noswmsy2
  9255 00007137 01D7                <2> swmsy2:		add edi, edx
  9256 00007139 6649                <2> 		dec cx
  9257 0000713B 6681F90000          <2> 		cmp cx, 0
  9258 00007140 75F5                <2> 		jne swmsy2
  9259 00007142 8B07                <2> noswmsy2:	mov eax, [edi]
  9260 00007144 8B5F04              <2> 		mov ebx, [edi + 4]
  9261 00007147 8906                <2> 		mov [esi], eax
  9262 00007149 895E04              <2> 		mov [esi + 4], ebx
  9263 0000714C 8B4708              <2> 		mov eax, [edi + 8]
  9264 0000714F 8B5F0C              <2> 		mov ebx, [edi + 12]
  9265 00007152 894608              <2> 		mov [esi + 8], eax
  9266 00007155 895E0C              <2> 		mov [esi + 12], ebx
  9267 00007158 01D7                <2> 		add edi, edx
  9268 0000715A 81C610000000        <2> 		add esi, 16
  9269 00007160 81FE[9DD50300]      <2> 		cmp esi, mcolorend
  9270 00007166 72DA                <2> 		jb noswmsy2
  9271 00007168 C3                  <2> 		ret
  9272                              <2> 		
  9273                              <1> %include "source/gui/icon.asm"
  9274 00007169 0000                <2> iconcolor dw 0
  9275                              <2> 	showicon:	;;icon in si, position in (dx,cx), selected in ax, code in bx
  9276 0000716B A2[348A0000]        <2> 		mov [iconselected], al
  9277 00007170 8025[348A0000]01    <2> 		and byte [iconselected], 1
  9278 00007177 B401                <2> 		mov ah, 1
  9279 00007179 E8DF150000          <2> 		call graphicsadd
  9280                              <2> 	showicon2:
  9281 0000717E 8B3D[7A5A0000]      <2> 		mov edi, [physbaseptr]
  9282 00007184 6601D2              <2> 		add dx, dx
  9283 00007187 663B15[525B0000]    <2> 		cmp dx, [resolutionx2]
  9284 0000718E 720C                <2> 		jb screenxgood
  9285 00007190 668B15[525B0000]    <2> 		mov dx, [resolutionx2]
  9286 00007197 6681EA4000          <2> 		sub dx, 64
  9287                              <2> 	screenxgood:
  9288 0000719C 6681F90000          <2> 		cmp cx, 0
  9289 000071A1 742B                <2> 		je noscreenygoodchk
  9290 000071A3 663B0D[665A0000]    <2> 		cmp cx, [resolutiony]
  9291 000071AA 720C                <2> 		jb screenygood
  9292 000071AC 668B0D[665A0000]    <2> 		mov cx, [resolutiony]
  9293 000071B3 6681E92000          <2> 		sub cx, 32
  9294                              <2> 	screenygood:
  9295 000071B8 50                  <2> 		push eax
  9296 000071B9 52                  <2> 		push edx
  9297 000071BA 31C0                <2> 		xor eax, eax
  9298 000071BC 31DB                <2> 		xor ebx, ebx
  9299 000071BE 668B1D[525B0000]    <2> 		mov bx, [resolutionx2]
  9300 000071C5 6689C8              <2> 		mov ax, cx
  9301 000071C8 F7E3                <2> 		mul ebx
  9302 000071CA 01C7                <2> 		add edi, eax
  9303 000071CC 5A                  <2> 		pop edx
  9304 000071CD 58                  <2> 		pop eax
  9305                              <2> 	noscreenygoodchk:
  9306 000071CE 31DB                <2> 		xor ebx, ebx
  9307 000071D0 6689D3              <2> 		mov bx, dx
  9308 000071D3 01DF                <2> 		add edi, ebx
  9309 000071D5 6631C9              <2> 		xor cx, cx
  9310 000071D8 668B06              <2> 		mov ax, [esi]
  9311 000071DB 81C602000000        <2> 		add esi, 2
  9312 000071E1 66A3[69710000]      <2> 		mov [iconcolor], ax
  9313                              <2> 	writeicon:
  9314 000071E7 8B06                <2> 		mov eax, [esi]
  9315 000071E9 D1C0                <2> 		rol eax, 1
  9316 000071EB 30C9                <2> 		xor cl, cl
  9317                              <2> 	writeiconline:
  9318 000071ED B201                <2> 		mov dl, 1
  9319 000071EF 20C2                <2> 		and dl, al
  9320 000071F1 3215[348A0000]      <2> 		xor dl, [iconselected]
  9321 000071F7 668B1D[B8730000]    <2> 		mov bx, [background]
  9322 000071FE 66891F              <2> 		mov [edi], bx
  9323 00007201 80FA00              <2> 		cmp dl, 0
  9324 00007204 740A                <2> 		je noiconline
  9325 00007206 668B15[69710000]    <2> 		mov dx, [iconcolor]
  9326 0000720D 668917              <2> 		mov [edi], dx
  9327                              <2> 	noiconline:
  9328 00007210 81C702000000        <2> 		add edi, 2
  9329 00007216 D1C0                <2> 		rol eax, 1
  9330 00007218 FEC1                <2> 		inc cl
  9331 0000721A 80F920              <2> 		cmp cl, 32
  9332 0000721D 72CE                <2> 		jb writeiconline
  9333 0000721F 81C604000000        <2> 		add esi, 4
  9334 00007225 FEC5                <2> 		inc ch
  9335 00007227 31D2                <2> 		xor edx, edx
  9336 00007229 668B15[525B0000]    <2> 		mov dx, [resolutionx2]
  9337 00007230 01D7                <2> 		add edi, edx
  9338 00007232 81EF40000000        <2> 		sub edi, 64
  9339 00007238 80FD20              <2> 		cmp ch, 32
  9340 0000723B 72AA                <2> 		jb writeicon
  9341 0000723D 31C0                <2> 		xor eax, eax
  9342 0000723F C3                  <2> 		ret
  9343                              <1> %include "source/gui/line.asm"
  9344                              <2> drawline:	;from (bx,ax) to (dx,cx), color in si
  9345 00007240 668935[62730000]    <2> 	mov [.color], si
  9346 00007247 C605[64730000]00    <2> 	mov byte [.steep], 0
  9347 0000724E C605[65730000]00    <2> 	mov byte [.yreversed], 0
  9348 00007255 E907000000          <2> 	jmp .notsteep
  9349                              <2> .steeploop:
  9350 0000725A C605[64730000]01    <2> 	mov byte [.steep], 1
  9351                              <2> .notsteep:
  9352 00007261 31FF                <2> 	xor edi, edi
  9353 00007263 31F6                <2> 	xor esi, esi
  9354 00007265 6639DA              <2> 	cmp dx, bx
  9355 00007268 7705                <2> 	ja .noreversex
  9356 0000726A 6687D3              <2> 	xchg dx, bx
  9357 0000726D 6691                <2> 	xchg cx, ax
  9358                              <2> .noreversex:
  9359 0000726F 6689D7              <2> 	mov di, dx
  9360 00007272 6629DF              <2> 	sub di, bx
  9361                              <2> 	
  9362 00007275 6639C1              <2> 	cmp cx, ax
  9363 00007278 720B                <2> 	jb .reversey
  9364 0000727A 6689CE              <2> 	mov si, cx
  9365 0000727D 6629C6              <2> 	sub si, ax
  9366 00007280 E90D000000          <2> 	jmp .normal
  9367                              <2> .reversey:
  9368 00007285 C605[65730000]02    <2> 	mov byte [.yreversed], 2
  9369 0000728C 6689C6              <2> 	mov si, ax
  9370 0000728F 6629CE              <2> 	sub si, cx	
  9371                              <2> .normal:
  9372 00007292 6687CA              <2> 	xchg cx, dx
  9373 00007295 6693                <2> 	xchg ax, bx
  9374 00007297 6639FE              <2> 	cmp si, di
  9375 0000729A 77BE                <2> 	ja .steeploop
  9376 0000729C 6687CA              <2> 	xchg cx, dx
  9377 0000729F 6693                <2> 	xchg ax, bx
  9378                              <2> 	
  9379 000072A1 6691                <2> 	xchg ax, cx
  9380 000072A3 6687DA              <2> 	xchg bx, dx
  9381 000072A6 66893D[68730000]    <2> 	mov [.xdelta], di
  9382 000072AD 668935[6A730000]    <2> 	mov [.ydelta], si
  9383 000072B4 668B35[62730000]    <2> 	mov si, [.color]
  9384 000072BB 66891D[66730000]    <2> 	mov [.endline], bx
  9385 000072C2 6652                <2> 	push dx
  9386 000072C4 6651                <2> 	push cx
  9387 000072C6 6687CA              <2> 	xchg cx, dx
  9388 000072C9 803D[64730000]01    <2> 	cmp byte [.steep], 1
  9389 000072D0 7403                <2> 	je .xchg
  9390 000072D2 6687D1              <2> 	xchg dx, cx
  9391                              <2> .xchg:
  9392 000072D5 E832170000          <2> 	call getpixelmem	;get pointer to pixel in edi from (dx,cx)
  9393 000072DA 6659                <2> 	pop cx
  9394 000072DC 665A                <2> 	pop dx
  9395 000072DE 31C0                <2> 	xor eax, eax
  9396 000072E0 66A1[68730000]      <2> 	mov ax, [.xdelta]
  9397 000072E6 66D1E8              <2> 	shr ax, 1
  9398 000072E9 8A0D[64730000]      <2> 	mov cl, [.steep]
  9399 000072EF 0A0D[65730000]      <2> 	or cl, [.yreversed]
  9400 000072F5 55                  <2> 	push ebp
  9401 000072F6 668B2D[66730000]    <2> 	mov bp, [.endline]
  9402 000072FD 6629D5              <2> 	sub bp, dx
  9403 00007300 668B15[6A730000]    <2> 	mov dx, [.ydelta]
  9404                              <2> .lp:
  9405 00007307 668937              <2> 	mov [edi], si
  9406 0000730A 6639D0              <2> 	cmp ax, dx
  9407 0000730D 7332                <2> 	jae .noaddx
  9408 0000730F F6C102              <2> 	test cl, 2
  9409 00007312 7414                <2> 	jz .nodecy
  9410 00007314 F6C101              <2> 	test cl, 1
  9411 00007317 7509                <2> 	jnz .steepy
  9412 00007319 29DF                <2> 	sub edi, ebx
  9413 0000731B 29DF                <2> 	sub edi, ebx
  9414 0000731D E906000000          <2> 	jmp .nodecy
  9415                              <2> .steepy:
  9416 00007322 81EF04000000        <2> 	sub edi, 4
  9417                              <2> .nodecy:
  9418 00007328 660305[68730000]    <2> 	add ax, [.xdelta]
  9419 0000732F F6C101              <2> 	test cl, 1
  9420 00007332 7507                <2> 	jnz .steepx
  9421 00007334 01DF                <2> 	add edi, ebx
  9422 00007336 E906000000          <2> 	jmp .noaddx
  9423                              <2> .steepx:
  9424 0000733B 81C702000000        <2> 	add edi, 2
  9425                              <2> .noaddx:
  9426 00007341 6629D0              <2> 	sub ax, dx
  9427 00007344 664D                <2> 	dec bp
  9428 00007346 81C702000000        <2> 	add edi, 2
  9429 0000734C F6C101              <2> 	test cl, 1
  9430 0000734F 7408                <2> 	jz .nosteepx
  9431 00007351 81EF02000000        <2> 	sub edi, 2
  9432 00007357 01DF                <2> 	add edi, ebx
  9433                              <2> .nosteepx:
  9434 00007359 6681FD0000          <2> 	cmp bp, 0
  9435 0000735E 75A7                <2> 	jne .lp
  9436                              <2> .done:
  9437 00007360 5D                  <2> 	pop ebp
  9438 00007361 C3                  <2> 	ret
  9439                              <2> 	
  9440 00007362 0000                <2> .color dw 0
  9441 00007364 00                  <2> .steep db 0
  9442 00007365 00                  <2> .yreversed db 0
  9443 00007366 0000                <2> .endline dw 0
  9444 00007368 0000                <2> .xdelta dw 0
  9445 0000736A 0000                <2> .ydelta dw 0
  9446                              <1> %include "source/gui/refresh.asm"
  9447                              <2> guiclear:
  9448 0000736C 8B3D[7A5A0000]      <2> 	mov edi, [physbaseptr]
  9449 00007372 668B15[645A0000]    <2> 	mov dx, [resolutionx]
  9450 00007379 668B0D[665A0000]    <2> 	mov cx, [resolutiony]
  9451 00007380 668B1D[B8730000]    <2> 	mov bx, [background]
  9452 00007387 66891D[BA730000]    <2> 	mov [background + 2], bx
  9453                              <2> %ifdef gui.background
  9454                              <2> 	cmp dword [backgroundimage], 0
  9455                              <2> 	je guiclear.noback
  9456                              <2> 		mov esi, [backgroundimage]
  9457                              <2> 	.lp:
  9458                              <2> 		;movdqa xmm0, [esi]	;the next 4 lines are for SSE
  9459                              <2> 		;movdqa [edi], xmm0
  9460                              <2> 		;add esi, 16
  9461                              <2> 		;add edi, 16
  9462                              <2> 		;sub dx, 8
  9463                              <2> 		mov eax, [esi]
  9464                              <2> 		mov [edi], eax
  9465                              <2> 		add esi, 4
  9466                              <2> 		add edi, 4
  9467                              <2> 		sub dx, 2
  9468                              <2> 		cmp dx, 0
  9469                              <2> 		ja .lp
  9470                              <2> 		dec cx
  9471                              <2> 		mov dx, [resolutionx]
  9472                              <2> 		cmp cx, 0
  9473                              <2> 		ja .lp
  9474                              <2> 		ret
  9475                              <2> 	backgroundimage dd 0
  9476                              <2> %endif
  9477                              <2> guiclear.noback:
  9478 0000738E A1[B8730000]        <2> 	mov eax, [background]
  9479                              <2> guiclearloop:
  9480 00007393 8907                <2> 	mov [edi], eax
  9481 00007395 81C704000000        <2> 	add edi, 4
  9482 0000739B 6681EA0200          <2> 	sub dx, 2
  9483 000073A0 6681FA0000          <2> 	cmp dx, 0
  9484 000073A5 77EC                <2> 	ja guiclearloop
  9485 000073A7 6649                <2> 	dec cx
  9486 000073A9 668B15[645A0000]    <2> 	mov dx, [resolutionx]
  9487 000073B0 6681F90000          <2> 	cmp cx, 0
  9488 000073B5 77DC                <2> 	ja guiclearloop
  9489 000073B7 C3                  <2> 	ret
  9490                              <2> 
  9491 000073B8 CF7B<rept>          <2> background times 2 dw 0111101111001111b
  9492                              <2> 	.original equ 0111101111001111b
  9493                              <2> 
  9494                              <2> reloadallgraphics:
  9495 000073BC BF[9DD20300]        <2> 		mov edi, graphicstable
  9496                              <2> reloadgraphicsloop:
  9497 000073C1 8B7702              <2> 		mov esi, [edi + 2]
  9498 000073C4 668B5706            <2> 		mov dx, [edi + 6]
  9499 000073C8 668B4F08            <2> 		mov cx, [edi + 8]
  9500 000073CC 668B07              <2> 		mov ax, [edi]
  9501 000073CF 668B5F0A            <2> 		mov bx, [edi + 10]
  9502 000073D3 893D[49870000]      <2> 		mov [grpctblpos], edi
  9503 000073D9 3B3D[E0810000]      <2> 		cmp edi, [dragging]
  9504 000073DF 741E                <2> 		je loadedgraphic
  9505 000073E1 663D0100            <2> 		cmp ax, 1
  9506 000073E5 0F8436000000        <2> 		je near icongraphic
  9507 000073EB 663D0200            <2> 		cmp ax, 2
  9508 000073EF 0F843C000000        <2> 		je near stringgraphic
  9509 000073F5 663D0300            <2> 		cmp ax, 3
  9510 000073F9 0F8416000000        <2> 		je near windowgraphic
  9511 000073FF 8B3D[49870000]      <2> loadedgraphic:  mov edi, [grpctblpos]
  9512 00007405 81C710000000        <2> 		add edi, 16
  9513 0000740B 81FF[9DD40300]      <2> 		cmp edi, graphicstableend
  9514 00007411 732E                <2> 		jae donereloadgraphics
  9515 00007413 EBAC                <2> 		jmp reloadgraphicsloop
  9516                              <2> windowgraphic:
  9517 00007415 E827090000          <2> 		call showwindow2
  9518 0000741A E82DAAFFFF          <2> 		call cleardouble
  9519 0000741F EBDE                <2> 		jmp loadedgraphic
  9520 00007421 80E301              <2> icongraphic:	and bl, 1
  9521 00007424 881D[348A0000]      <2> 		mov [iconselected], bl
  9522 0000742A E84FFDFFFF          <2> 		call showicon2
  9523 0000742F EBCE                <2> 		jmp loadedgraphic
  9524 00007431 80E301              <2> stringgraphic:  and bl, 1
  9525 00007434 881D[DC810000]      <2> 		mov [mouseselecton], bl
  9526 0000743A E8CE050000          <2> 		call showstring2
  9527 0000743F EBBE                <2> 		jmp loadedgraphic
  9528                              <2> donereloadgraphics:
  9529 00007441 8B3D[E0810000]      <2> 		mov edi, [dragging]
  9530 00007447 81FF[9DD20300]      <2> 		cmp edi, graphicstable
  9531 0000744D 7226                <2> 		jb notcorrectdrag
  9532 0000744F 668B07              <2> 		mov ax, [edi]
  9533 00007452 8B7702              <2> 		mov esi, [edi + 2]
  9534 00007455 668B5706            <2> 		mov dx, [edi + 6]
  9535 00007459 668B4F08            <2> 		mov cx, [edi + 8]
  9536 0000745D 668B5F0A            <2> 		mov bx, [edi + 10]
  9537 00007461 663D0100            <2> 		cmp ax, 1
  9538 00007465 750F                <2> 		jne noticondragging
  9539 00007467 80E301              <2> 		and bl, 1
  9540 0000746A 881D[348A0000]      <2> 		mov [iconselected], bl
  9541 00007470 E809FDFFFF          <2> 		call showicon2
  9542                              <2> notcorrectdrag:
  9543 00007475 C3                  <2> 		ret
  9544                              <2> 
  9545                              <2> 	noticondragging:
  9546 00007476 663D0200            <2> 		cmp ax, 2
  9547 0000747A 75F9                <2> 		jne notcorrectdrag
  9548 0000747C 80E301              <2> 		and bl, 1
  9549 0000747F 881D[DC810000]      <2> 		mov [mouseselecton], bl
  9550 00007485 E883050000          <2> 		call showstring2
  9551 0000748A EBE9                <2> 		jmp notcorrectdrag
  9552                              <1> %include "source/gui/square.asm"
  9553                              <2> drawsquare:	;from (bx,ax) to (dx,cx), color in si
  9554 0000748C 6639D3              <2> 	cmp bx, dx
  9555 0000748F 7303                <2> 	jae .noxchgx
  9556 00007491 6687DA              <2> 	xchg bx, dx
  9557                              <2> .noxchgx:
  9558 00007494 6639C8              <2> 	cmp ax, cx
  9559 00007497 7302                <2> 	jae .noxchgy
  9560 00007499 6691                <2> 	xchg ax, cx
  9561                              <2> .noxchgy:
  9562 0000749B 6650                <2> 	push ax
  9563 0000749D 6653                <2> 	push bx
  9564 0000749F 6652                <2> 	push dx
  9565 000074A1 E866150000          <2> 	call getpixelmem	;get pointer to pixel in edi from (dx,cx)
  9566 000074A6 31D2                <2> 	xor edx, edx
  9567 000074A8 665A                <2> 	pop dx
  9568 000074AA 31DB                <2> 	xor ebx, ebx
  9569 000074AC 665B                <2> 	pop bx
  9570 000074AE 6658                <2> 	pop ax
  9571                              <2> .lp0:
  9572 000074B0 6652                <2> 	push dx
  9573                              <2> .lp:
  9574 000074B2 668937              <2> 	mov [edi], si
  9575 000074B5 81C702000000        <2> 	add edi, 2
  9576 000074BB 6642                <2> 	inc dx
  9577 000074BD 6639DA              <2> 	cmp dx, bx
  9578 000074C0 76F0                <2> 	jbe .lp
  9579 000074C2 665A                <2> 	pop dx
  9580 000074C4 81EF02000000        <2> 	sub edi, 2
  9581 000074CA 29DF                <2> 	sub edi, ebx
  9582 000074CC 29DF                <2> 	sub edi, ebx
  9583 000074CE 01D7                <2> 	add edi, edx
  9584 000074D0 01D7                <2> 	add edi, edx
  9585 000074D2 033D[525B0000]      <2> 	add edi, [resolutionx2]
  9586 000074D8 6641                <2> 	inc cx
  9587 000074DA 6639C1              <2> 	cmp cx, ax
  9588 000074DD 7203                <2> 	jb .lp2
  9589 000074DF 74CF                <2> 	je .lp0
  9590 000074E1 C3                  <2> 	ret
  9591                              <2> .lp2:
  9592 000074E2 57                  <2> 	push edi
  9593 000074E3 668937              <2> 	mov [edi], si
  9594 000074E6 29D7                <2> 	sub edi, edx
  9595 000074E8 29D7                <2> 	sub edi, edx
  9596 000074EA 01DF                <2> 	add edi, ebx
  9597 000074EC 01DF                <2> 	add edi, ebx
  9598 000074EE 668937              <2> 	mov [edi], si
  9599 000074F1 5F                  <2> 	pop edi
  9600 000074F2 033D[525B0000]      <2> 	add edi, [resolutionx2]
  9601 000074F8 6641                <2> 	inc cx
  9602 000074FA 6639C1              <2> 	cmp cx, ax
  9603 000074FD 72E3                <2> 	jb .lp2
  9604 000074FF EBAF                <2> 	jmp .lp0
  9605                              <2> 
  9606                              <2> fillsquare:	;from (bx,ax) to (dx,cx), color in si
  9607 00007501 6639D3              <2> 	cmp bx, dx
  9608 00007504 7303                <2> 	jae .noxchgx
  9609 00007506 6687DA              <2> 	xchg bx, dx
  9610                              <2> .noxchgx:
  9611 00007509 6639C8              <2> 	cmp ax, cx
  9612 0000750C 7302                <2> 	jae .noxchgy
  9613 0000750E 6691                <2> 	xchg ax, cx
  9614                              <2> .noxchgy:
  9615 00007510 6650                <2> 	push ax
  9616 00007512 6653                <2> 	push bx
  9617 00007514 6652                <2> 	push dx
  9618 00007516 E8F1140000          <2> 	call getpixelmem	;get pointer to pixel in edi from (dx,cx)
  9619 0000751B 31D2                <2> 	xor edx, edx
  9620 0000751D 665A                <2> 	pop dx
  9621 0000751F 31DB                <2> 	xor ebx, ebx
  9622 00007521 665B                <2> 	pop bx
  9623 00007523 6658                <2> 	pop ax
  9624                              <2> .lp2:
  9625 00007525 6652                <2> 	push dx
  9626                              <2> .lp:
  9627 00007527 668937              <2> 	mov [edi], si
  9628 0000752A 81C702000000        <2> 	add edi, 2
  9629 00007530 6642                <2> 	inc dx
  9630 00007532 6639DA              <2> 	cmp dx, bx
  9631 00007535 76F0                <2> 	jbe .lp
  9632 00007537 665A                <2> 	pop dx
  9633 00007539 81EF02000000        <2> 	sub edi, 2
  9634 0000753F 29DF                <2> 	sub edi, ebx
  9635 00007541 29DF                <2> 	sub edi, ebx
  9636 00007543 01D7                <2> 	add edi, edx
  9637 00007545 01D7                <2> 	add edi, edx
  9638 00007547 033D[525B0000]      <2> 	add edi, [resolutionx2]
  9639 0000754D 6641                <2> 	inc cx
  9640 0000754F 6639C1              <2> 	cmp cx, ax
  9641 00007552 76D1                <2> 	jbe .lp2
  9642 00007554 C3                  <2> 	ret
  9643                              <1> %include "source/gui/startup.asm"
  9644                              <2> guisetup:
  9645                              <2> 	%ifdef gui.background
  9646                              <2> 	xor ebx, ebx
  9647                              <2> 	mov [backgroundimage], ebx
  9648                              <2> 	%endif
  9649 00007555 E812FEFFFF          <2> 	call guiclear
  9650 0000755A C605[F98E0000]01    <2> 	mov byte [guion], 1
  9651 00007561 C605[DC810000]00    <2> 	mov byte [mouseselecton], 0
  9652 00007568 31C0                <2> 	xor eax, eax
  9653 0000756A 31DB                <2> 	xor ebx, ebx
  9654 0000756C 31C9                <2> 	xor ecx, ecx
  9655 0000756E 31D2                <2> 	xor edx, edx
  9656                              <2> 	
  9657 00007570 BE[32770000]        <2> 	mov esi, pacmsg
  9658 00007575 30E4                <2> 	xor ah, ah
  9659 00007577 B010                <2> 	mov al, 00010000b
  9660 00007579 31DB                <2> 	xor ebx, ebx
  9661 0000757B 66B99000            <2> 	mov cx, 144
  9662 0000757F 66BA0400            <2> 	mov dx, 4
  9663 00007583 E872040000          <2> 	call showstring
  9664                              <2> 	
  9665 00007588 BE[70770000]        <2> 	mov esi, interneticon
  9666 0000758D 30E4                <2> 	xor ah, ah
  9667 0000758F B010                <2> 	mov al, 00010000b
  9668 00007591 BB[5B760000]        <2> 	mov ebx, noie
  9669 00007596 66B91800            <2> 	mov cx, 24
  9670 0000759A 66BA0400            <2> 	mov dx, 4
  9671 0000759E E8C8FBFFFF          <2> 	call showicon
  9672                              <2> 	
  9673 000075A3 BE[F2770000]        <2> 	mov esi, wordicon
  9674 000075A8 30E4                <2> 	xor ah, ah
  9675 000075AA B010                <2> 	mov al, 00010000b
  9676 000075AC 31DB                <2> 	xor ebx, ebx
  9677 000075AE 66B91800            <2> 	mov cx, 24
  9678 000075B2 66BA3000            <2> 	mov dx, 48
  9679 000075B6 E8B0FBFFFF          <2> 	call showicon
  9680                              <2> 	
  9681 000075BB BE[74780000]        <2> 	mov esi, pacmanpellet
  9682 000075C0 30E4                <2> 	xor ah, ah
  9683 000075C2 B010                <2> 	mov al, 00010000b
  9684 000075C4 31DB                <2> 	xor ebx, ebx
  9685 000075C6 66B94000            <2> 	mov cx, 64
  9686 000075CA 66BA0400            <2> 	mov dx, 4
  9687 000075CE E898FBFFFF          <2> 	call showicon
  9688                              <2> 	
  9689 000075D3 BE[78790000]        <2> 	mov esi, pacman
  9690 000075D8 30E4                <2> 	xor ah, ah
  9691 000075DA B010                <2> 	mov al, 00010000b
  9692 000075DC BB[44760000]        <2> 	mov ebx, pacmannomnom
  9693 000075E1 66B94000            <2> 	mov cx, 64
  9694 000075E5 66BA3000            <2> 	mov dx, 48
  9695 000075E9 E87DFBFFFF          <2> 	call showicon
  9696                              <2> 	
  9697 000075EE BE[F6780000]        <2> 	mov esi, ghostie
  9698 000075F3 30E4                <2> 	xor ah, ah
  9699 000075F5 B010                <2> 	mov al, 00010000b
  9700 000075F7 BB[2D760000]        <2> 	mov ebx, boo
  9701 000075FC 66B96C00            <2> 	mov cx, 108
  9702 00007600 66BA0400            <2> 	mov dx, 4
  9703 00007604 E862FBFFFF          <2> 	call showicon
  9704                              <2> 	
  9705 00007609 BE[14770000]        <2> 	mov esi, start
  9706 0000760E 668B0D[665A0000]    <2> 	mov cx, [resolutiony]
  9707 00007615 6681E91000          <2> 	sub cx, 16
  9708 0000761A 66BA0200            <2> 	mov dx, 2
  9709 0000761E 30E4                <2> 	xor ah, ah
  9710 00007620 B010                <2> 	mov al, 00010000b
  9711 00007622 BB[D0760000]        <2> 	mov ebx, winblows
  9712 00007627 E8CE030000          <2> 	call showstring
  9713                              <2> 
  9714                              <2> %ifdef gui.time	
  9715                              <2> 	call guitime	;load time into timeshow/dateshow and show it
  9716                              <2> %endif
  9717 0000762C C3                  <2> 	ret
  9718                              <2> 
  9719                              <2> 	boo:
  9720 0000762D BE[2D770000]        <2> 		mov esi, boomsg
  9721 00007632 66BA6400            <2> 		mov dx, 100
  9722 00007636 66B94001            <2> 		mov cx, 320
  9723 0000763A 31DB                <2> 		xor ebx, ebx
  9724 0000763C 6631C0              <2> 		xor ax, ax
  9725 0000763F E9B6030000          <2> 		jmp showstring
  9726                              <2> 
  9727                              <2> 	pacmannomnom:
  9728 00007644 BE[4B770000]        <2> 		mov esi, pacnom
  9729 00007649 66BA8200            <2> 		mov dx, 130
  9730 0000764D 66B93C00            <2> 		mov cx, 60
  9731 00007651 31DB                <2> 		xor ebx, ebx
  9732 00007653 6631C0              <2> 		xor ax, ax
  9733 00007656 E99F030000          <2> 		jmp showstring	
  9734                              <2> 	
  9735                              <2> 	noie:
  9736 0000765B 66C705[5A770000]80- <2> 		mov word [termwindow], 640
  9737 00007663 02                  <2>
  9738 00007664 66C705[5C770000]E0- <2> 		mov word [termwindow + 2], 480	;the previous lines of code make a large terminal window that is 4 characters smaller than the screen
  9739 0000766C 01                  <2>
  9740 0000766D BE[5A770000]        <2> 		mov esi, termwindow
  9741 00007672 66BA1000            <2> 		mov dx, 16
  9742 00007676 66B91000            <2> 		mov cx, 16
  9743 0000767A 31DB                <2> 		xor ebx, ebx
  9744 0000767C 6631C0              <2> 		xor ax, ax
  9745 0000767F E803060000          <2> 		call showwindow
  9746 00007684 E9ACB4FFFF          <2> 		jmp os
  9747                              <2> 
  9748                              <2> 	gotomenuboot:
  9749 00007689 31D2                <2> 		xor edx, edx
  9750 0000768B 31C9                <2> 		xor ecx, ecx
  9751 0000768D 668B15[645A0000]    <2> 		mov dx, [resolutionx]
  9752 00007694 668B0D[665A0000]    <2> 		mov cx, [resolutiony]
  9753 0000769B 66C1E904            <2> 		shr cx, 4
  9754 0000769F 6681E90100          <2> 		sub cx, 1
  9755 000076A4 66C1E104            <2> 		shl cx, 4
  9756 000076A8 668915[5A770000]    <2> 		mov [termwindow], dx
  9757 000076AF 66890D[5C770000]    <2> 		mov [termwindow + 2], cx	;the previous lines of code make a large terminal window that is fullscreen
  9758 000076B6 BE[5A770000]        <2> 		mov esi, termwindow
  9759 000076BB 6631D2              <2> 		xor dx, dx
  9760 000076BE 6631C9              <2> 		xor cx, cx
  9761 000076C1 31DB                <2> 		xor ebx, ebx
  9762 000076C3 6631C0              <2> 		xor ax, ax
  9763 000076C6 E8BC050000          <2> 		call showwindow
  9764 000076CB E965B4FFFF          <2> 		jmp os
  9765                              <2> 
  9766                              <2> 	winblows:
  9767 000076D0 BE[23770000]        <2> 		mov esi, turnoffmsg
  9768 000076D5 BB[BF550000]        <2> 		mov ebx, turnoff
  9769 000076DA 668B0D[665A0000]    <2> 		mov cx, [resolutiony]
  9770 000076E1 6681E92000          <2> 		sub cx, 32
  9771 000076E6 6631D2              <2> 		xor dx, dx
  9772 000076E9 30E4                <2> 		xor ah, ah
  9773 000076EB B010                <2> 		mov al, 00010000b
  9774 000076ED E808030000          <2> 		call showstring
  9775 000076F2 BE[1A770000]        <2> 		mov esi, gotomenu
  9776 000076F7 668B0D[665A0000]    <2> 		mov cx, [resolutiony]
  9777 000076FE 6681E93000          <2> 		sub cx, 48
  9778 00007703 6631D2              <2> 		xor dx, dx
  9779 00007706 30E4                <2> 		xor ah, ah
  9780 00007708 B010                <2> 		mov al, 00010000b
  9781 0000770A BB[89760000]        <2> 		mov ebx, gotomenuboot
  9782 0000770F E9E6020000          <2> 		jmp showstring
  9783                              <2> 		
  9784                              <2> 
  9785 00007714 737461727400        <2> 	start	db "start",0
  9786 0000771A 536F6C6C65724F5300  <2> 	gotomenu db "SollerOS",0
  9787 00007723 506F776572204F6666- <2> 	turnoffmsg db "Power Off",0
  9788 0000772C 00                  <2>
  9789 0000772D 426F6F2100          <2> 	boomsg db "Boo!",0
  9790 00007732 5061636D616E207761- <2> 	pacmsg	db "Pacman was easy to draw.",0
  9791 0000773B 73206561737920746F- <2>
  9792 00007744 20647261772E00      <2>
  9793 0000774B 4F6D206E6F6D206E6F- <2> 	pacnom  db "Om nom nom nom",0
  9794 00007754 6D206E6F6D00        <2>
  9795                              <2> 
  9796 0000775A 20035802            <2> 	termwindow:	dw 800,600	;window size
  9797 0000775E FFFF0000            <2> 				dw 0xFFFF,0	;colors(FG,BG)
  9798 00007762 [9ED50300]-         <2> 				dd videobuf,videobuf2 ;location of buffers
  9799 00007766 [E6AA0400]          <2>
  9800 0000776A 534855536800        <2> 	termmsg:	db "SHUSh",0	;window title
  9801                              <2> 	
  9802 0000776A <incbin>            <2> interneticon: 	incbin 'source/gui/icons/internet'
  9803 0000776A <incbin>            <2> wordicon: 	incbin 'source/gui/icons/word'
  9804 0000776A <incbin>            <2> pacmanpellet: incbin 'source/gui/icons/pellet'
  9805 0000776A <incbin>            <2> ghostie	incbin 'source/gui/icons/ghostie'
  9806 0000776A <incbin>            <2> pacman	incbin 'source/gui/icons/pacman'
  9807                              <2> 
  9808                              <2> %ifdef gui.time
  9809                              <2> guitime:
  9810                              <2> 		call time	;get rtc in timeshow & dateshow
  9811                              <2> 		xor ebx, ebx
  9812                              <2> 		mov dx, [resolutionx2]
  9813                              <2> 		xor cx, cx
  9814                              <2> 		sub dx, 304
  9815                              <2> 		mov esi, dateshow
  9816                              <2> 		mov al, 00010001b
  9817                              <2> 		call showstring
  9818                              <2> 		mov esi, timeshow
  9819                              <2> 		xor ebx, ebx
  9820                              <2> 		mov al, 00010001b
  9821                              <2> 		call showstring
  9822                              <2> 		ret
  9823                              <2> %endif
  9824                              <1> %include "source/gui/text.asm"
  9825                              <2> 	showstring:
  9826 000079FA A2[DC810000]        <2> 		mov [mouseselecton], al
  9827 000079FF 8025[DC810000]01    <2> 		and byte [mouseselecton], 1
  9828 00007A06 B402                <2> 		mov ah, 2
  9829 00007A08 E8500D0000          <2> 		call graphicsadd
  9830                              <2> 	showstring2:	;location in (dx,cx), color in [colorfont2] and [background]
  9831 00007A0D 30E4                <2> 		xor ah, ah
  9832 00007A0F 8A06                <2> 		mov al, [esi]
  9833 00007A11 3CC0                <2> 		cmp al, 0xC0
  9834 00007A13 7234                <2> 		jb .doneutf
  9835 00007A15 3CE0                <2> 		cmp al, 0xE0
  9836 00007A17 721D                <2> 		jb .two
  9837 00007A19 46                  <2> 		inc esi
  9838 00007A1A 668B1E              <2> 		mov bx, [esi]
  9839 00007A1D 46                  <2> 		inc esi
  9840 00007A1E C0E004              <2> 		shl al, 4
  9841 00007A21 66C1E302            <2> 		shl bx, 2
  9842 00007A25 C0EF02              <2> 		shr bh, 2
  9843 00007A28 66C1EB02            <2> 		shr bx, 2
  9844 00007A2C 08C7                <2> 		or bh, al
  9845 00007A2E 6689D8              <2> 		mov ax, bx
  9846 00007A31 E913000000          <2> 		jmp .doneutf
  9847                              <2> 	.two:
  9848 00007A36 8A3E                <2> 		mov bh, [esi]
  9849 00007A38 46                  <2> 		inc esi
  9850 00007A39 8A1E                <2> 		mov bl, [esi]
  9851 00007A3B 66C1E302            <2> 		shl bx, 2
  9852 00007A3F C0EF02              <2> 		shr bh, 2
  9853 00007A42 66C1EB02            <2> 		shr bx, 2
  9854 00007A46 6689D8              <2> 		mov ax, bx
  9855                              <2> 	.doneutf:
  9856 00007A49 3C00                <2> 		cmp al, 0
  9857 00007A4B 7420                <2> 		je doneshowstring
  9858 00007A4D 46                  <2> 		inc esi
  9859 00007A4E 3CFF                <2> 		cmp al, 255
  9860 00007A50 74BB                <2> 		je showstring2
  9861 00007A52 56                  <2> 		push esi
  9862 00007A53 668B1D[757A0000]    <2> 		mov bx, [colorfont2]
  9863 00007A5A E827000000          <2> 		call showfontvesa
  9864 00007A5F 663D0A00            <2> 		cmp ax, 10
  9865 00007A63 7405                <2> 		je noproceedshst
  9866 00007A65 6681C20800          <2> 		add dx, 8
  9867                              <2> 	noproceedshst:
  9868 00007A6A 5E                  <2> 		pop esi
  9869 00007A6B EBA0                <2> 		jmp showstring2
  9870                              <2> 	doneshowstring:
  9871 00007A6D C605[DC810000]00    <2> 		mov byte [mouseselecton], 0
  9872 00007A74 C3                  <2> 		ret
  9873                              <2> 
  9874 00007A75 FFFF                <2> colorfont2 dw 0xFFFF
  9875 00007A77 00                  <2> colorcache db 0
  9876                              <2> 
  9877 00007A78 02                  <2> resolutionbytes db 2
  9878 00007A79 0000                <2> posxvesa dw 0
  9879 00007A7B 0000                <2> posyvesa dw 0
  9880 00007A7D FFFF                <2> colorfont dw 0xFFFF
  9881                              <2> savefontvesa:		;same rules as showfontvesa
  9882 00007A7F C605[DB810000]01    <2> 	mov byte [savefonton], 1
  9883                              <2> showfontvesa:		;position in (dx,cx), color in bx, char in ax
  9884 00007A86 663DFF00            <2> 	cmp ax, 255
  9885 00007A8A 7501                <2> 	jne nostopshowfont
  9886 00007A8C C3                  <2> 	ret
  9887                              <2> nostopshowfont:
  9888 00007A8D 55                  <2> 	push ebp
  9889 00007A8E 66890D[7B7A0000]    <2> 	mov [posyvesa], cx
  9890 00007A95 663D0A00            <2> 	cmp ax, 10
  9891 00007A99 0F8424000000        <2> 	je near goodvesafontx
  9892 00007A9F 31C9                <2> 	xor ecx, ecx
  9893 00007AA1 668B0D[525B0000]    <2> 	mov cx, [resolutionx2]
  9894 00007AA8 6639CA              <2> 	cmp dx, cx
  9895 00007AAB 7616                <2> 	jbe goodvesafontx
  9896 00007AAD 6631D2              <2> 	xor dx, dx
  9897 00007AB0 668B0D[7B7A0000]    <2> 	mov cx, [posyvesa]
  9898 00007AB7 6681C11000          <2> 	add cx, 16
  9899 00007ABC 66890D[7B7A0000]    <2> 	mov [posyvesa], cx
  9900                              <2> goodvesafontx:
  9901 00007AC3 668B0D[7B7A0000]    <2> 	mov cx, [posyvesa]
  9902 00007ACA 668915[797A0000]    <2> 	mov [posxvesa], dx
  9903 00007AD1 8B3D[7A5A0000]      <2> 	mov edi, [physbaseptr]
  9904 00007AD7 66891D[7D7A0000]    <2> 	mov [colorfont], bx
  9905 00007ADE 668B2D[7D7A0000]    <2> 	mov bp, [colorfont]
  9906 00007AE5 31DB                <2> 	xor ebx, ebx
  9907 00007AE7 6689C3              <2> 	mov bx, ax
  9908 00007AEA 31C0                <2> 	xor eax, eax
  9909 00007AEC 6689D8              <2> 	mov ax, bx
  9910 00007AEF 6689D3              <2> 	mov bx, dx
  9911 00007AF2 89DA                <2> 	mov edx, ebx
  9912 00007AF4 31DB                <2> 	xor ebx, ebx
  9913 00007AF6 6681F90000          <2> 	cmp cx, 0
  9914 00007AFB 7414                <2> 	je vesaposloopdn
  9915 00007AFD 668B1D[525B0000]    <2> 	mov bx, [resolutionx2]
  9916                              <2> vesaposloop:
  9917 00007B04 52                  <2> 	push edx
  9918 00007B05 50                  <2> 	push eax
  9919 00007B06 31C0                <2> 	xor eax, eax
  9920 00007B08 6689C8              <2> 	mov ax, cx
  9921 00007B0B F7E3                <2> 	mul ebx
  9922 00007B0D 01C7                <2> 	add edi, eax
  9923 00007B0F 58                  <2> 	pop eax
  9924 00007B10 5A                  <2> 	pop edx
  9925                              <2> vesaposloopdn:
  9926 00007B11 01D7                <2> 	add edi, edx
  9927 00007B13 BE[53910000]        <2> 	mov esi, fonts
  9928                              <2> findfontvesa:
  9929 00007B18 663D0A00            <2> 	cmp ax, 10
  9930 00007B1C 0F84EB000000        <2> 	je near nwlinevesa
  9931 00007B22 C1E004              <2> 	shl eax, 4
  9932 00007B25 01C6                <2> 	add esi, eax
  9933 00007B27 C1E804              <2> 	shr eax, 4
  9934 00007B2A 81FE[53910300]      <2> 	cmp esi, fontend
  9935 00007B30 0F83AB000000        <2> 	jae near donefontvesa
  9936 00007B36 4E                  <2> 	dec esi
  9937                              <2> foundfontvesa:
  9938 00007B37 46                  <2> 	inc esi
  9939 00007B38 803D[DB810000]01    <2> 	cmp byte [savefonton], 1
  9940 00007B3F 0F84E7000000        <2> 	je near vesafontsaver
  9941 00007B45 30C9                <2> 	xor cl, cl
  9942 00007B47 8A06                <2> 	mov al, [esi]
  9943 00007B49 668B15[525B0000]    <2> 	mov dx, [resolutionx2]
  9944 00007B50 662B15[797A0000]    <2> 	sub dx, [posxvesa]
  9945 00007B57 6681FA1000          <2> 	cmp dx, 16
  9946 00007B5C 7708                <2> 	ja paintfontvesa
  9947 00007B5E D0EA                <2> 	shr dl, 1
  9948 00007B60 8815[0C7C0000]      <2> 	mov [charwidth], dl
  9949                              <2> paintfontvesa:
  9950 00007B66 B201                <2> 	mov dl, 1
  9951 00007B68 20C2                <2> 	and dl, al
  9952 00007B6A 803D[DA810000]01    <2> 	cmp byte [showcursorfonton], 1
  9953 00007B71 0F842E000000        <2> 	je near nodelpaintedfont
  9954 00007B77 803D[DA810000]02    <2> 	cmp byte [showcursorfonton], 2
  9955 00007B7E 0F8511000000        <2> 	jne near noswitchcursorfonton
  9956 00007B84 80FA00              <2> 	cmp dl, 0
  9957 00007B87 0F8420000000        <2> 	je near nopixelset
  9958 00007B8D 66892F              <2> 	mov [edi], bp
  9959 00007B90 E918000000          <2> 	jmp nopixelset
  9960                              <2> noswitchcursorfonton:
  9961 00007B95 3215[DC810000]      <2> 	xor dl, [mouseselecton]
  9962 00007B9B 668B1D[B8730000]    <2> 	mov bx, [background]
  9963 00007BA2 66891F              <2> 	mov [edi], bx
  9964                              <2> nodelpaintedfont:
  9965 00007BA5 80FA00              <2> 	cmp dl, 0
  9966 00007BA8 7403                <2> 	je nopixelset
  9967 00007BAA 66892F              <2> 	mov [edi], bp
  9968                              <2> nopixelset:
  9969 00007BAD 81C702000000        <2> 	add edi, 2
  9970 00007BB3 D0C0                <2> 	rol al, 1
  9971 00007BB5 FEC1                <2> 	inc cl
  9972 00007BB7 3A0D[0C7C0000]      <2> 	cmp cl, [charwidth]
  9973 00007BBD 72A7                <2> 	jb paintfontvesa
  9974 00007BBF FEC5                <2> 	inc ch
  9975 00007BC1 31D2                <2> 	xor edx, edx
  9976 00007BC3 668B15[525B0000]    <2> 	mov dx, [resolutionx2]
  9977 00007BCA 01D7                <2> 	add edi, edx
  9978 00007BCC 31D2                <2> 	xor edx, edx
  9979 00007BCE 8A15[0C7C0000]      <2> 	mov dl, [charwidth]
  9980 00007BD4 00D2                <2> 	add dl, dl
  9981 00007BD6 29D7                <2> 	sub edi, edx
  9982 00007BD8 80FD10              <2> 	cmp ch, 16
  9983 00007BDB 0F8256FFFFFF        <2> 	jb foundfontvesa
  9984                              <2> donefontvesa:
  9985 00007BE1 C605[0C7C0000]08    <2> 	mov byte [charwidth], 8
  9986 00007BE8 668B15[797A0000]    <2> 	mov dx, [posxvesa]
  9987 00007BEF 8A1D[0C7C0000]      <2> 	mov bl, [charwidth]
  9988 00007BF5 30FF                <2> 	xor bh, bh
  9989 00007BF7 6601DA              <2> 	add dx, bx
  9990 00007BFA 6689EB              <2> 	mov bx, bp
  9991 00007BFD 668B0D[7B7A0000]    <2> 	mov cx, [posyvesa]
  9992 00007C04 883D[DB810000]      <2> 	mov [savefonton], bh
  9993 00007C0A 5D                  <2> 	pop ebp
  9994 00007C0B C3                  <2> 	ret
  9995 00007C0C 08                  <2> charwidth db 8
  9996                              <2> nwlinevesa:
  9997 00007C0D 6631D2              <2> 	xor dx, dx
  9998 00007C10 668915[797A0000]    <2> 	mov [posxvesa], dx
  9999 00007C17 668B0D[7B7A0000]    <2> 	mov cx, [posyvesa]
 10000 00007C1E 6681C11000          <2> 	add cx, 16
 10001 00007C23 66890D[7B7A0000]    <2> 	mov [posyvesa], cx
 10002 00007C2A EBB5                <2> 	jmp donefontvesa
 10003                              <2> vesafontsaver:
 10004 00007C2C 30C0                <2> 	xor al, al
 10005 00007C2E 30C9                <2> 	xor cl, cl
 10006                              <2> vesafontsaver2:
 10007 00007C30 66392F              <2> 	cmp [edi], bp
 10008 00007C33 742C                <2> 	je colorfontmatch
 10009                              <2> donecolormatch:
 10010 00007C35 81C702000000        <2> 	add edi, 2
 10011 00007C3B D0C0                <2> 	rol al, 1
 10012 00007C3D FEC1                <2> 	inc cl
 10013 00007C3F 80F908              <2> 	cmp cl, 8
 10014 00007C42 72EC                <2> 	jb vesafontsaver2
 10015 00007C44 8806                <2> 	mov [esi], al
 10016 00007C46 46                  <2> 	inc esi
 10017 00007C47 FEC5                <2> 	inc ch
 10018 00007C49 31D2                <2> 	xor edx, edx
 10019 00007C4B 668B15[525B0000]    <2> 	mov dx, [resolutionx2]
 10020 00007C52 01D7                <2> 	add edi, edx
 10021 00007C54 81EF10000000        <2> 	sub edi, 16
 10022 00007C5A 80FD10              <2> 	cmp ch, 16
 10023 00007C5D 72CD                <2> 	jb vesafontsaver
 10024 00007C5F EB80                <2> 	jmp donefontvesa
 10025                              <2> colorfontmatch:
 10026 00007C61 0401                <2> 	add al, 1
 10027 00007C63 EBD0                <2> 	jmp donecolormatch
 10028                              <1> %include "source/gui/window.asm"
 10029 00007C65 0000                <2> winvcopystx dw 0
 10030 00007C67 0000                <2> winvcopysty dw 0
 10031 00007C69 0000                <2> winvcopydx dw 0
 10032 00007C6B 0000                <2> winvcopycx dw 0
 10033 00007C6D FFFF0000            <2> windowcolor dw 0xFFFF,0
 10034 00007C71 00000000            <2> windowbufloc: dd 0
 10035 00007C75 00000000            <2> windowvideobuf dd 0
 10036 00007C79 00000000            <2> windowvideobuf2 dd 0
 10037 00007C7D 00000000            <2> windowinfobuf dd 0
 10038 00007C81 0000                <2> termcol dw 0
 10039 00007C83 00000000            <2> wincopyendpos dd 0
 10040                              <2> 
 10041                              <2> 	showwindow:	;windowstuff in esi, position in (dx, cx), nothing in ax, code in ebx
 10042 00007C87 C605[E5230000]01    <2> 		mov byte [termguion], 1
 10043 00007C8E 6681C11000          <2> 		add cx, 16
 10044 00007C93 668915[657C0000]    <2> 		mov [winvcopystx], dx
 10045 00007C9A 66890D[677C0000]    <2> 		mov [winvcopysty], cx
 10046 00007CA1 8935[7D7C0000]      <2> 		mov [windowinfobuf], esi
 10047 00007CA7 668B16              <2> 		mov dx, [esi]
 10048 00007CAA 668B4E02            <2> 		mov cx, [esi + 2]
 10049 00007CAE 31C0                <2> 		xor eax, eax
 10050 00007CB0 31DB                <2> 		xor ebx, ebx
 10051 00007CB2 6689D0              <2> 		mov ax, dx
 10052 00007CB5 6689CB              <2> 		mov bx, cx
 10053 00007CB8 66C1E803            <2> 		shr ax, 3
 10054 00007CBC 66C1EB04            <2> 		shr bx, 4
 10055 00007CC0 66A3[817C0000]      <2> 		mov [termcol], ax
 10056 00007CC6 A2[DA250000]        <2> 		mov [charxy], al
 10057 00007CCB 881D[DB250000]      <2> 		mov [charxy + 1], bl
 10058 00007CD1 8B7E04              <2> 		mov edi, [esi + 4]
 10059 00007CD4 893D[6D7C0000]      <2> 		mov [windowcolor], edi
 10060 00007CDA 8B7E0C              <2> 		mov edi, [esi + 12]
 10061 00007CDD 893D[797C0000]      <2> 		mov [windowvideobuf2], edi
 10062 00007CE3 8B7E08              <2> 		mov edi, [esi + 8]
 10063 00007CE6 893D[757C0000]      <2> 		mov [windowvideobuf], edi
 10064 00007CEC 81FB00000000        <2> 		cmp ebx, 0
 10065 00007CF2 0F84C1040000        <2> 		je near donewincopynow
 10066                              <2> 	findendposwin:
 10067 00007CF8 C1E002              <2> 		shl eax, 2
 10068 00007CFB 31D2                <2> 		xor edx, edx
 10069 00007CFD F7E3                <2> 		mul ebx
 10070 00007CFF 01C7                <2> 		add edi, eax
 10071 00007D01 893D[837C0000]      <2> 		mov [wincopyendpos], edi
 10072 00007D07 31FF                <2> 		xor edi, edi
 10073 00007D09 6631C0              <2> 		xor ax, ax
 10074 00007D0C 6631DB              <2> 		xor bx, bx
 10075 00007D0F 6601D2              <2> 		add dx, dx
 10076 00007D12 668915[697C0000]    <2> 		mov [winvcopydx], dx
 10077 00007D19 66890D[6B7C0000]    <2> 		mov [winvcopycx], cx
 10078 00007D20 668B0D[677C0000]    <2> 		mov cx, [winvcopysty]
 10079 00007D27 6681E91000          <2> 		sub cx, 16
 10080 00007D2C 668B15[657C0000]    <2> 		mov dx, [winvcopystx]
 10081 00007D33 C605[E6230000]00    <2> 		mov byte [termcopyon], 0
 10082 00007D3A B403                <2> 		mov ah, 3
 10083 00007D3C E81C0A0000          <2> 		call graphicsadd
 10084                              <2> 	showwindow2:
 10085 00007D41 6681C11000          <2> 		add cx, 16
 10086 00007D46 668915[657C0000]    <2> 		mov [winvcopystx], dx
 10087 00007D4D 66890D[677C0000]    <2> 		mov [winvcopysty], cx
 10088 00007D54 668B16              <2> 		mov dx, [esi]
 10089 00007D57 668B4E02            <2> 		mov cx, [esi + 2]
 10090 00007D5B 6601D2              <2> 		add dx, dx
 10091 00007D5E 668915[697C0000]    <2> 		mov [winvcopydx], dx
 10092 00007D65 66890D[6B7C0000]    <2> 		mov [winvcopycx], cx
 10093 00007D6C E818000000          <2> 		call reloadwindowtitle
 10094 00007D71 803D[44870000]01    <2> 		cmp byte [windrag], 1
 10095 00007D78 0F834A040000        <2> 		jae near forgetresetstuff
 10096 00007D7E 8B3D[717C0000]      <2> 		mov edi, [windowbufloc]
 10097 00007D84 E96E020000          <2> 		jmp windowvideocopyset
 10098                              <2> 		
 10099                              <2> 	reloadwindowtitle:
 10100 00007D89 8B3D[717C0000]      <2> 		mov edi, [windowbufloc]
 10101 00007D8F 31D2                <2> 		xor edx, edx
 10102 00007D91 668B15[525B0000]    <2> 		mov dx, [resolutionx2]
 10103 00007D98 C1E204              <2> 		shl edx, 4
 10104 00007D9B 29D7                <2> 		sub edi, edx
 10105 00007D9D 803D[E6230000]00    <2> 		cmp byte [termcopyon], 0
 10106 00007DA4 7532                <2> 		jne nocleartitlebarpos
 10107 00007DA6 8B3D[7A5A0000]      <2> 		mov edi, [physbaseptr]
 10108 00007DAC 31D2                <2> 		xor edx, edx
 10109 00007DAE 668B15[657C0000]    <2> 		mov dx, [winvcopystx]
 10110 00007DB5 01D7                <2> 		add edi, edx
 10111 00007DB7 31C9                <2> 		xor ecx, ecx
 10112 00007DB9 668B0D[677C0000]    <2> 		mov cx, [winvcopysty]
 10113 00007DC0 6681E91000          <2> 		sub cx, 16
 10114 00007DC5 6681F90000          <2> 		cmp cx, 0
 10115 00007DCA 740C                <2> 		je nocleartitlebarpos
 10116                              <2> 	cleartitlebarpos:
 10117 00007DCC 31C0                <2> 		xor eax, eax
 10118 00007DCE 66A1[525B0000]      <2> 		mov ax, [resolutionx2]
 10119 00007DD4 F7E1                <2> 		mul ecx
 10120 00007DD6 01C7                <2> 		add edi, eax
 10121                              <2> 	nocleartitlebarpos:
 10122 00007DD8 66B91000            <2> 		mov cx, 16
 10123 00007DDC 668B15[697C0000]    <2> 		mov dx, [winvcopydx]
 10124 00007DE3 6681F90000          <2> 		cmp cx, 0
 10125 00007DE8 0F8448000000        <2> 		je near canceltitlebarput
 10126 00007DEE 6681FA0000          <2> 		cmp dx, 0
 10127 00007DF3 0F843D000000        <2> 		je near canceltitlebarput
 10128                              <2> 	titlebarput:
 10129 00007DF9 66A1[6D7C0000]      <2> 		mov ax, [windowcolor]
 10130 00007DFF 668907              <2> 		mov [edi], ax
 10131 00007E02 6681EA0200          <2> 		sub dx, 2
 10132 00007E07 81C702000000        <2> 		add edi, 2
 10133 00007E0D 6681FA0000          <2> 		cmp dx, 0
 10134 00007E12 75E5                <2> 		jne titlebarput
 10135 00007E14 31D2                <2> 		xor edx, edx
 10136 00007E16 668B15[525B0000]    <2> 		mov dx, [resolutionx2]
 10137 00007E1D 6649                <2> 		dec cx
 10138 00007E1F 662B15[697C0000]    <2> 		sub dx, [winvcopydx]
 10139 00007E26 01D7                <2> 		add edi, edx
 10140 00007E28 668B15[697C0000]    <2> 		mov dx, [winvcopydx]
 10141 00007E2F 6681F90000          <2> 		cmp cx, 0
 10142 00007E34 75C3                <2> 		jne titlebarput
 10143                              <2> 	canceltitlebarput:
 10144 00007E36 893D[717C0000]      <2> 		mov [windowbufloc], edi
 10145 00007E3C 803D[E6230000]02    <2> 		cmp byte [termcopyon], 2
 10146 00007E43 0F841C010000        <2> 		je near winvcpst
 10147 00007E49 668B1D[B8730000]    <2> 		mov bx, [background]
 10148 00007E50 6653                <2> 		push bx
 10149 00007E52 6631DB              <2> 		xor bx, bx
 10150 00007E55 66891D[B8730000]    <2> 		mov [background], bx
 10151 00007E5C 6631C0              <2> 		xor ax, ax
 10152 00007E5F 81C610000000        <2> 		add esi, 16
 10153 00007E65 668B15[657C0000]    <2> 		mov dx, [winvcopystx]
 10154 00007E6C 668B0D[677C0000]    <2> 		mov cx, [winvcopysty]
 10155 00007E73 6681E91000          <2> 		sub cx, 16
 10156 00007E78 668B1D[6D7C0000]    <2> 		mov bx, [windowcolor]
 10157 00007E7F C605[DC810000]01    <2> 		mov byte [mouseselecton], 1
 10158 00007E86 E882FBFFFF          <2> 		call showstring2	;Show window title
 10159 00007E8B 8B35[CE2C0000]      <2> 		mov esi, [usercache]
 10160 00007E91 6681C21000          <2> 		add dx, 16
 10161 00007E96 C605[DC810000]01    <2> 		mov byte [mouseselecton], 1
 10162 00007E9D E86BFBFFFF          <2> 		call showstring2	;Show user name
 10163 00007EA2 BE[C48E0000]        <2> 		mov esi, computer
 10164 00007EA7 C605[DC810000]01    <2> 		mov byte [mouseselecton], 1
 10165 00007EAE E85AFBFFFF          <2> 		call showstring2	;Show computer name
 10166 00007EB3 66B85800            <2> 		mov ax, "X"
 10167 00007EB7 66BB00F8            <2> 		mov bx, 1111100000000000b
 10168 00007EBB 668B15[657C0000]    <2> 		mov dx, [winvcopystx]
 10169 00007EC2 668B0D[677C0000]    <2> 		mov cx, [winvcopysty]
 10170 00007EC9 6681E91000          <2> 		sub cx, 16
 10171 00007ECE 6681EA1000          <2> 		sub dx, 16
 10172 00007ED3 660315[697C0000]    <2> 		add dx, [winvcopydx]
 10173 00007EDA C605[DC810000]01    <2> 		mov byte [mouseselecton], 1
 10174 00007EE1 663B15[525B0000]    <2> 		cmp dx, [resolutionx2]
 10175 00007EE8 7305                <2> 		jae .nox
 10176 00007EEA E897FBFFFF          <2> 		call showfontvesa
 10177                              <2> .nox:
 10178 00007EEF 668B1D[B8730000]    <2> 		mov bx, [background]
 10179 00007EF6 6681EA1800          <2> 		sub dx, 24
 10180 00007EFB 66B82B00            <2> 		mov ax, "+"
 10181 00007EFF 66BBE007            <2> 		mov bx, 0000011111100000b
 10182 00007F03 C605[DC810000]01    <2> 		mov byte [mouseselecton], 1
 10183 00007F0A 663B15[525B0000]    <2> 		cmp dx, [resolutionx2]
 10184 00007F11 7305                <2> 		jae .noplus
 10185 00007F13 E86EFBFFFF          <2> 		call showfontvesa
 10186                              <2> .noplus:
 10187 00007F18 6681EA1800          <2> 		sub dx, 24
 10188 00007F1D 66B82D00            <2> 		mov ax, "-"
 10189 00007F21 66BBE0FF            <2> 		mov bx, 1111111111100000b
 10190 00007F25 C605[DC810000]01    <2> 		mov byte [mouseselecton], 1
 10191 00007F2C 663B15[525B0000]    <2> 		cmp dx, [resolutionx2]
 10192 00007F33 7305                <2> 		jae .nominus
 10193 00007F35 E84CFBFFFF          <2> 		call showfontvesa
 10194                              <2> .nominus:
 10195 00007F3A 6681EA1800          <2> 		sub dx, 24
 10196 00007F3F 66B83F00            <2> 		mov ax, "?"
 10197 00007F43 66BB1F00            <2> 		mov bx, 0000000000011111b
 10198 00007F47 C605[DC810000]01    <2> 		mov byte [mouseselecton], 1
 10199 00007F4E 663B15[525B0000]    <2> 		cmp dx, [resolutionx2]
 10200 00007F55 7305                <2> 		jae .noquestion
 10201 00007F57 E82AFBFFFF          <2> 		call showfontvesa
 10202                              <2> .noquestion:
 10203 00007F5C 665B                <2> 		pop bx
 10204 00007F5E 66891D[B8730000]    <2> 		mov [background], bx
 10205                              <2> 	winvcpst:
 10206 00007F65 C3                  <2> 		ret
 10207                              <2> 
 10208                              <2> 	windowvideocopy:
 10209 00007F66 8B35[7D7C0000]      <2> 		mov esi, [windowinfobuf]
 10210 00007F6C 668B16              <2> 		mov dx, [esi]
 10211 00007F6F 668B4E02            <2> 		mov cx, [esi + 2]
 10212 00007F73 8B7E04              <2> 		mov edi, [esi + 4]
 10213 00007F76 893D[6D7C0000]      <2> 		mov [windowcolor], edi
 10214 00007F7C 8B7E08              <2> 		mov edi, [esi + 8]
 10215 00007F7F 8B5E0C              <2> 		mov ebx, [esi + 12]
 10216 00007F82 893D[757C0000]      <2> 		mov [windowvideobuf], edi
 10217 00007F88 891D[797C0000]      <2> 		mov [windowvideobuf2], ebx
 10218 00007F8E 31C0                <2> 		xor eax, eax
 10219 00007F90 31DB                <2> 		xor ebx, ebx
 10220 00007F92 6689D0              <2> 		mov ax, dx
 10221 00007F95 6689CB              <2> 		mov bx, cx
 10222 00007F98 66C1E803            <2> 		shr ax, 3
 10223 00007F9C 66C1EB04            <2> 		shr bx, 4
 10224 00007FA0 66A3[817C0000]      <2> 		mov [termcol], ax
 10225 00007FA6 A2[DA250000]        <2> 		mov [charxy], al
 10226 00007FAB 881D[DB250000]      <2> 		mov [charxy + 1], bl
 10227 00007FB1 8B3D[717C0000]      <2> 		mov edi, [windowbufloc]
 10228 00007FB7 3B3D[7A5A0000]      <2> 		cmp edi, [physbaseptr]
 10229 00007FBD 0F8334000000        <2> 		jae near windowvideocopyset
 10230 00007FC3 31C9                <2> 		xor ecx, ecx
 10231 00007FC5 31D2                <2> 		xor edx, edx
 10232 00007FC7 668B15[657C0000]    <2> 		mov dx, [winvcopystx]
 10233 00007FCE 668B0D[677C0000]    <2> 		mov cx, [winvcopysty]
 10234 00007FD5 8B3D[7A5A0000]      <2> 		mov edi, [physbaseptr]
 10235 00007FDB 01D7                <2> 		add edi, edx
 10236 00007FDD 81F900000000        <2> 		cmp ecx, 0
 10237 00007FE3 7412                <2> 		je windowvideocopyset
 10238                              <2> 	yrescopylp:
 10239 00007FE5 31C0                <2> 		xor eax, eax
 10240 00007FE7 66A1[525B0000]      <2> 		mov ax, [resolutionx2]
 10241 00007FED F7E1                <2> 		mul ecx
 10242 00007FEF 01C7                <2> 		add edi, eax
 10243 00007FF1 893D[717C0000]      <2> 		mov [windowbufloc], edi
 10244                              <2> 	windowvideocopyset:
 10245 00007FF7 6631C9              <2> 		xor cx, cx
 10246 00007FFA 6649                <2> 		dec cx
 10247 00007FFC 66890D[D0810000]    <2> 		mov [charposline], cx
 10248 00008003 89FE                <2> 		mov esi, edi
 10249 00008005 81EE10000000        <2> 		sub esi, 16
 10250 0000800B 31D2                <2> 		xor edx, edx
 10251 0000800D 668B15[525B0000]    <2> 		mov dx, [resolutionx2]
 10252 00008014 C1E204              <2> 		shl edx, 4
 10253 00008017 01D6                <2> 		add esi, edx
 10254 00008019 8B3D[757C0000]      <2> 		mov edi, [windowvideobuf]
 10255 0000801F 81EF04000000        <2> 		sub edi, 4
 10256 00008025 893D[D2810000]      <2> 		mov [charposvbuf], edi
 10257 0000802B E97C000000          <2> 		jmp nextcharwin
 10258                              <2> 	win.write:	;adjusted this to use alpha
 10259                              <2> 				;5R, 6G, 5B
 10260                              <2> %ifdef gui.alphablending
 10261                              <2> 		push esi
 10262                              <2> 		push bx
 10263                              <2> 		push cx
 10264                              <2> 		push dx
 10265                              <2> %ifdef gui.background
 10266                              <2> 		mov esi, edi
 10267                              <2> 		sub esi, [physbaseptr]
 10268                              <2> 		add esi, [backgroundimage]
 10269                              <2> 		cmp dword [backgroundimage], 0
 10270                              <2> 		jne .red
 10271                              <2> %endif
 10272                              <2> 		mov esi, background
 10273                              <2> 	.red:
 10274                              <2> 		mov cx, [esi]
 10275                              <2> 		shr cx, 11
 10276                              <2> 		mov bx, ax
 10277                              <2> 		shr bx, 11
 10278                              <2> 		add cx, bx
 10279                              <2> 		add cx, bx
 10280                              <2> 		add cx, bx
 10281                              <2> 		shr cx, 2
 10282                              <2> 		shl cx, 11
 10283                              <2> 		mov dx, cx
 10284                              <2> 	.green:
 10285                              <2> 		mov cx, [esi]
 10286                              <2> 		shl cx, 5
 10287                              <2> 		shr cx, 10
 10288                              <2> 		mov bx, ax
 10289                              <2> 		shl bx, 5
 10290                              <2> 		shr bx, 10
 10291                              <2> 		add cx, bx
 10292                              <2> 		add cx, bx
 10293                              <2> 		add cx, bx
 10294                              <2> 		shr cx, 2
 10295                              <2> 		shl cx, 5
 10296                              <2> 		add dx, cx
 10297                              <2> 	.blue:
 10298                              <2> 		mov cx, [esi]
 10299                              <2> 		shl cx, 11
 10300                              <2> 		shr cx, 11
 10301                              <2> 		mov bx, ax
 10302                              <2> 		shl bx, 11
 10303                              <2> 		shr bx, 11
 10304                              <2> 		add cx, bx
 10305                              <2> 		add cx, bx
 10306                              <2> 		add cx, bx
 10307                              <2> 		shr cx, 2
 10308                              <2> 		add dx, cx
 10309                              <2> 		mov [edi], dx
 10310                              <2> 		pop dx
 10311                              <2> 		pop cx
 10312                              <2> 		pop bx
 10313                              <2> 		pop esi
 10314                              <2> %else
 10315 00008030 668907              <2> 		mov [edi], ax
 10316                              <2> %endif
 10317 00008033 C3                  <2> 		ret
 10318                              <2> 	copywindow:
 10319 00008034 B201                <2> 		mov dl, 1
 10320 00008036 D0C6                <2> 		rol dh, 1
 10321 00008038 20F2                <2> 		and dl, dh
 10322 0000803A 66813D[777A0000]80- <2> 		cmp word [colorcache], 0x80
 10323 00008042 00                  <2>
 10324 00008043 7320                <2> 		jae switchwincolors
 10325 00008045 66A1[6F7C0000]      <2> 		mov ax, [windowcolor + 2]
 10326 0000804B E8E0FFFFFF          <2> 		call win.write
 10327 00008050 80FA00              <2> 		cmp dl, 0
 10328 00008053 742B                <2> 		je nowritewin
 10329 00008055 66A1[6D7C0000]      <2> 		mov ax, [windowcolor]
 10330 0000805B E8D0FFFFFF          <2> 		call win.write
 10331 00008060 E91B000000          <2> 		jmp nowritewin
 10332                              <2> 	switchwincolors:
 10333 00008065 66A1[6D7C0000]      <2> 		mov ax, [windowcolor]
 10334 0000806B E8C0FFFFFF          <2> 		call win.write
 10335 00008070 80FA00              <2> 		cmp dl, 0
 10336 00008073 740B                <2> 		je nowritewin
 10337 00008075 66A1[6F7C0000]      <2> 		mov ax, [windowcolor + 2]
 10338 0000807B E8B0FFFFFF          <2> 		call win.write
 10339                              <2> 	nowritewin:
 10340 00008080 81C702000000        <2> 		add edi, 2
 10341 00008086 FEC1                <2> 		inc cl
 10342 00008088 80F908              <2> 		cmp cl, 8
 10343 0000808B 75A7                <2> 		jne copywindow
 10344 0000808D 43                  <2> 		inc ebx
 10345 0000808E 30C9                <2> 		xor cl, cl
 10346 00008090 31D2                <2> 		xor edx, edx
 10347 00008092 668B15[525B0000]    <2> 		mov dx, [resolutionx2]
 10348 00008099 01D6                <2> 		add esi, edx
 10349 0000809B 89F7                <2> 		mov edi, esi
 10350 0000809D 8AB3[53910000]      <2> 		mov dh, [fonts + ebx]
 10351 000080A3 D0CE                <2> 		ror dh, 1
 10352 000080A5 FEC5                <2> 		inc ch
 10353 000080A7 80FD10              <2> 		cmp ch, 16
 10354 000080AA 7588                <2> 		jne copywindow
 10355                              <2> 	nextcharwin:
 10356 000080AC 6631C9              <2> 		xor cx, cx
 10357 000080AF 8B3D[D2810000]      <2> 		mov edi, [charposvbuf]
 10358 000080B5 81C704000000        <2> 		add edi, 4
 10359 000080BB 3B3D[837C0000]      <2> 		cmp edi, [wincopyendpos]
 10360 000080C1 0F83F2000000        <2> 		jae near donewincopynow
 10361 000080C7 668B5F02            <2> 		mov bx, [edi + 2]
 10362 000080CB 6681FB0000          <2> 		cmp bx, 0
 10363 000080D0 7508                <2> 		jne nofixcolorwin
 10364 000080D2 66BB0700            <2> 		mov bx, 7
 10365 000080D6 66895F02            <2> 		mov [edi + 2], bx
 10366                              <2> 	nofixcolorwin:
 10367 000080DA 66891D[777A0000]    <2> 		mov [colorcache], bx
 10368 000080E1 8B1F                <2> 		mov ebx, [edi]
 10369 000080E3 893D[D2810000]      <2> 		mov [charposvbuf], edi
 10370 000080E9 813D[797C0000]0000- <2> 		cmp dword [windowvideobuf2], 0
 10371 000080F1 0000                <2>
 10372 000080F3 7455                <2> 		je noskipcharcopy
 10373 000080F5 2B3D[757C0000]      <2> 		sub edi, [windowvideobuf]
 10374 000080FB 033D[797C0000]      <2> 		add edi, [windowvideobuf2]
 10375 00008101 8B07                <2> 		mov eax, [edi]
 10376 00008103 39D8                <2> 		cmp eax, ebx
 10377 00008105 7543                <2> 		jne noskipcharcopy
 10378                              <2> 	skipcharcopy:
 10379 00008107 81C610000000        <2> 		add esi, 16
 10380 0000810D 668B0D[D0810000]    <2> 		mov cx, [charposline]
 10381 00008114 6641                <2> 		inc cx
 10382 00008116 66890D[D0810000]    <2> 		mov [charposline], cx
 10383 0000811D 663B0D[817C0000]    <2> 		cmp cx, [termcol]
 10384 00008124 7286                <2> 		jb nextcharwin
 10385 00008126 6631C9              <2> 		xor cx, cx
 10386 00008129 66890D[D0810000]    <2> 		mov [charposline], cx
 10387 00008130 31D2                <2> 		xor edx, edx
 10388 00008132 668B15[525B0000]    <2> 		mov dx, [resolutionx2]
 10389 00008139 C1E204              <2> 		shl edx, 4
 10390 0000813C 662B15[697C0000]    <2> 		sub dx, [winvcopydx]
 10391 00008143 01D6                <2> 		add esi, edx
 10392 00008145 E962FFFFFF          <2> 		jmp nextcharwin
 10393                              <2> 	noskipcharcopy:
 10394 0000814A 891F                <2> 		mov [edi], ebx
 10395 0000814C 8B3D[D2810000]      <2> 		mov edi, [charposvbuf]
 10396 00008152 C1E310              <2> 		shl ebx, 16
 10397 00008155 C1EB0C              <2> 		shr ebx, 12
 10398 00008158 31D2                <2> 		xor edx, edx
 10399 0000815A 668B15[525B0000]    <2> 		mov dx, [resolutionx2]
 10400 00008161 C1E204              <2> 		shl edx, 4
 10401 00008164 29D6                <2> 		sub esi, edx
 10402 00008166 81C610000000        <2> 		add esi, 16
 10403 0000816C 89F7                <2> 		mov edi, esi
 10404 0000816E 668B0D[D0810000]    <2> 		mov cx, [charposline]
 10405 00008175 6641                <2> 		inc cx
 10406 00008177 663B0D[817C0000]    <2> 		cmp cx, [termcol]
 10407 0000817E 7317                <2> 		jae fixwindowcopy
 10408 00008180 66890D[D0810000]    <2> 		mov [charposline], cx
 10409 00008187 6631C9              <2> 		xor cx, cx
 10410 0000818A 8AB3[53910000]      <2> 		mov dh, [fonts + ebx]
 10411 00008190 D0CE                <2> 		ror dh, 1
 10412 00008192 E99DFEFFFF          <2> 		jmp copywindow
 10413                              <2> fixwindowcopy:
 10414 00008197 6631C9              <2> 		xor cx, cx
 10415 0000819A 66890D[D0810000]    <2> 		mov [charposline], cx
 10416 000081A1 662B15[697C0000]    <2> 		sub dx, [winvcopydx]
 10417 000081A8 01D6                <2> 		add esi, edx
 10418 000081AA 89F7                <2> 		mov edi, esi
 10419 000081AC 8AB3[53910000]      <2> 		mov dh, [fonts + ebx]
 10420 000081B2 D0CE                <2> 		ror dh, 1
 10421 000081B4 E97BFEFFFF          <2> 		jmp copywindow
 10422                              <2> donewincopynow:
 10423 000081B9 803D[E6230000]01    <2> 		cmp byte [termcopyon], 1
 10424 000081C0 7506                <2> 		jne forgetresetstuff
 10425 000081C2 E8FDA7FFFF          <2> 		call switchtermcursor
 10426 000081C7 61                  <2> 		popa
 10427                              <2> forgetresetstuff:
 10428 000081C8 C605[E6230000]00    <2> 		mov byte [termcopyon], 0
 10429 000081CF C3                  <2> 		ret
 10430                              <2> 		
 10431 000081D0 0000                <2> charposline dw 0
 10432 000081D2 00000000            <2> charposvbuf dw 0,0
 10433                              <1> 				
 10434 000081D6 00                  <1> copygui db 0
 10435 000081D7 00                  <1> graphicsset db 0
 10436 000081D8 0000                <1> graphicspos db 0,0
 10437 000081DA 00                  <1> showcursorfonton db 0
 10438 000081DB 00                  <1> savefonton db 0
 10439 000081DC 00                  <1> mouseselecton db 0
 10440                              <1> 
 10441 000081DD 00                  <1> pbutton db 0
 10442 000081DE 00                  <1> pLBUTTON db 0
 10443 000081DF 00                  <1> pRBUTTON db 0
 10444 000081E0 00000000            <1> dragging dw 0,0
 10445 000081E4 0000000000000000    <1> lastpos dw 0,0,0,0
 10446 000081EC 00000000            <1> colorbuf dw 0,0
 10447                              <1> 	
 10448                              <1> 	clickicon:
 10449 000081F0 B001                <1> 		mov al, 1
 10450 000081F2 A2[DD810000]        <1> 		mov [pbutton], al
 10451 000081F7 A0[DE810000]        <1> 		mov al, [pLBUTTON]
 10452 000081FC 2205[595E0000]      <1> 		and al, [LBUTTON]
 10453 00008202 8A25[DF810000]      <1> 		mov ah, [pRBUTTON]
 10454 00008208 2225[5A5E0000]      <1> 		and ah, [RBUTTON]
 10455 0000820E 08E0                <1> 		or al, ah
 10456 00008210 3C00                <1> 		cmp al, 0
 10457 00008212 741B                <1> 		je nodragclick
 10458 00008214 813D[E0810000]0100- <1> 		cmp dword [dragging], 1
 10459 0000821C 0000                <1>
 10460 0000821E 732F                <1> 		jae dragclick
 10461 00008220 C705[E0810000]0100- <1> 		mov dword [dragging], 1
 10462 00008228 0000                <1>
 10463 0000822A E920000000          <1> 		jmp dragclick
 10464                              <1> 	nodragclick:
 10465 0000822F 31C0                <1> 		xor eax, eax
 10466 00008231 A3[E0810000]        <1> 		mov dword [dragging], eax
 10467 00008236 A2[DD810000]        <1> 		mov [pbutton], al
 10468 0000823B A0[595E0000]        <1> 		mov al, [LBUTTON]
 10469 00008240 A2[DE810000]        <1> 		mov [pLBUTTON], al
 10470 00008245 A0[5A5E0000]        <1> 		mov al, [RBUTTON]
 10471 0000824A A2[DF810000]        <1> 		mov [pRBUTTON], al
 10472                              <1> 	dragclick:
 10473 0000824F 6631C0              <1> 		xor ax, ax
 10474 00008252 BE[9DD20300]        <1> 		mov esi, graphicstable
 10475 00008257 C705[308A0000]0000- <1> 		mov dword [codepointer], 0
 10476 0000825F 0000                <1>
 10477                              <1> 	clicon2:
 10478 00008261 31D2                <1> 		xor edx, edx
 10479 00008263 31C9                <1> 		xor ecx, ecx
 10480 00008265 66813E0100          <1> 		cmp word [esi], 1
 10481 0000826A 0F841B000000        <1> 		je near iconselect
 10482 00008270 66813E0200          <1> 		cmp word [esi], 2
 10483 00008275 0F8472010000        <1> 		je near textselected
 10484 0000827B 66813E0300          <1> 		cmp word [esi], 3
 10485 00008280 0F84C7020000        <1> 		je near windowselect
 10486 00008286 E910040000          <1> 		jmp nexticonsel
 10487                              <1> 	iconselect:
 10488 0000828B 668B5606            <1> 		mov dx, [esi + 6]
 10489 0000828F 6689D0              <1> 		mov ax, dx
 10490 00008292 668B4E08            <1> 		mov cx, [esi + 8]
 10491 00008296 6689CB              <1> 		mov bx, cx
 10492 00008299 6681C32000          <1> 		add bx, 32
 10493 0000829E 6601D0              <1> 		add ax, dx
 10494 000082A1 813D[E0810000]0100- <1> 		cmp dword [dragging], 1
 10495 000082A9 0000                <1>
 10496 000082AB 746F                <1> 		je dragicon
 10497 000082AD 813D[E0810000]0000- <1> 		cmp dword [dragging], 0
 10498 000082B5 0000                <1>
 10499 000082B7 7411                <1> 		je nodragiconcheck
 10500 000082B9 3935[E0810000]      <1> 		cmp dword [dragging], esi
 10501 000082BF 0F85D6030000        <1> 		jne near nexticonsel
 10502 000082C5 E952000000          <1> 		jmp dragicon
 10503                              <1> 	nodragiconcheck:
 10504 000082CA 663905[485D0000]    <1> 		cmp [mousecursorposition], ax
 10505 000082D1 0F82C4030000        <1> 		jb near nexticonsel
 10506 000082D7 66054000            <1> 		add ax, 64
 10507 000082DB 663905[485D0000]    <1> 		cmp [mousecursorposition], ax
 10508 000082E2 0F87B3030000        <1> 		ja near nexticonsel
 10509 000082E8 6629D0              <1> 		sub ax, dx
 10510 000082EB 66390D[4A5D0000]    <1> 		cmp [mousecursorposition + 2], cx
 10511 000082F2 0F82A3030000        <1> 		jb near nexticonsel
 10512 000082F8 66391D[4A5D0000]    <1> 		cmp [mousecursorposition + 2], bx
 10513 000082FF 0F8796030000        <1> 		ja near nexticonsel
 10514 00008305 668B460A            <1> 		mov ax, [esi + 10]
 10515 00008309 66250100            <1> 		and ax, 1
 10516 0000830D 663D0100            <1> 		cmp ax, 1
 10517 00008311 0F84B6000000        <1> 		je near unselecticon
 10518 00008317 E98D000000          <1> 		jmp nodragicon
 10519                              <1> 	dragicon:
 10520 0000831C 663905[445D0000]    <1> 		cmp [lastmouseposition], ax
 10521 00008323 0F8272030000        <1> 		jb near nexticonsel
 10522 00008329 66054000            <1> 		add ax, 64
 10523 0000832D 663905[445D0000]    <1> 		cmp [lastmouseposition], ax
 10524 00008334 0F8761030000        <1> 		ja near nexticonsel
 10525 0000833A 6629D0              <1> 		sub ax, dx
 10526 0000833D 66390D[465D0000]    <1> 		cmp [lastmouseposition + 2], cx
 10527 00008344 0F8251030000        <1> 		jb near nexticonsel
 10528 0000834A 66391D[465D0000]    <1> 		cmp [lastmouseposition + 2], bx
 10529 00008351 0F8744030000        <1> 		ja near nexticonsel
 10530 00008357 668B460A            <1> 		mov ax, [esi + 10]
 10531 0000835B 2410                <1> 		and al, 00010000b
 10532 0000835D 3C10                <1> 		cmp al, 00010000b
 10533 0000835F 7448                <1> 		je nodragicon
 10534 00008361 8935[E0810000]      <1> 		mov [dragging], esi
 10535 00008367 66D1E2              <1> 		shl dx, 1
 10536 0000836A 662B15[445D0000]    <1> 		sub dx, [lastmouseposition]
 10537 00008371 660315[485D0000]    <1> 		add dx, [mousecursorposition]
 10538 00008378 66D1EA              <1> 		shr dx, 1
 10539 0000837B 66030D[4A5D0000]    <1> 		add cx, [mousecursorposition + 2]
 10540 00008382 662B0D[465D0000]    <1> 		sub cx, [lastmouseposition + 2]
 10541 00008389 663B15[525B0000]    <1> 		cmp dx, [resolutionx2]
 10542 00008390 7607                <1> 		jbe chkyresdrgicn
 10543 00008392 668B15[485D0000]    <1> 		mov dx, [mousecursorposition]
 10544                              <1> 	chkyresdrgicn:
 10545 00008399 663B0D[665A0000]    <1> 		cmp cx, [resolutiony]
 10546 000083A0 7607                <1> 		jbe nodragicon
 10547 000083A2 668B0D[4A5D0000]    <1> 		mov cx, [mousecursorposition + 2]
 10548                              <1> 	nodragicon:
 10549 000083A9 66814E0A0100        <1> 		or word [esi + 10], 1
 10550 000083AF 8B5E0C              <1> 		mov ebx, [esi + 12]
 10551 000083B2 668B460A            <1> 		mov ax, [esi + 10]
 10552 000083B6 8B7602              <1> 		mov esi, [esi + 2]
 10553 000083B9 C705[308A0000]0000- <1> 		mov dword [codepointer], 0
 10554 000083C1 0000                <1>
 10555 000083C3 E8A3EDFFFF          <1> 		call showicon
 10556 000083C8 E9E7020000          <1> 		jmp doneiconsel
 10557                              <1> 	unselecticon:
 10558 000083CD 6681660AFEFF        <1> 		and word [esi + 10], 0xFFFE
 10559 000083D3 8B5E0C              <1> 		mov ebx, [esi + 12]
 10560 000083D6 668B460A            <1> 		mov ax, [esi + 10]
 10561 000083DA 8B7602              <1> 		mov esi, [esi + 2]
 10562 000083DD 891D[308A0000]      <1> 		mov [codepointer], ebx
 10563 000083E3 E883EDFFFF          <1> 		call showicon
 10564 000083E8 E9C7020000          <1> 		jmp doneiconsel
 10565                              <1> 	textselected:
 10566 000083ED 8B5E02              <1> 		mov ebx, [esi + 2]
 10567 000083F0 668B5606            <1> 		mov dx, [esi + 6]
 10568 000083F4 6689D0              <1> 		mov ax, dx
 10569 000083F7 668B4E08            <1> 		mov cx, [esi + 8]
 10570                              <1> 	lengthtesttext:
 10571 000083FB 803B00              <1> 		cmp byte [ebx], 0
 10572 000083FE 7407                <1> 		je donetesttextlength
 10573 00008400 43                  <1> 		inc ebx
 10574 00008401 66051000            <1> 		add ax, 16
 10575 00008405 EBF4                <1> 		jmp lengthtesttext
 10576                              <1> 	donetesttextlength:
 10577 00008407 6689CB              <1> 		mov bx, cx
 10578 0000840A 6681C30F00          <1> 		add bx, 15
 10579 0000840F 813D[E0810000]0100- <1> 		cmp dword [dragging], 1
 10580 00008417 0000                <1>
 10581 00008419 7468                <1> 		je dragtext
 10582 0000841B 813D[E0810000]0000- <1> 		cmp dword [dragging], 0
 10583 00008423 0000                <1>
 10584 00008425 7411                <1> 		je nodragtextcheck
 10585 00008427 3935[E0810000]      <1> 		cmp dword [dragging], esi
 10586 0000842D 0F8568020000        <1> 		jne near nexticonsel
 10587 00008433 E94B000000          <1> 		jmp dragtext
 10588                              <1> 	nodragtextcheck:
 10589 00008438 663915[485D0000]    <1> 		cmp [mousecursorposition], dx
 10590 0000843F 0F8256020000        <1> 		jb near nexticonsel
 10591 00008445 663905[485D0000]    <1> 		cmp [mousecursorposition], ax
 10592 0000844C 0F8749020000        <1> 		ja near nexticonsel
 10593 00008452 66390D[4A5D0000]    <1> 		cmp [mousecursorposition + 2], cx
 10594 00008459 0F823C020000        <1> 		jb near nexticonsel
 10595 0000845F 66391D[4A5D0000]    <1> 		cmp [mousecursorposition + 2], bx
 10596 00008466 0F872F020000        <1> 		ja near nexticonsel
 10597 0000846C 668B460A            <1> 		mov ax, [esi + 10]
 10598 00008470 66250100            <1> 		and ax, 1
 10599 00008474 663D0100            <1> 		cmp ax, 1
 10600 00008478 0F84AB000000        <1> 		je near unselecttext
 10601 0000847E E986000000          <1> 		jmp nodragtext
 10602                              <1> 	dragtext:
 10603 00008483 663915[445D0000]    <1> 		cmp [lastmouseposition], dx
 10604 0000848A 0F820B020000        <1> 		jb near nexticonsel
 10605 00008490 663905[445D0000]    <1> 		cmp [lastmouseposition], ax
 10606 00008497 0F87FE010000        <1> 		ja near nexticonsel
 10607 0000849D 66390D[465D0000]    <1> 		cmp [lastmouseposition + 2], cx
 10608 000084A4 0F82F1010000        <1> 		jb near nexticonsel
 10609 000084AA 66391D[465D0000]    <1> 		cmp [lastmouseposition + 2], bx
 10610 000084B1 0F87E4010000        <1> 		ja near nexticonsel
 10611 000084B7 668B460A            <1> 		mov ax, [esi + 10]
 10612 000084BB 2410                <1> 		and al, 00010000b
 10613 000084BD 663D1000            <1> 		cmp ax, 00010000b
 10614 000084C1 0F8442000000        <1> 		je near nodragtext
 10615 000084C7 8935[E0810000]      <1> 		mov [dragging], esi
 10616 000084CD 662B15[445D0000]    <1> 		sub dx, [lastmouseposition]
 10617 000084D4 660315[485D0000]    <1> 		add dx, [mousecursorposition]
 10618 000084DB 66030D[4A5D0000]    <1> 		add cx, [mousecursorposition + 2]
 10619 000084E2 662B0D[465D0000]    <1> 		sub cx, [lastmouseposition + 2]
 10620 000084E9 663B15[525B0000]    <1> 		cmp dx, [resolutionx2]
 10621 000084F0 7607                <1> 		jbe chkyresdrgtxt
 10622 000084F2 668B15[485D0000]    <1> 		mov dx, [mousecursorposition]
 10623                              <1> 	chkyresdrgtxt:
 10624 000084F9 663B0D[665A0000]    <1> 		cmp cx, [resolutiony]
 10625 00008500 7607                <1> 		jbe nodragtext
 10626 00008502 668B0D[4A5D0000]    <1> 		mov cx, [mousecursorposition + 2]
 10627                              <1> 	nodragtext:
 10628 00008509 66814E0A0100        <1> 		or word [esi + 10], 1
 10629 0000850F 8B5E0C              <1> 		mov ebx, [esi + 12]
 10630 00008512 891D[308A0000]      <1> 		mov [codepointer], ebx
 10631 00008518 668B460A            <1> 		mov ax, [esi + 10]
 10632 0000851C 8B7602              <1> 		mov esi, [esi + 2]
 10633 0000851F E8D6F4FFFF          <1> 		call showstring
 10634 00008524 E98B010000          <1> 		jmp doneiconsel
 10635                              <1> 	unselecttext:
 10636 00008529 6681660AFEFF        <1> 		and word [esi + 10], 0xFFFE
 10637 0000852F 8B5E0C              <1> 		mov ebx, [esi + 12]
 10638 00008532 668B460A            <1> 		mov ax, [esi + 10]
 10639 00008536 8B7602              <1> 		mov esi, [esi + 2]
 10640 00008539 C705[308A0000]0000- <1> 		mov dword [codepointer], 0
 10641 00008541 0000                <1>
 10642 00008543 E8B2F4FFFF          <1> 		call showstring
 10643 00008548 E967010000          <1> 		jmp doneiconsel
 10644                              <1> windowselect:
 10645 0000854D 8B7E02              <1> 		mov edi, [esi + 2]
 10646 00008550 668B5606            <1> 		mov dx, [esi + 6]
 10647 00008554 6689D0              <1> 		mov ax, dx
 10648 00008557 668B4E08            <1> 		mov cx, [esi + 8]
 10649 0000855B 6689CB              <1> 		mov bx, cx
 10650 0000855E 6681C31000          <1> 		add bx, 16
 10651 00008563 813D[E0810000]0100- <1> 		cmp dword [dragging], 1
 10652 0000856B 0000                <1>
 10653 0000856D 746D                <1> 		je dragwin
 10654 0000856F 813D[E0810000]0000- <1> 		cmp dword [dragging], 0
 10655 00008577 0000                <1>
 10656 00008579 7411                <1> 		je nodragwincheck
 10657 0000857B 3935[E0810000]      <1> 		cmp dword [dragging], esi
 10658 00008581 0F8514010000        <1> 		jne near nexticonsel
 10659 00008587 E950000000          <1> 		jmp dragwin
 10660                              <1> 	nodragwincheck:
 10661 0000858C 663905[485D0000]    <1> 		cmp [mousecursorposition], ax
 10662 00008593 0F8202010000        <1> 		jb near nexticonsel
 10663 00008599 660307              <1> 		add ax, [edi]
 10664 0000859C 660307              <1> 		add ax, [edi]
 10665 0000859F 663905[485D0000]    <1> 		cmp [mousecursorposition], ax
 10666 000085A6 0F87EF000000        <1> 		ja near nexticonsel
 10667 000085AC 66390D[4A5D0000]    <1> 		cmp [mousecursorposition + 2], cx
 10668 000085B3 0F82E2000000        <1> 		jb near nexticonsel
 10669 000085B9 66391D[4A5D0000]    <1> 		cmp [mousecursorposition + 2], bx
 10670 000085C0 0F87D5000000        <1> 		ja near nexticonsel
 10671 000085C6 662D1400            <1> 		sub ax, 20
 10672 000085CA 663905[485D0000]    <1> 		cmp [mousecursorposition], ax
 10673 000085D1 0F87A4000000        <1> 		ja near killwin
 10674 000085D7 E98B000000          <1> 		jmp nodragwin
 10675                              <1> 	dragwin:
 10676 000085DC 663905[445D0000]    <1> 		cmp [lastmouseposition], ax
 10677 000085E3 0F82B2000000        <1> 		jb near nexticonsel
 10678 000085E9 660307              <1> 		add ax, [edi]
 10679 000085EC 660307              <1> 		add ax, [edi]
 10680 000085EF 663905[445D0000]    <1> 		cmp [lastmouseposition], ax
 10681 000085F6 0F879F000000        <1> 		ja near nexticonsel
 10682 000085FC 66390D[465D0000]    <1> 		cmp [lastmouseposition + 2], cx
 10683 00008603 0F8292000000        <1> 		jb near nexticonsel
 10684 00008609 66391D[465D0000]    <1> 		cmp [lastmouseposition + 2], bx
 10685 00008610 0F8785000000        <1> 		ja near nexticonsel
 10686 00008616 8935[E0810000]      <1> 		mov [dragging], esi
 10687 0000861C 803D[44870000]01    <1> 		cmp byte [windrag], 1
 10688 00008623 7706                <1> 		ja .nochangewindrag
 10689 00008625 FE05[44870000]      <1> 		inc byte [windrag]
 10690                              <1> 	.nochangewindrag:
 10691 0000862B 662B15[445D0000]    <1> 		sub dx, [lastmouseposition]
 10692 00008632 660315[485D0000]    <1> 		add dx, [mousecursorposition]
 10693 00008639 66030D[4A5D0000]    <1> 		add cx, [mousecursorposition + 2]
 10694 00008640 662B0D[465D0000]    <1> 		sub cx, [lastmouseposition + 2]
 10695 00008647 663B15[525B0000]    <1> 		cmp dx, [resolutionx2]
 10696 0000864E 7607                <1> 		jbe chkyresdrgwin
 10697 00008650 668B15[485D0000]    <1> 		mov dx, [mousecursorposition]
 10698                              <1> 	chkyresdrgwin:
 10699 00008657 663B0D[665A0000]    <1> 		cmp cx, [resolutiony]
 10700 0000865E 7607                <1> 		jbe nodragwin
 10701 00008660 668B0D[4A5D0000]    <1> 		mov cx, [mousecursorposition + 2]
 10702                              <1> 	nodragwin:
 10703 00008667 8B5E0C              <1> 		mov ebx, [esi + 12]
 10704 0000866A 668B460A            <1> 		mov ax, [esi + 10]
 10705 0000866E 8B7602              <1> 		mov esi, [esi + 2]
 10706 00008671 E811F6FFFF          <1> 		call showwindow
 10707 00008676 E939000000          <1> 		jmp doneiconsel
 10708                              <1> 	killwin:
 10709 0000867B 66C7060000          <1> 		mov word [esi], 0
 10710 00008680 C605[E5230000]00    <1> 		mov byte [termguion], 0
 10711 00008687 E8E0ECFFFF          <1> 		call guiclear
 10712 0000868C E82BEDFFFF          <1> 		call reloadallgraphics
 10713 00008691 E872EAFFFF          <1> 		call switchmousepos2 ;Copy what is now under the mouse
 10714 00008696 E94EE6FFFF          <1> 		jmp guistart
 10715                              <1> 	nexticonsel:
 10716 0000869B 6681660AFEFF        <1> 		and word [esi + 10], 0xFFFE
 10717 000086A1 81C610000000        <1> 		add esi, 16
 10718 000086A7 81FE[9DD40300]      <1> 		cmp esi, graphicstableend
 10719 000086AD 7305                <1> 		jae doneiconsel
 10720 000086AF E9ADFBFFFF          <1> 		jmp clicon2
 10721                              <1> 	doneiconsel:
 10722 000086B4 813D[E0810000]0100- <1> 		cmp dword [dragging], 1
 10723 000086BC 0000                <1>
 10724 000086BE 731A                <1> 		jae doneiconsel2
 10725 000086C0 A2[44870000]        <1> 		mov [windrag], al
 10726 000086C5 813D[308A0000]0000- <1> 		cmp dword [codepointer], 0
 10727 000086CD 0000                <1>
 10728 000086CF 7409                <1> 		je doneiconsel2
 10729 000086D1 8B1D[308A0000]      <1> 		mov ebx, [codepointer]
 10730 000086D7 FFD3                <1> 		call ebx
 10731 000086D9 C3                  <1> 		ret
 10732                              <1> 	doneiconsel2:
 10733 000086DA A0[595E0000]        <1> 		mov al, [LBUTTON]
 10734 000086DF A2[DE810000]        <1> 		mov [pLBUTTON], al
 10735 000086E4 A0[5A5E0000]        <1> 		mov al, [RBUTTON]
 10736 000086E9 A2[DF810000]        <1> 		mov [pRBUTTON], al
 10737 000086EE 813D[E0810000]0100- <1> 		cmp dword [dragging], 1
 10738 000086F6 0000                <1>
 10739 000086F8 0F8618000000        <1> 		jbe near noreloadgraphicsclick
 10740 000086FE E805EAFFFF          <1> 		call switchmousepos2
 10741 00008703 803D[44870000]01    <1> 		cmp byte [windrag], 1
 10742 0000870A 7305                <1> 		jae noclearcursorcl
 10743 0000870C E83FE9FFFF          <1> 		call clearmousecursor
 10744                              <1> noclearcursorcl:
 10745 00008711 E8A6ECFFFF          <1> 		call reloadallgraphics
 10746                              <1> noreloadgraphicsclick:
 10747 00008716 30E4                <1> 		xor ah, ah
 10748 00008718 31C9                <1> 		xor ecx, ecx
 10749 0000871A 31D2                <1> 		xor edx, edx
 10750 0000871C B001                <1> 		mov al, 1
 10751 0000871E 668B15[485D0000]    <1> 		mov dx, [mousecursorposition]
 10752 00008725 668B0D[4A5D0000]    <1> 		mov cx, [mousecursorposition + 2]
 10753 0000872C 66BBE738            <1> 		mov bx, 0011100011100111b
 10754 00008730 C605[DA810000]01    <1> 		mov byte [showcursorfonton], 1
 10755 00008737 E84AF3FFFF          <1> 		call showfontvesa
 10756 0000873C C605[DA810000]00    <1> 		mov byte [showcursorfonton], 0
 10757 00008743 C3                  <1> 		ret
 10758 00008744 00                  <1> windrag db 0
 10759 00008745 00000000            <1> lastdrag dw 0,0
 10760 00008749 00000000            <1> grpctblpos dw 0,0
 10761                              <1> 
 10762                              <1> 
 10763                              <1> 
 10764 0000874D 00<rept>            <1> grphbuf times 16 db 0
 10765                              <1> 	graphicsadd:
 10766 0000875D BF[9DD20300]        <1> 		mov edi, graphicstable
 10767                              <1> 	shwgrph1:
 10768 00008762 397702              <1> 		cmp dword [edi + 2], esi
 10769 00008765 7414                <1> 		je showgraphicsreplace2
 10770 00008767 81C710000000        <1> 		add edi, 16
 10771 0000876D 81FF[9DD40300]      <1> 		cmp edi, graphicstableend
 10772 00008773 0F8337020000        <1> 		jae near showgraphicsnew
 10773 00008779 EBE7                <1> 		jmp shwgrph1
 10774                              <1> 	showgraphicsreplace2:
 10775 0000877B 8935[4F870000]      <1> 		mov [grphbuf + 2], esi
 10776 00008781 668915[53870000]    <1> 		mov [grphbuf + 6], dx
 10777 00008788 66890D[55870000]    <1> 		mov [grphbuf + 8], cx
 10778 0000878F 891D[59870000]      <1> 		mov [grphbuf + 12], ebx
 10779 00008795 30FF                <1> 		xor bh, bh
 10780 00008797 88E3                <1> 		mov bl, ah
 10781 00008799 30E4                <1> 		xor ah, ah
 10782 0000879B 66A3[57870000]      <1> 		mov [grphbuf + 10], ax	
 10783 000087A1 66891D[4D870000]    <1> 		mov [grphbuf], bx
 10784 000087A8 66A1[4D870000]      <1> 		mov ax, [grphbuf]
 10785 000087AE 663D0100            <1> 		cmp ax, 1
 10786 000087B2 0F8419000000        <1> 		je near replaceicon
 10787 000087B8 663D0200            <1> 		cmp ax, 2
 10788 000087BC 0F8493000000        <1> 		je near replacestring
 10789 000087C2 663D0300            <1> 		cmp ax, 3
 10790 000087C6 0F840F010000        <1> 		je near replacewindow
 10791 000087CC E9BC010000          <1> 		jmp showgraphicsreplace
 10792                              <1> 	replaceicon:
 10793 000087D1 893D[E4810000]      <1> 		mov [lastpos], edi
 10794 000087D7 8935[E8810000]      <1> 		mov [lastpos + 4], esi
 10795 000087DD 8B7702              <1> 		mov esi, [edi + 2]
 10796 000087E0 668B5F0C            <1> 		mov bx, [edi + 12]
 10797 000087E4 668B5706            <1> 		mov dx, [edi + 6]
 10798 000087E8 668B4F08            <1> 		mov cx, [edi + 8]
 10799 000087EC 668B06              <1> 		mov ax, [esi]
 10800 000087EF 66A3[EC810000]      <1> 		mov [colorbuf], ax
 10801 000087F5 66A1[B8730000]      <1> 		mov ax, [background]
 10802 000087FB 668906              <1> 		mov [esi], ax
 10803 000087FE 8B5F0C              <1> 		mov ebx, [edi + 12]
 10804 00008801 668B470A            <1> 		mov ax, [edi + 10]
 10805 00008805 2401                <1> 		and al, 1
 10806 00008807 A2[348A0000]        <1> 		mov [iconselected], al
 10807 0000880C 668B470A            <1> 		mov ax, [edi + 10]
 10808 00008810 E869E9FFFF          <1> 		call showicon2
 10809 00008815 8B3D[E4810000]      <1> 		mov edi, [lastpos]
 10810 0000881B 8B7702              <1> 		mov esi, [edi + 2]
 10811 0000881E 66A1[EC810000]      <1> 		mov ax, [colorbuf]
 10812 00008824 668906              <1> 		mov [esi], ax
 10813 00008827 8B35[E8810000]      <1> 		mov esi, [lastpos + 4]
 10814 0000882D 668B15[53870000]    <1> 		mov dx, [grphbuf + 6]
 10815 00008834 668B0D[55870000]    <1> 		mov cx, [grphbuf + 8]
 10816 0000883B 668B1D[4D870000]    <1> 		mov bx, [grphbuf]
 10817 00008842 66A1[57870000]      <1> 		mov ax, [grphbuf + 10]
 10818 00008848 88DC                <1> 		mov ah, bl
 10819 0000884A 8B1D[59870000]      <1> 		mov ebx, [grphbuf + 12]
 10820 00008850 E938010000          <1> 		jmp showgraphicsreplace
 10821                              <1> 	replacestring:
 10822 00008855 893D[E4810000]      <1> 		mov [lastpos], edi
 10823 0000885B 8935[E8810000]      <1> 		mov [lastpos + 4], esi
 10824 00008861 8B5F0C              <1> 		mov ebx, [edi + 12]
 10825 00008864 8B7702              <1> 		mov esi, [edi + 2]
 10826 00008867 668B5706            <1> 		mov dx, [edi + 6]
 10827 0000886B 668B4F08            <1> 		mov cx, [edi + 8]
 10828 0000886F 66A1[757A0000]      <1> 		mov ax, [colorfont2]
 10829 00008875 66A3[EC810000]      <1> 		mov [colorbuf], ax
 10830 0000887B 66A1[B8730000]      <1> 		mov ax, [background]
 10831 00008881 66A3[757A0000]      <1> 		mov [colorfont2], ax		
 10832 00008887 8B5F0C              <1> 		mov ebx, [edi + 12]
 10833 0000888A 668B470A            <1> 		mov ax, [edi + 10]
 10834 0000888E 2401                <1> 		and al, 1
 10835 00008890 A2[DC810000]        <1> 		mov [mouseselecton], al
 10836 00008895 668B470A            <1> 		mov ax, [edi + 10]
 10837 00008899 E86FF1FFFF          <1> 		call showstring2
 10838 0000889E 66A1[EC810000]      <1> 		mov ax, [colorbuf]
 10839 000088A4 66A3[757A0000]      <1> 		mov [colorfont2], ax
 10840 000088AA 8B3D[E4810000]      <1> 		mov edi, [lastpos]
 10841 000088B0 8B7702              <1> 		mov esi, [edi + 2]
 10842 000088B3 668B15[53870000]    <1> 		mov dx, [grphbuf + 6]
 10843 000088BA 668B0D[55870000]    <1> 		mov cx, [grphbuf + 8]
 10844 000088C1 668B1D[4D870000]    <1> 		mov bx, [grphbuf]
 10845 000088C8 66A1[57870000]      <1> 		mov ax, [grphbuf + 10]
 10846 000088CE 88DC                <1> 		mov ah, bl
 10847 000088D0 8B1D[59870000]      <1> 		mov ebx, [grphbuf + 12]
 10848 000088D6 E9B2000000          <1> 		jmp showgraphicsreplace
 10849                              <1> 	replacewindow:
 10850 000088DB 893D[E4810000]      <1> 		mov [lastpos], edi
 10851 000088E1 8935[E8810000]      <1> 		mov [lastpos + 4], esi
 10852 000088E7 8B7702              <1> 		mov esi, [edi + 2]
 10853 000088EA 8B3D[717C0000]      <1> 		mov edi, [windowbufloc]
 10854 000088F0 31D2                <1> 		xor edx, edx
 10855 000088F2 668B15[525B0000]    <1> 		mov dx, [resolutionx2]
 10856 000088F9 C1E204              <1> 		shl edx, 4
 10857 000088FC 29D7                <1> 		sub edi, edx
 10858 000088FE 31D2                <1> 		xor edx, edx
 10859 00008900 668B16              <1> 		mov dx, [esi]
 10860 00008903 660316              <1> 		add dx, [esi]
 10861 00008906 668B4E02            <1> 		mov cx, [esi + 2]
 10862 0000890A 6681C11000          <1> 		add cx, 16
 10863 0000890F 66A1[B8730000]      <1> 		mov ax, [background]
 10864 00008915 803D[44870000]01    <1> 		cmp byte [windrag], 1
 10865 0000891C 7604                <1> 		jbe clearwindow
 10866 0000891E 662B4E02            <1> 		sub cx, [esi + 2]
 10867                              <1> 	clearwindow:
 10868                              <1> 		%ifdef gui.background
 10869                              <1> 			cmp dword [backgroundimage], 0
 10870                              <1> 			je .noback
 10871                              <1> 			push esi
 10872                              <1> 			mov esi, [backgroundimage]
 10873                              <1> 			sub edi, [physbaseptr]
 10874                              <1> 			add esi, edi
 10875                              <1> 			add edi, [physbaseptr]
 10876                              <1> 			mov ax, [esi]
 10877                              <1> 			pop esi
 10878                              <1> 		.noback:
 10879                              <1> 		%endif
 10880 00008922 668907              <1> 		mov [edi], ax
 10881 00008925 81C702000000        <1> 		add edi, 2
 10882 0000892B 81EA02000000        <1> 		sub edx, 2
 10883 00008931 81FA00000000        <1> 		cmp edx, 0
 10884 00008937 75E9                <1> 		jne clearwindow
 10885 00008939 6649                <1> 		dec cx
 10886 0000893B 668B15[525B0000]    <1> 		mov dx, [resolutionx2]
 10887 00008942 662B16              <1> 		sub dx, [esi]
 10888 00008945 662B16              <1> 		sub dx, [esi]
 10889 00008948 01D7                <1> 		add edi, edx
 10890 0000894A 668B16              <1> 		mov dx, [esi]
 10891 0000894D 660316              <1> 		add dx, [esi]
 10892 00008950 6681F90000          <1> 		cmp cx, 0
 10893 00008955 75CB                <1> 		jne clearwindow
 10894                              <1> 	endwindowclear:
 10895 00008957 C605[E6230000]00    <1> 		mov byte [termcopyon], 0
 10896 0000895E 8B3D[E4810000]      <1> 		mov edi, [lastpos]
 10897 00008964 8B35[4F870000]      <1> 		mov esi, [grphbuf + 2]
 10898 0000896A 668B15[53870000]    <1> 		mov dx, [grphbuf + 6]
 10899 00008971 668B0D[55870000]    <1> 		mov cx, [grphbuf + 8]
 10900 00008978 668B1D[4D870000]    <1> 		mov bx, [grphbuf]
 10901 0000897F 66A1[57870000]      <1> 		mov ax, [grphbuf + 10]
 10902 00008985 88DC                <1> 		mov ah, bl
 10903 00008987 8B1D[59870000]      <1> 		mov ebx, [grphbuf + 12]
 10904                              <1> 	showgraphicsreplace:
 10905 0000898D 897702              <1> 		mov [edi + 2], esi
 10906 00008990 66895706            <1> 		mov [edi + 6], dx
 10907 00008994 66894F08            <1> 		mov [edi + 8], cx
 10908 00008998 895F0C              <1> 		mov [edi + 12], ebx
 10909 0000899B 30FF                <1> 		xor bh, bh
 10910 0000899D 88E3                <1> 		mov bl, ah
 10911 0000899F 30E4                <1> 		xor ah, ah
 10912 000089A1 6689470A            <1> 		mov [edi + 10], ax
 10913 000089A5 66891F              <1> 		mov [edi], bx
 10914 000089A8 8B5F0C              <1> 		mov ebx, [edi + 12]
 10915 000089AB 668B470A            <1> 		mov ax, [edi + 10]
 10916 000089AF C3                  <1> 		ret
 10917                              <1> 	showgraphicsnew:
 10918 000089B0 BF[9DD20300]        <1> 		mov edi, graphicstable
 10919                              <1> 	shwgrph2:
 10920 000089B5 66813F0000          <1> 		cmp word [edi], 0
 10921 000089BA 74D1                <1> 		je showgraphicsreplace
 10922 000089BC 81C710000000        <1> 		add edi, 16
 10923 000089C2 81FF[9DD40300]      <1> 		cmp edi, graphicstableend
 10924 000089C8 72EB                <1> 		jb shwgrph2
 10925                              <1> 	showgraphicsdone:
 10926 000089CA C3                  <1> 		ret
 10927                              <1> 	
 10928                              <1> putpixel: ;color in si, point is (dx,cx)
 10929                              <1> 		;destroys edi, ebx, eax
 10930 000089CB 6650                <1> 	push ax
 10931 000089CD 6653                <1> 	push bx
 10932 000089CF 31C0                <1> 	xor eax, eax
 10933 000089D1 31DB                <1> 	xor ebx, ebx
 10934 000089D3 31FF                <1> 	xor edi, edi
 10935 000089D5 668B1D[665A0000]    <1> 	mov bx, [resolutiony]
 10936 000089DC 66A1[645A0000]      <1> 	mov ax, [resolutionx]
 10937 000089E2 6639C2              <1> 	cmp dx, ax
 10938 000089E5 7720                <1> 	ja .doneput
 10939 000089E7 66D1E0              <1> 	shl ax, 1
 10940 000089EA 6639D9              <1> 	cmp cx, bx
 10941 000089ED 7718                <1> 	ja .doneput
 10942 000089EF 6689CB              <1> 	mov bx, cx
 10943 000089F2 52                  <1> 	push edx
 10944 000089F3 F7E3                <1> 	mul ebx
 10945 000089F5 5A                  <1> 	pop edx
 10946 000089F6 6601D7              <1> 	add di, dx
 10947 000089F9 6601D7              <1> 	add di, dx
 10948 000089FC 01C7                <1> 	add edi, eax
 10949 000089FE 033D[7A5A0000]      <1> 	add edi, [physbaseptr]
 10950 00008A04 668937              <1> 	mov [edi], si
 10951                              <1> .doneput:
 10952 00008A07 665B                <1> 	pop bx
 10953 00008A09 6658                <1> 	pop ax
 10954 00008A0B C3                  <1> 	ret
 10955                              <1> 	
 10956                              <1> getpixelmem:	;pixel in (dx, cx), outputs memory location in edi
 10957 00008A0C 31FF                <1> 	xor edi, edi
 10958 00008A0E 31C0                <1> 	xor eax, eax
 10959 00008A10 31DB                <1> 	xor ebx, ebx
 10960 00008A12 668B1D[525B0000]    <1> 	mov bx, [resolutionx2]
 10961 00008A19 6689D7              <1> 	mov di, dx
 10962 00008A1C 6601D7              <1> 	add di, dx
 10963 00008A1F 6689C8              <1> 	mov ax, cx
 10964 00008A22 F7E3                <1> 	mul ebx
 10965 00008A24 01C7                <1> 	add edi, eax
 10966 00008A26 033D[7A5A0000]      <1> 	add edi, [physbaseptr]
 10967 00008A2C C3                  <1> 	ret
 10968                              <1> 
 10969 00008A2D 00                  <1> 	mouseon db 0
 10970 00008A2E 0000                <1> 	icon dw 0	;pointer to icon
 10971 00008A30 00000000            <1> 	codepointer dd 0 ;pointer to code
 10972 00008A34 00                  <1> 	iconselected db 0
 10973                                  %endif
 10974                                  %ifdef network.included
 10975                                  	%include "source/network.asm"
 10976                              <1> network.init:
 10977                              <1> %ifdef rtl8139.included
 10978                              <1> 	%include "source/drivers/network/rtl8139.asm"
 10979                              <1> %endif
 10980                              <1> %ifdef rtl8169.included
 10981                              <1> 	%include "source/drivers/network/rtl8169.asm"
 10982                              <1> %endif
 10983                              <1> %ifdef ne2000.included
 10984                              <1> 	%include "source/drivers/network/ne2000.asm"
 10985                              <2> ne2000:
 10986 00008A35 E805000000          <2> 	call .init
 10987 00008A3A E93D030000          <2> 	jmp .end
 10988                              <2> 
 10989                              <2> ;	PAGE0			PAGE 1			PAGE 2
 10990                              <2> ;	READ	WRITE	READ	WRITE	READ	WRITE
 10991                              <2> ;0	CR		CR		CR		CR		CR		CR
 10992                              <2> ;1	CLDA0 	PSTART	PAR0	PAR0	PSTART	CLDA0
 10993                              <2> ;2	CLDA1	PSTOP	PAR1	PAR1	PSTOP	CLDA1
 10994                              <2> ;3	BNRY	BNRY	PAR2	PAR2	RNPP	RNPP
 10995                              <2> ;4	TSR		TPSR	PAR3	PAR3	TPSR	N/A
 10996                              <2> ;5	NCR		TBCR0	PAR4	PAR4	LNPP	LNPP
 10997                              <2> ;6	FIFO	TCBR1	PAR5	PAR5	ACU		ACU
 10998                              <2> ;7	ISR		ISR		CURR	CURR	ACL		ACL
 10999                              <2> ;8	CRDA0	RSAR0	MAR0	MAR0	N/A		N/A
 11000                              <2> ;9	CRDA1	RSAR1	MAR1	MAR1	N/A		N/A
 11001                              <2> ;A	N/A		RBCR0	MAR2	MAR2	N/A		N/A
 11002                              <2> ;B	N/A		RBCR1	MAR3	MAR3	N/A		N/A
 11003                              <2> ;C	RSR		RCR		MAR4	MAR4	RCR		N/A
 11004                              <2> ;D	CNTR0	TCR		MAR5	MAR5	TCR		N/A
 11005                              <2> ;E	CNTR1	DCR		MAR6	MAR6	DCR		N/A
 11006                              <2> ;F	CNTR2	IMR		MAR7	MAR7	IMR		N/A
 11007                              <2> .CR equ 0
 11008                              <2> 	.CR.STP	equ 1		;Stop
 11009                              <2> 	.CR.STA equ 2		;Start
 11010                              <2> 	.CR.TXP equ 4		;Transmit
 11011                              <2> 	.CR.RD0 equ 8		;Remote DMA 0
 11012                              <2> 	.CR.RD1 equ 0x10	;Remote DMA 1
 11013                              <2> 	.CR.RD2 equ 0x20	;Remote DMA 2
 11014                              <2> 	.CR.PS0 equ 0x40	;Page Select 0
 11015                              <2> 	.CR.PS1 equ 0x80	;Page Select 1
 11016                              <2> .PSTART equ 1
 11017                              <2> .PSTOP equ 2
 11018                              <2> .BNRY equ 3
 11019                              <2> .ISR equ 7
 11020                              <2> 	.ISR.PRX equ 1		;Packet Received
 11021                              <2> 	.ISR.PTX equ 2		;Packet Transmitted
 11022                              <2> 	.ISR.RXE equ 4		;Receive Error
 11023                              <2> 	.ISR.TXE equ 8		;Transmission Error
 11024                              <2> 	.ISR.OVW equ 0x10	;Overwrite
 11025                              <2> 	.ISR.CNT equ 0x20	;Counter Overflow
 11026                              <2> 	.ISR.RDC equ 0x40	;Remote Data Complete
 11027                              <2> 	.ISR.RST equ 0x80	;Reset status
 11028                              <2> .RSAR0 equ 8
 11029                              <2> .RSAR1 equ 9
 11030                              <2> .RBCR0 equ 0xA
 11031                              <2> .RBCR1 equ 0xB
 11032                              <2> .RCR equ 0xC
 11033                              <2> 	.RCR.SEP equ 1		;Save Errored Packets
 11034                              <2> 	.RCR.AR equ 2		;Accept Runt packet
 11035                              <2> 	.RCR.AB equ 4		;Accept Broadcast
 11036                              <2> 	.RCR.AM equ 8		;Accept Multicast
 11037                              <2> 	.RCR.PRO equ 0x10	;Promiscuous Physical
 11038                              <2> 	.RCR.MON equ 0x20	;Monitor Mode
 11039                              <2> .DCR equ 0xE
 11040                              <2> 	.DCR.WTS equ 1		;Word Transfer Select
 11041                              <2> 	.DCR.BOS equ 2		;Byte Order Select
 11042                              <2> 	.DCR.LAS equ 4		;Long Address Select
 11043                              <2> 	.DCR.LS equ 8		;Loopback Select
 11044                              <2> 	.DCR.AR equ 0x10	;Auto-initialize Remote
 11045                              <2> 	.DCR.FT0 equ 0x20	;FIFO Threshold Select 0
 11046                              <2> 	.DCR.FT1 equ 0x40	;FIFO Threshold Select 1
 11047                              <2> .ASIC equ 0x10
 11048                              <2> .RESET equ 0x1F
 11049                              <2> 
 11050                              <2> .init:
 11051 00008A3F BBFFFFFFFF          <2> 	mov ebx, 0xFFFFFFFF
 11052 00008A44 31C0                <2> 	xor eax, eax
 11053 00008A46 A2[C6670000]        <2> 	mov [pcifunction], al
 11054 00008A4B A2[C4670000]        <2> 	mov [pcibus], al
 11055 00008A50 A2[C5670000]        <2> 	mov [pcidevice], al
 11056 00008A55 B002                <2> 	mov al, 2 ;type code
 11057 00008A57 A2[55680000]        <2> 	mov [pcitype], al
 11058 00008A5C B8EC102980          <2> 	mov eax, 0x802910EC
 11059 00008A61 A3[C9670000]        <2> 	mov [pcidevid], eax
 11060 00008A66 E872DDFFFF          <2> 	call getpciport
 11061 00008A6B 81FBFFFFFFFF        <2> 	cmp ebx, 0xFFFFFFFF
 11062 00008A71 7501                <2> 	jne .good0
 11063 00008A73 C3                  <2> 	ret
 11064                              <2> .good0:
 11065 00008A74 8915[3E8D0000]      <2> 	mov [.basenicaddr], edx
 11066 00008A7A 89D1                <2> 	mov ecx, edx
 11067                              <2> .test:
 11068 00008A7C E854000000          <2> 	call .reset
 11069 00008A81 E87B000000          <2> 	call .stop
 11070 00008A86 89CA                <2> 	mov edx, ecx
 11071 00008A88 B9FF000000          <2> 	mov ecx, 0xFF
 11072 00008A8D E2FE                <2> 	loop $ ;wait for ~100 us
 11073 00008A8F 89D1                <2> 	mov ecx, edx
 11074 00008A91 EC                  <2> 	in al, dx
 11075 00008A92 2427                <2> 	and al, (.CR.RD2 | .CR.TXP | .CR.STA | .CR.STP)
 11076 00008A94 3C21                <2> 	cmp al, (.CR.RD2 | .CR.STP)
 11077 00008A96 7410                <2> 	je .good1
 11078 00008A98 89CA                <2> 	mov edx, ecx
 11079 00008A9A 81C207000000        <2> 	add edx, .ISR
 11080 00008AA0 EC                  <2> 	in al, dx
 11081 00008AA1 2480                <2> 	and al, .ISR.RST
 11082 00008AA3 3C80                <2> 	cmp al, .ISR.RST
 11083 00008AA5 7401                <2> 	je .good1
 11084 00008AA7 C3                  <2> 	ret
 11085                              <2> .good1:
 11086 00008AA8 E81DA7FFFF          <2> call showhex	;for debugging, please remove
 11087 00008AAD E85B000000          <2> 	call .setup
 11088 00008AB2 E86B030000          <2> call showmac
 11089 00008AB7 BE[438D0000]        <2> mov esi, .name
 11090 00008ABC E89B92FFFF          <2> call print
 11091 00008AC1 BE[4B8D0000]        <2> mov esi, .initmsg
 11092 00008AC6 E89192FFFF          <2> call print
 11093 00008ACB C605[428D0000]01    <2> 	mov byte [.nicconfig], 1
 11094 00008AD2 31DB                <2> 	xor ebx, ebx
 11095 00008AD4 C3                  <2> 	ret
 11096                              <2> .reset:
 11097 00008AD5 8B15[3E8D0000]      <2> 	mov edx, [.basenicaddr]
 11098 00008ADB 81C21F000000        <2> 	add edx, .RESET
 11099 00008AE1 EC                  <2> 	in al, dx
 11100 00008AE2 EE                  <2> 	out dx, al ;write its contents to itself
 11101 00008AE3 C3                  <2> 	ret
 11102                              <2> .page:
 11103 00008AE4 66C1E00E            <2> 	shl ax, 14
 11104 00008AE8 8B15[3E8D0000]      <2> 	mov edx, [.basenicaddr]
 11105 00008AEE EC                  <2> 	in al, dx
 11106 00008AEF 243F                <2> 	and al, 00111111b
 11107 00008AF1 08E0                <2> 	or al, ah
 11108 00008AF3 EE                  <2> 	out dx, al
 11109 00008AF4 C3                  <2> 	ret
 11110                              <2> .start:
 11111 00008AF5 8B15[3E8D0000]      <2> 	mov edx, [.basenicaddr]
 11112 00008AFB B020                <2> 	mov al, .CR.RD2
 11113 00008AFD B002                <2> 	mov al, .CR.STA
 11114 00008AFF EE                  <2> 	out dx, al
 11115 00008B00 C3                  <2> 	ret
 11116                              <2> .stop:
 11117 00008B01 8B15[3E8D0000]      <2> 	mov edx, [.basenicaddr]
 11118 00008B07 B020                <2> 	mov al, .CR.RD2
 11119 00008B09 0C01                <2> 	or al, .CR.STP
 11120 00008B0B EE                  <2> 	out dx, al
 11121 00008B0C C3                  <2> 	ret
 11122                              <2> .setup:
 11123 00008B0D E8EFFFFFFF          <2> 	call .stop
 11124 00008B12 8B15[3E8D0000]      <2> 	mov edx, [.basenicaddr]
 11125 00008B18 81C20E000000        <2> 	add edx, .DCR
 11126 00008B1E B040                <2> 	mov al, .DCR.FT1
 11127 00008B20 0C01                <2> 	or al, .DCR.WTS
 11128 00008B22 0C08                <2> 	or al, .DCR.LS
 11129 00008B24 EE                  <2> 	out dx, al ;Set FIFO threshold, byte order, word-wide DMA
 11130 00008B25 E8B9000000          <2> 	call .getmac
 11131 00008B2A E8D2FFFFFF          <2> 	call .stop
 11132 00008B2F 30C0                <2> 	xor al, al
 11133 00008B31 8B15[3E8D0000]      <2> 	mov edx, [.basenicaddr]
 11134 00008B37 81C20A000000        <2> 	add edx, .RBCR0
 11135 00008B3D EE                  <2> 	out dx, al
 11136 00008B3E 6642                <2> 	inc dx
 11137 00008B40 EE                  <2> 	out dx, al ;Clear byte count
 11138 00008B41 B800400000          <2> 	mov eax, 16*1024
 11139 00008B46 A3[5E8D0000]        <2> 	mov [.ringstart], eax
 11140 00008B4B C1E808              <2> 	shr eax, 8
 11141 00008B4E 66A3[5A8D0000]      <2> 	mov [.pagestart], ax
 11142 00008B54 0534000000          <2> 	add eax, 64-2*6
 11143 00008B59 A3[5C8D0000]        <2> 	mov [.pageend], eax
 11144 00008B5E C1E008              <2> 	shl eax, 8
 11145 00008B61 66A3[628D0000]      <2> 	mov [.ringend], ax ;set page and ring starts and ends
 11146 00008B67 8B15[3E8D0000]      <2> 	mov edx, [.basenicaddr]
 11147 00008B6D 81C201000000        <2> 	add edx, .PSTART
 11148 00008B73 A0[5A8D0000]        <2> 	mov al, [.pagestart]
 11149 00008B78 EE                  <2> 	out dx, al
 11150 00008B79 A0[5C8D0000]        <2> 	mov al, [.pageend]
 11151 00008B7E 6642                <2> 	inc dx
 11152 00008B80 EE                  <2> 	out dx, al
 11153 00008B81 A0[5A8D0000]        <2> 	mov al, [.pagestart]
 11154 00008B86 6642                <2> 	inc dx
 11155 00008B88 EE                  <2> 	out dx, al
 11156 00008B89 E873FFFFFF          <2> 	call .stop
 11157                              <2> ;INSERT INTERRUPT ENABLE HERE
 11158 00008B8E B001                <2> 	mov al, 1
 11159 00008B90 E84FFFFFFF          <2> 	call .page
 11160 00008B95 8B15[3E8D0000]      <2> 	mov edx, [.basenicaddr]
 11161 00008B9B BF[6C8D0000]        <2> 	mov edi, .rom
 11162                              <2> .copymactocard:
 11163 00008BA0 42                  <2> 	inc edx
 11164 00008BA1 6E                  <2> 	outsb
 11165 00008BA2 81C702000000        <2> 	add edi, 2
 11166 00008BA8 81FA06000000        <2> 	cmp edx, 6
 11167 00008BAE 76F0                <2> 	jbe .copymactocard
 11168 00008BB0 8B15[3E8D0000]      <2> 	mov edx, [.basenicaddr]
 11169 00008BB6 81C207000000        <2> 	add edx, 7
 11170 00008BBC A0[5A8D0000]        <2> 	mov al, [.pagestart]
 11171 00008BC1 FEC0                <2> 	inc al
 11172 00008BC3 EE                  <2> 	out dx, al ;set page in CURR register
 11173                              <2> ;INSERT MULTICAST INIT HERE
 11174 00008BC4 E838FFFFFF          <2> 	call .stop
 11175 00008BC9 8B15[3E8D0000]      <2> 	mov edx, [.basenicaddr]
 11176 00008BCF 81C20C000000        <2> 	add edx, .RCR
 11177 00008BD5 B004                <2> 	mov al, .RCR.AB
 11178 00008BD7 EE                  <2> 	out dx, al ;accept broadcast
 11179 00008BD8 6642                <2> 	inc dx
 11180 00008BDA 30C0                <2> 	xor al, al
 11181 00008BDC EE                  <2> 	out dx, al ;stop loopback
 11182 00008BDD E813FFFFFF          <2> 	call .start
 11183 00008BE2 C3                  <2> 	ret
 11184                              <2> .getmac:
 11185 00008BE3 8B15[3E8D0000]      <2> 	mov edx, [.basenicaddr]
 11186 00008BE9 B020                <2> 	mov al, 0x20
 11187 00008BEB 0C02                <2> 	or al, 2
 11188 00008BED EE                  <2> 	out dx, al	;set STA and RD2 bits
 11189 00008BEE 6681C20A00          <2> 	add dx, .RBCR0
 11190 00008BF3 B010                <2> 	mov al, 16
 11191 00008BF5 EE                  <2> 	out dx, al
 11192 00008BF6 6642                <2> 	inc dx
 11193 00008BF8 30C0                <2> 	xor al, al
 11194 00008BFA EE                  <2> 	out dx, al
 11195 00008BFB 8B15[3E8D0000]      <2> 	mov edx, [.basenicaddr]
 11196 00008C01 6681C20800          <2> 	add dx, .RSAR0
 11197 00008C06 EE                  <2> 	out dx, al
 11198 00008C07 6642                <2> 	inc dx
 11199 00008C09 EE                  <2> 	out dx, al
 11200 00008C0A 668B15[3E8D0000]    <2> 	mov dx, [.basenicaddr]
 11201 00008C11 B008                <2> 	mov al, 8
 11202 00008C13 0C02                <2> 	or al, 2
 11203 00008C15 EE                  <2> 	out dx, al
 11204 00008C16 668B15[3E8D0000]    <2> 	mov dx, [.basenicaddr]
 11205 00008C1D 6681C21000          <2> 	add dx, .ASIC
 11206 00008C22 B908000000          <2> 	mov ecx, 8
 11207 00008C27 BF[6C8D0000]        <2> 	mov edi, .rom
 11208 00008C2C F3666D              <2> 	rep insw
 11209                              <2> .copymac:
 11210 00008C2F BF[6C8D0000]        <2> 	mov edi, .rom
 11211 00008C34 BE[668D0000]        <2> 	mov esi, .mac
 11212 00008C39 B906000000          <2> 	mov ecx, 6
 11213                              <2> .lpmac:
 11214 00008C3E 8A07                <2> 	mov al, [edi]
 11215 00008C40 8806                <2> 	mov [esi], al
 11216 00008C42 81C702000000        <2> 	add edi, 2
 11217 00008C48 46                  <2> 	inc esi
 11218 00008C49 E2F3                <2> 	loop .lpmac
 11219 00008C4B B9[668D0000]        <2> 	mov ecx, .mac
 11220 00008C50 C3                  <2> 	ret
 11221                              <2> .sendpacket:
 11222 00008C51 803D[428D0000]00    <2> 	cmp byte [.nicconfig], 0
 11223 00008C58 7512                <2> 	jne .sendit
 11224 00008C5A 56                  <2> 	push esi
 11225 00008C5B 57                  <2> 	push edi
 11226 00008C5C E8DEFDFFFF          <2> 	call .init
 11227 00008C61 5F                  <2> 	pop edi
 11228 00008C62 5E                  <2> 	pop esi
 11229 00008C63 81FB00000000        <2> 	cmp ebx, 0
 11230 00008C69 7401                <2> 	je .sendit
 11231 00008C6B C3                  <2> 	ret
 11232                              <2> .sendit: ;packet start in edi, end in esi
 11233 00008C6C 87F7                <2> 	xchg esi, edi ;this helps with the outsw
 11234                              <2> 	;now the packet start is in esi, end in edi
 11235 00008C6E 8B0D[668D0000]      <2> 	mov ecx, [.mac]
 11236 00008C74 894E06              <2> 	mov [esi + 6], ecx
 11237 00008C77 668B0D[6A8D0000]    <2> 	mov cx, [.mac + 4]
 11238 00008C7E 66894E0A            <2> 	mov [esi + 10], cx	;copy the correct mac
 11239 00008C82 8B15[3E8D0000]      <2> 	mov edx, [.basenicaddr]
 11240 00008C88 B020                <2> 	mov al, .CR.RD2
 11241 00008C8A 0C02                <2> 	or al, .CR.STA
 11242 00008C8C EE                  <2> 	out dx, al ;set RD2 and STA
 11243 00008C8D 81C207000000        <2> 	add edx, .ISR ; ISR
 11244 00008C93 B040                <2> 	mov al, .ISR.RDC
 11245 00008C95 EE                  <2> 	out dx, al ;set RDC flag
 11246 00008C96 8B15[3E8D0000]      <2> 	mov edx, [.basenicaddr]
 11247 00008C9C 6681C20A00          <2> 	add dx, .RBCR0
 11248 00008CA1 89F8                <2> 	mov eax, edi
 11249 00008CA3 29F0                <2> 	sub eax, esi
 11250 00008CA5 BB01000000          <2> 	mov ebx, 1
 11251 00008CAA 21C3                <2> 	and ebx, eax
 11252 00008CAC 81FB01000000        <2> 	cmp ebx, 1
 11253 00008CB2 7501                <2> 	jne .nofixword
 11254 00008CB4 40                  <2> 	inc eax
 11255                              <2> .nofixword:
 11256 00008CB5 89C1                <2> 	mov ecx, eax ;save length in ecx
 11257 00008CB7 EE                  <2> 	out dx, al
 11258 00008CB8 86C4                <2> 	xchg al, ah
 11259 00008CBA 6642                <2> 	inc dx
 11260 00008CBC EE                  <2> 	out dx, al ;send size
 11261 00008CBD 8B15[3E8D0000]      <2> 	mov edx, [.basenicaddr]
 11262 00008CC3 6681C20800          <2> 	add dx, .RSAR0
 11263 00008CC8 66A1[5A8D0000]      <2> 	mov ax, [.pagestart]
 11264 00008CCE C1E008              <2> 	shl eax, 8
 11265 00008CD1 EE                  <2> 	out dx, al
 11266 00008CD2 86C4                <2> 	xchg al, ah
 11267 00008CD4 6642                <2> 	inc dx
 11268 00008CD6 EE                  <2> 	out dx, al ;send address in NIC memory
 11269 00008CD7 8B15[3E8D0000]      <2> 	mov edx, [.basenicaddr]
 11270 00008CDD B010                <2> 	mov al, .CR.RD1
 11271 00008CDF 0C02                <2> 	or al, .CR.STA
 11272 00008CE1 EE                  <2> 	out dx, al ;set RD and STA
 11273 00008CE2 89CB                <2> 	mov ebx, ecx ;save length in ebx
 11274 00008CE4 D1E9                <2> 	shr ecx, 1
 11275 00008CE6 8B15[3E8D0000]      <2> 	mov edx, [.basenicaddr]
 11276 00008CEC 6681C21000          <2> 	add dx, 0x10
 11277 00008CF1 F3666F              <2> 	rep outsw ;Send the packet data
 11278 00008CF4 8B15[3E8D0000]      <2> 	mov edx, [.basenicaddr]
 11279 00008CFA 6681C20700          <2> 	add dx, .ISR
 11280                              <2> .chkcopylp:
 11281 00008CFF B440                <2> 	mov ah, .ISR.RDC
 11282 00008D01 EC                  <2> 	in al, dx
 11283 00008D02 20C4                <2> 	and ah, al
 11284 00008D04 80FC40              <2> 	cmp ah, 0x40
 11285 00008D07 75F6                <2> 	jne .chkcopylp	
 11286 00008D09 8B15[3E8D0000]      <2> 	mov edx, [.basenicaddr]
 11287 00008D0F 6681C20400          <2> 	add dx, 4
 11288 00008D14 A0[5A8D0000]        <2> 	mov al, [.pagestart]
 11289 00008D19 EE                  <2> 	out dx, al ;send start address in pages
 11290 00008D1A 8B15[3E8D0000]      <2> 	mov edx, [.basenicaddr]
 11291 00008D20 81C205000000        <2> 	add edx, 0x5
 11292 00008D26 89D8                <2> 	mov eax, ebx
 11293 00008D28 EE                  <2> 	out dx, al
 11294 00008D29 86C4                <2> 	xchg al, ah
 11295 00008D2B 6642                <2> 	inc dx
 11296 00008D2D EE                  <2> 	out dx, al ;send length
 11297 00008D2E 8B15[3E8D0000]      <2> 	mov edx, [.basenicaddr]
 11298 00008D34 B020                <2> 	mov al, 0x20
 11299 00008D36 0C04                <2> 	or al, 4
 11300 00008D38 0C02                <2> 	or al, 2
 11301 00008D3A EE                  <2> 	out dx, al ;set RD2, TXP, and STA
 11302 00008D3B 31DB                <2> 	xor ebx, ebx
 11303 00008D3D C3                  <2> 	ret
 11304 00008D3E 00000000            <2> .basenicaddr dd 0
 11305 00008D42 00                  <2> .nicconfig db 0
 11306 00008D43 4E45323030302000    <2> .name db "NE2000 ",0
 11307 00008D4B 496E697469616C697A- <2> .initmsg db "Initialized.",10,0
 11308 00008D54 65642E0A00          <2>
 11309 00008D59 90                  <2> align 2, nop
 11310 00008D5A 0000                <2> .pagestart dw 0
 11311 00008D5C 0000                <2> .pageend dw 0
 11312 00008D5E 00000000            <2> .ringstart dd 0
 11313 00008D62 00000000            <2> .ringend dd 0
 11314 00008D66 000000000000        <2> .mac db 0,0,0,0,0,0
 11315 00008D6C 00<rept>            <2> .rom times 16 db 0
 11316                              <2> 
 11317                              <2> .end:
 11318                              <1> %endif
 11319                              <1> %ifdef i8254x.included
 11320                              <1> 	%include "source/drivers/network/i8254x.asm"
 11321                              <1> %endif
 11322 00008D7C C3                  <1> 	ret
 11323                              <1> 
 11324                              <1> sendpacket: ;packet start in edi, end in esi
 11325                              <1> 	%ifdef rtl8139.included
 11326                              <1> 		push edi
 11327                              <1> 		push esi
 11328                              <1> 		call rtl8139.sendpacket
 11329                              <1> 		pop esi
 11330                              <1> 		pop edi
 11331                              <1> 	%endif
 11332                              <1> 	%ifdef rtl8169.included
 11333                              <1> 		push edi
 11334                              <1> 		push esi
 11335                              <1> 		call rtl8169.sendpacket
 11336                              <1> 		pop esi
 11337                              <1> 		pop edi
 11338                              <1> 	%endif
 11339                              <1> 	%ifdef ne2000.included
 11340 00008D7D 57                  <1> 		push edi
 11341 00008D7E 56                  <1> 		push esi
 11342 00008D7F E8CDFEFFFF          <1> 		call ne2000.sendpacket
 11343 00008D84 5E                  <1> 		pop esi
 11344 00008D85 5F                  <1> 		pop edi
 11345                              <1> 	%endif
 11346                              <1> 	%ifdef i8254x.included
 11347                              <1> 		call i8254x.sendpacket
 11348                              <1> 	%endif
 11349 00008D86 C3                  <1> 	ret
 11350                              <1> 
 11351                              <1> getchecksum: ;start in edi, end in esi, checksum put in ecx
 11352 00008D87 31C0                <1> 	xor eax, eax
 11353 00008D89 31DB                <1> 	xor ebx, ebx
 11354 00008D8B 31C9                <1> 	xor ecx, ecx
 11355                              <1> .lp:
 11356 00008D8D 8A07                <1> 	mov al, [edi]
 11357 00008D8F 8A6701              <1> 	mov ah, [edi + 1]
 11358 00008D92 01C3                <1> 	add ebx, eax
 11359 00008D94 81C702000000        <1> 	add edi, 2
 11360 00008D9A 39F7                <1> 	cmp edi, esi
 11361 00008D9C 72EF                <1> 	jb .lp
 11362 00008D9E 66B9FFFF            <1> 	mov cx, 0xFFFF
 11363 00008DA2 6689D8              <1> 	mov ax, bx
 11364 00008DA5 C1EB10              <1> 	shr ebx, 16
 11365 00008DA8 6601D8              <1> 	add ax, bx
 11366 00008DAB 6629C1              <1> 	sub cx, ax
 11367 00008DAE C3                  <1> 	ret
 11368                              <1> 	
 11369                              <1> strtoip:	;string in esi with format X.X.X.X converted to number in ecx
 11370 00008DAF 31DB                <1> 	xor ebx, ebx
 11371 00008DB1 31C9                <1> 	xor ecx, ecx
 11372 00008DB3 31D2                <1> 	xor edx, edx
 11373                              <1> .mlp:
 11374 00008DB5 89F7                <1> 	mov edi, esi
 11375 00008DB7 4F                  <1> 	dec edi
 11376                              <1> .lp:
 11377 00008DB8 47                  <1> 	inc edi
 11378 00008DB9 8A07                <1> 	mov al, [edi]
 11379 00008DBB 3C20                <1> 	cmp al, " "
 11380 00008DBD 7408                <1> 	je .dnlp
 11381 00008DBF 3C00                <1> 	cmp al, 0
 11382 00008DC1 7404                <1> 	je .dnlp
 11383 00008DC3 3C2E                <1> 	cmp al, "."
 11384 00008DC5 75F1                <1> 	jne .lp
 11385                              <1> .dnlp:
 11386 00008DC7 30C0                <1> 	xor al, al
 11387 00008DC9 8807                <1> 	mov [edi], al
 11388 00008DCB 53                  <1> 	push ebx
 11389 00008DCC 56                  <1> 	push esi
 11390 00008DCD 57                  <1> 	push edi
 11391 00008DCE 31FF                <1> 	xor edi, edi
 11392 00008DD0 E88BA5FFFF          <1> 	call cnvrttxt
 11393 00008DD5 5E                  <1> 	pop esi
 11394 00008DD6 5F                  <1> 	pop edi ;i intentionally switch them
 11395 00008DD7 5B                  <1> 	pop ebx
 11396 00008DD8 46                  <1> 	inc esi
 11397 00008DD9 BF[F18D0000]        <1> 	mov edi, ipstr
 11398 00008DDE 880C1F              <1> 	mov [edi + ebx], cl
 11399 00008DE1 43                  <1> 	inc ebx
 11400 00008DE2 81FB04000000        <1> 	cmp ebx, 4
 11401 00008DE8 72CB                <1> 	jb .mlp
 11402 00008DEA 8B0D[F18D0000]      <1> 	mov ecx, [ipstr]
 11403 00008DF0 C3                  <1> 	ret
 11404 00008DF1 00000000            <1> ipstr dd 0
 11405                              <1> showip: 	;put the ip address in ecx
 11406 00008DF5 89C8                <1> 	mov eax, ecx
 11407 00008DF7 30DB                <1> 	xor bl, bl
 11408                              <1> .lp:
 11409 00008DF9 31C9                <1> 	xor ecx, ecx
 11410 00008DFB 88C1                <1> 	mov cl, al
 11411 00008DFD E883A4FFFF          <1> 	call showdec
 11412 00008E02 C1E808              <1> 	shr eax, 8
 11413 00008E05 FEC3                <1> 	inc bl
 11414 00008E07 80FB04              <1> 	cmp bl, 4
 11415 00008E0A 7312                <1> 	jae .done
 11416 00008E0C 50                  <1> 	push eax
 11417 00008E0D 6653                <1> 	push bx
 11418 00008E0F BE[1F8E0000]        <1> 	mov esi, .dot
 11419 00008E14 E8438FFFFF          <1> 	call print
 11420 00008E19 665B                <1> 	pop bx
 11421 00008E1B 58                  <1> 	pop eax
 11422 00008E1C EBDB                <1> 	jmp .lp
 11423                              <1> .done:
 11424 00008E1E C3                  <1> 	ret
 11425 00008E1F 082E00              <1> .dot db 8,".",0
 11426                              <1> showmac:	;mac begins in [ecx]
 11427 00008E22 BE[728E0000]        <1> 	mov esi, macprint
 11428 00008E27 89CF                <1> 	mov edi, ecx
 11429 00008E29 81C106000000        <1> 	add ecx, 6
 11430                              <1> showmacloop:
 11431 00008E2F 8A07                <1> 	mov al, [edi]
 11432 00008E31 8A27                <1> 	mov ah, [edi]
 11433 00008E33 C0E804              <1> 	shr al, 4
 11434 00008E36 C0E404              <1> 	shl ah, 4
 11435 00008E39 C0EC04              <1> 	shr ah, 4
 11436 00008E3C 0430                <1> 	add al, 48
 11437 00008E3E 3C39                <1> 	cmp al, "9"
 11438 00008E40 7606                <1> 	jbe .goodal
 11439 00008E42 2C30                <1> 	sub al, 48
 11440 00008E44 2C0A                <1> 	sub al, 0xA
 11441 00008E46 0441                <1> 	add al, "A"
 11442                              <1> .goodal:
 11443 00008E48 80C430              <1> 	add ah, 48
 11444 00008E4B 80FC39              <1> 	cmp ah, "9"
 11445 00008E4E 7609                <1> 	jbe .goodah
 11446 00008E50 80EC30              <1> 	sub ah, 48
 11447 00008E53 80EC0A              <1> 	sub ah, 0xA
 11448 00008E56 80C441              <1> 	add ah, "A"
 11449                              <1> .goodah:
 11450 00008E59 668906              <1> 	mov [esi], ax
 11451 00008E5C 81C603000000        <1> 	add esi, 3
 11452 00008E62 47                  <1> 	inc edi
 11453 00008E63 39CF                <1> 	cmp edi, ecx
 11454 00008E65 72C8                <1> 	jb showmacloop
 11455 00008E67 BE[728E0000]        <1> 	mov esi, macprint
 11456 00008E6C E8EB8EFFFF          <1> 	call print
 11457 00008E71 C3                  <1> 	ret
 11458                              <1> 	
 11459 00008E72 30303A30303A30303A- <1> macprint db "00:00:00:00:00:00 ",0
 11460 00008E7B 30303A30303A303020- <1>
 11461 00008E84 00                  <1>
 11462 00008E85 00000000            <1> ethernetend dw 0,0
 11463 00008E89 C0A80002            <1> sysip db 192,168,0,2
 11464 00008E8D 000000000000        <1> sysmac	db 0,0,0,0,0,0		;my mac address
 11465                                  %endif
 11466                                      %include "source/data.asm"
 11467 00008E93 626F6F742E736800    <1> 	bootfilename db	"boot.sh",0
 11468 00008E9B 73687573683A2000    <1> 	notfound1 db	"shush: ",0
 11469 00008EA3 3A206E6F7420666F75- <1> 	notfound2 db	": not found",10,0
 11470 00008EAC 6E640A00            <1>
 11471 00008EB0 757365726E616D653A- <1> 	userask db	"username:",0
 11472 00008EB9 00                  <1>
 11473 00008EBA 70617373776F72643A- <1> 	pwdask	db	"password:",0
 11474 00008EC3 00                  <1>
 11475 00008EC4 40                  <1> 	computer db	"@"
 11476                              <1> %ifdef io.serial
 11477                              <1> 	computername db	"SollerOS.",io.serial," ",0
 11478                              <1> %else
 11479 00008EC5 536F6C6C65724F5320- <1> 	computername db	"SollerOS ",0
 11480 00008ECE 00                  <1>
 11481                              <1> %endif
 11482 00008ECF 5D242000            <1> 	endprompt db "]$ ",0
 11483 00008ED3 0D                  <1> 	crlf 	db	13
 11484 00008ED4 0A00                <1> 	line	db	10,0
 11485                              <1> 	userlst:
 11486 00008ED6 726F6F7400          <1> 			db "root",0
 11487 00008EDB 617765736F6D65706F- <1> 			db "awesomepower",0
 11488 00008EE4 77657200            <1>
 11489 00008EE8 7573657200          <1> 			db "user",0
 11490 00008EED 70617373776F726400  <1> 			db "password",0
 11491 00008EF6 6E00                <1> 			db "n",0	;abuse for quick entry-a quick double n followed by a double enter will get you in
 11492 00008EF8 00                  <1> 			db 0
 11493                              <1> 	userlstend:
 11494                              <1> 	
 11495 00008EF9 00                  <1> 	guion db 0
 11496 00008EFA 00                  <1> 	DriveNumber db 0
 11497 00008EFB 00000000            <1> 	lbaad dd 0
 11498 00008EFF 0000000000000000    <1> 	initialtsc dd 0,0
 11499 00008F07 0000000000000000    <1> 	lasttsc dd 0,0
 11500 00008F0F 00<rept>            <1> 	memlistbuf times 576 db 0
 11501 0000914F 00000000            <1> 	memlistend: dd 0
 11502                              <1> %ifdef io.serial
 11503                              <1> %else
 11504                              <1> fonts:
 11505                              <1> %ifdef font.unicode
 11506 0000914F <incbin>            <1> 	incbin "source/fonts/fonts-unicode.pak"
 11507                              <1> %else
 11508                              <1> 	incbin "source/fonts/fonts-ascii.pak"
 11509                              <1> %endif
 11510                              <1> fontend:
 11511                              <1> %endif
 11512                              <1> osend:	;this is the end of the operating system's space on disk
 11513                                  %ifdef disk.none
 11514                                  	diskfileindex:
 11515                                  	enddiskfileindex:
 11516                                      %include "source/bss.asm"
 11517                                  %else
 11518                                      %include "build/fileindex.asm"
 11519                              <1> diskfileindex:
 11520 00039153 626F6F742E736800    <1> db "boot.sh",0
 11521 0003915B CA010000            <1> dd (f0-$$)/512
 11522 0003915F 01000000            <1> dd (f1-f0)/512
 11523 00039163 646F73746573742E63- <1> db "dostest.com",0
 11524 0003916C 6F6D00              <1>
 11525 0003916F CB010000            <1> dd (f1-$$)/512
 11526 00039173 01000000            <1> dd (f2-f1)/512
 11527 00039177 6578656300          <1> db "exec",0
 11528 0003917C CC010000            <1> dd (f2-$$)/512
 11529 00039180 01000000            <1> dd (f3-f2)/512
 11530 00039184 66696E616C636F756E- <1> db "finalcount.sn",0
 11531 0003918D 742E736E00          <1>
 11532 00039192 CD010000            <1> dd (f3-$$)/512
 11533 00039196 01000000            <1> dd (f4-f3)/512
 11534 0003919A 666F726B00          <1> db "fork",0
 11535 0003919F CE010000            <1> dd (f4-$$)/512
 11536 000391A3 01000000            <1> dd (f5-f4)/512
 11537 000391A7 6775697465737400    <1> db "guitest",0
 11538 000391AF CF010000            <1> dd (f5-$$)/512
 11539 000391B3 03000000            <1> dd (f6-f5)/512
 11540 000391B7 696E7400            <1> db "int",0
 11541 000391BB D2010000            <1> dd (f6-$$)/512
 11542 000391BF 01000000            <1> dd (f7-f6)/512
 11543 000391C3 6C6F7374776F6F6473- <1> db "lostwoods.sn",0
 11544 000391CC 2E736E00            <1>
 11545 000391D0 D3010000            <1> dd (f7-$$)/512
 11546 000391D4 01000000            <1> dd (f8-f7)/512
 11547 000391D8 6D6172696F2E736E00  <1> db "mario.sn",0
 11548 000391E1 D4010000            <1> dd (f8-$$)/512
 11549 000391E5 01000000            <1> dd (f9-f8)/512
 11550 000391E9 736F6E676F74696D65- <1> db "songotime.sn",0
 11551 000391F2 2E736E00            <1>
 11552 000391F6 D5010000            <1> dd (f9-$$)/512
 11553 000391FA 01000000            <1> dd (f10-f9)/512
 11554 000391FE 73736500            <1> db "sse",0
 11555 00039202 D6010000            <1> dd (f10-$$)/512
 11556 00039206 02000000            <1> dd (f11-f10)/512
 11557 0003920A 74656C7900          <1> db "tely",0
 11558 0003920F D8010000            <1> dd (f11-$$)/512
 11559 00039213 01000000            <1> dd (f12-f11)/512
 11560 00039217 756E667300          <1> db "unfs",0
 11561 0003921C D9010000            <1> dd (f12-$$)/512
 11562 00039220 02000000            <1> dd (f13-f12)/512
 11563 00039224 5F696D672E62696E00  <1> db "_img.bin",0
 11564 0003922D DB010000            <1> dd (f13-$$)/512
 11565 00039231 0C000000            <1> dd (f14-f13)/512
 11566                              <1> enddiskfileindex:
 11567                              <1> 
 11568                                      %include "source/bss.asm"
 11569 00039235 00<rept>            <1> align 512, db 0
 11570                              <1> bssstart equ $
 11571                              <1> bsscopy equ $
 11572                              <1> initialstack equ bsscopy
 11573                              <1> stackend equ initialstack + 8192
 11574                              <1> sigtable equ stackend + 4
 11575                              <1> fileindex equ sigtable + 4
 11576                              <1> fileindexend equ fileindex + 1024
 11577                              <1> previousstack equ fileindexend
 11578                              <1> lastfolderloc equ previousstack + 4
 11579                              <1> currentfolderloc equ lastfolderloc + 4
 11580                              <1> currentfolder equ currentfolderloc + 4
 11581                              <1> currentfolderend equ currentfolder + 512
 11582                              <1> uid equ currentfolderend
 11583                              <1> ranboot equ uid + 4
 11584                              <1> IFON equ ranboot + 1
 11585                              <1> IFTRUE equ IFON + 1
 11586                              <1> BATCHPOS equ IFTRUE + 100
 11587                              <1> BATCHISON equ BATCHPOS + 4
 11588                              <1> LOOPON equ BATCHISON + 1
 11589                              <1> LOOPPOS	equ LOOPON + 1
 11590                              <1> variables equ LOOPPOS + 4
 11591                              <1> varend equ variables + 4096
 11592                              <1> buftxt2 equ varend
 11593                              <1> buftxt equ buftxt2 + 1024
 11594                              <1> buftxtend equ buftxt + 1024
 11595                              <1> buf2 equ buftxtend
 11596                              <1> numbuf equ buf2 + 20
 11597                              <1> %ifdef io.serial
 11598                              <1> 	lastcommandpos equ numbuf + 1
 11599                              <1> %else
 11600                              <1> 	%ifdef gui.included
 11601                              <1> 		graphicstable equ numbuf + 1 ;w type, dw datalocation, w locationx, w locationy, w selected, dw code
 11602                              <1> 		graphicstableend equ graphicstable + 200h
 11603                              <1> 		%ifdef gui.background
 11604                              <1> 			backgroundbuffer equ graphicstableend
 11605                              <1> 			backgroundbufferend equ backgroundbuffer + 1280*1026*2
 11606                              <1> 			mousecolorbuf equ backgroundbufferend
 11607                              <1> 		%else
 11608                              <1> 			mousecolorbuf equ graphicstableend ;where the gui under the mouse is stored
 11609                              <1> 		%endif
 11610                              <1> 		mcolorend equ mousecolorbuf + 256
 11611                              <1> 		videobuf equ mcolorend + 1	;1680x1050 pixels in characters
 11612                              <1> 		videobufend	equ videobuf + 210*65*4;2
 11613                              <1> 		videobuf2 equ videobufend
 11614                              <1> 		videobuf2end equ videobuf2 + 210*65*4;2
 11615                              <1> 	%else
 11616                              <1> 		videobuf equ numbuf + 1
 11617                              <1> 		videobufend equ videobuf + 80*30*4
 11618                              <1> 		videobuf2 equ videobufend
 11619                              <1> 		videobuf2end equ videobuf2 + 80*30*4
 11620                              <1> 	%endif
 11621                              <1> 	lastcommandpos: equ videobuf2end
 11622                              <1> %endif
 11623                              <1> 	commandbufpos: equ lastcommandpos + 4
 11624                              <1> 	commandlistentries: equ commandbufpos + 4
 11625                              <1> 	commandsentered: equ commandlistentries + 4
 11626                              <1> 	commandbuf: equ commandsentered + 4
 11627                              <1> 	commandbufend: equ commandbuf + 4096 ;this is where kernel space only ends, the rest is for threading
 11628                              <1> %ifdef network.included
 11629                              <1> 	rbuffstart: equ commandbufend ;for use with networking
 11630                              <1> 	rbuffend equ rbuffstart + 8212
 11631                              <1> %else
 11632                              <1> 	rbuffstart equ commandbufend
 11633                              <1> 	rbuffend equ commandbufend
 11634                              <1> %endif
 11635                              <1> %ifdef threads.included
 11636                              <1> 	threadlist: equ rbuffend ;this buffer will hold the stack locations of all of the threads, up to 2048
 11637                              <1> 	threadlistend: equ threadlist + 1024*4
 11638                              <1> 	stacks:	equ threadlistend ;NOT TRUE:i use SS now for proper stack management. This makes sure stacks never screw with other memory
 11639                              <1> 	stack1: equ stacks + 2048  ;woah, thats a lot of space for stacks
 11640                              <1> 	bssend equ stack1 + 1024*2048
 11641                              <1> %else
 11642                              <1> 	bssend equ rbuffend
 11643                              <1> %endif
 11644                              <1> dosprogloc equ 0x400000 ;from here on, it is not kernel space so apps can be loaded here.
 11645                                      %include "build/files.asm"
 11646                              <1> align 512,db 0
 11647                              <1> f0:
 11648 00039235 <incbin>            <1> incbin "included/boot.sh"
 11649 00039518 00<rept>            <1> align 512,db 0
 11650                              <1> f1:
 11651 00039518 <incbin>            <1> incbin "included/dostest.com"
 11652 00039731 00<rept>            <1> align 512,db 0
 11653                              <1> f2:
 11654 00039731 <incbin>            <1> incbin "included/exec"
 11655 000398E1 00<rept>            <1> align 512,db 0
 11656                              <1> f3:
 11657 000398E1 <incbin>            <1> incbin "included/finalcount.sn"
 11658 00039B02 00<rept>            <1> align 512,db 0
 11659                              <1> f4:
 11660 00039B02 <incbin>            <1> incbin "included/fork"
 11661 00039D58 00<rept>            <1> align 512,db 0
 11662                              <1> f5:
 11663 00039D58 <incbin>            <1> incbin "included/guitest"
 11664 0003A23A 00<rept>            <1> align 512,db 0
 11665                              <1> f6:
 11666 0003A23A <incbin>            <1> incbin "included/int"
 11667 0003A5AF 00<rept>            <1> align 512,db 0
 11668                              <1> f7:
 11669 0003A5AF <incbin>            <1> incbin "included/lostwoods.sn"
 11670 0003A6AE 00<rept>            <1> align 512,db 0
 11671                              <1> f8:
 11672 0003A6AE <incbin>            <1> incbin "included/mario.sn"
 11673 0003A83A 00<rept>            <1> align 512,db 0
 11674                              <1> f9:
 11675 0003A83A <incbin>            <1> incbin "included/songotime.sn"
 11676 0003AA4A 00<rept>            <1> align 512,db 0
 11677                              <1> f10:
 11678 0003AA4A <incbin>            <1> incbin "included/sse"
 11679 0003AE9A 00<rept>            <1> align 512,db 0
 11680                              <1> f11:
 11681 0003AE9A <incbin>            <1> incbin "included/tely"
 11682 0003B1BA 00<rept>            <1> align 512,db 0
 11683                              <1> f12:
 11684 0003B1BA <incbin>            <1> incbin "included/unfs"
 11685                              <1> align 512,db 0
 11686                              <1> f13:
 11687 0003B1BA <incbin>            <1> incbin "included/_img.bin"
 11688                              <1> align 512,db 0
 11689                              <1> f14:
 11690                                  %endif
